Attribute VB_Name = "MS_SysBase"
Sub sysIniciar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERS|fffd|O DO SISTEMA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' identifica vers|fffd|o atual do sistema
        Call versaoAtualizada
        
    '///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    '*************************************************************************************************************************** ABERTURA
    ' prepara abertura e oculta menus
        Call planAjustarID
        Call planOcultarMenus
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** INICIALIZA|fffd||fffd|O E CONFIGURA|fffd||fffd|O VISUAL
' gerencia foto de perfil administrador/usu|fffd|rio
        Call configFotoAdmin
        
' ajusta forma de atualiza|fffd||fffd|o de saldo no caixa
        Call planLocalizaBM
        
        If temp = 0 Then
            Sheets("carteiraCaixa").Unprotect
            Sheets("carteiraCaixa").Shapes.Range(Array("btnCaixaSaldo")).Visible = True
            Sheets("carteiraCaixa").Shapes.Range(Array("btnCaixaSaldoBM")).Visible = False
            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            
            Else
            Sheets("carteiraCaixa").Unprotect
            Sheets("carteiraCaixa").Shapes.Range(Array("btnCaixaSaldo")).Visible = False
            Sheets("carteiraCaixa").Shapes.Range(Array("btnCaixaSaldoBM")).Visible = True
            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            
        End If
        
' ajuste de resolu|fffd||fffd|o
        For Each ws In Worksheets
        ws.Activate
        
' valida acesso ao banco de dados com perfil administrador e disponibilidade de atualiza|fffd||fffd|es
        If ws.Name = "config" Then
            
' edita altera|fffd||fffd|o na tela config
            ws.Unprotect
            
            Call planValidaVersao
            If versaoLimitada = "sim" Then
                Sheets("config").Shapes.Range(Array("btnUpdate")).Visible = False
                Else
                Sheets("config").Shapes.Range(Array("btnUpdate")).Visible = True
                
            End If
            
            Sheets("config").Shapes.Range(Array("icoGuiasON")).Visible = True
            Sheets("config").Shapes.Range(Array("icoGuiasOFF")).Visible = False
            
            If Range("E6") = "Administrador" Then
                Sheets("config").Shapes.Range(Array("imgDBC")).Visible = True
                Sheets("config").Shapes.Range(Array("imgDBB")).Visible = False
                ws.Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
                Else
                Sheets("config").Shapes.Range(Array("imgDBB")).Visible = True
                Sheets("config").Shapes.Range(Array("imgDBC")).Visible = False
                ws.Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
            End If
        End If
        
' ajusta tamanho da tela de aplica|fffd||fffd|o e oculta guias
        Call planOcultarGuias
        'Call planExibirGuias
        
        If Sheets("config").Cells(16, 14) = "AUTO" Then
            Call planResolucaoAutoajustar
            Else
            
        End If
        Next ws
        
' splash de sauda|fffd||fffd|o e ajuste de telas
        Call planIntro
        
        If resLargura < 1920 Then
            frmIntroB.lblVersaoB = versaoSys
            frmIntroB.lblCopyrightB = "|fffd| " & Year(Now) & " Creatifica. Todos os direitos reservados."
            frmIntroB.lblSaudacaoB = saudacao & " " & usuario
            frmIntroB.Show
            Else
            
            frmIntro.lblVersao = versaoSys
            frmIntro.lblCopyright = "|fffd| " & Year(Now) & " Creatifica. Todos os direitos reservados."
            frmIntro.lblSaudacao = saudacao & " " & usuario
            frmIntro.Show
            
        End If
        
' libera|fffd||fffd|o autom|fffd|tica para macros e desativa|fffd||fffd|o de verifica|fffd||fffd|o de erros
        With Application
            .ErrorCheckingOptions.InconsistentFormula = False
            .ErrorCheckingOptions.InconsistentTableFormula = False
            .Visible = True
        End With
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TELA DE APRESENTA|fffd||fffd|O PRIMEIRO ACESSO
' verifica se |fffd| o primeiro acesso ao sistema e apresenta tela de boas vindas
        contLinha = 10
        Do Until Sheets("databaseCadastros").Cells(contLinha, 9) = "Logout" Or Sheets("databaseCadastros").Cells(contLinha, 3) = ""
        contLinha = contLinha + 1
        Loop
        
        If Sheets("databaseCadastros").Cells(contLinha, 3) = "" And contLinha <= 12 Then
            Application.Visible = True
            If resLargura < 1920 Then
                Sheets("ajuda").Activate
                frmWelcomeB.Show
                Application.Visible = True
                Exit Sub
                Else
                
                Sheets("ajuda").Activate
                frmWelcome.Show
                Application.Visible = True
                Exit Sub
                
            End If
            Else
            
        End If
        
'*************************************************************************************************************************** MERCADO - NOT|fffd|CIAS / HOR|fffd|RIO COMERCIAL
' valida hor|fffd|rio de opera|fffd||fffd|o para alertas
        If hora > "09:00:00" And hora < "17:55:00" Then
            
' loop para localiza|fffd||fffd|o de not|fffd|cia com prazo terminando
            contLinha = 17
            Do Until Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "" Or Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "|fffd|ltimo dia" Or _
            Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "Acontece hoje"
            contLinha = contLinha + 1
            Loop
            
' vari|fffd|veis
            tipoNoticia = Sheets("mercadoNot|fffd|cias").Cells(contLinha, 7)
            codigoAtivo = Sheets("mercadoNot|fffd|cias").Cells(contLinha, 9)
            
            If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "" Then
                Else
                
'*************************************************************************************************************************** MERCADO - NOT|fffd|CIAS / EVENTOS DO DIA
                If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "Acontece hoje" Then
                    MsgBox "Hoje |fffd| dia de " & tipoNoticia & " " & codigoAtivo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Sheets("mercadoNot|fffd|cias").Activate
                    Application.Visible = True
                    Exit Sub
                    Else
                    
                    If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "|fffd|ltimo dia" Then
                        MsgBox "Hoje |fffd| o |fffd|ltimo dia para " & tipoNoticia & " de " & codigoAtivo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Sheets("mercadoNot|fffd|cias").Activate
                        Application.Visible = True
                        Exit Sub
                        Else
                        
                    End If
                End If
            End If
            
            Else
'*************************************************************************************************************************** MERCADO - NOT|fffd|CIAS / EVENTOS EM 1 OU 2 DIAS
' valida alerta de 1 dia
            contLinha = 17
            Do Until Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "" Or Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "1 dia" _
            Or Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "2 dias"
            contLinha = contLinha + 1
            Loop
            
' vari|fffd|veis
            tipoNoticia = Sheets("mercadoNot|fffd|cias").Cells(contLinha, 7)
            codigoAtivo = Sheets("mercadoNot|fffd|cias").Cells(contLinha, 9)
            
            If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "1 dia" Then
                MsgBox "Amanh|fffd| haver|fffd| " & tipoNoticia & " de " & codigoAtivo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Else
                
' valida alerta de 2 dias
                If tipoNoticia <> "Leil|fffd|o" And Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "2 dias" Then
                    MsgBox "Amanh|fffd| ser|fffd| o |fffd|ltimo dia para " & tipoNoticia & " de " & codigoAtivo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Else
                    
                End If
            End If
        End If
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CARTEIRA ACOMPANHA - FECHAMENTO
' vari|fffd|veis
        data = Sheets("carteiraAcompanha").Cells(1, 1)
        data = Replace(data, "/" & Year(Now), "")
        
' verifica se m|fffd|s corrente j|fffd| est|fffd| fechado
        If Sheets("carteiraAcompanha").Cells(1, 10) = Sheets("carteiraAcompanha").Cells(11, 6) Then
            Else
            
' valida|fffd||fffd|o do dia de fechamento
            If Sheets("config").Cells(12, 5) <> "Sigiloso" And Sheets("carteiraPosi|fffd||fffd|o").Cells(5, 10) > 0 Then
                If data = "31/01" Or data = "28/02" Or data = "29/02" Or data = "31/03" Or data = "30/04" Or data = "31/05" Or data = "30/06" Or _
                data = "31/07" Or data = "31/08" Or data = "30/09" Or data = "31/10" Or data = "30/11" Or data = "31/12" Then
                    MsgBox "Aten|fffd||fffd|o! Hoje |fffd| dia de fechamento mensal! N|fffd|o se esque|fffd|a de atualizar os indicadores de mercado e o saldo atual de suas aplica|fffd||fffd|es.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    
' verifica hor|fffd|rio para acesso direto |fffd| tela de fechamento
                    If hora > "19:00:00" Then
                        Sheets("carteiraAcompanha").Activate
                        Application.Visible = True
                        Exit Sub
                        Else
                    End If
                    Else
                    
' fechamento autom|fffd|tico caso m|fffd|s tenha acabado e fechamento tenha ficado pendente
                    If Sheets("carteiraAcompanha").Cells(11, 6) < Sheets("carteiraAcompanha").Cells(1, 10) - 1 Or _
                    Sheets("carteiraAcompanha").Cells(1, 10) = 1 And Sheets("carteiraAcompanha").Cells(11, 6) < 12 And Sheets("carteiraAcompanha").Cells(11, 6) <> 0 Then
                        MsgBox "Foi encontrado um fechamento mensal pendente em sua carteira. N|fffd|o se esque|fffd|a de realizar este passo antes de encerrar a aplica|fffd||fffd|o.", _
                        vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Sheets("carteiraPosi|fffd||fffd|o").Activate
                        Application.Visible = True
                        Exit Sub
                        Else
                    End If
                End If
            End If
        End If
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ORDENS PENDENTES - LIQUIDA|fffd||fffd|ES
' verifica opera|fffd||fffd|es liquidadas na carteira
        contLinha = 5
        Do Until Sheets("carteiraOp").Cells(contLinha, 14) = "LIQUIDADA" Or Sheets("carteiraOp").Cells(contLinha, 14) = ""
        contLinha = contLinha + 1
        Loop
        
' vari|fffd|veis
        qtde = Sheets("carteiraOp").Cells(3, 12).Value
        nomeInvest = Sheets("carteiraOp").Cells(contLinha, 8).Value
        tipoOrdem = Sheets("carteiraOp").Cells(contLinha, 6).Value
        
' valida quantidade de ordens liquidadas e exibe alerta
        If Sheets("carteiraOp").Cells(contLinha, 14) = "LIQUIDADA" And qtde = "1" Then
            MsgBox "Aten|fffd||fffd|o! " & tipoOrdem & " de " & nomeInvest & " liquidada.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Sheets("carteiraOp").Activate
            Application.Visible = True
            Exit Sub
            Else
            
            If Sheets("carteiraOp").Cells(contLinha, 14) = "LIQUIDADA" And qtde > "1" Then
                MsgBox "Aten|fffd||fffd|o! " & qtde & " ordens pendentes est|fffd|o liquidadas.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Sheets("carteiraOp").Activate
                Application.Visible = True
                Exit Sub
                Else
                
            End If
        End If
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** OPERA|fffd||fffd|ES ESPECIAIS - PEND|fffd|NCIAS E LIQUIDA|fffd||fffd|ES
' verifica opera|fffd||fffd|es especiais em andamento
        contLinha = 18
        Do Until Sheets("opEspeciais").Cells(contLinha, 14) = "CONCLU|fffd|DA" Or Sheets("opEspeciais").Cells(contLinha, 14) = "EM ANDAMENTO" Or _
        Sheets("opEspeciais").Cells(contLinha, 14) = ""
        contLinha = contLinha + 1
        Loop
        
' vari|fffd|veis
        contUnit = Sheets("opEspeciais").Cells(16, 10)
        tempVal = Sheets("opEspeciais").Cells(16, 11)
        qtde = Sheets("opEspeciais").Cells(contLinha, 4).Value - Sheets("opEspeciais").Cells(1, 1).Value
        nomeInvest = Sheets("opEspeciais").Cells(contLinha, 8).Value
        tipoOrdem = Sheets("opEspeciais").Cells(contLinha, 6).Value
        
' valida quantidade de opera|fffd||fffd|es conclu|fffd|das e exibe alertas
        If Sheets("opEspeciais").Cells(contLinha, 14) = "CONCLU|fffd|DA" Then
            If Sheets("opEspeciais").Cells(contLinha, 14) = "CONCLU|fffd|DA" And tempVal = "1" Then
                MsgBox "Aten|fffd||fffd|o! " & tipoOrdem & " de " & nomeInvest & " conclu|fffd|da.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Sheets("opEspeciais").Activate
                Application.Visible = True
                Exit Sub
                Else
                
                If Sheets("opEspeciais").Cells(contLinha, 14) = "LIQUIDADA" And tempVal > "1" Then
                    MsgBox "Aten|fffd||fffd|o! " & qtde & " opera|fffd||fffd|es pendentes est|fffd|o conclu|fffd|das.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Sheets("opEspeciais").Activate
                    Application.Visible = True
                    Exit Sub
                    Else
                    
                End If
            End If
            Else
            
' valida quantidade de opera|fffd||fffd|es em andamento e exibe alertas
            If Sheets("opEspeciais").Cells(contLinha, 14) = "EM ANDAMENTO" Then
                If qtde <= 9 And qtde >= 7 And contUnit = 1 Then
                    MsgBox "Aten|fffd||fffd|o! Existe uma opera|fffd||fffd|o especial em andamento. Fique atento para n|fffd|o perder os prazos da negocia|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Sheets("opEspeciais").Activate
                    Application.Visible = True
                    Exit Sub
                    Else
                    
                    If qtde <= 9 And qtde >= 7 And contUnit > 1 Then
                        MsgBox "Aten|fffd||fffd|o! Existem opera|fffd||fffd|es especiais em andamento. Fique atento para n|fffd|o perder os prazos das negocia|fffd||fffd|es.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Sheets("opEspeciais").Activate
                        Application.Visible = True
                        Exit Sub
                        Else
                        
                        If qtde <= 4 And qtde >= 1 And contUnit = 1 Then
                            MsgBox "Aten|fffd||fffd|o! Existe uma opera|fffd||fffd|o especial em fase de pagamento. Fique atento para n|fffd|o perder os prazos da negocia|fffd||fffd|o.", _
                            vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Sheets("opEspeciais").Activate
                            Application.Visible = True
                            Exit Sub
                            Else
                            
                            If qtde <= 4 And qtde >= 1 And contUnit > 1 Then
                                MsgBox "Aten|fffd||fffd|o! Existem opera|fffd||fffd|es especiais em fase de pagamento. Fique atento para n|fffd|o perder os prazos das negocia|fffd||fffd|es.", _
                                vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Sheets("opEspeciais").Activate
                                Application.Visible = True
                                Exit Sub
                                Else
                            
                            End If
                        End If
                    End If
                End If
            End If
        End If
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ABERTURA PADR|fffd|O DO SISTEMA
' abertura padr|fffd|o
        ThisWorkbook.Activate
        If ActiveSheet.Name = "carteiraAcompanha" Or ActiveSheet.Name = "opEspeciais" Or ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name = "mercadoNot|fffd|cias" Then
            Application.Visible = True
            Else
            
            Sheets("carteiraPosi|fffd||fffd|o").Activate
            Application.Visible = True
            
        End If
    End If
    
End Sub
Attribute VB_Name = "MS_SysFuncs"
Public Function IsConnected() As Boolean
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TIPO DE CONEX|fffd|O WEB
'Debug.Print item.netConnectionID
'Debug.Print item.adaptertype
'Debug.Print item.NetConnectionStatus
' vari|fffd|veis
    Dim oObject
    Dim adapter
    Dim item
    
' define constantes de conex|fffd|o
    Set oObject = GetObject("WINMGMTS:\\.\ROOT\cimv2")
    Set adapter = oObject.InstancesOf("Win32_NetworkAdapter")
    
' loop para identificar dados do adaptador
    For Each item In adapter

        If item.netConnectionID <> "null" Then
            If item.netConnectionID = "Wi-Fi" Then
                tipoConn = item.netConnectionID '"Wi-Fi"
                
' valida continuar atualiza|fffd||fffd|o em caso de wifi
                confirmaAtualizacao = MsgBox("Ops! Parece que sua conex|fffd|o |fffd| " & tipoConn & ". A atualiza|fffd||fffd|o poder|fffd| demorar e causar erros. Deseja continuar?", _
                vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " "))
                
                If confirmaAtualizacao = vbNo Then
                    temp = "Finalizar"
                    Exit Function
                    Else
                    temp = ""
                    Exit Function
                    
                End If
            End If
        End If
    
    Next
    
End Function



Attribute VB_Name = "MS_SysLocalizadores"
Sub planLocalizaBM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOCALIZA BUDGET MASTERPLAN
' arquivo a ser localizado
    localizaArquivo = ThisWorkbook.Path & "\Budget Masterplan.xlsm"
    
' busca arquivo na pasta local
    If Dir(localizaArquivo) = "" Then
        strcheck = False
        Else
        strcheck = True
        
    End If
    
' retorna resultado
    If strcheck = True Then
    
' arquivo existe
        temp = 1
        Exit Sub
        Else
        
' arquivo n|fffd|o existe
        temp = 0
        
    End If
    
End Sub
Sub planLocalizaTM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOCALIZA TRAVEL MASTERPLAN
' arquivo a ser localizado
    localizaArquivo = ThisWorkbook.Path & "\Travel Masterplan.xlsm"
    
' busca arquivo na pasta local
    If Dir(localizaArquivo) = "" Then
        strcheck = False
        Else
        strcheck = True
        
    End If
    
' retorna resultado
    If strcheck = True Then
    
' arquivo existe
        temp = 1
        Exit Sub
        Else
        
' arquivo n|fffd|o existe
        temp = 0
        
    End If
    
End Sub

Attribute VB_Name = "MS_SysLog"
Sub sysInfoPC()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA DADOS DO PC
' identifica usu|fffd|rio e nome do computador
    usuarioPC = Environ$("username")
    computador = Environ$("ComputerName")
    dadosPC = usuarioPC & "/" & computador

End Sub
Sub sysLog()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CRIA REGISTRO DE LOG
' loop para identifica|fffd||fffd|o de usu|fffd|rio no login
    contLinha = 5
    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = "" Or Sheets("databaseCadastros").Cells(contLinha, 5) = fEmail _
    Or Sheets("databaseCadastros").Cells(contLinha, 5) = fEmailB
    contLinha = contLinha + 1
    Loop
    
' vari|fffd|veis
    'atividade - definida em cada opera|fffd||fffd|o
    ambiente = "Interface"
    hora = TimeValue(Now)
    data = Sheets("databaseCadastros").Cells(1, 1)
    usuario = Sheets("databaseCadastros").Cells(contLinha, 4)
    email = Sheets("databaseCadastros").Cells(contLinha, 5)
    perfilSys = Sheets("databaseCadastros").Cells(contLinha, 8)
    
' desvia registro se for ADMIN
    If perfilSys = "Administrador" Then
        Exit Sub
        Else
        
' caso n|fffd|o seja ADMIN, regitra log
        If usuario = "" Then
            usuario = Sheets("config").Cells(7, 5)
            email = Sheets("config").Cells(10, 5)
            perfilSys = Sheets("config").Cells(6, 5)
            Else
            
        End If
        
' identifica pc
        Call sysInfoPC
        
' loop para localizar linha vazia na tabela de log
        If Sheets("databaseCadastros").Cells(10, 3) = "" Then
            contLinha = 10
            Else
            contLinha = Sheets("databaseCadastros").Cells(Rows.Count, 3).End(xlUp).Row + 1
            
        End If
        
' registra dados de log na tabela
        Sheets("databaseCadastros").Unprotect
        
        Sheets("databaseCadastros").Cells(contLinha, 3) = data
        Sheets("databaseCadastros").Cells(contLinha, 4) = hora
        Sheets("databaseCadastros").Cells(contLinha, 5) = usuario
        Sheets("databaseCadastros").Cells(contLinha, 6) = perfilSys
        Sheets("databaseCadastros").Cells(contLinha, 7) = dadosPC
        Sheets("databaseCadastros").Cells(contLinha, 8) = email
        Sheets("databaseCadastros").Cells(contLinha, 9) = atividade
        Sheets("databaseCadastros").Cells(contLinha, 10) = ambiente
        
' reestabelece formato das colunas e finaliza log
        Range("tabDatabaseCadastrosLog[Data]").NumberFormat = "dd/mm/yyyy"
        Call databaseCadastrosLogClassificar
        Range("A1").Activate
        Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub sysLogOperacoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CRIA REGISTRO DE LOG PARA OPERA|fffd||fffd|ES
' vari|fffd|veis
    atividade = tipoOperacao
    ambiente = "Interface"
    hora = TimeValue(Now)
    data = Sheets("databaseCadastros").Cells(1, 1)
    usuario = Sheets("config").Cells(7, 5)
    email = Sheets("config").Cells(10, 5)
    perfilSys = Sheets("config").Cells(6, 5)
    
' desvia registro se for ADMIN
    If perfilSys = "Administrador" Then
        Exit Sub
        Else
        
' caso n|fffd|o seja ADMIN, regitra log
        Call sysInfoPC
        
' loop para localizar linha vazia na tabela de log
        If Sheets("databaseCadastros").Cells(10, 3) = "" Then
            contLinha = 10
            Else
            contLinha = Sheets("databaseCadastros").Cells(Rows.Count, 3).End(xlUp).Row + 1
            
        End If
        
' registra dados de log na tabela
        Sheets("databaseCadastros").Unprotect
        
        Sheets("databaseCadastros").Cells(contLinha, 3) = data
        Sheets("databaseCadastros").Cells(contLinha, 4) = hora
        Sheets("databaseCadastros").Cells(contLinha, 5) = usuario
        Sheets("databaseCadastros").Cells(contLinha, 6) = perfilSys
        Sheets("databaseCadastros").Cells(contLinha, 7) = dadosPC
        Sheets("databaseCadastros").Cells(contLinha, 8) = email
        Sheets("databaseCadastros").Cells(contLinha, 9) = atividade
        Sheets("databaseCadastros").Cells(contLinha, 10) = ambiente
        
' reestabelece formato das colunas e finaliza log
        Range("tabDatabaseCadastrosLog[Data]").NumberFormat = "dd/mm/yyyy"
        Call databaseCadastrosLogClassificar
        Range("A1").Activate
        Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub sysLogDatabase()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CRIA REGISTRO DE LOG PARA ALTERA|fffd||fffd|ES DATABASE
' vari|fffd|veis
    atividade = tipoOpDatabase
    ambiente = "Database"
    hora = TimeValue(Now)
    data = Sheets("databaseCadastros").Cells(1, 1)
    usuario = Sheets("config").Cells(7, 5)
    email = Sheets("config").Cells(10, 5)
    perfilSys = Sheets("config").Cells(6, 5)
    
' desvia registro se for ADMIN
    If perfilSys = "Administrador" Then
        Exit Sub
        Else
        
' caso n|fffd|o seja ADMIN, regitra log
        Call sysInfoPC
        
' loop para localizar linha vazia na tabela de log
        If Sheets("databaseCadastros").Cells(10, 3) = "" Then
            contLinha = 10
            Else
            contLinha = Sheets("databaseCadastros").Cells(Rows.Count, 3).End(xlUp).Row + 1
            
        End If
        
' registra dados de log na tabela
        Sheets("databaseCadastros").Unprotect
        
        Sheets("databaseCadastros").Cells(contLinha, 3) = data
        Sheets("databaseCadastros").Cells(contLinha, 4) = hora
        Sheets("databaseCadastros").Cells(contLinha, 5) = usuario
        Sheets("databaseCadastros").Cells(contLinha, 6) = perfilSys
        Sheets("databaseCadastros").Cells(contLinha, 7) = dadosPC
        Sheets("databaseCadastros").Cells(contLinha, 8) = email
        Sheets("databaseCadastros").Cells(contLinha, 9) = atividade
        Sheets("databaseCadastros").Cells(contLinha, 10) = ambiente
        
' reestabelece formato das colunas e finaliza log
        Range("tabDatabaseCadastrosLog[Data]").NumberFormat = "dd/mm/yyyy"
        Call databaseCadastrosLogClassificar
        Range("A1").Activate
        Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub sysLogBackup()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CRIA REGISTRO DE LOG PARA BACKUP
' vari|fffd|veis
    atividade = tipoBackup
    ambiente = "Ferramentas"
    hora = TimeValue(Now)
    data = Sheets("databaseCadastros").Cells(1, 1)
    usuario = Sheets("config").Cells(7, 5)
    email = Sheets("config").Cells(10, 5)
    perfilSys = Sheets("config").Cells(6, 5)
    
' desvia registro se for ADMIN
    If perfilSys = "Administrador" Then
        Exit Sub
        Else
        
' caso n|fffd|o seja ADMIN, regitra log
        Call sysInfoPC
        
' loop para localizar linha vazia na tabela de log
        If Sheets("databaseCadastros").Cells(10, 3) = "" Then
            contLinha = 10
            Else
            contLinha = Sheets("databaseCadastros").Cells(Rows.Count, 3).End(xlUp).Row + 1
            
        End If
        
' registra dados de log na tabela
        Sheets("databaseCadastros").Unprotect
        
        Sheets("databaseCadastros").Cells(contLinha, 3) = data
        Sheets("databaseCadastros").Cells(contLinha, 4) = hora
        Sheets("databaseCadastros").Cells(contLinha, 5) = usuario
        Sheets("databaseCadastros").Cells(contLinha, 6) = perfilSys
        Sheets("databaseCadastros").Cells(contLinha, 7) = dadosPC
        Sheets("databaseCadastros").Cells(contLinha, 8) = email
        Sheets("databaseCadastros").Cells(contLinha, 9) = atividade
        Sheets("databaseCadastros").Cells(contLinha, 10) = ambiente
        
' reestabelece formato das colunas e finaliza log
        Range("tabDatabaseCadastrosLog[Data]").NumberFormat = "dd/mm/yyyy"
        Call databaseCadastrosLogClassificar
        Range("A1").Activate
        Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub

Attribute VB_Name = "MS_SysSubs"
Sub acessarCorretora()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ABRE SITE DA CORRETORA
' gerenciamento de erros
    On Error GoTo errorHandler
    
' verifica|fffd||fffd|o de corretora - compras e vendas
    If Range("E5") = "Corretora:" And Range("F5") = "#Selecionar" Then
        MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("F5").Select
        Exit Sub
        Else
        
        If Range("E5") = "Corretora:" And Range("F5") <> "#Selecionar" Then
            corretora = Range("F5")
            linkCorretora = Range("F4")
            ActiveWorkbook.FollowHyperlink Address:=linkCorretora
            Exit Sub
            Else
            
' verifica|fffd||fffd|o de corretora - proventos
            If Range("G5") = "Corretora:" And Range("H5") = "#Selecionar" Then
                MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("H5").Select
                Exit Sub
                Else
                
                If Range("G5") = "Corretora:" And Range("H5") <> "#Selecionar" Then
                    corretora = Range("H5")
                    linkCorretora = Range("H4")
                    ActiveWorkbook.FollowHyperlink Address:=linkCorretora
                    Exit Sub
                    Else
                    
                End If
            End If
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Tivemos um erro inesperado. Tente novamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Sub ajustaGhostCell()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** AJUSTA GHOSTCELL
' gerenciamento de erro
    On Error Resume Next
    
' valida opera|fffd||fffd|o em andamento e libera edi|fffd||fffd|o
    If tipoOperacao = "" Then
        ActiveSheet.Unprotect
        
' ajusta contlinha conforme tela ativa
        If ActiveSheet.Name = "fundosResgates" Or ActiveSheet.Name = "coesResgates" Then
            contLinha = 26
            Else
            contLinha = 23
            
        End If
        
        Do Until ActiveSheet.Cells(contLinha, 3) = ""
        tempGhost = Left(ActiveSheet.Cells(contLinha, 14), 1)
        
        If tempGhost = "*" Then
            ActiveSheet.Cells(contLinha, 16) = tempGhost
            Else
            ActiveSheet.Cells(contLinha, 16) = ""
            
        End If
        
        contLinha = contLinha + 1
        Loop
        
' finaliza edi|fffd||fffd|o
        ActiveSheet.Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub
        Else
        
' ajusta contlinha conforme tela ativa
        If ActiveSheet.Name = "fundosResgates" Or ActiveSheet.Name = "coesResgates" Then
            contLinha = 26
            Else
            contLinha = 23
            
        End If
        
        Do Until ActiveSheet.Cells(contLinha, 3) = ""
        tempGhost = Left(ActiveSheet.Cells(contLinha, 14), 1)
        
        If tempGhost = "*" Then
            ActiveSheet.Cells(contLinha, 16) = tempGhost
            Else
            ActiveSheet.Cells(contLinha, 16) = ""
            
        End If
        
        contLinha = contLinha + 1
        Loop
        
    End If
    
End Sub
Sub versaoAtualizada()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA VERS|fffd|O ATUAL DO SISTEMA
' nome e release da vers|fffd|o
    versaoSys = "Vers|fffd|o " & "3.6"
    
End Sub
Sub planValidaVersao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA VERS|fffd|O COMPLETA OU FREE
' valida vers|fffd|es Free e Premium
    If InStr(1, ThisWorkbook.Name, "Free") = True Then
        versaoLimitada = "Sim"
        Else
        versaoLimitada = "N|fffd|o"
        
    End If
    
End Sub
Sub planAutoSave()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SALVAMENTO AUTOM|fffd|TICO
' valida autosave
    If Sheets("config").CheckBoxSave = True Then
        ThisWorkbook.Save
        Exit Sub
        
    End If
    
End Sub
Sub planResolucaoAutoajustar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RESOLU|fffd||fffd|O DO MONITOR
' identifica largura e altura
    If tempPlan <> "" Then
        resLargura = GetSystemMetrics(SM_CXSCREEN)
        resAltura = GetSystemMetrics(SM_CYSCREEN)
        Exit Sub
        Else
        
'*************************************************************************************************************************** RESOLU|fffd||fffd|ES DIVERSAS
' identifica resolu|fffd||fffd|o do sistema
        resLargura = GetSystemMetrics(SM_CXSCREEN)
        resAltura = GetSystemMetrics(SM_CYSCREEN)

' identifica resolu|fffd||fffd|es padr|fffd|o e ajusta sistema
        If resLargura = 1024 And ActiveWindow.Zoom <> "65" Then
            ActiveWindow.Zoom = "65"
            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            ActiveSheet.EnableSelection = xlUnlockedCells
            Exit Sub
            Else
            
            If resLargura = 1280 And ActiveWindow.Zoom <> "82" Then
                ActiveWindow.Zoom = "82"
                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                ActiveSheet.EnableSelection = xlUnlockedCells
                Exit Sub
                Else
                
                If resLargura = 1366 And ActiveWindow.Zoom <> "88" Then
                    ActiveWindow.Zoom = "88"
                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    ActiveSheet.EnableSelection = xlUnlockedCells
                    Exit Sub
                    Else
                    
                    If resLargura = 1920 And ActiveWindow.Zoom <> "125" Then
                        ActiveWindow.Zoom = "125"
                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        ActiveSheet.EnableSelection = xlUnlockedCells
                        Exit Sub
                        Else
                        
                        ActiveSheet.EnableSelection = xlUnlockedCells
                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub planResolucaoPadrao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RESOLU|fffd||fffd|O DO MONITOR
' identifica largura e altura
    resLargura = GetSystemMetrics(SM_CXSCREEN)
    resAltura = GetSystemMetrics(SM_CYSCREEN)
    contPlan = ActiveSheet.Name
    
' valida exibi|fffd||fffd|o atual
    If Sheets("config").Cells(16, 14) = "100%" Or Sheets("config").Cells(16, 14) = 1 Then
        
' edita altera|fffd||fffd|o
        Sheets("config").Unprotect
        Sheets("config").Cells(16, 14) = "AUTO"
        
        For Each ws In Worksheets
        ws.Activate
        Call planResolucaoAutoajustar
        Next ws
        
        Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets(contPlan).Activate
        Exit Sub
        Else

'*************************************************************************************************************************** RESOLU|fffd||fffd|O PADR|fffd|O 100%
' edita altera|fffd||fffd|o
        If Sheets("config").Cells(16, 14) = "AUTO" Then
            Sheets("config").Unprotect
            Sheets("config").Cells(16, 14) = "100%"
            
            For Each ws In Worksheets
            ws.Activate
            ActiveWindow.Zoom = "100"
            Next ws
            
' retona |fffd| tela anterior
            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets(contPlan).Activate
            Exit Sub
            
        End If
    End If
    
End Sub
Sub planSairBackup()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SALVA APLICA|fffd||fffd|O AP|fffd|S BACKUP
' vari|fffd|veis
    atividade = "Backup"
    
' configura formato aplica|fffd||fffd|o
    Sheets("loading").Activate
    With Application
        .OnKey "{ESCAPE}"
        .ScreenUpdating = True
        .Wait Now + TimeValue("00:00:01")
        .Visible = False
        .Caption = ""
    End With
    
' desativa alerta de acesso |fffd| database
    If Sheets("config").Cells(1, 14) <> "" Then
        Sheets("config").Unprotect
        Sheets("config").Cells(1, 14) = ""
        Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
    End If
    
' reseta contador de tooltip
    contRep = 0
    
' finaliza|fffd||fffd|o geral
    Call planExibirMenus
    Call sysLog
    'Call planAtivarModoSigiloso
    Application.Visible = True
    ThisWorkbook.Save
    
End Sub
Sub planSairUpdate()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SALVA APLICA|fffd||fffd|O AP|fffd|S ATUALIZA|fffd||fffd|O
' vari|fffd|veis
    atividade = "Atualiza|fffd||fffd|o"
    
' configura formato aplica|fffd||fffd|o
    Sheets("loading").Activate
    With Application
        .OnKey "{ESCAPE}"
        .ScreenUpdating = True
        .Wait Now + TimeValue("00:00:01")
        .Visible = False
        .Caption = ""
    End With
    
' desativa alerta de acesso |fffd| database
    If Sheets("config").Cells(1, 14) <> "" Then
        Sheets("config").Unprotect
        Sheets("config").Cells(1, 14) = ""
        Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
    End If
    
' reseta contador de tooltip
    contRep = 0
    
' finaliza|fffd||fffd|o geral
    Call planExibirMenus
    Call sysLog
    'Call planAtivarModoSigiloso
    Application.Visible = True
    ThisWorkbook.Close SaveChanges:=True
    
End Sub
Sub planSair()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SALVA APLICA|fffd||fffd|O E DIRECIONA ALERTA
' vari|fffd|veis
    atividade = "Logout"
    
' confirma sa|fffd|da
    Dim confirmaSaida As VbMsgBoxResult
    confirmaSaida = MsgBox("Deseja realmente encerrar a aplica|fffd||fffd|o?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaSaida = vbNo Then
        Exit Sub
        Else
        
' configura formato aplica|fffd||fffd|o
        Sheets("loading").Activate
        With Application
            .OnKey "{ESCAPE}"
            .ScreenUpdating = True
            .Wait Now + TimeValue("00:00:01")
            .Visible = False
            .Caption = ""
        End With
        
' desativa alerta de acesso |fffd| database
        If Sheets("config").Cells(1, 14) <> "" Then
            Sheets("config").Unprotect
            Sheets("config").Cells(1, 14) = ""
            Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            Else
            
        End If
        
' reseta contador de tooltip
        contRep = 0
        
' finaliza|fffd||fffd|o geral
        Call planExibirMenus
        Call sysLog
        'Call planAtivarModoSigiloso
        Application.Visible = True
        ThisWorkbook.Close SaveChanges:=True
        
    End If
    
End Sub
Sub planAtivarModoSigiloso()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA MODO SIGILOSO
' valida status de visualiza|fffd||fffd|o
    If Sheets("config").Cells(12, 5) = "Completo" Then
        Call configModoSigiloso
        Exit Sub
        Else
        
    End If
    
End Sub
Sub planDesativarModoSigiloso()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA MODO SIGILOSO
' valida status de visualiza|fffd||fffd|o
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        Call configModoSigiloso
        Exit Sub
        Else
        
    End If
    
End Sub
Sub planIntro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SAUDA|fffd||fffd|O COMPLETA
' define vari|fffd|veis
    usuario = Sheets("config").Range("E7")
    Call planSaudacao
    
End Sub
Sub planSaudacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DEFINE SAUDA|fffd||fffd|O
' vari|fffd|vel de tempo
    If Time >= "00:00:00" And Time < "12:59:59" Then
        saudacao = "Bom dia, "
        Else
        If Time >= "13:00:00" And Time < "18:59:59" Then
            saudacao = "Boa tarde, "
            Else
            If Time >= "19:00:00" And Time < "23:59:59" Then
                saudacao = "Boa noite, "
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub planOcultarMenus()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA VISUALIZA|fffd||fffd|O DE MENUS
' valida status de exibi|fffd||fffd|o atual
    If Sheets("config").Cells(3, 14) = "ON" Then
        Exit Sub
        Else
        
' configura formato aplica|fffd||fffd|o
        Sheets("config").Unprotect
        Sheets("config").Cells(3, 14) = "ON"
        
        Sheets("config").Shapes.Range(Array("icoGuiasON")).Visible = True
        Sheets("config").Shapes.Range(Array("icoGuiasOFF")).Visible = False
        Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        With Application
            .ExecuteExcel4Macro "Show.ToolBar(""Ribbon"",false)"
            .DisplayExcel4Menus = False
            .DisplayFormulaBar = False
        End With
        
    End If

End Sub
Sub planExibirMenus()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA VISUALIZA|fffd||fffd|O DE MENUS
' valida status de exibi|fffd||fffd|o atual
    If Sheets("config").Cells(3, 14) = "OFF" Then
        Exit Sub
        Else
        
' configura formato aplica|fffd||fffd|o
        Sheets("config").Unprotect
        Sheets("config").Cells(3, 14) = "OFF"
        
        Sheets("config").Shapes.Range(Array("icoGuiasON")).Visible = False
        Sheets("config").Shapes.Range(Array("icoGuiasOFF")).Visible = True
        Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        With Application
            .ExecuteExcel4Macro "Show.ToolBar(""Ribbon"",true)"
            .DisplayExcel4Menus = True
            .DisplayFormulaBar = True
        End With
        
    End If
    
End Sub
Sub planOcultarGuias()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA VISUALIZA|fffd||fffd|O DE GUIAS
' oculta tabs e headings e mant|fffd|m barra de rolagem horizontal
    With ActiveWindow
        .DisplayHorizontalScrollBar = True
        .DisplayWorkbookTabs = False
        .DisplayHeadings = False
    End With
    
End Sub
Sub planExibirGuias()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA VISUALIZA|fffd||fffd|O DE GUIAS
' exibe tabs, headings e, barra de rolagem horizontal
    With ActiveWindow
        .DisplayHorizontalScrollBar = True
        .DisplayWorkbookTabs = True
        .DisplayHeadings = True
    End With

End Sub
Sub planAjustarID()
Application.ScreenUpdating = True
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** AJUSTA AVATAR
' ajusta avatar em 2,15 cm
    Sheets("mercadoIndicadores").Unprotect
    Sheets("mercadoIndicadores").Shapes.Range(Array("logoPerfil")).LockAspectRatio = msoFalse
    Sheets("mercadoIndicadores").Shapes.Range(Array("logoPerfil")).Height = 61
    Sheets("mercadoIndicadores").Shapes.Range(Array("logoPerfil")).Width = 61
    Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub planOutlookContaAtiva()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA CONTAS OUTLOOK
' loop para identificar contas Outlook cadastradas
    Dim OutApp As Outlook.Application
    Set OutApp = CreateObject("Outlook.Application")

    For contOut = 1 To OutApp.Session.Accounts.Count
        MsgBox OutApp.Session.Accounts.item(contOut) & " : This is account number " & contOut
    Next contOut
    
End Sub
Sub LIBPLAN()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIBERA PLANILHAS
' permite edi|fffd||fffd|o de todas as planilhas
    Dim ws As Worksheet
    
    contPlan = ActiveSheet.Name
    For Each ws In Worksheets
    ws.Activate
    ws.Unprotect
    Next ws
    
    Sheets(contPlan).Activate
    
End Sub
Sub BLOQPLAN()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** BLOQUEIA PLANILHAS
' bloqueia edi|fffd||fffd|o de todas as planilhas
    Dim ws As Worksheet
    
    contPlan = ActiveSheet.Name
    For Each ws In Worksheets
    ws.Activate
    ws.Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    Next ws
    
    Sheets(contPlan).Activate
    
End Sub
Sub LOAD()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TELA DE LOADING
' ativa tela de loading
    'Sheets("loading").Activate
    Sheets("databaseCadastros").Activate
    'ActiveSheet.Unprotect
    
End Sub
Attribute VB_Name = "MS_SysTooltip"
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS BOLSAS
Sub tooltipCAN1()
    ActiveSheet.Shapes("grpCAN").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipCAN2"
End Sub
Sub tooltipCAN2()
    On Error Resume Next
    ActiveSheet.Shapes("grpCAN").Visible = False
End Sub
Sub tooltipJAP1()
    ActiveSheet.Shapes("grpJAP").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipJAP2"
End Sub
Sub tooltipJAP2()
    On Error Resume Next
    ActiveSheet.Shapes("grpJAP").Visible = False
End Sub
Sub tooltipEUA1()
    ActiveSheet.Shapes("grpEUA").Visible = True
    Application.OnTime Now + TimeValue("00:00:05"), "tooltipEUA2"
End Sub
Sub tooltipEUA2()
    On Error Resume Next
    ActiveSheet.Shapes("grpEUA").Visible = False
End Sub
Sub tooltipBRA1()
    ActiveSheet.Shapes("grpBRA").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipBRA2"
End Sub
Sub tooltipBRA2()
    On Error Resume Next
    ActiveSheet.Shapes("grpBRA").Visible = False
End Sub
Sub tooltipMEX1()
    ActiveSheet.Shapes("grpMEX").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipMEX2"
End Sub
Sub tooltipMEX2()
    On Error Resume Next
    ActiveSheet.Shapes("grpMEX").Visible = False
End Sub
Sub tooltipALE1()
    ActiveSheet.Shapes("grpALE").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipALE2"
End Sub
Sub tooltipALE2()
    On Error Resume Next
    ActiveSheet.Shapes("grpALE").Visible = False
End Sub
Sub tooltipUE1()
    ActiveSheet.Shapes("grpUE").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipUE2"
End Sub
Sub tooltipUE2()
    On Error Resume Next
    ActiveSheet.Shapes("grpUE").Visible = False
End Sub
Sub tooltipCHI1()
    ActiveSheet.Shapes("grpCHI").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipCHI2"
End Sub
Sub tooltipCHI2()
    On Error Resume Next
    ActiveSheet.Shapes("grpCHI").Visible = False
End Sub
Sub tooltipING1()
    ActiveSheet.Shapes("grpING").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipING2"
End Sub
Sub tooltipING2()
    On Error Resume Next
    ActiveSheet.Shapes("grpING").Visible = False
End Sub
Sub tooltipFRA1()
    ActiveSheet.Shapes("grpFRA").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipFRA2"
End Sub
Sub tooltipFRA2()
    On Error Resume Next
    ActiveSheet.Shapes("grpFRA").Visible = False
End Sub
Sub tooltipESP1()
    ActiveSheet.Shapes("grpESP").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipESP2"
End Sub
Sub tooltipESP2()
    On Error Resume Next
    ActiveSheet.Shapes("grpESP").Visible = False
End Sub
Sub tooltipPT1()
    ActiveSheet.Shapes("grpPT").Visible = True
    Application.OnTime Now + TimeValue("00:00:03"), "tooltipPT2"
End Sub
Sub tooltipPT2()
    On Error Resume Next
    ActiveSheet.Shapes("grpPT").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS MERCADO
Sub tooltipMercadoRadar1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRadar").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMercadoRadar2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMercadoRadar2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRadar").Visible = False
End Sub
Sub tooltipMercadoTab1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipTab").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMercadoTab2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMercadoTab2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipTab").Visible = False
End Sub
Sub tooltipMercadoIndicadores1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipIndicadores").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMercadoIndicadores2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMercadoIndicadores2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipIndicadores").Visible = False
End Sub
Sub tooltipMercadoBenchIndicadores1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipBenchIndicadores").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMercadoBenchIndicadores2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMercadoBenchIndicadores2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipBenchIndicadores").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS RADAR
Sub tooltipRadarSite1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSite").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipRadarSite2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipRadarSite2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSite").Visible = False
End Sub
Sub tooltipRadarFunc1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipFunc").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipRadarFunc2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipRadarFunc2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipFunc").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS CARTEIRA
Sub tooltipCarteiraSigiloso1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSig").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraSigiloso2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraSigiloso2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSig").Visible = False
End Sub
Sub tooltipCarteiraSigiloso3()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSig2").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraSigiloso4"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraSigiloso4()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSig2").Visible = False
End Sub

Sub tooltipCarteiraGrafExp1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipGraf1").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraGrafExp2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraGrafExp2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipGraf1").Visible = False
End Sub
Sub tooltipCarteiraGrafGer1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipGraf2").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraGrafGer2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraGrafGer2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipGraf2").Visible = False
End Sub
Sub tooltipCarteiraGrafDivGeral1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipGraf3").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraGrafDivGeral2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraGrafDivGeral2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipGraf3").Visible = False
End Sub
Sub tooltipCarteiraCaixa1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipCaixa").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraCaixa2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraCaixa2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipCaixa").Visible = False
End Sub
Sub tooltipCarteiraAcompGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraAcompGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraAcompGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipCarteiraAcompGirarGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipGirarGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraAcompGirarGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraAcompGirarGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipGirarGraf").Visible = False
End Sub
Sub tooltipCarteiraAcompTxtGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipTxtGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraAcompTxtGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraAcompTxtGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipTxtGraf").Visible = False
End Sub
Sub tooltipCarteiraOrdensEditar1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipEdit").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraOrdensEditar2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraOrdensEditar2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipEdit").Visible = False
End Sub
Sub tooltipCarteiraMetasGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraMetasGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraMetasGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipGraf").Visible = False
End Sub
Sub tooltipCarteiraMetasEditar1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipObj").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCarteiraMetasEditar2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCarteiraMetasEditar2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipObj").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS A|fffd||fffd|ES
Sub tooltipAcoesGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipAcoesRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipAcoesBitbolsa1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipBitbolsa").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesBitbolsa2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesBitbolsa2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipBitbolsa").Visible = False
End Sub
Sub tooltipAcoesRI1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRI").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesRI2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesRI2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRI").Visible = False
End Sub
Sub tooltipAcoesFundamentus1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipFundamentus").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesFundamentus2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesFundamentus2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipFundamentus").Visible = False
End Sub
Sub tooltipAcoesProv1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAno").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesProv2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesProv2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAno").Visible = False
End Sub
Sub tooltipAcoesHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipAcoesHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipAcoesHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS ETFS
Sub tooltipETFsGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipETFsGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipETFsGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipETFsRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipETFsRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipETFsRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipETFsBitbolsa1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipBitbolsa").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipETFsBitbolsa2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipETFsBitbolsa2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipBitbolsa").Visible = False
End Sub
Sub tooltipETFsSite1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSite").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipETFsSite2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipETFsSite2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSite").Visible = False
End Sub
Sub tooltipETFsHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipETFsHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipETFsHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS FIIS
Sub tooltipFIIsGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFIIsGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFIIsGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipFIIsRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFIIsRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFIIsRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipFIIsBitbolsa1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipBitbolsa").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFIIsBitbolsa2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFIIsBitbolsa2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipBitbolsa").Visible = False
End Sub
Sub tooltipFIIsSite1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSiteFII").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFIIsSite2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFIIsSite2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSiteFII").Visible = False
End Sub
Sub tooltipClubeFIIsSite1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipClubeFII").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipClubeFIIsSite2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipClubeFIIsSite2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipClubeFII").Visible = False
End Sub
Sub tooltipFIIsProv1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAno").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFIIsProv2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFIIsProv2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAno").Visible = False
End Sub
Sub tooltipFIIsHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFIIsHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFIIsHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS TESOURO
Sub tooltipTesouroGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipTesouroGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipTesouroGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipTesouroRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipTesouroRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipTesouroRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipTesouroProv1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAno").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipTesouroProv2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipTesouroProv2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAno").Visible = False
End Sub
Sub tooltipTesouroHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipTesouroHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipTesouroHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS CDBS
Sub tooltipCDBsGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCDBsGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCDBsGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipCDBsRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCDBsRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCDBsRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipCDBsSite1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSite").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCDBsSite2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCDBsSite2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSite").Visible = False
End Sub
Sub tooltipCDBsBancodata1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipBancodata").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCDBsBancodata2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCDBsBancodata2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipBancodata").Visible = False
End Sub
Sub tooltipCDBsHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCDBsHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCDBsHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS LCA/LCI
Sub tooltipLetrasGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipLetrasGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipLetrasGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipLetrasRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipLetrasRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipLetrasRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipLetrasSite1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSite").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipLetrasSite2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipLetrasSite2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSite").Visible = False
End Sub
Sub tooltipLetrasBancodata1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipBancodata").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipLetrasBancodata2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipLetrasBancodata2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipBancodata").Visible = False
End Sub
Sub tooltipLetrasHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipLetrasHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipLetrasHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS FUNDOS
Sub tooltipFundosGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFundosGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFundosGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipFundosRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFundosRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFundosRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipFundosHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipFundosHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipFundosHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS COES
Sub tooltipCOEsGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCOEsGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCOEsGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipCOEsRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCOEsRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCOEsRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipCOEsHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipCOEsHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipCOEsHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS MOEDAS ESTRANGEIRAS
Sub tooltipMoedasGraf1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipAltGraf").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMoedasGraf2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMoedasGraf2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipAltGraf").Visible = False
End Sub
Sub tooltipMoedasRotulo1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipRotulo").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMoedasRotulo2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMoedasRotulo2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipRotulo").Visible = False
End Sub
Sub tooltipMoedasHist1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipLimparHist").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipMoedasHist2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipMoedasHist2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipLimparHist").Visible = False
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS CONFIG
Sub tooltipConfigSigiloso1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipSig").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipConfigSigiloso2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipConfigSigiloso2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipSig").Visible = False
End Sub
Sub tooltipConfigLimpeza1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipClean").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipConfigLimpeza2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipConfigLimpeza2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipClean").Visible = False
End Sub
Sub tooltipConfigDatabase1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipDatabase").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipConfigDatabase2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipConfigDatabase2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipDatabase").Visible = False
End Sub
Sub tooltipConfigUpdate1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipUpdate").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipConfigUpdate2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipConfigUpdate2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipUpdate").Visible = False
End Sub
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS FERRAMENTAS
Sub tooltipLeaoInforme1()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipInforme").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltipLeaoInforme2"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltipLeaoInforme2()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipInforme").Visible = False
End Sub
Sub tooltipVal11()
    If contRep >= 6 Then
        Exit Sub
        Else
        
        ActiveSheet.Shapes("tooltipVal1").Visible = True
        Application.OnTime Now + TimeValue("00:00:02"), "tooltiVal12"
        contRep = contRep + 1
        
    End If
    
End Sub
Sub tooltiVal12()
    On Error Resume Next
    ActiveSheet.Shapes("tooltipVal1").Visible = False
End Sub




Attribute VB_Name = "MS_SysUpdate"
Sub updateValidarArquivo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA IMPORTA|fffd||fffd|ES
' cria pasta de update
    frmUpdateConfirma.Show
    
    If Len(Dir(ThisWorkbook.Path & "\update", vbDirectory)) = 0 Then
        MkDir (ThisWorkbook.Path & "\update")
        Else
        
    End If
    
' verifica se arquivo para atualiza|fffd||fffd|o est|fffd| dispon|fffd|vel
    Call updateLocalizarArquivo
    
    tempPlan = Replace(tempPlan, ThisWorkbook.Path & "\update\", "")
    tempPlan = Replace(tempPlan, ".xlsm", " (old).xlsm")
    
' se vers|fffd|o anterior n|fffd|o puder ser atualizada
    If temp = "" Then
        MsgBox "Esta vers|fffd|o n|fffd|o poder|fffd| ser atualizada. N|fffd|o foi encontrada vers|fffd|o anterior do sistema na pasta \update.", vbCritical, Replace(ThisWorkbook.Name, ".xlsm", "")
        Exit Sub
        Else
        
' retorna disponibilidade de arquivo para atualiza|fffd||fffd|o e reseta valores do formul|fffd|rio
        If temp = 1 Then
            
            If tempPlan = "Invest Masterplan (Free) (old).xlsm" Or tempPlan = "Invest Masterplan (old).xlsm" Or _
            tempPlan = "Invest Masterplan Premium (Free) (old).xlsm" Or tempPlan = "Invest Masterplan Premium (old).xlsm" Or _
            tempPlan = "Invest Masterplan Lite (Free) (old).xlsm" Or tempPlan = "Invest Masterplan Lite (old).xlsm" Then
                Call updateImportarArquivoIM
                Exit Sub
                
' arquivo para atualiza|fffd||fffd|o n|fffd|o encontrado
                Else
                MsgBox "Ops! Parce que voc|fffd| ainda n|fffd|o possui vers|fffd|o compat|fffd|vel com o sistema atual. Verifique sua pasta 'update'.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                    
            End If
        End If
    End If
    
End Sub
Sub updateLocalizarArquivo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOCALIZA VERS|fffd|O J|fffd| UTILIZADA
' vari|fffd|veis
    contUnit = 1
    planUpdate(1) = "Invest Masterplan.xlsm"
    planUpdate(2) = "Invest Masterplan (Free).xlsm"
    planUpdate(3) = "Invest Masterplan Premium (Free).xlsm"
    planUpdate(4) = "Invest Masterplan Premium.xlsm"
    planUpdate(5) = "Invest Masterplan Lite (Free).xlsm"
    planUpdate(6) = "Invest Masterplan Lite.xlsm"
    
' loop para identificar qual a vers|fffd|o antiga da aplica|fffd||fffd|o
    Do While contUnit < 7
    
' arquivo a ser localizado
    localizaArquivo = ThisWorkbook.Path & "\update\" & planUpdate(contUnit)
    
' busca arquivo na pasta local
    If Dir(localizaArquivo) = "" Then
        strcheck = False
        Else
        strcheck = True
        
    End If
    
' retorna resultado
    If strcheck = True Then
    
' arquivo existe
        temp = 1
        
' renomeia vers|fffd|o antiga para atualiza|fffd||fffd|o
        Name localizaArquivo As Replace(localizaArquivo, ".xlsm", " (old).xlsm")
        tempPlan = localizaArquivo
        
        Exit Sub
        Else
        
' arquivo n|fffd|o existe
        temp = 0
        
    End If
    
' se valor do vetor for maior que ao correspondente da vers|fffd|o atual
    contUnit = contUnit + 1
    If contUnit > 6 Then
        temp = ""
        Exit Sub
        Else
        
    End If
    Loop
    
End Sub


Attribute VB_Name = "MS_SysUpdateExport"
Sub updateExportarArquivo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
Application.DisplayAlerts = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VARI|fffd|VEIS E DEFINI|fffd||fffd|ES INICIAIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis confirma gera|fffd||fffd|o de backup
    Dim confirmaExportacao As VbMsgBoxResult
    confirmaExportacao = MsgBox("Esta opera|fffd||fffd|o ir|fffd| exportar o arquivo de backup da aplica|fffd||fffd|o e, ao final, ser|fffd| preciso reiniciar o sistema. Deseja continuar?", _
    vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
' valida exporta|fffd||fffd|o
    If confirmaExportacao = vbNo Then
        MsgBox "Exporta|fffd||fffd|o de backup abortada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' cria pasta de update
        If Len(Dir(ThisWorkbook.Path & "\update", vbDirectory)) = 0 Then
            MkDir (ThisWorkbook.Path & "\update")
            Else
            
        End If
        
' salva mudan|fffd|as antes de gerar c|fffd|pia
        Call planSairBackup
        
' exporta arquivo para pasta update e fecha aplica|fffd||fffd|o
        ThisWorkbook.SaveAs filename:=ThisWorkbook.Path & "\update\Invest Masterplan.xlsm"
        MsgBox "Arquivo de backup exportado com sucesso!" & vbNewLine & "Reinicie a aplica|fffd||fffd|o para utiliza|fffd||fffd|o normal.", _
        vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        ThisWorkbook.Close SaveChanges:=True
        Exit Sub
        
    End If
    
End Sub

Attribute VB_Name = "MS_SysUpdateImport"
Sub updateImportarArquivoIM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA SE ARQUIVO EST|fffd| ABERTO
' gerenciamento de erros
    On Error Resume Next
    
' valida|fffd||fffd|o de arquivo a ser importado
    Dim confirmaImportacao As VbMsgBoxResult
    confirmaImportacao = MsgBox("Esta opera|fffd||fffd|o ir|fffd| copiar dados de uma vers|fffd|o anterior de Invest Masterplan. A tarefa poder|fffd| levar alguns minutos e n|fffd|o poder|fffd| ser desfeita. Deseja continuar?", _
    vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaImportacao = vbNo Then
        Exit Sub
        Else
        
' verifica se arquivo a ser atualizado j|fffd| est|fffd| aberto e copia dados
        Set wb = ThisWorkbook
        Set wbImport = Application.Workbooks(tempPlan)
        
        If Err = 0 Then
        
' valida status de atualiza|fffd||fffd|o para uso da aplica|fffd||fffd|o j|fffd| aberta
            up = True
            Application.Visible = False
            Workbooks(tempPlan).Activate
            Call planDesativarModoSigiloso
            Call LIBPLAN
            
' libera edi|fffd||fffd|o geral e inicia importa|fffd||fffd|es
            ThisWorkbook.Activate
            Call LIBPLAN
            
            Set wb = ThisWorkbook
            Set wbImport = Workbooks(tempPlan)
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EFETURA IMPORTA|fffd||fffd|O DE VERS|fffd|O ANTERIOR J|fffd| ABERTA
'*************************************************************************************************************************** IMPORTA MERCADO
' define |fffd|rea para exporta|fffd||fffd|o de benchmarks
            Set wsImport = wbImport.Sheets("mercadoBenchmarks")
            wsImport.Activate
            
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("J17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:J" & contLinha)
                Set ws = wb.Sheets("mercadoBenchmarks")
                
                wsArea.Copy Destination:=ws.Range("C18")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de not|fffd|cias
            Set wsImport = wbImport.Sheets("mercadoNot|fffd|cias")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C17") <> "" Then
                contLinha = wsImport.Range("H16").End(xlDown).Row
                Set wsArea = wsImport.Range("D17:H" & contLinha)
                Set ws = wb.Sheets("mercadoNot|fffd|cias")
                wsArea.Copy Destination:=ws.Range("D17")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("J17:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("J17")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("M17:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M17")
                ws.Range("A1").Select
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA RADAR
' define |fffd|rea para exporta|fffd||fffd|o de ativos de renda vari|fffd|vel
            Set wsImport = wbImport.Sheets("ativosRadarRV")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C15") <> "" Then
                contLinha = wsImport.Range("D14").End(xlDown).Row
                Set wsArea = wsImport.Range("C15:D" & contLinha)
                Set ws = wb.Sheets("ativosRadarRV")
                wsArea.Copy Destination:=ws.Range("C15")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I15:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("I15")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de ativos de multimercado
            Set wsImport = wbImport.Sheets("ativosRadarMulti")
            wsImport.Activate
            
            If wsImport.Range("C15") <> "" Then
                contLinha = wsImport.Range("M14").End(xlDown).Row
                Set wsArea = wsImport.Range("C15:M" & contLinha)
                Set ws = wb.Sheets("ativosRadarMulti")
                
                wsArea.Copy Destination:=ws.Range("C15")
                ws.Range("A1").Select
                Else
                
            End If
                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA CARTEIRA
' define |fffd|rea para exporta|fffd||fffd|o de acompnhamento de carteira
            Set wsImport = wbImport.Sheets("carteiraAcompanha")
            wsImport.Activate
            
            If wsImport.Range("C13") <> "" Then
                contLinha = wsImport.Range("L12").End(xlDown).Row
                Set wsArea = wsImport.Range("C13:L" & contLinha)
                Set ws = wb.Sheets("carteiraAcompanha")
                wsArea.Copy Destination:=ws.Range("C13")
                
                wsImport.Range("F11").Copy Destination:=ws.Range("F11")
                ws.Range("A1").Select
            
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de registros em caixa
            Set wsImport = wbImport.Sheets("carteiraCaixa")
            wsImport.Activate
            
            If wsImport.Range("C20") <> "" Then
                contLinha = wsImport.Range("M19").End(xlDown).Row
                Set wsArea = wsImport.Range("C20:M" & contLinha)
                Set ws = wb.Sheets("carteiraCaixa")
                
                wsArea.Copy Destination:=ws.Range("C20")
                ws.Range("A1").Select
                Else
                
            End If
            
' exporta saldo atual em contas
            wsImport.Range("D13").Copy Destination:=ws.Range("D13")
            wsImport.Range("F13").Copy Destination:=ws.Range("F13")
            wsImport.Range("H13").Copy Destination:=ws.Range("H13")
            wsImport.Range("J13").Copy Destination:=ws.Range("J13")
            wsImport.Range("L13").Copy Destination:=ws.Range("L13")
            wsImport.Range("M13").Copy Destination:=ws.Range("M13")
            wsImport.Range("N13").Copy Destination:=ws.Range("N13")
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de registros de ordens pendentes
            Set wsImport = wbImport.Sheets("carteiraOp")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C5") <> "" Then
                contLinha = wsImport.Range("C4").End(xlDown).Row
                Set wsArea = wsImport.Range("C5:C" & contLinha)
                Set ws = wb.Sheets("carteiraOp")
                wsArea.Copy Destination:=ws.Range("C5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("E5:G" & contLinha)
                wsArea.Copy Destination:=ws.Range("E5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("I5:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("I5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("L5:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("L5")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de registros de proje|fffd||fffd|es e metas
            Set wsImport = wbImport.Sheets("carteiraProje|fffd||fffd|es")
            wsImport.Activate
            
            If wsImport.Range("C17") <> "" Then
                contLinha = wsImport.Range("H16").End(xlDown).Row
                Set wsArea = wsImport.Range("C17:H" & contLinha)
                Set ws = wb.Sheets("carteiraProje|fffd||fffd|es")
                
                wsArea.Copy Destination:=ws.Range("C17")
                Call carteiraProjecoesAjustarGrfAcomp
                ws.Range("A1").Select
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA OPERA|fffd||fffd|ES ESPECIAIS
' define |fffd|rea para exporta|fffd||fffd|o de registros de opera|fffd||fffd|es especiais
            Set wsImport = wbImport.Sheets("opEspeciais")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("G17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:G" & contLinha)
                Set ws = wb.Sheets("opEspeciais")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I18:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("I18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("L18:L" & contLinha)
                wsArea.Copy Destination:=ws.Range("L18")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de opera|fffd||fffd|es especiais realizadas
            Set wsImport = wbImport.Sheets("opEspeciaisExec")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C5") <> "" Then
                contLinha = wsImport.Range("G4").End(xlDown).Row
                Set wsArea = wsImport.Range("C5:G" & contLinha)
                Set ws = wb.Sheets("opEspeciaisExec")
                wsArea.Copy Destination:=ws.Range("C5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I5:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("I5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("L5:L" & contLinha)
                wsArea.Copy Destination:=ws.Range("L5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N5:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N5")
                ws.Range("A1").Select
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA A|fffd||fffd|ES
' define |fffd|rea para exporta|fffd||fffd|o de carteira de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call acoesCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de proventos de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esProventos")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C24") <> "" Then
                contLinha = wsImport.Range("C23").End(xlDown).Row
                Set wsArea = wsImport.Range("D24:E" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esProventos")
                wsArea.Copy Destination:=ws.Range("D24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G24:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K24:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("M24:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M24")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA ETFS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de etfs
            Set wsImport = wbImport.Sheets("etfsCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("etfsCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call etfsCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de etfs
            Set wsImport = wbImport.Sheets("etfsCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("etfsCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de etfs
            Set wsImport = wbImport.Sheets("etfsVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("etfsVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA FIIS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de fiis
            Set wsImport = wbImport.Sheets("fiisCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("fiisCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call fiisCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de fiis
            Set wsImport = wbImport.Sheets("fiisCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("fiisCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de fiis
            Set wsImport = wbImport.Sheets("fiisVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("fiisVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de rendimentos de fiis
            Set wsImport = wbImport.Sheets("fiisRendimentos")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C24") <> "" Then
                contLinha = wsImport.Range("C23").End(xlDown).Row
                Set wsArea = wsImport.Range("D24:E" & contLinha)
                Set ws = wb.Sheets("fiisRendimentos")
                wsArea.Copy Destination:=ws.Range("D24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G24:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K24:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("M24:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M24")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA TESOURO
' define |fffd|rea para exporta|fffd||fffd|o de carteira de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("tesouroCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabTesouroCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call tesouroCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("tesouroCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("F23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabTesouroCompras[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("tesouroVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("F23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabTesouroVendas[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de juros semestrais de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroJuros")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C24") <> "" Then
                contLinha = wsImport.Range("C23").End(xlDown).Row
                Set wsArea = wsImport.Range("D24:E" & contLinha)
                Set ws = wb.Sheets("tesouroJuros")
                wsArea.Copy Destination:=ws.Range("D24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G24:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K24:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("M24:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M24")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA CDBS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de cdbs
            Set wsImport = wbImport.Sheets("cdbsCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("cdbsCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCDBsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call cdbsCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em cdbs
            Set wsImport = wbImport.Sheets("cdbsAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("E22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:E" & contLinha)
                Set ws = wb.Sheets("cdbsAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCDBsAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de cdbs
            Set wsImport = wbImport.Sheets("cdbsResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("cdbsResgates")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCDBsResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA LETRAS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de letras de cr|fffd|dito
            Set wsImport = wbImport.Sheets("letrasCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("letrasCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabLetrasCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call letrasCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em letras de cr|fffd|dito
            Set wsImport = wbImport.Sheets("letrasAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("E22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:E" & contLinha)
                Set ws = wb.Sheets("letrasAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabLetrasAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de letras de cr|fffd|dito
            Set wsImport = wbImport.Sheets("letrasResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("letrasResgates")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabLetrasResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA FUNDOS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de fundos
            Set wsImport = wbImport.Sheets("fundosCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("fundosCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call fundosCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em fundos
            Set wsImport = wbImport.Sheets("fundosAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("L22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:E" & contLinha)
                Set ws = wb.Sheets("fundosAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabFundosAplica|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de fundos
            Set wsImport = wbImport.Sheets("fundosResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C26") <> "" Then
                contLinha = wsImport.Range("D25").End(xlDown).Row
                Set wsArea = wsImport.Range("C26:D" & contLinha)
                Set ws = wb.Sheets("fundosResgates")
                wsArea.Copy Destination:=ws.Range("C26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I26:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("I26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N26:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P26:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P26")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabFundosResgates[Data]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA COES
' define |fffd|rea para exporta|fffd||fffd|o de carteira de coes
            Set wsImport = wbImport.Sheets("coesCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("coesCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCOEsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call coesCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em coes
            Set wsImport = wbImport.Sheets("coesAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("L22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:L" & contLinha)
                Set ws = wb.Sheets("coesAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCOEsAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de coes
            Set wsImport = wbImport.Sheets("coesResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C26") <> "" Then
                contLinha = wsImport.Range("K25").End(xlDown).Row
                Set wsArea = wsImport.Range("C26:K" & contLinha)
                Set ws = wb.Sheets("coesResgates")
                wsArea.Copy Destination:=ws.Range("C26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("N26:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("P26:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P26")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCOEsResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA MOEDAS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de moedas
            Set wsImport = wbImport.Sheets("moedasCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("moedasCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call moedasCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de moedas
            Set wsImport = wbImport.Sheets("moedasCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("moedasCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("F23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de moedas
            Set wsImport = wbImport.Sheets("moedasVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("moedasVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'*************************************************************************************************************************** FINALIZA|fffd||fffd|O GERAL
' salva e fecha aplica|fffd||fffd|o mais antiga
            wbImport.Activate
            wbImport.Sheets("loading").Activate
            Call BLOQPLAN
            wbImport.Close SaveChanges:=True
            
' finaliza|fffd||fffd|o
            Sheets("loading").Activate
            MsgBox "Sistema atualizado com sucesso!" & vbNewLine & "Reinicie a aplica|fffd||fffd|o para utiliza|fffd||fffd|o completa.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Call planSairUpdate
            Exit Sub
            Else
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EFETURA IMPORTA|fffd||fffd|O DE VERS|fffd|O ANTERIOR FECHADA
'*************************************************************************************************************************** EFETUA ABERTURA DA APLICA|fffd||fffd|O ANTERIOR
' valida status de atualiza|fffd||fffd|o para abertura direta da aplica|fffd||fffd|o
            up = True
            Application.Visible = False
            Workbooks.Open (Replace(localizaArquivo, ".xlsm", " (old).xlsm"))
            Workbooks(tempPlan).Activate
            
            Call planDesativarModoSigiloso
            Call LIBPLAN
            
' libera edi|fffd||fffd|o geral e inicia importa|fffd||fffd|es
            ThisWorkbook.Activate
            Call LIBPLAN
            
            Set wb = ThisWorkbook
            Set wbImport = Workbooks(tempPlan)
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA MERCADO
' define |fffd|rea para exporta|fffd||fffd|o de benchmarks
            Set wsImport = wbImport.Sheets("mercadoBenchmarks")
            wsImport.Activate
            
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("J17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:J" & contLinha)
                Set ws = wb.Sheets("mercadoBenchmarks")
                
                wsArea.Copy Destination:=ws.Range("C18")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de not|fffd|cias
            Set wsImport = wbImport.Sheets("mercadoNot|fffd|cias")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C17") <> "" Then
                contLinha = wsImport.Range("H16").End(xlDown).Row
                Set wsArea = wsImport.Range("D17:H" & contLinha)
                Set ws = wb.Sheets("mercadoNot|fffd|cias")
                wsArea.Copy Destination:=ws.Range("D17")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("J17:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("J17")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("M17:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M17")
                ws.Range("A1").Select
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA RADAR
' define |fffd|rea para exporta|fffd||fffd|o de ativos de renda vari|fffd|vel
            Set wsImport = wbImport.Sheets("ativosRadarRV")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C15") <> "" Then
                contLinha = wsImport.Range("D14").End(xlDown).Row
                Set wsArea = wsImport.Range("C15:D" & contLinha)
                Set ws = wb.Sheets("ativosRadarRV")
                wsArea.Copy Destination:=ws.Range("C15")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I15:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("I15")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de ativos de multimercado
            Set wsImport = wbImport.Sheets("ativosRadarMulti")
            wsImport.Activate
            
            If wsImport.Range("C15") <> "" Then
                contLinha = wsImport.Range("M14").End(xlDown).Row
                Set wsArea = wsImport.Range("C15:M" & contLinha)
                Set ws = wb.Sheets("ativosRadarMulti")
                
                wsArea.Copy Destination:=ws.Range("C15")
                ws.Range("A1").Select
                Else
                
            End If
                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA CARTEIRA
' define |fffd|rea para exporta|fffd||fffd|o de acompnhamento de carteira
            Set wsImport = wbImport.Sheets("carteiraAcompanha")
            wsImport.Activate
            
            If wsImport.Range("C13") <> "" Then
                contLinha = wsImport.Range("L12").End(xlDown).Row
                Set wsArea = wsImport.Range("C13:L" & contLinha)
                Set ws = wb.Sheets("carteiraAcompanha")
                wsArea.Copy Destination:=ws.Range("C13")
                
                wsImport.Range("F11").Copy Destination:=ws.Range("F11")
                ws.Range("A1").Select
            
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de registros em caixa
            Set wsImport = wbImport.Sheets("carteiraCaixa")
            wsImport.Activate
            
            If wsImport.Range("C20") <> "" Then
                contLinha = wsImport.Range("M19").End(xlDown).Row
                Set wsArea = wsImport.Range("C20:M" & contLinha)
                Set ws = wb.Sheets("carteiraCaixa")
                
                wsArea.Copy Destination:=ws.Range("C20")
                ws.Range("A1").Select
                Else
                
            End If
            
' exporta saldo atual em contas
            wsImport.Range("D13").Copy Destination:=ws.Range("D13")
            wsImport.Range("F13").Copy Destination:=ws.Range("F13")
            wsImport.Range("H13").Copy Destination:=ws.Range("H13")
            wsImport.Range("J13").Copy Destination:=ws.Range("J13")
            wsImport.Range("L13").Copy Destination:=ws.Range("L13")
            wsImport.Range("M13").Copy Destination:=ws.Range("M13")
            wsImport.Range("N13").Copy Destination:=ws.Range("N13")
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de registros de ordens pendentes
            Set wsImport = wbImport.Sheets("carteiraOp")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C5") <> "" Then
                contLinha = wsImport.Range("C4").End(xlDown).Row
                Set wsArea = wsImport.Range("C5:C" & contLinha)
                Set ws = wb.Sheets("carteiraOp")
                wsArea.Copy Destination:=ws.Range("C5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("E5:G" & contLinha)
                wsArea.Copy Destination:=ws.Range("E5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("I5:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("I5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("L5:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("L5")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de registros de proje|fffd||fffd|es e metas
            Set wsImport = wbImport.Sheets("carteiraProje|fffd||fffd|es")
            wsImport.Activate
            
            If wsImport.Range("C17") <> "" Then
                contLinha = wsImport.Range("H16").End(xlDown).Row
                Set wsArea = wsImport.Range("C17:H" & contLinha)
                Set ws = wb.Sheets("carteiraProje|fffd||fffd|es")
                
                wsArea.Copy Destination:=ws.Range("C17")
                Call carteiraProjecoesAjustarGrfAcomp
                ws.Range("A1").Select
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA OPERA|fffd||fffd|ES ESPECIAIS
' define |fffd|rea para exporta|fffd||fffd|o de registros de opera|fffd||fffd|es especiais
            Set wsImport = wbImport.Sheets("opEspeciais")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("G17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:G" & contLinha)
                Set ws = wb.Sheets("opEspeciais")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I18:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("I18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("L18:L" & contLinha)
                wsArea.Copy Destination:=ws.Range("L18")
                ws.Range("A1").Select
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea para exporta|fffd||fffd|o de opera|fffd||fffd|es especiais realizadas
            Set wsImport = wbImport.Sheets("opEspeciaisExec")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C5") <> "" Then
                contLinha = wsImport.Range("G4").End(xlDown).Row
                Set wsArea = wsImport.Range("C5:G" & contLinha)
                Set ws = wb.Sheets("opEspeciaisExec")
                wsArea.Copy Destination:=ws.Range("C5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I5:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("I5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("L5:L" & contLinha)
                wsArea.Copy Destination:=ws.Range("L5")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N5:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N5")
                ws.Range("A1").Select
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA A|fffd||fffd|ES
' define |fffd|rea para exporta|fffd||fffd|o de carteira de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call acoesCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de proventos de a|fffd||fffd|es
            Set wsImport = wbImport.Sheets("a|fffd||fffd|esProventos")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C24") <> "" Then
                contLinha = wsImport.Range("C23").End(xlDown).Row
                Set wsArea = wsImport.Range("D24:E" & contLinha)
                Set ws = wb.Sheets("a|fffd||fffd|esProventos")
                wsArea.Copy Destination:=ws.Range("D24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G24:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K24:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("M24:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M24")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA ETFS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de etfs
            Set wsImport = wbImport.Sheets("etfsCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("etfsCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call etfsCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de etfs
            Set wsImport = wbImport.Sheets("etfsCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("etfsCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de etfs
            Set wsImport = wbImport.Sheets("etfsVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("etfsVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA FIIS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de fiis
            Set wsImport = wbImport.Sheets("fiisCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("fiisCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call fiisCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de fiis
            Set wsImport = wbImport.Sheets("fiisCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("fiisCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de fiis
            Set wsImport = wbImport.Sheets("fiisVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("fiisVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de rendimentos de fiis
            Set wsImport = wbImport.Sheets("fiisRendimentos")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C24") <> "" Then
                contLinha = wsImport.Range("C23").End(xlDown).Row
                Set wsArea = wsImport.Range("D24:E" & contLinha)
                Set ws = wb.Sheets("fiisRendimentos")
                wsArea.Copy Destination:=ws.Range("D24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G24:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K24:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("M24:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M24")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA TESOURO
' define |fffd|rea para exporta|fffd||fffd|o de carteira de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("tesouroCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabTesouroCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call tesouroCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("tesouroCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:J" & contLinha)
                wsArea.Copy Destination:=ws.Range("F23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabTesouroCompras[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("tesouroVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("F23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabTesouroVendas[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de juros semestrais de tesouro direto
            Set wsImport = wbImport.Sheets("tesouroJuros")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C24") <> "" Then
                contLinha = wsImport.Range("C23").End(xlDown).Row
                Set wsArea = wsImport.Range("D24:E" & contLinha)
                Set ws = wb.Sheets("tesouroJuros")
                wsArea.Copy Destination:=ws.Range("D24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G24:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K24:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K24")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("M24:M" & contLinha)
                wsArea.Copy Destination:=ws.Range("M24")
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA CDBS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de cdbs
            Set wsImport = wbImport.Sheets("cdbsCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("cdbsCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCDBsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call cdbsCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em cdbs
            Set wsImport = wbImport.Sheets("cdbsAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("E22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:E" & contLinha)
                Set ws = wb.Sheets("cdbsAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCDBsAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de cdbs
            Set wsImport = wbImport.Sheets("cdbsResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("cdbsResgates")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCDBsResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA LETRAS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de letras de cr|fffd|dito
            Set wsImport = wbImport.Sheets("letrasCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("letrasCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabLetrasCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call letrasCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em letras de cr|fffd|dito
            Set wsImport = wbImport.Sheets("letrasAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("E22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:E" & contLinha)
                Set ws = wb.Sheets("letrasAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabLetrasAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de letras de cr|fffd|dito
            Set wsImport = wbImport.Sheets("letrasResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("letrasResgates")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabLetrasResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA FUNDOS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de fundos
            Set wsImport = wbImport.Sheets("fundosCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("fundosCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call fundosCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em fundos
            Set wsImport = wbImport.Sheets("fundosAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("L22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:E" & contLinha)
                Set ws = wb.Sheets("fundosAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabFundosAplica|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de fundos
            Set wsImport = wbImport.Sheets("fundosResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C26") <> "" Then
                contLinha = wsImport.Range("D25").End(xlDown).Row
                Set wsArea = wsImport.Range("C26:D" & contLinha)
                Set ws = wb.Sheets("fundosResgates")
                wsArea.Copy Destination:=ws.Range("C26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("I26:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("I26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("N26:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P26:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P26")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabFundosResgates[Data]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA COES
' define |fffd|rea para exporta|fffd||fffd|o de carteira de coes
            Set wsImport = wbImport.Sheets("coesCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("coesCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("K18:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCOEsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Call coesCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de aplica|fffd||fffd|es em coes
            Set wsImport = wbImport.Sheets("coesAplic")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("L22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:L" & contLinha)
                Set ws = wb.Sheets("coesAplic")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCOEsAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de resgates de coes
            Set wsImport = wbImport.Sheets("coesResgates")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C26") <> "" Then
                contLinha = wsImport.Range("K25").End(xlDown).Row
                Set wsArea = wsImport.Range("C26:K" & contLinha)
                Set ws = wb.Sheets("coesResgates")
                wsArea.Copy Destination:=ws.Range("C26")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("N26:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("P26:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P26")
                
' restaura formata|fffd||fffd|o de datas
                ws.Range("tabCOEsResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                Else
                
            End If
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA MOEDAS
' define |fffd|rea para exporta|fffd||fffd|o de carteira de moedas
            Set wsImport = wbImport.Sheets("moedasCarteira")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C18") <> "" Then
                contLinha = wsImport.Range("C17").End(xlDown).Row
                Set wsArea = wsImport.Range("C18:C" & contLinha)
                Set ws = wb.Sheets("moedasCarteira")
                wsArea.Copy Destination:=ws.Range("C18")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F3")
                wsArea.Copy Destination:=ws.Range("F3")
                ws.Range("A1").Select
                Call moedasCarteiraAjustarGrafico
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de compras de moedas
            Set wsImport = wbImport.Sheets("moedasCompras")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("moedasCompras")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("F23:H" & contLinha)
                wsArea.Copy Destination:=ws.Range("F23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                Else
                
            End If
            
'***************************************************************************************************************************
' define |fffd|rea de exporta|fffd||fffd|o de vendas de moedas
            Set wsImport = wbImport.Sheets("moedasVendas")
            wsImport.Activate
            
' envia dados copiados para nova vers|fffd|o da planilha - parte 1
            If wsImport.Range("C23") <> "" Then
                contLinha = wsImport.Range("D22").End(xlDown).Row
                Set wsArea = wsImport.Range("C23:D" & contLinha)
                Set ws = wb.Sheets("moedasVendas")
                wsArea.Copy Destination:=ws.Range("C23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 2
                Set wsArea = wsImport.Range("G23:I" & contLinha)
                wsArea.Copy Destination:=ws.Range("G23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 3
                Set wsArea = wsImport.Range("K23:K" & contLinha)
                wsArea.Copy Destination:=ws.Range("K23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 4
                Set wsArea = wsImport.Range("N23:N" & contLinha)
                wsArea.Copy Destination:=ws.Range("N23")
                
' envia dados copiados para nova vers|fffd|o da planilha - parte 5
                Set wsArea = wsImport.Range("P23:P" & contLinha)
                wsArea.Copy Destination:=ws.Range("P23")
                Else
                
            End If
            
'*************************************************************************************************************************** FINALIZA|fffd||fffd|O GERAL
' salva e fecha aplica|fffd||fffd|o antiga
            wbImport.Activate
            wbImport.Sheets("loading").Activate
            wbImport.Close SaveChanges:=True
            
' finaliza|fffd||fffd|o geral
            Sheets("loading").Activate
            Call planResolucaoPadrao
            MsgBox "Sistema atualizado com sucesso!" & vbNewLine & "Reinicie a aplica|fffd||fffd|o para utiliza|fffd||fffd|o completa.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
            Call planSairUpdate
            Exit Sub
            
        End If
    End If
    
End Sub
Attribute VB_Name = "MS_SysVars"
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VARI|fffd|VEIS P|fffd|BLICAS
'*************************************************************************************************************************** DECLARA|fffd||fffd|O PARA IDENTIFICAR CONEX|fffd|O WEB
Public Declare PtrSafe Function InternetGetConnectedState Lib "wininet.dll" (lpdwFlags As Long, ByVal dwReserved As Long) As Boolean
    Public tipoConn As String
    
'*************************************************************************************************************************** DECLARA|fffd||fffd|O PARA IDENTIFICAR RESOLU|fffd||fffd|O E DADOS DO PC
Public Declare PtrSafe Function GetSystemMetrics Lib "user32" (ByVal whichMetric As Long) As Long
    Public Const SM_CXSCREEN As Long = 0
    Public Const SM_CYSCREEN As Long = 1
    Public resLargura, resAltura As Long
    
'*************************************************************************************************************************** VARI|fffd|VEIS EM ARRAY
    Public mesCompleto(1 To 12), mesCompletoPendente(1 To 12) As String
    Public update, planUpdate(1 To 6), updateCell(1 To 12) As String
    
'*************************************************************************************************************************** VARI|fffd|VEIS PARA LOG
    Public usuario, computador, usuarioPC, dadosPC, perfilSys, atividade, ambiente As String

'*************************************************************************************************************************** VARI|fffd|VEIS PARA VERS|fffd|ES DO SISTEMA
    Public versaoSys, versaoLimitada As String
    
'*************************************************************************************************************************** VARI|fffd|VEIS PARA FORMUL|fffd|RIOS
' cadastro e login
    Public hora As Date
    Public senha, saudacao As String
    
' valida|fffd||fffd|o de email
    Public validaEmail As VBScript_RegExp_55.RegExp
    
' formul|fffd|rios > 1920
    Public fAno, fSenha, fSenhaConfirma As String
    Public fNovaSenha, fNovaSenhaConfirma As String
    Public fEmail, fNovoEmail As String
    Public fUsuario, fNovoUsuario As String
    Public fNome, fCorretora As String
    Public fSaldo, fSaldoConta, fSaldoPoup As String

' formul|fffd|rios <1920
    Public fAnoB, fSenhaB, fSenhaConfirmaB As String
    Public fNovaSenhaB, fNovaSenhaConfirmaB As String
    Public fEmailB, fNovoEmailB As String
    Public fUsuarioB, fNovoUsuarioB As String
    Public fNomeB, fCorretoraB As String
    Public fSaldoB, fSaldoContaB, fSaldoPoupB As String

'*************************************************************************************************************************** CONFIGURA|fffd||fffd|ES
' planilhas e pastas
    Public wb, wbUpdate, wbExport, wbImport, wbOrigem, wbDestino As Workbook
    Public ws, wsUpdate, wsExport, wsImport As Worksheet
    Public wsArea As Range
    Public nomePlan As String
    
' configura|fffd||fffd|o de fotos do perfil
    Public nome, email, anexo, anexoDoc, telefone As String
    Public perfilInvest, fotoPerfil, tipoMsg, logoCorretora As String
    
' contato
    Public emailRemetente, emailDestinatario, textoMsg As String
    
'*************************************************************************************************************************** VARI|fffd|VEIS B|fffd|SICAS
' opera|fffd||fffd|es com loop
    Public contOut As Long
    Public contVal, contPlan As String
    Public contLinha, contCol, contErros, contUnit, contDB, contRep, tabLinha, validaLinha, contProg As Integer
    
' dados gen|fffd|ricos
    Public i As Integer
    Public up As Boolean
    Public ghostCell, ghostStatus, temp, tempCell, tempGhost, tempPlan, tempSaldo, tempRetorno, tempVal, tempGrf, tempPeriodo, tempMes, tempMesCompleto As String
    Public status, barraAlerta As String
    Public data, validaData As Date
    Public localizaArquivo As Variant
    Public novoLocalizaArquivo As String

' tempo de atualiza|fffd||fffd|o
    Public tempoInicial, tempoFinal, tempoTotal As Date
    
'*************************************************************************************************************************** TIPOS DE INVESTIMENTOS
' a|fffd||fffd|es
    Public logoAcao, codigoAcao, empresa, codigoAcaoPrincipal, codigoAcaoSecundaria As String
    
' fundos imobili|fffd|rios e etfs
    Public logoETF, logoFII, codigoFundo, nomeFundo, fundo As String
    
' tesouro direto
    Public logoTesouro, codigoTesouro, titulo As String
    
' cdbs, lci e lca
    Public codigoCertificado, certificado, codigoLetra, letra As String
    Public logoCDB, logoLetra As String
    
' moedas
    Public logoMoeda, codigoMoeda, moeda As String

' fundos e coes
    Public resgate  As Integer
    Public coe, nomeCOE, gestor, exposicao, classe, benchmark, alavancagem As String
    Public logoCOE, logoFundo As String
    
' outros t|fffd|tulos de renda fixa
    Public taxaAnual As Double
    Public vencimento As Date
    Public emissor, tipoTitulo, indexador As String
    
'*************************************************************************************************************************** LINKS
' links de carteira
    Public linkRI, linkETF, linkFII, linkCorretora, linkInst, linkBcoData, linkSite, nomeLink As String

'*************************************************************************************************************************** INSTITUI|fffd||fffd|ES
    Public corretora, loja As String

'*************************************************************************************************************************** OPERA|fffd||fffd|ES
' not|fffd|cias e opera|fffd||fffd|es especiais
    Public posicaoAtual As Integer
    Public dataLiquid As Date
    Public codigoAtivoNovo, codigoAtivoConvert, codigoAtivoUnit As String
    
' opera|fffd||fffd|es de compra, venda e resgate
    Public statusOperacao, validaCorretora As String
    Public alertaPrejuizo, pmCompra, puCompra, puMedio, puVenda, qtde, qtdeLimite, valorCompra, valorVenda, valorSaldo As Double
    
' opera|fffd||fffd|es de recebimento
    Public patrimonio, tipoProvento, valorIntegral, valorAplicacao, valorResgate, valorTotal, valorBruto As Double
    Public valorLiq, valorUnit, valorCota, valorCupom, valorImposto As Double

'*************************************************************************************************************************** CARTEIRA E CAIXA
' proje|fffd||fffd|es e metas
    Public prazo, tempoInvest As Integer
    Public objetivoPrincipal, objetivoSecundario As String
    Public valorMensal, grfLargura, grfLarguraUnit As Double

' opera|fffd||fffd|es financeiras em caixa
    Public destino, finalidade, origem, tipoOperacao As String
    Public saldoDisponivel, saldoEstimado, valorOperacao, fundoReserva As Double
    Public valorCC, valorPoup, valorCorretora1, valorCorretora2, valorCorretora3, valorCorretora4, valorCorretora5 As Double
    Public corretoraOrigem, corretoraDestino As String
    
' fechamento mensal
    Public dia, mes, ano, mesFechado, mesPendente, periodo, periodoPendente As String
    Public acoes, etfs, fiis, tesouro, cdb, letras, receb, fundos, coes, moedas, poupanca, caixa, reservas As Double
    
' fechamento mensal - rentabilidades
    Public rentabCarteira, rentabAcoes, rentabETFs, rentabFIIs, rentabTesouro, rentabCDBs As Double
    Public rentabLetras, rentabFundos, rentabCOEs, rentabMoedas As Double

' fechamento benchmarks
    Public rentabBenchCarteira, rentabBenchAcoes, rentabBenchFIIs, rentabBenchTesouro As Double
    
'*************************************************************************************************************************** LIQUIDA|fffd||fffd|ES
' ordens B3 pendentes de liquida|fffd||fffd|o
    Public codigoAtivo, nomeInvest, tipoInvest, tipoOrdem As String
    Public puOrdem, valorOrdem As Double

'*************************************************************************************************************************** MERCADO
' alertas de not|fffd|cias
    Public dataLimite As Date
    Public tipoNoticia As String
    Public proporcao As Double

' registros de an|fffd|lise
    Public nomeAtivo As String
    
'*************************************************************************************************************************** MERCADO COMPARA|fffd||fffd|ES
' compara|fffd||fffd|o de ativos
    Public prazoInvest As Integer
    Public IPCA, SELIC, CDI, POUP, IGPM As Double
    Public valorInvest, taxaAdm, taxaRentab, taxaRentabNominal, taxaRentabAdicional, taxaImposto As Double
    Public taxaCBLC, taxaCorretora, totalTaxas As Double

'*************************************************************************************************************************** FERRAMENTAS E OUTROS
' links
    Public barLargura As Long
    Public tipoBackup, tipoOpDatabase As String
    
    
    

Attribute VB_Name = "M_AtivosRadarMulti"
Sub ativosRadarMultiRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRO DOS DADOS DO INVESTIMENTO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("ativosRadarMulti").Cells(19, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'************************************************************************************************************************* VARI|fffd|VEIS
' vari|fffd|veis
    tipoInvest = Range("E5")
    classe = Range("E6")
    emissor = Range("J5")
    nomeAtivo = Range("J6")
    moeda = Range("J7")
    alavancagem = Range("J8")
    dataLimite = Range("J9")
    valorInvest = Range("J10")
    temp = Range("G5")
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If tipoInvest = "#Selecionar" Then
        MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("E5").Activate
        Exit Sub
        Else
        
        If classe = "#Selecionar" Then
            MsgBox "Selecione o tipo de classe do investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("E6").Activate
            Exit Sub
            Else
            
            If emissor = "#Emissor" Then
                MsgBox "Informe o nome do Emissor ou Gestor do " & temp & ".", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("J5").Activate
                Exit Sub
                Else
                
                If nomeAtivo = "#Nome do FI/COE" Then
                    MsgBox "Informe o nome do " & temp & ".", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("J6").Activate
                    Exit Sub
                    Else
                    
                    If moeda = "#Selecionar" Then
                        MsgBox "Informe a moeda de cota|fffd||fffd|o do " & temp & ".", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("J7").Activate
                        Exit Sub
                        Else
                        
                        If dataLimite < Range("A1") Then
                            MsgBox "Informe a data limite de capta|fffd||fffd|o do " & temp & ".", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("J9").Activate
                            Exit Sub
                            Else
                            
                            If valorInvest < "0" Then
                                MsgBox "Ops! Parece que o valor da aplica|fffd||fffd|o est|fffd| incorreto." & vbNewLine & _
                                "Informe um valor maior ou igual a zero.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("J10").Activate
                                Exit Sub
                                Else
                                
' verifica se ativo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                                contLinha = 15
                                Do Until Sheets("ativosRadarMulti").Cells(contLinha, 3) = "" Or Sheets("ativosRadarMulti").Cells(contLinha, 3) = temp And _
                                Sheets("ativosRadarMulti").Cells(contLinha, 4) = nomeAtivo And Sheets("ativosRadarMulti").Cells(contLinha, 8) = classe And _
                                Sheets("ativosRadarMulti").Cells(contLinha, 9) = emissor
                                contLinha = contLinha + 1
                                Loop
                                
                                If Sheets("ativosRadarMulti").Cells(contLinha, 3) = temp And Sheets("ativosRadarMulti").Cells(contLinha, 4) = nomeAtivo And _
                                Sheets("ativosRadarMulti").Cells(contLinha, 8) = classe And Sheets("ativosRadarMulti").Cells(contLinha, 9) = emissor Then
                                    MsgBox nomeAtivo & " j|fffd| est|fffd| cadastrado no Radar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    
                                End If
                                
'*************************************************************************************************************************** REGISTRO DE INVESTIMENTO
' confirma|fffd||fffd|o para registro dos dados
                                Dim confirmaRadar As VbMsgBoxResult
                                confirmaRadar = MsgBox("Deseja inserir " & nomeAtivo & " no Radar de Ativos?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                            
                                If confirmaRadar = vbNo Then
                                    Exit Sub
                                    Else
                                    
' localiza linha vazia na tabela e registra dados
                                    Sheets("ativosRadarMulti").Unprotect
                                    
                                    If Sheets("ativosRadarMulti").Cells(15, 3) = "" Then
                                        contLinha = 15
                                        Else
                                        contLinha = Sheets("ativosRadarMulti").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                        
                                    End If
                                    
                                    Sheets("ativosRadarMulti").Cells(contLinha, 3) = temp
                                    Sheets("ativosRadarMulti").Cells(contLinha, 4) = nomeAtivo
                                    Sheets("ativosRadarMulti").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                    Sheets("ativosRadarMulti").Cells(contLinha, 4).InsertIndent 2
                                    Sheets("ativosRadarMulti").Cells(contLinha, 8) = classe
                                    Sheets("ativosRadarMulti").Cells(contLinha, 9) = emissor
                                    Sheets("ativosRadarMulti").Cells(contLinha, 10) = moeda
                                    Sheets("ativosRadarMulti").Cells(contLinha, 11) = dataLimite
                                    Sheets("ativosRadarMulti").Cells(contLinha, 12) = alavancagem
                                    Sheets("ativosRadarMulti").Cells(contLinha, 13) = valorInvest
                                    
' reestabelece formato das colunas e protege tabela
                                    Range("tabAtivosRadarMulti[Capta|fffd||fffd|o]").NumberFormat = "dd/mm/yyyy"
                                    
                                    Call ativosRadarMultiClassificar
                                    Call ativosRadarMultiNovoRegistro
                                    Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    
' finaliza|fffd||fffd|o geral
                                    Range("E5").Select
                                    Call planAutoSave
                                    MsgBox "Ativo cadastrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub ativosRadarMultiNovoRegistro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVO REGISTRO
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E5") = "#Selecionar" And Range("E6") = "#Selecionar" And Range("J5") = "#Emissor" And Range("J6") = "#Nome do FI/COE" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("ativosRadarMulti").Unprotect
        
        Range("J9").FormulaR1C1 = "=TODAY()"
        Sheets("ativosRadarMulti").Cells(5, 5) = "#Selecionar"
        Sheets("ativosRadarMulti").Cells(6, 5) = "#Selecionar"
        Sheets("ativosRadarMulti").Cells(5, 10) = "#Emissor"
        Sheets("ativosRadarMulti").Cells(6, 10) = "#Nome do FI/COE"
        Sheets("ativosRadarMulti").Cells(7, 10) = "#Selecionar"
        Sheets("ativosRadarMulti").Cells(8, 10) = "Sim"
        Sheets("ativosRadarMulti").Cells(10, 10) = "0"
        
' bloqueia planilha e finaliza gera|fffd||fffd|o de registro em branco
        Range("E5").Select
        Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    End If
    
End Sub
Sub ativosRadarMultiRemover()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE ATIVOS SELECIONADOS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    contLinha = 15
    tabLinha = ((contLinha * -1) + 1) + contLinha
    nomeAtivo = Range("E13")
    
' valida tipo de remo|fffd||fffd|o ativada
    If nomeAtivo = "#Selecionar" Then
        ativosRadarMultiRemoverAtivos
        Exit Sub
        Else
        
' loop para localiza|fffd||fffd|o do ativo indicado
        Do Until Sheets("ativosRadarMulti").Cells(contLinha, 3) = "" Or Sheets("ativosRadarMulti").Cells(contLinha, 4) = nomeAtivo
        contLinha = contLinha + 1
        tabLinha = tabLinha + 1
        Loop
        
' valida|fffd|oes
        If Sheets("ativosRadarMulti").Cells(contLinha, 3) = "" Then
            MsgBox "Nenhum ativo dispon|fffd|vel para remo|fffd||fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' valida remo|fffd||fffd|o de ativo espec|fffd|fico
            Dim confirmaRemocao As VbMsgBoxResult
            confirmaRemocao = MsgBox("Deseja confirmar a exclus|fffd|o de " & nomeAtivo & " do Radar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaRemocao = vbNo Then
                Range("E13") = "#Selecionar"
                Exit Sub
                Else
                
                Sheets("ativosRadarMulti").Unprotect
                Sheets("ativosRadarMulti").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                
' define lista de ativos #Selecionar
                Sheets("ativosRadarMulti").Cells(13, 5) = "#Selecionar"
                Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' finaliza opera|fffd||fffd|es
                Call planAutoSave
                MsgBox nomeAtivo & " exclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub ativosRadarMultiRemoverAtivos()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE ATIVOS J|fffd| COMPRADOS
' vari|fffd|veis
    contLinha = 15
    tabLinha = ((contLinha * -1) + 1) + contLinha
    
' valida dados dispon|fffd|veis para remo|fffd||fffd|o
    If Sheets("ativosRadarMulti").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhum registro dispon|fffd|vel para limpeza at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Sheets("ativosRadarMulti").Cells(contLinha, 3) <> "" Then
        
' confirma|fffd||fffd|o e execu|fffd||fffd|o da limpeza
            Dim confirmaLimpeza As VbMsgBoxResult
            confirmaLimpeza = MsgBox("Deseja remover do Radar todos os ativos cadastrados?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaLimpeza = vbNo Then
                Exit Sub
                Else
                
' loop para limpeza de todas as linhas
                Sheets("ativosRadarMulti").Unprotect
                
                Do Until Sheets("ativosRadarMulti").Cells(contLinha, 3) = ""
                If Sheets("ativosRadarMulti").Cells(contLinha, 3) <> "" Then
                    
                    Sheets("ativosRadarMulti").Activate
                    Cells(contLinha, 3).Select
                    Selection.ListObject.ListRows(tabLinha).Delete
                    Else
                    
                End If
                Loop
                
' define lista de ativos #Selecionar
                Sheets("ativosRadarMulti").Cells(13, 5) = "#Selecionar"
                Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' finaliza opera|fffd||fffd|es
                Call planAutoSave
                MsgBox "Registros exclu|fffd|dos com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub ativosRadarMultiComprar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO SELECIONADO PARA COMPRA
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    nomeAtivo = Range("E13")
    
    contLinha = 15
    Do Until Sheets("ativosRadarMulti").Cells(contLinha, 3) = "" Or Sheets("ativosRadarMulti").Cells(contLinha, 4) = nomeAtivo
    contLinha = contLinha + 1
    Loop
    
    classe = Sheets("ativosRadarMulti").Cells(contLinha, 8)
    gestor = Sheets("ativosRadarMulti").Cells(contLinha, 9)
    moeda = Sheets("ativosRadarMulti").Cells(contLinha, 10)

' valida ativo selecionado
    If nomeAtivo = "#Selecionar" Or nomeAtivo = "" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' valida tipo de ativo
        If Range("E12") = "COEs" Then
            Sheets("coesAplic").Select
            Sheets("coesAplic").Cells(7, 6) = classe
            Sheets("coesAplic").Cells(5, 9) = gestor
            Sheets("coesAplic").Cells(6, 9) = nomeAtivo
            Sheets("ativosRadarMulti").Cells(13, 5) = "#Selecionar"
            Exit Sub
            Else
            
            If Range("E12") = "Fundos" Then
                Sheets("fundosAplic").Select
                Sheets("fundosAplic").Cells(6, 6) = classe
                Sheets("fundosAplic").Cells(5, 9) = gestor
                Sheets("fundosAplic").Cells(6, 9) = nomeAtivo
                Sheets("ativosRadarMulti").Cells(13, 5) = "#Selecionar"
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub ativosRadarMultiClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE RADAR
' classifica|fffd||fffd|o crescente por investimento
    ActiveWorkbook.Worksheets("ativosRadarMulti").ListObjects("tabAtivosRadarMulti").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("ativosRadarMulti").ListObjects("tabAtivosRadarMulti").Sort. _
        SortFields.Add Key:=Range("tabAtivosRadarMulti[[#Headers],[Investimento]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("ativosRadarMulti").ListObjects("tabAtivosRadarMulti").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por nome
    ActiveWorkbook.Worksheets("ativosRadarMulti").ListObjects("tabAtivosRadarMulti").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("ativosRadarMulti").ListObjects("tabAtivosRadarMulti").Sort. _
        SortFields.Add Key:=Range("tabAtivosRadarMulti[[#Headers],[Nome]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("ativosRadarMulti").ListObjects("tabAtivosRadarMulti").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_AtivosRadarRV"
Sub ativosRadarRVLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO
' vari|fffd|veis
    tipoInvest = Range("E5")
    codigoAtivo = UCase(Range("E6"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo a|fffd||fffd|es
    If tipoInvest = "A|fffd||fffd|es" Then
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
        Sheets("ativosRadarRV").logoField.Picture = LoadPicture(logoAcao)
        Exit Sub
        Else
        
' define logotipo ETFs
        If tipoInvest = "ETFs" Then
            logoETF = ThisWorkbook.Path & "\imagery\etfs\" & codigoAtivo & ".jpg"
            Sheets("ativosRadarRV").logoField.Picture = LoadPicture(logoETF)
            Exit Sub
            Else
            
' define logotipo FIIs
            If tipoInvest = "Fundos Imobili|fffd|rios" Then
                logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
                Sheets("ativosRadarRV").logoField.Picture = LoadPicture(logoFII)
                Exit Sub
                
                Else
                logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
                Sheets("ativosRadarRV").logoField.Picture = LoadPicture(logoAcao)
                Exit Sub
                
            End If
        End If
    End If
    
errorHandler:
    logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
    Sheets("ativosRadarRV").logoField.Picture = LoadPicture(logoAcao)
    
End Sub
Sub ativosRadarRVRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** INSERE ATIVO NO RADAR
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("ativosRadarRV").Cells(19, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis
    tipoInvest = Range("E5")
    codigoAtivo = UCase(Range("E6"))
    nomeAtivo = Range("J5")
    
' valida|fffd||fffd|es
    If tipoInvest = "#Selecionar" Then
        MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("E5").Activate
        Exit Sub
        Else
        
        If codigoAtivo = "#C|fffd|DIGO" Or nomeAtivo = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "C|fffd|digo do ativo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("E6").Activate
            Exit Sub
            Else
            
' localiza linha vazia e valida poss|fffd|vel duplicidade
            contLinha = 15
            Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = "" Or Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo
            contLinha = contLinha + 1
            Loop
            
            If Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo Then
                MsgBox "O ativo " & nomeAtivo & " j|fffd| est|fffd| cadastrado no Radar.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
            
' confirma|fffd||fffd|o para registro no radar
            Dim confirmaRadar As VbMsgBoxResult
            confirmaRadar = MsgBox("Deseja inserir " & nomeAtivo & " (" & codigoAtivo & ") no Radar de Ativos?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaRadar = vbNo Then
                Exit Sub
                Else
                
' localiza linha vazia na tabela de radar e registra dados
                Sheets("ativosRadarRV").Unprotect
                
                If Sheets("ativosRadarRV").Cells(15, 3) = "" Then
                    contLinha = 15
                    Else
                    contLinha = Sheets("ativosRadarRV").Cells(Rows.Count, 3).End(xlUp).Row + 1
                    
                End If
                
                Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo
                Sheets("ativosRadarRV").Cells(contLinha, 4) = tipoInvest
                Sheets("ativosRadarRV").Cells(contLinha, 9) = 0
                
                Call ativosRadarRVClassificar
                Call ativosRadarRVNovoRegistro
                Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' finaliza|fffd||fffd|o geral
                Range("E5").Select
                Call planAutoSave
                MsgBox "Ativo cadastrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub ativosRadarRVRemover()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE ATIVOS SELECIONADOS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' vari|fffd|veis
    contLinha = 15
    tabLinha = ((contLinha * -1) + 1) + contLinha
    codigoAtivo = UCase(Range("E13"))
    
' loop para localiza|fffd||fffd|o do ativo indicado
    Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = "" Or Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo
    contLinha = contLinha + 1
    tabLinha = tabLinha + 1
    Loop

' valida|fffd|oes
    If Sheets("ativosRadarRV").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhum ativo dispon|fffd|vel para remo|fffd||fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' valida remo|fffd||fffd|o de ativo espec|fffd|fico
        Dim confirmaRemocao As VbMsgBoxResult
        confirmaRemocao = MsgBox("Deseja confirmar a exclus|fffd|o de " & codigoAtivo & " do Radar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaRemocao = vbNo Then
            Range("E13") = "#C|fffd|digo"
            Exit Sub
            Else
            
            Sheets("ativosRadarRV").Unprotect
            Sheets("ativosRadarRV").Activate
            Cells(contLinha, 3).Select
            Selection.ListObject.ListRows(tabLinha).Delete

' define lista de ativos #C|fffd|digo
            Sheets("ativosRadarRV").Cells(13, 5) = "#C|fffd|digo"
            Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

' finaliza opera|fffd||fffd|es
            MsgBox "Ativo exclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
    
        End If
    End If

End Sub
Sub ativosRadarRVRemoverComprados()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE ATIVOS J|fffd| COMPRADOS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' valida exclus|fffd|o de ativo selecionado
    If Range("E13") <> "#C|fffd|digo" Then
        Call ativosRadarRVRemover
        Exit Sub
        Else

' loop para localiza|fffd||fffd|o de status comprado
        contLinha = 15
        tabLinha = ((contLinha * -1) + 1) + contLinha
        Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = "" Or Sheets("ativosRadarRV").Cells(contLinha, 14) = "COMPRADO"
        contLinha = contLinha + 1
        tabLinha = tabLinha + 1
        Loop
        
        If contLinha = 15 And Sheets("ativosRadarRV").Cells(contLinha, 3) = "" Then
            MsgBox "Nenhum registro dispon|fffd|vel para limpeza at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If Sheets("ativosRadarRV").Cells(contLinha, 14) <> "COMPRADO" Then
                MsgBox "Nenhum dos ativos cadastrados foi adquirido.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If Sheets("ativosRadarRV").Cells(contLinha, 14) = "COMPRADO" Then
                
' confirma|fffd||fffd|o e execu|fffd||fffd|o da limpeza
                    Dim confirmaLimpeza As VbMsgBoxResult
                    confirmaLimpeza = MsgBox("Deseja remover do Radar os ativos j|fffd| comprados?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaLimpeza = vbNo Then
                        Exit Sub
                        Else
    
' loop para limpeza de todas as linhas compradas
                        Sheets("ativosRadarRV").Unprotect
                        
                        Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = ""
                        If Sheets("ativosRadarRV").Cells(contLinha, 14) = "COMPRADO" Then
                            
                            Sheets("ativosRadarRV").Activate
                            Cells(contLinha, 3).Select
                            Selection.ListObject.ListRows(tabLinha).Delete
                            Else
                            
                            contLinha = contLinha + 1
                            tabLinha = tabLinha + 1
                        
                        End If
                        Loop
    
' define lista de ativos #C|fffd|digo
                        Sheets("ativosRadarRV").Cells(13, 5) = "#C|fffd|digo"
                        Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

' finaliza opera|fffd||fffd|es
                        Call planAutoSave
                        MsgBox "Registros exclu|fffd|dos com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                            
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub ativosRadarRVNovoRegistro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVO REGISTRO
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E5") = "#Selecionar" And Range("E6") = "#C|fffd|digo" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("ativosRadarRV").Cells(5, 5) = "#Selecionar"
        Sheets("ativosRadarRV").Cells(6, 5) = "#C|fffd|digo"
        Range("E5").Select
    
    End If
    
End Sub
Sub ativosRadarRVLink()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA INSTITUI|fffd||fffd|O, FUNDO OU EMPRESA
' gerenciamento de erros
    On Error GoTo errorHandler
' vari|fffd|veis
    linkSite = ActiveSheet.Range("J7")
    
' valida link e acessa site da institui|fffd||fffd|o
    If linkSite = "-" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        ThisWorkbook.FollowHyperlink Address:=linkSite
        Exit Sub
        
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel. Recomendamos que atualize sua base de dados na op|fffd||fffd|o CONFIGURA|fffd||fffd|ES > BANCO DE DADOS.", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Sub ativosRadarRVAcessarSite()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA LINK DO ATIVO PARA AN|fffd|LISE ONLINE
' vari|fffd|veis
    linkRI = Range("K13")
    linkETF = Range("K13")
    linkFII = Range("K13")

' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Fun|fffd||fffd|o indispon|fffd|vel. O 'Modo Sigiloso' est|fffd| ativado.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
    
    End If
    
' valida tipo de ativo selecionado (a|fffd||fffd|o, fii ou etf) e acessa link
    If Range("L13") = "Inativo" Then
        Exit Sub
        Else
        
        If Range("L13") = "Ajustar Teto" Or Range("J13") = "Finalizar Ajuste" Then
            Call ativosRadarRVAjustarTeto
            Exit Sub
            Else
            
            If Range("L13") = "A|fffd||fffd|es" Then
                ActiveWorkbook.FollowHyperlink Address:=linkRI
                Range("E13") = "#C|fffd|digo"
                Exit Sub
                
                Else
                If Range("L13") = "ETFS" Then
                    ActiveWorkbook.FollowHyperlink Address:=linkETF
                    Range("E13") = "#C|fffd|digo"
                    Exit Sub
                    Else
                    
                    ActiveWorkbook.FollowHyperlink Address:=linkFII
                    Range("E13") = "#C|fffd|digo"
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub ativosRadarRVAjustarTeto()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA AJUSTE DE TETOS
' libera ajuste dos valores teto dos ativos
    If Range("J13") = "" Then
        Sheets("ativosRadarRV").Unprotect
        
        ActiveSheet.Shapes.Range(Array("btnRadarExcluir")).Visible = False
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
        Sheets("ativosRadarRV").Cells(13, 10) = "Finalizar Ajuste"
        Sheets("ativosRadarRV").Range("tabAtivosRadarRV[Vlr. Teto]").Locked = False
        Sheets("ativosRadarRV").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
' finaliza ajustes
        Else
        Sheets("ativosRadarRV").Unprotect
        ActiveSheet.Shapes.Range(Array("btnRadarExcluir")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        Sheets("ativosRadarRV").Cells(13, 10) = ""
        Sheets("ativosRadarRV").Range("tabAtivosRadarRV[Vlr. Teto]").Locked = True
        Sheets("ativosRadarRV").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
    End If

End Sub
Sub ativosRadarRVComprar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO SELECIONADO PARA COMPRA
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida ativo selecionado
    codigoAtivo = UCase(Range("E13"))
    If codigoAtivo = "#C|fffd|DIGO" Or codigoAtivo = "" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' valida tipo de ativo
        If Range("E12") = "A|fffd||fffd|es" Then
            Sheets("a|fffd||fffd|esCompras").Select
            Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAtivo
            Sheets("ativosRadarRV").Cells(13, 5) = "#C|fffd|digo"
            Exit Sub
            Else
            
            If Range("E12") = "ETFs" Then
                Sheets("etfsCompras").Select
                Sheets("etfsCompras").Cells(6, 6) = codigoAtivo
                Sheets("ativosRadarRV").Cells(13, 5) = "#C|fffd|digo"
                Exit Sub
                Else
                
                If Range("E12") = "Fundos Imobili|fffd|rios" Then
                    Sheets("fiisCompras").Select
                    Sheets("fiisCompras").Cells(6, 6) = codigoAtivo
                    Sheets("ativosRadarRV").Cells(13, 5) = "#C|fffd|digo"
                    Exit Sub
                    Else
                    
                End If
            End If
        End If
    End If

End Sub
Sub ativosRadarRVClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE RADAR
' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("ativosRadarRV").ListObjects("tabAtivosRadarRV").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("ativosRadarRV").ListObjects("tabAtivosRadarRV").Sort. _
        SortFields.Add Key:=Range("tabAtivosRadarRV[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("ativosRadarRV").ListObjects("tabAtivosRadarRV").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
' classifica|fffd||fffd|o crescente por investimento
    ActiveWorkbook.Worksheets("ativosRadarRV").ListObjects("tabAtivosRadarRV").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("ativosRadarRV").ListObjects("tabAtivosRadarRV").Sort. _
        SortFields.Add Key:=Range("tabAtivosRadarRV[[#Headers],[Investimento]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("ativosRadarRV").ListObjects("tabAtivosRadarRV").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_A|fffd||fffd|esCarteira"
Sub acoesCarteira()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSAR RI DE A|fffd||fffd|ES EM CARTEIRA
' vari|fffd|veis
    On Error GoTo errorHandler
    linkRI = Range("F16")
    
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) = "" Then
        Sheets("a|fffd||fffd|esCarteira").Unprotect
        Range("F3") = 0
        Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida|fffd||fffd|o de RI |fffd|nico
    If Range("F16") = "" And Range("N16") <> "ACESSAR SITES RI" Then
        Call acoesCarteiraAtualizarCotacoes
        Exit Sub
        Else
        
        If Range("F16") <> "" And Range("N16") <> "ACESSAR SITES RI" Then
            ActiveWorkbook.FollowHyperlink Address:=linkRI
            Range("E16") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida|fffd||fffd|o de status do fechamento mensal e da carteira
            If Range("N16") = "ACESSAR SITES RI" Then
                Call acoesCarteiraAcessarRI
                Exit Sub
                Else
                
            End If
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse site est|fffd| indispon|fffd|vel.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Range("E16") = "#C|fffd|digo"
    Exit Sub
    
End Sub
Sub acoesCarteiraAtualizarCotacoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA A|fffd||fffd|ES REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida quantidade de ativos em carteira
    If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) <> "" Then
        
' array e defini|fffd||fffd|es HTML
        Dim ws As Worksheet
        Dim XMLPage As New MSXML2.XMLHTTP60
        Dim HTML As New MSHTML.HTMLDocument
        Dim dadosReferencia() As String
        Dim elemento As MSHTML.IHTMLElement
        Dim conjElementos As MSHTML.IHTMLElementCollection
        
' vari|fffd|veis
        Set wsTemp = Sheets("a|fffd||fffd|esCarteira")
        tempCell = 18
        tempAtivo = wsTemp.Cells(tempCell, 3)
        
        Set ws = Sheets("databaseWebA|fffd||fffd|es")
        contLinha = 6
        codigoAtivo = ws.Cells(contLinha, 4)
        ws.Unprotect
        
        tempoInicial = TimeValue(Now)
        contDB = Range("tabA|fffd||fffd|esCarteira").Rows.Count
        contUnit = 1
        
' loop para sincronizar ativo da carteira com a base de dados
        Do Until tempAtivo = ""
        If tempAtivo & ".SA" = codigoAtivo Then
        
' acessa site
            XMLPage.Open "GET", "https://www.reuters.com/finance/stocks/overview/" & codigoAtivo, False
            XMLPage.Send
            
' localiza dados no site e formata dados obtidos
            HTML.body.innerHTML = XMLPage.ResponseText
            Set conjElementos = HTML.getElementsByClassName("moduleBody")
            On Error Resume Next
            
            For Each elemento In conjElementos
                If elemento.className = "moduleBody" Then
                    elemento.innerText = Replace(elemento.innerText, " on Sao Paulo Stock Exchange ", "")
                    elemento.innerText = Replace(elemento.innerText, " ", "")
                    elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
                    elemento.innerText = Replace(elemento.innerText, "BRL", "")
                    elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
                    elemento.innerText = Replace(elemento.innerText, ";;", ";")
                    elemento.innerText = Replace(elemento.innerText, "+", "")
                    elemento.innerText = Replace(elemento.innerText, "--", "0,00")
                    elemento.innerText = Replace(elemento.innerText, ",", "x")
                    elemento.innerText = Replace(elemento.innerText, ".", ",")
                    elemento.innerText = Replace(elemento.innerText, "x", ".")
                    elemento.innerText = Replace(elemento.innerText, "(", ";")
                    elemento.innerText = Replace(elemento.innerText, ")", "")
                    
' preenche dados na tabela
                    dadosReferencia = Split(elemento.innerText, ";")
                    ws.Cells(contLinha, 7) = "R$" & dadosReferencia(1)
                    ws.Cells(contLinha, 8) = dadosReferencia(6)
                    ws.Cells(contLinha, 9) = dadosReferencia(5)
                    ws.Cells(contLinha, 10) = dadosReferencia(22)
                    ws.Cells(contLinha, 11) = dadosReferencia(20)
                    Exit For
                    
                End If
            Next
        
' incrementa vari|fffd|veis
            contUnit = contUnit + 1
            
            tempCell = tempCell + 1
            tempAtivo = wsTemp.Cells(tempCell, 3)
            
            contLinha = contLinha + 1
            codigoAtivo = ws.Cells(contLinha, 4)
            
' atualiza status de atualiza|fffd||fffd|o
            If Round((contUnit / contDB * 100), 2) <= 100 Then
                Application.StatusBar = "     Atualizando A|fffd||fffd|es... " & Round((contUnit / contDB * 100), 2) & "%"
                Else
                Application.StatusBar = "     Atualizando A|fffd||fffd|es... 100%"
                
            End If
            
            Else
            contLinha = contLinha + 1
            codigoAtivo = ws.Cells(contLinha, 4)
        
        End If
        Loop
        
' finaliza navegador e atualiza|fffd||fffd|es
        Application.StatusBar = "     A|fffd||fffd|es atualizadas com sucesso!"
        Application.StatusBar = ""
        
        tempoFinal = TimeValue(Now)
        tempoTotal = tempoFinal - tempoInicial
        ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
' define logotipo
        codigoAtivo = UCase(Sheets("a|fffd||fffd|esCarteira").Range("H4"))
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
        Sheets("a|fffd||fffd|esCarteira").logoField.Picture = LoadPicture(logoAcao)
        
        MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        Dim validaCarteira As VbMsgBoxResult
        validaCarteira = MsgBox("Ops! Parece que voc|fffd| ainda n|fffd|o possui a|fffd||fffd|es em sua carteira. Deseja realizar a atualiza|fffd||fffd|o geral das cota|fffd||fffd|es?", _
        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If validaCarteira = vbNo Then
            Sheets("a|fffd||fffd|esCarteira").Unprotect
            Range("F3") = 0
            Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            Exit Sub
            Else
            
            Call databaseAcoes
            MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
errorHandler:
    Exit Sub
    MsgBox "Houve um erro inesperado durante a atualiza|fffd||fffd|o. Entre em contato com o administrador do sistema", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub acoesCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  CARTEIRA
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        If tipoOperacao <> "" Then
            Exit Sub
            Else
            codigoAtivo = UCase(Sheets("a|fffd||fffd|esCarteira").Range("H4"))
            
        End If
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
        Sheets("a|fffd||fffd|esCarteira").logoField.Picture = LoadPicture(logoAcao)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
        Sheets("a|fffd||fffd|esCarteira").logoField.Picture = LoadPicture(logoAcao)
    
    End If
    
End Sub
Sub acoesComprasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO COMPRAS
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        codigoAtivo = UCase(Range("F6"))
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
        Sheets("a|fffd||fffd|esCompras").logoField.Picture = LoadPicture(logoAcao)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
        Sheets("a|fffd||fffd|esCompras").logoField.Picture = LoadPicture(logoAcao)
    
    End If
    
End Sub
Sub acoesVendasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO VENDAS
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        codigoAtivo = UCase(Range("F6"))
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
        Sheets("a|fffd||fffd|esVendas").logoField.Picture = LoadPicture(logoAcao)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
        Sheets("a|fffd||fffd|esVendas").logoField.Picture = LoadPicture(logoAcao)
    
    End If
    
End Sub
Sub acoesProventosLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO PROVENTOS
' vari|fffd|veis
    codigoAtivo = UCase(Range("N19"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
    Sheets("a|fffd||fffd|esProventos").logoField.Picture = LoadPicture(logoAcao)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
        Sheets("a|fffd||fffd|esProventos").logoField.Picture = LoadPicture(logoAcao)
    
    End If
    
End Sub
Sub acoesCarteiraAcessarRI()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACOMPANHAMENTO MENSAL DAS A|fffd||fffd|ES EM CARTEIRA
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    contLinha = 18
    contErros = 0
    contUnit = 0
    
' loop para abertura de todos os sites RI
    Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = ""
    linkRI = Cells(contLinha, 16)
    
    If linkRI = "0" Or linkRI = "" Then
        Application.Wait Now + TimeValue("00:00:02")
        contErros = contErros + 1
        contUnit = contUnit + 1
        contLinha = contLinha + 1
        
' abre todas as p|fffd|ginas de RI dos ativos em carteira
        Else
        ActiveWorkbook.FollowHyperlink Address:=linkRI
        Application.Wait Now + TimeValue("00:00:02")
        contUnit = contUnit + 1
        contLinha = contLinha + 1
        
    End If
    Loop
    
' finaliza|fffd||fffd|o
    If contErros = 0 Then
        MsgBox "Abertura de sites RI finalizada com sucesso. (" & contUnit & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
        Else
        MsgBox "Abertura de sites RI finalizada com " & contErros & " erros. (" & contUnit & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel. Recomendamos que atualize sua base de dados na op|fffd||fffd|o CONFIGURA|fffd||fffd|ES > BANCO DE DADOS.", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub acoesCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa gr|fffd|fico volum|fffd|trico
    If Range("C15") = "Anal|fffd|tico" Then
        Sheets("a|fffd||fffd|esCarteira").Unprotect
        ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esAnal|fffd|tico")).Visible = False
        Sheets("a|fffd||fffd|esCarteira").Cells(15, 3) = "Volum|fffd|trico"
        Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' ativa gr|fffd|fico anal|fffd|tico
        If Range("C15") = "Volum|fffd|trico" Then
            Sheets("a|fffd||fffd|esCarteira").Unprotect
            ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esAnal|fffd|tico")).Visible = True
            Sheets("a|fffd||fffd|esCarteira").Cells(15, 3) = "Anal|fffd|tico"
            Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub acoesCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("a|fffd||fffd|esCarteira").Unprotect
    Sheets("a|fffd||fffd|esCarteira").ChartObjects("grfA|fffd||fffd|esVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabA|fffd||fffd|esCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub acoesCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto e efetua ajustes
    If Range("C15") = "Volum|fffd|trico" Then
        Call acoesCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("a|fffd||fffd|esCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfA|fffd||fffd|esAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("a|fffd||fffd|esCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("a|fffd||fffd|esCarteira").Unprotect
                
                ActiveSheet.ChartObjects("grfA|fffd||fffd|esAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfA|fffd||fffd|esAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("a|fffd||fffd|esCarteira").Cells(4, 3) = "Com identificador"
                Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub acoesCarteiraRecompra()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS DESCONTADO PARA RECOMPRA
' vari|fffd|veis
    codigoAcao = UCase(Range("H4"))

' valida c|fffd|digo para recompra
    If codigoAcao = "" Or codigoAcao = "#C|fffd|DIGO" Or codigoAcao = "#SELECIONAR" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de compra
        Sheets("a|fffd||fffd|esCompras").Select
        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAcao

    End If
    
End Sub
Sub acoesLinkRI()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE RI DA EMPRESA SELECIONADA
' gerenciamento de erro
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkRI = Range("H7")
    
' valida link e acessa site RI
    If Range("H4") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkRI = "" Or linkRI = "Link indispon|fffd|vel" Or linkRI = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkRI
            
        End If
    End If
    Exit Sub
    
errorHandler:
    MsgBox "Ops! Parece que o link indicado est|fffd| temporariamente indispon|fffd|vel ou foi modificado.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Sub acoesLinkFundamentus()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE FUNDAMENTUS DA EMPRESA SELECIONADA
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    codigoAcao = UCase(Range("F6"))
    
' abre p|fffd|gina do site fundamentus com o c|fffd|digo da a|fffd||fffd|o
    If Range("H4") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
            
        If Range("H4") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="http://fundamentus.com.br/detalhes.php?papel=" & codigoAcao & "&x=0&y=0"
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Sub acoesLinkBitbolsa()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE BITBOLSA COM GR|fffd|FICO
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    codigoAcao = UCase(Range("F6"))
    
' abre p|fffd|gina do site bitbolsa com o c|fffd|digo da a|fffd||fffd|o
    If Range("H4") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
            
        If Range("H4") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="https://www.bitbolsa.com.br/charts/index.aspx?symbols=" & codigoAcao & "#"
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Attribute VB_Name = "M_A|fffd||fffd|esCompras"
Sub acoesComprasRegistrar()
Attribute acoesComprasRegistrar.VB_ProcData.VB_Invoke_Func = " \n14"
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE COMPRA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("a|fffd||fffd|esCompras").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    empresa = Range("H4")
    qtde = Range("E14")
    puCompra = Range("E15")
    valorCompra = Range("E18")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H17")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    data = Range("E12")
    codigoAcao = UCase(Range("F6"))
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = "Bovespa (B3)"
    finalidade = "Aumento Patrimonial"
    valorBruto = puCompra * qtde
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "A|fffd||fffd|es"
    tipoOrdem = Range("E13")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de compra j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("a|fffd||fffd|esCompras").Unprotect
        statusOperacao = "2"
        Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
        Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If empresa = "Selecione o ativo" Or empresa = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo da empresa inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de a|fffd||fffd|es inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If puCompra <= "0" Then
                        MsgBox "Pre|fffd|o unit|fffd|rio da a|fffd||fffd|o inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E15").Activate
                        Exit Sub
                        Else
                        
                        If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                            MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM PENDENTE
' valida direcionamento da ordem para lista de pend|fffd|ncias
                                    If valorCompra <= 0 Then
                                    
                                        Dim validaPendencia As VbMsgBoxResult
                                        validaPendencia = MsgBox("O valor total da ordem est|fffd| vazio." & vbNewLine & "Deseja mant|fffd|-la pendente de liquida|fffd||fffd|o?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPendencia = vbNo Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
    
' localiza linha vazia na tabela de opera|fffd||fffd|es pendentes e registra dados
                                            Sheets("carteiraOp").Unprotect
                                            Sheets("a|fffd||fffd|esCompras").Unprotect
                                            
                                            If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                contLinha = 5
                                                Else
                                                contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
                                            Sheets("carteiraOp").Cells(contLinha, 3) = data
                                            Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                            Sheets("carteiraOp").Cells(contLinha, 7) = codigoAcao
                                            Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                            Sheets("carteiraOp").Cells(contLinha, 10) = puCompra
                                            Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                            Sheets("carteiraOp").Cells(contLinha, 13) = corretora
                                            
' reestabelece formato das colunas
                                            Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                            Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraOpClassificar
                                            
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                            statusOperacao = "3"
                                            Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
    
' bloqueia planilhas em uso
' a opera|fffd||fffd|o pendente n|fffd|o ser|fffd| registrada em caixa devido ao valor da opera|fffd||fffd|o estar zerado
                                            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("a|fffd||fffd|esCompras").Activate
                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Range("F5").Select
                                            Call planAutoSave
                                            MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                        
                                        End If
                                        Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM SEM PEND|fffd|NCIA
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                        Dim confirmaCompra As VbMsgBoxResult
                                        confirmaCompra = MsgBox("Deseja confirmar a compra de " & empresa & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                    
                                        If confirmaCompra = vbNo Then
                                            Exit Sub
                                            Else
                                    
    '*************************************************************************************************************************** REGISTRA COMPRA NA TABELA
' desbloqueia planilhas em uso
                                            Sheets("a|fffd||fffd|esCarteira").Unprotect
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("a|fffd||fffd|esCompras").Unprotect
                                            
' loop para localizar linha vazia
                                            If Sheets("a|fffd||fffd|esCompras").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("a|fffd||fffd|esCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra dados na tabela
                                            Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = data
                                            Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao
                                            Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 7) = qtde
                                            Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 8) = puCompra
                                            Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 11) = valorCompra
                                            Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 14) = corretora
        
' reestabelece formato da coluna e classifica
                                            Range("tabA|fffd||fffd|esCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call acoesComprasClassificar
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE A|fffd||fffd|ES - RECOMPRA
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                            contLinha = 18
                                            Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcao
                                            contLinha = contLinha + 1
                                            Loop
                                            
' verifica|fffd||fffd|o de nova compra e recompra
                                            If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcao Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RECOMPRA EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
    
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
    
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                                statusOperacao = "1"
                                                Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esCompras").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Recompra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                                Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE A|fffd||fffd|ES - NOVA COMPRA
' registro de nova compra na carteira de a|fffd||fffd|es
                                                If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) <> codigoAcao Then
                                                    
                                                    If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) = "" Then
                                                        contLinha = 18
                                                        Else
                                                        contLinha = Sheets("a|fffd||fffd|esCarteira").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
                                                    Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcao
                                                    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                    If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) <> "" And Sheets("a|fffd||fffd|esCarteira").Cells(19, 3) = "" Then
                                                        Call acoesCarteiraAjustarGrafico
                                                        Else
                                                        
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA COMPRA EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                                    statusOperacao = "1"
                                                    Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esCompras").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Nova compra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
  
End Sub
Sub acoesComprasLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE COMPRA
' reseta valores dos campos
    Sheets("a|fffd||fffd|esCompras").Cells(14, 5) = "0"
    Sheets("a|fffd||fffd|esCompras").Cells(15, 5) = "0"
    Sheets("a|fffd||fffd|esCompras").Cells(18, 5) = "0"
    
End Sub
Sub acoesComprasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("a|fffd||fffd|esCompras").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
    ' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("a|fffd||fffd|esCompras").Cells(5, 6) = "#Selecionar"
            Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("a|fffd||fffd|esCompras").Cells(14, 5) = "0"
            Sheets("a|fffd||fffd|esCompras").Cells(15, 5) = "0"
            Sheets("a|fffd||fffd|esCompras").Cells(18, 5) = "0"
            Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("a|fffd||fffd|esCompras").Cells(5, 6) = "#Selecionar"
            Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("a|fffd||fffd|esCompras").Cells(14, 5) = "0"
            Sheets("a|fffd||fffd|esCompras").Cells(15, 5) = "0"
            Sheets("a|fffd||fffd|esCompras").Cells(18, 5) = "0"
            Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = "0"
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Range("F5").Select
            Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

        End If
    End If
    
End Sub
Sub acoesComprasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' vari|fffd|veis
    codigoAcao = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoAcao = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoAcao = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("a|fffd||fffd|esCompras").Unprotect
                Range("tabA|fffd||fffd|esCompras[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabA|fffd||fffd|esCompras").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao Then
                    Sheets("a|fffd||fffd|esCompras").Unprotect
                    Range("tabA|fffd||fffd|esCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabA|fffd||fffd|esCompras").Range.AutoFilter Field:=2, Criteria1:=codigoAcao
                    
                    Sheets("a|fffd||fffd|esCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma compra realizada para " & codigoAcao & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao Then
                    Sheets("a|fffd||fffd|esCompras").Unprotect
                    Range("tabA|fffd||fffd|esCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabA|fffd||fffd|esCompras").Range.AutoFilter Field:=2, Criteria1:=codigoAcao
                    
                    Sheets("a|fffd||fffd|esCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma compra realizada para " & codigoAcao & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If

End Sub
Sub acoesComprasLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("a|fffd||fffd|esCompras").Unprotect
        Range("tabA|fffd||fffd|esCompras[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabA|fffd||fffd|esCompras").Range.AutoFilter Field:=1
        
        Sheets("a|fffd||fffd|esCompras").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
    End If
    
End Sub
Sub acoesComprasClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("a|fffd||fffd|esCompras").ListObjects("tabA|fffd||fffd|esCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("a|fffd||fffd|esCompras").ListObjects("tabA|fffd||fffd|esCompras").Sort. _
        SortFields.Add Key:=Range("tabA|fffd||fffd|esCompras[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("a|fffd||fffd|esCompras").ListObjects("tabA|fffd||fffd|esCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("a|fffd||fffd|esCompras").ListObjects("tabA|fffd||fffd|esCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("a|fffd||fffd|esCompras").ListObjects("tabA|fffd||fffd|esCompras").Sort. _
        SortFields.Add Key:=Range("tabA|fffd||fffd|esCompras[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("a|fffd||fffd|esCompras").ListObjects("tabA|fffd||fffd|esCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_A|fffd||fffd|esProventos"
Sub acoesProventosRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVO PROVENTO
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' valida campos com dados inv|fffd|lidos
    If Range("I9") = "Erro" Or Range("M6") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("a|fffd||fffd|esProventos").Cells(33, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    empresa = Range("E6")
    validaData = Range("A1")
    
' vari|fffd|veis para registro de recebimento
    data = Range("I7")
    codigoAcao = UCase(Range("D6"))
    valorUnit = Range("I8")
    valorBruto = Range("I9")
    valorIntegral = Range("I10")
    valorLiq = Range("M6")
    patrimonio = Range("E8")
    tipoProvento = Range("I6")
    statusOperacao = Range("N4")
    barraAlerta = Range("C12")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoInvest = "A|fffd||fffd|es"
    tipoOperacao = "Recebimento"
    origem = "Proventos de Ativos"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    corretora = Range("I5")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Este recebimento j|fffd| foi cadastrado. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

        If corretora = "#Selecionar" Then
           MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
           Range("I5").Activate
           Exit Sub
           Else
                
            If empresa = "Selecione o ativo" Or empresa = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo da empresa inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("D6").Activate
                Exit Sub
                Else
                
                If tipoProvento = "#Selecionar" Then
                    MsgBox "Selecione o tipo de recebimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("I6").Activate
                    Exit Sub
                    Else
                    
                    If valorBruto <= "0" And valorIntegral <= "0" Then
                        MsgBox "Valor de recebimento inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("I10").Activate
                        Exit Sub
                        Else
                        
                        If barraAlerta = "Ops! Aconteceu um erro:" Then
                            MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Exit Sub
                            Else

' valida|fffd||fffd|o para evitar duplicidade de registro
                            contLinha = 24
                            Do Until Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 4) = data _
                            And Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAcao And Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 9) = valorBruto
                            contLinha = contLinha + 1
                            Loop
                            
                            If Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 4) = data And Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAcao And _
                            Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 9) = valorBruto Then
                                
                                Call acoesProventosNovoRecebimento
                                MsgBox "Este recebimento j|fffd| foi cadastrado. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                
                                Else
                            End If

' valida|fffd||fffd|o principal de recebimento
                            Dim confirmaRecebimento As VbMsgBoxResult
                            confirmaRecebimento = MsgBox("Deseja confirmar o recebimento de " & empresa & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                        
                            If confirmaRecebimento = vbNo Then
                                Exit Sub
                                Else
        
'*************************************************************************************************************************** REGISTRA RECEBIMENTO NA TABELA
' loop para localizar linha vazia
                                Sheets("carteiraCaixa").Unprotect
                                Sheets("a|fffd||fffd|esProventos").Unprotect
                                
' loop para localizar linha vazia
                                If Sheets("a|fffd||fffd|esProventos").Cells(24, 3) = "" Then
                                    contLinha = 24
                                    Else
                                    contLinha = Sheets("a|fffd||fffd|esProventos").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                    
                                End If
                                
' registra recebimento na tabela de proventos
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 4) = data
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAcao
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 7) = patrimonio
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 8) = tipoProvento
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 9) = valorBruto
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 11) = valorLiq
                                Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 13) = corretora

' reestabelece formato da coluna e classifica
                                Range("tabA|fffd||fffd|esProventos[Data Pgto.]").NumberFormat = "dd/mm/yyyy"
                                Call acoesProventosClassificar

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA RECEBIMENTO EM CAIXA
' tipoOperacao = "Recebimento"
' origem = "Proventos de Ativos"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                    contLinha = 20
                                    Else
                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                    
                                End If
                                
' registra provento na tabela de opera|fffd||fffd|es do caixa
                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq

' reestabelece formato da coluna e classifica
                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                Call carteiraCaixaClassificar
                                Call carteiraCaixaID

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' status 0 = em branco / em andamento
' status 1 = recebimento confirmado
' status 2 = recebimento pendente
' status 3 = erro

' finaliza opera|fffd||fffd|o e altera status do recebimento
                                Sheets("a|fffd||fffd|esProventos").Select

                                If data <= validaData Then
                                    statusOperacao = "1"
                                    Sheets("a|fffd||fffd|esProventos").Cells(4, 14) = statusOperacao
                                    
                                    Else
                                    statusOperacao = "2"
                                    Sheets("a|fffd||fffd|esProventos").Cells(4, 14) = statusOperacao
                                    
                                End If
                                
' bloqueia planilhas em uso
                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                Sheets("a|fffd||fffd|esProventos").Activate
                                Range("D6").Select
                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                
' valida modo de registro |fffd|nico ou sequencial
                                If Range("N3") = "|fffd|nico" Then
                                    Range("D6").Select
                                    Call planAutoSave
                                    MsgBox "Recebimento registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    Call acoesProventosNovoRecebimento
                                    Range("I5") = corretora
                                    MsgBox "Recebimento registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    
' finaliza|fffd||fffd|o geral
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub acoesProventosLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA RECEBIMENTO
' reseta valores dos campos
    Sheets("a|fffd||fffd|esProventos").Cells(6, 9) = "#Selecionar"
    Sheets("a|fffd||fffd|esProventos").Cells(8, 9) = "0"
    Sheets("a|fffd||fffd|esProventos").Cells(10, 9) = "0"

End Sub
Sub acoesProventosNovoRecebimento()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVO RECEBIMENTO COM ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("D6") = "#C|fffd|digo" And Range("I6") = "#Selecionar" And Range("I9") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("a|fffd||fffd|esProventos").Unprotect
        
        If Range("I9") = "Erro" Then
            Range("I8") = "0"
            Range("I10") = "0"
            
' reseta valores dos campos
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("a|fffd||fffd|esProventos").Cells(6, 4) = "#C|fffd|digo"
            Sheets("a|fffd||fffd|esProventos").Cells(5, 9) = "#Selecionar"
            Sheets("a|fffd||fffd|esProventos").Cells(6, 9) = "#Selecionar"
            Sheets("a|fffd||fffd|esProventos").Cells(8, 9) = "0"
            Sheets("a|fffd||fffd|esProventos").Cells(10, 9) = "0"
            Sheets("a|fffd||fffd|esProventos").Cells(4, 14) = "0"
            
            Range("D6").Select
            Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVO RECEBIMENTO SEM ERROS
' reseta valores dos campos
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("a|fffd||fffd|esProventos").Cells(6, 4) = "#C|fffd|digo"
            Sheets("a|fffd||fffd|esProventos").Cells(5, 9) = "#Selecionar"
            Sheets("a|fffd||fffd|esProventos").Cells(6, 9) = "#Selecionar"
            Sheets("a|fffd||fffd|esProventos").Cells(8, 9) = "0"
            Sheets("a|fffd||fffd|esProventos").Cells(10, 9) = "0"
            Sheets("a|fffd||fffd|esProventos").Cells(4, 14) = "0"
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Range("D6").Select
            Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub acoesProventosFiltrarRecebimentosAno()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RECEBIMENTOS DO ANO CORRENTE
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' vari|fffd|veis
    ano = Range("M22")
    
' valida c|fffd|digo do ativo para filtro
    Sheets("a|fffd||fffd|esProventos").Unprotect
    Range("tabA|fffd||fffd|esProventos[[#Headers],[Ano]]").Select
    ActiveSheet.ListObjects("tabA|fffd||fffd|esProventos").Range.AutoFilter Field:=1, Criteria1:=ano
    
    Sheets("a|fffd||fffd|esProventos").Cells(22, 14) = "Limpar filtro"
    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub acoesProventosFiltrarRecebimentos()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RECEBIMENTOS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' vari|fffd|veis
    codigoAcao = UCase(Range("F22"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoAcao = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoAcao = "" Then
            Range("F22") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("a|fffd||fffd|esProventos").Unprotect
                Range("tabA|fffd||fffd|esProventos[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabA|fffd||fffd|esProventos").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("F22").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 4) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 4) = codigoAcao Then
                    Sheets("a|fffd||fffd|esProventos").Unprotect
                    Range("tabA|fffd||fffd|esProventos[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabA|fffd||fffd|esProventos").Range.AutoFilter Field:=3, Criteria1:=codigoAcao
                    
                    Sheets("a|fffd||fffd|esProventos").Cells(21, 14) = "Limpar filtro"
                    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("F22").Activate
                    
                    Else
                    Range("F22") = "#C|fffd|digo"
                    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum provento recebido de " & codigoAcao & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 24
                Do Until Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAcao Then
                    Sheets("a|fffd||fffd|esProventos").Unprotect
                    Range("tabA|fffd||fffd|esProventos[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabA|fffd||fffd|esProventos").Range.AutoFilter Field:=3, Criteria1:=codigoAcao
                    
                    Sheets("a|fffd||fffd|esProventos").Cells(22, 14) = "Limpar filtro"
                    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("F22").Activate
                    Else
                    
                    Range("F22") = "#C|fffd|digo"
                    MsgBox "Nenhum provento recebido de " & codigoAcao & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub acoesProventosLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RECEBIMENTOS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N22") = "Limpar filtro" Then
        Sheets("a|fffd||fffd|esProventos").Unprotect
        Range("tabA|fffd||fffd|esProventos[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabA|fffd||fffd|esProventos").Range.AutoFilter Field:=1
        
        Sheets("a|fffd||fffd|esProventos").Cells(22, 14) = "Filtrar"
        Selection.AutoFilter
        Range("F22") = "#C|fffd|digo"
        Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("F22") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If
    
End Sub
Sub acoesProventosClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE PROVENTOS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("a|fffd||fffd|esProventos").ListObjects("tabA|fffd||fffd|esProventos").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("a|fffd||fffd|esProventos").ListObjects("tabA|fffd||fffd|esProventos").Sort. _
        SortFields.Add Key:=Range("tabA|fffd||fffd|esProventos[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("a|fffd||fffd|esProventos").ListObjects("tabA|fffd||fffd|esProventos").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de recebimento
    ActiveWorkbook.Worksheets("a|fffd||fffd|esProventos").ListObjects("tabA|fffd||fffd|esProventos").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("a|fffd||fffd|esProventos").ListObjects("tabA|fffd||fffd|esProventos").Sort. _
        SortFields.Add Key:=Range("tabA|fffd||fffd|esProventos[[#Headers],[Data Pgto.]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("a|fffd||fffd|esProventos").ListObjects("tabA|fffd||fffd|esProventos").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_A|fffd||fffd|esVendas"
Sub acoesVendasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE VENDA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("a|fffd||fffd|esVendas").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    empresa = Range("H4")
    qtde = Range("E14")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de venda
    data = Range("E12")
    codigoAcao = UCase(Range("F6"))
    pmCompra = Range("H13")

' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Venda de Ativos"
    origem = "Bovespa (B3)"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde

' vari|fffd|veis para ordens pendentes
    tipoInvest = "A|fffd||fffd|es"
    tipoOrdem = Range("E13")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de venda j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("a|fffd||fffd|esVendas").Unprotect
        statusOperacao = "2"
        Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
        Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If empresa = "Selecione o ativo" Or empresa = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo da empresa inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de a|fffd||fffd|es inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de a|fffd||fffd|es indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                    
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio da a|fffd||fffd|o inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM PENDENTE
' valida direcionamento da ordem para lista de pend|fffd|ncias
                                    If valorVenda <= 0 Then
                                    
                                        Dim validaPendencia As VbMsgBoxResult
                                        validaPendencia = MsgBox("O valor total da ordem est|fffd| vazio." & vbNewLine & "Deseja mant|fffd|-la pendente de liquida|fffd||fffd|o?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPendencia = vbNo Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** GERENCIAMENTO DE PEND|fffd|NCIA DE VENDA SEM PREJU|fffd|ZO
' valida direcionamento da ordem para lista de pend|fffd|ncias e alerta de preju|fffd|zo em ordem pendente de liquida|fffd||fffd|o
                                            If alertaPrejuizo >= "0" Then
                                            
' desbloqueia planilhas em uso
                                                Sheets("carteiraOp").Unprotect
                                                Sheets("a|fffd||fffd|esVendas").Unprotect
                                                
' localiza linha vazia na tabela de opera|fffd||fffd|es pendentes e registra dados
                                                If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                    contLinha = 5
                                                    Else
                                                    contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("carteiraOp").Cells(contLinha, 3) = data
                                                Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                                Sheets("carteiraOp").Cells(contLinha, 7) = codigoAcao
                                                Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                                Sheets("carteiraOp").Cells(contLinha, 10) = puVenda
                                                Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                                Sheets("carteiraOp").Cells(contLinha, 13) = corretora
                                                
' reestabelece formato das colunas
                                                Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                                Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraOpClassificar
                                                
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                                statusOperacao = "3"
                                                Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esVendas").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub

'*************************************************************************************************************************** GERENCIAMENTO DE PEND|fffd|NCIA DE VENDA COM PREJU|fffd|ZO
' valida direcionamento da ordem para lista de pend|fffd|ncias e alerta de preju|fffd|zo em ordem pendente de liquida|fffd||fffd|o
                                                Else

' alerta de registro da pend|fffd|ncia de venda com preju|fffd|zo
                                                Dim validaPrejuizo As VbMsgBoxResult
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else

' desbloqueia planilhas em uso
                                                    Sheets("carteiraOp").Unprotect
                                                    Sheets("a|fffd||fffd|esVendas").Unprotect
                                                    
' localiza linha vazia na tabela de opera|fffd||fffd|es pendentes e registra dados
                                                    If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                        contLinha = 5
                                                        Else
                                                        contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
                                                    Sheets("carteiraOp").Cells(contLinha, 3) = data
                                                    Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                                    Sheets("carteiraOp").Cells(contLinha, 7) = codigoAcao
                                                    Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                                    Sheets("carteiraOp").Cells(contLinha, 10) = puVenda
                                                    Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                                    Sheets("carteiraOp").Cells(contLinha, 13) = ghostCell & corretora
                                                    
' reestabelece formato das colunas
                                                    Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                                    Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraOpClassificar
                                                    
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                                    statusOperacao = "3"
                                                    Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                        
                                        Else

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM SEM PEND|fffd|NCIA
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para venda
                                        Dim confirmaVenda As VbMsgBoxResult
                                        confirmaVenda = MsgBox("Deseja confirmar a venda de " & empresa & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If confirmaVenda = vbNo Then
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA SEM PREJU|fffd|ZO
' alerta de venda sem preju|fffd|zo
                                            If alertaPrejuizo >= "0" Then
                                            
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("a|fffd||fffd|esCarteira").Unprotect
                                                Sheets("a|fffd||fffd|esVendas").Unprotect
        
' loop para localizar linha vazia
                                                If Sheets("a|fffd||fffd|esVendas").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("a|fffd||fffd|esVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra dados na tabela
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = data
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcao
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 8) = puVenda
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 7) = qtde
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 11) = valorVenda
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabA|fffd||fffd|esVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call acoesVendasClassificar
                                                
' ajusta ghostcell
                                                Call ajustaGhostCell
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE A|fffd||fffd|ES EM VENDA PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                contLinha = 18
                                                Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) = 0
                                                contLinha = contLinha + 1
                                                Loop
        
                                                If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                    Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE A|fffd||fffd|ES EM VENDA TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("a|fffd||fffd|esVendas").Unprotect
                                                    Sheets("a|fffd||fffd|esCompras").Unprotect
                                                    Sheets("a|fffd||fffd|esCarteira").Unprotect
                                                    Sheets("a|fffd||fffd|esProventos").Unprotect
                                                    Sheets("opEspeciaisExec").Unprotect
                                                    
' localiza linha com status "vendido" na carteira
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    
                                                    Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                                    
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcao And Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                        Sheets("a|fffd||fffd|esCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                    
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DA A|fffd||fffd|O VENDIDA
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao Then
                                                        Sheets("a|fffd||fffd|esCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS DA A|fffd||fffd|O VENDIDA
' deleta opera|fffd||fffd|es especiais realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 5
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAcao Then
                                                        Sheets("opEspeciaisExec").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("a|fffd||fffd|esVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
    
                                                End If
                                                Else
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de venda com preju|fffd|zo
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
                                            
'*************************************************************************************************************************** REGISTRA VENDA NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("a|fffd||fffd|esVendas").Unprotect
                                                    Sheets("a|fffd||fffd|esCarteira").Unprotect
        
' loop para localizar linha vazia
                                                    If Sheets("a|fffd||fffd|esVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("a|fffd||fffd|esVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = data
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcao
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 8) = puVenda
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 9) = pmCompra
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 11) = valorVenda
                                                    Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabA|fffd||fffd|esVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call acoesVendasClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE A|fffd||fffd|ES EM VENDA PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
            
                                                    If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                        
                                                        statusOperacao = "1"
                                                        Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("a|fffd||fffd|esVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE A|fffd||fffd|ES - VENDA TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("a|fffd||fffd|esVendas").Unprotect
                                                        Sheets("a|fffd||fffd|esCompras").Unprotect
                                                        Sheets("a|fffd||fffd|esCarteira").Unprotect
                                                        Sheets("a|fffd||fffd|esProventos").Unprotect
                                                        Sheets("opEspeciaisExec").Unprotect
                                                        
' localiza linha com status "vendido" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                        If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcao And Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                            Sheets("a|fffd||fffd|esCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DA A|fffd||fffd|O VENDIDA
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcao Then
                                                            Sheets("a|fffd||fffd|esCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS DA A|fffd||fffd|O VENDIDA
' deleta opera|fffd||fffd|es especiais realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 5
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAcao Then
                                                            Sheets("opEspeciaisExec").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAcao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                        statusOperacao = "1"
                                                        Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("a|fffd||fffd|esVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                            
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub acoesVendasLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE VENDA
' reseta valores dos campos
    Sheets("a|fffd||fffd|esVendas").Cells(14, 5) = "0"
    Sheets("a|fffd||fffd|esVendas").Cells(15, 5) = "0"
    Sheets("a|fffd||fffd|esVendas").Cells(18, 5) = "0"
    
End Sub
Sub acoesVendasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("a|fffd||fffd|esVendas").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("a|fffd||fffd|esVendas").Cells(5, 6) = "#Selecionar"
            Sheets("a|fffd||fffd|esVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("a|fffd||fffd|esVendas").Cells(14, 5) = "0"
            Sheets("a|fffd||fffd|esVendas").Cells(15, 5) = "0"
            Sheets("a|fffd||fffd|esVendas").Cells(18, 5) = "0"
            Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("a|fffd||fffd|esVendas").Cells(5, 6) = "#Selecionar"
            Sheets("a|fffd||fffd|esVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("a|fffd||fffd|esVendas").Cells(14, 5) = "0"
            Sheets("a|fffd||fffd|esVendas").Cells(15, 5) = "0"
            Sheets("a|fffd||fffd|esVendas").Cells(18, 5) = "0"
            Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

        End If
    End If
End Sub
Sub acoesLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("a|fffd||fffd|esVendas").Cells(23, 3) = "" Then
        MsgBox "Nenhuma venda total registrada at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de vendas totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("a|fffd||fffd|esVendas").Unprotect
            
            Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = ""
            If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("a|fffd||fffd|esVendas").Activate
                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de vendas removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub acoesVendasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA VENDAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' vari|fffd|veis
    codigoAcao = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoAcao = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoAcao = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("a|fffd||fffd|esVendas").Unprotect
                Range("tabA|fffd||fffd|esVendas[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabA|fffd||fffd|esVendas").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcao Then
                    Sheets("a|fffd||fffd|esVendas").Unprotect
                    Range("tabA|fffd||fffd|esVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabA|fffd||fffd|esVendas").Range.AutoFilter Field:=2, Criteria1:=codigoAcao
                    
                    Sheets("a|fffd||fffd|esVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma venda realizada para " & codigoAcao & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcao Then
                    Sheets("a|fffd||fffd|esVendas").Unprotect
                    Range("tabA|fffd||fffd|esVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabA|fffd||fffd|esVendas").Range.AutoFilter Field:=2, Criteria1:=codigoAcao
                
                    Sheets("a|fffd||fffd|esVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma venda realizada para " & codigoAcao & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub acoesVendasLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE VENDAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("a|fffd||fffd|esVendas").Unprotect
        Range("tabA|fffd||fffd|esVendas[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabA|fffd||fffd|esVendas").Range.AutoFilter Field:=1
        
        Sheets("a|fffd||fffd|esVendas").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If
    
End Sub
Sub acoesVendasClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("a|fffd||fffd|esVendas").ListObjects("tabA|fffd||fffd|esVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("a|fffd||fffd|esVendas").ListObjects("tabA|fffd||fffd|esVendas").Sort. _
        SortFields.Add Key:=Range("tabA|fffd||fffd|esVendas[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("a|fffd||fffd|esVendas").ListObjects("tabA|fffd||fffd|esVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("a|fffd||fffd|esVendas").ListObjects("tabA|fffd||fffd|esVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("a|fffd||fffd|esVendas").ListObjects("tabA|fffd||fffd|esVendas").Sort. _
        SortFields.Add Key:=Range("tabA|fffd||fffd|esVendas[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("a|fffd||fffd|esVendas").ListObjects("tabA|fffd||fffd|esVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_CDBsAplic"
Sub cdbsAplicRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE APLICA|fffd||fffd|O
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E17") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("cdbsAplic").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    certificado = Range("H4")
    emissor = Range("F6")
    qtde = Range("E15")
    puCompra = Range("E16")
    indexador = Range("I5")
    taxaAnual = Range("I6")
    vencimento = Range("I7")
    valorCompra = Range("E18")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H17")
    barraAlerta = Range("C9")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de aplica|fffd||fffd|o
    data = Range("E13")
    codigoCertificado = UCase(Range("F7"))
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = emissor
    finalidade = "Aumento Patrimonial"
    valorBruto = puCompra * qtde
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "CDBs"
    tipoOrdem = Range("E14")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de aplica|fffd||fffd|o j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("cdbsAplic").Unprotect
        statusOperacao = "2"
        Sheets("cdbsAplic").Cells(4, 14) = statusOperacao
        Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If certificado = "Selecione o emissor do t|fffd|tulo" Then
                MsgBox "Selecione o emissor do t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If indexador = "#Selecionar" Then
                    MsgBox "Selecione o indexador do t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("I5").Activate
                    Exit Sub
                    Else
                    
                    If taxaAnual <= 0 Then
                        MsgBox "Informe a taxa de rendimento anual do t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("I6").Activate
                        Exit Sub
                        Else
                        
                        If vencimento <= Range("A1") Then
                            MsgBox "Data de vencimento do t|fffd|tulo inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("I7").Activate
                            Exit Sub
                            Else
                            
                            If qtde <= "0" Then
                                MsgBox "Quantidade de t|fffd|tulos inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E15").Activate
                                Exit Sub
                                Else
                                
                                If puCompra <= "0" Then
                                    MsgBox "Pre|fffd|o unit|fffd|rio do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E16").Activate
                                    Exit Sub
                                    Else
                                    
                                    If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                                        MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("E16").Activate
                                        Exit Sub
                                        Else
                                        
                                        If valorCompra <= 0 Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
                                            
                                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                Else
                                                
                                                If data > Range("A1") Then
                                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Range("E13").Activate
                                                    Exit Sub
                                                    Else
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de aplica|fffd||fffd|o
                                                    Dim confirmaAplicacao As VbMsgBoxResult
                                                    confirmaAplicacao = MsgBox("Deseja confirmar a aplica|fffd||fffd|o em " & certificado & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                    
                                                    If confirmaAplicacao = vbNo Then
                                                        Exit Sub
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA APLICA|fffd||fffd|O NA TABELA
' loop para localizar linha vazia
                                                        Sheets("cdbsCarteira").Unprotect
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("cdbsAplic").Unprotect
                                                        
' loop para localizar linha vazia
                                                        If Sheets("cdbsAplic").Cells(23, 3) = "" Then
                                                            contLinha = 23
                                                            Else
                                                            contLinha = Sheets("cdbsAplic").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra dados na tabela
                                                        Sheets("cdbsAplic").Cells(contLinha, 3) = data
                                                        Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado
                                                        Sheets("cdbsAplic").Cells(contLinha, 5) = emissor
                                                        Sheets("cdbsAplic").Cells(contLinha, 7) = vencimento
                                                        Sheets("cdbsAplic").Cells(contLinha, 8) = indexador
                                                        Sheets("cdbsAplic").Cells(contLinha, 9) = taxaAnual
                                                        Sheets("cdbsAplic").Cells(contLinha, 10) = qtde
                                                        Sheets("cdbsAplic").Cells(contLinha, 11) = puCompra
                                                        Sheets("cdbsAplic").Cells(contLinha, 14) = corretora
                                                        
' reestabelece formato da coluna e classifica
                                                        Range("tabCDBsAplica|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Range("tabCDBsAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                        Call cdbsAplicClassificar
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE CDBS - REAPLICA|fffd||fffd|O
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo aplicado j|fffd| est|fffd| na carteira
                                                        contLinha = 18
                                                        Do Until Sheets("cdbsCarteira").Cells(contLinha, 3) = "" Or Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado
                                                        contLinha = contLinha + 1
                                                        Loop
                                                        
' verifica|fffd||fffd|o de nova aplica|fffd||fffd|o e reaplica|fffd||fffd|o
                                                        If Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado Then
                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE REAPLICA|fffd||fffd|O EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = emissor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                contLinha = 20
                                                                Else
                                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
' registra aplica|fffd||fffd|o na tabela de opera|fffd||fffd|es do caixa
                                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoCertificado
                                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                            
' reestabelece formato da coluna e ifica
                                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call carteiraCaixaClassificar
                                                            Call carteiraCaixaID
    
' finaliza registro de aplica|fffd||fffd|o e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                            If data > validaData Then
                                                                statusOperacao = "3"
                                                                Else
                                                                
                                                                statusOperacao = "1"
                                                            
                                                            End If
                                                            
                                                            Sheets("cdbsAplic").Cells(4, 14) = statusOperacao
                                                            
' bloqueia planilhas em uso
                                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("cdbsAplic").Activate
                                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            
                                                            Range("F5").Select
                                                            Call planAutoSave
                                                            MsgBox "Reaplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            
                                                            Else
                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE CDBS - NOVA APLICA|fffd||fffd|O
' registro de nova aplica|fffd||fffd|o na carteira de t|fffd|tulos
                                                            
                                                            If Sheets("cdbsCarteira").Cells(contLinha, 3) <> codigoCertificado Then
                                                                Do Until Sheets("cdbsCarteira").Cells(contLinha, 3) = ""
                                                                contLinha = contLinha + 1
                                                                Loop
                                                                
                                                                Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado
                                                                
' atualiza saldo do CDB
                                                                contLinha = 18
                                                                Do Until Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado
                                                                contLinha = contLinha + 1
                                                                Loop
                                                                
                                                                valorSaldo = Sheets("cdbsCarteira").Cells(contLinha, 11)
                                                                Sheets("cdbsCarteira").Cells(contLinha, 11) = valorBruto + valorSaldo
                                                                Range("tabCDBsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                                
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                                If Sheets("cdbsCarteira").Cells(18, 3) <> "" And Sheets("cdbsCarteira").Cells(19, 3) = "" Then
                                                                    Call cdbsCarteiraAjustarGrafico
                                                                    Else
                                                                    
                                                                End If
                                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA APLICA|fffd||fffd|O EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = emissor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                    contLinha = 20
                                                                    Else
                                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                    
                                                                End If
                                                                
' registra aplica|fffd||fffd|o na tabela de opera|fffd||fffd|es do caixa
                                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoCertificado
                                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                                
' reestabelece formato da coluna e ifica
                                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                Call carteiraCaixaClassificar
                                                                Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de aplica|fffd||fffd|o e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                If data > validaData Then
                                                                    statusOperacao = "3"
                                                                    Else
                                                                    
                                                                    statusOperacao = "1"
                                                                
                                                                End If
                                                                
                                                                Sheets("cdbsAplic").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                                Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                Sheets("cdbsAplic").Activate
                                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                
                                                                Range("F5").Select
                                                                Call planAutoSave
                                                                MsgBox "Nova aplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                Exit Sub
                                                                
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub cdbsAplicLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE APLICA|fffd||fffd|O
' reseta valores dos campos
    Sheets("cdbsAplic").Cells(14, 5) = "0"
    Sheets("cdbsAplic").Cells(15, 5) = "0"
    Sheets("cdbsAplic").Cells(18, 5) = "0"
    
End Sub
Sub cdbsAplicNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#Selecionar" And Range("E15") = 0 And Range("E16") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("cdbsAplic").Unprotect
        
        If Range("E17") = "Erro" Then
            Range("E15") = "0"
            Range("E16") = "0"
            Range("E18") = "0"
            
' reseta valores dos campos
            Range("E13").FormulaR1C1 = "=TODAY()"
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("cdbsAplic").Cells(5, 9) = "#Selecionar"
            Sheets("cdbsAplic").Cells(5, 6) = "#Selecionar"
            Sheets("cdbsAplic").Cells(6, 9) = "0"
            Sheets("cdbsAplic").Cells(15, 5) = "0"
            Sheets("cdbsAplic").Cells(16, 5) = "0"
            Sheets("cdbsAplic").Cells(18, 5) = "0"
            Sheets("cdbsAplic").Cells(4, 14) = "0"
            Sheets("cdbsAplic").Cells(6, 6) = "#Selecionar"
            
            Range("F5").Select
            Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E13").FormulaR1C1 = "=TODAY()"
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("cdbsAplic").Cells(4, 14) = "0"
            Sheets("cdbsAplic").Cells(5, 9) = "#Selecionar"
            Sheets("cdbsAplic").Cells(5, 6) = "#Selecionar"
            Sheets("cdbsAplic").Cells(6, 9) = "0"
            Sheets("cdbsAplic").Cells(15, 5) = "0"
            Sheets("cdbsAplic").Cells(16, 5) = "0"
            Sheets("cdbsAplic").Cells(18, 5) = "0"
            Sheets("cdbsAplic").Cells(6, 6) = "#Selecionar"
            
            Range("F5").Select
            Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    
End Sub
Sub cdbsAplicFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA APLICA|fffd||fffd|ES DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoCertificado = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoCertificado = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoCertificado = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("cdbsAplic").Unprotect
                Range("tabCDBsAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabCDBsAplica|fffd||fffd|es").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("cdbsAplic").Cells(contLinha, 3) = "" Or Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado
                contLinha = contLinha + 1
                Loop
                
                If Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado Then
                    Sheets("cdbsAplic").Unprotect
                    Range("tabCDBsAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabCDBsAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=codigoCertificado
                    
                    Sheets("cdbsAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada para " & codigoCertificado & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("cdbsAplic").Cells(contLinha, 3) = "" Or Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado
                contLinha = contLinha + 1
                Loop
                
                If Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado Then
                    Sheets("cdbsAplic").Unprotect
                    Range("tabCDBsAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabCDBsAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=codigoCertificado
                    
                    Sheets("cdbsAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada para " & codigoCertificado & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub cdbsAplicLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE APLICA|fffd||fffd|ES
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("cdbsAplic").Unprotect
        Range("tabCDBsAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabCDBsAplica|fffd||fffd|es").Range.AutoFilter Field:=1
        
        Sheets("cdbsAplic").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub cdbsAplicClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE APLICA|fffd||fffd|ES
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("cdbsAplic").ListObjects("tabCDBsAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("cdbsAplic").ListObjects("tabCDBsAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCDBsAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("cdbsAplic").ListObjects("tabCDBsAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de aplica|fffd||fffd|o
    ActiveWorkbook.Worksheets("cdbsAplic").ListObjects("tabCDBsAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("cdbsAplic").ListObjects("tabCDBsAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCDBsAplica|fffd||fffd|es[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("cdbsAplic").ListObjects("tabCDBsAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_CDBsCarteira"
Sub cdbsCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  CARTEIRA
' vari|fffd|veis
    codigoAtivo = UCase(Sheets("cdbsCarteira").Range("H5"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo
    logoCDB = ThisWorkbook.Path & "\imagery\bancos\" & codigoAtivo & ".jpg"
    Sheets("cdbsCarteira").logoField.Picture = LoadPicture(logoCDB)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoCDB = ThisWorkbook.Path & "\imagery\bancos\_none.jpg"
        Sheets("cdbsCarteira").logoField.Picture = LoadPicture(logoCDB)
    
    End If
    
End Sub
Sub cdbsAplicLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO APLICA|fffd||fffd|ES
' vari|fffd|veis
    codigoAtivo = UCase(Range("F6"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoCDB = ThisWorkbook.Path & "\imagery\bancos\" & codigoAtivo & ".jpg"
    Sheets("cdbsAplic").logoField.Picture = LoadPicture(logoCDB)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoCDB = ThisWorkbook.Path & "\imagery\bancos\_none.jpg"
        Sheets("cdbsAplic").logoField.Picture = LoadPicture(logoCDB)
    
    End If
    
End Sub
Sub cdbsResgatesLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO RESGATES
' vari|fffd|veis
    codigoAtivo = UCase(Range("F7"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoCDB = ThisWorkbook.Path & "\imagery\bancos\" & codigoAtivo & ".jpg"
    Sheets("cdbsResgates").logoField.Picture = LoadPicture(logoCDB)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoCDB = ThisWorkbook.Path & "\imagery\bancos\_none.jpg"
        Sheets("cdbsResgates").logoField.Picture = LoadPicture(logoCDB)
    
    End If
    
End Sub
Sub cdbsLinkBancoData()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE BANCO DATA
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkBcoData = Range("N8")
    
' valida link e acessa site Banco Data
    If Range("H4") = "Selecione o emissor do t|fffd|tulo" Then
        MsgBox "Nenhum t|fffd|tulo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkBcoData = "" Or linkBcoData = "Link indispon|fffd|vel" Or linkBcoData = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkBcoData
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub cdbsLinkInstituicao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA INSTITUI|fffd||fffd|O
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkInst = Range("N7")
    
' valida link e acessa site da institui|fffd||fffd|o
    If Range("H4") = "Selecione o emissor do t|fffd|tulo" Then
        MsgBox "Nenhum t|fffd|tulo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkInst = "" Or linkInst = "Link indispon|fffd|vel" Or linkInst = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkInst
            Exit Sub
            
        End If
    End If

errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub cdbsCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        ActiveSheet.Unprotect
        ActiveSheet.Shapes.Range(Array("grfCDBsVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfCDBsAnal|fffd|tico")).Visible = False
        Sheets("cdbsCarteira").Cells(15, 3) = "Volum|fffd|trico"
        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            ActiveSheet.Unprotect
            ActiveSheet.Shapes.Range(Array("grfCDBsVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfCDBsAnal|fffd|tico")).Visible = True
            Sheets("cdbsCarteira").Cells(15, 3) = "Anal|fffd|tico"
            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub cdbsCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("cdbsCarteira").Unprotect
    Sheets("cdbsCarteira").ChartObjects("grfCDBsVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabCDBsCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("cdbsCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub cdbsCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call cdbsCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("cdbsCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfCDBsAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("cdbsCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("cdbsCarteira").Unprotect

                ActiveSheet.ChartObjects("grfCDBsAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfCDBsAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("cdbsCarteira").Cells(4, 3) = "Com identificador"
                Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub cdbsCarteiraReaplicacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS RENT|fffd|VEL PARA REAPLICA|fffd||fffd|O
' vari|fffd|veis
    emissor = Range("H5")

' valida c|fffd|digo para recompra
    If emissor = "" Or emissor = "#C|fffd|digo" Or emissor = "#Selecionar" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de compra
        Sheets("cdbsAplic").Select
        Sheets("cdbsAplic").Cells(6, 6) = emissor

    End If
    
End Sub
Sub cdbsCarteiraLiquidarTitulos()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA TAXAS DE RENTABILIDADE
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("cdbsCarteira").Cells(18, 3) = "" Then
        Sheets("cdbsCarteira").Unprotect
        Range("F3") = 0
        Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida status de t|fffd|tulos comprados
    If Range("N16") = "AJUSTAR SALDO" Then
        Sheets("cdbsCarteira").Unprotect
        Sheets("cdbsCarteira").Cells(16, 12) = "SALVAR ALTERA|fffd||fffd|ES"
        Range("tabCDBsCarteira[Saldo]").Locked = False
        Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Range("K18").Select
        Else
        
        If Range("N16") = "SALVAR ALTERA|fffd||fffd|ES" Then
            Sheets("cdbsCarteira").Unprotect
            Sheets("cdbsCarteira").Cells(16, 12) = ""
            Range("tabCDBsCarteira").Locked = True
            Range("J16") = Range("A1")
            Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Call planAutoSave
            MsgBox "Dados atualizados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
'*************************************************************************************************************************** LIQUIDA T|fffd|TULOS VENCIDOS
' loop para encontrar t|fffd|tulos liquidados
            contLinha = 18
            Do Until Sheets("cdbsCarteira").Cells(contLinha, 3) = "" Or Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO"
            contLinha = contLinha + 1
            Loop
            
            If Sheets("cdbsCarteira").Cells(contLinha, 3) = "" Or Sheets("cdbsCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Then
                MsgBox "Nenhum t|fffd|tulo dispon|fffd|vel para liquida|fffd||fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                    
' vari|fffd|veis
                    codigoAtivo = Sheets("cdbsCarteira").Cells(contLinha, 3)
                    nomeAtivo = Sheets("cdbsCarteira").Cells(contLinha, 4) & " " & Sheets("cdbsCarteira").Cells(contLinha, 6) * 100 & "%" & _
                    " " & Sheets("cdbsCarteira").Cells(contLinha, 5)
                    
' confirma|fffd||fffd|o e execu|fffd||fffd|o da liquida|fffd||fffd|o
                    Dim confirmaLiquidacao As VbMsgBoxResult
                    confirmaLiquidacao = MsgBox("Deseja realizar a liquida|fffd||fffd|o de " & nomeAtivo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaLiquidacao = vbNo Then
                        Exit Sub
                        Else
                        
' envia ativo para tela de resgate
                        Sheets("cdbsResgates").Cells(6, 6) = codigoAtivo
                        Sheets("cdbsResgates").Activate
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub

Attribute VB_Name = "M_CDBsResgates"
Sub cdbsResgatesRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE RESGATE
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Range("H4") = "T|fffd|tulo resgatado" Then
            MsgBox "Esta ordem de resgate j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
            Sheets("cdbsResgates").Unprotect
            statusOperacao = "2"
            Sheets("cdbsResgates").Cells(4, 14) = statusOperacao
            Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            
        End If
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("cdbsResgates").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    certificado = Range("H4")
    emissor = Range("F7")
    qtde = Range("E14")
    vencimento = Range("E17")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")
    status = Range("J10")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de resgate
    data = Range("E12")
    codigoCertificado = UCase(Range("F6"))
    pmCompra = Range("H13")

' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Resgate de Ativos"
    origem = emissor
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde

' vari|fffd|veis para ordens pendentes
    tipoInvest = "CDBs"
    tipoOrdem = Range("E13")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de resgate j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("cdbsResgates").Unprotect
        statusOperacao = "2"
        Sheets("cdbsResgates").Cells(4, 14) = statusOperacao
        Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If certificado = "Selecione o t|fffd|tulo" Or certificado = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de t|fffd|tulos inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de t|fffd|tulos indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                    
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If valorVenda <= 0 Then
                                MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E18").Activate
                                Exit Sub
                                Else
                                
                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    If status <> "LIQUIDADO" Then
                                        MsgBox "O t|fffd|tulo selecionado ainda n|fffd|o est|fffd| dispon|fffd|vel para resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("F6").Activate
                                        Exit Sub
                                        Else
                                        
                                        If data > Range("A1") Then
                                            MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E12").Activate
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para resgate
                                            Dim confirmaResgate As VbMsgBoxResult
                                            confirmaResgate = MsgBox("Deseja confirmar o resgate de " & certificado & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                            
                                            If confirmaResgate = vbNo Then
                                                Exit Sub
                                                Else
                                                
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE SEM PREJU|fffd|ZO
' alerta de resgate sem preju|fffd|zo
                                                If alertaPrejuizo >= "0" Then
    
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("cdbsResgates").Unprotect
                                                    Sheets("cdbsCarteira").Unprotect
                                                    
' loop para localizar linha vazia
                                                    If Sheets("cdbsResgates").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("cdbsResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("cdbsResgates").Cells(contLinha, 3) = data
                                                    Sheets("cdbsResgates").Cells(contLinha, 4) = codigoCertificado
                                                    Sheets("cdbsResgates").Cells(contLinha, 6) = vencimento
                                                    Sheets("cdbsResgates").Cells(contLinha, 9) = pmCompra
                                                    Sheets("cdbsResgates").Cells(contLinha, 8) = puVenda
                                                    Sheets("cdbsResgates").Cells(contLinha, 7) = qtde
                                                    Sheets("cdbsResgates").Cells(contLinha, 11) = valorVenda
                                                    Sheets("cdbsResgates").Cells(contLinha, 14) = ghostCell & corretora
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCDBsResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call cdbsResgatesClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS EM RESGATE PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" _
                                                    Or Sheets("cdbsCarteira").Cells(contLinha, 9) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
                                                    
                                                    If Sheets("cdbsCarteira").Cells(contLinha, 13) <> "LIQUIDADO" And Sheets("cdbsCarteira").Cells(contLinha, 13) <> "VENDIDO" _
                                                    Or Sheets("cdbsCarteira").Cells(contLinha, 9) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoCertificado
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
                                                        
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                        statusOperacao = "1"
                                                        Sheets("cdbsResgates").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("cdbsResgates").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS EM RESGATE TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("cdbsResgates").Unprotect
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("cdbsAplic").Unprotect
                                                        Sheets("cdbsCarteira").Unprotect
                                                        
' localiza linha com status "LIQUIDADO" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" _
                                                        Or Sheets("cdbsCarteira").Cells(contLinha, 9) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de resgate total
                                                        If Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado And Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" _
                                                        Or Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado And Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" Then
                                                            Sheets("cdbsCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO T|fffd|TULO LIQUIDADO
' deleta compras realizadas com o c|fffd|digo do ativo LIQUIDADO
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("cdbsAplic").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado Then
                                                            Sheets("cdbsAplic").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                            
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoCertificado
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
    
                                                        statusOperacao = "1"
                                                        Sheets("cdbsResgates").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("cdbsResgates").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                    End If
                                                    Else
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de resgate com preju|fffd|zo
                                                    validaPrejuizo = MsgBox("Este resgate causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                    
                                                    If validaPrejuizo = vbNo Then
                                                        Exit Sub
                                                        Else
                                                        
'*************************************************************************************************************************** REGISTRA RESGATE NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("cdbsCarteira").Unprotect
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("cdbsResgates").Unprotect
    
' loop para localizar linha vazia
                                                        If Sheets("cdbsResgates").Cells(23, 3) = "" Then
                                                            contLinha = 23
                                                            Else
                                                            contLinha = Sheets("cdbsResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra dados na tabela
                                                        Sheets("cdbsResgates").Cells(contLinha, 3) = data
                                                        Sheets("cdbsResgates").Cells(contLinha, 4) = codigoCertificado
                                                        Sheets("cdbsResgates").Cells(contLinha, 6) = vencimento
                                                        Sheets("cdbsResgates").Cells(contLinha, 8) = puVenda
                                                        Sheets("cdbsResgates").Cells(contLinha, 9) = pmCompra
                                                        Sheets("cdbsResgates").Cells(contLinha, 11) = valorVenda
                                                        Sheets("cdbsResgates").Cells(contLinha, 7) = qtde
                                                        Sheets("cdbsResgates").Cells(contLinha, 14) = ghostCell & corretora
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCDBsResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call tesouroVendasClassificar
                                                        
' ajusta ghostcell
                                                        Call ajustaGhostCell
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS EM RESGATE PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                                        contLinha = 18
                                                        Do Until Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" _
                                                        Or Sheets("cdbsCarteira").Cells(contLinha, 9) = 0
                                                        contLinha = contLinha + 1
                                                        Loop
                                                        
                                                        If Sheets("cdbsCarteira").Cells(contLinha, 13) <> "LIQUIDADO" And Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" _
                                                        Or Sheets("cdbsCarteira").Cells(contLinha, 9) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                contLinha = 20
                                                                Else
                                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoCertificado
                                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call carteiraCaixaClassificar
                                                            Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                            statusOperacao = "1"
                                                            Sheets("cdbsResgates").Cells(4, 14) = statusOperacao
    
' bloqueia planilhas em uso
                                                            Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("cdbsResgates").Activate
                                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            
                                                            Range("F5").Select
                                                            Call planAutoSave
                                                            MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            
                                                            Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS - RESGATE TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                            Sheets("carteiraCaixa").Unprotect
                                                            Sheets("cdbsResgates").Unprotect
                                                            Sheets("cdbsAplic").Unprotect
                                                            Sheets("cdbsCarteira").Unprotect
                                                            
' localiza linha com status "LIQUIDADO" na carteira
                                                            contLinha = 18
                                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                                            Do Until Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" _
                                                            Or Sheets("cdbsCarteira").Cells(contLinha, 9) = 0
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                            If Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado And Sheets("cdbsCarteira").Cells(contLinha, 13) = "LIQUIDADO" _
                                                            Or Sheets("cdbsCarteira").Cells(contLinha, 3) = codigoCertificado And Sheets("cdbsCarteira").Cells(contLinha, 13) = "VENDIDO" Then
                                                                Sheets("cdbsCarteira").Activate
                                                                Cells(contLinha, 3).Select
                                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                                Else
                                                            
                                                            End If
                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO T|fffd|TULO LIQUIDADO
' deleta compras realizadas com o c|fffd|digo do ativo LIQUIDADO
                                                            contLinha = 23
                                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                                            Do Until Sheets("cdbsAplic").Cells(contLinha, 3) = ""
                                                            
                                                            If Sheets("cdbsAplic").Cells(contLinha, 4) = codigoCertificado Then
                                                                Sheets("cdbsAplic").Activate
                                                                Cells(contLinha, 3).Select
                                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                                
                                                                Else
                                                                contLinha = contLinha + 1
                                                                tabLinha = tabLinha + 1
                                                                
                                                            End If
                                                            Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                contLinha = 20
                                                                Else
                                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoCertificado
                                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call carteiraCaixaClassificar
                                                            Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                        
                                                            statusOperacao = "1"
                                                            Sheets("cdbsResgates").Cells(4, 14) = statusOperacao
                                                            
' bloqueia planilhas em uso
                                                            Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("cdbsResgates").Activate
                                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            
                                                            Range("F5").Select
                                                            Call planAutoSave
                                                            MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub cdbsResgatesLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE RESGATE
' reseta valores dos campos
    Sheets("cdbsResgates").Cells(14, 5) = "0"
    Sheets("cdbsResgates").Cells(15, 5) = "0"
    Sheets("cdbsResgates").Cells(18, 5) = "0"
    
End Sub
Sub cdbsResgatesNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("cdbsResgates").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("cdbsResgates").Cells(5, 6) = "#Selecionar"
            Sheets("cdbsResgates").Cells(6, 6) = "#C|fffd|digo"
            Sheets("cdbsResgates").Cells(14, 5) = "0"
            Sheets("cdbsResgates").Cells(15, 5) = "0"
            Sheets("cdbsResgates").Cells(18, 5) = "0"
            Sheets("cdbsResgates").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("cdbsResgates").Cells(5, 6) = "#Selecionar"
            Sheets("cdbsResgates").Cells(6, 6) = "#C|fffd|digo"
            Sheets("cdbsResgates").Cells(14, 5) = "0"
            Sheets("cdbsResgates").Cells(15, 5) = "0"
            Sheets("cdbsResgates").Cells(18, 5) = "0"
            Sheets("cdbsResgates").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub cdbsLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("cdbsResgates").Cells(23, 3) = "" Then
        MsgBox "Nenhum resgate total registrado at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de resgates totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("cdbsResgates").Unprotect
            
            Do Until Sheets("cdbsResgates").Cells(contLinha, 3) = ""
            If Sheets("cdbsResgates").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("cdbsResgates").Activate
                Sheets("cdbsResgates").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de resgates removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub cdbsResgatesFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RESGATES DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoCertificado = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoCertificado = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoCertificado = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("cdbsResgates").Unprotect
                Range("tabCDBsResgates[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabCDBsResgates").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("cdbsResgates").Cells(contLinha, 3) = "" Or Sheets("cdbsResgates").Cells(contLinha, 4) = codigoCertificado
                contLinha = contLinha + 1
                Loop
                
                If Sheets("cdbsResgates").Cells(contLinha, 4) = codigoCertificado Then
                    Sheets("cdbsResgates").Unprotect
                    Range("tabCDBsResgates[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabCDBsResgates").Range.AutoFilter Field:=2, Criteria1:=codigoCertificado
                    
                    Sheets("cdbsResgates").Cells(21, 14) = "Limpar filtro"
                    Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum resgate realizado para " & codigoCertificado & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("cdbsResgates").Cells(contLinha, 3) = "" Or Sheets("cdbsResgates").Cells(contLinha, 4) = codigoCertificado
                contLinha = contLinha + 1
                Loop
                
                If Sheets("cdbsResgates").Cells(contLinha, 4) = codigoCertificado Then
                    Sheets("cdbsResgates").Unprotect
                    Range("tabCDBsResgates[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabCDBsResgates").Range.AutoFilter Field:=2, Criteria1:=codigoCertificado
                    
                    Sheets("cdbsResgates").Cells(21, 14) = "Limpar filtro"
                    Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhum resgate realizado para " & codigoCertificado & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub cdbsResgatesLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RESGATES
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("cdbsResgates").Unprotect
        Range("tabCDBsResgates[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabCDBsResgates").Range.AutoFilter Field:=1
        
        Sheets("cdbsResgates").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub cdbsResgatesClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("cdbsResgates").ListObjects("tabCDBsResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("cdbsResgates").ListObjects("tabCDBsResgates").Sort. _
        SortFields.Add Key:=Range("tabCDBsResgates[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("cdbsResgates").ListObjects("tabCDBsResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("cdbsResgates").ListObjects("tabCDBsResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("cdbsResgates").ListObjects("tabCDBsResgates").Sort. _
        SortFields.Add Key:=Range("tabCDBsResgates[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("cdbsResgates").ListObjects("tabCDBsResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_COEsAplic"
Sub coesAplicacoesRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE APLICA|fffd||fffd|O
'*************************************************************************************************************************** VARI|fffd|VEIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("coesAplic").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    emissor = Range("I5")
    coe = Range("I6")
    exposicao = Range("F6")
    classe = Range("F7")
    benchmark = Range("F8")
    moeda = Range("F8")
    vencimento = Range("F9")
    valorAplicacao = Range("E17")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H18")
    barraAlerta = Range("C11")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    validaData = Range("A1")
    data = Range("E15")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = emissor
    finalidade = "Aumento Patrimonial"
    valorBruto = valorAplicacao
    valorCompra = valorAplicacao
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "COEs"
    tipoOrdem = Range("E16")
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de aplica|fffd||fffd|o j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("coesAplic").Unprotect
        statusOperacao = "2"
        Sheets("coesAplic").Cells(4, 14) = statusOperacao
        Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If exposicao = "#Selecionar" Then
                MsgBox "Selecione o tipo de exposi|fffd||fffd|o do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If classe = "#Selecionar" Then
                    MsgBox "Selecione a classe do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("F7").Activate
                    Exit Sub
                    Else
                    
                    If Range("E8") = "Benchmark:" And benchmark = "#Selecionar" Then
                        MsgBox "Selecione o benchmark do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("F8").Activate
                        Exit Sub
                        Else
                        
                        If Range("E8") = "Moeda:" And moeda = "#Selecionar" Then
                            MsgBox "Selecione o moeda de cota|fffd||fffd|o do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("F8").Activate
                            Exit Sub
                            Else
                            
                            If vencimento <= Range("A1") Then
                                MsgBox "Data de vencimento do t|fffd|tulo inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("F9").Activate
                                Exit Sub
                                Else
                                
                                If emissor = "#Emissor" Then
                                    MsgBox "Informe qual o emissor do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("I5").Activate
                                    Exit Sub
                                    Else
                                    
                                    If Range("I5") <= 5 Then
                                        MsgBox "Ops! Parece que o nome do emissor est|fffd| muito pequeno.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("I5").Activate
                                        Exit Sub
                                        Else
                                        
                                        If coe = "#Nome do COE" Then
                                            MsgBox "Informe qual o nome do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("I6").Activate
                                            Exit Sub
                                            Else
                                            
                                            If Range("N6") <= 15 Then
                                                MsgBox "Ops! Parece que o nome do COE est|fffd| muito pequeno.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Range("I6").Activate
                                                Exit Sub
                                                Else
                                                
                                                If valorAplicacao <= "0" Then
                                                    MsgBox "Valor de aplica|fffd||fffd|o inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Range("E17").Activate
                                                    Exit Sub
                                                    Else
                                                    
                                                    If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                                                        MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Range("E17").Activate
                                                        Exit Sub
                                                        Else
                                                        
                                                        If barraAlerta = "Ops! Aconteceu um erro:" Then
                                                            MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            Else
                                                            
                                                            If data > Range("A1") Then
                                                                MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                Range("E15").Activate
                                                                Exit Sub
                                                                Else
                                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                                                Dim confirmaAplicacao As VbMsgBoxResult
                                                                confirmaAplicacao = MsgBox("Deseja confirmar a aplica|fffd||fffd|o em " & coe & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                                
                                                                If confirmaAplicacao = vbNo Then
                                                                    Exit Sub
                                                                    Else
                                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA APLICA|fffd||fffd|O NA TABELA
' loop para localizar linha vazia
                                                                    Sheets("coesCarteira").Unprotect
                                                                    Sheets("carteiraCaixa").Unprotect
                                                                    Sheets("coesAplic").Unprotect
                                                                    
' loop para localizar linha vazia
                                                                    If Sheets("coesAplic").Cells(23, 3) = "" Then
                                                                        contLinha = 23
                                                                        Else
                                                                        contLinha = Sheets("coesAplic").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                        
                                                                    End If
                                                                    
' registra dados na tabela
                                                                    Sheets("coesAplic").Cells(contLinha, 3) = data
                                                                    Sheets("coesAplic").Cells(contLinha, 4) = coe
                                                                    Sheets("coesAplic").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                                                    Sheets("coesAplic").Cells(contLinha, 4).InsertIndent 1
                                                                    Sheets("coesAplic").Cells(contLinha, 6) = emissor
                                                                    Sheets("coesAplic").Cells(contLinha, 7) = exposicao
                                                                    Sheets("coesAplic").Cells(contLinha, 8) = classe
                                                                    
                                                                    If Range("E8") = "Benchmark:" Then
                                                                        Sheets("coesAplic").Cells(contLinha, 9) = benchmark
                                                                        Sheets("coesAplic").Cells(contLinha, 10) = "Real"
                                                                        Else
                                                                        
                                                                        Sheets("coesAplic").Cells(contLinha, 9) = "N/A"
                                                                        Sheets("coesAplic").Cells(contLinha, 10) = moeda
                                                                        
                                                                    End If
                                                                    
                                                                    Sheets("coesAplic").Cells(contLinha, 11) = vencimento
                                                                    Sheets("coesAplic").Cells(contLinha, 12) = valorAplicacao
                                                                    Sheets("coesAplic").Cells(contLinha, 14) = corretora
                                                                    
' reestabelece formato da coluna e classifica
                                                                    Range("tabCOEsAplica|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                    Range("tabCOEsAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                                    Call coesComprasClassificar
                                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE COES - REAPLICA|fffd||fffd|O
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                                                    contLinha = 18
                                                                    Do Until Sheets("coesCarteira").Cells(contLinha, 3) = "" Or Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                                                    contLinha = contLinha + 1
                                                                    Loop
                                                                    
' verifica|fffd||fffd|o de nova compra e recompra
                                                                    If Sheets("coesCarteira").Cells(contLinha, 3) = coe Then
                                                                        
' ajusta saldo em reaplica|fffd||fffd|o
                                                                        contLinha = 18
                                                                        Do Until Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                                                        contLinha = contLinha + 1
                                                                        Loop
                                                                        
                                                                        valorSaldo = Sheets("coesCarteira").Cells(contLinha, 11)
                                                                        Sheets("coesCarteira").Cells(contLinha, 11) = valorBruto + valorSaldo
                                                                        Range("tabCOEsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE REAPLICA|fffd||fffd|O EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = emissor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                            contLinha = 20
                                                                            Else
                                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                            
                                                                        End If
                                                                        
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = emissor
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                                        
' reestabelece formato da coluna e classifica
                                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                        Call carteiraCaixaClassificar
                                                                        Call carteiraCaixaID
                                                                        
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                        If data > validaData Then
                                                                            statusOperacao = "3"
                                                                            Else
                                                                            statusOperacao = "1"
                                                                            
                                                                        End If
                                                                        
                                                                        Sheets("coesAplic").Cells(4, 14) = statusOperacao
                                                                        
' bloqueia planilhas em uso
                                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                        Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                        Sheets("coesAplic").Activate
                                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                        
                                                                        Range("F5").Select
                                                                        Call planAutoSave
                                                                        MsgBox "Reaplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                        Exit Sub
                                                                        
                                                                        Else
                                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE COES - NOVA APLICA|fffd||fffd|O
' registro de nova compra na carteira de COESs
                                                                        If Sheets("coesCarteira").Cells(contLinha, 3) <> coe Then
                                                                            Do Until Sheets("coesCarteira").Cells(contLinha, 3) = ""
                                                                            contLinha = contLinha + 1
                                                                            Loop
                                                                            
                                                                            Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                                                            
' atualiza saldo do COE
                                                                            contLinha = 18
                                                                            Do Until Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                                                            contLinha = contLinha + 1
                                                                            Loop
                                                                            
                                                                            valorSaldo = Sheets("coesCarteira").Cells(contLinha, 11)
                                                                            Sheets("coesCarteira").Cells(contLinha, 11) = valorBruto + valorSaldo
                                                                            Range("tabCOEsCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                                            
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                                            If Sheets("coesCarteira").Cells(18, 3) <> "" And Sheets("coesCarteira").Cells(19, 3) = "" Then
                                                                                Call coesCarteiraAjustarGrafico
                                                                                Else
                                                                                
                                                                            End If
                                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA APLICA|fffd||fffd|O EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = emissor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                                contLinha = 20
                                                                                Else
                                                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                                
                                                                            End If
                                                                            
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = emissor
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                                            
' reestabelece formato da coluna e classifica
                                                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                            Call carteiraCaixaClassificar
                                                                            Call carteiraCaixaID
                                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                            If data > validaData Then
                                                                                statusOperacao = "3"
                                                                                Else
                                                                                
                                                                                statusOperacao = "1"
                                                                            End If
                                                                            
                                                                            Sheets("coesAplic").Cells(4, 14) = statusOperacao
                                                                            
' bloqueia planilhas em uso
                                                                            Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                            Sheets("coesAplic").Activate
                                                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                            
                                                                            Range("F5").Select
                                                                            Call planAutoSave
                                                                            MsgBox "Nova aplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                            Exit Sub
                                                                            
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub coesAplicLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE APLICA|fffd||fffd|O
' reseta valores dos campos
    Sheets("coesAplic").Cells(17, 5) = "0"
    
End Sub
Sub coesAplicacoesNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#Selecionar" And Range("F7") = "#Selecionar" And Range("I5") = "#Emissor" And Range("I6") = "#Nome do COE" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("coesAplic").Unprotect
        
        Range("E15").FormulaR1C1 = "=TODAY()"
        Sheets("coesAplic").Cells(17, 5) = "0"
        Sheets("coesAplic").Cells(4, 14) = "0"
        Sheets("coesAplic").Cells(5, 9) = "#Emissor"
        Sheets("coesAplic").Cells(6, 9) = "#Nome do COE"
        
        Range("F9").FormulaR1C1 = "=TODAY()"
        Sheets("coesAplic").Cells(8, 6) = "#Selecionar"
        Sheets("coesAplic").Cells(7, 6) = "#Selecionar"
        Sheets("coesAplic").Cells(6, 6) = "#Selecionar"
        Sheets("coesAplic").Cells(5, 6) = "#Selecionar"
        
        Range("F5").Select
        Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub coesAplicacoesFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    coe = Range("E21")
    
' valida c|fffd|digo do ativo para filtro
    If coe = "#Nome do COE" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If coe = "" Then
            Range("E21") = "#Nome do COE"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("coesAplic").Unprotect
                Range("tabCOEsAplica|fffd||fffd|es[[#Headers],[COE]]").Select
                ActiveSheet.ListObjects("tabCOEsAplica|fffd||fffd|es").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("coesAplic").Cells(contLinha, 3) = "" Or Sheets("coesAplic").Cells(contLinha, 4) = coe
                contLinha = contLinha + 1
                Loop
                
                If Sheets("coesAplic").Cells(contLinha, 4) = coe Then
                    Sheets("coesAplic").Unprotect
                    Range("tabCOEsAplica|fffd||fffd|es[[#Headers],[COE]]").Select
                    ActiveSheet.ListObjects("tabCOEsAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=coe
                    
                    Sheets("coesAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada no COE " & coe & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("coesAplic").Cells(contLinha, 3) = "" Or Sheets("coesAplic").Cells(contLinha, 4) = coe
                contLinha = contLinha + 1
                Loop
                
                If Sheets("coesAplic").Cells(contLinha, 4) = coe Then
                    Sheets("coesAplic").Unprotect
                    Range("tabCOEsAplica|fffd||fffd|es[[#Headers],[COE]]").Select
                    ActiveSheet.ListObjects("tabCOEsAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=coe
                    
                    Sheets("coesAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada no COE " & coe & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub coesLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("coesAplic").Unprotect
        Range("tabCOEsAplica|fffd||fffd|es[[#Headers],[COE]]").Select
        ActiveSheet.ListObjects("tabCOEsAplica|fffd||fffd|es").Range.AutoFilter Field:=1
        
        Sheets("coesAplic").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#Nome do COE"
        Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub coesComprasClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por nome do coe
    ActiveWorkbook.Worksheets("coesAplic").ListObjects("tabCOEsAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("coesAplic").ListObjects("tabCOEsAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCOEsAplica|fffd||fffd|es[[#Headers],[COE]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("coesAplic").ListObjects("tabCOEsAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("coesAplic").ListObjects("tabCOEsAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("coesAplic").ListObjects("tabCOEsAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCOEsAplica|fffd||fffd|es[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("coesAplic").ListObjects("tabCOEsAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub





Attribute VB_Name = "M_COEsCarteira"
Sub coesCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        ActiveSheet.Unprotect
        ActiveSheet.Shapes.Range(Array("grfCOEsVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfCOEsAnal|fffd|tico")).Visible = False
        Sheets("coesCarteira").Cells(15, 3) = "Volum|fffd|trico"
        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            ActiveSheet.Unprotect
            ActiveSheet.Shapes.Range(Array("grfCOEsVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfCOEsAnal|fffd|tico")).Visible = True
            Sheets("coesCarteira").Cells(15, 3) = "Anal|fffd|tico"
            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub coesCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("coesCarteira").Unprotect
    Sheets("coesCarteira").ChartObjects("grfCOEsVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabCOEsCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub coesCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call coesCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("coesCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfCOEsAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("coesCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("coesCarteira").Unprotect

                ActiveSheet.ChartObjects("grfCOEsAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfCOEsAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("coesCarteira").Cells(4, 3) = "Com identificador"
                Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub coesCarteiraAjustarSaldo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDOS
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("coesCarteira").Cells(18, 3) = "" Then
        Sheets("coesCarteira").Unprotect
        Range("F3") = 0
        Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida status de t|fffd|tulos comprados
    If Range("N16") = "AJUSTAR SALDO" Then
        Sheets("coesCarteira").Unprotect
        Sheets("coesCarteira").Cells(16, 14) = "SALVAR ALTERA|fffd||fffd|ES"
        Range("tabCOEsCarteira[Saldo]").Locked = False
        Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Range("K18").Select
        Else
        
        If Range("N16") = "SALVAR ALTERA|fffd||fffd|ES" Then
            Sheets("coesCarteira").Unprotect
            Sheets("coesCarteira").Cells(16, 14) = "AJUSTAR SALDO"
            Range("J16") = Range("A1")
            Range("tabCOEsCarteira").Locked = True
            Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Call planAutoSave
            MsgBox "Dados atualizados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
'*************************************************************************************************************************** LIQUIDA T|fffd|TULOS VENCIDOS
' loop para encontrar t|fffd|tulos liquidados
            contLinha = 18
            Do Until Sheets("coesCarteira").Cells(contLinha, 3) = "" Or Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO"
            contLinha = contLinha + 1
            Loop
            
            If Sheets("coesCarteira").Cells(contLinha, 3) = "" Or Sheets("coesCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Then
                MsgBox "Nenhum t|fffd|tulo dispon|fffd|vel para liquida|fffd||fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                    
' vari|fffd|veis
                    nomeAtivo = Sheets("coesCarteira").Cells(contLinha, 3)
                    
' confirma|fffd||fffd|o e execu|fffd||fffd|o da liquida|fffd||fffd|o
                    Dim confirmaLiquidacao As VbMsgBoxResult
                    confirmaLiquidacao = MsgBox("Deseja realizar a liquida|fffd||fffd|o de " & nomeAtivo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaLiquidacao = vbNo Then
                        Exit Sub
                        Else
                        
' envia ativo para tela de resgate
                        Sheets("coesResgates").Cells(6, 6) = nomeAtivo
                        Sheets("coesResgates").Activate
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub



Attribute VB_Name = "M_COEsResgates"
Sub coesResgatesRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE RESGATE
'*************************************************************************************************************************** VARI|fffd|VEIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("coesResgates").Cells(30, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    coe = Range("F6")
    alertaPrejuizo = Range("M16")
    statusOperacao = Range("N4")
    barraAlerta = Range("C11")
    status = Range("J13")
    
' vari|fffd|veis para efetiva|fffd||fffd|o de resgate
    data = Range("E15")
    validaData = Range("A1")
    valorInvest = Range("F9")
    valorResgate = Range("G9")
    valorBruto = Range("E17")
    valorLiq = Range("E18")
    
    If valorBruto = 0 Then
        valorBruto = Range("E19")
    End If
    
    If valorLiq = 0 Then
        valorLiq = Range("H21")
    End If
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Resgate de Ativos"
    origem = emissor
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "COEs"
    tipoOrdem = Range("E16")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de resgate j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("coesResgates").Unprotect
        statusOperacao = "2"
        Sheets("coesResgates").Cells(4, 14) = statusOperacao
        Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If coe = "#Selecionar" Then
                MsgBox "Selecione o nome do COE.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If valorLiq > Range("H17") Or valorBruto > Range("H17") Then
                    MsgBox "Saldo indispon|fffd|vel para resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E18").Activate
                    Exit Sub
                    Else
                    
                    If valorBruto <= 0 And valorLiq <= 0 Then
                        MsgBox "Informe o valor do resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E17").Activate
                        Exit Sub
                        Else
                        
                        If barraAlerta = "Ops! Aconteceu um erro:" Then
                            MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Exit Sub
                            Else
                            
                            If status <> "LIQUIDADO" And status <> "AUTOCALLABLE" Then
                                MsgBox "O certificado selecionado ainda n|fffd|o est|fffd| dispon|fffd|vel para resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("F6").Activate
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E15").Activate
                                    Exit Sub
                                    Else
                                    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para resgate
                                    Dim confirmaResgate As VbMsgBoxResult
                                    confirmaResgate = MsgBox("Deseja confirmar o resgate de " & coe & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                    
                                    If confirmaResgate = vbNo Then
                                        Exit Sub
                                        Else
                                        
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE SEM PREJU|fffd|ZO
' alerta de resgate sem preju|fffd|zo
                                        If alertaPrejuizo >= "0" Then
        
' desbloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("coesResgates").Unprotect
                                            Sheets("coesCarteira").Unprotect
                                            
' vari|fffd|veis acess|fffd|rias
                                            contLinha = 18
                                            Do Until Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                            contLinha = contLinha + 1
                                            Loop
                                            
                                            exposicao = Sheets("coesCarteira").Cells(contLinha, 5)
                                            emissor = Sheets("coesCarteira").Cells(contLinha, 6)
                                            
                                            If status = "AUTOCALLABLE" Then
                                                vencimento = Range("A1")
                                                Else
                                                vencimento = Sheets("coesCarteira").Cells(contLinha, 9)
                                                
                                            End If
                                            
' loop para localizar linha vazia
                                            If Sheets("coesResgates").Cells(26, 3) = "" Then
                                                contLinha = 26
                                                Else
                                                contLinha = Sheets("coesResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra dados na tabela
                                            Sheets("coesResgates").Cells(contLinha, 3) = data
                                            Sheets("coesResgates").Cells(contLinha, 4) = coe
                                            Sheets("coesResgates").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                            Sheets("coesResgates").Cells(contLinha, 4).InsertIndent 1
                                            Sheets("coesResgates").Cells(contLinha, 6) = emissor
                                            Sheets("coesResgates").Cells(contLinha, 7) = exposicao
                                            Sheets("coesResgates").Cells(contLinha, 8) = vencimento
                                            Sheets("coesResgates").Cells(contLinha, 9) = valorInvest
                                            Sheets("coesResgates").Cells(contLinha, 10) = valorResgate
                                            Sheets("coesResgates").Cells(contLinha, 14) = ghostCell & corretora
                                            Sheets("coesResgates").Cells(contLinha, 11) = valorBruto
                                            
' atualiza saldo na tabela carteira
                                            valorSaldo = Sheets("coesResgates").Cells(contLinha, 12)
                                            
                                            contLinha = 18
                                            Do Until Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                            contLinha = contLinha + 1
                                            Loop
                                            
                                            Sheets("coesCarteira").Cells(contLinha, 11) = valorSaldo
                                            
' reestabelece formato da coluna e classifica
                                            Range("tabCOEsResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                            Range("tabCOEsResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                            Call coesResgatesClassificar
                                            
' ajusta ghostcell
                                            Call ajustaGhostCell
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE COES EM RESGATE PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                            contLinha = 18
                                            Do Until Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("coesCarteira").Cells(contLinha, 11) = 0
                                            contLinha = contLinha + 1
                                            Loop
                                            
                                            If Sheets("coesCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Or Sheets("coesCarteira").Cells(contLinha, 11) <> 0 Then
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"
' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If

' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = emissor
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = coe
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
                                                
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                
                                                statusOperacao = "1"
                                                Sheets("coesResgates").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("coesResgates").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                                Else
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE COES EM RESGATE TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("coesResgates").Unprotect
                                                Sheets("coesAplic").Unprotect
                                                Sheets("coesCarteira").Unprotect
                                                
' localiza linha com status "LIQUIDADO" na carteira
                                                contLinha = 18
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("coesCarteira").Cells(contLinha, 11) = 0
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                                Loop
                                                
' deleta ativo da carteira ap|fffd|s registro de resgate total
                                                If Sheets("coesCarteira").Cells(contLinha, 3) = coe And Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                                                    Sheets("coesCarteira").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                
                                                End If
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO COE LIQUIDADO
' deleta aplica|fffd||fffd|es realizadas com o COE liquidado
                                                contLinha = 23
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("coesAplic").Cells(contLinha, 3) = ""
                                                
                                                If Sheets("coesAplic").Cells(contLinha, 4) = coe Then
                                                    Sheets("coesAplic").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                    
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = emissor
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = coe
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
        
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
        
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
        
                                                statusOperacao = "1"
                                                Sheets("coesResgates").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("coesResgates").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                            End If
                                            Else
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de resgate com preju|fffd|zo
                                            validaPrejuizo = MsgBox("Este resgate causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                            
                                            If validaPrejuizo = vbNo Then
                                                Exit Sub
                                                Else
                                                
'*************************************************************************************************************************** REGISTRA RESGATE NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("coesResgates").Unprotect
                                                Sheets("coesCarteira").Unprotect
                                                
' vari|fffd|veis acess|fffd|rias
                                                contLinha = 18
                                                Do Until Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                                contLinha = contLinha + 1
                                                Loop
                                                
                                                exposicao = Sheets("coesCarteira").Cells(contLinha, 5)
                                                emissor = Sheets("coesCarteira").Cells(contLinha, 6)
                                                
                                                If status = "AUTOCALLABLE" Then
                                                    vencimento = Range("A1")
                                                    Else
                                                    vencimento = Sheets("coesCarteira").Cells(contLinha, 9)
                                                    
                                                End If
                                                
' loop para localizar linha vazia
                                                If Sheets("coesResgates").Cells(26, 3) = "" Then
                                                    contLinha = 26
                                                    Else
                                                    contLinha = Sheets("coesResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra dados na tabela
                                                Sheets("coesResgates").Cells(contLinha, 3) = data
                                                Sheets("coesResgates").Cells(contLinha, 4) = coe
                                                Sheets("coesResgates").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                                Sheets("coesResgates").Cells(contLinha, 4).InsertIndent 1
                                                Sheets("coesResgates").Cells(contLinha, 6) = emissor
                                                Sheets("coesResgates").Cells(contLinha, 7) = exposicao
                                                Sheets("coesResgates").Cells(contLinha, 8) = vencimento
                                                Sheets("coesResgates").Cells(contLinha, 9) = valorInvest
                                                Sheets("coesResgates").Cells(contLinha, 10) = valorResgate
                                                Sheets("coesResgates").Cells(contLinha, 14) = ghostCell & corretora
                                                Sheets("coesResgates").Cells(contLinha, 11) = valorBruto
                                                
' atualiza saldo na tabela carteira
                                                valorSaldo = Sheets("coesResgates").Cells(contLinha, 12)
                                                
                                                contLinha = 18
                                                Do Until Sheets("coesCarteira").Cells(contLinha, 3) = coe
                                                contLinha = contLinha + 1
                                                Loop
                                                
                                                Sheets("coesCarteira").Cells(contLinha, 11) = valorSaldo
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabCOEsResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                                Range("tabCOEsResgates[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                Call coesResgatesClassificar
                                                
' ajusta ghostcell
                                                Call ajustaGhostCell
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE COES EM RESGATE PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                                contLinha = 18
                                                Do Until Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("coesCarteira").Cells(contLinha, 11) = 0
                                                contLinha = contLinha + 1
                                                Loop
                                                
                                                If Sheets("coesCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Or Sheets("coesCarteira").Cells(contLinha, 11) <> 0 Then
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = emissor
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = coe
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
                                                    
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("coesResgates").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("coesResgates").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                    Else
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE COES - RESGATE TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("coesResgates").Unprotect
                                                    Sheets("coesAplic").Unprotect
                                                    Sheets("coesCarteira").Unprotect
                                                    
' localiza linha com status "LIQUIDADO" na carteira
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("coesCarteira").Cells(contLinha, 11) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                                    
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    If Sheets("coesCarteira").Cells(contLinha, 3) = coe And Sheets("coesCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                                                        Sheets("coesCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                    
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO COE LIQUIDADO
' deleta compras realizadas com o COE liquidado
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("coesAplic").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("coesAplic").Cells(contLinha, 4) = coe Then
                                                        Sheets("coesAplic").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = emissor
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = coe
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
        
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                    statusOperacao = "1"
                                                    Sheets("coesResgates").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("coesResgates").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub coesResgatesNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#Selecionar" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("coesResgates").Unprotect
        Range("E15").FormulaR1C1 = "=TODAY()"
        Sheets("coesResgates").Cells(5, 6) = "#Selecionar"
        Sheets("coesResgates").Cells(6, 6) = "#Selecionar"
        Sheets("coesResgates").Cells(4, 14) = "0"
        Sheets("coesResgates").Cells(17, 5) = "0"
        Sheets("coesResgates").Cells(18, 5) = "0"
        
        Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
End Sub
Sub coesLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("coesResgates").Cells(23, 3) = "" Then
        MsgBox "Nenhum resgate total registrado at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de resgates totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("coesResgates").Unprotect
            
            Do Until Sheets("coesResgates").Cells(contLinha, 3) = ""
            If Sheets("coesResgates").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("coesResgates").Activate
                Sheets("coesResgates").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de resgates removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub coesResgatesLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE RESGATE
' reseta valores dos campos
    Sheets("coesResgates").Cells(17, 5) = "0"
    Sheets("coesResgates").Cells(18, 5) = "0"
    
End Sub
Sub coesResgatesFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    coe = Range("E24")
    
' valida c|fffd|digo do ativo para filtro
    If coe = "#Nome do COE" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If coe = "" Then
            Range("E24") = "#Nome do COE"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N24") = "Limpar filtro" Then
                
                Sheets("coesResgates").Unprotect
                Range("tabCOEsResgates[[#Headers],[COE]]").Select
                ActiveSheet.ListObjects("tabCOEsResgates").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E24").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 26
                Do Until Sheets("coesResgates").Cells(contLinha, 3) = "" Or Sheets("coesResgates").Cells(contLinha, 4) = coe
                contLinha = contLinha + 1
                Loop
                
                If Sheets("coesResgates").Cells(contLinha, 4) = coe Then
                    Sheets("coesResgates").Unprotect
                    Range("tabCOEsResgates[[#Headers],[COE]]").Select
                    ActiveSheet.ListObjects("tabCOEsResgates").Range.AutoFilter Field:=2, Criteria1:=coe
                    
                    Sheets("coesResgates").Cells(24, 14) = "Limpar filtro"
                    Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E24").Activate
                    
                    Else
                    Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum resgate realizado para o COE " & coe & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 26
                Do Until Sheets("coesResgates").Cells(contLinha, 3) = "" Or Sheets("coesResgates").Cells(contLinha, 4) = coe
                contLinha = contLinha + 1
                Loop
                
                If Sheets("coesResgates").Cells(contLinha, 4) = coe Then
                    Sheets("coesResgates").Unprotect
                    Range("tabCOEsResgates[[#Headers],[COE]]").Select
                    ActiveSheet.ListObjects("tabCOEsResgates").Range.AutoFilter Field:=2, Criteria1:=coe
                    
                    Sheets("coesResgates").Cells(24, 14) = "Limpar filtro"
                    Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E24").Activate
                    
                    Else
                    MsgBox "Nenhum resgate realizado para o COE " & coe & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub coesResgatesLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RESGATES
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N24") = "Limpar filtro" Then
        Sheets("coesResgates").Unprotect
        Range("tabCOEsResgates[[#Headers],[COE]]").Select
        ActiveSheet.ListObjects("tabCOEsResgates").Range.AutoFilter Field:=1
        
        Sheets("coesResgates").Cells(24, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E24") = "#Nome do COE"
        Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E24") = "#Nome do COE"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub coesResgatesClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por nome do ativo
    ActiveWorkbook.Worksheets("coesResgates").ListObjects("tabCOEsResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("coesResgates").ListObjects("tabCOEsResgates").Sort. _
        SortFields.Add Key:=Range("tabCOEsResgates[[#Headers],[COE]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("coesResgates").ListObjects("tabCOEsResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de resgate
    ActiveWorkbook.Worksheets("coesResgates").ListObjects("tabCOEsResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("coesResgates").ListObjects("tabCOEsResgates").Sort. _
        SortFields.Add Key:=Range("tabCOEsResgates[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("coesResgates").ListObjects("tabCOEsResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub



Attribute VB_Name = "M_CarteiraAcompanha"
Sub carteiraAcompanhaFecharMes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FECHAMENTO MENSAL
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' array de meses completos
    mesCompleto(1) = "Janeiro"
    mesCompleto(2) = "Fevereiro"
    mesCompleto(3) = "Mar|fffd|o"
    mesCompleto(4) = "Abril"
    mesCompleto(5) = "Maio"
    mesCompleto(6) = "Junho"
    mesCompleto(7) = "Julho"
    mesCompleto(8) = "Agosto"
    mesCompleto(9) = "Setembro"
    mesCompleto(10) = "Outubro"
    mesCompleto(11) = "Novembro"
    mesCompleto(12) = "Dezembro"
    
' array de meses completos pendentes
    mesCompletoPendente(1) = "Janeiro"
    mesCompletoPendente(2) = "Fevereiro"
    mesCompletoPendente(3) = "Mar|fffd|o"
    mesCompletoPendente(4) = "Abril"
    mesCompletoPendente(5) = "Maio"
    mesCompletoPendente(6) = "Junho"
    mesCompletoPendente(7) = "Julho"
    mesCompletoPendente(8) = "Agosto"
    mesCompletoPendente(9) = "Setembro"
    mesCompletoPendente(10) = "Outubro"
    mesCompletoPendente(11) = "Novembro"
    mesCompletoPendente(12) = "Dezembro"
    
' vari|fffd|veis principais
    mesFechado = Sheets("carteiraAcompanha").Range("F11")
    dia = Sheets("carteiraAcompanha").Range("I1")
    mes = Sheets("carteiraAcompanha").Range("J1")
    ano = Sheets("carteiraAcompanha").Range("K1")
    periodo = mes & "/" & ano
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES GERAIS E PEND|fffd|NCIAS
' valida m|fffd|s de fechamento para evitar duplicidade
    If mes = mesFechado Then
        MsgBox "O m|fffd|s atual j|fffd| foi fechado. Aguarde o pr|fffd|ximo fechamento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' valida dia e m|fffd|s para disponibiliza|fffd||fffd|o do fechamento
        If mes = 2 And dia < 28 And mesFechado = mes - 1 Or mes <> 2 And dia < 30 And mesFechado = mes - 1 Then
            MsgBox "O fechamento deste m|fffd|s ainda n|fffd|o est|fffd| dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' formata exibi|fffd||fffd|o do m|fffd|s pendente
            If mesFechado <= mes - 1 Or mesFechado <= 11 Then
                temp = " pendente "
                mesPendente = mesFechado + 1
                tempMes = mesPendente
                tempMesCompleto = mesCompletoPendente(mesPendente)
                
                If Sheets("carteiraAcompanha").Range("J1") = 1 And mesPendente <= 12 Then
                    ano = ano - 1
                    Else
                End If
                
                periodoPendente = mesPendente & "/" & ano
                tempPeriodo = periodoPendente
                Else
                
                temp = ""
                tempMes = mes
                tempMesCompleto = mesCompleto(mes)
                tempPeriodo = periodo
                
            End If
            
' verifica se h|fffd| atualiza|fffd||fffd|es pendentes para cdbs, letras de cr|fffd|dito, coes e fundos
            If Sheets("cdbsCarteira").Cells(18, 3) = "" Then
                Sheets("cdbsCarteira").Unprotect
                Sheets("cdbsCarteira").Range("F3") = 0
                Sheets("cdbsCarteira").Cells(16, 10) = Range("A1")
                Sheets("cdbsCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
            End If
            
            If Sheets("letrasCarteira").Cells(18, 3) = "" Then
                Sheets("letrasCarteira").Unprotect
                Sheets("letrasCarteira").Range("F3") = 0
                Sheets("letrasCarteira").Cells(16, 10) = Range("A1")
                Sheets("letrasCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
            End If
            
            If Sheets("fundosCarteira").Cells(18, 3) = "" Then
                Sheets("fundosCarteira").Unprotect
                Sheets("fundosCarteira").Range("F3") = 0
                Sheets("fundosCarteira").Cells(16, 10) = Range("A1")
                Sheets("fundosCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    
            End If
            
            If Sheets("coesCarteira").Cells(18, 3) = "" Then
                Sheets("coesCarteira").Unprotect
                Sheets("coesCarteira").Range("F3") = 0
                Sheets("coesCarteira").Cells(16, 10) = Range("A1")
                Sheets("coesCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            
            End If
            
            If Sheets("cdbsCarteira").Cells(16, 10) < Range("A1") Or Sheets("letrasCarteira").Cells(16, 10) < Range("A1") Or _
            Sheets("fundosCarteira").Cells(16, 10) < Range("A1") Or Sheets("coesCarteira").Cells(16, 10) < Range("A1") Then
                MsgBox "Ops! Foram encontradas pend|fffd|ncias nas atualiza|fffd||fffd|es de rendimento de CDBs, COEs, LCA/LCI e Fundos. Finalize-as antes de continuar com o fechamento.", _
                vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
            End If
            
' confirma|fffd||fffd|o de fechamento
            Dim confirmaFechamento As VbMsgBoxResult
            confirmaFechamento = MsgBox("Deseja confirmar o fechamento" & temp & "do m|fffd|s de " & tempMesCompleto & "/" & ano & _
            "? A atualiza|fffd||fffd|o dos dados ser|fffd| autom|fffd|tica e levar|fffd| alguns minutos.", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaFechamento = vbNo Then
                Exit Sub
                Else
                
' valida tipo de conex|fffd|o
                Call IsConnected
                If temp = "Finalizar" Then
                    Exit Sub
                    Else
                    
' atualiza|fffd||fffd|o de dados e ajuste de gr|fffd|fico proje|fffd||fffd|es
                    Call databaseUpdateCompleto
                    Call carteiraProjecoesAjustarGrfAcomp
                
                End If
                
'*************************************************************************************************************************** VARI|fffd|VEIS COM VALORES ATUALIZADOS
' vari|fffd|veis secund|fffd|rias
                acoes = Sheets("carteiraPosi|fffd||fffd|o").Cells(6, 6)
                etfs = Sheets("carteiraPosi|fffd||fffd|o").Cells(7, 6)
                fiis = Sheets("carteiraPosi|fffd||fffd|o").Cells(8, 6)
                CDBs = Sheets("carteiraPosi|fffd||fffd|o").Cells(12, 6)
                letras = Sheets("carteiraPosi|fffd||fffd|o").Cells(13, 6)
                tesouro = Sheets("carteiraPosi|fffd||fffd|o").Cells(14, 6)
                coes = Sheets("carteiraPosi|fffd||fffd|o").Cells(18, 6)
                fundos = Sheets("carteiraPosi|fffd||fffd|o").Cells(19, 6)
                caixa = Sheets("carteiraPosi|fffd||fffd|o").Cells(23, 6) + Sheets("carteiraPosi|fffd||fffd|o").Cells(24, 6)
                poupanca = Sheets("carteiraPosi|fffd||fffd|o").Cells(25, 6)
                moedas = Sheets("carteiraPosi|fffd||fffd|o").Cells(26, 6)
                reservas = caixa + poupanca + moedas
                
' vari|fffd|veis de rentabilidade
                rentabCarteira = Sheets("carteiraPosi|fffd||fffd|o").Cells(6, 10)
                rentabAcoes = Sheets("a|fffd||fffd|esCarteira").Cells(5, 4)
                rentabETFs = Sheets("etfsCarteira").Cells(5, 5)
                rentabFIIs = Sheets("fiisCarteira").Cells(5, 4)
                rentabTesouro = Sheets("tesouroCarteira").Cells(5, 4)
                rentabCDBs = Sheets("cdbsCarteira").Cells(5, 5)
                rentabLetras = Sheets("letrasCarteira").Cells(5, 5)
                rentabFundos = Sheets("fundosCarteira").Cells(5, 5)
                rentabCOEs = Sheets("coesCarteira").Cells(5, 5)
                rentabMoedas = Sheets("moedasCarteira").Cells(5, 5)
                
' vari|fffd|veis acess|fffd|rias
                rentabBenchCarteira = Sheets("carteiraPosi|fffd||fffd|o").Cells(6, 10)
                rentabBenchAcoes = Sheets("a|fffd||fffd|esCarteira").Cells(5, 6)
                rentabBenchFIIs = Sheets("fiisCarteira").Cells(5, 6)
                rentabBenchTesouro = Sheets("tesouroCarteira").Cells(5, 6)
                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA FECHAMENTO
' libera|fffd||fffd|o de tabelas para regisros
                Sheets("mercadoBenchmarks").Unprotect
                Sheets("carteiraAcompanha").Unprotect
                Sheets("a|fffd||fffd|esCarteira").Unprotect
                Sheets("etfsCarteira").Unprotect
                Sheets("fiisCarteira").Unprotect
                Sheets("tesouroCarteira").Unprotect
                Sheets("cdbsCarteira").Unprotect
                Sheets("letrasCarteira").Unprotect
                Sheets("fundosCarteira").Unprotect
                Sheets("coesCarteira").Unprotect
                Sheets("moedasCarteira").Unprotect
                
' loop para localizar linha vazia
                If Sheets("carteiraAcompanha").Cells(13, 3) = "" Then
                    contLinha = 13
                    Else
                    contLinha = Sheets("carteiraAcompanha").Cells(Rows.Count, 3).End(xlUp).Row + 1
                    
                End If
                
' registra dados na tabela
                If temp = " pendente " Then
                    Sheets("carteiraAcompanha").Cells(contLinha, 3) = periodoPendente
                    Else
                    Sheets("carteiraAcompanha").Cells(contLinha, 3) = periodo
                    
                End If
                
                Sheets("carteiraAcompanha").Cells(contLinha, 4) = acoes
                Sheets("carteiraAcompanha").Cells(contLinha, 5) = etfs
                Sheets("carteiraAcompanha").Cells(contLinha, 6) = fiis
                Sheets("carteiraAcompanha").Cells(contLinha, 7) = tesouro
                Sheets("carteiraAcompanha").Cells(contLinha, 8) = CDBs
                Sheets("carteiraAcompanha").Cells(contLinha, 9) = letras
                Sheets("carteiraAcompanha").Cells(contLinha, 10) = fundos
                Sheets("carteiraAcompanha").Cells(contLinha, 11) = coes
                Sheets("carteiraAcompanha").Cells(contLinha, 12) = reservas
                
' restaura formato de data da tabela
                Range("tabCarteiraAcompMensal[M|fffd|s]").NumberFormat = "mmm/yy"
                Call carteiraAcompanhaClassificar
                
'*************************************************************************************************************************** ATUALIZA BENCHMARKS
' registra varia|fffd||fffd|es na tabela de benchmarks
                contLinha = 18
                Do Until Sheets("mercadoBenchmarks").Cells(18, 3) = "" Or _
                Month(Sheets("mercadoBenchmarks").Cells(18, 3)) & "/" & Year(Sheets("mercadoBenchmarks").Cells(18, 3)) = tempPeriodo
                contLinha = contLinha + 1
                Loop
                
' localiza linha vazia para registros
                If Sheets("mercadoBenchmarks").Cells(contLinha, 3) = "" Then
                    Sheets("mercadoBenchmarks").Cells(contLinha, 3) = tempPeriodo
                    Sheets("mercadoBenchmarks").Cells(contLinha, 4) = rentabBenchCarteira
                    Sheets("mercadoBenchmarks").Cells(contLinha, 5) = rentabBenchAcoes
                    Sheets("mercadoBenchmarks").Cells(contLinha, 6) = rentabBenchFIIs
                    Sheets("mercadoBenchmarks").Cells(contLinha, 7) = rentabBenchTesouro
                    Sheets("mercadoBenchmarks").Cells(contLinha, 8) = 0
                    Sheets("mercadoBenchmarks").Cells(contLinha, 9) = 0
                    Sheets("mercadoBenchmarks").Cells(contLinha, 10) = 0
                    
' restaura formato de data da tabela
                    Range("tabMercadoBenchmarks[M|fffd|s]").NumberFormat = "mmm/yy"
                    Call mercadoBenchmarksClassificar
                    Else
                    
                    Sheets("mercadoBenchmarks").Cells(contLinha, 4) = rentabBenchCarteira
                    Sheets("mercadoBenchmarks").Cells(contLinha, 5) = rentabBenchAcoes
                    Sheets("mercadoBenchmarks").Cells(contLinha, 6) = rentabBenchFIIs
                    Sheets("mercadoBenchmarks").Cells(contLinha, 7) = rentabBenchTesouro
                    
                End If
                
'*************************************************************************************************************************** ZERA RENTABILIDADE DAS CARTEIRAS
                Sheets("a|fffd||fffd|esCarteira").Cells(3, 6) = rentabAcoes
                Sheets("etfsCarteira").Cells(3, 6) = rentabETFs
                Sheets("fiisCarteira").Cells(3, 6) = rentabFIIs
                Sheets("tesouroCarteira").Cells(3, 6) = rentabTesouro
                Sheets("cdbsCarteira").Cells(3, 6) = rentabCDBs
                Sheets("letrasCarteira").Cells(3, 6) = rentabLetras
                Sheets("fundosCarteira").Cells(3, 6) = rentabFundos
                Sheets("coesCarteira").Cells(3, 6) = rentabCOEs
                Sheets("moedasCarteira").Cells(3, 6) = rentabMoedas
                
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' registra hor|fffd|rio e data de fechamento
                Sheets("mercadoIndicadores").Cells(3, 13) = DateValue(Now)
                Sheets("mercadoIndicadores").Cells(3, 14) = TimeValue(Now)
                
' finaliza registro e bloqueia planilha
                Sheets("carteiraAcompanha").Activate
                Sheets("carteiraAcompanha").Cells(11, 6) = tempMes
                
                Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
                Call planAutoSave
                MsgBox "Fechamento mensal" & temp & " realizado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Sheets("carteiraAcompanha").Activate
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub carteiraAcompanhaID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO VOLUM|fffd|TRICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida status do identificador
    If Range("J3") = "Sem identificador" And Range("L3") = "VOLUM|fffd|TRICO" Then
        Sheets("carteiraAcompanha").Unprotect

' insere identificador do gr|fffd|fico
        ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Select
        ActiveChart.PlotArea.Select
        ActiveChart.SetElement (msoElementDataLabelInsideEnd)
        ActiveChart.ApplyDataLabels
        ActiveChart.FullSeriesCollection(1).DataLabels.Select
        Selection.NumberFormat = "$ #.##0"
        Selection.Format.TextFrame2.TextRange.Font.Size = 8
        With Selection.Format.TextFrame2.TextRange.Font.Fill
            .Visible = msoTrue
            .ForeColor.ObjectThemeColor = msoThemeColorBackground1
            .ForeColor.TintAndShade = 0
            .ForeColor.Brightness = -0.150000006
            .Transparency = 0
            .Solid
        End With

' define status do identificador e finaliza altera|fffd||fffd|o
        Sheets("carteiraAcompanha").Cells(3, 10) = "Com identificador"
        Sheets("carteiraAcompanha").Cells(3, 11) = "Sem rota|fffd||fffd|o"
        Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else

'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
        If Range("J3") = "Sem identificador" And Range("L3") = "ANAL|fffd|TICO" Then
            Sheets("carteiraAcompanha").Unprotect

            ActiveSheet.ChartObjects("grfCarteiraAcompanhaAnal|fffd|tico").Select
            ActiveChart.PlotArea.Select
            ActiveChart.SetElement (msoElementDataLabelTop)
            ActiveChart.ApplyDataLabels
            ActiveChart.FullSeriesCollection(1).DataLabels.Select
            Selection.Format.TextFrame2.TextRange.Font.Size = 8
            With Selection.Format.TextFrame2.TextRange.Font.Fill
                .Visible = msoTrue
                .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                .ForeColor.TintAndShade = 0
                .ForeColor.Brightness = -0.5
                .Transparency = 0
                .Solid
            End With
            Selection.ShowCategoryName = True
            Selection.Separator = "" & Chr(13) & ""
        
' define status do filro e finaliza altera|fffd||fffd|o
            Sheets("carteiraAcompanha").Cells(3, 10) = "Com identificador"
            Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Else

'*************************************************************************************************************************** RETIRA ID GR|fffd|FICO VOLUM|fffd|TRICO
            If Range("J3") = "Com identificador" And Range("L3") = "VOLUM|fffd|TRICO" Then
                Sheets("carteiraAcompanha").Unprotect
        
' retira identificador do gr|fffd|fico
                ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Select
                ActiveChart.PlotArea.Select
                ActiveChart.SetElement (msoElementDataLabelNone)
                
' define status do identificador e finaliza altera|fffd||fffd|o
                Sheets("carteiraAcompanha").Cells(3, 10) = "Sem identificador"
                Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

                Else
                
'*************************************************************************************************************************** RETIRA ID GR|fffd|FICO ANAL|fffd|TICO
                If Range("J3") = "Com identificador" And Range("L3") = "ANAL|fffd|TICO" Then
                    Sheets("carteiraAcompanha").Unprotect
    
' retira identificador do gr|fffd|fico
                    ActiveSheet.ChartObjects("grfCarteiraAcompanhaAnal|fffd|tico").Select
                    ActiveChart.PlotArea.Select
                    ActiveChart.SetElement (msoElementDataLabelNone)
        
' define status do filro e finaliza altera|fffd||fffd|o
                    Sheets("carteiraAcompanha").Cells(3, 10) = "Sem identificador"
                    Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

                End If
            End If
        End If
    End If

End Sub
Sub carteiraAcompanhaAjustarID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ROTACIONA IDENTIFICADOR EM GR|fffd|FICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida tipo de gr|fffd|fico em destaque
    If Range("L3") = "Anal|fffd|tico" Then
        Exit Sub
        Else

' valida status do identificador
        If Range("J3") = "Sem identificador" And Range("L3") = "VOLUM|fffd|TRICO" Then
            Exit Sub
            Else
        
            If Range("K3") = "Sem rota|fffd||fffd|o" And Range("L3") = "VOLUM|fffd|TRICO" Then
                Sheets("carteiraAcompanha").Unprotect

' ajusta rota|fffd||fffd|o do identificador do gr|fffd|fico
                ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Select
                ActiveChart.PlotArea.Select
                ActiveChart.ApplyDataLabels
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.Orientation = xlUpward
                Selection.Format.TextFrame2.Orientation = msoTextOrientationUpward

' define status do identificador e finaliza altera|fffd||fffd|o
                Sheets("carteiraAcompanha").Cells(3, 11) = "Com rota|fffd||fffd|o"
                Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
                Else
        
' desfaz rota|fffd||fffd|o do identificador do gr|fffd|fico
                If Range("K3") = "Com rota|fffd||fffd|o" And Range("L3") = "VOLUM|fffd|TRICO" Then
                    Sheets("carteiraAcompanha").Unprotect
                
                    ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Select
                    ActiveChart.PlotArea.Select
                    ActiveChart.ApplyDataLabels
                    ActiveChart.FullSeriesCollection(1).DataLabels.Select
                    Selection.Orientation = xlHorizontal
                    Selection.Format.TextFrame2.Orientation = msoTextOrientationHorizontal
        
' define status do identificador e finaliza altera|fffd||fffd|o
                    Sheets("carteiraAcompanha").Cells(3, 11) = "Sem rota|fffd||fffd|o"
                    Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
                End If
            End If
        End If
    End If
    
End Sub
Sub carteiraAcompanhaAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERNA TIPO DE GR|fffd|FICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' volum|fffd|trico para anal|fffd|tico
    If Range("L3") = "VOLUM|fffd|TRICO" Then
        Sheets("carteiraAcompanha").Unprotect
        
        ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraAcompanhaAnal|fffd|tico").Visible = True
        
' insere id no gr|fffd|fico
        If Range("J3") = "Sem identificador" Then
            ActiveSheet.ChartObjects("grfCarteiraAcompanhaAnal|fffd|tico").Select
            ActiveChart.PlotArea.Select
            ActiveChart.SetElement (msoElementDataLabelTop)
            ActiveChart.ApplyDataLabels
            ActiveChart.FullSeriesCollection(1).DataLabels.Select
            Selection.ShowCategoryName = True
            Selection.Separator = "" & Chr(13) & ""
        End If
        
' define status do filro, ajusta r|fffd|tulo e finaliza altera|fffd||fffd|o
        Sheets("carteiraAcompanha").Cells(3, 12) = "ANAL|fffd|TICO"
        Sheets("carteiraAcompanha").Cells(3, 10) = "Com identificador"
        ActiveSheet.ChartObjects("grfCarteiraAcompanhaAnal|fffd|tico").Activate
        ActiveChart.PlotArea.Select
        ActiveChart.FullSeriesCollection(1).DataLabels.Select
        Selection.ShowCategoryName = True
        Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        
' anal|fffd|tico para volum|fffd|trico
        If Range("L3") = "ANAL|fffd|TICO" Then
            Sheets("carteiraAcompanha").Unprotect
            
            ActiveSheet.ChartObjects("grfCarteiraAcompanhaAnal|fffd|tico").Visible = False
            ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Visible = True
            
' insere id no gr|fffd|fico
            If Range("J3") = "Sem identificador" Then
                ActiveSheet.ChartObjects("grfCarteiraAcompanhaVolum|fffd|trico").Select
                ActiveChart.PlotArea.Select
                ActiveChart.SetElement (msoElementDataLabelInsideEnd)
                ActiveChart.ApplyDataLabels
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "R$ #.##0"
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.150000006
                    .Transparency = 0
                    .Solid
                End With
            End If
            
' define status do filro e finaliza altera|fffd||fffd|o
            Sheets("carteiraAcompanha").Cells(3, 12) = "VOLUM|fffd|TRICO"
            Sheets("carteiraAcompanha").Cells(3, 10) = "Com identificador"
            Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub carteiraAcompanhaClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ACOMPANHAMENTO
' classifica|fffd||fffd|o por ordem mensal decrescente
    ActiveWorkbook.Worksheets("carteiraAcompanha").ListObjects("tabCarteiraAcompMensal").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraAcompanha").ListObjects("tabCarteiraAcompMensal").Sort. _
        SortFields.Add Key:=Range("tabCarteiraAcompMensal[[#Headers],[M|fffd|s]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraAcompanha").ListObjects("tabCarteiraAcompMensal").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_CarteiraCaixa"
Sub carteiraCaixaRegistrarOperacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA OPREA|fffd||fffd|O EM CAIXA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' gerenciador de falhas de caracteres inv|fffd|lidos
    If Range("M6") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If

'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para opera|fffd||fffd|es
    origem = Range("E7")
    destino = Range("E8")
    finalidade = Range("E9")
    data = Range("I6")
    corretora = Range("I8")
    valorOperacao = Range("I7")
    saldoDisponivel = Range("M5")
    saldoEstimado = Range("M6")
    tipoInvest = "-"
    tipoOperacao = "Transfer|fffd|ncia"
    codigoAtivo = "-"
    statusOperacao = Range("N4")
    barraAlerta = Range("C11")
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DOS TIPOS DE OPERA|fffd||fffd|O
' valida|fffd||fffd|o dos tipos de opera|fffd||fffd|es
    If statusOperacao <> "0" Then
        MsgBox "Esta opera|fffd||fffd|o j|fffd| foi cadastrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("carteiraCaixa").Unprotect
        statusOperacao = "2"
        Sheets("carteiraCaixa").Cells(4, 14) = statusOperacao
        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Exit Sub
        Else
        
        If origem = "#Selecionar" Then
            MsgBox "Selecione a Origem da Opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("E7").Activate
            Exit Sub
            Else
            
            If destino = "#Selecionar" Then
                MsgBox "Selecione o Destino da Opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("E8").Activate
                Exit Sub
                Else
                
                If barraAlerta = "Ops! Aconteceu um erro:" Then
                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
                    If finalidade = "#Selecionar" Then
                        MsgBox "Selecione a Finalidade da Opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E9").Activate
                        Exit Sub
                        Else
                        
                        If origem = "Conta Corretora" And corretora = "#Selecionar" Or destino = "Conta Corretora" And corretora = "#Selecionar" Then
                            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("I8").Activate
                            Exit Sub
                            Else
                            
                            If data > Range("A1") Then
                                MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("I6").Activate
                                Exit Sub
                                Else
                                
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES - CONTA BANC|fffd|RIA
' valida|fffd||fffd|o de saldo em caixa para opera|fffd||fffd|es
                                If valorOperacao <= 0 Then
                                    MsgBox "Valor da opera|fffd||fffd|o inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("I7").Activate
                                    Exit Sub
                                    Else
                                    
                                    If valorOperacao > saldoDisponivel Then
                                        If origem <> "Conta Banc|fffd|ria" Then
                                            MsgBox "Saldo indispon|fffd|vel para a opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("I7").Activate
                                            Exit Sub
                                            Else
                                            
                                            Dim confirmaLimiteExcedido As VbMsgBoxResult
                                            confirmaLimiteExcedido = MsgBox("Esta opera|fffd||fffd|o exceder|fffd| o saldo da sua conta banc|fffd|ria." & vbNewLine & _
                                            "Deseja realmente continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                            
                                            If confirmaLimiteExcedido = vbNo Then
                                                Exit Sub
                                                Else
                                                
'*************************************************************************************************************************** REGISTRA OPERA|fffd||fffd|O NO CAIXA
' define valor para corretora
                                                Sheets("carteiraCaixa").Unprotect
                                                
                                                If origem = "Conta Corretora" Or destino = "Conta Corretora" Then
                                                    corretora = corretora
                                                    Else
                                                    corretora = "-"
                                                    
                                                End If
                                                
' localiza linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra recebimento na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorOperacao
                                                
' reestabelece formato da coluna
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = opera|fffd||fffd|o confirmada
' status 2 = opera|fffd||fffd|o finalizada
                                                statusOperacao = "1"
                                                Sheets("carteiraCaixa").Cells(4, 14) = statusOperacao
                                                
' finaliza registros e protege planilha
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
                                                
' atualiza saldo BM em casos de transfer|fffd|ncia para conta banc|fffd|ria
                                                Call carteiraCaixaTransferenciaBM
                                                
                                                Range("E7").Select
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
' valida modo de registro |fffd|nico ou sequencial
                                                If Range("N3") = "|fffd|nico" Then
                                                    Call planAutoSave
                                                    MsgBox "Opera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    Else
                                                    
                                                    Call carteiraCaixaNovaOperacao
                                                    Call planAutoSave
                                                    MsgBox "Opera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                        Else
                                        
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES - OUTRAS OPERA|fffd||fffd|ES
' valida|fffd||fffd|o principal das opera|fffd||fffd|es
                                        Dim confirmaOperacao As VbMsgBoxResult
                                        confirmaOperacao = MsgBox("Deseja confirmar a transfer|fffd|ncia no valor de R$ " & valorOperacao & " para " & destino & "?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If confirmaOperacao = vbNo Then
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** REGISTRA OPERA|fffd||fffd|O NO CAIXA
' define valor para corretora
                                            Sheets("carteiraCaixa").Unprotect
                                            
                                            If origem = "Conta Corretora" Or destino = "Conta Corretora" Then
                                                corretora = corretora
                                                Else
                                                corretora = "-"
                                                
                                            End If
                                            
' localiza linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra recebimento na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorOperacao
                                            
' reestabelece formato da coluna
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = opera|fffd||fffd|o confirmada
' status 2 = opera|fffd||fffd|o finalizada
                                            'statusOperacao = "1"
                                            'Sheets("carteiraCaixa").Cells(4, 14) = statusOperacao
                                            
                                            statusOperacao = "2"
                                            Sheets("carteiraCaixa").Cells(4, 14) = statusOperacao
                                            
' finaliza registros e protege planilha
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
                                            
' atualiza saldo BM em casos de transfer|fffd|ncia para conta banc|fffd|ria
                                            Call carteiraCaixaTransferenciaBM
                                            
                                            Range("E7").Select
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
' valida modo de registro |fffd|nico ou sequencial
                                            If Range("N3") = "|fffd|nico" Then
                                                Call planAutoSave
                                                MsgBox "Opera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                Else
                                                
                                                Call carteiraCaixaNovaOperacao
                                                Call planAutoSave
                                                MsgBox "Opera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub carteiraCaixaAtualizaSaldo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDO DE CONTA E POUPAN|fffd|A
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' identifica largura e altura
    resLargura = GetSystemMetrics(SM_CXSCREEN)
    resAltura = GetSystemMetrics(SM_CYSCREEN)

' identifica resolu|fffd||fffd|es padr|fffd|o e ajusta janela de altera|fffd||fffd|o
    If resLargura <= 1366 Then
        
' reseta valores e exibe formul|fffd|rio B
        frmSaldoB.txtContaB = ""
        frmSaldoB.txtPoupB = ""
        frmSaldoB.txtContaB.SetFocus
        frmSaldoB.Show
        Else
        
' reseta valores e exibe formul|fffd|rio principal
        frmSaldo.txtConta = ""
        frmSaldo.txtPoup = ""
        frmSaldo.txtConta.SetFocus
        frmSaldo.Show
        
    End If
    
End Sub
Sub carteiraCaixaAtualizaSaldoBM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDO BANC|fffd|RIO E POUPAN|fffd|A
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se arquivo BM est|fffd| dispon|fffd|vel
    Call planLocalizaBM
    
' retorna disponibilidade do arquivo BM
    If temp = 1 Then
        
' confirma atualiza|fffd||fffd|o BM
        Dim confirmaAtualizacao As VbMsgBoxResult
        confirmaAtualizacao = MsgBox("Deseja confirmar a atualiza|fffd||fffd|o via Budget Masterplan? O hist|fffd|rico de opera|fffd||fffd|es confirmadas ser|fffd| removido. ", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaAtualizacao = vbNo Then
        
            Dim confirmaAtualizacaoManual As VbMsgBoxResult
            confirmaAtualizacaoManual = MsgBox("Deseja realizar a atualiza|fffd||fffd|o manual dos valores dispon|fffd|veis?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaAtualizacaoManual = vbNo Then
                Exit Sub
                Else
                carteiraCaixaAtualizaSaldo
            End If
            Else
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA SE BM J|fffd| EST|fffd| ABERTO
' verifica se BM j|fffd| est|fffd| aberto e copia dados
            On Error Resume Next
            
            Set wb = Application.Workbooks("Budget Masterplan.xlsm")
            If Err = 0 Then
                ThisWorkbook.Activate
                Application.WindowState = xlMaximized
                
' limpa hist|fffd|rico e registra status de atualiza|fffd||fffd|o BM
                Sheets("carteiraCaixa").Unprotect
                Sheets("carteiraCaixa").Range("M1") = temp
                
                If Sheets("carteiraCaixa").Cells(20, 3) <> "" Then
                    Call carteiraCaixaLimparHistoricoBM
                    
                End If
                
' verifica se saldo em conta banc|fffd|ria |fffd| negativo e realiza ajustes
                tempVal = wb.Sheets("financeiroPosi|fffd||fffd|o").Range("C4")
                
                If valorCC < 0 And tempVal > 0 Then
                    valorCC = 0
                    tempRetorno = valorCC + tempVal
                    Else
                    tempRetorno = tempVal 'valorCC + tempVal
                    
                End If
                
                ThisWorkbook.Sheets("carteiraCaixa").Range("M13") = tempRetorno
                
' copia e cola poupan|fffd|a
                wb.Sheets("financeiroPosi|fffd||fffd|o").Range("M5").Copy
                ThisWorkbook.Sheets("carteiraCaixa").Range("N13").PasteSpecial Paste:=xlValues
                
' finaliza atualiza|fffd||fffd|o de dados e mant|fffd|m BM aberto
                ThisWorkbook.Sheets("carteiraCaixa").Range("M1") = 0
                ThisWorkbook.Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
                wb.Save
                ThisWorkbook.Save
                MsgBox "Dados atualizados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EFETUA ABERTURA DA BM
' registra status de atualiza|fffd||fffd|o BM
                Sheets("carteiraCaixa").Unprotect
                Range("M1") = temp
                
' abre arquivo BM, limpa hist|fffd|rico, copia e cola saldo
                Workbooks.Open (localizaArquivo)
                Set wb = Application.Workbooks("Budget Masterplan.xlsm")
                
' realiza limpeza do hist|fffd|rico
                Call carteiraCaixaLimparHistoricoBM
                
' verifica se saldo em conta banc|fffd|ria |fffd| negativo e realiza ajustes
                tempVal = wb.Sheets("financeiroPosi|fffd||fffd|o").Range("C4")
                
                If valorCC < 0 And tempVal > 0 Then
                    valorCC = 0
                    tempRetorno = valorCC + tempVal
                    Else
                    tempRetorno = tempVal 'valorCC + tempVal
                    
                End If
                
                ThisWorkbook.Sheets("carteiraCaixa").Range("M13") = tempRetorno
                
' copia e cola poupan|fffd|a
                wb.Sheets("financeiroPosi|fffd||fffd|o").Range("M5").Copy
                ThisWorkbook.Sheets("carteiraCaixa").Range("N13").PasteSpecial Paste:=xlValues
                
' finaliza BM
                wb.Save
                wb.Close
                
' finaliza|fffd||fffd|o geral
                ThisWorkbook.Sheets("carteiraCaixa").Range("M1") = 0
                ThisWorkbook.Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
                ThisWorkbook.Save
                MsgBox "Dados atualizados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
        
' indica compra se arquivo BM n|fffd|o for encontrado
        Else
        MsgBox "Ops! Parece que voc|fffd| ainda n|fffd|o possui acesso ao Budget Masterplan. Acesse nosso site e adquira agora mesmo!", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub carteiraCaixaTransferenciaBM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDO BANC|fffd|RIO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se arquivo BM est|fffd| dispon|fffd|vel
    Call planLocalizaBM
    
' retorna disponibilidade do arquivo BM
    If temp = 1 Then
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** BM J|fffd| ABERTO
' verifica se BM j|fffd| est|fffd| aberto e copia dados
        On Error Resume Next
        
        Set wb = Application.Workbooks("Budget Masterplan.xlsm")
        If Err = 0 Then
            ThisWorkbook.Activate
            Application.WindowState = xlMaximized
            
' registra status de atualiza|fffd||fffd|o BM
            Sheets("carteiraCaixa").Unprotect
            Sheets("carteiraCaixa").Range("M1") = temp
            
' copia e cola dados da transferencia
            wb.Activate
            If Sheets("financeiroOpera|fffd||fffd|es").Cells(20, 3) = "" Then
                contLinha = 20
                Else
                contLinha = Sheets("financeiroOpera|fffd||fffd|es").Cells(Rows.Count, 3).End(xlUp).Row + 1
                
            End If
            
' registra recebimento na tabela de opera|fffd||fffd|es do caixa
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 4) = data
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 5) = tipoInvest
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 6) = tipoOperacao
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 7) = Sheets("financeiroPosi|fffd||fffd|o").Range("G4")
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 8) = origem
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 9) = destino
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 10) = finalidade
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 11) = corretora
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 12) = valorOperacao
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 13) = valorOperacao
            
' reestabelece formato da coluna
            Range("tabFinanceiroOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
            
' finaliza atualiza|fffd||fffd|o de dados e mant|fffd|m BM aberto
            ThisWorkbook.Sheets("carteiraCaixa").Range("M1") = 0
            ThisWorkbook.Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            wb.Save
            ThisWorkbook.Activate
            Exit Sub
            Else
                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EFETUA ABERTURA DA BM
' registra status de atualiza|fffd||fffd|o BM
            Sheets("carteiraCaixa").Unprotect
            Range("M1") = temp
            
' abre arquivo BM, copia e cola transfer|fffd|ncia
            Workbooks.Open (localizaArquivo)
            Set wb = Application.Workbooks("Budget Masterplan.xlsm")
            
            ThisWorkbook.Activate
            Application.WindowState = xlMaximized
            
' registra status de atualiza|fffd||fffd|o BM
            Sheets("carteiraCaixa").Unprotect
            Sheets("carteiraCaixa").Range("M1") = temp
            
' copia e cola dados da transferencia
            wb.Activate
            If Sheets("financeiroOpera|fffd||fffd|es").Cells(20, 3) = "" Then
                contLinha = 20
                Else
                contLinha = Sheets("financeiroOpera|fffd||fffd|es").Cells(Rows.Count, 3).End(xlUp).Row + 1
                
            End If
            
' registra recebimento na tabela de opera|fffd||fffd|es do caixa
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 4) = data
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 5) = tipoInvest
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 6) = tipoOperacao
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 7) = Sheets("financeiroPosi|fffd||fffd|o").Range("G4")
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 8) = origem
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 9) = destino
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 10) = finalidade
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 11) = corretora
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 12) = valorOperacao
            Sheets("financeiroOpera|fffd||fffd|es").Cells(contLinha, 13) = valorOperacao
            
' reestabelece formato da coluna
            Range("tabFinanceiroOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
            
' finaliza atualiza|fffd||fffd|o de dados e mant|fffd|m BM aberto
            ThisWorkbook.Sheets("carteiraCaixa").Range("M1") = 0
            ThisWorkbook.Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
' finaliza BM
            wb.Save
            wb.Close
            ThisWorkbook.Activate
            
' finaliza|fffd||fffd|o geral
            ThisWorkbook.Sheets("carteiraCaixa").Range("M1") = 0
            ThisWorkbook.Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            
        End If
    End If
    
End Sub
Sub carteiraCaixaLimparOperacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA CAMPOS DE OPERA|fffd||fffd|O
' realiza limpeza dos dados
    Range("I6").FormulaR1C1 = "=TODAY()"
    Sheets("carteiraCaixa").Cells(7, 9) = "0"
    Sheets("carteiraCaixa").Cells(8, 9) = "#Selecionar"
    
End Sub
Sub carteiraCaixaNovaOperacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** NOVA OPERA|fffd||fffd|O
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("I7") = 0 And Range("I8") = "#Selecionar" And Range("E9") = "#Selecionar" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("carteiraCaixa").Unprotect
    
        Range("I6").FormulaR1C1 = "=TODAY()"
        Sheets("carteiraCaixa").Cells(7, 9) = "0"
        Sheets("carteiraCaixa").Cells(7, 5) = "#Selecionar"
        Sheets("carteiraCaixa").Cells(8, 5) = "#Selecionar"
        Sheets("carteiraCaixa").Cells(9, 5) = "#Selecionar"
        Sheets("carteiraCaixa").Cells(8, 9) = "#Selecionar"
        Sheets("carteiraCaixa").Cells(4, 14) = "0"
        
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
        Range("E7").Select
        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub carteiraCaixaLimparHistorico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    valorCorretora1 = Range("C15")
    valorCorretora2 = Range("E15")
    valorCorretora3 = Range("G15")
    valorCorretora4 = Range("I15")
    valorCorretora5 = Range("K15")
    valorCC = Range("N15")
    valorPoup = Range("N16")

'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' valida ordens pendentes
    If Sheets("carteiraOp").Range("C5") <> "" Then
        MsgBox "Foram identificadas ordens pendentes de liquida|fffd||fffd|o em sua carteira. Finalize-as antes de limpar o hist|fffd|rico.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE STATUS PENDENTE
        contLinha = 20
        tabLinha = ((contLinha * -1) + 1) + contLinha
        
' loop para localiza|fffd||fffd|o de status confirmada
        If Sheets("carteiraCaixa").Cells(contLinha, 3) <> "" And Sheets("carteiraCaixa").Cells(contLinha, 14) <> "CONFIRMADA" Then
            Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA"
            contLinha = contLinha + 1
            tabLinha = tabLinha + 1
            Loop
            
            If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) <> "CONFIRMADA" Then
                MsgBox "Nenhum hist|fffd|rico dispon|fffd|vel para limpeza at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' confirma|fffd||fffd|o e execu|fffd||fffd|o da limpeza
                Dim confirmaLimpeza As VbMsgBoxResult
                confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de opera|fffd||fffd|es?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                
                If confirmaLimpeza = vbNo Then
                    Exit Sub
                    Else
                    
' registra valores em c|fffd|lula auxiliar
                    Sheets("carteiraCaixa").Unprotect
                    Sheets("config").Unprotect
                    
                    Sheets("carteiraCaixa").Cells(13, 4) = valorCorretora1
                    Sheets("carteiraCaixa").Cells(13, 6) = valorCorretora2
                    Sheets("carteiraCaixa").Cells(13, 8) = valorCorretora3
                    Sheets("carteiraCaixa").Cells(13, 10) = valorCorretora4
                    Sheets("carteiraCaixa").Cells(13, 12) = valorCorretora5
                    Sheets("carteiraCaixa").Cells(13, 13) = valorCC
                    Sheets("carteiraCaixa").Cells(13, 14) = valorPoup
                    
' registra saldo na tabela corretoras configura|fffd||fffd|es
                    If Sheets("config").Cells(19, 3) = 1 Then
                        Sheets("config").Cells(19, 5) = valorCorretora1
                        Else
                    End If
                    
                    If Sheets("config").Cells(20, 3) = 2 Then
                        Sheets("config").Cells(20, 5) = valorCorretora2
                        Else
                    End If
                    
                    If Sheets("config").Cells(21, 3) = 3 Then
                        Sheets("config").Cells(21, 5) = valorCorretora3
                        Else
                    End If
                    
                    If Sheets("config").Cells(22, 3) = 4 Then
                        Sheets("config").Cells(22, 5) = valorCorretora4
                        Else
                    End If
                    
                    If Sheets("config").Cells(23, 3) = 5 Then
                        Sheets("config").Cells(23, 5) = valorCorretora5
                        Else
                    End If
                    
' loop para limpeza de todas as linhas confirmadas
                    Do Until Sheets("carteiraCaixa").Cells(contLinha, 14) = ""
                    If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                        Sheets("carteiraCaixa").Activate
                        Cells(contLinha, 3).Select
                        Selection.ListObject.ListRows(tabLinha).Delete
                        Else
                        
                        contLinha = contLinha + 1
                        tabLinha = tabLinha + 1
                        
                    End If
                    Loop
                    
' finaliza opera|fffd||fffd|es
                    Call carteiraCaixaID
                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
                    Call planAutoSave
                    MsgBox "Hist|fffd|rico de opera|fffd||fffd|es removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
            
            Else
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE STATUS CONFIRMADA
' localiza e limpa confirmadas
            If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de opera|fffd||fffd|es?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                
                If confirmaLimpeza = vbNo Then
                    Exit Sub
                    Else
                    
' registra valores em c|fffd|lula auxiliar
                    Sheets("carteiraCaixa").Unprotect
                    Sheets("config").Unprotect '

                    Sheets("carteiraCaixa").Cells(13, 4) = valorCorretora1
                    Sheets("carteiraCaixa").Cells(13, 6) = valorCorretora2
                    Sheets("carteiraCaixa").Cells(13, 8) = valorCorretora3
                    Sheets("carteiraCaixa").Cells(13, 10) = valorCorretora4
                    Sheets("carteiraCaixa").Cells(13, 12) = valorCorretora5
                    Sheets("carteiraCaixa").Cells(13, 13) = valorCC
                    Sheets("carteiraCaixa").Cells(13, 14) = valorPoup

' registra saldo na tabela corretoras configura|fffd||fffd|es
                    If Sheets("config").Cells(19, 3) = 1 Then
                        Sheets("config").Cells(19, 5) = valorCorretora1
                        Else
                    End If

                    If Sheets("config").Cells(20, 3) = 2 Then
                        Sheets("config").Cells(20, 5) = valorCorretora2
                        Else
                    End If

                    If Sheets("config").Cells(21, 3) = 3 Then
                        Sheets("config").Cells(21, 5) = valorCorretora3
                        Else
                    End If

                    If Sheets("config").Cells(22, 3) = 4 Then
                        Sheets("config").Cells(22, 5) = valorCorretora4
                        Else
                    End If

                    If Sheets("config").Cells(23, 3) = 5 Then
                        Sheets("config").Cells(23, 5) = valorCorretora5
                        Else
                    End If

' loop para limpeza de todas as linhas confirmadas
                    Do Until Sheets("carteiraCaixa").Cells(contLinha, 14) = ""
                    If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                        Sheets("carteiraCaixa").Activate
                        Cells(contLinha, 3).Select
                        Selection.ListObject.ListRows(tabLinha).Delete
                        Else
                        contLinha = contLinha + 1
                        tabLinha = tabLinha + 1

                    End If
                    Loop

' finaliza opera|fffd||fffd|es - parte 3
                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Call planAutoSave
                    MsgBox "Hist|fffd|rico de opera|fffd||fffd|es exclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub

' finaliza|fffd||fffd|o geral de la|fffd|os
                End If
                Else
                
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE STATUS SEM EXCLUS|fffd|O
' confirma|fffd||fffd|o em tabela vazia
                If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Then
                    MsgBox "Nenhuma opera|fffd||fffd|o registrada at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                
' finaliza|fffd||fffd|o geral
            End If
        End If
    End If
    
End Sub
Sub carteiraCaixaLimparHistoricoBM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' ativa Invest Masterplan
    ThisWorkbook.Activate

' vari|fffd|veis
    valorCorretora1 = Range("C15")
    valorCorretora2 = Range("E15")
    valorCorretora3 = Range("G15")
    valorCorretora4 = Range("I15")
    valorCorretora5 = Range("K15")
    valorCC = Range("N15")
    valorPoup = Range("N16")

'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' valida ordens pendentes
    If Sheets("carteiraOp").Range("C5") <> "" Then
        Exit Sub
        Else
        
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE STATUS PENDENTE
        contLinha = 20
        tabLinha = ((contLinha * -1) + 1) + contLinha
        
' loop para localiza|fffd||fffd|o de status confirmada
        If Sheets("carteiraCaixa").Cells(contLinha, 3) <> "" And Sheets("carteiraCaixa").Cells(contLinha, 14) <> "CONFIRMADA" Then
            Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA"
            contLinha = contLinha + 1
            tabLinha = tabLinha + 1
            Loop
            
            If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) <> "CONFIRMADA" Then
                Exit Sub
                Else
                
' registra valores em c|fffd|lula auxiliar
                Sheets("carteiraCaixa").Unprotect
                Sheets("config").Unprotect
                
                Sheets("carteiraCaixa").Cells(13, 4) = valorCorretora1
                Sheets("carteiraCaixa").Cells(13, 6) = valorCorretora2
                Sheets("carteiraCaixa").Cells(13, 8) = valorCorretora3
                Sheets("carteiraCaixa").Cells(13, 10) = valorCorretora4
                Sheets("carteiraCaixa").Cells(13, 12) = valorCorretora5
                Sheets("carteiraCaixa").Cells(13, 13) = valorCC
                Sheets("carteiraCaixa").Cells(13, 14) = valorPoup
                
' registra saldo na tabela corretoras configura|fffd||fffd|es
                If Sheets("config").Cells(19, 3) = 1 Then
                    Sheets("config").Cells(19, 5) = valorCorretora1
                    Else
                End If
                
                If Sheets("config").Cells(20, 3) = 2 Then
                    Sheets("config").Cells(20, 5) = valorCorretora2
                    Else
                End If
                
                If Sheets("config").Cells(21, 3) = 3 Then
                    Sheets("config").Cells(21, 5) = valorCorretora3
                    Else
                End If
                
                If Sheets("config").Cells(22, 3) = 4 Then
                    Sheets("config").Cells(22, 5) = valorCorretora4
                    Else
                End If
                
                If Sheets("config").Cells(23, 3) = 5 Then
                    Sheets("config").Cells(23, 5) = valorCorretora5
                    Else
                End If
                
' loop para limpeza de todas as linhas confirmadas
                Do Until Sheets("carteiraCaixa").Cells(contLinha, 14) = ""
                If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                    Sheets("carteiraCaixa").Activate
                    Cells(contLinha, 3).Select
                    Selection.ListObject.ListRows(tabLinha).Delete
                    Else
                    
                    contLinha = contLinha + 1
                    tabLinha = tabLinha + 1
                    
                End If
                Loop
                
' finaliza opera|fffd||fffd|es
                Call carteiraCaixaID
                Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
            End If
            
            Else
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE STATUS CONFIRMADA
' registra valores em c|fffd|lula auxiliar
            Sheets("carteiraCaixa").Unprotect
            Sheets("config").Unprotect
            
            Sheets("carteiraCaixa").Cells(13, 4) = valorCorretora1
            Sheets("carteiraCaixa").Cells(13, 6) = valorCorretora2
            Sheets("carteiraCaixa").Cells(13, 8) = valorCorretora3
            Sheets("carteiraCaixa").Cells(13, 10) = valorCorretora4
            Sheets("carteiraCaixa").Cells(13, 12) = valorCorretora5
            Sheets("carteiraCaixa").Cells(13, 13) = valorCC
            Sheets("carteiraCaixa").Cells(13, 14) = valorPoup
            
' registra saldo na tabela corretoras configura|fffd||fffd|es
            If Sheets("config").Cells(19, 3) = 1 Then
                Sheets("config").Cells(19, 5) = valorCorretora1
                Else
            End If

            If Sheets("config").Cells(20, 3) = 2 Then
                Sheets("config").Cells(20, 5) = valorCorretora2
                Else
            End If

            If Sheets("config").Cells(21, 3) = 3 Then
                Sheets("config").Cells(21, 5) = valorCorretora3
                Else
            End If

            If Sheets("config").Cells(22, 3) = 4 Then
                Sheets("config").Cells(22, 5) = valorCorretora4
                Else
            End If

            If Sheets("config").Cells(23, 3) = 5 Then
                Sheets("config").Cells(23, 5) = valorCorretora5
                Else
            End If

' loop para limpeza de todas as linhas confirmadas
            Do Until Sheets("carteiraCaixa").Cells(contLinha, 14) = ""
            If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                Sheets("carteiraCaixa").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1

            End If
            Loop

' finaliza opera|fffd||fffd|es - parte 3
            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub

' finaliza|fffd||fffd|o geral de la|fffd|os
        End If
        
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE STATUS SEM EXCLUS|fffd|O
' confirma|fffd||fffd|o em tabela vazia
        If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Then
            Exit Sub
            
        End If
    End If
    
End Sub
Sub carteiraCaixaAcessarCorretora1()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 1
' acessa site da corretora 1
    If Range("C13") <> 0 Then
        ActiveWorkbook.FollowHyperlink Address:=Range("C13")
        Else
        Exit Sub
    End If
    
End Sub
Sub carteiraCaixaAcessarCorretora2()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 1
' acessa site da corretora 2
    If Range("E13").Value <> 0 Then
        ActiveWorkbook.FollowHyperlink Address:=Range("E13")
        Else
        Exit Sub
    End If
    
End Sub
Sub carteiraCaixaAcessarCorretora3()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 1
' acessa site da corretora 3
    If Range("G13").Value <> 0 Then
        ActiveWorkbook.FollowHyperlink Address:=Range("G13")
        Else
        Exit Sub
    End If
    
End Sub
Sub carteiraCaixaAcessarCorretora4()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 1
' acessa site da corretora 4
    If Range("I13").Value <> 0 Then
        ActiveWorkbook.FollowHyperlink Address:=Range("I13")
        Else
        Exit Sub
    End If
    
End Sub
Sub carteiraCaixaAcessarCorretora5()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 1
' acessa site da corretora 5
    If Range("K13").Value <> 0 Then
        ActiveWorkbook.FollowHyperlink Address:=Range("K13")
        Else
        Exit Sub
    End If
    
End Sub
Sub carteiraCaixaTooltip()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIP
' dispara aviso importante
    frmTooltipCaixa.Show
    
End Sub
Sub carteiraCaixaID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** AJUSTSA N|fffd|MERO DE ORDENS
' atualiza #id de ordens
    contLinha = 20
    tabLinha = ((contLinha * -1) + 1) + contLinha
    
    Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = "" And Sheets("carteiraCaixa").Cells(contLinha, 4) = ""
    
    If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" And Sheets("carteiraCaixa").Cells(contLinha, 4) <> "" Then
        Sheets("carteiraCaixa").Cells(contLinha, 3) = tabLinha
        Else
        Sheets("carteiraCaixa").Cells(contLinha, 3) = tabLinha
    
    End If
    
    contLinha = contLinha + 1
    tabLinha = tabLinha + 1
    Loop
    
End Sub
Sub carteiraCaixaClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE REGISTROS
' classifica tabela por tipo de opera|fffd||fffd|o
    ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCarteiraCaixaOpera|fffd||fffd|es[[#Headers],[Tipo Opera|fffd||fffd|o]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica tabela por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCarteiraCaixaOpera|fffd||fffd|es[[#Headers],[C|fffd|d. Ativo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica tabela por data de opera|fffd||fffd|o
    ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCarteiraCaixaOpera|fffd||fffd|es[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraCaixa").ListObjects("tabCarteiraCaixaOpera|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
End Sub


Attribute VB_Name = "M_CarteiraOfertas"
Sub carteiraOfertasAcoes1()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE A|fffd||fffd|ES 1
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoAcao = UCase(Range("D5"))
    
' envia pr|fffd|-ordem de compra de a|fffd||fffd|es 1
    If codigoAcao = "Empresa 1" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("a|fffd||fffd|esCompras").Select
        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAcao
        
    End If
End Sub
Sub carteiraOfertasAcoes2()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE A|fffd||fffd|ES 2
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoAcao = UCase(Range("D8"))
    
' envia pr|fffd|-ordem de compra de a|fffd||fffd|es 2
    If codigoAcao = "Empresa 2" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("a|fffd||fffd|esCompras").Select
        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAcao
    
    End If
End Sub
Sub carteiraOfertasAcoes3()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE A|fffd||fffd|ES 3
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoAcao = UCase(Range("D11"))
    
' envia pr|fffd|-ordem de compra de a|fffd||fffd|es 3
    If codigoAcao = "Empresa 3" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("a|fffd||fffd|esCompras").Select
        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAcao
    
    End If
End Sub
Sub carteiraOfertasAcoes4()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE A|fffd||fffd|ES 4
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoAcao = UCase(Range("D14"))
    
' envia pr|fffd|-ordem de compra de a|fffd||fffd|es 4
    If codigoAcao = "Empresa 4" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("a|fffd||fffd|esCompras").Select
        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAcao
        
    End If
End Sub
Sub carteiraOfertasAcoes5()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE A|fffd||fffd|ES 5
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoAcao = UCase(Range("D17"))
    
' envia pr|fffd|-ordem de compra de a|fffd||fffd|es 5
    If codigoAcao = "Empresa 5" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("a|fffd||fffd|esCompras").Select
        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAcao
        
    End If
End Sub
Sub carteiraOfertasFIIs1()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE FIIS 1
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("M5"))
    
' envia pr|fffd|-ordem de compra de fiis 1
    If codigoFundo = "Fundo 1" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("fiisCompras").Select
        Sheets("fiisCompras").Cells(6, 6) = codigoFundo
        
    End If
End Sub
Sub carteiraOfertasFIIs2()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE FIIS 2
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("M8"))
    
' envia pr|fffd|-ordem de compra de fiis 2
    If codigoFundo = "Fundo 2" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("fiisCompras").Select
        Sheets("fiisCompras").Cells(6, 6) = codigoFundo
        
    End If
End Sub
Sub carteiraOfertasFIIs3()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE FIIS 3
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("M11"))
    
' envia pr|fffd|-ordem de compra de fiis 3
    If codigoFundo = "Fundo 3" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("fiisCompras").Select
        Sheets("fiisCompras").Cells(6, 6) = codigoFundo
        
    End If
End Sub
Sub carteiraOfertasFIIs4()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE FIIS 4
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("M14"))
    
' envia pr|fffd|-ordem de compra de fiis 4
    If codigoFundo = "Fundo 4" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("fiisCompras").Select
        Sheets("fiisCompras").Cells(6, 6) = codigoFundo
        
    End If
End Sub
Sub carteiraOfertasFIIs5()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** COMPRA DE FIIS 5
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("M17"))
    
' envia pr|fffd|-ordem de compra de fiis 5
    If codigoFundo = "Fundo 5" Then
        MsgBox "Nenhum ativo vinculado at|fffd| o momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        Sheets("fiisCompras").Select
        Sheets("fiisCompras").Cells(6, 6) = codigoFundo
        
    End If
End Sub

Attribute VB_Name = "M_CarteiraOp"
Sub carteiraOpEditarOrdens()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O DE CAMPOS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' identifica linhas com ordens pendentes para edi|fffd||fffd|o
    contLinha = 5
    Do Until Sheets("carteiraOp").Cells(contLinha, 3) = "" Or Sheets("carteiraOp").Cells(contLinha, 12) >= "0"
    contLinha = contLinha + 1
    Loop

    If Sheets("carteiraOp").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhuma ordem dispon|fffd|vel para altera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

' loop para reconhecimento do status e liberar edi|fffd||fffd|o
        If Sheets("carteiraOp").Cells(3, 14) = "Editar" Then
            
            Sheets("carteiraOp").Unprotect
            Sheets("carteiraOp").Range("tabCarteiraOp").Locked = True
            Sheets("carteiraOp").Range("tabCarteiraOp[Qtde.]").Locked = False
            Sheets("carteiraOp").Range("tabCarteiraOp[Pre|fffd|o Unit.]").Locked = False
            Sheets("carteiraOp").Range("tabCarteiraOp[Total]").Locked = False
            
            Sheets("carteiraOp").Cells(3, 14) = "Editando"
            ActiveSheet.Shapes.Range(Array("btnEditarOrdens")).Visible = False
            ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
            
            Call carteiraOpClassificar
            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' reconhecimento do status para finalizar edi|fffd||fffd|o
            If Sheets("carteiraOp").Cells(3, 14) = "Editando" Then
                
                Sheets("carteiraOp").Unprotect
                Sheets("carteiraOp").Range("tabCarteiraOp").Locked = True
                
                Sheets("carteiraOp").Cells(3, 14) = "Editar"
                ActiveSheet.Shapes.Range(Array("btnEditarOrdens")).Visible = True
                ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
                
                Call carteiraOpClassificar
                Call carteiraOpClassificarStatus
                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            End If
        End If
    End If

End Sub
Sub carteiraOpLiquidarPendencias()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIQUIDA|fffd||fffd|O DE PEND|fffd|NCIAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se n|fffd|o h|fffd| ordem em edi|fffd||fffd|o
    If Range("N3") = "Editando" Then
        MsgBox "As ordens est|fffd|o abertas para edi|fffd||fffd|o. Finalize-as antes da liquida|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' alertas de ordens n|fffd|o liquidadas
        contLinha = 5
        Do Until Sheets("carteiraOp").Cells(contLinha, 3) = "" Or Sheets("carteiraOp").Cells(contLinha, 14) <> "EM LIQUIDA|fffd||fffd|O"
        
        If Sheets("carteiraOp").Cells(contLinha, 14) = "EM LIQUIDA|fffd||fffd|O" And Range("K3") = 1 And Range("L3") = 0 Then
            MsgBox "A ordem enviada encontra-se em fase de liquida|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If Sheets("carteiraOp").Cells(contLinha, 14) = "EM LIQUIDA|fffd||fffd|O" And Range("K3") > 1 And Range("L3") = 0 Then
                MsgBox "As ordens enviadas encontram-se em fase de liquida|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
            End If
        End If
        
        contLinha = contLinha + 1
        Loop
        
' mensagem  em caso de tabela vazia
        If Sheets("carteiraOp").Cells(contLinha, 3) = "" Then
            MsgBox "Nenhuma ordem pendente at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        
'/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// INICIA LIQUIDA|fffd||fffd|ES
' vari|fffd|veis auxiliares
        contUnit = Range("L3")
        If contUnit = 1 Then
            temp = "opera|fffd||fffd|o."
            Else
            temp = "opera|fffd||fffd|es."
            
        End If
        
        If Sheets("carteiraOp").Cells(contLinha, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        
' confirma opera|fffd||fffd|es de liquida|fffd||fffd|o
            Dim confirmaLiq As VbMsgBoxResult
            confirmaLiq = MsgBox("Este procedimento ir|fffd| liquidar " & contUnit & " " & temp & " Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaLiq = vbNo Then
                Exit Sub
                Else
                
                Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                
' define valores de vari|fffd|veis
                data = Sheets("carteiraOp").Cells(contLinha, 3)
                tipoInvest = Sheets("carteiraOp").Cells(contLinha, 5)
                tipoOrdem = Sheets("carteiraOp").Cells(contLinha, 6)
                codigoAtivo = Sheets("carteiraOp").Cells(contLinha, 7)
                qtde = Sheets("carteiraOp").Cells(contLinha, 9)
                valorUnit = Sheets("carteiraOp").Cells(contLinha, 10)
                valorBruto = Sheets("carteiraOp").Cells(contLinha, 11)
                valorTotal = Sheets("carteiraOp").Cells(contLinha, 12)
                corretora = Sheets("carteiraOp").Cells(contLinha, 13)
                
                If tipoOrdem = "Venda total" Then
                    ghostCell = "*"
                    Else
                    ghostCell = ""
                    
                End If
                
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
                If Range("L3") = 1 And valorTotal = 0 Or Sheets("carteiraOp").Cells(5, 14) = "EM LIQUIDA|fffd||fffd|O" And Range("C6") = "" Then
                    MsgBox "Insira o valor total da ordem para continuar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
                    If Range("L3") > 1 And valorTotal = 0 Or Sheets("carteiraOp").Cells(5, 14) = "EM LIQUIDA|fffd||fffd|O" And Range("C6") <> "" Then
                        MsgBox "Insira os valores totais das ordens para continuar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        Else
                        
'*************************************************************************************************************************** VARI|fffd|VEIS PARA REGISTROS EM CAIXA
' vari|fffd|veis para registro em caixa
                        If tipoInvest = "A|fffd||fffd|es" And tipoOrdem = "Nova compra" Or tipoInvest = "A|fffd||fffd|es" And tipoOrdem = "Recompra" Or _
                        tipoInvest = "Fundos Imobili|fffd|rios" And tipoOrdem = "Nova compra" Or tipoInvest = "Fundos Imobili|fffd|rios" And tipoOrdem = "Recompra" Then
                            tipoOperacao = "Compra de Ativos"
                            origem = "Conta Corretora"
                            destino = "B3"
                            finalidade = "Aumento Patrimonial"
                            Else
                            
                            If tipoInvest = "A|fffd||fffd|es" And tipoOrdem = "Venda total" Or tipoInvest = "A|fffd||fffd|es" And tipoOrdem = "Venda parcial" Or _
                            tipoInvest = "Fundos Imobili|fffd|rios" And tipoOrdem = "Venda total" Or tipoInvest = "Fundos Imobili|fffd|rios" And tipoOrdem = "Venda parcial" Then
                                tipoOperacao = "Venda de Ativos"
                                origem = "B3"
                                destino = "Conta Corretora"
                                finalidade = "Investimento Futuro"
                                
                            End If
                        End If
                        
                        If Sheets("carteiraOp").Cells(contLinha, 12) <> 0 And Sheets("carteiraOp").Cells(contLinha, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
                        
'/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// LIQUIDA|fffd||fffd|O DE A|fffd||fffd|ES
'*************************************************************************************************************************** REGISTRA RECOMPRA (A|fffd||fffd|ES)
' identifica tipo de opera|fffd||fffd|o para v|fffd|nculo de carteira
                            If tipoInvest = "A|fffd||fffd|es" Then
    
' identifica tipo de opera|fffd||fffd|o
                                If tipoOrdem = "Recompra" Then
    
' desbloqueia planilhas em uso
                                    Sheets("a|fffd||fffd|esCompras").Unprotect
                                    Sheets("carteiraCaixa").Unprotect
                                    Sheets("carteiraOp").Unprotect
    
' inicia registros
                                    statusOperacao = "0"
                                    Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
    
' loop para localizar linha vazia
                                    If Sheets("a|fffd||fffd|esCompras").Cells(23, 3) = "" Then
                                        contLinha = 23
                                        Else
                                        contLinha = Sheets("a|fffd||fffd|esCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                        
                                    End If
                                    
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                    Sheets("a|fffd||fffd|esCompras").Cells(5, 6) = corretora
                                    Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAtivo
        
' registra dados na tabela
                                    Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = data
                                    Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo
                                    Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 7) = qtde
                                    Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 8) = valorUnit
                                    Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 11) = valorTotal
                                    Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 14) = corretora
        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                    Range("tabA|fffd||fffd|esCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                    Call acoesComprasClassificar
                                    
' finaliza opera|fffd||fffd|o de compra e altera status
    ' status 0 = em branco / em andamento
    ' status 1 = ordem confirmada
    ' status 2 = ordem finalizada
                                    statusOperacao = "2"
                                    Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA RECOMPRA EM CAIXA (A|fffd||fffd|ES)
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "B3"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                        contLinha = 20
                                        Else
                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                        
                                    End If
    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                    Call carteiraCaixaClassificar
                                    Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE RECOMPRA LIQUIDADA (A|fffd||fffd|ES)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de recompra e finalizar pend|fffd|ncia
                                    contLinha = 5
                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                    Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                    If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                        Sheets("carteiraOp").Activate
                                        Cells(contLinha, 3).Select
                                        Selection.ListObject.ListRows(tabLinha).Delete
                                        
                                        Else
                                        contLinha = contLinha + 1
                                        tabLinha = tabLinha + 1
                                    
                                    End If
                                    Loop
                                    
' bloqueia planilhas em uso
                                    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    
                                    Call planAutoSave
                                    MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Else
                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA COMPRA (A|fffd||fffd|ES)
                                    If tipoOrdem = "Nova compra" Then
                    
' desbloqueia planilhas em uso
                                        Sheets("a|fffd||fffd|esCompras").Unprotect
                                        Sheets("a|fffd||fffd|esCarteira").Unprotect
                                        Sheets("carteiraCaixa").Unprotect
                                        Sheets("carteiraOp").Unprotect
        
' inicia registros
                                        statusOperacao = "0"
                                        Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
        
' loop para localizar linha vazia
                                        If Sheets("a|fffd||fffd|esCompras").Cells(23, 3) = "" Then
                                            contLinha = 23
                                            Else
                                            contLinha = Sheets("a|fffd||fffd|esCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                        Sheets("a|fffd||fffd|esCompras").Cells(5, 6) = corretora
                                        Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAtivo
        
' registra dados na tabela
                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = data
                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo
                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 7) = qtde
                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 8) = valorUnit
                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 11) = valorTotal
                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 14) = corretora
        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                        Range("tabA|fffd||fffd|esCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call acoesComprasClassificar
    
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                        statusOperacao = "2"
                                        Sheets("a|fffd||fffd|esCompras").Cells(4, 14) = statusOperacao
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA (A|fffd||fffd|ES)
' loop para localizar linha vazia na carteira
                                        If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) = "" Then
                                            contLinha = 18
                                            Else
                                            contLinha = Sheets("a|fffd||fffd|esCarteira").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
                                        Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivo
    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                        If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) <> "" And Sheets("a|fffd||fffd|esCarteira").Cells(19, 3) = "" Then
                                            Call acoesCarteiraAjustarGrafico
                                            Else
                                            
                                        End If
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA COMPRA EM CAIXA (A|fffd||fffd|ES)
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "B3"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                            contLinha = 20
                                            Else
                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call carteiraCaixaClassificar
                                        Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE NOVA COMPRA LIQUIDADA (A|fffd||fffd|ES)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de nova compra e finalizar pend|fffd|ncia
                                        contLinha = 5
                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                        Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                        If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                            Sheets("carteiraOp").Activate
                                            Cells(contLinha, 3).Select
                                            Selection.ListObject.ListRows(tabLinha).Delete
    
                                            Else
                                            contLinha = contLinha + 1
                                            tabLinha = tabLinha + 1
                                        
                                        End If
                                        Loop
                            
' bloqueia planilhas em uso
                                        Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        
                                        Call planAutoSave
                                        MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Else
                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA PARCIAL (A|fffd||fffd|ES)
' identifica tipo de opera|fffd||fffd|o
                                        If tipoOrdem = "Venda parcial" Then
    
' desbloqueia planilhas em uso
                                            Sheets("a|fffd||fffd|esVendas").Unprotect
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("carteiraOp").Unprotect
        
' inicia registros
                                            statusOperacao = "0"
                                            Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
    
' loop para localizar linha vazia
                                            If Sheets("a|fffd||fffd|esVendas").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("a|fffd||fffd|esVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                            Sheets("a|fffd||fffd|esVendas").Cells(5, 6) = corretora
                                            Sheets("a|fffd||fffd|esVendas").Cells(6, 6) = codigoAtivo
        
' obtem valor de pmCompra
                                            pmCompra = Sheets("a|fffd||fffd|esVendas").Cells(13, 8)
                                
' registra dados na tabela
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = data
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAtivo
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 7) = qtde
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 8) = valorUnit
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 9) = pmCompra
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 11) = valorTotal
                                            Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 14) = corretora
        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                            Range("tabA|fffd||fffd|esVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call acoesVendasClassificar
                                            Call ajustaGhostCell
                                            
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                            statusOperacao = "2"
                                            Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA PARCIAL EM CAIXA (A|fffd||fffd|ES)
' tipoOperacao = "Venda de Ativos"
' origem = "B3"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE VENDA PARCIAL LIQUIDADA (A|fffd||fffd|ES)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de venda parcial e finalizar pend|fffd|ncia
                                            contLinha = 5
                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                            Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                            If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                Sheets("carteiraOp").Activate
                                                Cells(contLinha, 3).Select
                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                
                                                Else
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                            
                                            End If
                                            Loop
                                    
' bloqueia planilhas em uso
                                            Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Call planAutoSave
                                            MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Else
                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA TOTAL (A|fffd||fffd|ES)
                                            If tipoOrdem = "Venda total" Then
                
' desbloqueia planilhas em uso
                                                Sheets("a|fffd||fffd|esCompras").Unprotect
                                                Sheets("a|fffd||fffd|esVendas").Unprotect
                                                Sheets("a|fffd||fffd|esCarteira").Unprotect
                                                Sheets("a|fffd||fffd|esProventos").Unprotect
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("carteiraOp").Unprotect
                                                Sheets("opEspeciaisExec").Unprotect
                                        
' inicia registros
                                                statusOperacao = "0"
                                                Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
        
' loop para localizar linha vazia
                                                If Sheets("a|fffd||fffd|esVendas").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("a|fffd||fffd|esVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                                Sheets("a|fffd||fffd|esVendas").Cells(5, 6) = corretora
                                                Sheets("a|fffd||fffd|esVendas").Cells(6, 6) = codigoAtivo
    
' obtem valor de pmCompra
                                                pmCompra = Sheets("a|fffd||fffd|esVendas").Cells(13, 8)
    
' registra dados na tabela
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = data
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAtivo
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 7) = qtde
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 8) = valorUnit
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 11) = valorTotal
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = ghostCell
                                                Sheets("a|fffd||fffd|esVendas").Activate
                                                
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                Range("tabA|fffd||fffd|esVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call acoesVendasClassificar
                                                Call ajustaGhostCell
                                                
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                                statusOperacao = "2"
                                                Sheets("a|fffd||fffd|esVendas").Cells(4, 14) = statusOperacao
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA (A|fffd||fffd|ES)
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                contLinha = 18
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6) = 0
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                                Loop
                                        
                                                If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivo And Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                    Sheets("a|fffd||fffd|esCarteira").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS (A|fffd||fffd|ES)
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                contLinha = 23
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
                                                
                                                If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo Then
                                                    Sheets("a|fffd||fffd|esCompras").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
        
                                                End If
                                                Loop
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS DA A|fffd||fffd|O VENDIDA
' deleta opera|fffd||fffd|es especiais realizadas com o c|fffd|digo do ativo vendido
                                                contLinha = 5
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                
                                                If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAtivo Then
                                                    Sheets("opEspeciaisExec").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA TOTAL EM CAIXA (A|fffd||fffd|ES)
' tipoOperacao = "Venda de Ativos"
' origem = "B3"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
                                                
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE VENDA TOTAL LIQUIDADA (A|fffd||fffd|ES)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de venda total e finalizar pend|fffd|ncia
                                                contLinha = 5
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                                If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                    Sheets("carteiraOp").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                
                                                End If
                                                Loop
                                                
' bloqueia planilhas em uso
                                                Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Call planAutoSave
                                                MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        
' finaliza liquida|fffd||fffd|es de a|fffd||fffd|es
                                            End If
                                        End If
                                    End If
                                End If
                                Else
                                
'/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// LIQUIDA|fffd||fffd|O DE ETFS
'*************************************************************************************************************************** REGISTRA RECOMPRA (ETFS)
' identifica tipo de opera|fffd||fffd|o para v|fffd|nculo de carteira
                                If tipoInvest = "ETFs" Then
                                
' identifica tipo de opera|fffd||fffd|o
                                    If tipoOrdem = "Recompra" Then
                                    
' desbloqueia planilhas em uso
                                        Sheets("etfsCompras").Unprotect
                                        Sheets("carteiraCaixa").Unprotect
                                        Sheets("carteiraOp").Unprotect

' inicia registros
                                        statusOperacao = "0"
                                        Sheets("etfsCompras").Cells(4, 14) = statusOperacao
        
' loop para localizar linha vazia
                                        If Sheets("etfsCompras").Cells(23, 3) = "" Then
                                            contLinha = 23
                                            Else
                                            contLinha = Sheets("etfsCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
            
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                        Sheets("etfsCompras").Cells(5, 6) = corretora
                                        Sheets("etfsCompras").Cells(6, 6) = codigoAtivo
            
' registra dados na tabela
                                        Sheets("etfsCompras").Cells(contLinha, 3) = data
                                        Sheets("etfsCompras").Cells(contLinha, 4) = codigoAtivo
                                        Sheets("etfsCompras").Cells(contLinha, 7) = qtde
                                        Sheets("etfsCompras").Cells(contLinha, 8) = valorUnit
                                        Sheets("etfsCompras").Cells(contLinha, 11) = valorTotal
                                        Sheets("etfsCompras").Cells(contLinha, 14) = corretora
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                        Range("tabETFsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call etfsComprasClassificar
            
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                        statusOperacao = "2"
                                        Sheets("etfsCompras").Cells(4, 14) = statusOperacao
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA RECOMPRA EM CAIXA (ETFS)
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "B3"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                            contLinha = 20
                                            Else
                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
                                        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call carteiraCaixaClassificar
                                        Call carteiraCaixaID
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE RECOMPRA LIQUIDADA (ETFS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de recompra e finalizar pend|fffd|ncia
                                        contLinha = 5
                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                        Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                        If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                            Sheets("carteiraOp").Activate
                                            Cells(contLinha, 3).Select
                                            Selection.ListObject.ListRows(tabLinha).Delete
                                            
                                            Else
                                            contLinha = contLinha + 1
                                            tabLinha = tabLinha + 1
                                        
                                        End If
                                        Loop
                                        
' bloqueia planilhas em uso
                                        Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        
                                        Call planAutoSave
                                        MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Else
                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA COMPRA (ETFS)
                                        If tipoOrdem = "Nova compra" Then
                        
' desbloqueia planilhas em uso
                                            Sheets("etfsCompras").Unprotect
                                            Sheets("etfsCarteira").Unprotect
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("carteiraOp").Unprotect
            
' inicia registros
                                            statusOperacao = "0"
                                            Sheets("etfsCompras").Cells(4, 14) = statusOperacao
            
' loop para localizar linha vazia
                                            If Sheets("etfsCompras").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("etfsCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                            Sheets("etfsCompras").Cells(5, 6) = corretora
                                            Sheets("etfsCompras").Cells(6, 6) = codigoAtivo
            
' registra dados na tabela
                                            Sheets("etfsCompras").Cells(contLinha, 3) = data
                                            Sheets("etfsCompras").Cells(contLinha, 4) = codigoAtivo
                                            Sheets("etfsCompras").Cells(contLinha, 7) = qtde
                                            Sheets("etfsCompras").Cells(contLinha, 8) = valorUnit
                                            Sheets("etfsCompras").Cells(contLinha, 11) = valorTotal
                                            Sheets("etfsCompras").Cells(contLinha, 14) = corretora
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                            Range("tabETFsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call etfsComprasClassificar
        
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                            statusOperacao = "2"
                                            Sheets("etfsCompras").Cells(4, 14) = statusOperacao
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA (ETFS)
' loop para localizar linha vazia na carteira
                                            If Sheets("etfsCarteira").Cells(18, 3) = "" Then
                                                contLinha = 18
                                                Else
                                                contLinha = Sheets("etfsCarteira").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
                                            Sheets("etfsCarteira").Cells(contLinha, 3) = codigoAtivo
        
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                            If Sheets("etfsCarteira").Cells(18, 3) <> "" And Sheets("etfsCarteira").Cells(19, 3) = "" Then
                                                Call etfsCarteiraAjustarGrafico
                                                Else
                                                
                                            End If
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA COMPRA EM CAIXA (ETFS)
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "B3"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE NOVA COMPRA LIQUIDADA (ETFS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de nova compra e finalizar pend|fffd|ncia
                                            contLinha = 5
                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                            Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                            If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                Sheets("carteiraOp").Activate
                                                Cells(contLinha, 3).Select
                                                Selection.ListObject.ListRows(tabLinha).Delete
        
                                                Else
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                            
                                            End If
                                            Loop
                                
' bloqueia planilhas em uso
                                            Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Call planAutoSave
                                            MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Else
                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA PARCIAL (ETFS)
' identifica tipo de opera|fffd||fffd|o
                                            If tipoOrdem = "Venda parcial" Then
        
' desbloqueia planilhas em uso
                                                Sheets("etfsVendas").Unprotect
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("carteiraOp").Unprotect
            
' inicia registros
                                                statusOperacao = "0"
                                                Sheets("etfsVendas").Cells(4, 14) = statusOperacao
        
' loop para localizar linha vazia
                                                If Sheets("etfsVendas").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("etfsVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                                Sheets("etfsVendas").Cells(5, 6) = corretora
                                                Sheets("etfsVendas").Cells(6, 6) = codigoAtivo
            
' obtem valor de pmCompra
                                                pmCompra = Sheets("etfsVendas").Cells(13, 8)
                                    
' registra dados na tabela
                                                Sheets("etfsVendas").Cells(contLinha, 3) = data
                                                Sheets("etfsVendas").Cells(contLinha, 4) = codigoAtivo
                                                Sheets("etfsVendas").Cells(contLinha, 7) = qtde
                                                Sheets("etfsVendas").Cells(contLinha, 8) = valorUnit
                                                Sheets("etfsVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("etfsVendas").Cells(contLinha, 11) = valorTotal
                                                Sheets("etfsVendas").Cells(contLinha, 14) = corretora
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                Range("tabETFsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call etfsVendasClassificar
                                                Call ajustaGhostCell
                                                
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                                statusOperacao = "2"
                                                Sheets("etfsVendas").Cells(4, 14) = statusOperacao
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA PARCIAL EM CAIXA (ETFS)
' tipoOperacao = "Venda de Ativos"
' origem = "B3"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE VENDA PARCIAL LIQUIDADA (ETFS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de venda parcial e finalizar pend|fffd|ncia
                                                contLinha = 5
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                                If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                    Sheets("carteiraOp").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                
                                                End If
                                                Loop
                                        
' bloqueia planilhas em uso
                                                Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Call planAutoSave
                                                MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Else
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA TOTAL (ETFS)
                                                If tipoOrdem = "Venda total" Then
                    
' desbloqueia planilhas em uso
                                                    Sheets("etfsCompras").Unprotect
                                                    Sheets("etfsVendas").Unprotect
                                                    Sheets("etfsCarteira").Unprotect
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("carteiraOp").Unprotect
                                                    Sheets("opEspeciaisExec").Unprotect
                                            
' inicia registros
                                                    statusOperacao = "0"
                                                    Sheets("etfsVendas").Cells(4, 14) = statusOperacao
            
' loop para localizar linha vazia
                                                    If Sheets("etfsVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("etfsVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                                    Sheets("etfsVendas").Cells(5, 6) = corretora
                                                    Sheets("etfsVendas").Cells(6, 6) = codigoAtivo
                                                    
' obtem valor de pmCompra
                                                    pmCompra = Sheets("etfsVendas").Cells(13, 8)
                                                    
' registra dados na tabela
                                                    Sheets("etfsVendas").Cells(contLinha, 3) = data
                                                    Sheets("etfsVendas").Cells(contLinha, 4) = codigoAtivo
                                                    Sheets("etfsVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("etfsVendas").Cells(contLinha, 8) = valorUnit
                                                    Sheets("etfsVendas").Cells(contLinha, 9) = pmCompra
                                                    Sheets("etfsVendas").Cells(contLinha, 11) = valorTotal
                                                    Sheets("etfsVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                    Sheets("etfsVendas").Cells(contLinha, 16) = ghostCell
                                                    
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                    Range("tabETFsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call etfsVendasClassificar
                                                    Call ajustaGhostCell
                                                    
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                                    statusOperacao = "2"
                                                    Sheets("etfsVendas").Cells(4, 14) = statusOperacao
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA (ETFS)
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                            
                                                    If Sheets("etfsCarteira").Cells(contLinha, 3) = codigoAtivo And Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                        Sheets("etfsCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS (ETFS)
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("etfsCompras").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("etfsCompras").Cells(contLinha, 4) = codigoAtivo Then
                                                        Sheets("etfsCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
            
                                                    End If
                                                    Loop
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA TOTAL EM CAIXA (ETFS)
' tipoOperacao = "Venda de Ativos"
' origem = "B3"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
                                                    
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE VENDA TOTAL LIQUIDADA (ETFS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de venda total e finalizar pend|fffd|ncia
                                                    contLinha = 5
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                                    If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                        Sheets("carteiraOp").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                    
                                                    End If
                                                    Loop
                                                    
' bloqueia planilhas em uso
                                                    Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Call planAutoSave
                                                    MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            
' finaliza liquida|fffd||fffd|es de etfs
                                                End If
                                            End If
                                        End If
                                    End If
                                    
                                    Else
                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIQUIDA|fffd||fffd|O DE FIIS
                                    If tipoInvest = "Fundos Imobili|fffd|rios" Then
        
' identifica tipo de opera|fffd||fffd|o
                                        If tipoOrdem = "Recompra" Then
        
' desbloqueia planilhas em uso
                                            Sheets("fiisCompras").Unprotect
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("carteiraOp").Unprotect
            
' inicia registros
                                            statusOperacao = "0"
                                            Sheets("fiisCompras").Cells(4, 14) = statusOperacao
            
' loop para localizar linha vazia
                                            If Sheets("fiisCompras").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("fiisCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                            Sheets("fiisCompras").Cells(5, 6) = corretora
                                            Sheets("fiisCompras").Cells(6, 6) = codigoAtivo
            
' registra dados na tabela
                                            Sheets("fiisCompras").Cells(contLinha, 3) = data
                                            Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivo
                                            Sheets("fiisCompras").Cells(contLinha, 7) = qtde
                                            Sheets("fiisCompras").Cells(contLinha, 8) = valorUnit
                                            Sheets("fiisCompras").Cells(contLinha, 11) = valorTotal
                                            Sheets("fiisCompras").Cells(contLinha, 14) = corretora
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                            Range("tabFIIsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call fiisComprasClassificar
        
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                            statusOperacao = "2"
                                            Sheets("fiisCompras").Cells(4, 14) = statusOperacao
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA RECOMPRA EM CAIXA (FIIS)
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "B3"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE RECOMPRA LIQUIDADA (FIIS)
' loop para deletar pend|fffd|ncia ap|fffd|s registro de recompra e finalizar pend|fffd|ncia
                                            contLinha = 5
                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                            Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                            If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                Sheets("carteiraOp").Activate
                                                Cells(contLinha, 3).Select
                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                
                                                Else
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                            
                                            End If
                                            Loop
                                    
' bloqueia planilhas em uso
                                            Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Call planAutoSave
                                            MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Else
                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA COMPRA (FIIS)
                                            If tipoOrdem = "Nova compra" Then
            
' desbloqueia planilhas em uso
                                                Sheets("fiisCompras").Unprotect
                                                Sheets("fiisCarteira").Unprotect
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("carteiraOp").Unprotect
            
' inicia registros
                                                statusOperacao = "0"
                                                Sheets("fiisCompras").Cells(4, 14) = statusOperacao
            
' loop para localizar linha vazia
                                                If Sheets("fiisCompras").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("fiisCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                                Sheets("fiisCompras").Cells(5, 6) = corretora
                                                Sheets("fiisCompras").Cells(6, 6) = codigoAtivo
            
' registra dados na tabela
                                                Sheets("fiisCompras").Cells(contLinha, 3) = data
                                                Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivo
                                                Sheets("fiisCompras").Cells(contLinha, 7) = qtde
                                                Sheets("fiisCompras").Cells(contLinha, 8) = valorUnit
                                                Sheets("fiisCompras").Cells(contLinha, 11) = valorTotal
                                                Sheets("fiisCompras").Cells(contLinha, 14) = corretora
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                Range("tabFIIsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call fiisComprasClassificar
            
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                                statusOperacao = "2"
                                                Sheets("fiisCompras").Cells(4, 14) = statusOperacao
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA (FIIS)
' loop para localizar linha vazia na carteira
                                                If Sheets("fiisCarteira").Cells(18, 3) = "" Then
                                                    contLinha = 18
                                                    Else
                                                    contLinha = Sheets("fiisCarteira").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("fiisCarteira").Cells(contLinha, 3) = codigoAtivo
            
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                If Sheets("fiisCarteira").Cells(18, 3) <> "" And Sheets("fiisCarteira").Cells(19, 3) = "" Then
                                                    Call fiisCarteiraAjustarGrafico
                                                    Else
                                                    
                                                End If
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA COMPRA EM CAIXA (FIIS)
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "B3"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE NOVA COMPRA LIQUIDADA (FIIS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de nova compra e finalizar pend|fffd|ncia
                                                contLinha = 5
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                                If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                    Sheets("carteiraOp").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                
                                                End If
                                                Loop
                                                
' bloqueia planilhas em uso
                                                Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Call planAutoSave
                                                MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA PARCIAL (FIIS)
' identifica tipo de opera|fffd||fffd|o (venda)
                                                If tipoOrdem = "Venda parcial" Then
                                    
' desbloqueia planilhas em uso
                                                    Sheets("fiisVendas").Unprotect
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("carteiraOp").Unprotect
            
' inicia registros
                                                    statusOperacao = "0"
                                                    Sheets("fiisVendas").Cells(4, 14) = statusOperacao
            
' loop para localizar linha vazia
                                                    If Sheets("fiisVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("fiisVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                                    Sheets("fiisVendas").Cells(5, 6) = corretora
                                                    Sheets("fiisVendas").Cells(6, 6) = codigoAtivo
            
' obtem valor de pmCompra
                                                    pmCompra = Sheets("fiisVendas").Cells(13, 8)
                                        
' registra dados na tabela
                                                    Sheets("fiisVendas").Cells(contLinha, 3) = data
                                                    Sheets("fiisVendas").Cells(contLinha, 4) = codigoAtivo
                                                    Sheets("fiisVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("fiisVendas").Cells(contLinha, 8) = valorUnit
                                                    Sheets("fiisVendas").Cells(contLinha, 9) = pmCompra
                                                    Sheets("fiisVendas").Cells(contLinha, 11) = valorTotal
                                                    Sheets("fiisVendas").Cells(contLinha, 14) = corretora
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                    Range("tabFIIsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call fiisVendasClassificar
                                                    Call ajustaGhostCell
                                                    
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                                    statusOperacao = "2"
                                                    Sheets("fiisVendas").Cells(4, 14) = statusOperacao
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA PARCIAL EM CAIXA (FIIS)
' tipoOperacao = "Venda de Ativos"
' origem = "B3"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
                                                    
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE VENDA PARCIAL LIQUIDADA (FIIS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de venda parcial e finalizar pend|fffd|ncia
                                                    contLinha = 5
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                                    If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                        Sheets("carteiraOp").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                    
                                                    End If
                                                    Loop
                                                    
' bloqueia planilhas em uso
                                                    Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Call planAutoSave
                                                    MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Else
                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA TOTAL (FIIS)
                                                    If tipoOrdem = "Venda total" Then
                        
' desbloqueia planilhas em uso
                                                        Sheets("fiisVendas").Unprotect
                                                        Sheets("fiisCarteira").Unprotect
                                                        Sheets("fiisCompras").Unprotect
                                                        Sheets("fiisRendimentos").Unprotect
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("carteiraOp").Unprotect
                                                        Sheets("opEspeciaisExec").Unprotect
                                                        
' inicia registros
                                                        statusOperacao = "0"
                                                        Sheets("fiisVendas").Cells(4, 14) = statusOperacao
            
' loop para localizar linha vazia
                                                        If Sheets("fiisVendas").Cells(23, 3) = "" Then
                                                            contLinha = 23
                                                            Else
                                                            contLinha = Sheets("fiisVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' insere c|fffd|digo do ativo, corretora e status da opera|fffd||fffd|o na tabela de compra
                                                        Sheets("fiisVendas").Cells(5, 6) = corretora
                                                        Sheets("fiisVendas").Cells(6, 6) = codigoAtivo
                                                        
' obtem valor de pmCompra
                                                        pmCompra = Sheets("fiisVendas").Cells(13, 8)
                                                        
' registra dados na tabela
                                                        Sheets("fiisVendas").Cells(contLinha, 3) = data
                                                        Sheets("fiisVendas").Cells(contLinha, 4) = codigoAtivo
                                                        Sheets("fiisVendas").Cells(contLinha, 7) = qtde
                                                        Sheets("fiisVendas").Cells(contLinha, 8) = valorUnit
                                                        Sheets("fiisVendas").Cells(contLinha, 9) = pmCompra
                                                        Sheets("fiisVendas").Cells(contLinha, 11) = valorTotal
                                                        Sheets("fiisVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                        Sheets("fiisVendas").Cells(contLinha, 16) = ghostCell
                                                        
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                        Range("tabFIIsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call fiisVendasClassificar
                                                        Call ajustaGhostCell
                                                        
' finaliza opera|fffd||fffd|o de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
                                                        statusOperacao = "2"
                                                        Sheets("fiisVendas").Cells(4, 14) = statusOperacao
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA (FIIS)
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
                                                        If Sheets("fiisCarteira").Cells(contLinha, 3) = codigoAtivo And Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                            Sheets("fiisCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                        
                                                        End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS DO FII VENDIDO
' deleta opera|fffd||fffd|es especiais realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 5
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoFundo Then
                                                            Sheets("opEspeciaisExec").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA VENDA TOTAL EM CAIXA (FIIS)
' tipoOperacao = "Venda de Ativos"
' origem = "B3"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorTotal
            
' reestabelece formato e classifica|fffd||fffd|o da coluna
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DELETA ORDEM DE VENDA TOTAL LIQUIDADA (FIIS)
' loop para  deletar pend|fffd|ncia ap|fffd|s registro de venda total e finalizar pend|fffd|ncia
                                                        contLinha = 5
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
                                                        If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo And Sheets("carteiraOp").Cells(contLinha, 12) = valorTotal Then
                                                            Sheets("carteiraOp").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                        
                                                        End If
                                                        Loop
                                            
' bloqueia planilhas em uso
                                                        Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Call planAutoSave
                                                        MsgBox tipoOrdem & " de '" & codigoAtivo & "' liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        
' finaliza liquida|fffd||fffd|es de fiis
                                                    End If
                                                End If
                                            End If
                                        End If
                                
' finaliza valida|fffd||fffd|es iniciais
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
                
'*************************************************************************************************************************** FINALIZA|fffd||fffd|O GERAL
            contLinha = 5
            Loop
            
            End If
        End If
    End If
    
End Sub
Sub carteiraOpClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ORDENS
' classifica|fffd||fffd|o crescente por data de opera|fffd||fffd|o
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort. _
        SortFields.Add Key:=Range("tabCarteiraOp[[#Headers],[Data Op.]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por valor da ordem
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort. _
        SortFields.Add Key:=Range("tabCarteiraOp[[#Headers],[Total]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o por status de ordem de status
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort. _
        SortFields.Add Key:=Range("tabCarteiraOp[[#Headers], [Status]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort. _
        SortFields.Add Key:=Range("tabCarteiraOp[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o por tipo de ordem
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort. _
        SortFields.Add Key:=Range("tabCarteiraOp[[#Headers], [Tipo Opera|fffd||fffd|o]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
End Sub
Sub carteiraOpClassificarStatus()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ORDENS
' classifica|fffd||fffd|o por status de ordem de status
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort. _
        SortFields.Add Key:=Range("tabCarteiraOp[[#Headers], [Status]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraOp").ListObjects("tabCarteiraOp").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_CarteiraPosi|fffd||fffd|o"
Sub carteiraPosicaoAtualizacaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA|fffd||fffd|O COMPLETA
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    tipoOpDatabase = "Atualiza|fffd||fffd|o Geral"
    
' confirma atualiza|fffd||fffd|o completa
    Dim confirmaAtualizacaoCompleta As VbMsgBoxResult
    confirmaAtualizacaoCompleta = MsgBox("Deseja confirmar a atualiza|fffd||fffd|o de dados?" & vbNewLine & "Isto levar|fffd| alguns minutos.", _
    vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaAtualizacaoCompleta = vbNo Then
        Exit Sub
        Else
        
' verifica tipo de conex|fffd|o
        Call IsConnected
        If temp = "Finalizar" Then
            temp = ""
            Exit Sub
            Else
            
' inicia contagem de tempo e abre conex|fffd|o database
            Sheets("mercadoIndicadores").Unprotect
            Sheets("carteiraPosi|fffd||fffd|o").Unprotect
            Sheets("carteiraPosi|fffd||fffd|o").Activate
            
            tempoInicial = TimeValue(Now)
            Call databaseUpdateCompleto
            
' retona para dados de mercado
            Sheets("mercadoIndicadores").Cells(3, 13) = DateValue(Now)
            Sheets("mercadoIndicadores").Cells(3, 14) = TimeValue(Now)
            
' finaliza contagem de tempo e opera|fffd||fffd|es
            Sheets("carteiraPosi|fffd||fffd|o").Activate
            Range("A1").Select
            
            tempoFinal = TimeValue(Now)
            tempoTotal = tempoFinal - tempoInicial
            
            Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Call sysLogDatabase
            Call planAutoSave
            Application.StatusBar = ""
            MsgBox "Dados atualizados com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub carteiraPosicaoAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERNA TIPO DE GR|fffd|FICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa gr|fffd|ficos de gerenciamento de risco ou balanceamento
    If Range("N23") = "RISCO" Then
        Sheets("carteiraPosi|fffd||fffd|o").Unprotect
        ActiveSheet.Shapes.Range(Array("imgGrf")).Visible = True
        ActiveSheet.ChartObjects("grfCarteiraRisco").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraBalanceamento").Visible = True
        ActiveSheet.ChartObjects("grfCarteiraExpoInt").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraDiv").Visible = False
        Range("N23") = "BALANCEAMENTO"
        Range("M14") = "Bal"
        Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
        If Range("N23") = "BALANCEAMENTO" Then
            Sheets("carteiraPosi|fffd||fffd|o").Unprotect
            ActiveSheet.Shapes.Range(Array("imgGrf")).Visible = True
            ActiveSheet.ChartObjects("grfCarteiraRisco").Visible = True
            ActiveSheet.ChartObjects("grfCarteiraBalanceamento").Visible = False
            ActiveSheet.ChartObjects("grfCarteiraExpoInt").Visible = False
            ActiveSheet.ChartObjects("grfCarteiraDiv").Visible = False
            Range("N23") = "RISCO"
            Range("M14") = "Bal"
            Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
        
        End If
    End If
    
End Sub
Sub carteiraPosicaoExpo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE GR|fffd|FICO DE EXPOSI|fffd||fffd|O INTERNACIONAL
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' exibe gr|fffd|fico de exposi|fffd||fffd|o internacional
    If Range("M14") = "Expo" Then
        Exit Sub
        Else
        
        Sheets("carteiraPosi|fffd||fffd|o").Unprotect
        ActiveSheet.Shapes.Range(Array("imgGrf")).Visible = True
        ActiveSheet.ChartObjects("grfCarteiraDiv").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraRisco").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraBalanceamento").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraExpoInt").Visible = True
        Range("M14") = "Expo"
        Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub carteiraPosicaoDiv()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE GR|fffd|FICO DE DIVERSIFICA|fffd||fffd|O GERAL
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' exibe gr|fffd|fico de diversifica|fffd||fffd|o
    If Range("M14") = "Div" Then
        Exit Sub
        Else
        
        Sheets("carteiraPosi|fffd||fffd|o").Unprotect
        ActiveSheet.Shapes.Range(Array("imgGrf")).Visible = False
        ActiveSheet.ChartObjects("grfCarteiraRisco").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraBalanceamento").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraExpoInt").Visible = False
        ActiveSheet.ChartObjects("grfCarteiraDiv").Visible = True
        Range("M14") = "Div"
        Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Attribute VB_Name = "M_CarteiraProje|fffd||fffd|es"
Sub carteiraProjecoesCadastrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CADASTRA NOVO OBJETIVO
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("G9") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Else
        
        If Range("G10") = "Erro" Then
            MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Else
        
        End If
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("carteiraProje|fffd||fffd|es").Cells(21, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
    data = Range("A1")
    objetivoPrincipal = Range("E6")
    objetivoSecundario = Range("E7")
    valorTotal = Range("E8")
    prazo = Range("E9")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If objetivoPrincipal = "#Selecionar" Then
        MsgBox "Selecione um objetivo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("E6").Activate
        Exit Sub
        Else
        
        If objetivoPrincipal = "Outros" And objetivoSecundario = "#Informe seu objetivo" Then
            MsgBox "Digite um nome para seu objetivo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("E7").Activate
            Exit Sub
            Else
            
            If valorTotal = 0 Then
                MsgBox "Informe o valor total do objetivo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("E8").Activate
                Exit Sub
                Else
                
                If prazo = 0 Then
                    MsgBox "Informe o prazo (em meses) para alcance do objetivo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E9").Activate
                    Exit Sub
                    Else
                    
'*************************************************************************************************************************** REGISTRO DE OBJETIVO
' valida tipo de objetivo
                    If objetivoSecundario = "" Then
                        objetivo = objetivoPrincipal
                        Else
                        objetivo = objetivoSecundario
                        
                    End If
                    
' verifica se objetivo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                    contLinha = 17
                    temp = " (+)"
                    Do Until Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = "" Or _
                    Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = objetivo And Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 6) = valorTotal
                    If Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = objetivo And Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 6) = valorTotal Then
                        MsgBox "O objetivo indicado j|fffd| est|fffd| cadastrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        Else
                        
' insere numera|fffd||fffd|o para identificar objetivos com nomes iguais
                        If Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = objetivo And Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 6) <> valorTotal Then
                            objetivo = objetivo & temp
                            
                        End If
                    End If
                    
                    contLinha = contLinha + 1
                    Loop
                    
' confirma|fffd||fffd|o para registro dos dados
                    Dim confirmaObjetivo As VbMsgBoxResult
                    confirmaObjetivo = MsgBox("Confirma o registro de '" & objetivo & "' como objetivo?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaObjetivo = vbNo Then
                        Exit Sub
                        Else
                        
' localiza linha vazia na tabela de objetivos e registra dados
                        Sheets("carteiraProje|fffd||fffd|es").Unprotect
                        
                        If Sheets("carteiraProje|fffd||fffd|es").Cells(17, 3) = "" Then
                            contLinha = 17
                            Else
                            contLinha = Sheets("carteiraProje|fffd||fffd|es").Cells(Rows.Count, 3).End(xlUp).Row + 1
                            
                        End If
                        
                        Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = objetivo
                        Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3).HorizontalAlignment = xlGeneral
                        Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3).InsertIndent 2
                        Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 6) = valorTotal
                        Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 7) = prazo
                        Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 8) = data

' reestabelece formato das colunas
                        Range("tabCarteiraProje|fffd||fffd|es[Data Inclus|fffd|o]").NumberFormat = "dd/mm/yyyy"
                        Call carteiraProjecoesLimpar
                        Call carteiraProjecoesClassificar

                        Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        
' finaliza|fffd||fffd|o geral
                        Range("E6").Select
                        Call planAutoSave
                        MsgBox "Objetivo registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub carteiraProjecoesLimpar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA CAMPOS DE REGISTRO
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E6") = "#Selecionar" And Range("E8") = 0 And Range("E9") = 0 Then
        Exit Sub
        Else
        
' realiza limpeza dos dados
        Range("E6") = "#Selecionar"
        Range("E8") = "0"
        Range("E9") = "0"
        Range("E15") = "#Selecionar"

    End If
    
End Sub
Sub carteiraProjecoesEditar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O DE CAMPOS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' identifica linhas com objetivos
    contLinha = 17
    Do Until Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = "" Or Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) <> ""
    contLinha = contLinha + 1
    Loop

    If Range("E15") = "#Selecionar" Or Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhum objetivo dispon|fffd|vel para altera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

' loop para reconhecimento do objetivo e liberar edi|fffd||fffd|o
        If Sheets("carteiraProje|fffd||fffd|es").Cells(15, 8) = "Editar" Then
            Sheets("carteiraProje|fffd||fffd|es").Unprotect
            
            Sheets("carteiraProje|fffd||fffd|es").Range("tabCarteiraProje|fffd||fffd|es").Locked = True
            Sheets("carteiraProje|fffd||fffd|es").Range("tabCarteiraProje|fffd||fffd|es[Valor]").Locked = False
            Sheets("carteiraProje|fffd||fffd|es").Range("tabCarteiraProje|fffd||fffd|es[Prazo]").Locked = False
            
            Sheets("carteiraProje|fffd||fffd|es").Cells(15, 8) = "Editando"
            ActiveSheet.Shapes.Range(Array("btnEditar")).Visible = False
            ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
            
            Call carteiraProjecoesClassificar
            Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' reconhecimento do status para finalizar edi|fffd||fffd|o
            If Sheets("carteiraProje|fffd||fffd|es").Cells(15, 8) = "Editando" Then
            
                Sheets("carteiraProje|fffd||fffd|es").Unprotect
                Sheets("carteiraProje|fffd||fffd|es").Range("tabCarteiraProje|fffd||fffd|es").Locked = True
                
                Sheets("carteiraProje|fffd||fffd|es").Cells(15, 8) = "Editar"
                ActiveSheet.Shapes.Range(Array("btnEditar")).Visible = True
                ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
                
                Call carteiraProjecoesClassificar
                Range("E15") = "#Selecionar"
                Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                MsgBox "Objetivo alterado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                
            End If
        End If
    End If

End Sub
Sub carteiraProjecoesExibirGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE PROJE|fffd||fffd|ES
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C3") = "CADASTRO DE OBJETIVOS" Then
        Range("E8").Select
        Sheets("carteiraProje|fffd||fffd|es").Unprotect
        ActiveSheet.Shapes.Range(Array("grpProje|fffd||fffd|es")).Visible = True
        Sheets("carteiraProje|fffd||fffd|es").Cells(3, 3) = "PROJE|fffd||fffd|O DE CRESCIMENTO (QUINQUENAL)"
        Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C3") = "PROJE|fffd||fffd|O DE CRESCIMENTO (QUINQUENAL)" Then
            Range("E6").Select
            Sheets("carteiraProje|fffd||fffd|es").Unprotect
            ActiveSheet.Shapes.Range(Array("grpProje|fffd||fffd|es")).Visible = False
            Sheets("carteiraProje|fffd||fffd|es").Cells(3, 3) = "CADASTRO DE OBJETIVOS"
            Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub carteiraProjecoesAjustarGrfAcomp()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** AJUSTA ACOMPANHAMENTO MENSAL DO GR|fffd|FICO DE PROJE|fffd||fffd|ES
' vari|fffd|veis
    tempoInvest = Sheets("carteiraAcompanha").Cells(11, 12)
    grfLarguraUnit = 1.517
    grfLargura = tempoInvest * grfLarguraUnit
    
' seleciona gr|fffd|fico e aplica ajuste
    Sheets("carteiraProje|fffd||fffd|es").Activate
    Sheets("carteiraProje|fffd||fffd|es").Unprotect
    ActiveSheet.Shapes.Range(Array("grpProje|fffd||fffd|es")).Visible = True
    ActiveSheet.Shapes.Range(Array("grpProje|fffd||fffd|es")).Select
    ActiveSheet.Shapes.Range(Array("grfAcomp")).Select
    ActiveChart.PlotArea.Select
    Selection.Width = grfLargura
    
    Sheets("carteiraAcompanha").Activate
    Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub carteiraProjecoesRemoverObjetivo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMO|fffd||fffd|O DE OBEJTIVO INDICADO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    objetivo = Range("E15")

' verifica se h|fffd| edi|fffd||fffd|o em andamento
    If Range("H15") = "Editando" Then
        MsgBox "Ops! Parece que existe uma edi|fffd||fffd|o em andamento; finalize-a.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' valida|fffd||fffd|o inicial para remo|fffd||fffd|o do ativo indicado
        If Range("E15") = "#Selecionar" Then
            MsgBox "Selecione o objetivo a ser removido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            Dim confirmaRemocao As VbMsgBoxResult
            confirmaRemocao = MsgBox("Deseja confirmar a remo|fffd||fffd|o de '" & objetivo & "'?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaRemocao = vbNo Then
                Range("E15") = "#Selecionar"
                Exit Sub
                Else
                
' localiza objetivo indicado na tabela e efetua remo|fffd||fffd|o
                Sheets("carteiraProje|fffd||fffd|es").Unprotect
                contLinha = 17
                tabLinha = ((contLinha * -1) + 1) + contLinha
                
                Do Until Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = ""
                
                If Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = objetivo Then
                    Sheets("carteiraProje|fffd||fffd|es").Activate
                    Cells(contLinha, 3).Select
                    Selection.ListObject.ListRows(tabLinha).Delete
                    Sheets("carteiraProje|fffd||fffd|es").Cells(15, 5) = "#Selecionar"
                    
                    Else
                    contLinha = contLinha + 1
                    tabLinha = tabLinha + 1
                    
                End If
                Loop
                
' finaliza opera|fffd||fffd|es
                Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Call planAutoSave
                MsgBox objetivo & " removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                
            End If
        End If
    End If

End Sub
Sub carteiraProjecoesTooltip()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIP
' dispara aviso importante
    frmTooltipProj.Show
    
End Sub
Sub carteiraProjecoesClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'***************************************************************************************************************************
' classifica|fffd||fffd|o em ordem alfab|fffd|tica por nome do objetivo
    ActiveWorkbook.Worksheets("carteiraProje|fffd||fffd|es").ListObjects("tabCarteiraProje|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("carteiraProje|fffd||fffd|es").ListObjects("tabCarteiraProje|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabCarteiraProje|fffd||fffd|es[[#Headers],[Objetivo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("carteiraProje|fffd||fffd|es").ListObjects("tabCarteiraProje|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_Configura|fffd||fffd|es"
Sub configUpdate()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA ATUALIZA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' identifica resolu|fffd||fffd|o e abre formul|fffd|rio
    resLargura = GetSystemMetrics(SM_CXSCREEN)
    resAltura = GetSystemMetrics(SM_CYSCREEN)
    
    If resLargura < 1920 Then
        frmUpdateB.lblCopyrightB = "Copyright |fffd| " & Year(Now) & " Creatifica. Todos os direitos reservados."
        frmUpdateB.Show
        Else
        
        frmUpdate.lblCopyright = "Copyright |fffd| " & Year(Now) & " Creatifica. Todos os direitos reservados."
        frmUpdate.Show
        
    End If
    
End Sub
Sub configFotoPerfil()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA|fffd||fffd|ES DE FOTO
' gerenciamento de erro
    On Error GoTo errorHandler
    
' busca foto na pasta do computador
    fotoPerfil = Application.GetOpenFilename(FileFilter:="JPG Files(*.jpg;*.jpeg),*.jpg;*.jpeg")
    
' finaliza caso nenhum arquivo seja selecionado
        If fotoPerfil = False Then
            Exit Sub
            Else
        
        End If
        
errorHandler:
    Sheets("config").imgField.Picture = LoadPicture(fotoPerfil)

End Sub
Sub configFotoPerfilRemover()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMO|fffd||fffd|O DE FOTO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
        On Error GoTo errorHandler
        
' remove foto e torna imagem de perfil padr|fffd|o
        fotoPerfil = ThisWorkbook.Path & "\imagery\perfil\_none.jpg"
        Sheets("config").imgField.Picture = LoadPicture(fotoPerfil)
        Exit Sub
        
    End If
    
errorHandler:
    MsgBox "Ops! Parece que sua pasta de imagens foi removida." & vbNewLine & "Obtenha a pasta 'IMAGERY' e comece novamente!", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    ThisWorkbook.Save
    ThisWorkbook.Close
    Exit Sub
    
End Sub
Sub configAjustarLogosCorretoras()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'***************************************************************************************************************************
' vari|fffd|veis
    contLinha = 20
    contUnit = 2
    
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
        Sheets("config").Unprotect
        
' verifica lista de corretoras ativas
        Do Until contLinha = 24
        If Sheets("config").Cells(contLinha, 3) = "" Then
            Sheets("config").Shapes.Range(Array("shpLogoCorretora" & contUnit)).Visible = False
            Else
            Sheets("config").Shapes.Range(Array("shpLogoCorretora" & contUnit)).Visible = True
            
        End If
        
        contLinha = contLinha + 1
        contUnit = contUnit + 1
        
        Loop
        
        Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub
        
    End If
    
End Sub
Sub configFotoAdmin()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ERRO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' busca arquivo na pasta local
        If Dir(ThisWorkbook.Path & "\imagery\perfil\_none.jpg") = vbNullString Then
            strcheck = False
            Else
            strcheck = True
            
        End If
        
' retorna resultado
        If strcheck Then
            
' identifica perfil de acesso
            If Sheets("config").Cells(6, 5) = "Administrador" Then
                fotoPerfil = ThisWorkbook.Path & "\imagery\perfil\admin.jpg"
                Sheets("config").imgField.Picture = LoadPicture(fotoPerfil)
                Else
                
                If Sheets("config").Cells(6, 5) = "Usu|fffd|rio" Then
                    fotoPerfil = ThisWorkbook.Path & "\imagery\perfil\imgPerfil.jpg"
                    Sheets("config").imgField.Picture = LoadPicture(fotoPerfil)
                    Else
                    
                    fotoPerfil = ThisWorkbook.Path & "\imagery\perfil\_none.jpg"
                    Sheets("config").imgField.Picture = LoadPicture(fotoPerfil)
                
                End If
            End If
            
            Exit Sub
            Else
            
            MsgBox "Ops! Parece que sua pasta de imagens foi removida." & vbNewLine & "Obtenha a pasta 'IMAGERY' e comece novamente!", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub configAlterarAcesso()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA SENHA/EMAIL
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' identifica largura e altura
    resLargura = GetSystemMetrics(SM_CXSCREEN)
    resAltura = GetSystemMetrics(SM_CYSCREEN)

' verifica se h|fffd| altera|fffd||fffd|o pendente
    If Sheets("config").Cells(14, 6) = "Salvar Altera|fffd||fffd|es" Then
        MsgBox "Foi encontrada uma altera|fffd||fffd|o pendente em seu Perfil." & vbNewLine & "Ser|fffd| preciso finaliz|fffd|-la para continua|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

' identifica resolu|fffd||fffd|es padr|fffd|o e ajusta janela de altera|fffd||fffd|o
        If resLargura <= 1366 Then
        
' reseta valores e exibe formul|fffd|rio B
            fUsuarioB = Sheets("config").Cells(7, 5)
            fEmailB = Sheets("config").Cells(10, 5)
            frmAtualizarDadosB.txtNovoUsuarioB = fUsuarioB
            frmAtualizarDadosB.txtNovoEmailB = fEmailB
            frmAtualizarDadosB.txtNovaSenhaB = ""
            frmAtualizarDadosB.txtNovaSenhaConfirmaB = ""
            frmAtualizarDadosB.txtNovaSenhaB.SetFocus
            frmAtualizarDadosB.Show
            
            Else
            
' reseta valores e exibe formul|fffd|rio principal
            fUsuario = Sheets("config").Cells(7, 5)
            fEmail = Sheets("config").Cells(10, 5)
            frmAtualizarDados.txtNovoUsuario = fUsuario
            frmAtualizarDados.txtNovoEmail = fEmail
            frmAtualizarDados.txtNovaSenha = ""
            frmAtualizarDados.txtNovaSenhaConfirma = ""
            frmAtualizarDados.txtNovaSenha.SetFocus
            frmAtualizarDados.Show
            
        End If
    End If
    
End Sub
Sub configAlterarPerfil()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA DADOS PESSOAIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' efetua altera|fffd||fffd|o dos dados
    If Range("F14") = "Alterar Perfil" Then
        Sheets("config").Unprotect
        
        If Range("E11") = "Personalizado" Then
            Range("K8:L8").Locked = False
        End If
        
        Range("E11:F11").Locked = False
        Range("F14") = "Salvar Altera|fffd||fffd|es"
        Range("E11").Activate
        Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' finaliza altera|fffd||fffd|es
        If Range("E11") = "Personalizado" And Range("K8") = 0 Or Range("E11") = "Personalizado" And Range("L8") = 0 Then
            MsgBox "Informe os percentuais para cada tipo de ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            contLinha = 5
            nome = Sheets("config").Range("E9")
            perfilInvest = Sheets("config").Range("E11")
            Sheets("config").Unprotect
            Sheets("databaseCadastros").Unprotect
            
            Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = nome Or contLinha = 10
            contLinha = contLinha + 1
            Loop
            
            Sheets("databaseCadastros").Cells(contLinha, 7) = perfilInvest
            Range("E11:F11").Locked = True
            Range("K8:L8").Locked = True
            Sheets("config").Range("F14") = "Alterar Perfil"
            Range("A1").Select
            
            Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            ThisWorkbook.Save
            
            MsgBox "Dados alterados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub configAcessarDatabase()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA ACESSO AO BANCO DE DADOS
' identifica|fffd||fffd|o de perfil/sistema e perfil/investidor
    If Range("E6") = "Administrador" Or Range("N1") = "Alerta j|fffd| emitido" Then
        Sheets("databaseWebA|fffd||fffd|es").Activate
        Exit Sub
        Else
        
        Dim confirmaAcesso As VbMsgBoxResult
        confirmaAcesso = MsgBox("Aten|fffd||fffd|o! A atualiza|fffd||fffd|o dos registros na base de dados |fffd| fundamental para manuten|fffd||fffd|o de informa|fffd||fffd|es recentes dos ativos. Entretanto, a manipula|fffd||fffd|o incorreta dos dados poder|fffd| comprometer o funcionamento correto do sistema." & _
        vbNewLine & vbNewLine & "Deseja realmente continuar?", _
        vbExclamation + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaAcesso = vbNo Then
            Exit Sub
            Else
            Sheets("config").Unprotect
            Sheets("config").Cells(1, 14) = "Alerta j|fffd| emitido"
            Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            Sheets("databaseWebA|fffd||fffd|es").Activate
            
        End If
    End If

End Sub
Sub configModoSigiloso()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA MODO SIGILOSO
' vari|fffd|veis
    contPlan = ActiveSheet.Name

' valida status de visualiza|fffd||fffd|o
    If Sheets("config").Cells(12, 5) = "Completo" Then
    
' libera edi|fffd||fffd|o
        Sheets("config").Unprotect
        Sheets("carteiraPosi|fffd||fffd|o").Unprotect
        
' altera para status sigiloso e oculta tabelas
        Sheets("config").Cells(12, 5) = "Sigiloso"
        Call configModoSigilosoTabON
        
' altera logos dos ativos
        Call acoesCarteiraLogo
        Call etfsCarteiraLogo
        Call fiisCarteiraLogo
        Call tesouroCarteiraLogo
        Call cdbsCarteiraLogo
        Call letrasCarteiraLogo
        Call moedasCarteiraLogo
        
' altera|fffd||fffd|o de |fffd|cones
        Sheets("config").Shapes.Range(Array("btnSigilosoON")).Visible = True
        Sheets("config").Shapes.Range(Array("btnSigilosoOFF")).Visible = False
        Sheets("carteiraPosi|fffd||fffd|o").Shapes.Range(Array("btnSigilosoON")).Visible = True
        Sheets("carteiraPosi|fffd||fffd|o").Shapes.Range(Array("btnSigilosoOFF")).Visible = False
        
' finaliza|fffd||fffd|es
        Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Application.Visible = True
        Sheets(contPlan).Activate
        
'*************************************************************************************************************************** DESATIVA MODO SIGILOSO
        Else
        
' libera edi|fffd||fffd|o
        Sheets("config").Unprotect
        Sheets("carteiraPosi|fffd||fffd|o").Unprotect
        
' reverte status sigiloso e reexibe tabelas
        Sheets("config").Cells(12, 5) = "Completo"
        Call configModoSigilosoTabOFF
        
' altera logos dos ativos
        Call acoesCarteiraLogo
        Call etfsCarteiraLogo
        Call fiisCarteiraLogo
        Call tesouroCarteiraLogo
        Call cdbsCarteiraLogo
        Call letrasCarteiraLogo
        Call moedasCarteiraLogo
        
' altera|fffd||fffd|o de |fffd|cones
        Sheets("config").Shapes.Range(Array("btnSigilosoON")).Visible = False
        Sheets("config").Shapes.Range(Array("btnSigilosoOFF")).Visible = True
        Sheets("carteiraPosi|fffd||fffd|o").Shapes.Range(Array("btnSigilosoON")).Visible = False
        Sheets("carteiraPosi|fffd||fffd|o").Shapes.Range(Array("btnSigilosoOFF")).Visible = True
        
' finaliza|fffd||fffd|es
        Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Application.Visible = True
        Sheets(contPlan).Activate

    End If
    
End Sub
Sub configModoSigilosoTabON()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA MODO SIGILOSO E OCULTA TABELAS
' libera|fffd||fffd|o e edi|fffd||fffd|o em tabelas
    Sheets("mercadoBenchmarks").Unprotect
    Sheets("mercadoBenchmarks").Activate
    Range("tabMercadoBenchmarks").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("mercadoNot|fffd|cias").Unprotect
    Range("tabMercadoNot|fffd|cias").Font.ColorIndex = 2
    Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("ativosRadarRV").Unprotect
    Range("tabAtivosRadarRV").Font.ColorIndex = 2
    Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("ativosRadarMulti").Unprotect
    Range("tabAtivosRadarMulti").Font.ColorIndex = 2
    Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraAcompanha").Unprotect
    Range("tabCarteiraAcompMensal").Font.ColorIndex = 2
    Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraCaixa").Unprotect
    Range("tabCarteiraCaixaOpera|fffd||fffd|es").Font.ColorIndex = 2
    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraOp").Unprotect
    Range("tabCarteiraOp").Font.ColorIndex = 2
    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraProje|fffd||fffd|es").Unprotect
    Range("tabCarteiraProje|fffd||fffd|es").Font.ColorIndex = 2
    Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("opEspeciais").Unprotect
    Range("tabOpEspeciaisRegistros").Font.ColorIndex = 2
    Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("opEspeciaisExec").Unprotect
    Range("tabOpEspeciaisExecutadas").Font.ColorIndex = 2
    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esCarteira").Unprotect
    Sheets("a|fffd||fffd|esCarteira").Activate
    Range("tabA|fffd||fffd|esCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esCompras").Unprotect
    Range("tabA|fffd||fffd|esCompras").Font.ColorIndex = 2
    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esVendas").Unprotect
    Range("tabA|fffd||fffd|esVendas").Font.ColorIndex = 2
    Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esProventos").Unprotect
    Range("tabA|fffd||fffd|esProventos").Font.ColorIndex = 2
    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("etfsCarteira").Unprotect
    Sheets("etfsCarteira").Activate
    Range("tabETFsCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("etfsCompras").Unprotect
    Range("tabETFsCompras").Font.ColorIndex = 2
    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("etfsVendas").Unprotect
    Range("tabETFsVendas").Font.ColorIndex = 2
    Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisCarteira").Unprotect
    Sheets("fiisCarteira").Activate
    Range("tabFIIsCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisCompras").Unprotect
    Range("tabFIIsCompras").Font.ColorIndex = 2
    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisVendas").Unprotect
    Range("tabFIIsVendas").Font.ColorIndex = 2
    Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisRendimentos").Unprotect
    Range("tabFIIsRendimentos").Font.ColorIndex = 2
    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroCarteira").Unprotect
    Sheets("tesouroCarteira").Activate
    Range("tabTesouroCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroCompras").Unprotect
    Range("tabTesouroCompras").Font.ColorIndex = 2
    Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroVendas").Unprotect
    Range("tabTesouroVendas").Font.ColorIndex = 2
    Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroJuros").Unprotect
    Range("tabTesouroJuros").Font.ColorIndex = 2
    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("cdbsCarteira").Unprotect
    Sheets("cdbsCarteira").Activate
    Range("tabCDBsCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("cdbsAplic").Unprotect
    Range("tabCDBsAplica|fffd||fffd|es").Font.ColorIndex = 2
    Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("cdbsResgates").Unprotect
    Range("tabCDBsResgates").Font.ColorIndex = 2
    Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("letrasCarteira").Unprotect
    Sheets("letrasCarteira").Activate
    Range("tabLetrasCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("letrasAplic").Unprotect
    Range("tabLetrasAplica|fffd||fffd|es").Font.ColorIndex = 2
    Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("letrasResgates").Unprotect
    Range("tabLetrasResgates").Font.ColorIndex = 2
    Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fundosCarteira").Unprotect
    Sheets("fundosCarteira").Activate
    Range("tabFundosCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fundosAplic").Unprotect
    Range("tabFundosAplica|fffd||fffd|es").Font.ColorIndex = 2
    Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fundosResgates").Unprotect
    Range("tabFundosResgates").Font.ColorIndex = 2
    Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("coesCarteira").Unprotect
    Sheets("coesCarteira").Activate
    Range("tabCOEsCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("coesAplic").Unprotect
    Range("tabCOEsAplica|fffd||fffd|es").Font.ColorIndex = 2
    Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("coesResgates").Unprotect
    Range("tabCOEsResgates").Font.ColorIndex = 2
    Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("moedasCarteira").Unprotect
    Sheets("moedasCarteira").Activate
    Range("tabMoedasCarteira").Font.ColorIndex = 2
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = True
    Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("moedasCompras").Unprotect
    Range("tabMoedasCompras").Font.ColorIndex = 2
    Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("moedasVendas").Unprotect
    Range("tabMoedasVendas").Font.ColorIndex = 2
    Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

End Sub
Sub configModoSigilosoTabOFF()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA MODO SIGILOSO E EXIBE TABELAS
' libera|fffd||fffd|o e edi|fffd||fffd|o em tabelas
    Sheets("mercadoBenchmarks").Unprotect
    Sheets("mercadoBenchmarks").Activate
    Range("tabMercadoBenchmarks").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("mercadoNot|fffd|cias").Unprotect
    Range("tabMercadoNot|fffd|cias").Font.ColorIndex = 16
    Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("ativosRadarRV").Unprotect
    Range("tabAtivosRadarRV").Font.ColorIndex = 16
    Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("ativosRadarMulti").Unprotect
    Range("tabAtivosRadarMulti").Font.ColorIndex = 16
    Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraAcompanha").Unprotect
    Range("tabCarteiraAcompMensal").Font.ColorIndex = 16
    Sheets("carteiraAcompanha").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraCaixa").Unprotect
    Range("tabCarteiraCaixaOpera|fffd||fffd|es").Font.ColorIndex = 16
    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraOp").Unprotect
    Range("tabCarteiraOp").Font.ColorIndex = 16
    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("carteiraProje|fffd||fffd|es").Unprotect
    Range("tabCarteiraProje|fffd||fffd|es").Font.ColorIndex = 16
    Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("opEspeciais").Unprotect
    Range("tabOpEspeciaisRegistros").Font.ColorIndex = 16
    Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("opEspeciaisExec").Unprotect
    Range("tabOpEspeciaisExecutadas").Font.ColorIndex = 16
    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esCarteira").Unprotect
    Sheets("a|fffd||fffd|esCarteira").Activate
    Range("tabA|fffd||fffd|esCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

    Sheets("a|fffd||fffd|esCompras").Unprotect
    Range("tabA|fffd||fffd|esCompras").Font.ColorIndex = 16
    Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esVendas").Unprotect
    Range("tabA|fffd||fffd|esVendas").Font.ColorIndex = 16
    Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("a|fffd||fffd|esProventos").Unprotect
    Range("tabA|fffd||fffd|esProventos").Font.ColorIndex = 16
    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("etfsCarteira").Unprotect
    Sheets("etfsCarteira").Activate
    Range("tabETFsCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("etfsCompras").Unprotect
    Range("tabETFsCompras").Font.ColorIndex = 16
    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("etfsVendas").Unprotect
    Range("tabETFsVendas").Font.ColorIndex = 16
    Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisCarteira").Unprotect
    Sheets("fiisCarteira").Activate
    Range("tabFIIsCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

    Sheets("fiisCompras").Unprotect
    Range("tabFIIsCompras").Font.ColorIndex = 16
    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisVendas").Unprotect
    Range("tabFIIsVendas").Font.ColorIndex = 16
    Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fiisRendimentos").Unprotect
    Range("tabFIIsRendimentos").Font.ColorIndex = 16
    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroCarteira").Unprotect
    Sheets("tesouroCarteira").Activate
    Range("tabTesouroCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroCompras").Unprotect
    Range("tabTesouroCompras").Font.ColorIndex = 16
    Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroVendas").Unprotect
    Range("tabTesouroVendas").Font.ColorIndex = 16
    Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("tesouroJuros").Unprotect
    Range("tabTesouroJuros").Font.ColorIndex = 16
    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("cdbsCarteira").Unprotect
    Sheets("cdbsCarteira").Activate
    Range("tabCDBsCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("cdbsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("cdbsAplic").Unprotect
    Range("tabCDBsAplica|fffd||fffd|es").Font.ColorIndex = 16
    Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("cdbsResgates").Unprotect
    Range("tabCDBsResgates").Font.ColorIndex = 16
    Sheets("cdbsResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("letrasCarteira").Unprotect
    Sheets("letrasCarteira").Activate
    Range("tabLetrasCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("letrasAplic").Unprotect
    Range("tabLetrasAplica|fffd||fffd|es").Font.ColorIndex = 16
    Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("letrasResgates").Unprotect
    Range("tabLetrasResgates").Font.ColorIndex = 16
    Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fundosCarteira").Unprotect
    Sheets("fundosCarteira").Activate
    Range("tabFundosCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fundosAplic").Unprotect
    Range("tabFundosAplica|fffd||fffd|es").Font.ColorIndex = 16
    Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("fundosResgates").Unprotect
    Range("tabFundosResgates").Font.ColorIndex = 16
    Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("coesCarteira").Unprotect
    Sheets("coesCarteira").Activate
    Range("tabCOEsCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("coesCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("coesAplic").Unprotect
    Range("tabCOEsAplica|fffd||fffd|es").Font.ColorIndex = 16
    Sheets("coesAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("coesResgates").Unprotect
    Range("tabCOEsResgates").Font.ColorIndex = 16
    Sheets("coesResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("moedasCarteira").Unprotect
    Sheets("moedasCarteira").Activate
    Range("tabMoedasCarteira").Font.ColorIndex = 16
    ActiveSheet.Shapes.Range(Array("imgSig")).Visible = False
    Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("moedasCompras").Unprotect
    Range("tabMoedasCompras").Font.ColorIndex = 16
    Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    Sheets("moedasVendas").Unprotect
    Range("tabMoedasVendas").Font.ColorIndex = 16
    Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

End Sub
Sub configInserirCorretora()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** INSERE NOVA CORRETORA
' vari|fffd|veis
    Dim confirmaExclusao As VbMsgBoxResult

' verifica se h|fffd| edi|fffd||fffd|o em andamento
    If Range("K17") = "SALVAR ALTERA|fffd||fffd|ES" Then
        MsgBox "Inclus|fffd|o n|fffd|o permitida. Finalize a edi|fffd||fffd|o em andamento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' loop para localiza|fffd||fffd|o de linha vazia
    contLinha = 19
    Do Until Sheets("config").Cells(contLinha, 3) = "" And Sheets("config").Cells(contLinha, 4) = "" Or _
    Sheets("config").Cells(contLinha, 3) <> "" And Sheets("config").Cells(contLinha, 4) = "#Selecionar" Or _
    Sheets("config").Cells(contLinha, 3) <> "" And Sheets("config").Cells(contLinha, 4) = ""
    contLinha = contLinha + 1
    Loop

' valida|fffd||fffd|o para limite de corretoras
    If Sheets("config").Cells(23, 4) <> "" Then
        MsgBox "O limite de corretoras j|fffd| foi atingido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("D19").Select
        Exit Sub
        Else
        
' c|fffd|lula escondida para identifica|fffd||fffd|o das corretoras
        ghostCell = Sheets("config").Cells(contLinha, 2)
        
' valida sele|fffd||fffd|o da primeira corretora
        If Sheets("config").Cells(contLinha, 3) <> "" And Sheets("config").Cells(contLinha, 4) = "#Selecionar" Then
            MsgBox "Selecione a sua principal corretora de valores.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Cells(contLinha, 4).Select
            
            Sheets("config").Unprotect
            ActiveCell.Locked = False
            Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            Exit Sub
            Else
        
            If Sheets("config").Cells(contLinha, 3) <> "" And Sheets("config").Cells(contLinha, 4) = "" Then
            
' localiza linha com corretora em branco para sele|fffd||fffd|o
                contLinha = 19
                Do Until Sheets("config").Cells(contLinha, 4) = ""
                contLinha = contLinha + 1
                Loop
                
                MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Cells(contLinha, 4).Select
                Exit Sub
                
                Else
                
' insere campo para sele|fffd||fffd|o de corretora e disponibiliza bot|fffd|o de remo|fffd||fffd|o
                ActiveSheet.Unprotect
                If ghostCell = 2 Then
                    Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora2")).Visible = True
                    ActiveSheet.Shapes.Range(Array("shpLogoCorretora2", "shpAcessarCorretora2", "shpRemoveCorretora2")).Visible = True
                    Sheets("config").Cells(contLinha, 3) = ghostCell
                    Sheets("config").Cells(contLinha, 5) = "0"
                    Range("D20").Locked = False
                    Range("D20").Select
                    Else
                    
' esconde bot|fffd|o de remo|fffd||fffd|o 2 e exibe bot|fffd|o de remo|fffd||fffd|o 3
                    If ghostCell = 3 Then
                        ActiveSheet.Shapes.Range(Array("shpRemoveCorretora2")).Visible = False
                        Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora3")).Visible = True
                        ActiveSheet.Shapes.Range(Array("shpLogoCorretora3", "shpAcessarCorretora3", "shpRemoveCorretora3")).Visible = True
                        Sheets("config").Cells(contLinha, 3) = ghostCell
                        Sheets("config").Cells(contLinha, 5) = "0"
                        Range("D21").Locked = False
                        Range("D21").Select
                        Else
                        
' esconde bot|fffd|o de remo|fffd||fffd|o 3 e exibe bot|fffd|o de remo|fffd||fffd|o 4
                        If ghostCell = 4 Then
                            ActiveSheet.Shapes.Range(Array("shpRemoveCorretora2", "shpRemoveCorretora3")).Visible = False
                            Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora4")).Visible = True
                            ActiveSheet.Shapes.Range(Array("shpLogoCorretora4", "shpAcessarCorretora4", "shpRemoveCorretora4")).Visible = True
                            Sheets("config").Cells(contLinha, 3) = ghostCell
                            Sheets("config").Cells(contLinha, 5) = "0"
                            Range("D22").Locked = False
                            Range("D22").Select
                            Else
                            
' esconde bot|fffd|o de remo|fffd||fffd|o 4 e exibe bot|fffd|o de remo|fffd||fffd|o 5
                            If ghostCell = 5 Then
                                Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora5")).Visible = True
                                ActiveSheet.Shapes.Range(Array("shpRemoveCorretora2", "shpRemoveCorretora3", "shpRemoveCorretora4")).Visible = False
                                ActiveSheet.Shapes.Range(Array("shpLogoCorretora5", "shpAcessarCorretora5", "shpRemoveCorretora5")).Visible = True
                                Sheets("config").Cells(contLinha, 3) = ghostCell
                                Sheets("config").Cells(contLinha, 5) = "0"
                                Range("D23").Locked = False
                                Range("D23").Select
                                
                            End If
                        End If
                    End If
                End If
            End If
        End If
    
' finaliza inclus|fffd|es e bloqueia planilha
        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    End If
    
End Sub
Sub configRemoverCorretora1()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE CORRETORA 1
' gerenciamento de erros
    On Error GoTo errorHandler
    
    If Sheets("config").Range("D19") = "#Selecionar" Then
        logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\_none.jpg"
        
        Sheets("config").Unprotect
        Sheets("config").Range("E19") = 0
        Sheets("config").shpLogoCorretora1.Picture = LoadPicture(logoCorretora)
        Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
        Sheets("carteiraCaixa").shpLogoCorretora1.Picture = LoadPicture(logoCorretora)
        
    End If
    
errorHandler:
    Exit Sub
    
End Sub
Sub configRemoverCorretora2()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE CORRETORA 2
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    corretora = Range("D20")
    logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\_none.jpg"
    
' valida poss|fffd|vel edi|fffd||fffd|o em andamento
    If Range("K17") = "SALVAR ALTERA|fffd||fffd|ES" Then
        MsgBox "Exclus|fffd|o n|fffd|o permitida. Finalize a edi|fffd||fffd|o em andamento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' remove corretora em branco
        If corretora = "" Or corretora = "#Selecionar" Then
            MsgBox "Nenhuma corretora selecionada para remo|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("D20").Select
            Exit Sub
            Else
            
' confirma exclus|fffd|o com campo de corretora preenchido
            confirmaExclusao = MsgBox("Deseja confirmar a exclus|fffd|o de " & corretora & "?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            If confirmaExclusao = vbNo Then
                Exit Sub
                Else
                
                ActiveSheet.Unprotect
                Sheets("config").shpLogoCorretora2.Picture = LoadPicture(logoCorretora)
                Sheets("carteiraCaixa").shpLogoCorretora2.Picture = LoadPicture(logoCorretora)
                
                ActiveSheet.Shapes.Range(Array("shpLogoCorretora2", "shpAcessarCorretora2", "shpRemoveCorretora2")).Visible = False
                Cells(20, 3).Select
                Selection.Rows.Delete
                Range("A1").Select
                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                
            End If
        End If
    End If
    
errorHandler:
    Exit Sub
    
End Sub
Sub configRemoverCorretora3()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE CORRETORA 3
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    corretora = Range("D21")
    logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\_none.jpg"
    
' valida poss|fffd|vel edi|fffd||fffd|o em andamento
    If Range("K17") = "SALVAR ALTERA|fffd||fffd|ES" Then
        MsgBox "Exclus|fffd|o n|fffd|o permitida. Finalize a edi|fffd||fffd|o em andamento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' remove corretora em branco
        If corretora = "" Or corretora = "#Selecionar" Then
            MsgBox "Nenhuma corretora selecionada para remo|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("D21").Select
            Exit Sub
            Else
            
' confirma exclus|fffd|o com campo de corretora preenchido
            confirmaExclusao = MsgBox("Deseja confirmar a exclus|fffd|o de " & corretora & "?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            If confirmaExclusao = vbNo Then
                Exit Sub
                Else
                
                ActiveSheet.Unprotect
                Sheets("config").shpLogoCorretora3.Picture = LoadPicture(logoCorretora)
                Sheets("carteiraCaixa").shpLogoCorretora3.Picture = LoadPicture(logoCorretora)
                
                ActiveSheet.Shapes.Range(Array("shpLogoCorretora3", "shpAcessarCorretora3", "shpRemoveCorretora3")).Visible = False
                Cells(21, 3).Select
                Selection.Rows.Delete
                ActiveSheet.Shapes.Range(Array("shpRemoveCorretora2")).Visible = True
                Range("A1").Select
                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                
            End If
        End If
    End If
    
errorHandler:
    Exit Sub
    
End Sub
Sub configRemoverCorretora4()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE CORRETORA 4
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    corretora = Range("D22")
    logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\_none.jpg"
    
' valida poss|fffd|vel edi|fffd||fffd|o em andamento
    If Range("K17") = "SALVAR ALTERA|fffd||fffd|ES" Then
        MsgBox "Exclus|fffd|o n|fffd|o permitida. Finalize a edi|fffd||fffd|o em andamento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' remove corretora em branco
        If corretora = "" Or corretora = "#Selecionar" Then
            MsgBox "Nenhuma corretora selecionada para remo|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("D22").Select
            Exit Sub
            Else
            
' confirma exclus|fffd|o com campo de corretora preenchido
            confirmaExclusao = MsgBox("Deseja confirmar a exclus|fffd|o de " & corretora & "?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            If confirmaExclusao = vbNo Then
                Exit Sub
                Else
                
                ActiveSheet.Unprotect
                Sheets("config").shpLogoCorretora4.Picture = LoadPicture(logoCorretora)
                Sheets("carteiraCaixa").shpLogoCorretora4.Picture = LoadPicture(logoCorretora)
                
                ActiveSheet.Shapes.Range(Array("shpLogoCorretora4", "shpAcessarCorretora4", "shpRemoveCorretora4")).Visible = False
                Cells(22, 3).Select
                Selection.Rows.Delete
                ActiveSheet.Shapes.Range(Array("shpRemoveCorretora3")).Visible = True
                Range("A1").Select
                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                
            End If
        End If
    End If
    
errorHandler:
    Exit Sub
    
End Sub
Sub configRemoverCorretora5()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE CORRETORA 5
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    corretora = Range("D23")
    logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\_none.jpg"
    
' valida poss|fffd|vel edi|fffd||fffd|o em andamento
    If Range("K17") = "SALVAR ALTERA|fffd||fffd|ES" Then
        MsgBox "Exclus|fffd|o n|fffd|o permitida. Finalize a edi|fffd||fffd|o em andamento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' remove corretora em branco
        If corretora = "" Or corretora = "#Selecionar" Then
            MsgBox "Nenhuma corretora selecionada para remo|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("D23").Select
            Exit Sub
            Else
            
' confirma exclus|fffd|o com campo de corretora preenchido
            confirmaExclusao = MsgBox("Deseja confirmar a exclus|fffd|o de " & corretora & "?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            If confirmaExclusao = vbNo Then
                Exit Sub
                Else
                
                ActiveSheet.Unprotect
                Sheets("config").shpLogoCorretora5.Picture = LoadPicture(logoCorretora)
                Sheets("carteiraCaixa").shpLogoCorretora5.Picture = LoadPicture(logoCorretora)
                
                ActiveSheet.Shapes.Range(Array("shpLogoCorretora5", "shpAcessarCorretora5", "shpRemoveCorretora5")).Visible = False
                Cells(23, 3).Select
                Selection.Rows.Delete
                ActiveSheet.Shapes.Range(Array("shpRemoveCorretora4")).Visible = True
                Range("A1").Select
                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                
            End If
        End If
    End If
    
errorHandler:
    Exit Sub
    
End Sub
Sub configAcessarCorretora1()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 1
' valida|fffd||fffd|o de site indispon|fffd|vel
    If Range("M19") = 0 Then
        MsgBox "Ops! Parece que o link desta corretora est|fffd| indispon|fffd|vel. Verifique seu status na base de dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' acessa site da corretora 1
        If Range("M19") <> "-" Then
            ActiveWorkbook.FollowHyperlink Address:=Range("M19")
            Else
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub configAcessarCorretora2()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 2
' valida|fffd||fffd|o de site indispon|fffd|vel
    If Range("M20") = 0 Then
        MsgBox "Ops! Parece que o link desta corretora est|fffd| indispon|fffd|vel. Verifique seu status na base de dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' acessa site da corretora 2
        If Range("M20") <> "-" Then
            ActiveWorkbook.FollowHyperlink Address:=Range("M20")
            Else
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub configAcessarCorretora3()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 3
' valida|fffd||fffd|o de site indispon|fffd|vel
    If Range("M21") = 0 Then
        MsgBox "Ops! Parece que o link desta corretora est|fffd| indispon|fffd|vel. Verifique seu status na base de dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' acessa site da corretora 3
        If Range("M21") <> "-" Then
            ActiveWorkbook.FollowHyperlink Address:=Range("M21")
            Else
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub configAcessarCorretora4()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 4
' valida|fffd||fffd|o de site indispon|fffd|vel
    If Range("M22") = 0 Then
        MsgBox "Ops! Parece que o link desta corretora est|fffd| indispon|fffd|vel. Verifique seu status na base de dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' acessa site da corretora 4
        If Range("M22") <> "-" Then
            ActiveWorkbook.FollowHyperlink Address:=Range("M22")
            Else
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub configAcessarCorretora5()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA CORRETORA 5
' valida|fffd||fffd|o de site indispon|fffd|vel
    If Range("M23") = 0 Then
        MsgBox "Ops! Parece que o link desta corretora est|fffd| indispon|fffd|vel. Verifique seu status na base de dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' acessa site da corretora 5
        If Range("M23") <> "-" Then
            ActiveWorkbook.FollowHyperlink Address:=Range("M23")
            Else
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub configEditarCorretoras()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA DADOS DE CORRETORAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' loop para localizar poss|fffd|vel inclus|fffd|o de corretora aberta
    contLinha = 19
    Do Until Sheets("config").Cells(contLinha, 3) <> "" And Sheets("config").Cells(contLinha, 4) = "" Or contLinha >= 24
    contLinha = contLinha + 1
    Loop
    
' impede altera|fffd||fffd|o de corretoras caso esteja aberta nova inser|fffd||fffd|o
    If Sheets("config").Cells(contLinha, 3) <> "" And Sheets("config").Cells(contLinha, 4) = "" Or _
    Sheets("config").Cells(contLinha, 4) = "#Selecionar" Then
        MsgBox "Edi|fffd||fffd|o n|fffd|o permitida. Finalize a inser|fffd||fffd|o da nova corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' valida status de edi|fffd||fffd|o
    If Range("K17") = "SALVAR ALTERA|fffd||fffd|ES" Then
        ActiveSheet.Unprotect
        Range("tabConfigCorretoras").Locked = True
        Range("K17") = "EDITAR CORRETORAS"
        Range("A1").Select
        MsgBox "Dados alterados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
' libera tabela e inicia edi|fffd||fffd|es
        ActiveSheet.Unprotect
        If Range("C20") = "" Then
            Range("D19").Locked = False
            Range("D19").Select
            Else
            
            If Range("C20") <> "" And Range("C21") = "" Then
                Range("D19:D20").Locked = False
                Range("D20").Select
                Else
                
                If Range("C21") <> "" And Range("C22") = "" Then
                    Range("D19:D21").Locked = False
                    Range("D21").Select
                    Else
                    
                    If Range("C22") <> "" And Range("C23") = "" Then
                        Range("D19:D22").Locked = False
                        Range("D22").Select
                        Else
                        
                        If Range("C23") <> "" Then
                            Range("D19:D23").Locked = False
                            Range("D23").Select
                        
                        End If
                    End If
                End If
            End If
        End If
    End If

' altera status para edi|fffd||fffd|o em andamento
    Sheets("config").Cells(17, 11) = "SALVAR ALTERA|fffd||fffd|ES"
    Range("A1").Select
    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

End Sub
Sub configLimpezaGeral()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPEZA DE DADOS TEMPOR|fffd|RIOS
' valida|fffd||fffd|o
    If Sheets("config").Cells(11, 5) = "#Selecionar" Or Sheets("config").Cells(19, 4) = "#Selecionar" Then
        Exit Sub
        Else
        
        If Sheets("carteiraOp").Cells(5, 3) <> "" Then
            MsgBox "Ops! Foram encontradas ordens pendentes de liquida|fffd||fffd|o. Liquide-as antes de prosseguir.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            Dim confirmaLimpeza As VbMsgBoxResult
            'confirmaLimpeza = MsgBox("Esta opera|fffd||fffd|o ir|fffd| limpar seu hist|fffd|rico de Caixa, vendas e resgates finalizados. Deseja realmente continuar?", _
            vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            confirmaLimpeza = MsgBox("Esta opera|fffd||fffd|o ira limpar todos os dados tempor|fffd|rios da aplica|fffd||fffd|o. Deseja limpar tamb|fffd|m os registros de vendas e resgates conclu|fffd|dos?", _
            vbQuestion + vbYesNoCancel, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            If confirmaLimpeza = vbCancel Then
                Exit Sub
                Else
                
                If confirmaLimpeza = vbYes Then
                    
'*************************************************************************************************************************** LIMPEZA TOTAL
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO CAIXA
' vari|fffd|veis
                    valorCorretora1 = Sheets("carteiraCaixa").Range("C15")
                    valorCorretora2 = Sheets("carteiraCaixa").Range("E15")
                    valorCorretora3 = Sheets("carteiraCaixa").Range("G15")
                    valorCorretora4 = Sheets("carteiraCaixa").Range("I15")
                    valorCorretora5 = Sheets("carteiraCaixa").Range("K15")
                    valorCC = Sheets("carteiraCaixa").Range("N15")
                    valorPoup = Sheets("carteiraCaixa").Range("N16")
                    
                    contLinha = 20
                    tabLinha = ((contLinha * -1) + 1) + contLinha
                    
' loop para localiza|fffd||fffd|o de status confirmada
                    If Sheets("carteiraCaixa").Cells(contLinha, 3) <> "" Then
                        Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA"
                        contLinha = contLinha + 1
                        tabLinha = tabLinha + 1
                        Loop
                        
                        If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) <> "CONFIRMADA" Then
                            Else
                            
' registra valores em c|fffd|lula auxiliar
                            Sheets("carteiraCaixa").Unprotect
                            Sheets("config").Unprotect
                            
                            Sheets("carteiraCaixa").Cells(13, 4) = valorCorretora1
                            Sheets("carteiraCaixa").Cells(13, 6) = valorCorretora2
                            Sheets("carteiraCaixa").Cells(13, 8) = valorCorretora3
                            Sheets("carteiraCaixa").Cells(13, 10) = valorCorretora4
                            Sheets("carteiraCaixa").Cells(13, 12) = valorCorretora5
                            Sheets("carteiraCaixa").Cells(13, 13) = valorCC
                            Sheets("carteiraCaixa").Cells(13, 14) = valorPoup
                            
' registra saldo na tabela corretoras configura|fffd||fffd|es
                            If Sheets("config").Cells(19, 3) = 1 Then
                                Sheets("config").Cells(19, 5) = valorCorretora1
                                Else
                            End If
                            
                            If Sheets("config").Cells(20, 3) = 2 Then
                                Sheets("config").Cells(20, 5) = valorCorretora2
                                Else
                            End If
                            
                            If Sheets("config").Cells(21, 3) = 3 Then
                                Sheets("config").Cells(21, 5) = valorCorretora3
                                Else
                            End If
                            
                            If Sheets("config").Cells(22, 3) = 4 Then
                                Sheets("config").Cells(22, 5) = valorCorretora4
                                Else
                            End If
                            
                            If Sheets("config").Cells(23, 3) = 5 Then
                                Sheets("config").Cells(23, 5) = valorCorretora5
                                Else
                            End If
                            
' loop para limpeza de todas as linhas confirmadas
                            Do Until Sheets("carteiraCaixa").Cells(contLinha, 14) = ""
                            If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                                Sheets("carteiraCaixa").Activate
                                Cells(contLinha, 3).Select
                                Selection.ListObject.ListRows(tabLinha).Delete
                                Else
                                
                                contLinha = contLinha + 1
                                tabLinha = tabLinha + 1
                                
                            End If
                            Loop
                            
' finaliza opera|fffd||fffd|es
                            Call carteiraCaixaID
                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            
                        End If
                    End If
                    
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO VENDAS
' limpeza de vendas totais
                    Sheets("a|fffd||fffd|esVendas").Unprotect
                    Sheets("etfsVendas").Unprotect
                    Sheets("fiisVendas").Unprotect
                    Sheets("tesouroVendas").Unprotect
                    Sheets("moedasVendas").Unprotect
                    
' vendas de a|fffd||fffd|es
                    contLinha = 23
                    
                    Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = ""
                    If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("a|fffd||fffd|esVendas").Activate
                        Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' vendas de etfs
                    contLinha = 23
                    
                    Do Until Sheets("etfsVendas").Cells(contLinha, 3) = ""
                    If Sheets("etfsVendas").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("etfsVendas").Activate
                        Sheets("etfsVendas").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' vendas de fiis
                    contLinha = 23
                    
                    Do Until Sheets("fiisVendas").Cells(contLinha, 3) = ""
                    If Sheets("fiisVendas").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("fiisVendas").Activate
                        Sheets("fiisVendas").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' vendas de tesouro
                    contLinha = 23
                    
                    Do Until Sheets("tesouroVendas").Cells(contLinha, 3) = ""
                    If Sheets("tesouroVendas").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("tesouroVendas").Activate
                        Sheets("tesouroVendas").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' vendas de moedas
                    contLinha = 23
                    
                    Do Until Sheets("moedasVendas").Cells(contLinha, 3) = ""
                    If Sheets("moedasVendas").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("moedasVendas").Activate
                        Sheets("moedasVendas").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
                    Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("etfsVendas").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("fiisVendas").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("tesouroVendas").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("moedasVendas").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO RESGATES
' limpeza de resgates totais
                    Sheets("cdbsResgates").Unprotect
                    Sheets("letrasResgates").Unprotect
                    Sheets("fundosResgates").Unprotect
                    Sheets("coesResgates").Unprotect
                    
' resgates de cdbs
                    contLinha = 23
                    
                    Do Until Sheets("cdbsResgates").Cells(contLinha, 3) = ""
                    If Sheets("cdbsResgates").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("cdbsResgates").Activate
                        Sheets("cdbsResgates").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' resgates de letras
                    contLinha = 23
                    
                    Do Until Sheets("letrasResgates").Cells(contLinha, 3) = ""
                    If Sheets("letrasResgates").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("letrasResgates").Activate
                        Sheets("letrasResgates").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' resgates de fundos
                    contLinha = 26
                    
                    Do Until Sheets("fundosResgates").Cells(contLinha, 3) = ""
                    If Sheets("fundosResgates").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("fundosResgates").Activate
                        Sheets("fundosResgates").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
' resgates de coes
                    contLinha = 26
                    
                    Do Until Sheets("coesResgates").Cells(contLinha, 3) = ""
                    If Sheets("coesResgates").Cells(contLinha, 16) = "" Then
                        contLinha = contLinha + 1
                        Else
                        
                        Sheets("coesResgates").Activate
                        Sheets("coesResgates").Cells(contLinha, 16) = ""
                        Cells(contLinha, 3).Select
                        Rows(contLinha).EntireRow.Delete
                        
                    End If
                    Loop
                    
                    Sheets("cdbsResgates").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("letrasResgates").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("fundosResgates").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    Sheets("coesResgates").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO LOG
' limpeza de logs
                    Sheets("databaseCadastros").Unprotect
                    
' loop para localiza|fffd||fffd|o de log preenchido
                    contLinha = 11
                    tabLinha = ((contLinha * -1) + 1) + contLinha
                    
                    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = "" Or Sheets("databaseCadastros").Cells(contLinha, 3) <> ""
                    contLinha = contLinha + 1
                    tabLinha = tabLinha + 1
                    Loop
                    
                    If contLinha = 11 And Sheets("databaseCadastros").Cells(contLinha, 3) = "" Then
                        Else
                        
' loop para limpeza de todas as linhas registradas
                        Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
                        If Sheets("databaseCadastros").Cells(contLinha, 3) <> "" Then
                            Sheets("databaseCadastros").Activate
                            Cells(contLinha, 3).Select
                            Selection.ListObject.ListRows(tabLinha).Delete
                            Else
                            
                            contLinha = contLinha + 1
                            tabLinha = tabLinha + 1
                        
                        End If
                        Loop
                    
                    End If
                    
' finaliza|fffd||fffd|o geral
                    Sheets("databaseCadastros").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    
                    Sheets("config").Activate
                    ThisWorkbook.Save
                    MsgBox "Dados tempor|fffd|rios removidos com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
'*************************************************************************************************************************** LIMPEZA PARCIAL, MANTENDO VENDAS E RESGATES
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO CAIXA
' vari|fffd|veis
                    valorCorretora1 = Sheets("carteiraCaixa").Range("C15")
                    valorCorretora2 = Sheets("carteiraCaixa").Range("E15")
                    valorCorretora3 = Sheets("carteiraCaixa").Range("G15")
                    valorCorretora4 = Sheets("carteiraCaixa").Range("I15")
                    valorCorretora5 = Sheets("carteiraCaixa").Range("K15")
                    valorCC = Sheets("carteiraCaixa").Range("N15")
                    valorPoup = Sheets("carteiraCaixa").Range("N16")
                    
                    contLinha = 20
                    tabLinha = ((contLinha * -1) + 1) + contLinha
                    
' loop para localiza|fffd||fffd|o de status confirmada
                    If Sheets("carteiraCaixa").Cells(contLinha, 3) <> "" Then
                        Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA"
                        contLinha = contLinha + 1
                        tabLinha = tabLinha + 1
                        Loop
                        
                        If Sheets("carteiraCaixa").Cells(contLinha, 3) = "" Or Sheets("carteiraCaixa").Cells(contLinha, 14) <> "CONFIRMADA" Then
                            Else
                            
' registra valores em c|fffd|lula auxiliar
                            Sheets("carteiraCaixa").Unprotect
                            Sheets("config").Unprotect
                            
                            Sheets("carteiraCaixa").Cells(13, 4) = valorCorretora1
                            Sheets("carteiraCaixa").Cells(13, 6) = valorCorretora2
                            Sheets("carteiraCaixa").Cells(13, 8) = valorCorretora3
                            Sheets("carteiraCaixa").Cells(13, 10) = valorCorretora4
                            Sheets("carteiraCaixa").Cells(13, 12) = valorCorretora5
                            Sheets("carteiraCaixa").Cells(13, 13) = valorCC
                            Sheets("carteiraCaixa").Cells(13, 14) = valorPoup
                            
' registra saldo na tabela corretoras configura|fffd||fffd|es
                            If Sheets("config").Cells(19, 3) = 1 Then
                                Sheets("config").Cells(19, 5) = valorCorretora1
                                Else
                            End If
                            
                            If Sheets("config").Cells(20, 3) = 2 Then
                                Sheets("config").Cells(20, 5) = valorCorretora2
                                Else
                            End If
                            
                            If Sheets("config").Cells(21, 3) = 3 Then
                                Sheets("config").Cells(21, 5) = valorCorretora3
                                Else
                            End If
                            
                            If Sheets("config").Cells(22, 3) = 4 Then
                                Sheets("config").Cells(22, 5) = valorCorretora4
                                Else
                            End If
                            
                            If Sheets("config").Cells(23, 3) = 5 Then
                                Sheets("config").Cells(23, 5) = valorCorretora5
                                Else
                            End If
                            
' loop para limpeza de todas as linhas confirmadas
                            Do Until Sheets("carteiraCaixa").Cells(contLinha, 14) = ""
                            If Sheets("carteiraCaixa").Cells(contLinha, 14) = "CONFIRMADA" Then
                                Sheets("carteiraCaixa").Activate
                                Cells(contLinha, 3).Select
                                Selection.ListObject.ListRows(tabLinha).Delete
                                Else
                                
                                contLinha = contLinha + 1
                                tabLinha = tabLinha + 1
                                
                            End If
                            Loop
                            
' finaliza opera|fffd||fffd|es
                            Call carteiraCaixaID
                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            
                        End If
                    End If
                    
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO LOG
' limpeza de logs
                    Sheets("databaseCadastros").Unprotect
                    
' loop para localiza|fffd||fffd|o de log preenchido
                    contLinha = 11
                    tabLinha = ((contLinha * -1) + 1) + contLinha
                    
                    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = "" Or Sheets("databaseCadastros").Cells(contLinha, 3) <> ""
                    contLinha = contLinha + 1
                    tabLinha = tabLinha + 1
                    Loop
                    
                    If contLinha = 11 And Sheets("databaseCadastros").Cells(contLinha, 3) = "" Then
                        Else
                        
' loop para limpeza de todas as linhas registradas
                        Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
                        If Sheets("databaseCadastros").Cells(contLinha, 3) <> "" Then
                            Sheets("databaseCadastros").Activate
                            Cells(contLinha, 3).Select
                            Selection.ListObject.ListRows(tabLinha).Delete
                            Else
                            
                            contLinha = contLinha + 1
                            tabLinha = tabLinha + 1
                        
                        End If
                        Loop
                    
                    End If
                    
' finaliza|fffd||fffd|o geral
                    Sheets("databaseCadastros").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                    
                    Sheets("config").Activate
                    ThisWorkbook.Save
                    MsgBox "Dados tempor|fffd|rios removidos com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub


Attribute VB_Name = "M_Contato"
Sub contatoEmailEnviar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA EMAIL
' vari|fffd|veis
    nome = Range("E9")
    emailRemetente = Range("E10")
    emailDestinatario = Range("N3")
    perfilInvest = Range("E11")
    telefone = Range("E12")
    tipoMsg = Range("E7")
    textoMsg = Range("I7")
    
' valida perfil para envio da mensagem
    If Sheets("config").Cells(6, 5) = "Administrador" Then
        MsgBox "Fun|fffd||fffd|o indispon|fffd|vel para o perfil de Administrador.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
    
        If tipoMsg = "Coment|fffd|rio" Or tipoMsg = "Elogio" Or tipoMsg = "Reporte de Erro" Then
            temp = " do "
            Else
            
            If tipoMsg = "Reclama|fffd||fffd|o" Or tipoMsg = "Solicita|fffd||fffd|o" Or tipoMsg = "Sugest|fffd|o" Then
                temp = " da "
                
            End If
        End If
        
' valida campos
        If nome = "Nome completo" Or emailRemetente = "sememail@sememail.com" Or perfilInvest = "#Selecionar" Then
            MsgBox "Ops! Parece que seu perfil ainda n|fffd|o foi definido." & vbNewLine & "Acesse a |fffd|rea de Configura|fffd||fffd|es para realizar os ajustes.", _
            vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If tipoMsg = "#Selecionar" Then
                MsgBox "Selecione o tipo de mensagem.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If tipoMsg = "Cancelamento" Then
                
' confirma cancelamento
                    Dim validaCancelamento As VbMsgBoxResult
                    validaCancelamento = MsgBox("Deseja realmente solicitar o cancelamento da aplica|fffd||fffd|o?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If validaCancelamento = vbNo Then
                        Exit Sub
                        Else
                        
                        Call contatoEmailOutlook
                        Sheets("contato").Unprotect
                        
                        Sheets("contato").Cells(3, 14) = "Aplica|fffd||fffd|o cancelada"
                        Sheets("contato").Cells(7, 5) = "#Selecionar"
                        Sheets("contato").Cells(7, 9) = "Digite aqui sua mensagem..."
                        Sheets("contato").Cells(11, 10) = "Nenhum arquivo em anexo."
                        ActiveSheet.Shapes.Range(Array("icoAnexoInserir")).Visible = True
                        ActiveSheet.Shapes.Range(Array("icoAnexoRemover")).Visible = False
                        MsgBox "Mensagem enviada com sucesso!" & vbNewLine & "Agradecemos o contato e em breve retornaremos.", _
                        vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Sheets("contato").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        
                    End If
                    
' efetiva envio de mensagem caso n|fffd|o seja cancelamento
                    Else
                    
                    If textoMsg = "" Or textoMsg = "Digite aqui sua mensagem..." Or Range("M6") >= 1260 Then
                        MsgBox "Ops! Parece que o texto" & temp & tipoMsg & " est|fffd| muito pequeno.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        Else
                        
' executa fun|fffd||fffd|o para envio de email
                        Call contatoEmailOutlook
                        
' finaliza opera|fffd||fffd|o em caso de falha
                        If temp = "finalizar" Then
                            Exit Sub
                            Else
                            
                        End If
                        
' finaliza|fffd||fffd|es
                        Sheets("contato").Unprotect
                        Sheets("contato").Cells(7, 5) = "#Selecionar"
                        Sheets("contato").Cells(7, 9) = "Digite aqui sua mensagem..."
                        Sheets("contato").Cells(11, 10) = "Nenhum arquivo em anexo."
                        ActiveSheet.Shapes.Range(Array("icoAnexoInserir")).Visible = True
                        ActiveSheet.Shapes.Range(Array("icoAnexoRemover")).Visible = False
                        MsgBox "Mensagem enviada com sucesso!" & vbNewLine & "Agradecemos o contato e em breve retornaremos.", _
                        vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Sheets("contato").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub contatoEmailCancelar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ENVIO
' valida status dos campos de preenchimento
    If Range("E7") = "#Selecionar" And Range("I7") = "Digite aqui sua mensagem..." Then
        Sheets("config").Activate
        Exit Sub
        Else
        
' reseta campos de preenchimento e retorna |fffd| tela de configura|fffd||fffd|es
        Range("E7") = "#Selecionar"
        Range("I7") = "Digite aqui sua mensagem..."
        Sheets("config").Activate
        
    End If
    
End Sub
Sub contatoEmailAnexar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** INSERE E REMOVE ARQUIVO ANEXO
' gerenciamento de erros
    On Error GoTo errorHandler
    
' insere arquivo anexo
    If Range("J11") = "Nenhum arquivo em anexo." Then
        anexoDoc = Application.GetOpenFilename(FileFilter:="All Files(*.*),*.*")

' finaliza caso nenhum arquivo seja selecionado
        If anexoDoc = False Then
            Exit Sub
            Else
        
        End If
        
' altera informa|fffd||fffd|es ap|fffd|s sele|fffd||fffd|o do arquivo
errorHandler:
        Sheets("contato").Unprotect
        Sheets("contato").Cells(11, 10) = anexoDoc
        ActiveSheet.Shapes.Range(Array("icoAnexoInserir")).Visible = False
        ActiveSheet.Shapes.Range(Array("icoAnexoRemover")).Visible = True
        Sheets("contato").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        
        Sheets("contato").Unprotect
        Sheets("contato").Cells(11, 10) = "Nenhum arquivo em anexo."
        ActiveSheet.Shapes.Range(Array("icoAnexoInserir")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoAnexoRemover")).Visible = False
        Sheets("contato").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub contatoEmailOutlook()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA MENSAGEM DE EMAIL
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    Dim Outlook As Outlook.Application
    Dim OutlookMail As Outlook.MailItem
    
    nome = Range("E9")
    perfilInvest = Range("E11")
    emailRemetente = Range("E10")
    emailDestinatario = "contato@creatifica.com.br"
    telefone = Range("E12")
    tipoMsg = Range("E7")
    textoMsg = Range("I7")
    anexo = Range("J11")
    
' define e identifica contas Outlook
    Set Outlook = CreateObject("Outlook.Application")
    
    For contOut = 1 To Outlook.Session.Accounts.Count
        If Outlook.Session.Accounts.item(contOut) = emailRemetente Then
            Exit For
        End If
    Next contOut
    
    Set OutlookMail = Outlook.CreateItem(olMailItem)

' defini|fffd||fffd|es do email
    With OutlookMail
        .To = emailDestinatario
        .Subject = tipoMsg
        .body = textoMsg & vbNewLine & vbNewLine & vbNewLine & vbNewLine & vbNewLine & _
            "Nome: " & nome & vbNewLine & _
            "Perfil de Investidor: " & perfilInvest & vbNewLine & _
            "E-mail: " & emailRemetente & vbNewLine & _
            "Telefone: " & telefone & vbNewLine
            
        If anexo = "" Or anexo = "Nenhum arquivo em anexo." Then
            Else
            .Attachments.Add (anexo)
        End If
        
        .SendUsingAccount = Outlook.Session.Accounts.item(contOut)
        .Send
    End With
    
' reseta vari|fffd|veis
    Set Outlook = Nothing
    Set OutlookMail = Nothing
    Exit Sub

' gerenciamento de erros
errorHandler:
    temp = "finalizar"
    MsgBox "Sua conta de e-mail ainda n|fffd|o est|fffd| vinculada ao Outlook.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Attribute VB_Name = "M_DatabaseAtualiza|fffd||fffd|es"
Sub databaseUpdateCompleto()
Application.ScreenUpdating = True
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA|fffd||fffd|O COMPLETA
' libera planilha de indicadores e carteira
    Sheets("mercadoIndicadores").Unprotect
    Sheets("carteiraPosi|fffd||fffd|o").Unprotect

' conex|fffd|o web para atualiza|fffd||fffd|es
    Call databaseBolsas
    Application.ScreenUpdating = True
    Call databaseAcoes
    Application.ScreenUpdating = True
    Call databaseETFs
    Application.ScreenUpdating = True
    Call databaseFIIs
    Application.ScreenUpdating = True
    Call databaseCambio
    Application.ScreenUpdating = True
    Call databaseTesouro
    Application.ScreenUpdating = True
    Call databaseIndices
    Application.ScreenUpdating = True
    
End Sub
Sub databaseBolsas()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA BOLSAS MUNDIAIS REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' array e defini|fffd||fffd|es HTML
    Dim ws As Worksheet
    Dim XMLPage As New MSXML2.XMLHTTP60
    Dim HTML As New MSHTML.HTMLDocument
    Dim dadosReferencia() As String
    Dim elemento As MSHTML.IHTMLElement
    Dim conjElementos As MSHTML.IHTMLElementCollection
    
    Set ws = Sheets("databaseWebBolsas")
    ws.Unprotect
    
' vari|fffd|veis
    contDB = Range("tabDatabaseWebBolsas").Rows.Count
    contUnit = 1
    contLinha = 5
    temp = 0
    
' loop para acessar todos os c|fffd|digos da tabela
    Application.StatusBar = "     Atualizando Bolsas Mundiais... 0,00%"
    Do Until ws.Cells(contLinha, 3) = ""
    codigoAtivo = ws.Cells(contLinha, 5)
    
' acessa site
    XMLPage.Open "GET", "https://www.reuters.com/finance/markets/index/" & codigoAtivo, False
    XMLPage.Send
    
' localiza dados no site
    HTML.body.innerHTML = XMLPage.ResponseText
    Set conjElementos = HTML.getElementsByClassName("sectionQuote")
    On Error Resume Next
    
    For Each elemento In conjElementos
    If elemento.className = "sectionQuote" Then
        
' formata|fffd||fffd|o de dados obtidos
        elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
        elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
        elemento.innerText = Replace(elemento.innerText, "  ", " ")
        elemento.innerText = Replace(elemento.innerText, " ", ";")
        elemento.innerText = Replace(elemento.innerText, "(", "")
        elemento.innerText = Replace(elemento.innerText, ")", "")
        elemento.innerText = Replace(elemento.innerText, "+", "")
        elemento.innerText = Replace(elemento.innerText, "--", "0,00")
        elemento.innerText = Replace(elemento.innerText, ",", "x")
        elemento.innerText = Replace(elemento.innerText, ".", ",")
        elemento.innerText = Replace(elemento.innerText, "x", ".")
        elemento.innerText = Replace(elemento.innerText, "Price;", "")
        elemento.innerText = Replace(elemento.innerText, "Today's;Change;", "")
        elemento.innerText = Replace(elemento.innerText, "Open;", "")
        
' preenche dados na tabela
        dadosReferencia = Split(elemento.innerText, ";")
        If temp = 0 Then
            ws.Cells(contLinha, 7) = elemento.innerText
            temp = temp + 1
            Else
            
            If temp = 1 Then
                ws.Cells(contLinha, 8) = dadosReferencia(1)
                ws.Cells(contLinha, 9) = dadosReferencia(0)
                temp = temp + 1
                
                Else
                Exit For
                
            End If
        End If
    End If
    Next
    
' incrementa contLinha e realiza loop do c|fffd|digo
    contLinha = contLinha + 1
    temp = 0
    
    contUnit = contUnit + 1
    Application.StatusBar = "     Atualizando Bolsas Mundiais... " & Round((contUnit / contDB * 100), 2) & "%"
    Loop
    
' finaliza navegador e atualiza|fffd||fffd|es
    Application.StatusBar = "     Bolsas mundiais atualizadas com sucesso!"
    Application.StatusBar = ""
    ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Exit Sub
    
errorHandler:
    temp = "erro"

End Sub
Sub databaseAcoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA A|fffd||fffd|ES REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' array e defini|fffd||fffd|es HTML
    Dim ws As Worksheet
    Dim XMLPage As New MSXML2.XMLHTTP60
    Dim HTML As New MSHTML.HTMLDocument
    Dim dadosReferencia() As String
    Dim elemento As MSHTML.IHTMLElement
    Dim conjElementos As MSHTML.IHTMLElementCollection
    
    Set ws = Sheets("databaseWebA|fffd||fffd|es")
    ws.Unprotect
    
' vari|fffd|veis
    contDB = Range("tabDatabaseWebA|fffd||fffd|es").Rows.Count
    contUnit = 1
    contLinha = 6
    temp = 0
    
' loop para acessar todos os c|fffd|digos da tabela
    Application.StatusBar = "     Atualizando A|fffd||fffd|es... 0,00%"
    Do Until ws.Cells(contLinha, 3) = ""
    codigoAtivo = ws.Cells(contLinha, 4)
    
' acessa site
    XMLPage.Open "GET", "https://www.reuters.com/finance/stocks/overview/" & codigoAtivo, False
    'XMLPage.Open "GET", "https://www.reuters.com/companies/" & codigoAtivo, False
    XMLPage.Send
    
' localiza dados no site e formata dados obtidos
    HTML.body.innerHTML = XMLPage.ResponseText
    Set conjElementos = HTML.getElementsByClassName("moduleBody")
    On Error Resume Next
    
    For Each elemento In conjElementos
        If elemento.className = "moduleBody" Then
            elemento.innerText = Replace(elemento.innerText, " on Sao Paulo Stock Exchange ", "")
            elemento.innerText = Replace(elemento.innerText, " ", "")
            elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
            elemento.innerText = Replace(elemento.innerText, "BRL", "")
            elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
            elemento.innerText = Replace(elemento.innerText, ";;", ";")
            elemento.innerText = Replace(elemento.innerText, "+", "")
            elemento.innerText = Replace(elemento.innerText, "--", "0,00")
            elemento.innerText = Replace(elemento.innerText, ",", "x")
            elemento.innerText = Replace(elemento.innerText, ".", ",")
            elemento.innerText = Replace(elemento.innerText, "x", ".")
            elemento.innerText = Replace(elemento.innerText, "(", ";")
            elemento.innerText = Replace(elemento.innerText, ")", "")
            
' preenche dados na tabela
            dadosReferencia = Split(elemento.innerText, ";")
            ws.Cells(contLinha, 7) = "R$" & dadosReferencia(1)
            ws.Cells(contLinha, 8) = dadosReferencia(6)
            ws.Cells(contLinha, 9) = dadosReferencia(5)
            ws.Cells(contLinha, 10) = dadosReferencia(22)
            ws.Cells(contLinha, 11) = dadosReferencia(20)
            Exit For
            
        End If
    Next
    
' incrementa contLinha e realiza loop do c|fffd|digo
    contLinha = contLinha + 1
    contUnit = contUnit + 1
    If Round((contUnit / contDB * 100), 2) <= 100 Then
        Application.StatusBar = "     Atualizando A|fffd||fffd|es... " & Round((contUnit / contDB * 100), 2) & "%"
        Else
        Application.StatusBar = "     Atualizando A|fffd||fffd|es... 100%"
        
    End If
    Loop
    
' finaliza navegador e atualiza|fffd||fffd|es
    Application.StatusBar = "     A|fffd||fffd|es atualizadas com sucesso!"
    Application.StatusBar = ""
    Call databaseAcoesClassificar
    ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Exit Sub
    
errorHandler:
    temp = "erro"

End Sub
Sub databaseETFs()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA ETFS REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' array e defini|fffd||fffd|es HTML
    Dim ws As Worksheet
    Dim XMLPage As New MSXML2.XMLHTTP60
    Dim HTML As New MSHTML.HTMLDocument
    Dim dadosReferencia() As String
    Dim elemento As MSHTML.IHTMLElement
    Dim conjElementos As MSHTML.IHTMLElementCollection
    
    Set ws = Sheets("databaseWebETFs")
    ws.Unprotect
    
' vari|fffd|veis
    contDB = Range("tabDatabaseWebETFs").Rows.Count
    contUnit = 1
    contLinha = 6
    temp = 0
    
' loop para acessar todos os c|fffd|digos da tabela
    Application.StatusBar = "     Atualizando ETFs... 0,00%"
    Do Until ws.Cells(contLinha, 3) = ""
    codigoAtivo = ws.Cells(contLinha, 4)
    
' acessa site
    XMLPage.Open "GET", "https://www.reuters.com/finance/stocks/overview/" & codigoAtivo, False
    XMLPage.Send
    
' localiza dados no site e formata dados obtidos
    HTML.body.innerHTML = XMLPage.ResponseText
    Set conjElementos = HTML.getElementsByClassName("moduleBody")
    On Error Resume Next
    
    For Each elemento In conjElementos
        If elemento.className = "moduleBody" Then
            elemento.innerText = Replace(elemento.innerText, " on Sao Paulo Stock Exchange ", "")
            elemento.innerText = Replace(elemento.innerText, " ", "")
            elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
            elemento.innerText = Replace(elemento.innerText, "BRL", "")
            elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
            elemento.innerText = Replace(elemento.innerText, ";;", ";")
            elemento.innerText = Replace(elemento.innerText, "+", "")
            elemento.innerText = Replace(elemento.innerText, "--", "0,00")
            elemento.innerText = Replace(elemento.innerText, ",", "x")
            elemento.innerText = Replace(elemento.innerText, ".", ",")
            elemento.innerText = Replace(elemento.innerText, "x", ".")
            elemento.innerText = Replace(elemento.innerText, "(", ";")
            elemento.innerText = Replace(elemento.innerText, ")", "")
            
' preenche dados na tabela
            dadosReferencia = Split(elemento.innerText, ";")
            ws.Cells(contLinha, 7) = "R$" & dadosReferencia(1)
            ws.Cells(contLinha, 8) = dadosReferencia(6)
            ws.Cells(contLinha, 9) = dadosReferencia(5)
            ws.Cells(contLinha, 10) = dadosReferencia(22)
            ws.Cells(contLinha, 11) = dadosReferencia(20)
            Exit For
            
        End If
    Next
    
' incrementa contLinha e realiza loop do c|fffd|digo
    contLinha = contLinha + 1
    contUnit = contUnit + 1
    If Round((contUnit / contDB * 100), 2) <= 100 Then
        Application.StatusBar = "     Atualizando ETFs... " & Round((contUnit / contDB * 100), 2) & "%"
        Else
        Application.StatusBar = "     Atualizando ETFs... 100%"
        
    End If
    Loop
    
' finaliza navegador e atualiza|fffd||fffd|es
    Application.StatusBar = "     ETFs atualizados com sucesso!"
    Application.StatusBar = ""
    Call databaseETFsClassificar
    ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Exit Sub
    
errorHandler:
    temp = "erro"

End Sub
Sub databaseFIIs()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA FIIS REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' array e defini|fffd||fffd|es HTML
    Dim ws As Worksheet
    Dim XMLPage As New MSXML2.XMLHTTP60
    Dim HTML As New MSHTML.HTMLDocument
    Dim dadosReferencia() As String
    Dim elemento As MSHTML.IHTMLElement
    Dim conjElementos As MSHTML.IHTMLElementCollection
    
    Set ws = Sheets("databaseWebFIIs")
    ws.Unprotect
    
' vari|fffd|veis
    contDB = Range("tabDatabaseWebFIIs").Rows.Count
    contUnit = 1
    contLinha = 6
    temp = 0
    
' loop para acessar todos os c|fffd|digos da tabela
    Application.StatusBar = "     Atualizando FIIs... 0,00%"
    Do Until ws.Cells(contLinha, 3) = ""
    codigoAtivo = ws.Cells(contLinha, 4)
    
' acessa site
    XMLPage.Open "GET", "https://www.reuters.com/finance/stocks/overview/" & codigoAtivo, False
    XMLPage.Send
    
' localiza dados no site e formata dados obtidos
    HTML.body.innerHTML = XMLPage.ResponseText
    Set conjElementos = HTML.getElementsByClassName("moduleBody")
    On Error Resume Next
    
    For Each elemento In conjElementos
        If elemento.className = "moduleBody" Then
            elemento.innerText = Replace(elemento.innerText, " on Sao Paulo Stock Exchange ", "")
            elemento.innerText = Replace(elemento.innerText, " on Rio de Janeiro over the counter Stock Exchange ", "")
            elemento.innerText = Replace(elemento.innerText, " ", "")
            elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
            elemento.innerText = Replace(elemento.innerText, "BRL", "")
            elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
            elemento.innerText = Replace(elemento.innerText, ";;", ";")
            elemento.innerText = Replace(elemento.innerText, "+", "")
            elemento.innerText = Replace(elemento.innerText, "--", "0,00")
            elemento.innerText = Replace(elemento.innerText, ",", "x")
            elemento.innerText = Replace(elemento.innerText, ".", ",")
            elemento.innerText = Replace(elemento.innerText, "x", ".")
            elemento.innerText = Replace(elemento.innerText, "(", ";")
            elemento.innerText = Replace(elemento.innerText, ")", "")
            
' preenche dados na tabela
            dadosReferencia = Split(elemento.innerText, ";")
            ws.Cells(contLinha, 7) = "R$" & dadosReferencia(1)
            ws.Cells(contLinha, 8) = dadosReferencia(6)
            ws.Cells(contLinha, 9) = dadosReferencia(5)
            ws.Cells(contLinha, 10) = dadosReferencia(22)
            ws.Cells(contLinha, 11) = dadosReferencia(20)
            Exit For
            
        End If
    Next
    
' incrementa contLinha e realiza loop do c|fffd|digo
    contLinha = contLinha + 1
    contUnit = contUnit + 1
    If Round((contUnit / contDB * 100), 2) <= 100 Then
        Application.StatusBar = "     Atualizando FIIs... " & Round((contUnit / contDB * 100), 2) & "%"
        Else
        Application.StatusBar = "     Atualizando FIIs... 100%"
        
    End If
    Loop
    
' finaliza navegador e atualiza|fffd||fffd|es
    Application.StatusBar = "     FIIs atualizados com sucesso!"
    Application.StatusBar = ""
    Call databaseFIIsClassificar
    ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Exit Sub
    
errorHandler:
    temp = "erro"

End Sub
Sub databaseCambio()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA C|fffd|MBIO REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' array e defini|fffd||fffd|es HTML
    Dim ws As Worksheet
    Dim XMLPage As New MSXML2.XMLHTTP60
    Dim HTML As New MSHTML.HTMLDocument
    Dim dadosReferencia() As String
    Dim elemento As MSHTML.IHTMLElement
    Dim conjElementos As MSHTML.IHTMLElementCollection
    
    Set ws = Sheets("databaseWebC|fffd|mbio")
    ws.Unprotect
    
' vari|fffd|veis
    contDB = Range("tabDatabaseWebC|fffd|mbio").Rows.Count
    contUnit = 1
    contLinha = 6
    temp = 0
    
' loop para acessar todos os c|fffd|digos da tabela
    Application.StatusBar = "     Atualizando C|fffd|mbio... 0,00%"
    Do Until ws.Cells(contLinha, 4) = ""
    codigoAtivo = ws.Cells(contLinha, 5)
    
' acessa site
    XMLPage.Open "GET", "https://www.reuters.com/finance/currencies/quote?srcAmt=1&srcCurr=" & codigoAtivo & "&destAmt=&destCurr=BRL", False
    XMLPage.Send
    
' localiza dados no site e formata dados obtidos
    HTML.body.innerHTML = XMLPage.ResponseText
    Set conjElementos = HTML.getElementsByClassName("moduleBody")
    On Error Resume Next
    
    For Each elemento In conjElementos
        If elemento.className = "moduleBody" Then
            
            elemento.innerText = Replace(elemento.innerText, "Bid", "")
            elemento.innerText = Replace(elemento.innerText, "Offer", "")
            elemento.innerText = Replace(elemento.innerText, " ", "")
            elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
            elemento.innerText = Replace(elemento.innerText, "+", "")
            elemento.innerText = Replace(elemento.innerText, "--", "0,00")
            elemento.innerText = Replace(elemento.innerText, ",", "x")
            elemento.innerText = Replace(elemento.innerText, ".", ",")
            elemento.innerText = Replace(elemento.innerText, "x", ".")
            
' preenche dados na tabela
            dadosReferencia = Split(elemento.innerText, ";")
            ws.Cells(contLinha, 3) = dadosReferencia(0)
            ws.Cells(contLinha, 6) = "R$" & dadosReferencia(1)
            ws.Cells(contLinha, 7) = 0
            ws.Cells(contLinha, 8) = "R$" & dadosReferencia(4)
            ws.Cells(contLinha, 9) = "R$" & dadosReferencia(5)
            Exit For
            
        End If
    Next
    
' incrementa contLinha e realiza loop do c|fffd|digo
    contLinha = contLinha + 1
    contUnit = contUnit + 1
    If Round((contUnit / contDB * 100), 2) <= 100 Then
        Application.StatusBar = "     Atualizando C|fffd|mbio... " & Round((contUnit / contDB * 100), 2) & "%"
        Else
        Application.StatusBar = "     Atualizando C|fffd|mbio... 100%"
        
    End If
    Loop
    
' finaliza navegador e atualiza|fffd||fffd|es
    Application.StatusBar = "     C|fffd|mbio atualizado com sucesso!"
    Application.StatusBar = ""
    Call databaseCambioClassificar
    ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Exit Sub
    
errorHandler:
    temp = "erro"

End Sub
Sub databaseTesouro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA TESOURO DIRETO
' gerenciamento de erros
    On Error GoTo errorHandler
    
' array e defini|fffd||fffd|es HTML
    Dim ws As Worksheet
    Dim XMLPage As New MSXML2.XMLHTTP60
    Dim HTML As New MSHTML.HTMLDocument
    
    Dim tabelas As MSHTML.IHTMLElementCollection
    Dim tabelasTab As MSHTML.IHTMLElement
    Dim tabelasLinha As MSHTML.IHTMLElement
    Dim tabelasCel As MSHTML.IHTMLElement
    
    Set ws = Sheets("databaseWebTesouro")
    ws.Unprotect
    
' vari|fffd|veis
    contDB = Range("tabDatabaseWebTesouroCompra").Rows.Count + Range("tabDatabaseWebTesouroVenda").Rows.Count
    contUnit = 1
    temp = 0
    tempVal = 0
    
' loop para acessar todos os c|fffd|digos da tabela
    Application.StatusBar = "     Atualizando Tesouro Direto... 0,00%"
    Do Until tempVal = 3
    
' acessa site - parte 1
    If tempVal = 0 Then
        contLinha = 6
        contCol = 4
        
        XMLPage.Open "GET", "http://www.tesouro.fazenda.gov.br/tesouro-direto-precos-e-taxas-dos-titulos", False
        XMLPage.Send
        
' localiza dados no site e formata dados obtidos
        HTML.body.innerHTML = XMLPage.ResponseText
        Set tabelas = HTML.getElementsByClassName("tabelaPrecoseTaxas")
        Else
        
' acessa site - parte 2
        If tempVal = 1 Then
            contLinha = 25
            contCol = 4
            
            XMLPage.Open "GET", "http://www.tesouro.fazenda.gov.br/tesouro-direto-precos-e-taxas-dos-titulos", False
            XMLPage.Send
            
' localiza dados no site e formata dados obtidos
            HTML.body.innerHTML = XMLPage.ResponseText
            Set tabelas = HTML.getElementsByClassName("tabelaPrecoseTaxas sanfonado")
            Else
            
' finaliza atualiza|fffd||fffd|es
            Range("tabDatabaseWebTesouroCompra[Vencimento]").NumberFormat = "dd/mm/yyyy"
            Application.StatusBar = "     Tesouro Direto atualizado com sucesso!"
            Application.StatusBar = ""
            Call databaseTesouroClassificar
            ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            
        End If
    End If
    
' localiza campos e preenche tabela
    For Each tabelasTab In tabelas
        
        For Each tabelasLinha In tabelasTab.getElementsByTagName("tr")
            If tabelasLinha.className = "camposTesouroDireto" Or tabelasLinha.className = "camposTesouroDireto " Then
                
                For Each tabelasCel In tabelasLinha.getElementsByTagName("td")
                    If tempVal >= 1 And contCol = 7 Then
                        contCol = 9
                        ws.Cells(contLinha, 7) = 0
                        ws.Cells(contLinha, 8) = 0
                        ws.Cells(contLinha, contCol) = tabelasCel.innerText
                        
                        contCol = 4
                        contLinha = contLinha + 1
                        
                        Else
                        ws.Cells(contLinha, contCol) = tabelasCel.innerText
                        contCol = contCol + 1
                        
                    End If
                Next
                
            End If
            
' pula linha e reseta coluna
            If contCol >= 8 And ws.Cells(contLinha, contCol) = "" Or contCol >= 8 And ws.Cells(contLinha, contCol) = 0 Then
                ws.Cells(contLinha, contCol) = "R$0,00"
                contCol = 4
                contLinha = contLinha + 1
                
            End If
            
' incrementa contLinha e realiza loop da linha
            contUnit = contUnit + 1
            If Round((contUnit / contDB * 100), 2) <= 100 Then
                Application.StatusBar = "     Atualizando Tesouro Direto... " & Round((contUnit / contDB * 100), 2) & "%"
                Else
                Application.StatusBar = "     Atualizando Tesouro Direto... 100%"
                
            End If
            
' loop da linha
        Next
        
        tempVal = tempVal + 1
        Exit For
        
    Next
    Loop
    
errorHandler:
    temp = "erro"
    
End Sub
Sub databaseIndices()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA |fffd|NDICES
' gerenciamento de erros
    On Error GoTo errorHandler
    
' atualiza dados
    Sheets("databaseWeb|fffd|ndices").Unprotect
    
    Application.StatusBar = "     Atualizando |fffd|ndices... 0,00%"
    Sheets("databaseWeb|fffd|ndices").Range("C4").QueryTable.Refresh BackgroundQuery:=False

' finaliza atualiza|fffd||fffd|es
    Application.StatusBar = "     |fffd|ndices atualizados com sucesso!"
    Application.StatusBar = ""
    temp = ""
    Sheets("databaseWeb|fffd|ndices").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Exit Sub
    
errorHandler:
    temp = "erro"

End Sub
Attribute VB_Name = "M_DatabaseCadastros"
Sub databaseAdmin()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSO ADMIN
' restringe acesso |fffd| tela de cadastros e log
    If Sheets("config").Cells(6, 5) = "Administrador" Then
        Sheets("databaseCadastros").Activate
        Exit Sub
        Else
        MsgBox "Acesso restrito ao Administrador do sistema.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If
    
End Sub
Sub databaseCadastrosResetUsuario()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RESETA USU|fffd|RIO
' verifica lista de usu|fffd|rio
    If Sheets("databaseCadastros").Cells(6, 3) = "" And Sheets("databaseCadastros").Cells(11, 3) = "" Then
        MsgBox "Nenhum registro encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma reset e apaga registros
        Dim confirmaReset As VbMsgBoxResult
        confirmaReset = MsgBox("Deseja realmente resetar o registro de usu|fffd|rios?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaReset = vbNo Then
            Exit Sub
            Else
            
            Call LIBPLAN
            
' remove usu|fffd|rio das configura|fffd||fffd|es
            Sheets("config").Cells(6, 6) = ""
            Sheets("config").Cells(11, 5) = "#Selecionar"
            
' apaga registro do usu|fffd|rio
            Sheets("databaseCadastros").Activate
            Sheets("databaseCadastros").Range("C6:K6").Select
            Selection.ClearContents
            
' loop para limpeza de todas as linhas de log registradas
            contLinha = 10
            tabLinha = tabLinha + 1
            
            Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
            If Sheets("databaseCadastros").Cells(contLinha, 3) <> "" Then
                Sheets("databaseCadastros").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
            
            End If
            Loop
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE MERCADO
' remove benchmarks
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("mercadoBenchmarks").Cells(contLinha, 3) = ""
            If Sheets("mercadoBenchmarks").Cells(contLinha, 3) <> "" Then
                Sheets("mercadoBenchmarks").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove not|fffd|cias
            contLinha = 17
            tabLinha = 1
            
            Do Until Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = ""
            If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) <> "" Then
                Sheets("mercadoNot|fffd|cias").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE RADAR
' remove radar de renda vari|fffd|vel
            contLinha = 15
            tabLinha = 1
            
            Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = ""
            If Sheets("ativosRadarRV").Cells(contLinha, 3) <> "" Then
                Sheets("ativosRadarRV").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove radar multimercados
            contLinha = 15
            tabLinha = 1
            
            Do Until Sheets("ativosRadarMulti").Cells(contLinha, 3) = ""
            If Sheets("ativosRadarMulti").Cells(contLinha, 3) <> "" Then
                Sheets("ativosRadarMulti").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE CARTEIRA
' remove acompanhamento mensal
            contLinha = 14
            tabLinha = 1
            
            Do Until Sheets("carteiraAcompanha").Cells(contLinha, 3) = ""
            If Sheets("carteiraAcompanha").Cells(contLinha, 3) <> "" Then
                Sheets("carteiraAcompanha").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' apaga registros sem alterar f|fffd|rmulas de fechamento mensal
            Sheets("carteiraAcompanha").Activate
            Sheets("carteiraAcompanha").Range("C13:L13").Select
            Selection.ClearContents
            
' ajusta f|fffd|rmula do m|fffd|s em andamento
            Sheets("carteiraAcompanha").Cells(11, 6).Select
            ActiveCell.FormulaR1C1 = "=IF(R[2]C[-3]="""",MONTH(R1C1)-1,0)"
            
' remove registros de caixa
            contLinha = 20
            tabLinha = 1
            
            Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = ""
            If Sheets("carteiraCaixa").Cells(contLinha, 3) <> "" Then
                Sheets("carteiraCaixa").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' ajusta saldos dispon|fffd|vels em 0
            Sheets("carteiraCaixa").Cells(13, 4) = 0
            Sheets("carteiraCaixa").Cells(13, 6) = 0
            Sheets("carteiraCaixa").Cells(13, 8) = 0
            Sheets("carteiraCaixa").Cells(13, 10) = 0
            Sheets("carteiraCaixa").Cells(13, 12) = 0
            Sheets("carteiraCaixa").Cells(13, 13) = 0
            Sheets("carteiraCaixa").Cells(13, 14) = 0

' remove ordens pendentes
            contLinha = 5
            tabLinha = 1
            
            Do Until Sheets("carteiraOp").Cells(contLinha, 3) = ""
            If Sheets("carteiraOp").Cells(contLinha, 3) <> "" Then
                Sheets("carteiraOp").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove proje|fffd||fffd|es
            contLinha = 17
            tabLinha = 1
            
            Do Until Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) = ""
            If Sheets("carteiraProje|fffd||fffd|es").Cells(contLinha, 3) <> "" Then
                Sheets("carteiraProje|fffd||fffd|es").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS OPERA|fffd||fffd|ES ESPECIAIS
' remove registros de opera|fffd||fffd|es especiais
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
            If Sheets("opEspeciais").Cells(contLinha, 3) <> "" Then
                Sheets("opEspeciais").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove registros de opera|fffd||fffd|es especiais j|fffd| executadas
            contLinha = 5
            tabLinha = 1
            
            Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
            If Sheets("opEspeciaisExec").Cells(contLinha, 3) <> "" Then
                Sheets("opEspeciaisExec").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE A|fffd||fffd|ES
' remove carteira de a|fffd||fffd|es
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = ""
            If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("a|fffd||fffd|esCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call acoesCarteiraLogo
            Sheets("a|fffd||fffd|esCarteira").Range("F3") = 0
            
' remove compras de a|fffd||fffd|es
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
            If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) <> "" Then
                Sheets("a|fffd||fffd|esCompras").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove vendas de a|fffd||fffd|es
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = ""
            If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = "*" Then
                Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) <> "" Then
                Sheets("a|fffd||fffd|esVendas").Activate
                Sheets("a|fffd||fffd|esVendas").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("a|fffd||fffd|esVendas").Range("P23:P1000") = ""
            
' remove proventos de a|fffd||fffd|es
            contLinha = 24
            tabLinha = 1
            
            Do Until Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 3) = ""
            If Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 3) <> "" Then
                Sheets("a|fffd||fffd|esProventos").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call acoesProventosLogo
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE ETFS
' remove carteira de etfs
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("etfsCarteira").Cells(contLinha, 3) = ""
            If Sheets("etfsCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("etfsCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call etfsCarteiraLogo
            Sheets("etfsCarteira").Range("F3") = 0
            
' remove compras de etfs
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("etfsCompras").Cells(contLinha, 3) = ""
            If Sheets("etfsCompras").Cells(contLinha, 3) <> "" Then
                Sheets("etfsCompras").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove vendas de etfs
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("etfsVendas").Cells(contLinha, 3) = ""
            If Sheets("etfsVendas").Cells(contLinha, 16) = "*" Then
                Sheets("etfsVendas").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("etfsVendas").Cells(contLinha, 3) <> "" Then
                Sheets("etfsVendas").Activate
                Sheets("etfsVendas").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("etfsVendas").Range("P23:P1000") = ""

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE FIIS
' remove carteira de fiis
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = ""
            If Sheets("fiisCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("fiisCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call fiisCarteiraLogo
            Sheets("fiisCarteira").Range("F3") = 0
            
' remove compras de fiis
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("fiisCompras").Cells(contLinha, 3) = ""
            If Sheets("fiisCompras").Cells(contLinha, 3) <> "" Then
                Sheets("fiisCompras").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove vendas de fiis
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("fiisVendas").Cells(contLinha, 3) = ""
            If Sheets("fiisVendas").Cells(contLinha, 16) = "*" Then
                Sheets("fiisVendas").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("fiisVendas").Cells(contLinha, 3) <> "" Then
                Sheets("fiisVendas").Activate
                Sheets("fiisVendas").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("fiisVendas").Range("P23:P1000") = ""

' remove proventos de fiis
            contLinha = 24
            tabLinha = 1
            
            Do Until Sheets("fiisRendimentos").Cells(contLinha, 3) = ""
            If Sheets("fiisRendimentos").Cells(contLinha, 3) <> "" Then
                Sheets("fiisRendimentos").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call fiisRendimentosLogo
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE TESOURO DIRETO
' remove carteira de tesouro
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("tesouroCarteira").Cells(contLinha, 3) = ""
            If Sheets("tesouroCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("tesouroCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call tesouroCarteiraLogo
            Sheets("tesouroCarteira").Range("F3") = 0
            
' remove compras de tesouro
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("tesouroCompras").Cells(contLinha, 3) = ""
            If Sheets("tesouroCompras").Cells(contLinha, 3) <> "" Then
                Sheets("tesouroCompras").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove vendas de tesouro
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("tesouroVendas").Cells(contLinha, 3) = ""
            If Sheets("tesouroVendas").Cells(contLinha, 16) = "*" Then
                Sheets("tesouroVendas").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("tesouroVendas").Cells(contLinha, 3) <> "" Then
                Sheets("tesouroVendas").Activate
                Sheets("tesouroVendas").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("tesouroVendas").Range("P23:P1000") = ""

' remove juros de tesouro
            contLinha = 24
            tabLinha = 1
            
            Do Until Sheets("tesouroJuros").Cells(contLinha, 3) = ""
            If Sheets("tesouroJuros").Cells(contLinha, 3) <> "" Then
                Sheets("tesouroJuros").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call tesouroJurosLogo
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE CDBS
' remove carteira de cdbs
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("cdbsCarteira").Cells(contLinha, 3) = ""
            If Sheets("cdbsCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("cdbsCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call cdbsCarteiraLogo
            Sheets("cdbsCarteira").Range("F3") = 0
            
' remove aplica|fffd||fffd|es em cdbs
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("cdbsAplic").Cells(contLinha, 3) = ""
            If Sheets("cdbsAplic").Cells(contLinha, 3) <> "" Then
                Sheets("cdbsAplic").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove resgates de cdbs
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("cdbsResgates").Cells(contLinha, 3) = ""
            If Sheets("cdbsResgates").Cells(contLinha, 16) = "*" Then
                Sheets("cdbsResgates").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("cdbsResgates").Cells(contLinha, 3) <> "" Then
                Sheets("cdbsResgates").Activate
                Sheets("cdbsResgates").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("cdbsResgates").Range("P23:P1000") = ""

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE LETRAS DE CR|fffd|DITO
' remove carteira de letras
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("letrasCarteira").Cells(contLinha, 3) = ""
            If Sheets("letrasCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("letrasCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call letrasCarteiraLogo
            Sheets("letrasCarteira").Range("F3") = 0
            
' remove aplica|fffd||fffd|es em letras
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("letrasAplic").Cells(contLinha, 3) = ""
            If Sheets("letrasAplic").Cells(contLinha, 3) <> "" Then
                Sheets("letrasAplic").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove resgates de letras
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("letrasResgates").Cells(contLinha, 3) = ""
            If Sheets("letrasResgates").Cells(contLinha, 16) = "*" Then
                Sheets("letrasResgates").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("letrasResgates").Cells(contLinha, 3) <> "" Then
                Sheets("letrasResgates").Activate
                Sheets("letrasResgates").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("letrasResgates").Range("P23:P1000") = ""

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE FUNDOS
' remove carteira de fundos
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = ""
            If Sheets("fundosCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("fundosCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("fundosCarteira").Range("F3") = 0

' remove aplica|fffd||fffd|es em fundos
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("fundosAplic").Cells(contLinha, 3) = ""
            If Sheets("fundosAplic").Cells(contLinha, 3) <> "" Then
                Sheets("fundosAplic").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove resgates de fundos
            contLinha = 26
            tabLinha = 1
            
            Do Until Sheets("fundosResgates").Cells(contLinha, 3) = ""
            If Sheets("fundosResgates").Cells(contLinha, 16) = "*" Then
                Sheets("fundosResgates").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("fundosResgates").Cells(contLinha, 3) <> "" Then
                Sheets("fundosResgates").Activate
                Sheets("fundosResgates").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("fundosResgates").Range("P23:P1000") = ""

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE COES
' remove carteira de coes
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("coesCarteira").Cells(contLinha, 3) = ""
            If Sheets("coesCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("coesCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("coesCarteira").Range("F3") = 0

' remove aplica|fffd||fffd|es em coes
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("coesAplic").Cells(contLinha, 3) = ""
            If Sheets("coesAplic").Cells(contLinha, 3) <> "" Then
                Sheets("coesAplic").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove resgates de coes
            contLinha = 26
            tabLinha = 1
            
            Do Until Sheets("coesResgates").Cells(contLinha, 3) = ""
            If Sheets("coesResgates").Cells(contLinha, 16) = "*" Then
                Sheets("coesResgates").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("coesResgates").Cells(contLinha, 3) <> "" Then
                Sheets("coesResgates").Activate
                Sheets("coesResgates").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("coesResgates").Range("P23:P1000") = ""
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS DE MOEDAS
' remove carteira de moedas
            contLinha = 18
            tabLinha = 1
            
            Do Until Sheets("moedasCarteira").Cells(contLinha, 3) = ""
            If Sheets("moedasCarteira").Cells(contLinha, 3) <> "" Then
                Sheets("moedasCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Call moedasCarteiraLogo
            Sheets("moedasCarteira").Range("F3") = 0
            
' remove aplica|fffd||fffd|es em moedas
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("moedasCompras").Cells(contLinha, 3) = ""
            If Sheets("moedasCompras").Cells(contLinha, 3) <> "" Then
                Sheets("moedasCompras").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
' remove vendas de moedas
            contLinha = 23
            tabLinha = 1
            
            Do Until Sheets("moedasVendas").Cells(contLinha, 3) = ""
            If Sheets("moedasVendas").Cells(contLinha, 16) = "*" Then
                Sheets("moedasVendas").Cells(contLinha, 16) = ""
            End If
            
            If Sheets("moedasVendas").Cells(contLinha, 3) <> "" Then
                Sheets("moedasVendas").Activate
                Sheets("moedasVendas").Unprotect
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
            
            End If
            Loop
            
            Sheets("moedasVendas").Range("P23:P1000") = ""

'*************************************************************************************************************************** FINALIZA|fffd||fffd|O GERAL
' remove corretoras cadastradas
            Sheets("config").Activate
            
            If Sheets("config").Cells(23, 3) <> "" Then
                Call configRemoverCorretora5
                Else
                
            End If
            
            If Sheets("config").Cells(22, 3) <> "" Then
                Call configRemoverCorretora4
                Else
                
            End If
            
            If Sheets("config").Cells(21, 3) <> "" Then
                Call configRemoverCorretora3
                Else
                
            End If
            
            If Sheets("config").Cells(20, 3) <> "" Then
                Call configRemoverCorretora2
                Else
                
            End If
            
            If Sheets("config").Cells(19, 4) <> "#Selecionar" Then
                Sheets("config").Unprotect
                Sheets("config").Cells(19, 4) = "#Selecionar"
                
            End If
            
' finaliza reset
            Sheets("databaseCadastros").Activate
            Sheets("databaseCadastros").Cells(1, 1).Select
            
            Call BLOQPLAN
            Call planAutoSave
            Sheets("carteiraPosi|fffd||fffd|o").Activate
            MsgBox "Registros removidos com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If

End Sub
Sub databaseCadastrosLimparLog()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' loop para localiza|fffd||fffd|o de log preenchido
    contLinha = 11
    tabLinha = ((contLinha * -1) + 1) + contLinha
    
    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = "" Or Sheets("databaseCadastros").Cells(contLinha, 3) <> ""
    contLinha = contLinha + 1
    tabLinha = tabLinha + 1
    Loop

    If contLinha = 11 And Sheets("databaseCadastros").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhum hist|fffd|rico dispon|fffd|vel para limpeza at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

' confirma|fffd||fffd|o e execu|fffd||fffd|o da limpeza
        Dim confirmaLimpezaLog As VbMsgBoxResult
        confirmaLimpezaLog = MsgBox("Deseja limpar o registro de LOG?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpezaLog = vbNo Then
            Exit Sub
            Else
            
' loop para limpeza de todas as linhas registradas
            Sheets("databaseCadastros").Unprotect
            Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
            If Sheets("databaseCadastros").Cells(contLinha, 3) <> "" Then
                Sheets("databaseCadastros").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                Else
                
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
            
            End If
            Loop
            
' finaliza opera|fffd||fffd|es
            Range("A1").Select
            Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Registros de LOG exclu|fffd|dos com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub databaseCadastrosLogClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE LOG
' classifica|fffd||fffd|o decrescente por hora de opera|fffd||fffd|o
    ActiveWorkbook.Worksheets("databaseCadastros").ListObjects("tabDatabaseCadastrosLog").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseCadastros").ListObjects("tabDatabaseCadastrosLog").Sort. _
        SortFields.Add Key:=Range("tabDatabaseCadastrosLog[[#Headers],[Hor|fffd|rio]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseCadastros").ListObjects("tabDatabaseCadastrosLog").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de opera|fffd||fffd|o
    ActiveWorkbook.Worksheets("databaseCadastros").ListObjects("tabDatabaseCadastrosLog").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseCadastros").ListObjects("tabDatabaseCadastrosLog").Sort. _
        SortFields.Add Key:=Range("tabDatabaseCadastrosLog[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseCadastros").ListObjects("tabDatabaseCadastrosLog").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub




Attribute VB_Name = "M_DatabaseOp"
Sub databaseIndicadoresFinalizarEdicao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA INDICADORES
' verifica edi|fffd||fffd|o j|fffd| aberta
    If Sheets("mercadoIndicadores").Cells(3, 6) = "Editar" Then
        Sheets("mercadoIndicadores").Activate
        Exit Sub
        Else

' finaliza todas as edi|fffd||fffd|es dos indicadores
        Call databaseIndicadoresEditarIGPM
        Call databaseIndicadoresEditarIPCA
        Call databaseIndicadoresEditarSELIC
        Call databaseIndicadoresEditarCDI
        
' esconde bot|fffd|o
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("databaseWebIndicadores").Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = False
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
' retorna |fffd| tela de indicadores
        Sheets("mercadoIndicadores").Activate
        ThisWorkbook.Save
        MsgBox "Edi|fffd||fffd|es finalizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If
    
End Sub
Sub databaseIndicadoresEditarIGPM()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA TABELA IGPM
' vari|fffd|veis
    ano = Year(Range("A1"))

' valida status
    If Sheets("databaseWebIndicadores").Cells(3, 5) = "Editar" Then

' libera edi|fffd||fffd|o e seleciona ano corrente
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        Range("tabDatabaseIndicadoresIGPM").Locked = False
        ActiveSheet.Shapes.Range(Array("icoEditarIGPM")).Visible = False
        ActiveSheet.Shapes.Range(Array("icoCheckIGPM")).Visible = True
        
        contLinha = 5
        Do Until Sheets("databaseWebIndicadores").Cells(contLinha, 3) = ano
        contLinha = contLinha + 1
        Loop
        
        Sheets("databaseWebIndicadores").Cells(3, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(contLinha, 4).Select
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
' finaliza edi|fffd||fffd|o
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        
        Range("tabDatabaseIndicadoresIGPM").Locked = True
        ActiveSheet.Shapes.Range(Array("icoEditarIGPM")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheckIGPM")).Visible = False
        Sheets("databaseWebIndicadores").Cells(3, 5) = "Editar"
        Sheets("mercadoIndicadores").Cells(3, 6) = "Editar"
        
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
    End If
        
End Sub
Sub databaseIndicadoresEditarIPCA()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA TABELA IPCA
' vari|fffd|veis
    ano = Year(Range("A1"))

' valida status
    If Sheets("databaseWebIndicadores").Cells(32, 5) = "Editar" Then

' libera edi|fffd||fffd|o e seleciona ano corrente
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        Range("tabDatabaseIndicadoresIPCA").Locked = False
        ActiveSheet.Shapes.Range(Array("icoEditarIPCA")).Visible = False
        ActiveSheet.Shapes.Range(Array("icoCheckIPCA")).Visible = True
        
        contLinha = 34
        Do Until Sheets("databaseWebIndicadores").Cells(contLinha, 3) = ano
        contLinha = contLinha + 1
        Loop
        
        Sheets("databaseWebIndicadores").Cells(32, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(contLinha, 4).Select
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
' finaliza edi|fffd||fffd|o
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        
        Range("tabDatabaseIndicadoresIPCA").Locked = True
        ActiveSheet.Shapes.Range(Array("icoEditarIPCA")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheckIPCA")).Visible = False
        Sheets("databaseWebIndicadores").Cells(32, 5) = "Editar"
        Sheets("mercadoIndicadores").Cells(3, 6) = "Editar"
        
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
    End If
        
End Sub
Sub databaseIndicadoresEditarSELIC()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA TABELA SELIC
' vari|fffd|veis
    ano = Year(Range("A1"))

' valida status
    If Sheets("databaseWebIndicadores").Cells(61, 5) = "Editar" Then

' libera edi|fffd||fffd|o e seleciona ano corrente
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        Range("tabDatabaseIndicadoresSELIC").Locked = False
        ActiveSheet.Shapes.Range(Array("icoEditarSELIC")).Visible = False
        ActiveSheet.Shapes.Range(Array("icoCheckSELIC")).Visible = True
        
        contLinha = 63
        Do Until Sheets("databaseWebIndicadores").Cells(contLinha, 3) = ano
        contLinha = contLinha + 1
        Loop
        
        Sheets("databaseWebIndicadores").Cells(61, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(contLinha, 4).Select
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
' finaliza edi|fffd||fffd|o
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        
        Range("tabDatabaseIndicadoresSELIC").Locked = True
        ActiveSheet.Shapes.Range(Array("icoEditarSELIC")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheckSELIC")).Visible = False
        Sheets("databaseWebIndicadores").Cells(61, 5) = "Editar"
        Sheets("mercadoIndicadores").Cells(3, 6) = "Editar"
        
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
    End If
    
End Sub
Sub databaseIndicadoresEditarCDI()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA TABELA CDI
' vari|fffd|veis
    ano = Year(Range("A1"))

' valida status
    If Sheets("databaseWebIndicadores").Cells(90, 5) = "Editar" Then

' libera edi|fffd||fffd|o e seleciona ano corrente
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        Range("tabDatabaseIndicadoresCDI").Locked = False
        ActiveSheet.Shapes.Range(Array("icoEditarCDI")).Visible = False
        ActiveSheet.Shapes.Range(Array("icoCheckCDI")).Visible = True
        
        contLinha = 92
        Do Until Sheets("databaseWebIndicadores").Cells(contLinha, 3) = ano
        contLinha = contLinha + 1
        Loop
        
        Sheets("databaseWebIndicadores").Cells(90, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(contLinha, 4).Select
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
' finaliza edi|fffd||fffd|o
        Sheets("databaseWebIndicadores").Unprotect
        Sheets("mercadoIndicadores").Unprotect
        
        Range("tabDatabaseIndicadoresCDI").Locked = True
        ActiveSheet.Shapes.Range(Array("icoEditarCDI")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheckCDI")).Visible = False
        Sheets("databaseWebIndicadores").Cells(90, 5) = "Editar"
        Sheets("mercadoIndicadores").Cells(3, 6) = "Editar"
        
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
    End If
        
End Sub




Attribute VB_Name = "M_DatabaseOpA|fffd||fffd|es"
Sub databaseAcoesFundamentus()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA FUNDAMENTUS COM C|fffd|DIGO DA A|fffd||fffd|O
' vari|fffd|veis
    codigoAcao = UCase(Range("G3"))
    
' abre p|fffd|gina do site fundamentus com o c|fffd|digo da a|fffd||fffd|o
    If codigoAcao = "#SELECIONAR" Or codigoAcao = "" Or Range("H3") = "#Empresa" Then
        ActiveWorkbook.FollowHyperlink Address:="http://fundamentus.com.br/"
        Exit Sub
        Else
        
        If Range("H3") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="http://fundamentus.com.br/detalhes.php?papel=" & codigoAcao & "&x=0&y=0"
            Exit Sub
            
        End If
    End If

End Sub
Sub databaseAcoesCheck()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA EDI|fffd||fffd|ES
' vari|fffd|veis
    tipoOperacao = Range("F3")
    codigoAcao = UCase(Range("G3"))
    tipoOpDatabase = tipoOperacao & " " & codigoAcao

' valida tipo de opera|fffd||fffd|o e finaliza procedimento
    If tipoOperacao = "Altera|fffd||fffd|o" Then
        Call databaseAcoesAlteracao
        Call sysLogDatabase
        Range("F3").Select
        ThisWorkbook.Save
        MsgBox "Altera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If tipoOperacao = "Exclus|fffd|o" Then
            Call databaseAcoesExclusao
            Call sysLogDatabase
            Range("F3").Select
            ThisWorkbook.Save
            MsgBox "Exclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If tipoOperacao = "Inclus|fffd|o" Then
                Call databaseAcoesInclusao
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Inclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
            End If
        End If
    End If
    
End Sub
Sub databaseAcoesEdicaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O COMPLETA DA TABELA DE A|fffd||fffd|ES
' vari|fffd|veis
    tipoOpDatabase = "Altera|fffd||fffd|o DB/A|fffd||fffd|es"
    
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
    If Range("F3") <> "#Selecionar" And Range("G3") <> "#C|fffd|digo" Or Range("F3") <> "#Selecionar" And Range("H3") <> "#Empresa" Then
        MsgBox "Ops! Parece que existe outra tarefa em andamento. Finalize-a antes de realizar a edi|fffd||fffd|o completa da tabela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' libera edi|fffd||fffd|o completa da tabela
        If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 12) = "" Then
            Sheets("databaseWebA|fffd||fffd|es").Unprotect
            Sheets("databaseWebA|fffd||fffd|es").Cells(3, 12) = "Finalizar edi|fffd||fffd|o completa"
            ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = False
            ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = True
            
' contabiliza |fffd|ltima linha e finaliza edi|fffd||fffd|o
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es").Locked = False
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es[Stock]").Locked = True
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es[Empresa]").Locked = True
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es[LPA]").Locked = True
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es[VPA]").Locked = True
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es[P/VP]").Locked = True
            Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es[D|fffd|vida x PL]").Locked = True
            Sheets("databaseWebA|fffd||fffd|es").Range("C5:Y5").Locked = True
            
            Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
            Range("F6").Select
            Exit Sub
            Else
            
' finaliza edi|fffd||fffd|o em andamento
            If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 12) <> "" Then
                Sheets("databaseWebA|fffd||fffd|es").Unprotect
                Sheets("databaseWebA|fffd||fffd|es").Cells(3, 12) = ""
                ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = False
                ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = True
                
' finaliza edi|fffd||fffd|o e protege tabela
                Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es").Locked = True
                Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
' finaliza|fffd||fffd|o geral
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Altera|fffd||fffd|es realizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub databaseAcoesAlteracao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA PARCIALMENTE A TABELA DE A|fffd||fffd|ES
' vari|fffd|veis
    codigoAcao = UCase(Range("G3"))
    empresa = Range("H3")
    contLinha = 6
    
' valida c|fffd|digo indicado
    If codigoAcao = "#C|fffd|DIGO" Or codigoAcao = "" Then
        MsgBox "Informe o c|fffd|digo da empresa.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If empresa = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "C|fffd|digo da empresa inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' loop para localizar ativo na tabela
            Do Until Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = "" Or Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao
            contLinha = contLinha + 1
            Loop
            
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
            If Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = "" Then
                MsgBox "O c|fffd|digo da empresa n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica status da edi|fffd||fffd|o
                If Range("J3") <> "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao Then
                    Sheets("databaseWebA|fffd||fffd|es").Unprotect
                    Sheets("databaseWebA|fffd||fffd|es").Cells(3, 10) = "Finalizar altera|fffd||fffd|o"
                    ActiveSheet.Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = False
                    ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                    
                    Sheets("databaseWebA|fffd||fffd|es").Range("F" & contLinha & ":O" & contLinha).Locked = False
                    Sheets("databaseWebA|fffd||fffd|es").Range("S" & contLinha & ":T" & contLinha).Locked = False
                    Sheets("databaseWebA|fffd||fffd|es").Range("V" & contLinha & ":Y" & contLinha).Locked = False
                    
                    Cells(contLinha, 3).Select
                    Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                    Exit Sub
                    Else
                    
                    If Range("J3") = "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao Then
                        Sheets("databaseWebA|fffd||fffd|es").Unprotect
                        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 10) = ""
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
                        Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es").Locked = True
                        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "#Selecionar"
                        Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
      End If
    
End Sub
Sub databaseAcoesExclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUI ATVIO DA TABELA DE A|fffd||fffd|ES
' vari|fffd|veis
    codigoAcao = UCase(Range("G3"))
    empresa = Range("H3")
    contLinha = 6
    tabLinha = ((contLinha * -1) + 2) + contLinha
    
' valida|fffd||fffd|o incial para finaliza|fffd||fffd|o de exclus|fffd|o aberta
    If Range("J3") <> "Finalizar exclus|fffd|o" Then
    
' valida c|fffd|digo indicado
        If codigoAcao = "#C|fffd|DIGO" Or codigoAcao = "" Then
            MsgBox "Informe o c|fffd|digo da empresa.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If empresa = "C|fffd|digo inv|fffd|lido" And Range("J3") <> "Finalizar exclus|fffd|o" Then
                MsgBox "C|fffd|digo da empresa inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' loop para localizar ativo na tabela
                Do Until Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = "" Or Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
                Loop
                
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
                If Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = "" Then
                    MsgBox "O c|fffd|digo da empresa n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma exclus|fffd|o de ativo
                    Dim confirmaExclusao As VbMsgBoxResult
                    confirmaExclusao = MsgBox("Deseja realmente excluir " & empresa & " da base de dados?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaExclusao = vbNo Then
                        Exit Sub
                        Else
                        
' verifica status da edi|fffd||fffd|o
                        If Range("J3") <> "Finalizar exclus|fffd|o" And Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao Then
                            Sheets("databaseWebA|fffd||fffd|es").Unprotect
                            Sheets("databaseWebA|fffd||fffd|es").Cells(3, 10) = "Finalizar exclus|fffd|o"
                            ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = False
                            ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                            
' remove linha do ativo indicado
                            If Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao Then
                                Sheets("databaseWebA|fffd||fffd|es").Activate
                                Cells(contLinha, 3).Select
                                Selection.ListObject.ListRows(tabLinha).Delete
                                Else
                            
                            End If
                            
                            Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                            Call databaseAcoesCheck
                            Exit Sub
                            Else
                            
                            MsgBox "Foi encontrado um erro inesperado. Entre em contato com o administrador do sistema.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            
                        End If
                    End If
                End If
            End If
        End If
    
' finaliza exclus|fffd|o aberta
        Else
        
        Sheets("databaseWebA|fffd||fffd|es").Unprotect
        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        
        Call databaseAcoesClassificar
        Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es").Locked = True
        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub
        
    End If
    
End Sub
Sub databaseAcoesInclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ADICIONA C|fffd|DIGO AO BANCO DE DADOS
' vari|fffd|veis
    codigoAcao = UCase(Range("G3"))
    empresa = Range("H3")

' valida status da inclus|fffd|o
    If Range("F3") = "Inclus|fffd|o" And Range("J3") <> "Finalizar inclus|fffd|o" Then
                    
' valida preenchimento dos campos
        If codigoAcao = "#C|fffd|DIGO" Or codigoAcao = "" Then
            MsgBox "Informe o c|fffd|digo da empresa.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If empresa = "#Empresa" Or empresa = "" Then
                MsgBox "Informe o nome da empresa.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica se ativo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                contLinha = 6
                Do Until Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = "" Or Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao
                contLinha = contLinha + 1
                Loop
                
                If Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao Then
                    MsgBox "A empresa " & empresa & " j|fffd| est|fffd| cadastrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma|fffd||fffd|o para registro dos dados
                    Dim confirmaRegistro As VbMsgBoxResult
                    confirmaRegistro = MsgBox("Deseja adicionar a empresa " & empresa & " (" & codigoAcao & ") ao banco de dados?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaRegistro = vbNo Then
                        Exit Sub
                        Else
                        
' localiza linha vazia na tabela e registra dados
                        Sheets("databaseWebA|fffd||fffd|es").Unprotect
                        If Sheets("databaseWebA|fffd||fffd|es").Cells(6, 3) = "" Then
                            contLinha = 6
                            Else
                            contLinha = Sheets("databaseWebA|fffd||fffd|es").Cells(Rows.Count, 3).End(xlUp).Row + 1
                            
                        End If
                        
                        Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao
                        Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 6) = empresa
                        Call databaseAcoesClassificar
                        
' classifica e seleciona novo ativo cadastrado
                        contLinha = 6
                        Do Until Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAcao
                        contLinha = contLinha + 1
                        Loop
                        
                        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 10) = "Finalizar inclus|fffd|o"
                        ActiveSheet.Shapes.Range(Array("icoInclus|fffd|o")).Visible = False
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                        
                        Sheets("databaseWebA|fffd||fffd|es").Range("G" & contLinha & ":O" & contLinha).Locked = False
                        Sheets("databaseWebA|fffd||fffd|es").Range("S" & contLinha & ":T" & contLinha).Locked = False
                        Sheets("databaseWebA|fffd||fffd|es").Range("V" & contLinha & ":Y" & contLinha).Locked = False
                        
                        Cells(contLinha, 7).Select
                        Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                        MsgBox "Tudo pronto! Finalize a inlus|fffd|o dos dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
' finaliza|fffd||fffd|o geral
                        
                    End If
                End If
            End If
        End If
        
' finaliza inclus|fffd|o
        Else
        
        Sheets("databaseWebA|fffd||fffd|es").Unprotect
        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        Sheets("databaseWebA|fffd||fffd|es").Range("tabDatabaseWebA|fffd||fffd|es").Locked = True
        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub

    End If
    
End Sub
Sub databaseAcoesClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE A|fffd||fffd|ES
' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("databaseWebA|fffd||fffd|es").ListObjects("tabDatabaseWebA|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseWebA|fffd||fffd|es").ListObjects("tabDatabaseWebA|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabDatabaseWebA|fffd||fffd|es[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseWebA|fffd||fffd|es").ListObjects("tabDatabaseWebA|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_DatabaseOpC|fffd|mbio"
Sub databaseCambioInvesting()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA REUTERS COM C|fffd|DIGO DA MOEDA
' vari|fffd|veis
    codigoMoeda = UCase(Range("G3"))
    
' abre p|fffd|gina do site Reuters com o c|fffd|digo da moeda
    If codigoMoeda = "#C|fffd|DIGO" And Range("H3") = "#Moeda" Then
        ActiveWorkbook.FollowHyperlink Address:="https://www.reuters.com/finance/currencies"
        Exit Sub
        Else
        
        If Range("H3") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="https://www.reuters.com/finance/currencies/quote?srcAmt=1&srcCurr=" & codigoMoeda & "&destAmt=&destCurr=BRL"
            Exit Sub
            
        End If
    End If

End Sub
Sub databaseCambioCheck()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA EDI|fffd||fffd|ES
' vari|fffd|veis
    tipoOperacao = Range("F3")
    codigoMoeda = UCase(Range("G3"))
    codigoMoeda = Replace(codigoMoeda, "/", "-")
    tipoOpDatabase = tipoOperacao & " " & codigoMoeda

' valida tipo de opera|fffd||fffd|o e finaliza procedimento
    If tipoOperacao = "Altera|fffd||fffd|o" Then
        Call databaseCambioAlteracao
        Call sysLogDatabase
        Range("F3").Select
        ThisWorkbook.Save
        MsgBox "Altera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If tipoOperacao = "Exclus|fffd|o" Then
            Call databaseCambioExclusao
            Call sysLogDatabase
            Range("F3").Select
            ThisWorkbook.Save
            MsgBox "Exclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If tipoOperacao = "Inclus|fffd|o" Then
                Call databaseCambioInclusao
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Inclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
            End If
        End If
    End If
    
End Sub
Sub databaseCambioEdicaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O COMPLETA DA TABELA DE MOEDAS
' vari|fffd|veis
    tipoOpDatabase = "Altera|fffd||fffd|o DB/C|fffd|mbio"
    
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
    If Range("F3") <> "#Selecionar" And Range("G3") <> "#C|fffd|digo" Or Range("F3") <> "#Selecionar" And Range("H3") <> "#Moeda" Then
        MsgBox "Ops! Parece que existe outra tarefa em andamento. Finalize-a antes de realizar a edi|fffd||fffd|o completa da tabela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' libera edi|fffd||fffd|o completa da tabela
        If Sheets("databaseWebC|fffd|mbio").Cells(3, 12) = "" Then
            Sheets("databaseWebC|fffd|mbio").Unprotect
            Sheets("databaseWebC|fffd|mbio").Cells(3, 12) = "Finalizar edi|fffd||fffd|o completa"
            ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = False
            ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = True
            
' contabiliza |fffd|ltima linha e finaliza edi|fffd||fffd|o
            Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio").Locked = False
            Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio[ID]").Locked = True
            Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio[C|fffd|digo]").Locked = True
            Sheets("databaseWebC|fffd|mbio").Range("C5:J5").Locked = True
            
            Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
            Range("F6").Select
            Exit Sub
            Else
            
' finaliza edi|fffd||fffd|o em andamento
            If Sheets("databaseWebC|fffd|mbio").Cells(3, 12) <> "" Then
                Sheets("databaseWebC|fffd|mbio").Unprotect
                Sheets("databaseWebC|fffd|mbio").Cells(3, 12) = ""
                ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = False
                ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = True
                
' finaliza edi|fffd||fffd|o e protege tabela
                Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio").Locked = True
                Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
' finaliza|fffd||fffd|o geral
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Altera|fffd||fffd|es realizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub databaseCambioAlteracao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA PARCIALMENTE A TABELA DE MOEDAS
' vari|fffd|veis
    codigoMoeda = UCase(Range("G3"))
    moeda = Range("H3")
    contLinha = 6
    
' valida c|fffd|digo indicado
    If codigoMoeda = "#C|fffd|DIGO" Or codigoMoeda = "" Then
        MsgBox "Informe o c|fffd|digo da moeda.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If moeda = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "C|fffd|digo da moeda inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' loop para localizar ativo na tabela
            Do Until Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 3) = "" Or Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda
            contLinha = contLinha + 1
            Loop
            
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
            If Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 3) = "" Then
                MsgBox "O c|fffd|digo da moeda n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica status da edi|fffd||fffd|o
                If Range("J3") <> "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda Then
                    Sheets("databaseWebC|fffd|mbio").Unprotect
                    Sheets("databaseWebC|fffd|mbio").Cells(3, 10) = "Finalizar altera|fffd||fffd|o"
                    ActiveSheet.Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = False
                    ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                    
                    Sheets("databaseWebC|fffd|mbio").Range("D" & contLinha).Locked = False
                    Sheets("databaseWebC|fffd|mbio").Range("F" & contLinha & ":J" & contLinha).Locked = False
                    Cells(contLinha, 4).Select
                    Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                    Exit Sub
                    Else
                    
                    If Range("J3") = "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda Then
                        Sheets("databaseWebC|fffd|mbio").Unprotect
                        Sheets("databaseWebC|fffd|mbio").Cells(3, 10) = ""
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
                        Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio").Locked = True
                        Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "#Selecionar"
                        Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
      End If
    
End Sub
Sub databaseCambioExclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUI ATVIO DA TABELA DE MOEDAS
' vari|fffd|veis
    codigoMoeda = UCase(Range("G3"))
    moeda = Range("H3")
    contLinha = 6
    tabLinha = ((contLinha * -1) + 2) + contLinha
    
' valida|fffd||fffd|o incial para finaliza|fffd||fffd|o de exclus|fffd|o aberta
    If Range("J3") <> "Finalizar exclus|fffd|o" Then
    
' valida c|fffd|digo indicado
        If codigoMoeda = "#ID" Or codigoMoeda = "" Then
            MsgBox "Informe o c|fffd|digo da moeda.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If moeda = "C|fffd|digo inv|fffd|lido" And Range("J3") <> "Finalizar exclus|fffd|o" Then
                MsgBox "C|fffd|digo da moeda inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' loop para localizar ativo na tabela
                Do Until Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 3) = "" Or Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
                Loop
                
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
                If Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 3) = "" Then
                    MsgBox "O c|fffd|digo da moeda n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma exclus|fffd|o de ativo
                    Dim confirmaExclusao As VbMsgBoxResult
                    confirmaExclusao = MsgBox("Deseja realmente excluir " & moeda & " da base de dados?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaExclusao = vbNo Then
                        Exit Sub
                        Else
                        
' verifica status da edi|fffd||fffd|o
                        If Range("J3") <> "Finalizar exclus|fffd|o" And Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda Then
                            Sheets("databaseWebC|fffd|mbio").Unprotect
                            Sheets("databaseWebC|fffd|mbio").Cells(3, 10) = "Finalizar exclus|fffd|o"
                            ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = False
                            ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                            
' remove linha do ativo indicado
                            If Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda Then
                                Sheets("databaseWebC|fffd|mbio").Activate
                                Cells(contLinha, 3).Select
                                Selection.ListObject.ListRows(tabLinha).Delete
                                Else
                            
                            End If
                            
                            Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                            Call databaseCambioCheck
                            Exit Sub
                            Else
                            
                            MsgBox "Foi encontrado um erro inesperado. Entre em contato com o administrador do sistema.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            
                        End If
                    End If
                End If
            End If
        End If
    
' finaliza exclus|fffd|o aberta
        Else
        
        Sheets("databaseWebC|fffd|mbio").Unprotect
        Sheets("databaseWebC|fffd|mbio").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        
        Call databaseCambioClassificar
        Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio").Locked = True
        Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub
        
    End If
    
End Sub
Sub databaseCambioInclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ADICIONA C|fffd|DIGO AO BANCO DE DADOS
' vari|fffd|veis
    codigoMoeda = UCase(Range("G3"))
    moeda = Range("H3")
    
' valida status da inclus|fffd|o
    If Range("F3") = "Inclus|fffd|o" And Range("J3") <> "Finalizar inclus|fffd|o" Then
                    
' valida preenchimento dos campos
        If codigoMoeda = "#C|fffd|DIGO" Or codigoMoeda = "" Then
            MsgBox "Informe o c|fffd|digo da moeda.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If moeda = "#Moeda" Or moeda = "" Then
                MsgBox "Informe o nome da moeda.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica se ativo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                contLinha = 6
                Do Until Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 3) = "" Or Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda
                contLinha = contLinha + 1
                Loop
                
                If Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda Then
                    MsgBox "A moeda " & moeda & " j|fffd| est|fffd| cadastrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma|fffd||fffd|o para registro dos dados
                    Dim confirmaRegistro As VbMsgBoxResult
                    confirmaRegistro = MsgBox("Deseja adicionar " & moeda & " (" & codigoMoeda & ") ao banco de dados?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaRegistro = vbNo Then
                        Exit Sub
                        Else
                        
' localiza linha vazia na tabela e registra dados
                        Sheets("databaseWebC|fffd|mbio").Unprotect
                        If Sheets("databaseWebC|fffd|mbio").Cells(6, 3) = "" Then
                            contLinha = 6
                            Else
                            contLinha = Sheets("databaseWebC|fffd|mbio").Cells(Rows.Count, 3).End(xlUp).Row + 1
                            
                        End If
                        
                        Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 3) = codigoMoeda & "/BRL"
                        Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 4) = moeda
                        Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda
                        Call databaseCambioClassificar
                        
' classifica e seleciona novo ativo cadastrado
                        contLinha = 6
                        Do Until Sheets("databaseWebC|fffd|mbio").Cells(contLinha, 5) = codigoMoeda
                        contLinha = contLinha + 1
                        Loop
                        
                        Sheets("databaseWebC|fffd|mbio").Cells(3, 10) = "Finalizar inclus|fffd|o"
                        ActiveSheet.Shapes.Range(Array("icoInclus|fffd|o")).Visible = False
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                        
                        Sheets("databaseWebC|fffd|mbio").Range("F" & contLinha & ":J" & contLinha).Locked = False
                        
                        Cells(contLinha, 6).Select
                        Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                        MsgBox "Tudo pronto; finalize a inlus|fffd|o dos dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
' finaliza|fffd||fffd|o geral
                        
                    End If
                End If
            End If
        End If
        
' finaliza inclus|fffd|o
        Else
        
        Sheets("databaseWebC|fffd|mbio").Unprotect
        Sheets("databaseWebC|fffd|mbio").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        Sheets("databaseWebC|fffd|mbio").Range("tabDatabaseWebC|fffd|mbio").Locked = True
        Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub

    End If
    
End Sub
Sub databaseCambioClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE MOEDAS
' libera edi|fffd||fffd|o
    Sheets("databaseWebC|fffd|mbio").Unprotect

' classifica|fffd||fffd|o crescente por ID
    ActiveWorkbook.Worksheets("databaseWebC|fffd|mbio").ListObjects("tabDatabaseWebC|fffd|mbio").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseWebC|fffd|mbio").ListObjects("tabDatabaseWebC|fffd|mbio").Sort. _
        SortFields.Add Key:=Range("tabDatabaseWebC|fffd|mbio[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseWebC|fffd|mbio").ListObjects("tabDatabaseWebC|fffd|mbio").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_DatabaseOpETFs"
Sub databaseETFsSite()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DO ETF
' vari|fffd|veis
    linkSite = Range("M3")
    codigoFundo = UCase(Range("G3"))
    
' abre p|fffd|gina do site do fundo
    If linkSite = "" Then
        Exit Sub
        Else
        
        If codigoFundo = "" Or codigoFundo = "#SELECIONAR" And Range("F3") <> "Inclus|fffd|o" And Range("H3") = "#Fundo" Then
            MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
        
            If Range("H3") = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                ActiveWorkbook.FollowHyperlink Address:=linkSite
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub databaseETFsCheck()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA EDI|fffd||fffd|ES
' vari|fffd|veis
    tipoOperacao = Range("F3")
    codigoFundo = UCase(Range("G3"))
    tipoOpDatabase = tipoOperacao & " " & codigoFundo

' valida tipo de opera|fffd||fffd|o e finaliza procedimento
    If tipoOperacao = "Altera|fffd||fffd|o" Then
        Call databaseETFsAlteracao
        Call sysLogDatabase
        Range("F3").Select
        ThisWorkbook.Save
        MsgBox "Altera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If tipoOperacao = "Exclus|fffd|o" Then
            Call databaseETFsExclusao
            Call sysLogDatabase
            Range("F3").Select
            ThisWorkbook.Save
            MsgBox "Exclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If tipoOperacao = "Inclus|fffd|o" Then
                Call databaseETFsInclusao
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Inclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
            End If
        End If
    End If
    
End Sub
Sub databaseETFsEdicaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O COMPLETA DA TABELA DE ETFS
' vari|fffd|veis
    tipoOpDatabase = "Altera|fffd||fffd|o DB/ETFs"
    
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
    If Range("F3") <> "#Selecionar" And Range("G3") <> "#C|fffd|digo" Or Range("F3") <> "#Selecionar" And Range("H3") <> "#Empresa" Then
        MsgBox "Ops! Parece que existe outra tarefa em andamento. Finalize-a antes de realizar a edi|fffd||fffd|o completa da tabela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' libera edi|fffd||fffd|o completa da tabela
        If Sheets("databaseWebETFs").Cells(3, 12) = "" Then
            Sheets("databaseWebETFs").Unprotect
            Sheets("databaseWebETFs").Cells(3, 12) = "Finalizar edi|fffd||fffd|o completa"
            ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = False
            ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = True
            
' contabiliza |fffd|ltima linha e finaliza edi|fffd||fffd|o
            Sheets("databaseWebETFs").Range("tabDatabaseWebETFs").Locked = False
            Sheets("databaseWebETFs").Range("tabDatabaseWebETFs[Stock]").Locked = True
            Sheets("databaseWebETFs").Range("tabDatabaseWebETFs[Fundo]").Locked = True
            Sheets("databaseWebETFs").Range("C5:P5").Locked = True
            
            Sheets("databaseWebETFs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
            Range("F6").Select
            Exit Sub
            Else
            
' finaliza edi|fffd||fffd|o em andamento
            If Sheets("databaseWebETFs").Cells(3, 12) <> "" Then
                Sheets("databaseWebETFs").Unprotect
                Sheets("databaseWebETFs").Cells(3, 12) = ""
                ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = False
                ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = True
                
' finaliza edi|fffd||fffd|o e protege tabela
                Sheets("databaseWebETFs").Range("tabDatabaseWebETFs").Locked = True
                Sheets("databaseWebETFs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
' finaliza|fffd||fffd|o geral
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Altera|fffd||fffd|es realizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub databaseETFsAlteracao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA PARCIALMENTE A TABELA DE ETFS
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    fundo = Range("H3")
    contLinha = 6
    
' valida c|fffd|digo indicado
    If codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "" Then
        MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If fundo = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' loop para localizar ativo na tabela
            Do Until Sheets("databaseWebETFs").Cells(contLinha, 3) = "" Or Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo
            contLinha = contLinha + 1
            Loop
            
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
            If Sheets("databaseWebETFs").Cells(contLinha, 3) = "" Then
                MsgBox "O c|fffd|digo do fundo n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica status da edi|fffd||fffd|o
                If Range("J3") <> "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo Then
                    Sheets("databaseWebETFs").Unprotect
                    Sheets("databaseWebETFs").Cells(3, 10) = "Finalizar altera|fffd||fffd|o"
                    ActiveSheet.Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = False
                    ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                    
                    Sheets("databaseWebETFs").Range("F" & contLinha & ":P" & contLinha).Locked = False
                    
                    Cells(contLinha, 3).Select
                    Sheets("databaseWebETFs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                    Exit Sub
                    Else
                    
                    If Range("J3") = "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo Then
                        Sheets("databaseWebETFs").Unprotect
                        Sheets("databaseWebETFs").Cells(3, 10) = ""
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
                        Sheets("databaseWebETFs").Range("tabDatabaseWebETFs").Locked = True
                        Sheets("databaseWebETFs").Cells(3, 6) = "#Selecionar"
                        Sheets("databaseWebETFs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
      End If
    
End Sub
Sub databaseETFsExclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUI ATVIO DA TABELA DE ETFS
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    fundo = Range("H3")
    contLinha = 6
    tabLinha = ((contLinha * -1) + 2) + contLinha
    
' valida|fffd||fffd|o incial para finaliza|fffd||fffd|o de exclus|fffd|o aberta
    If Range("J3") <> "Finalizar exclus|fffd|o" Then
    
' valida c|fffd|digo indicado
        If codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "" Then
            MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If fundo = "C|fffd|digo inv|fffd|lido" And Range("J3") <> "Finalizar exclus|fffd|o" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' loop para localizar ativo na tabela
                Do Until Sheets("databaseWebETFs").Cells(contLinha, 3) = "" Or Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
                Loop
                
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
                If Sheets("databaseWebETFs").Cells(contLinha, 3) = "" Then
                    MsgBox "O c|fffd|digo do fundo n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma exclus|fffd|o de ativo
                    Dim confirmaExclusao As VbMsgBoxResult
                    confirmaExclusao = MsgBox("Deseja realmente excluir " & fundo & " da base de dados?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaExclusao = vbNo Then
                        Exit Sub
                        Else
                        
' verifica status da edi|fffd||fffd|o
                        If Range("J3") <> "Finalizar exclus|fffd|o" And Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo Then
                            Sheets("databaseWebETFs").Unprotect
                            Sheets("databaseWebETFs").Cells(3, 10) = "Finalizar exclus|fffd|o"
                            ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = False
                            ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                            
' remove linha do ativo indicado
                            If Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo Then
                                Sheets("databaseWebETFs").Activate
                                Cells(contLinha, 3).Select
                                Selection.ListObject.ListRows(tabLinha).Delete
                                Else
                            
                            End If

                            Sheets("databaseWebETFs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                            Call databaseETFsCheck
                            Exit Sub
                            Else
                            
                            MsgBox "Foi encontrado um erro inesperado. Entre em contato com o administrador do sistema.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            
                        End If
                    End If
                End If
            End If
        End If
    
' finaliza exclus|fffd|o aberta
        Else
        
        Sheets("databaseWebETFs").Unprotect
        Sheets("databaseWebETFs").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        
        Call databaseETFsClassificar
        Sheets("databaseWebETFs").Range("tabDatabaseWebETFs").Locked = True
        Sheets("databaseWebETFs").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebETFs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub
        
    End If
    
End Sub
Sub databaseETFsInclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ADICIONA C|fffd|DIGO AO BANCO DE DADOS
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    fundo = Range("H3")

' valida status da inclus|fffd|o
    If Range("F3") = "Inclus|fffd|o" And Range("J3") <> "Finalizar inclus|fffd|o" Then
                    
' valida preenchimento dos campos
        If codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "" Then
            MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If fundo = "#Empresa" Or fundo = "" Then
                MsgBox "Informe o nome do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica se ativo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                contLinha = 6
                Do Until Sheets("databaseWebETFs").Cells(contLinha, 3) = "" Or Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo Then
                    MsgBox "A fundo " & fundo & " j|fffd| est|fffd| cadastrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma|fffd||fffd|o para registro dos dados
                    Dim confirmaRegistro As VbMsgBoxResult
                    confirmaRegistro = MsgBox("Deseja adicionar a fundo " & fundo & " (" & codigoFundo & ") ao banco de dados?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaRegistro = vbNo Then
                        Exit Sub
                        Else
                        
' localiza linha vazia na tabela e registra dados
                        Sheets("databaseWebETFs").Unprotect
                        If Sheets("databaseWebETFs").Cells(6, 3) = "" Then
                            contLinha = 6
                            Else
                            contLinha = Sheets("databaseWebETFs").Cells(Rows.Count, 3).End(xlUp).Row + 1
                            
                        End If
                        
                        Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo
                        Sheets("databaseWebETFs").Cells(contLinha, 6) = fundo
                        Call databaseETFsClassificar
                        
' classifica e seleciona novo ativo cadastrado
                        contLinha = 6
                        Do Until Sheets("databaseWebETFs").Cells(contLinha, 3) = codigoFundo
                        contLinha = contLinha + 1
                        Loop
                        
                        Sheets("databaseWebETFs").Cells(3, 10) = "Finalizar inclus|fffd|o"
                        ActiveSheet.Shapes.Range(Array("icoInclus|fffd|o")).Visible = False
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                        
                        Sheets("databaseWebETFs").Range("F" & contLinha & ":P" & contLinha).Locked = False
                        
                        Cells(contLinha, 7).Select
                        Sheets("databaseWebETFs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                        MsgBox "Tudo pronto! Finalize a inlus|fffd|o dos dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
' finaliza|fffd||fffd|o geral
                        
                    End If
                End If
            End If
        End If
        
' finaliza inclus|fffd|o
        Else
        
        Sheets("databaseWebETFs").Unprotect
        Sheets("databaseWebETFs").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        Sheets("databaseWebETFs").Range("tabDatabaseWebETFs").Locked = True
        Sheets("databaseWebETFs").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebETFs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub

    End If
    
End Sub
Sub databaseETFsClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ETFS
' libera edi|fffd||fffd|o
    Sheets("databaseWebETFs").Unprotect

' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("databaseWebETFs").ListObjects("tabDatabaseWebETFs").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseWebETFs").ListObjects("tabDatabaseWebETFs").Sort. _
        SortFields.Add Key:=Range("tabDatabaseWebFIIs[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseWebETFs").ListObjects("tabDatabaseWebETFs").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_DatabaseOpFIIs"
Sub databaseFIIsSiteFIIs()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA FIIS COM C|fffd|DIGO DO FUNDO
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    
' abre p|fffd|gina do site FIIs com o c|fffd|digo do fundo
    If codigoFundo = "" Or codigoFundo = "#SELECIONAR" And Range("F3") <> "Inclus|fffd|o" And Range("H3") = "#Fundo" Then
        ActiveWorkbook.FollowHyperlink Address:="http://fiis.com.br/"
        Exit Sub
        Else
    
        If Range("H3") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="http://fiis.com.br/" & codigoFundo
            Exit Sub
            
        End If
    End If

End Sub
Sub databaseFIIsCheck()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA EDI|fffd||fffd|ES
' vari|fffd|veis
    tipoOperacao = Range("F3")
    codigoFundo = UCase(Range("G3"))
    tipoOpDatabase = tipoOperacao & " " & codigoFundo

' valida tipo de opera|fffd||fffd|o e finaliza procedimento
    If tipoOperacao = "Altera|fffd||fffd|o" Then
        Call databaseFIIsAlteracao
        Call sysLogDatabase
        Range("F3").Select
        ThisWorkbook.Save
        MsgBox "Altera|fffd||fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If tipoOperacao = "Exclus|fffd|o" Then
            Call databaseFIIsExclusao
            Call sysLogDatabase
            Range("F3").Select
            ThisWorkbook.Save
            MsgBox "Exclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If tipoOperacao = "Inclus|fffd|o" Then
                Call databaseFIIsInclusao
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Inclus|fffd|o realizada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
            End If
        End If
    End If
    
End Sub
Sub databaseFIIsEdicaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O COMPLETA DA TABELA DE ETFS
' vari|fffd|veis
    tipoOpDatabase = "Altera|fffd||fffd|o DB/FIIs"
    
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
    If Range("F3") <> "#Selecionar" And Range("G3") <> "#C|fffd|digo" Or Range("F3") <> "#Selecionar" And Range("H3") <> "#Empresa" Then
        MsgBox "Ops! Parece que existe outra tarefa em andamento. Finalize-a antes de realizar a edi|fffd||fffd|o completa da tabela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' libera edi|fffd||fffd|o completa da tabela
        If Sheets("databaseWebFIIs").Cells(3, 12) = "" Then
            Sheets("databaseWebFIIs").Unprotect
            Sheets("databaseWebFIIs").Cells(3, 12) = "Finalizar edi|fffd||fffd|o completa"
            ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = False
            ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = True
            
' contabiliza |fffd|ltima linha e finaliza edi|fffd||fffd|o
            Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs").Locked = False
            Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs[Stock]").Locked = True
            Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs[Fundo]").Locked = True
            Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs[Desconto]").Locked = True
            Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs[VPC]").Locked = True
            Sheets("databaseWebFIIs").Range("C5:X5").Locked = True
            
            Sheets("databaseWebFIIs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
            Range("F6").Select
            Exit Sub
            Else
            
' finaliza edi|fffd||fffd|o em andamento
            If Sheets("databaseWebFIIs").Cells(3, 12) <> "" Then
                Sheets("databaseWebFIIs").Unprotect
                Sheets("databaseWebFIIs").Cells(3, 12) = ""
                ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = False
                ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = True
                
' finaliza edi|fffd||fffd|o e protege tabela
                Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs").Locked = True
                Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
' finaliza|fffd||fffd|o geral
                Call sysLogDatabase
                Range("F3").Select
                ThisWorkbook.Save
                MsgBox "Altera|fffd||fffd|es realizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If

End Sub
Sub databaseFIIsAlteracao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDITA PARCIALMENTE A TABELA DE ETFS
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    fundo = Range("H3")
    contLinha = 6
    
' valida c|fffd|digo indicado
    If codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "" Then
        MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If fundo = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' loop para localizar ativo na tabela
            Do Until Sheets("databaseWebFIIs").Cells(contLinha, 3) = "" Or Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo
            contLinha = contLinha + 1
            Loop
            
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
            If Sheets("databaseWebFIIs").Cells(contLinha, 3) = "" Then
                MsgBox "O c|fffd|digo do fundo n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica status da edi|fffd||fffd|o
                If Range("J3") <> "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo Then
                    Sheets("databaseWebFIIs").Unprotect
                    Sheets("databaseWebFIIs").Cells(3, 10) = "Finalizar altera|fffd||fffd|o"
                    ActiveSheet.Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = False
                    ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                    
                    Sheets("databaseWebFIIs").Range("F" & contLinha & ":O" & contLinha).Locked = False
                    Sheets("databaseWebFIIs").Range("R" & contLinha & ":X" & contLinha).Locked = False
                    
                    Cells(contLinha, 3).Select
                    Sheets("databaseWebFIIs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                    Exit Sub
                    Else
                    
                    If Range("J3") = "Finalizar altera|fffd||fffd|o" And Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo Then
                        Sheets("databaseWebFIIs").Unprotect
                        Sheets("databaseWebFIIs").Cells(3, 10) = ""
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
                        Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs").Locked = True
                        Sheets("databaseWebFIIs").Cells(3, 6) = "#Selecionar"
                        Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
      End If
    
End Sub
Sub databaseFIIsExclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUI ATVIO DA TABELA DE ETFS
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    fundo = Range("H3")
    contLinha = 6
    tabLinha = ((contLinha * -1) + 2) + contLinha
    
' valida|fffd||fffd|o incial para finaliza|fffd||fffd|o de exclus|fffd|o aberta
    If Range("J3") <> "Finalizar exclus|fffd|o" Then
    
' valida c|fffd|digo indicado
        If codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "" Then
            MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If fundo = "C|fffd|digo inv|fffd|lido" And Range("J3") <> "Finalizar exclus|fffd|o" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' loop para localizar ativo na tabela
                Do Until Sheets("databaseWebFIIs").Cells(contLinha, 3) = "" Or Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
                Loop
                
' valida exist|fffd|ncia do ativo e confirma altera|fffd||fffd|o
                If Sheets("databaseWebFIIs").Cells(contLinha, 3) = "" Then
                    MsgBox "O c|fffd|digo do fundo n|fffd|o foi localizado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma exclus|fffd|o de ativo
                    Dim confirmaExclusao As VbMsgBoxResult
                    confirmaExclusao = MsgBox("Deseja realmente excluir " & fundo & " da base de dados?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaExclusao = vbNo Then
                        Exit Sub
                        Else
                        
' verifica status da edi|fffd||fffd|o
                        If Range("J3") <> "Finalizar exclus|fffd|o" And Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo Then
                            Sheets("databaseWebFIIs").Unprotect
                            Sheets("databaseWebFIIs").Cells(3, 10) = "Finalizar exclus|fffd|o"
                            ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = False
                            ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                            
' remove linha do ativo indicado
                            If Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo Then
                                Sheets("databaseWebFIIs").Activate
                                Cells(contLinha, 3).Select
                                Selection.ListObject.ListRows(tabLinha).Delete
                                Else
                            
                            End If

                            Sheets("databaseWebFIIs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                            Call databaseFIIsCheck
                            Exit Sub
                            Else
                            
                            MsgBox "Foi encontrado um erro inesperado. Entre em contato com o administrador do sistema.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            
                        End If
                    End If
                End If
            End If
        End If
    
' finaliza exclus|fffd|o aberta
        Else
        
        Sheets("databaseWebFIIs").Unprotect
        Sheets("databaseWebFIIs").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        
        Call databaseFIIsClassificar
        Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs").Locked = True
        Sheets("databaseWebFIIs").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub
        
    End If
    
End Sub
Sub databaseFIIsInclusao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ADICIONA C|fffd|DIGO AO BANCO DE DADOS
' vari|fffd|veis
    codigoFundo = UCase(Range("G3"))
    fundo = Range("H3")

' valida status da inclus|fffd|o
    If Range("F3") = "Inclus|fffd|o" And Range("J3") <> "Finalizar inclus|fffd|o" Then
                    
' valida preenchimento dos campos
        If codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "" Then
            MsgBox "Informe o c|fffd|digo do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If fundo = "#Empresa" Or fundo = "" Then
                MsgBox "Informe o nome do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
' verifica se ativo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                contLinha = 6
                Do Until Sheets("databaseWebFIIs").Cells(contLinha, 3) = "" Or Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo Then
                    MsgBox "A fundo " & fundo & " j|fffd| est|fffd| cadastrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' confirma|fffd||fffd|o para registro dos dados
                    Dim confirmaRegistro As VbMsgBoxResult
                    confirmaRegistro = MsgBox("Deseja adicionar a fundo " & fundo & " (" & codigoFundo & ") ao banco de dados?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaRegistro = vbNo Then
                        Exit Sub
                        Else
                        
' localiza linha vazia na tabela e registra dados
                        Sheets("databaseWebFIIs").Unprotect
                        If Sheets("databaseWebFIIs").Cells(6, 3) = "" Then
                            contLinha = 6
                            Else
                            contLinha = Sheets("databaseWebFIIs").Cells(Rows.Count, 3).End(xlUp).Row + 1
                            
                        End If
                        
                        Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo
                        Sheets("databaseWebFIIs").Cells(contLinha, 6) = fundo
                        Call databaseFIIsClassificar
                        
' classifica e seleciona novo ativo cadastrado
                        contLinha = 6
                        Do Until Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoFundo
                        contLinha = contLinha + 1
                        Loop
                        
                        Sheets("databaseWebFIIs").Cells(3, 10) = "Finalizar inclus|fffd|o"
                        ActiveSheet.Shapes.Range(Array("icoInclus|fffd|o")).Visible = False
                        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = True
                        
                        Sheets("databaseWebFIIs").Range("F" & contLinha & ":O" & contLinha).Locked = False
                        Sheets("databaseWebFIIs").Range("R" & contLinha & ":X" & contLinha).Locked = False
                        
                        Cells(contLinha, 7).Select
                        Sheets("databaseWebFIIs").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
                        MsgBox "Tudo pronto! Finalize a inlus|fffd|o dos dados.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
' finaliza|fffd||fffd|o geral
                        
                    End If
                End If
            End If
        End If
        
' finaliza inclus|fffd|o
        Else
        
        Sheets("databaseWebFIIs").Unprotect
        Sheets("databaseWebFIIs").Cells(3, 10) = ""
        ActiveSheet.Shapes.Range(Array("icoCheck")).Visible = False
        Sheets("databaseWebFIIs").Range("tabDatabaseWebFIIs").Locked = True
        Sheets("databaseWebFIIs").Cells(3, 6) = "#Selecionar"
        Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Exit Sub

    End If
    
End Sub
Sub databaseFIIsClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE FIIS
' libera edi|fffd||fffd|o
    Sheets("databaseWebFIIs").Unprotect

' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("databaseWebFIIs").ListObjects("tabDatabaseWebFIIs").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseWebFIIs").ListObjects("tabDatabaseWebFIIs").Sort. _
        SortFields.Add Key:=Range("tabDatabaseWebFIIs[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseWebFIIs").ListObjects("tabDatabaseWebFIIs").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' ajusta formato da coluna
    Range("tabDatabaseWebFIIs[Constitui|fffd||fffd|o]").NumberFormat = "dd/mm/yyyy"

End Sub


Attribute VB_Name = "M_DatabaseOpInst"
Sub databaseInstituicoesEdicaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O COMPLETA DA TABELA DE INSTITUI|fffd||fffd|ES
' vari|fffd|veis
    tipoOpDatabase = "Altera|fffd||fffd|o DB/Institui|fffd||fffd|es"
    
' libera edi|fffd||fffd|o completa da tabela
    If Sheets("databaseInst").Cells(3, 12) = "" Then
        Sheets("databaseInst").Unprotect
        Sheets("databaseInst").Cells(3, 12) = "Finalizar edi|fffd||fffd|o completa"
        ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = False
        ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = True
        
' contabiliza |fffd|ltima linha e finaliza edi|fffd||fffd|o
        Sheets("databaseInst").Range("tabDatabaseCorretoras").Locked = False
        Sheets("databaseInst").Range("C5:K5").Locked = True
        Sheets("databaseInst").Range("tabDatabaseInstitui|fffd||fffd|es").Locked = False
        Sheets("databaseInst").Range("C30:K30").Locked = True
        Sheets("databaseInst").Range("tabDatabaseLojas").Locked = False
        Sheets("databaseInst").Range("C65:K65").Locked = True
        Sheets("databaseInst").Protect DrawingObjects:=False, Scenarios:=True, Contents:=True
        Range("C6").Select
        Exit Sub
        Else
        
' finaliza edi|fffd||fffd|o em andamento
        If Sheets("databaseInst").Cells(3, 12) <> "" Then
            Sheets("databaseInst").Unprotect
            Sheets("databaseInst").Cells(3, 12) = ""
            ActiveSheet.Shapes.Range(Array("btnFinalizar")).Visible = False
            ActiveSheet.Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = True
            
' finaliza edi|fffd||fffd|o e protege tabela
            Sheets("databaseInst").Range("tabDatabaseCorretoras").Locked = True
            Sheets("databaseInst").Range("tabDatabaseLojas").Locked = True
            Sheets("databaseInst").Range("tabDatabaseInstitui|fffd||fffd|es").Locked = True
            Range("tabDatabaseInstitui|fffd||fffd|es[Funda|fffd||fffd|o]").NumberFormat = "dd/mm/yyyy"
            Sheets("databaseInst").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
                
' finaliza|fffd||fffd|o geral
            Call sysLogDatabase
            ThisWorkbook.Save
            MsgBox "Altera|fffd||fffd|es realizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If

End Sub
Sub databaseInstituicoesClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELAS DE INSTITUI|fffd||fffd|ES
' classifica|fffd||fffd|o crescente por nome
    Sheets("databaseInst").Unprotect
    
' corretoras
    ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseCorretoras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseCorretoras").Sort. _
        SortFields.Add Key:=Range("tabDatabaseCorretoras[[#Headers],[Nome]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseCorretoras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
' bancos
    ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseInstitui|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseInstitui|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabDatabaseInstitui|fffd||fffd|es[[#Headers],[Nome]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseInstitui|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
' lojas de c|fffd|mbio
    ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseLojas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseLojas").Sort. _
        SortFields.Add Key:=Range("tabDatabaseLojas[[#Headers],[Nome]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseInst").ListObjects("tabDatabaseLojas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' finaliza|fffd||fffd|o
    Sheets("databaseInst").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub


Attribute VB_Name = "M_DatabaseOpTesouro"
Sub databaseTesouroClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE T|fffd|TULOS
' classifica|fffd||fffd|o crescente por nome
    Sheets("databaseWebTesouro").Unprotect
    
' t|fffd|tulos para compra
    ActiveWorkbook.Worksheets("databaseWebTesouro").ListObjects("tabDatabaseWebTesouroCompra").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseWebTesouro").ListObjects("tabDatabaseWebTesouroCompra").Sort. _
        SortFields.Add Key:=Range("tabDatabaseWebTesouroCompra[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseWebTesouro").ListObjects("tabDatabaseWebTesouroCompra").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
' t|fffd|tulos para venda
    ActiveWorkbook.Worksheets("databaseWebTesouro").ListObjects("tabDatabaseWebTesouroVenda").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("databaseWebTesouro").ListObjects("tabDatabaseWebTesouroVenda").Sort. _
        SortFields.Add Key:=Range("tabDatabaseWebTesouroVenda[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("databaseWebTesouro").ListObjects("tabDatabaseWebTesouroVenda").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
End Sub

Attribute VB_Name = "M_ETFsCarteira"
Sub etfsCarteira()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSAR RI DE ETFS EM CARTEIRA
' vari|fffd|veis
    On Error GoTo errorHandler
    linkSite = Range("F16")
    
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("etfsCarteira").Cells(18, 3) = "" Then
        Sheets("etfsCarteira").Unprotect
        Range("F3") = 0
        Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida|fffd||fffd|o de RI |fffd|nico
    If Range("F16") = "" Then
        Call etfsCarteiraAtualizarCotacoes
        Exit Sub
        Else
        
        ActiveWorkbook.FollowHyperlink Address:=linkSite
        Sheets("etfsCarteira").Unprotect
        Range("E16") = "#C|fffd|digo"
        Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
' valida|fffd||fffd|o de status do fechamento mensal e da carteira
        If Range("N16") = "ACESSAR SITES" Then
            Call etfsCarteiraAcessarSite
            Exit Sub
            Else
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse site est|fffd| indispon|fffd|vel.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Range("E16") = "#C|fffd|digo"
    Exit Sub
    
End Sub
Sub etfsCarteiraAtualizarCotacoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA ETFS REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida quantidade de ativos em carteira
    If Sheets("etfsCarteira").Cells(18, 3) <> "" Then
        
' array e defini|fffd||fffd|es HTML
        Dim ws As Worksheet
        Dim XMLPage As New MSXML2.XMLHTTP60
        Dim HTML As New MSHTML.HTMLDocument
        Dim dadosReferencia() As String
        Dim elemento As MSHTML.IHTMLElement
        Dim conjElementos As MSHTML.IHTMLElementCollection
        
' vari|fffd|veis
        Set wsTemp = Sheets("etfsCarteira")
        tempCell = 18
        tempAtivo = wsTemp.Cells(tempCell, 3)
        
        Set ws = Sheets("databaseWebETFs")
        contLinha = 6
        codigoAtivo = ws.Cells(contLinha, 4)
        ws.Unprotect
        
        tempoInicial = TimeValue(Now)
        contDB = Range("tabETFsCarteira").Rows.Count
        contUnit = 1
        
' loop para sincronizar ativo da carteira com a base de dados
        Do Until tempAtivo = ""
        If tempAtivo & ".SA" = codigoAtivo Or tempAtivo & ".SO" = codigoAtivo Then
        
' acessa site
            XMLPage.Open "GET", "https://www.reuters.com/finance/stocks/overview/" & codigoAtivo, False
            XMLPage.Send
            
' localiza dados no site e formata dados obtidos
            HTML.body.innerHTML = XMLPage.ResponseText
            Set conjElementos = HTML.getElementsByClassName("moduleBody")
            On Error Resume Next
            
            For Each elemento In conjElementos
                If elemento.className = "moduleBody" Then
                    elemento.innerText = Replace(elemento.innerText, " on Sao Paulo Stock Exchange ", "")
                    elemento.innerText = Replace(elemento.innerText, " ", "")
                    elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
                    elemento.innerText = Replace(elemento.innerText, "BRL", "")
                    elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
                    elemento.innerText = Replace(elemento.innerText, ";;", ";")
                    elemento.innerText = Replace(elemento.innerText, "+", "")
                    elemento.innerText = Replace(elemento.innerText, "--", "0,00")
                    elemento.innerText = Replace(elemento.innerText, ",", "x")
                    elemento.innerText = Replace(elemento.innerText, ".", ",")
                    elemento.innerText = Replace(elemento.innerText, "x", ".")
                    elemento.innerText = Replace(elemento.innerText, "(", ";")
                    elemento.innerText = Replace(elemento.innerText, ")", "")
                    
' preenche dados na tabela
                    dadosReferencia = Split(elemento.innerText, ";")
                    ws.Cells(contLinha, 7) = "R$" & dadosReferencia(1)
                    ws.Cells(contLinha, 8) = dadosReferencia(6)
                    ws.Cells(contLinha, 9) = dadosReferencia(5)
                    ws.Cells(contLinha, 10) = dadosReferencia(22)
                    ws.Cells(contLinha, 11) = dadosReferencia(20)
                    Exit For
                    
                End If
            Next
            
' incrementa vari|fffd|veis
            contUnit = contUnit + 1
            
            tempCell = tempCell + 1
            tempAtivo = wsTemp.Cells(tempCell, 3)
            
            contLinha = contLinha + 1
            codigoAtivo = ws.Cells(contLinha, 4)
            
' atualiza status de atualiza|fffd||fffd|o
            If Round((contUnit / contDB * 100), 2) <= 100 Then
                Application.StatusBar = "     Atualizando ETFs... " & Round((contUnit / contDB * 100), 2) & "%"
                Else
                Application.StatusBar = "     Atualizando ETFs... 100%"
                
            End If
            
            Else
            contLinha = contLinha + 1
            codigoAtivo = ws.Cells(contLinha, 4)
        
        End If
        Loop
        
' finaliza navegador e atualiza|fffd||fffd|es
        Application.StatusBar = "     ETFs atualizados com sucesso!"
        Application.StatusBar = ""
        
        tempoFinal = TimeValue(Now)
        tempoTotal = tempoFinal - tempoInicial
        ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
' define logotipo
        codigoAtivo = UCase(Sheets("etfsCarteira").Range("H4"))
        logoETF = ThisWorkbook.Path & "\imagery\etfs\" & codigoAtivo & ".jpg"
        Sheets("etfsCarteira").logoField.Picture = LoadPicture(logoETF)
        
        MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        Dim validaCarteira As VbMsgBoxResult
        validaCarteira = MsgBox("Ops! Parece que voc|fffd| ainda n|fffd|o possui ETFs em sua carteira. Deseja realizar a atualiza|fffd||fffd|o geral das cota|fffd||fffd|es?", _
        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If validaCarteira = vbNo Then
            Exit Sub
            Else
            Call databaseETFs
            MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
errorHandler:
    Exit Sub
    MsgBox "Houve um erro inesperado durante a atualiza|fffd||fffd|o. Entre em contato com o administrador do sistema", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub etfsCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  CARTEIRA
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        If tipoOperacao <> "" Then
            Exit Sub
            Else
            codigoAtivo = UCase(Sheets("etfsCarteira").Range("H4"))
            
        End If
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoETF = ThisWorkbook.Path & "\imagery\etfs\" & codigoAtivo & ".jpg"
        Sheets("etfsCarteira").logoField.Picture = LoadPicture(logoETF)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoETF = ThisWorkbook.Path & "\imagery\etfs\_none.jpg"
        Sheets("etfsCarteira").logoField.Picture = LoadPicture(logoETF)
    
    End If
    
End Sub
Sub etfsComprasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO COMPRAS
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        codigoAtivo = UCase(Range("F6"))
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoETF = ThisWorkbook.Path & "\imagery\etfs\" & codigoAtivo & ".jpg"
        Sheets("etfsCompras").logoField.Picture = LoadPicture(logoETF)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoETF = ThisWorkbook.Path & "\imagery\etfs\_none.jpg"
        Sheets("etfsCompras").logoField.Picture = LoadPicture(logoETF)
    
    End If
    
End Sub
Sub etfsVendasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO VENDAS
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        codigoAtivo = UCase(Range("F6"))
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoETF = ThisWorkbook.Path & "\imagery\etfs\" & codigoAtivo & ".jpg"
        Sheets("etfsVendas").logoField.Picture = LoadPicture(logoETF)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoETF = ThisWorkbook.Path & "\imagery\etfs\_none.jpg"
        Sheets("etfsVendas").logoField.Picture = LoadPicture(logoETF)
    
    End If
    
End Sub
Sub etfsCarteiraAcessarSite()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACOMPANHAMENTO MENSAL DOS ETFS EM CARTEIRA
' vari|fffd|veis
    contLinha = 18
    contErros = 0
    contUnit = 0
    
' loop para abertura de todos os sites
    Do Until Sheets("etfsCarteira").Cells(contLinha, 3) = ""
    linkSite = Cells(contLinha, 16)
    
    If linkSite = "0" Or linkSite = "" Then
        Application.Wait Now + TimeValue("00:00:02")
        contErros = contErros + 1
        contUnit = contUnit + 1
        contLinha = contLinha + 1
        
' abre todas as p|fffd|ginas dos ativos em carteira
        Else
        ActiveWorkbook.FollowHyperlink Address:=linkSite
        Application.Wait Now + TimeValue("00:00:02")
        contUnit = contUnit + 1
        contLinha = contLinha + 1
        
    End If
    Loop
    
' finaliza|fffd||fffd|o
    If contErros = 0 Then
        MsgBox "Abertura de sites finalizada com sucesso. (" & contUnit & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
        Else
        MsgBox "Abertura de sites finalizada com " & contErros & " erros. (" & contUnit & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub etfsCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa gr|fffd|fico volum|fffd|trico
    If Range("C15") = "Anal|fffd|tico" Then
        Sheets("etfsCarteira").Unprotect
        ActiveSheet.Shapes.Range(Array("grfETFsVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfETFsAnal|fffd|tico")).Visible = False
        Sheets("etfsCarteira").Cells(15, 3) = "Volum|fffd|trico"
        Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' ativa gr|fffd|fico anal|fffd|tico
        If Range("C15") = "Volum|fffd|trico" Then
            Sheets("etfsCarteira").Unprotect
            ActiveSheet.Shapes.Range(Array("grfETFsVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfETFsAnal|fffd|tico")).Visible = True
            Sheets("etfsCarteira").Cells(15, 3) = "Anal|fffd|tico"
            Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub etfsCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("etfsCarteira").Unprotect
    Sheets("etfsCarteira").ChartObjects("grfETFsVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabETFsCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("etfsCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub etfsCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call etfsCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("etfsCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfETFsAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("etfsCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("etfsCarteira").Unprotect

                ActiveSheet.ChartObjects("grfETFsAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfETFsAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("etfsCarteira").Cells(4, 3) = "Com identificador"
                Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub etfsCarteiraRecompra()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS DESCONTADO PARA RECOMPRA
' vari|fffd|veis
    codigoAtivo = UCase(Range("H4"))

' valida c|fffd|digo para recompra
    If codigoAtivo = "" Or codigoAtivo = "#C|fffd|DIGO" Or codigoAtivo = "#SELECIONAR" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de compra
        Sheets("etfsCompras").Select
        Sheets("etfsCompras").Cells(6, 6) = codigoAtivo
        
    End If
    
End Sub
Sub etfsLinkSite()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA EMPRESA SELECIONADA
' gerenciamento de erro
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkSite = Range("H7")
    
' valida link e acessa site RI
    If Range("H4") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkSite = "" Or linkSite = "Link indispon|fffd|vel" Or linkSite = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkSite
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel. Recomendamos que atualize sua base de dados na op|fffd||fffd|o CONFIGURA|fffd||fffd|ES > BANCO DE DADOS.", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
End Sub
Sub etfsLinkBitbolsa()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE BITBOLSA COM GR|fffd|FICO
' gerenciamento de erros
    
' vari|fffd|veis
    codigoAtivo = UCase(Range("F6"))
    
' abre p|fffd|gina do site bitbolsa com o c|fffd|digo da a|fffd||fffd|o
    If Range("H4") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
            
        If Range("H4") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="https://www.bitbolsa.com.br/charts/index.aspx?symbols=" & codigoAtivo & "#"
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub

Attribute VB_Name = "M_ETFsCompras"
Sub etfsComprasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE COMPRA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("etfsCompras").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    fundo = Range("H4")
    qtde = Range("E14")
    puCompra = Range("E15")
    valorCompra = Range("E18")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H17")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    data = Range("E12")
    codigoFundo = UCase(Range("F6"))
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = "Bovespa (B3)"
    finalidade = "Aumento Patrimonial"
    valorBruto = puCompra * qtde
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "ETFs"
    tipoOrdem = Range("E13")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de compra j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("etfsCompras").Unprotect
        statusOperacao = "2"
        Sheets("etfsCompras").Cells(4, 14) = statusOperacao
        Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If fundo = "Selecione o ativo" Or fundo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de cotas inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If puCompra <= "0" Then
                        MsgBox "Pre|fffd|o unit|fffd|rio da cota inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E15").Activate
                        Exit Sub
                        Else
                        
                        If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                            MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM PENDENTE
' valida direcionamento da ordem para lista de pend|fffd|ncias
                                    If valorCompra <= 0 Then
                                    
                                        Dim validaPendencia As VbMsgBoxResult
                                        validaPendencia = MsgBox("O valor total da ordem est|fffd| vazio." & vbNewLine & "Deseja mant|fffd|-la pendente de liquida|fffd||fffd|o?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPendencia = vbNo Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
                                            
' localiza linha vazia na tabela de opera|fffd||fffd|es pendentes e registra dados
                                            Sheets("carteiraOp").Unprotect
                                            Sheets("etfsCompras").Unprotect
                                            
' loop para localizar linha vazia
                                            If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                contLinha = 5
                                                Else
                                                contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
                                            Sheets("carteiraOp").Cells(contLinha, 3) = data
                                            Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                            Sheets("carteiraOp").Cells(contLinha, 7) = codigoFundo
                                            Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                            Sheets("carteiraOp").Cells(contLinha, 10) = puCompra
                                            Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                            Sheets("carteiraOp").Cells(contLinha, 13) = corretora
                                            
' reestabelece formato das colunas
                                            Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                            Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraOpClassificar
                                            
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                            statusOperacao = "3"
                                            Sheets("etfsCompras").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
' a opera|fffd||fffd|o pendente n|fffd|o ser|fffd| registrada em caixa devido ao valor da opera|fffd||fffd|o estar zerado
                                            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("etfsCompras").Activate
                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Range("F5").Select
                                            Call planAutoSave
                                            MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                        
                                        End If
                                        Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM SEM PEND|fffd|NCIA
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                        Dim confirmaCompra As VbMsgBoxResult
                                        confirmaCompra = MsgBox("Deseja confirmar a compra de " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If confirmaCompra = vbNo Then
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** REGISTRA COMPRA NA TABELA
' desbloqueia planilhas em uso
                                            Sheets("etfsCarteira").Unprotect
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("etfsCompras").Unprotect
                                            
' loop para localizar linha vazia
                                            If Sheets("etfsCompras").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("etfsCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra dados na tabela
                                            Sheets("etfsCompras").Cells(contLinha, 3) = data
                                            Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo
                                            Sheets("etfsCompras").Cells(contLinha, 7) = qtde
                                            Sheets("etfsCompras").Cells(contLinha, 8) = puCompra
                                            Sheets("etfsCompras").Cells(contLinha, 11) = valorCompra
                                            Sheets("etfsCompras").Cells(contLinha, 14) = corretora
                                            
' reestabelece formato da coluna e classifica
                                            Range("tabETFsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call etfsComprasClassificar
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE ETFS - RECOMPRA
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                            contLinha = 18
                                            Do Until Sheets("etfsCarteira").Cells(contLinha, 3) = "" Or Sheets("etfsCarteira").Cells(contLinha, 3) = codigoFundo
                                            contLinha = contLinha + 1
                                            Loop
                                            
' verifica|fffd||fffd|o de nova compra e recompra
                                            If Sheets("etfsCarteira").Cells(contLinha, 3) = codigoFundo Then
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RECOMPRA EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
                                                
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                                statusOperacao = "1"
                                                Sheets("etfsCompras").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("etfsCompras").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Recompra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                                Else

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE ETFS - NOVA COMPRA
' registro de nova compra na carteira de a|fffd||fffd|es
                                                If Sheets("etfsCarteira").Cells(contLinha, 3) <> codigoFundo Then
                                                    Do Until Sheets("etfsCarteira").Cells(contLinha, 3) = ""
                                                    contLinha = contLinha + 1
                                                    Loop
                                                    
                                                    Sheets("etfsCarteira").Cells(contLinha, 3) = codigoFundo
                                                    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                    If Sheets("etfsCarteira").Cells(18, 3) <> "" And Sheets("etfsCarteira").Cells(19, 3) = "" Then
                                                        Call etfsCarteiraAjustarGrafico
                                                        Else
                                                        
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA COMPRA EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                                    statusOperacao = "1"
                                                    Sheets("etfsCompras").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsCompras").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Nova compra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
  
End Sub
Sub etfsComprasLimpar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE COMPRA
' reseta valores dos campos
    Sheets("etfsCompras").Cells(14, 5) = "0"
    Sheets("etfsCompras").Cells(15, 5) = "0"
    Sheets("etfsCompras").Cells(18, 5) = "0"
    
End Sub
Sub etfsComprasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("etfsCompras").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
    ' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("etfsCompras").Cells(5, 6) = "#Selecionar"
            Sheets("etfsCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("etfsCompras").Cells(14, 5) = "0"
            Sheets("etfsCompras").Cells(15, 5) = "0"
            Sheets("etfsCompras").Cells(18, 5) = "0"
            Sheets("etfsCompras").Cells(4, 14) = "0"
    
            Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("etfsCompras").Cells(5, 6) = "#Selecionar"
            Sheets("etfsCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("etfsCompras").Cells(14, 5) = "0"
            Sheets("etfsCompras").Cells(15, 5) = "0"
            Sheets("etfsCompras").Cells(18, 5) = "0"
            Sheets("etfsCompras").Cells(4, 14) = "0"
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

        End If
    End If
    
End Sub
Sub etfsComprasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoFundo = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoFundo = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("etfsCompras").Unprotect
                Range("tabETFsCompras[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabETFsCompras").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("etfsCompras").Cells(contLinha, 3) = "" Or Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("etfsCompras").Unprotect
                    Range("tabETFsCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabETFsCompras").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("etfsCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma compra realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("etfsCompras").Cells(contLinha, 3) = "" Or Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("etfsCompras").Unprotect
                    Range("tabETFsCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabETFsCompras").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("etfsCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma compra realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If

End Sub
Sub etfsComprasLimparFiltro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("etfsCompras").Unprotect
        Range("tabETFsCompras[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabETFsCompras").Range.AutoFilter Field:=1
        
        Sheets("etfsCompras").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
    End If
    
End Sub
Sub etfsComprasClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("etfsCompras").ListObjects("tabETFsCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("etfsCompras").ListObjects("tabETFsCompras").Sort. _
        SortFields.Add Key:=Range("tabETFsCompras[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("etfsCompras").ListObjects("tabETFsCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("etfsCompras").ListObjects("tabETFsCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("etfsCompras").ListObjects("tabETFsCompras").Sort. _
        SortFields.Add Key:=Range("tabETFsCompras[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("etfsCompras").ListObjects("tabETFsCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_ETFsVendas"
Sub etfsVendasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE VENDA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("etfsVendas").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    fundo = Range("H4")
    qtde = Range("E14")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de venda
    data = Range("E12")
    codigoFundo = UCase(Range("F6"))
    pmCompra = Range("H13")

' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Venda de Ativos"
    origem = "Bovespa (B3)"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde

' vari|fffd|veis para ordens pendentes
    tipoInvest = "ETFs"
    tipoOrdem = Range("E13")

    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de venda j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("etfsVendas").Unprotect
        statusOperacao = "2"
        Sheets("etfsVendas").Cells(4, 14) = statusOperacao
        Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If fundo = "Selecione o ativo" Or fundo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de cotas inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de cotas indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                    
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio da cota inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM PENDENTE
' valida direcionamento da ordem para lista de pend|fffd|ncias
                                    If valorVenda <= 0 Then
                                    
                                        Dim validaPendencia As VbMsgBoxResult
                                        validaPendencia = MsgBox("O valor total da ordem est|fffd| vazio." & vbNewLine & "Deseja mant|fffd|-la pendente de liquida|fffd||fffd|o?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPendencia = vbNo Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
    
'*************************************************************************************************************************** GERENCIAMENTO DE PEND|fffd|NCIA DE VENDA SEM PREJU|fffd|ZO
' valida direcionamento da ordem para lista de pend|fffd|ncias e alerta de preju|fffd|zo em ordem pendnte de liquida|fffd||fffd|o
                                            If alertaPrejuizo >= "0" Then
    
' desbloqueia planilhas em uso
                                                Sheets("carteiraOp").Unprotect
                                                Sheets("etfsVendas").Unprotect
                                                
' loop para localizar linha vazia
                                                If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                    contLinha = 5
                                                    Else
                                                    contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("carteiraOp").Cells(contLinha, 3) = data
                                                Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                                Sheets("carteiraOp").Cells(contLinha, 7) = codigoFundo
                                                Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                                Sheets("carteiraOp").Cells(contLinha, 10) = puVenda
                                                Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                                Sheets("carteiraOp").Cells(contLinha, 13) = ghostCell & corretora
                                                
' reestabelece formato das colunas
                                                Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                                Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraOpClassificar
                                            
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                                statusOperacao = "3"
                                                Sheets("etfsVendas").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("etfsVendas").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
    
'*************************************************************************************************************************** GERENCIAMENTO DE PEND|fffd|NCIA DE VENDA COM PREJU|fffd|ZO
' valida direcionamento da ordem para lista de pend|fffd|ncias e alerta de preju|fffd|zo em ordem pendnte de liquida|fffd||fffd|o
                                                Else
    
' alerta de registro da pend|fffd|ncia de venda com preju|fffd|zo
                                                Dim validaPrejuizo As VbMsgBoxResult
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
    
' desbloqueia planilhas em uso
                                                    Sheets("carteiraOp").Unprotect
                                                    Sheets("etfsVendas").Unprotect
        
' loop para localizar linha vazia
                                                    If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                        contLinha = 5
                                                        Else
                                                        contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                
                                                    Sheets("carteiraOp").Cells(contLinha, 3) = data
                                                    Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                                    Sheets("carteiraOp").Cells(contLinha, 7) = codigoFundo
                                                    Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                                    Sheets("carteiraOp").Cells(contLinha, 10) = puVenda
                                                    Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                                    Sheets("carteiraOp").Cells(contLinha, 13) = ghostCell & corretora
                                            
' reestabelece formato das colunas
                                                    Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                                    Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraOpClassificar
                                                    
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                                    statusOperacao = "3"
                                                    Sheets("etfsVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
    
                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM SEM PEND|fffd|NCIA
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para venda
                                        Dim confirmaVenda As VbMsgBoxResult
                                        confirmaVenda = MsgBox("Deseja confirmar a venda de " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                        If confirmaVenda = vbNo Then
                                            Exit Sub
                                            Else
            
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA SEM PREJU|fffd|ZO
' alerta de venda sem preju|fffd|zo
                                            If alertaPrejuizo >= "0" Then
        
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("etfsCarteira").Unprotect
                                                Sheets("etfsVendas").Unprotect
        
' loop para localizar linha vazia
                                                If Sheets("etfVendas").Cells(25, 3) = "" Then
                                                    contLinha = 25
                                                    Else
                                                    contLinha = Sheets("etfsVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra dados na tabela
                                                Sheets("etfsVendas").Cells(contLinha, 3) = data
                                                Sheets("etfsVendas").Cells(contLinha, 4) = codigoFundo
                                                Sheets("etfsVendas").Cells(contLinha, 8) = puVenda
                                                Sheets("etfsVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("etfsVendas").Cells(contLinha, 7) = qtde
                                                Sheets("etfsVendas").Cells(contLinha, 11) = valorVenda
                                                Sheets("etfsVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabETFsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call etfsVendasClassificar
                                                
' ajusta ghostcell
                                                Call ajustaGhostCell
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE A|fffd||fffd|ES EM VENDA PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                contLinha = 18
                                                Do Until Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) = 0
                                                contLinha = contLinha + 1
                                                Loop
        
                                                If Sheets("etfsCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("etfsVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                    Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE A|fffd||fffd|ES EM VENDA TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("etfsVendas").Unprotect
                                                    Sheets("etfsCompras").Unprotect
                                                    Sheets("etfsCarteira").Unprotect
                                                    
' localiza linha com status "vendido" na carteira
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                                    
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    If Sheets("etfsCarteira").Cells(contLinha, 3) = codigoFundo And Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                        Sheets("etfsCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                    
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DA A|fffd||fffd|O VENDIDA
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("etfsCompras").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo Then
                                                        Sheets("etfsCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("etfsVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("etfsVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
    
                                                End If
                                                Else
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de venda com preju|fffd|zo
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
                                            
'*************************************************************************************************************************** REGISTRA VENDA NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("etfsVendas").Unprotect
                                                    Sheets("etfsCarteira").Unprotect
        
' loop para localizar linha vazia
                                                    If Sheets("etfsVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("etfsVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("etfsVendas").Cells(contLinha, 3) = data
                                                    Sheets("etfsVendas").Cells(contLinha, 4) = codigoFundo
                                                    Sheets("etfsVendas").Cells(contLinha, 8) = puVenda
                                                    Sheets("etfsVendas").Cells(contLinha, 9) = pmCompra
                                                    Sheets("etfsVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("etfsVendas").Cells(contLinha, 11) = valorVenda
                                                    Sheets("etfsVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabETFsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call etfsVendasClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE A|fffd||fffd|ES EM VENDA PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
            
                                                    If Sheets("etfsCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza status da opera|fffd||fffd|o na tabela de venda
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                        
                                                        statusOperacao = "1"
                                                        Sheets("etfsVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("etfsVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE A|fffd||fffd|ES - VENDA TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("etfsVendas").Unprotect
                                                        Sheets("etfsCompras").Unprotect
                                                        Sheets("etfsCarteira").Unprotect
                                                        
' localiza linha com status "vendido" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("etfsCarteira").Cells(contLinha, 6) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                        If Sheets("etfsCarteira").Cells(contLinha, 3) = codigoFundo And Sheets("etfsCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                            Sheets("etfsCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DA A|fffd||fffd|O VENDIDA
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("etfsCompras").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("etfsCompras").Cells(contLinha, 4) = codigoFundo Then
                                                            Sheets("etfsCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                        statusOperacao = "1"
                                                        Sheets("etfsVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("etfsCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("etfsCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("etfsVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                            
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub etfsVendasLimpar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE VENDA
' reseta valores dos campos
    Sheets("etfsVendas").Cells(14, 5) = "0"
    Sheets("etfsVendas").Cells(15, 5) = "0"
    Sheets("etfsVendas").Cells(18, 5) = "0"
    
End Sub
Sub etfsVendasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("etfsVendas").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("etfsVendas").Cells(5, 6) = "#Selecionar"
            Sheets("etfsVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("etfsVendas").Cells(14, 5) = "0"
            Sheets("etfsVendas").Cells(15, 5) = "0"
            Sheets("etfsVendas").Cells(18, 5) = "0"
            Sheets("etfsVendas").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("etfsVendas").Cells(5, 6) = "#Selecionar"
            Sheets("etfsVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("etfsVendas").Cells(14, 5) = "0"
            Sheets("etfsVendas").Cells(15, 5) = "0"
            Sheets("etfsVendas").Cells(18, 5) = "0"
            Sheets("etfsVendas").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

        End If
    End If
End Sub
Sub etfsLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("etfsVendas").Cells(23, 3) = "" Then
        MsgBox "Nenhuma venda total registrada at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de vendas totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("etfsVendas").Unprotect
            
            Do Until Sheets("etfsVendas").Cells(contLinha, 3) = ""
            If Sheets("etfsVendas").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("etfsVendas").Activate
                Sheets("etfsVendas").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de vendas removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub etfsVendasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA VENDAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoFundo = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoFundo = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("etfsVendas").Unprotect
                Range("tabETFsVendas[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabETFsVendas").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("etfsVendas").Cells(contLinha, 3) = "" Or Sheets("etfsVendas").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("etfsVendas").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("etfsVendas").Unprotect
                    Range("tabETFsVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabETFsVendas").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("etfsVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma venda realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("etfsVendas").Cells(contLinha, 3) = "" Or Sheets("etfsVendas").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("etfsVendas").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("etfsVendas").Unprotect
                    Range("tabETFsVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabETFsVendas").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                
                    Sheets("etfsVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma venda realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub etfsVendasLimparFiltro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE VENDAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("etfsVendas").Unprotect
        Range("tabETFsVendas[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabETFsVendas").Range.AutoFilter Field:=1
        
        Sheets("etfsVendas").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("etfsVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If
    
End Sub
Sub etfsVendasClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("etfsVendas").ListObjects("tabETFsVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("etfsVendas").ListObjects("tabETFsVendas").Sort. _
        SortFields.Add Key:=Range("tabETFsVendas[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("etfsVendas").ListObjects("tabETFsVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("etfsVendas").ListObjects("tabETFsVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("etfsVendas").ListObjects("tabETFsVendas").Sort. _
        SortFields.Add Key:=Range("tabETFsVendas[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("etfsVendas").ListObjects("tabETFsVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_FIIsCarteira"
Sub fiisCarteira()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSAR CENTRAL DE NOT|fffd|CIAS DOS FIIS EM CARTEIRA
' vari|fffd|veis
    On Error GoTo errorHandler
    codigoFundo = Range("E16")
    
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("fiisCarteira").Cells(18, 3) = "" Then
        Sheets("fiisCarteira").Unprotect
        Range("F3") = 0
        Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida|fffd||fffd|o de site |fffd|nico
    If codigoFundo = "#C|fffd|digo" And Range("N16") <> "ACESSAR NOT|fffd|CIAS" Then
        Call fiisCarteiraAtualizarCotacoes
        Exit Sub
        Else
        
        If codigoFundo <> "#C|fffd|digo" And Range("N16") <> "ACESSAR NOT|fffd|CIAS" Then
            ActiveWorkbook.FollowHyperlink Address:="http://fiis.com.br/" & codigoFundo
            Range("E16") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida|fffd||fffd|o de status do fechamento mensal e da carteira
            If Range("N16") = "ACESSAR NOT|fffd|CIAS" Then
                Call fiisCarteiraAcessarNoticias
                Exit Sub
                Else
                
            End If
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse site est|fffd| indispon|fffd|vel.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Range("E16") = "#C|fffd|digo"
    Exit Sub
    
End Sub
Sub fiisCarteiraAtualizarCotacoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA FIIS REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida quantidade de ativos em carteira
    If Sheets("fiisCarteira").Cells(18, 3) <> "" Then
        
' array e defini|fffd||fffd|es HTML
        Dim ws As Worksheet
        Dim XMLPage As New MSXML2.XMLHTTP60
        Dim HTML As New MSHTML.HTMLDocument
        Dim dadosReferencia() As String
        Dim elemento As MSHTML.IHTMLElement
        Dim conjElementos As MSHTML.IHTMLElementCollection
        
' vari|fffd|veis
        Set wsTemp = Sheets("fiisCarteira")
        tempCell = 18
        tempAtivo = wsTemp.Cells(tempCell, 3)
        
        Set ws = Sheets("databaseWebFIIs")
        contLinha = 6
        codigoAtivo = ws.Cells(contLinha, 4)
        ws.Unprotect
        
        tempoInicial = TimeValue(Now)
        contDB = Range("tabFIIsCarteira").Rows.Count
        contUnit = 1
        
' loop para sincronizar ativo da carteira com a base de dados
        Do Until tempAtivo = ""
        If tempAtivo & ".SA" = codigoAtivo Or tempAtivo & ".SO" = codigoAtivo Then
        
' acessa site
            XMLPage.Open "GET", "https://www.reuters.com/finance/stocks/overview/" & codigoAtivo, False
            XMLPage.Send
            
' localiza dados no site e formata dados obtidos
            HTML.body.innerHTML = XMLPage.ResponseText
            Set conjElementos = HTML.getElementsByClassName("moduleBody")
            On Error Resume Next
            
            For Each elemento In conjElementos
                If elemento.className = "moduleBody" Then
                    elemento.innerText = Replace(elemento.innerText, " on Sao Paulo Stock Exchange ", "")
                    elemento.innerText = Replace(elemento.innerText, " ", "")
                    elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
                    elemento.innerText = Replace(elemento.innerText, "BRL", "")
                    elemento.innerText = Replace(elemento.innerText, "R$-", "-R$")
                    elemento.innerText = Replace(elemento.innerText, ";;", ";")
                    elemento.innerText = Replace(elemento.innerText, "+", "")
                    elemento.innerText = Replace(elemento.innerText, "--", "0,00")
                    elemento.innerText = Replace(elemento.innerText, ",", "x")
                    elemento.innerText = Replace(elemento.innerText, ".", ",")
                    elemento.innerText = Replace(elemento.innerText, "x", ".")
                    elemento.innerText = Replace(elemento.innerText, "(", ";")
                    elemento.innerText = Replace(elemento.innerText, ")", "")
                    
' preenche dados na tabela
                    dadosReferencia = Split(elemento.innerText, ";")
                    ws.Cells(contLinha, 7) = "R$" & dadosReferencia(1)
                    ws.Cells(contLinha, 8) = dadosReferencia(6)
                    ws.Cells(contLinha, 9) = dadosReferencia(5)
                    ws.Cells(contLinha, 10) = dadosReferencia(22)
                    ws.Cells(contLinha, 11) = dadosReferencia(20)
                    Exit For
                    
                End If
            Next
        
' incrementa vari|fffd|veis
            contUnit = contUnit + 1
            
            tempCell = tempCell + 1
            tempAtivo = wsTemp.Cells(tempCell, 3)
            
            contLinha = contLinha + 1
            codigoAtivo = ws.Cells(contLinha, 4)
            
' atualiza status de atualiza|fffd||fffd|o
            If Round((contUnit / contDB * 100), 2) <= 100 Then
                Application.StatusBar = "     Atualizando FIIs... " & Round((contUnit / contDB * 100), 2) & "%"
                Else
                Application.StatusBar = "     Atualizando FIIs... 100%"
                
            End If
            
            Else
            contLinha = contLinha + 1
            codigoAtivo = ws.Cells(contLinha, 4)
        
        End If
        Loop
        
' finaliza navegador e atualiza|fffd||fffd|es
        Application.StatusBar = "     FIIs atualizados com sucesso!"
        Application.StatusBar = ""
        
        tempoFinal = TimeValue(Now)
        tempoTotal = tempoFinal - tempoInicial
        ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
' define logotipo
        codigoAtivo = UCase(Sheets("fiisCarteira").Range("H4"))
        logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
        Sheets("fiisCarteira").logoField.Picture = LoadPicture(logoFII)
        
        MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        Dim validaCarteira As VbMsgBoxResult
        validaCarteira = MsgBox("Ops! Parece que voc|fffd| ainda n|fffd|o possui FIIs em sua carteira. Deseja realizar a atualiza|fffd||fffd|o geral das cota|fffd||fffd|es?", _
        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If validaCarteira = vbNo Then
            Exit Sub
            Else
            
            Call databaseFIIs
            MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
errorHandler:
    Exit Sub
    MsgBox "Houve um erro inesperado durante a atualiza|fffd||fffd|o. Entre em contato com o administrador do sistema", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub fiisCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO CARTEIRA
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        If tipoOperacao <> "" Then
            Exit Sub
            Else
            codigoAtivo = UCase(Sheets("fiisCarteira").Range("H4"))
            
        End If
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
        Sheets("fiisCarteira").logoField.Picture = LoadPicture(logoFII)
        Exit Sub
    
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoFII = ThisWorkbook.Path & "\imagery\fiis\_none.jpg"
        Sheets("fiisCarteira").logoField.Picture = LoadPicture(logoFII)
    
    End If
    
End Sub
Sub fiisComprasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO COMPRAS
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        codigoAtivo = UCase(Sheets("fiisCompras").Range("F6"))
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
        Sheets("fiisCompras").logoField.Picture = LoadPicture(logoFII)
        Exit Sub
    
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoFII = ThisWorkbook.Path & "\imagery\fiis\_none.jpg"
        Sheets("fiisCompras").logoField.Picture = LoadPicture(logoFII)
    
    End If
    
End Sub
Sub fiisVendasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO VENDAS
' pula mudan|fffd|a de logo em caso de ordem pendente
    If ActiveSheet.Name = "carteiraOp" Or ActiveSheet.Name <> "carteiraOp" And Sheets("carteiraOp").Cells(5, 3) <> "" _
    And Sheets("carteiraOp").Cells(5, 14) <> "EM LIQUIDA|fffd||fffd|O" Then
        Exit Sub
        Else
        
' vari|fffd|veis
        codigoAtivo = UCase(Range("F6"))
        
' gerenciamento de erros
        On Error GoTo errorHandler
        
' define logotipo
        logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
        Sheets("fiisVendas").logoField.Picture = LoadPicture(logoFII)
        Exit Sub
        
    End If
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoFII = ThisWorkbook.Path & "\imagery\fiis\_none.jpg"
        Sheets("fiisVendas").logoField.Picture = LoadPicture(logoFII)
    
    End If
    
End Sub
Sub fiisRendimentosLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO PROVENTOS
' vari|fffd|veis
    codigoAtivo = UCase(Range("N19"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
    Sheets("fiisRendimentos").logoField.Picture = LoadPicture(logoFII)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoFII = ThisWorkbook.Path & "\imagery\fiis\_none.jpg"
        Sheets("fiisRendimentos").logoField.Picture = LoadPicture(logoFII)
    
    End If
    
End Sub
Sub fiisCarteiraAcessarNoticias()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACOMPANHAMENTO MENSAL DAS A|fffd||fffd|ES EM CARTEIRA
' vari|fffd|veis
    contLinha = 18
    contErros = 0
    contUnit = 0
    
' loop para abertura de todos os sites de not|fffd|cias
    Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = ""
    linkFII = Cells(contLinha, 16)
    
    If linkFII = "0" Or linkFII = "" Then
        Application.Wait Now + TimeValue("00:00:02")
        contErros = contErros + 1
        contUnit = contUnit + 1
        contLinha = contLinha + 1
        
' abre todas as p|fffd|ginas de not|fffd|cias dos ativos em carteira
        Else
        ActiveWorkbook.FollowHyperlink Address:=linkFII
        Application.Wait Now + TimeValue("00:00:02")
        contUnit = contUnit + 1
        contLinha = contLinha + 1
        
    End If
    Loop
    
' finaliza|fffd||fffd|o
    If contErros = 0 Then
        MsgBox "Abertura de not|fffd|cias finalizada com sucesso. (" & contUnit & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        MsgBox "Abertura de not|fffd|cias finalizada com " & contErros & " erros. (" & contUnit & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
End Sub
Sub fiisCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        Sheets("fiisCarteira").Unprotect
        ActiveSheet.Shapes.Range(Array("grfFIIsVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfFIIsAnal|fffd|tico")).Visible = False
        Sheets("fiisCarteira").Cells(15, 3) = "Volum|fffd|trico"
        Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
    
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            Sheets("fiisCarteira").Unprotect
            ActiveSheet.Shapes.Range(Array("grfFIIsVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfFIIsAnal|fffd|tico")).Visible = True
            Sheets("fiisCarteira").Cells(15, 3) = "Anal|fffd|tico"
            Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub fiisCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("fiisCarteira").Unprotect
    Sheets("fiisCarteira").ChartObjects("grfFIIsVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabFIIsCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("fiisCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub fiisCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call fiisCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("fiisCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfFIIsAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("fiisCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("fiisCarteira").Unprotect

                ActiveSheet.ChartObjects("grfFIIsAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfFIIsAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("fiisCarteira").Cells(4, 3) = "Com identificador"
                Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub fiisCarteiraRecompra()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS DESCONTADO PARA RECOMPRA
' vari|fffd|veis
    codigoFundo = UCase(Range("H4"))

' valida c|fffd|digo para recompra
    If codigoFundo = "" Or codigoFundo = "#C|fffd|DIGO" Or codigoFundo = "#SELECIONAR" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de compra
        Sheets("fiisCompras").Select
        Sheets("fiisCompras").Cells(6, 6) = codigoFundo

    End If
    
End Sub
Sub fiisLinkSite()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LINK FIIS / GERAL
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    codigoFundo = UCase(Range("F6"))
    
' acessa p|fffd|gina do site fiis para detalhamento do fundo
    If Range("H4") = "Selecione o fundo" Then
        MsgBox "Nenhum fundo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Range("H4") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O fundo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
        
            ActiveWorkbook.FollowHyperlink Address:="http://fiis.com.br/" & codigoFundo
            Exit Sub
            
        End If
    End If
        
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub fiisLinkClubeFII()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LINK CLUBE FII
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    codigoFundo = UCase(Range("F6"))
    
' acessa p|fffd|gina do site fiis para detalhamento do fundo
    If Range("H4") = "Selecione o fundo" Then
        MsgBox "Nenhum fundo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Range("H4") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O fundo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
        
            ActiveWorkbook.FollowHyperlink Address:="https://www.clubefii.com.br/fundo_imobiliario.aspx?cod=" & codigoFundo & "#informacoes_basicas"
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub fiisLinkBitbolsa()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LINK BITBOLSA COM GR|fffd|FICO
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    codigoFundo = UCase(Range("F6"))
    
' acessa p|fffd|gina do site bitbolsa para detalhamento do gr|fffd|fico
    If Range("H4") = "Selecione o fundo" Then
        MsgBox "Nenhum fundo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Range("H4") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O fundo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
        
            ActiveWorkbook.FollowHyperlink Address:="https://www.bitbolsa.com.br/charts/index.aspx?symbols=" & codigoFundo & "#"
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Attribute VB_Name = "M_FIIsCompras"
Sub fiisComprasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE COMPRA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("fiisCompras").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    fundo = Range("H4")
    qtde = Range("E14")
    puCompra = Range("E15")
    valorCompra = Range("E18")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H17")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    data = Range("E12")
    codigoFundo = UCase(Range("F6"))
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = "Bovespa (B3)"
    finalidade = "Aumento Patrimonial"
    valorBruto = puCompra * qtde
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "Fundos Imobili|fffd|rios"
    tipoOrdem = Range("E13")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de compra j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("fiisCompras").Unprotect
        statusOperacao = "2"
        Sheets("fiisCompras").Cells(4, 14) = statusOperacao
        Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If fundo = "Selecione o fundo" Or fundo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de cotas inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If puCompra <= "0" Then
                        MsgBox "Pre|fffd|o unit|fffd|rio da cota inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E15").Activate
                        Exit Sub
                        Else
                        
                        If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                            MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM PENDENTE
' valida direcionamento da ordem para lista de pend|fffd|ncias
                                    If valorCompra <= 0 Then
                                    
                                        Dim validaPendencia As VbMsgBoxResult
                                        validaPendencia = MsgBox("O valor total da ordem est|fffd| vazio." & vbNewLine & "Deseja mant|fffd|-la pendente de liquida|fffd||fffd|o?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPendencia = vbNo Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
    
' desbloqueia planilhas em uso
                                            Sheets("carteiraOp").Unprotect
                                            Sheets("fiisCompras").Unprotect
    
' loop para localizar linha vazia
                                            If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                contLinha = 5
                                                Else
                                                contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
                                            Sheets("carteiraOp").Cells(contLinha, 3) = data
                                            Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                            Sheets("carteiraOp").Cells(contLinha, 7) = codigoFundo
                                            Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                            Sheets("carteiraOp").Cells(contLinha, 10) = puCompra
                                            Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                            Sheets("carteiraOp").Cells(contLinha, 13) = corretora
                                            
' reestabelece formato das colunas
                                            Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                            Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraOpClassificar
    
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                            statusOperacao = "3"
                                            Sheets("fiisCompras").Cells(4, 14) = statusOperacao
    
' bloqueia planilhas em uso
' a opera|fffd||fffd|o pendente n|fffd|o ser|fffd| registrada em caixa devido ao valor da opera|fffd||fffd|o estar zerado
                                            Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("fiisCompras").Activate
                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Range("F5").Select
                                            Call planAutoSave
                                            MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                            
                                        End If
                                        Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM SEM PEND|fffd|NCIA
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                        Dim confirmaCompra As VbMsgBoxResult
                                        confirmaCompra = MsgBox("Deseja confirmar a compra de " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                    
                                        If confirmaCompra = vbNo Then
                                            Exit Sub
                                            Else
    
' desbloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("fiisCarteira").Unprotect
                                            Sheets("fiisCompras").Unprotect
                                    
'*************************************************************************************************************************** REGISTRA COMPRA NA TABELA
' loop para localizar linha vazia
                                            If Sheets("fiisCompras").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("fiisCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra dados na tabela
                                            Sheets("fiisCompras").Cells(contLinha, 3) = data
                                            Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo
                                            Sheets("fiisCompras").Cells(contLinha, 7) = qtde
                                            Sheets("fiisCompras").Cells(contLinha, 8) = puCompra
                                            Sheets("fiisCompras").Cells(contLinha, 11) = valorCompra
                                            Sheets("fiisCompras").Cells(contLinha, 14) = corretora
        
' reestabelece formato da coluna e classifica
                                            Range("tabFIIsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call fiisComprasClassificar
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE FIIS - RECOMPRA
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                            contLinha = 18
                                            Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = "" Or Sheets("fiisCarteira").Cells(contLinha, 3) = codigoFundo
                                            contLinha = contLinha + 1
                                            Loop
                                            
' verifica|fffd||fffd|o de nova compra e recompra
                                            If Sheets("fiisCarteira").Cells(contLinha, 3) = codigoFundo Then
            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RECOMPRA EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
    
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
    
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                                statusOperacao = "1"
                                                Sheets("fiisCompras").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fiisCompras").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Recompra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                                Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE FIIS - NOVA COMPRA
' registro de nova compra na carteira de fundos
                                                If Sheets("fiisCarteira").Cells(contLinha, 3) <> codigoFundo Then
                                                    Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = ""
                                                    contLinha = contLinha + 1
                                                    Loop
                                                    
                                                    Sheets("fiisCarteira").Cells(contLinha, 3) = codigoFundo
                                                    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                    If Sheets("fiisCarteira").Cells(18, 3) <> "" And Sheets("fiisCarteira").Cells(19, 3) = "" Then
                                                        Call fiisCarteiraAjustarGrafico
                                                        Else
                                                        
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA COMPRA EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("fiisCompras").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisCompras").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Nova compra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub fiisComprasLimpar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE COMPRA
' reseta valores dos campos
    Sheets("fiisCompras").Cells(14, 5) = "0"
    Sheets("fiisCompras").Cells(15, 5) = "0"
    Sheets("fiisCompras").Cells(18, 5) = "0"
    
End Sub
Sub fiisComprasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("fiisCompras").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("fiisCompras").Cells(5, 6) = "#Selecionar"
            Sheets("fiisCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("fiisCompras").Cells(14, 5) = "0"
            Sheets("fiisCompras").Cells(15, 5) = "0"
            Sheets("fiisCompras").Cells(18, 5) = "0"
            Sheets("fiisCompras").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("fiisCompras").Cells(5, 6) = "#Selecionar"
            Sheets("fiisCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("fiisCompras").Cells(14, 5) = "0"
            Sheets("fiisCompras").Cells(15, 5) = "0"
            Sheets("fiisCompras").Cells(18, 5) = "0"
            Sheets("fiisCompras").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub fiisComprasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoFundo = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoFundo = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("fiisCompras").Unprotect
                Range("tabFIIsCompras[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabFIIsCompras").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("fiisCompras").Cells(contLinha, 3) = "" Or Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("fiisCompras").Unprotect
                    Range("tabFIIsCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabFIIsCompras").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("fiisCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma compra realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("fiisCompras").Cells(contLinha, 3) = "" Or Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("fiisCompras").Unprotect
                    Range("tabFIIsCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabFIIsCompras").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("fiisCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma compra realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub fiisComprasLimparFiltro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("fiisCompras").Unprotect
        Range("tabFIIsCompras[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabFIIsCompras").Range.AutoFilter Field:=1
        
        Sheets("fiisCompras").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If
    
End Sub
Sub fiisComprasClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("fiisCompras").ListObjects("tabFIIsCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fiisCompras").ListObjects("tabFIIsCompras").Sort. _
        SortFields.Add Key:=Range("tabFIIsCompras[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fiisCompras").ListObjects("tabFIIsCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("fiisCompras").ListObjects("tabFIIsCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fiisCompras").ListObjects("tabFIIsCompras").Sort. _
        SortFields.Add Key:=Range("tabFIIsCompras[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fiisCompras").ListObjects("tabFIIsCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_FIIsRendimentos"
Sub fiisRendimentosRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVO RENDIMENTO
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("I9") = "Erro" Or Range("M6") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("fiisRendimentos").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    fundo = Range("E6")
    validaData = Range("A1")
    
' vari|fffd|veis para registro de recebimento
    data = Range("I7")
    codigoFundo = UCase(Range("D6"))
    valorUnit = Range("I8")
    valorBruto = Range("I9")
    valorIntegral = Range("I10")
    valorLiq = Range("M6")
    patrimonio = Range("E8")
    tipoProvento = Range("I6")
    statusOperacao = Range("N4")
    barraAlerta = Range("C12")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoInvest = "Fundos Imobili|fffd|rios"
    tipoOperacao = "Recebimento"
    origem = "Proventos de Ativos"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    corretora = Range("I5")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Este recebimento j|fffd| foi cadastrado. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("I5").Activate
            Exit Sub
            Else
            
            If fundo = "Selecione o fundo" Or fundo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("D6").Activate
                Exit Sub
                Else
                
                If valorBruto <= "0" And valorIntegral <= "0" Then
                    MsgBox "Valor de recebimento inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("I10").Activate
                    Exit Sub
                    Else
                    
                    If tipoProvento = "#Selecionar" Then
                        MsgBox "Selecione o tipo de recebimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("I6").Activate
                        Exit Sub
                        Else
                        
                        If barraAlerta = "Ops! Aconteceu um erro:" Then
                            MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Exit Sub
                            Else
                            
' valida|fffd||fffd|o para evitar duplicidade de registro
                            contLinha = 24
                            Do Until Sheets("fiisRendimentos").Cells(contLinha, 3) = "" Or Sheets("fiisRendimentos").Cells(contLinha, 4) = data And _
                            Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoFundo And Sheets("fiisRendimentos").Cells(contLinha, 9) = valorBruto
                            contLinha = contLinha + 1
                            Loop
                            
                            If Sheets("fiisRendimentos").Cells(contLinha, 4) = data And Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoFundo And _
                            Sheets("fiisRendimentos").Cells(contLinha, 9) = valorBruto Then
                            
                                Call fiisRendimentosNovoRecebimento
                                MsgBox "Este recebimento j|fffd| foi cadastrado. Inicie outra opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                
                                Else
                            End If
                            
' valida|fffd||fffd|o principal de recebimento
                            Dim confirmaReceb As VbMsgBoxResult
                            confirmaReceb = MsgBox("Deseja confirmar o recebimento de " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                            
                            If confirmaReceb = vbNo Then
                                Exit Sub
                                Else
                            
'*************************************************************************************************************************** REGISTRA RECEBIMENTO NA TABELA
' loop para localizar linha vazia
                                Sheets("carteiraCaixa").Unprotect
                                Sheets("fiisRendimentos").Unprotect
                                
' loop para localizar linha vazia
                                If Sheets("fiisRendimentos").Cells(24, 3) = "" Then
                                    contLinha = 24
                                    Else
                                    contLinha = Sheets("fiisRendimentos").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                    
                                End If
                                
' registra recebimento na tabela de proventos
                                Sheets("fiisRendimentos").Cells(contLinha, 4) = data
                                Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoFundo
                                Sheets("fiisRendimentos").Cells(contLinha, 7) = patrimonio
                                Sheets("fiisRendimentos").Cells(contLinha, 8) = tipoProvento
                                Sheets("fiisRendimentos").Cells(contLinha, 9) = valorBruto
                                Sheets("fiisRendimentos").Cells(contLinha, 11) = valorLiq
                                Sheets("fiisRendimentos").Cells(contLinha, 13) = corretora

' reestabelece formato da coluna e classifica
                                Range("tabFIIsRendimentos[Data Pgto.]").NumberFormat = "dd/mm/yyyy"
                                Call fiisRendimentosClassificar
                            
'/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////// CARTEIRA CAIXA
'*************************************************************************************************************************** GERA REGISTRO DE RECEBIMENTO EM CAIXA
' tipoOperacao = "Recebimento"
' origem = "Proventos de Ativos"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                    contLinha = 20
                                    Else
                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                    
                                End If
                                
' registra recebimento na tabela de opera|fffd||fffd|es do caixa
                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq

' reestabelece formato da coluna e classifica
                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                Call carteiraCaixaClassificar
                                Call carteiraCaixaID

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' status 0 = em branco / em andamento
' status 1 = recebimento confirmado
' status 2 = recebimento pendente
' status 3 = erro

' finaliza opera|fffd||fffd|o e altera status do recebimento
                                Sheets("fiisRendimentos").Select
                                
                                If data <= validaData Then
                                    statusOperacao = "1"
                                    Sheets("fiisRendimentos").Cells(4, 14) = statusOperacao
                                    
                                    Else
                                    statusOperacao = "2"
                                    Sheets("fiisRendimentos").Cells(4, 14) = statusOperacao
                                    
                                End If
                                
' bloqueia planilhas em uso
                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                Sheets("fiisRendimentos").Activate
                                Range("D6").Select
                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                
' valida modo de registro |fffd|nico ou sequencial
                                If Range("N3") = "|fffd|nico" Then
                                    Range("D6").Select
                                    Call planAutoSave
                                    MsgBox "Recebimento registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    Call fiisRendimentosNovoRecebimento
                                    Range("I5") = corretora
                                    Range("I6") = "Rendimentos"
                                    MsgBox "Recebimento registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    
' finaliza|fffd||fffd|o geral
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub fiisRendimentosLimpar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA RECEBIMENTO
' reseta valores dos campos
    Sheets("fiisRendimentos").Cells(8, 9) = "0"
    Sheets("fiisRendimentos").Cells(10, 9) = "0"

End Sub
Sub fiisRendimentosNovoRecebimento()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVO RECEBIMENTO COM ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("D6") = "#C|fffd|digo" And Range("I6") = "#Selecionar" And Range("I9") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("fiisRendimentos").Unprotect
        
        If Range("I9") = "Erro" Then
            Range("I8") = "0"
            Range("I10") = "0"
            
' reseta valores dos campos
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("fiisRendimentos").Cells(6, 4) = "#C|fffd|digo"
            Sheets("fiisRendimentos").Cells(5, 9) = "#Selecionar"
            Sheets("fiisRendimentos").Cells(6, 9) = "#Selecionar"
            Sheets("fiisRendimentos").Cells(8, 9) = "0"
            Sheets("fiisRendimentos").Cells(10, 9) = "0"
            Sheets("fiisRendimentos").Cells(4, 14) = "0"
            
            Range("D6").Select
            Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVO RECEBIMENTO SEM ERROS
' reseta valores dos campos
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("fiisRendimentos").Cells(6, 4) = "#C|fffd|digo"
            Sheets("fiisRendimentos").Cells(5, 9) = "#Selecionar"
            Sheets("fiisRendimentos").Cells(6, 9) = "#Selecionar"
            Sheets("fiisRendimentos").Cells(8, 9) = "0"
            Sheets("fiisRendimentos").Cells(10, 9) = "0"
            Sheets("fiisRendimentos").Cells(4, 14) = "0"
            
            Range("D6").Select
            Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub fiisRendimentosFiltrarRendimentosAno()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RECEBIMENTOS DO ANO CORRENTE
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    ano = Range("M22")
    
' valida c|fffd|digo do ativo para filtro
    Sheets("fiisRendimentos").Unprotect
    Range("tabFIIsRendimentos[[#Headers],[Ano]]").Select
    ActiveSheet.ListObjects("tabFIIsRendimentos").Range.AutoFilter Field:=1, Criteria1:=ano
    
    Sheets("fiisRendimentos").Cells(22, 14) = "Limpar filtro"
    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub fiisRendimentosFiltrarRendimentos()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RENDIMENTOS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("F22"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoFundo = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoFundo = "" Then
            Range("F22") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("fiisRendimentos").Unprotect
                Range("tabFIIsRendimentos[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabFIIsRendimentos").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("F22").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 24
                Do Until Sheets("fiisRendimentos").Cells(contLinha, 3) = "" Or Sheets("fiisRendimentos").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fiisRendimentos").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("fiisRendimentos").Unprotect
                    Range("tabFIIsRendimentos[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabFIIsRendimentos").Range.AutoFilter Field:=3, Criteria1:=codigoFundo
                    
                    Sheets("fiisRendimentos").Cells(21, 14) = "Limpar filtro"
                    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("F22").Activate
                    
                    Else
                    Range("F22") = "#C|fffd|digo"
                    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum rendimento recebido de " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 24
                Do Until Sheets("fiisRendimentos").Cells(contLinha, 3) = "" Or Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoFundo Then
                    Sheets("fiisRendimentos").Unprotect
                    Range("tabFIIsRendimentos[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabFIIsRendimentos").Range.AutoFilter Field:=3, Criteria1:=codigoFundo
                    
                    Sheets("fiisRendimentos").Cells(22, 14) = "Limpar filtro"
                    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("F22").Activate
                    Else
                    
                    Range("F22") = "#C|fffd|digo"
                    MsgBox "Nenhum rendimento recebido de " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub fiisRendimentosLimparFiltro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RECEBIMENTOS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N22") = "Limpar filtro" Then
        Sheets("fiisRendimentos").Unprotect
        Range("tabFIIsRendimentos[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabFIIsRendimentos").Range.AutoFilter Field:=1
        
        Sheets("fiisRendimentos").Cells(22, 14) = "Filtrar"
        Selection.AutoFilter
        Range("F22") = "#C|fffd|digo"
        Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("F22") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If

End Sub
Sub fiisRendimentosClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE RENDIMENTOS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("fiisRendimentos").ListObjects("tabFIIsRendimentos").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fiisRendimentos").ListObjects("tabFIIsRendimentos").Sort. _
        SortFields.Add Key:=Range("tabFIIsRendimentos[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fiisRendimentos").ListObjects("tabFIIsRendimentos").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("fiisRendimentos").ListObjects("tabFIIsRendimentos").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fiisRendimentos").ListObjects("tabFIIsRendimentos").Sort. _
        SortFields.Add Key:=Range("tabFIIsRendimentos[[#Headers],[Data Pgto.]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fiisRendimentos").ListObjects("tabFIIsRendimentos").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_FIIsVendas"
Sub fiisVendasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE VENDA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("fiisVendas").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    fundo = Range("H4")
    qtde = Range("E14")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")
    
' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de venda
    data = Range("E12")
    codigoFundo = UCase(Range("F6"))
    pmCompra = Range("H13")

' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Venda de Ativos"
    origem = "Bovespa (B3)"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde

' vari|fffd|veis para ordens pendentes
    tipoInvest = "Fundos Imobili|fffd|rios"
    tipoOrdem = Range("E13")

    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de venda j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("fiisVendas").Unprotect
        statusOperacao = "2"
        Sheets("fiisVendas").Cells(4, 14) = statusOperacao
        Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If fundo = "Selecione o ativo" Or fundo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do fundo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de cotas inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de cotas indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                    
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio da cota inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM PENDENTE
' valida direcionamento da ordem para lista de pend|fffd|ncias
                                    If valorVenda <= 0 Then
                                    
                                        Dim validaPendencia As VbMsgBoxResult
                                        validaPendencia = MsgBox("O valor total da ordem est|fffd| vazio." & vbNewLine & "Deseja mant|fffd|-la pendente de liquida|fffd||fffd|o?", _
                                        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPendencia = vbNo Then
                                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E18").Activate
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** GERENCIAMENTO DE PEND|fffd|NCIA DE VENDA SEM PREJU|fffd|ZO
' valida direcionamento da ordem para lista de pend|fffd|ncias e alerta de preju|fffd|zo em ordem pendnte de liquida|fffd||fffd|o
                                            If alertaPrejuizo >= "0" Then
                                                
' desbloqueia planilhas em uso
                                                Sheets("carteiraOp").Unprotect
                                                Sheets("fiisVendas").Unprotect
    
' loop para localizar linha vazia
                                                If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                    contLinha = 5
                                                    Else
                                                    contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("carteiraOp").Cells(contLinha, 3) = data
                                                Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                                Sheets("carteiraOp").Cells(contLinha, 7) = codigoFundo
                                                Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                                Sheets("carteiraOp").Cells(contLinha, 10) = puVenda
                                                Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                                Sheets("carteiraOp").Cells(contLinha, 13) = ghostCell & corretora
                                            
' reestabelece formato das colunas
                                                Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                                Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraOpClassificar
                                            
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
    
                                                statusOperacao = "3"
                                                Sheets("fiisVendas").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fiisVendas").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
'*************************************************************************************************************************** GERENCIAMENTO DE PEND|fffd|NCIA DE VENDA COM PREJU|fffd|ZO
' valida direcionamento da ordem para lista de pend|fffd|ncias e alerta de preju|fffd|zo em ordem pendnte de liquida|fffd||fffd|o
                                                Else
    
' alerta de registro da pend|fffd|ncia de venda com preju|fffd|zo
                                                Dim validaPrejuizo As VbMsgBoxResult
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
    
' desbloqueia planilhas em uso
                                                    Sheets("carteiraOp").Unprotect
                                                    Sheets("fiisVendas").Unprotect
    
' loop para localizar linha vazia
                                                    If Sheets("carteiraOp").Cells(5, 3) = "" Then
                                                        contLinha = 5
                                                        Else
                                                        contLinha = Sheets("carteiraOp").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
                                                    Sheets("carteiraOp").Cells(contLinha, 3) = data
                                                    Sheets("carteiraOp").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraOp").Cells(contLinha, 6) = tipoOrdem
                                                    Sheets("carteiraOp").Cells(contLinha, 7) = codigoFundo
                                                    Sheets("carteiraOp").Cells(contLinha, 9) = qtde
                                                    Sheets("carteiraOp").Cells(contLinha, 10) = puVenda
                                                    Sheets("carteiraOp").Cells(contLinha, 12) = "0"
                                                    Sheets("carteiraOp").Cells(contLinha, 13) = ghostCell & corretora
                                                    
' reestabelece formato das colunas
                                                    Range("tabCarteiraOp[Data Op.]").NumberFormat = "dd/mm/yyyy"
                                                    Range("tabCarteiraOp[Data Liq.]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraOpClassificar
                                            
' finaliza registro da pend|fffd|ncia e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
                                                    
                                                    statusOperacao = "3"
                                                    Sheets("fiisVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Ordem registrada com sucesso!" & vbNewLine & "Voc|fffd| receber|fffd| o alerta da liquida|fffd||fffd|o em breve.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
    
                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIAMENTO DE ORDEM SEM PEND|fffd|NCIA
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para venda
                                        Dim confirmaVenda As VbMsgBoxResult
                                        confirmaVenda = MsgBox("Deseja confirmar a venda de " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                        If confirmaVenda = vbNo Then
                                            Exit Sub
                                            Else
            
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA SEM PREJU|fffd|ZO
' alerta de venda sem preju|fffd|zo
                                            If alertaPrejuizo >= "0" Then
        
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("fiisCarteira").Unprotect
                                                Sheets("fiisVendas").Unprotect
                                                
' loop para localizar linha vazia
                                                If Sheets("fiisVendas").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("fiisVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra dados na tabela
                                                Sheets("fiisVendas").Cells(contLinha, 3) = data
                                                Sheets("fiisVendas").Cells(contLinha, 4) = codigoFundo
                                                Sheets("fiisVendas").Cells(contLinha, 8) = puVenda
                                                Sheets("fiisVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("fiisVendas").Cells(contLinha, 7) = qtde
                                                Sheets("fiisVendas").Cells(contLinha, 11) = valorVenda
                                                Sheets("fiisVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabFIIsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call fiisVendasClassificar
                                                
' ajusta ghostcell
                                                Call ajustaGhostCell
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE FIIS EM VENDA PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                contLinha = 18
                                                Do Until Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) = 0
                                                contLinha = contLinha + 1
                                                Loop
        
                                                If Sheets("fiisCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("fiisVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                    Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE FIIS EM VENDA TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("fiisVendas").Unprotect
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("fiisCompras").Unprotect
                                                    Sheets("fiisCarteira").Unprotect
                                                    Sheets("fiisRendimentos").Unprotect
                                                    Sheets("opEspeciaisExec").Unprotect
    
' localiza linha com status "vendido" na carteira
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    
                                                    Do Until Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                                    
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    If Sheets("fiisCarteira").Cells(contLinha, 3) = codigoFundo And Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                        Sheets("fiisCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                    
                                                    End If
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DO FII VENDIDO
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("fiisCompras").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo Then
                                                        Sheets("fiisCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS DO FII VENDIDO
' deleta opera|fffd||fffd|es especiais realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 5
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoFundo Then
                                                        Sheets("opEspeciaisExec").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
    
                                                    statusOperacao = "1"
                                                    Sheets("fiisVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                                Else
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de venda com preju|fffd|zo
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
                                            
'*************************************************************************************************************************** REGISTRA VENDA NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("fiisCarteira").Unprotect
                                                    Sheets("fiisVendas").Unprotect
    
' loop para localizar linha vazia
                                                    If Sheets("fiisVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("fiisVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("fiisVendas").Cells(contLinha, 3) = data
                                                    Sheets("fiisVendas").Cells(contLinha, 4) = codigoFundo
                                                    Sheets("fiisVendas").Cells(contLinha, 8) = puVenda
                                                    Sheets("fiisVendas").Cells(contLinha, 9) = pmCompra
                                                    Sheets("fiisVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("fiisVendas").Cells(contLinha, 11) = valorVenda
                                                    Sheets("fiisVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabFIIsVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call fiisVendasClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE FIIS EM VENDA PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
            
                                                    If Sheets("fiisCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                        
                                                        statusOperacao = "1"
                                                        Sheets("fiisVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE FIIS - VENDA TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("fiisVendas").Unprotect
                                                        Sheets("fiisCompras").Unprotect
                                                        Sheets("fiisCarteira").Unprotect
                                                        Sheets("fiisRendimentos").Unprotect
                                                        Sheets("opEspeciaisExec").Unprotect
                                                        
' localiza linha com status "vendido" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("fiisCarteira").Cells(contLinha, 6) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                        If Sheets("fiisCarteira").Cells(contLinha, 3) = codigoFundo And Sheets("fiisCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                            Sheets("fiisCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DO FUNDO VENDIDO
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("fiisCompras").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("fiisCompras").Cells(contLinha, 4) = codigoFundo Then
                                                            Sheets("fiisCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS DO FII VENDIDO
' deleta opera|fffd||fffd|es especiais realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 5
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoFundo Then
                                                            Sheets("opEspeciaisExec").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Bovespa (B3)"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoFundo
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                        
                                                        statusOperacao = "1"
                                                        Sheets("fiisVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("fiisVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub fiisVendasLimpar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE VENDA
' reseta valores dos campos
    Sheets("fiisVendas").Cells(14, 5) = "0"
    Sheets("fiisVendas").Cells(15, 5) = "0"
    Sheets("fiisVendas").Cells(18, 5) = "0"
    
End Sub
Sub fiisVendasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("fiisVendas").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("fiisVendas").Cells(5, 6) = "#Selecionar"
            Sheets("fiisVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("fiisVendas").Cells(14, 5) = "0"
            Sheets("fiisVendas").Cells(15, 5) = "0"
            Sheets("fiisVendas").Cells(18, 5) = "0"
            Sheets("fiisVendas").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("fiisVendas").Cells(5, 6) = "#Selecionar"
            Sheets("fiisVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("fiisVendas").Cells(14, 5) = "0"
            Sheets("fiisVendas").Cells(15, 5) = "0"
            Sheets("fiisVendas").Cells(18, 5) = "0"
            Sheets("fiisVendas").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub fiisLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("fiisVendas").Cells(23, 3) = "" Then
        MsgBox "Nenhuma venda total registrada at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de vendas totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("fiisVendas").Unprotect
            
            Do Until Sheets("fiisVendas").Cells(contLinha, 3) = ""
            If Sheets("fiisVendas").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("fiisVendas").Activate
                Sheets("fiisVendas").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de vendas removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub fiisVendasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoFundo = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoFundo = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoFundo = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("fiisVendas").Unprotect
                Range("tabFIIsVendas[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabFIIsVendas").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("fiisVendas").Cells(contLinha, 3) = "" Or Sheets("fiisVendas").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fiisVendas").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("fiisVendas").Unprotect
                    Range("tabFIIsVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabFIIsVendas").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("fiisVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma venda realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("fiisVendas").Cells(contLinha, 3) = "" Or Sheets("fiisVendas").Cells(contLinha, 4) = codigoFundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fiisVendas").Cells(contLinha, 4) = codigoFundo Then
                    Sheets("fiisVendas").Unprotect
                    Range("tabFIIsVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabFIIsVendas").Range.AutoFilter Field:=2, Criteria1:=codigoFundo
                    
                    Sheets("fiisVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma venda realizada para " & codigoFundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub fiisVendasLimparFiltro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("fiisVendas").Unprotect
        Range("tabFIIsVendas[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabFIIsVendas").Range.AutoFilter Field:=1
        
        Sheets("fiisVendas").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
    End If

End Sub
Sub fiisVendasClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("fiisVendas").ListObjects("tabFIIsVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fiisVendas").ListObjects("tabFIIsVendas").Sort. _
        SortFields.Add Key:=Range("tabFIIsVendas[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fiisVendas").ListObjects("tabFIIsVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("fiisVendas").ListObjects("tabFIIsVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fiisVendas").ListObjects("tabFIIsVendas").Sort. _
        SortFields.Add Key:=Range("tabFIIsVendas[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fiisVendas").ListObjects("tabFIIsVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_FundosAplic"
Sub fundosAplicRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE APLICA|fffd||fffd|O
'*************************************************************************************************************************** VARI|fffd|VEIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("fundosAplic").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    gestor = Range("I5")
    fundo = Range("I6")
    classe = Range("F6")
    benchmark = Range("F7")
    moeda = Range("F7")
    resgate = Range("F8")
    valorAplicacao = Range("E17")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H18")
    barraAlerta = Range("C11")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    validaData = Range("A1")
    data = Range("E15")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = gestor
    finalidade = "Aumento Patrimonial"
    valorBruto = valorAplicacao
    valorCompra = valorAplicacao
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "Fundos"
    tipoOrdem = Range("E16")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de aplica|fffd||fffd|o j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("fundosAplic").Unprotect
        statusOperacao = "2"
        Sheets("fundosAplic").Cells(4, 14) = statusOperacao
        Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If classe = "#Selecionar" Then
                MsgBox "Selecione a classe do Fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If Range("E7") = "Benchmark:" And benchmark = "#Selecionar" Then
                    MsgBox "Selecione o benchmark do Fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("F7").Activate
                    Exit Sub
                    Else
                    
                    If Range("E7") = "Moeda:" And moeda = "#Selecionar" Then
                        MsgBox "Selecione o moeda de cota|fffd||fffd|o do Fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("F7").Activate
                        Exit Sub
                        Else
                        
                        If gestor = "#Gestor" Then
                            MsgBox "Informe qual o Gestor do Fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("I5").Activate
                            Exit Sub
                            Else
                            
                            If Range("I5") <= 5 Then
                                MsgBox "Ops! Parece que o nome do Gestor est|fffd| muito pequeno.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("I5").Activate
                                Exit Sub
                                Else
                                
                                If fundo = "#Nome do Fundo" Then
                                    MsgBox "Informe qual o nome do Fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("I6").Activate
                                    Exit Sub
                                    Else
                                    
                                    If Range("N6") <= 15 Then
                                        MsgBox "Ops! Parece que o nome do Fundo est|fffd| muito pequeno.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("I6").Activate
                                        Exit Sub
                                        Else
                                        
                                        If valorAplicacao <= "0" Then
                                            MsgBox "Valor de aplica|fffd||fffd|o inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E17").Activate
                                            Exit Sub
                                            Else
                                            
                                            If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                                                MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Range("E17").Activate
                                                Exit Sub
                                                Else
                                                
                                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    Else
                                                    
                                                    If data > Range("A1") Then
                                                        MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Range("E15").Activate
                                                        Exit Sub
                                                        Else
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                                        Dim confirmaAplicacao As VbMsgBoxResult
                                                        confirmaAplicacao = MsgBox("Deseja confirmar a aplica|fffd||fffd|o em " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                        
                                                        If confirmaAplicacao = vbNo Then
                                                            Exit Sub
                                                            Else
                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA APLICA|fffd||fffd|O NA TABELA
' loop para localizar linha vazia
                                                            Sheets("fundosCarteira").Unprotect
                                                            Sheets("carteiraCaixa").Unprotect
                                                            Sheets("fundosAplic").Unprotect
                                                            
' loop para localizar linha vazia
                                                            If Sheets("fundosAplic").Cells(23, 3) = "" Then
                                                                contLinha = 23
                                                                Else
                                                                contLinha = Sheets("fundosAplic").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
' registra dados na tabela
                                                            Sheets("fundosAplic").Cells(contLinha, 3) = data
                                                            Sheets("fundosAplic").Cells(contLinha, 4) = fundo
                                                            Sheets("fundosAplic").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                                            Sheets("fundosAplic").Cells(contLinha, 4).InsertIndent 2
                                                            Sheets("fundosAplic").Cells(contLinha, 7) = gestor
                                                            Sheets("fundosAplic").Cells(contLinha, 8) = classe
                                                            
                                                            If Range("E7") = "Benchmark:" Then
                                                                Sheets("fundosAplic").Cells(contLinha, 9) = benchmark
                                                                Sheets("fundosAplic").Cells(contLinha, 10) = "Real"
                                                                Else
                                                                
                                                                Sheets("fundosAplic").Cells(contLinha, 9) = "N/A"
                                                                Sheets("fundosAplic").Cells(contLinha, 10) = moeda
                                                                
                                                            End If
                                                            
                                                            Sheets("fundosAplic").Cells(contLinha, 11) = valorAplicacao
                                                            Sheets("fundosAplic").Cells(contLinha, 12) = "D+" & resgate
                                                            Sheets("fundosAplic").Cells(contLinha, 14) = corretora
                                                            
' reestabelece formato da coluna e classifica
                                                            Range("tabFundosAplica|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call fundosAplicClassificar
                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE FUNDOS - REAPLICA|fffd||fffd|O
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                                            contLinha = 18
                                                            Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = "" Or Sheets("fundosCarteira").Cells(contLinha, 3) = fundo
                                                            contLinha = contLinha + 1
                                                            Loop
                                                            
' verifica|fffd||fffd|o de nova compra e recompra
                                                            If Sheets("fundosCarteira").Cells(contLinha, 3) = fundo Then
                                                            
' ajusta saldo em reaplica|fffd||fffd|o
                                                                contLinha = 18
                                                                Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = fundo
                                                                contLinha = contLinha + 1
                                                                Loop
                                                                
                                                                valorSaldo = Sheets("fundosCarteira").Cells(contLinha, 11)
                                                                Sheets("fundosCarteira").Cells(contLinha, 11) = valorBruto + valorSaldo
                                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE REAPLICA|fffd||fffd|O EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = gestor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                    contLinha = 20
                                                                    Else
                                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                    
                                                                End If
                                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = gestor
                                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                                
' reestabelece formato da coluna e classifica
                                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                Call carteiraCaixaClassificar
                                                                Call carteiraCaixaID
                
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                If data > validaData Then
                                                                    statusOperacao = "3"
                                                                    Else
                                                                    statusOperacao = "1"
                                                                    
                                                                End If
                                                                
                                                                Sheets("fundosAplic").Cells(4, 14) = statusOperacao
                                                                
' bloqueia planilhas em uso
                                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                Sheets("fundosAplic").Activate
                                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                
                                                                Range("F5").Select
                                                                Call planAutoSave
                                                                MsgBox "Reaplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                Exit Sub
                                                                
                                                                Else
                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE FUNDOS - NOVA APLICA|fffd||fffd|O
' registro de nova compra na carteira de fundos
                                                                If Sheets("fundosCarteira").Cells(contLinha, 3) <> fundo Then
                                                                    Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = ""
                                                                    contLinha = contLinha + 1
                                                                    Loop
                                                                    
                                                                    Sheets("fundosCarteira").Cells(contLinha, 3) = fundo
                
' ajusta saldo em nova aplica|fffd||fffd|o
                                                                    contLinha = 18
                                                                    Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = fundo
                                                                    contLinha = contLinha + 1
                                                                    Loop
                                                                    
                                                                    valorSaldo = Sheets("fundosCarteira").Cells(contLinha, 11)
                                                                    Sheets("fundosCarteira").Cells(contLinha, 11) = valorBruto + valorSaldo
                                                                    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                                    If Sheets("fundosCarteira").Cells(18, 3) <> "" And Sheets("fundosCarteira").Cells(19, 3) = "" Then
                                                                        Call fundosCarteiraAjustarGrafico
                                                                        Else
                                                                        
                                                                    End If
                                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA APLICA|fffd||fffd|O EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = gestor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                        contLinha = 20
                                                                        Else
                                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                        
                                                                    End If
                                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = gestor
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                
' reestabelece formato da coluna e classifica
                                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                    Call carteiraCaixaClassificar
                                                                    Call carteiraCaixaID
                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                    If data > validaData Then
                                                                        statusOperacao = "3"
                                                                        Else
                                                                        
                                                                        statusOperacao = "1"
                                                                    End If
                                                                    
                                                                    Sheets("fundosAplic").Cells(4, 14) = statusOperacao
                                                                    
' bloqueia planilhas em uso
                                                                    Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                    Sheets("fundosAplic").Activate
                                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                    
                                                                    Range("F5").Select
                                                                    Call planAutoSave
                                                                    MsgBox "Nova aplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                    Exit Sub
                                                                    
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub fundosAplicLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE APLICA|fffd||fffd|O
' reseta valores dos campos
    Sheets("fundosAplic").Cells(17, 5) = "0"
    
End Sub
Sub fundosAplicNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#Selecionar" And Range("F7") = "#Selecionar" And Range("I5") = "#Gestor" And Range("I6") = "#Nome do Fundo" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("fundosAplic").Unprotect
        
        Range("E15").FormulaR1C1 = "=TODAY()"
        Sheets("fundosAplic").Cells(17, 5) = "0"
        Sheets("fundosAplic").Cells(4, 14) = "0"
        Sheets("fundosAplic").Cells(5, 9) = "#Gestor"
        Sheets("fundosAplic").Cells(6, 9) = "#Nome do Fundo"
        Sheets("fundosAplic").Cells(8, 6) = "0"
        Sheets("fundosAplic").Cells(7, 6) = "#Selecionar"
        Sheets("fundosAplic").Cells(6, 6) = "#Selecionar"
        Sheets("fundosAplic").Cells(5, 6) = "#Selecionar"
        
        Range("F5").Select
        Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
    
End Sub
Sub fundosAplicFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    fundo = Range("E21")
    
' valida c|fffd|digo do ativo para filtro
    If fundo = "#Nome do Fundo" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If fundo = "" Then
            Range("E21") = "#Nome do Fundo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("fundosAplic").Unprotect
                Range("tabFundosAplica|fffd||fffd|es[[#Headers],[Fundo]]").Select
                ActiveSheet.ListObjects("tabFundosAplica|fffd||fffd|es").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("fundosAplic").Cells(contLinha, 3) = "" Or Sheets("fundosAplic").Cells(contLinha, 4) = fundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fundosAplic").Cells(contLinha, 4) = fundo Then
                    Sheets("fundosAplic").Unprotect
                    Range("tabFundosAplica|fffd||fffd|es[[#Headers],[Fundo]]").Select
                    ActiveSheet.ListObjects("tabFundosAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=fundo
                    
                    Sheets("fundosAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada no fundo " & fundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("fundosAplic").Cells(contLinha, 3) = "" Or Sheets("fundosAplic").Cells(contLinha, 4) = fundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fundosAplic").Cells(contLinha, 4) = fundo Then
                    Sheets("fundosAplic").Unprotect
                    Range("tabFundosAplica|fffd||fffd|es[[#Headers],[Fundo]]").Select
                    ActiveSheet.ListObjects("tabFundosAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=fundo
                    
                    Sheets("fundosAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada no fundo " & fundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub fundosAplicLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("fundosAplic").Unprotect
        Range("tabFundosAplica|fffd||fffd|es[[#Headers],[Fundo]]").Select
        ActiveSheet.ListObjects("tabFundosAplica|fffd||fffd|es").Range.AutoFilter Field:=1
        
        Sheets("fundosAplic").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#Nome do Fundo"
        Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub fundosAplicClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por nome do fundo
    ActiveWorkbook.Worksheets("fundosAplic").ListObjects("tabFundosAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fundosAplic").ListObjects("tabFundosAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabFundosAplica|fffd||fffd|es[[#Headers],[Fundo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fundosAplic").ListObjects("tabFundosAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("fundosAplic").ListObjects("tabFundosAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fundosAplic").ListObjects("tabFundosAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabFundosAplica|fffd||fffd|es[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fundosAplic").ListObjects("tabFundosAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub



Attribute VB_Name = "M_FundosCarteira"
Sub fundosCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        ActiveSheet.Unprotect
        ActiveSheet.Shapes.Range(Array("grfFundosVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfFundosAnal|fffd|tico")).Visible = False
        Sheets("fundosCarteira").Cells(15, 3) = "Volum|fffd|trico"
        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            ActiveSheet.Unprotect
            ActiveSheet.Shapes.Range(Array("grfFundosVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfFundosAnal|fffd|tico")).Visible = True
            Sheets("fundosCarteira").Cells(15, 3) = "Anal|fffd|tico"
            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub fundosCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("fundosCarteira").Unprotect
    Sheets("fundosCarteira").ChartObjects("grfFundosVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabFundosCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub fundosCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call fundosCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("fundosCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfFundosAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("fundosCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("fundosCarteira").Unprotect

                ActiveSheet.ChartObjects("grfFundosAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfFundosAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("fundosCarteira").Cells(4, 3) = "Com identificador"
                Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub fundosCarteiraAjustarSaldo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDOS
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("fundosCarteira").Cells(18, 3) = "" Then
        Sheets("fundosCarteira").Unprotect
        Range("F3") = 0
        Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida status de t|fffd|tulos comprados
    If Range("N16") = "AJUSTAR SALDO" Then
        Sheets("fundosCarteira").Unprotect
        Sheets("fundosCarteira").Cells(16, 14) = "SALVAR ALTERA|fffd||fffd|ES"
        Range("tabFundosCarteira[Saldo]").Locked = False
        Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Range("K18").Select
        Else
        
        If Range("N16") = "SALVAR ALTERA|fffd||fffd|ES" Then
            Sheets("fundosCarteira").Unprotect
            Sheets("fundosCarteira").Cells(16, 14) = "AJUSTAR SALDO"
            Range("tabFundosCarteira").Locked = True
            Range("J16") = Range("A1")
            Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Call planAutoSave
            MsgBox "Dados atualizados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
        
        End If
    End If
    
End Sub





Attribute VB_Name = "M_FundosResgates"
Sub fundosResgatesRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE RESGATE
'*************************************************************************************************************************** VARI|fffd|VEIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("fundosResgates").Cells(30, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    fundo = Range("F6")
    alertaPrejuizo = Range("M16")
    statusOperacao = Range("N4")
    barraAlerta = Range("C11")
    
' vari|fffd|veis para efetiva|fffd||fffd|o de resgate
    data = Range("E15")
    validaData = Range("A1")
    valorInvest = Range("F9")
    valorResgate = Range("G9")
    valorBruto = Range("E17")
    valorLiq = Range("E18")
    
    If valorBruto = 0 Then
        valorBruto = Range("D21")
    End If
    
    If valorLiq = 0 Then
        valorLiq = Range("E19")
    End If
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Resgate de Ativos"
    origem = gestor
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "Fundos"
    tipoOrdem = Range("E16")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de resgate j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("fundosResgates").Unprotect
        statusOperacao = "2"
        Sheets("fundosResgates").Cells(4, 14) = statusOperacao
        Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If fundo = "#Selecionar" Then
                MsgBox "Selecione o nome do fundo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If valorLiq > Range("H17") * 1.2 Or valorBruto > Range("H17") * 1.2 Then
                    MsgBox "Saldo indispon|fffd|vel para resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E18").Activate
                    Exit Sub
                    Else
                    
                    If valorBruto <= 0 And valorLiq <= 0 Then
                        MsgBox "Informe o valor do resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E17").Activate
                        Exit Sub
                        Else
                        
                        If barraAlerta = "Ops! Aconteceu um erro:" Then
                            MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Exit Sub
                            Else
                            
                            If data > Range("A1") Then
                                MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E15").Activate
                                Exit Sub
                                Else
                                
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para resgate
                                Dim confirmaResgate As VbMsgBoxResult
                                confirmaResgate = MsgBox("Deseja confirmar o resgate de " & fundo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                
                                If confirmaResgate = vbNo Then
                                    Exit Sub
                                    Else
                                    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE SEM PREJU|fffd|ZO
' alerta de resgate sem preju|fffd|zo
                                    If alertaPrejuizo >= "0" Then
    
' desbloqueia planilhas em uso
                                        Sheets("carteiraCaixa").Unprotect
                                        Sheets("fundosResgates").Unprotect
                                        Sheets("fundosCarteira").Unprotect
                                        
' loop para localizar linha vazia
                                        If Sheets("fundosResgates").Cells(26, 3) = "" Then
                                            contLinha = 26
                                            Else
                                            contLinha = Sheets("fundosResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' registra dados na tabela
                                        Sheets("fundosResgates").Cells(contLinha, 3) = data
                                        Sheets("fundosResgates").Cells(contLinha, 4) = fundo
                                        Sheets("fundosResgates").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                        Sheets("fundosResgates").Cells(contLinha, 4).InsertIndent 2
                                        Sheets("fundosResgates").Cells(contLinha, 9) = valorInvest
                                        Sheets("fundosResgates").Cells(contLinha, 10) = valorResgate
                                        Sheets("fundosResgates").Cells(contLinha, 14) = ghostCell & corretora
                                        Sheets("fundosResgates").Cells(contLinha, 11) = valorBruto
                                        
' atualiza saldo na tabela carteira e define vari|fffd|vel gestor
                                        valorSaldo = Sheets("fundosResgates").Cells(contLinha, 12)
                                        
                                        contLinha = 18
                                        Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = fundo
                                        contLinha = contLinha + 1
                                        Loop
                                        
                                        gestor = Sheets("fundosCarteira").Cells(contLinha, 6)
                                        Sheets("fundosCarteira").Cells(contLinha, 11) = valorSaldo
                                        
' reestabelece formato da coluna e classifica
                                        Range("tabFundosResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call fundosResgatesClassificar
                                        
' ajusta ghostcell
                                        Call ajustaGhostCell
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE FUNDOS EM RESGATE PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                        contLinha = 18
                                        Do Until Sheets("fundosCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("fundosCarteira").Cells(contLinha, 11) = 0
                                        contLinha = contLinha + 1
                                        Loop
                                        
                                        If Sheets("fundosCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Or Sheets("fundosCarteira").Cells(contLinha, 11) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = gestor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = gestor
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = fundo
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
                                            
' reestabelece formato da coluna e classifica
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
                                            
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                            
                                            statusOperacao = "1"
                                            Sheets("fundosResgates").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("fundosResgates").Activate
                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Range("F5").Select
                                            Call planAutoSave
                                            MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                            
                                            Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE FUNDOS EM RESGATE TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("fundosResgates").Unprotect
                                            Sheets("fundosAplic").Unprotect
                                            Sheets("fundosCarteira").Unprotect
                                            
' localiza linha com status "LIQUIDADO" na carteira
                                            contLinha = 18
                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                            Do Until Sheets("fundosCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("fundosCarteira").Cells(contLinha, 11) = 0
                                            contLinha = contLinha + 1
                                            tabLinha = tabLinha + 1
                                            Loop
                                            
' deleta ativo da carteira ap|fffd|s registro de resgate total
                                            If Sheets("fundosCarteira").Cells(contLinha, 3) = fundo And Sheets("fundosCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                                                Sheets("fundosCarteira").Activate
                                                Cells(contLinha, 3).Select
                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                Else
                                            
                                            End If
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO FUNDO LIQUIDADO
' deleta aplica|fffd||fffd|es realizadas com o fundo liquidado
                                            contLinha = 23
                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                            Do Until Sheets("fundosAplic").Cells(contLinha, 3) = ""
                                            
                                            If Sheets("fundosAplic").Cells(contLinha, 4) = fundo Then
                                                Sheets("fundosAplic").Activate
                                                Cells(contLinha, 3).Select
                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                Else
                                                
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                                
                                            End If
                                            Loop
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = gestor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = gestor
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = fundo
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
    
' reestabelece formato da coluna e classifica
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
    
                                            statusOperacao = "1"
                                            Sheets("fundosResgates").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("fundosResgates").Activate
                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Range("F5").Select
                                            Call planAutoSave
                                            MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                            
                                        End If
                                        Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de resgate com preju|fffd|zo
                                        validaPrejuizo = MsgBox("Este resgate causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If validaPrejuizo = vbNo Then
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** REGISTRA RESGATE NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("fundosCarteira").Unprotect
                                            Sheets("fundosResgates").Unprotect
    
' loop para localizar linha vazia
                                            If Sheets("fundosResgates").Cells(26, 3) = "" Then
                                                contLinha = 26
                                                Else
                                                contLinha = Sheets("fundosResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra dados na tabela
                                            Sheets("fundosResgates").Cells(contLinha, 3) = data
                                            Sheets("fundosResgates").Cells(contLinha, 4) = fundo
                                            Sheets("fundosResgates").Cells(contLinha, 4).HorizontalAlignment = xlGeneral
                                            Sheets("fundosResgates").Cells(contLinha, 4).InsertIndent 2
                                            Sheets("fundosResgates").Cells(contLinha, 9) = valorInvest
                                            Sheets("fundosResgates").Cells(contLinha, 10) = valorResgate
                                            Sheets("fundosResgates").Cells(contLinha, 14) = ghostCell & corretora
                                            Sheets("fundosResgates").Cells(contLinha, 11) = valorBruto
                                            
' atualiza saldo na tabela carteira e define vari|fffd|vel gestor
                                            valorSaldo = Sheets("fundosResgates").Cells(contLinha, 12)
                                            
                                            contLinha = 18
                                            Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = fundo
                                            contLinha = contLinha + 1
                                            Loop
                                            
                                            gestor = Sheets("fundosCarteira").Cells(contLinha, 6)
                                            Sheets("fundosCarteira").Cells(contLinha, 11) = valorSaldo
                                            
' reestabelece formato da coluna e classifica
                                            Range("tabFundosResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call fundosResgatesClassificar
                                            
' ajusta ghostcell
                                            Call ajustaGhostCell
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE FUNDOS EM RESGATE PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                            contLinha = 18
                                            Do Until Sheets("fundosCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("fundosCarteira").Cells(contLinha, 11) = 0
                                            contLinha = contLinha + 1
                                            Loop
                                            
                                            If Sheets("fundosCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Or Sheets("fundosCarteira").Cells(contLinha, 11) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = gestor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = gestor
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = fundo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
                                                
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
                                                
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                
                                                statusOperacao = "1"
                                                Sheets("fundosResgates").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fundosResgates").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                                Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE FUNDOS - RESGATE TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("fundosResgates").Unprotect
                                                Sheets("fundosAplic").Unprotect
                                                Sheets("fundosCarteira").Unprotect
                                                
' localiza linha com status "LIQUIDADO" na carteira
                                                contLinha = 18
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("fundosCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("fundosCarteira").Cells(contLinha, 11) = 0
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                                Loop
                                                
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                If Sheets("fundosCarteira").Cells(contLinha, 3) = fundo And Sheets("fundosCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                                                    Sheets("fundosCarteira").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                
                                                End If
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO FUNDO LIQUIDADO
' deleta compras realizadas com o fundo liquidado
                                                contLinha = 23
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("fundosAplic").Cells(contLinha, 3) = ""
                                                
                                                If Sheets("fundosAplic").Cells(contLinha, 4) = fundo Then
                                                    Sheets("fundosAplic").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = gestor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = gestor
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = fundo
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq
    
' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                statusOperacao = "1"
                                                Sheets("fundosResgates").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fundosCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fundosAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("fundosResgates").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub fundosResgatesNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#Selecionar" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("fundosResgates").Unprotect
        Range("E15").FormulaR1C1 = "=TODAY()"
        Sheets("fundosResgates").Cells(5, 6) = "#Selecionar"
        Sheets("fundosResgates").Cells(6, 6) = "#Selecionar"
        Sheets("fundosResgates").Cells(4, 14) = "0"
        Sheets("fundosResgates").Cells(17, 5) = "0"
        Sheets("fundosResgates").Cells(18, 5) = "0"
        
        Range("F5").Select
        Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
    End If
End Sub
Sub fundosLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("fundosResgates").Cells(26, 3) = "" Then
        MsgBox "Nenhum resgate total registrado at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de resgates totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("fundosResgates").Unprotect
            
            Do Until Sheets("fundosResgates").Cells(contLinha, 3) = ""
            If Sheets("fundosResgates").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("fundosResgates").Activate
                Sheets("fundosResgates").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de resgates removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub fundosResgatesLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE RESGATE
' reseta valores dos campos
    Sheets("fundosResgates").Cells(17, 5) = "0"
    Sheets("fundosResgates").Cells(18, 5) = "0"
    
End Sub
Sub fundosResgatesFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    fundo = Range("E24")
    
' valida c|fffd|digo do ativo para filtro
    If fundo = "#Nome do Fundo" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If fundo = "" Then
            Range("E24") = "#Nome do Fundo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N24") = "Limpar filtro" Then
                
                Sheets("fundosResgates").Unprotect
                Range("tabFundosResgates[[#Headers],[Fundo]]").Select
                ActiveSheet.ListObjects("tabFundosResgates").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E24").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 26
                Do Until Sheets("fundosResgates").Cells(contLinha, 3) = "" Or Sheets("fundosResgates").Cells(contLinha, 4) = fundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fundosResgates").Cells(contLinha, 4) = fundo Then
                    Sheets("fundosResgates").Unprotect
                    Range("tabFundosResgates[[#Headers],[Fundo]]").Select
                    ActiveSheet.ListObjects("tabFundosResgates").Range.AutoFilter Field:=2, Criteria1:=fundo
                    
                    Sheets("fundosResgates").Cells(24, 14) = "Limpar filtro"
                    Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E24").Activate
                    
                    Else
                    Range("E24") = "#Nome do Fundo"
                    Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum resgate realizado para o fundo " & fundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else

' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 26
                Do Until Sheets("fundosResgates").Cells(contLinha, 3) = "" Or Sheets("fundosResgates").Cells(contLinha, 4) = fundo
                contLinha = contLinha + 1
                Loop
                
                If Sheets("fundosResgates").Cells(contLinha, 4) = fundo Then
                    Sheets("fundosResgates").Unprotect
                    Range("tabFundosResgates[[#Headers],[Fundo]]").Select
                    ActiveSheet.ListObjects("tabFundosResgates").Range.AutoFilter Field:=2, Criteria1:=fundo
                    
                    Sheets("fundosResgates").Cells(24, 14) = "Limpar filtro"
                    Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E24").Activate
                    
                    Else
                    Range("E24") = "#Nome do Fundo"
                    MsgBox "Nenhum resgate realizado para o fundo " & fundo & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub fundosResgatesLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RESGATES
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N24") = "Limpar filtro" Then
        Sheets("fundosResgates").Unprotect
        Range("tabFundosResgates[[#Headers],[Fundo]]").Select
        ActiveSheet.ListObjects("tabFundosResgates").Range.AutoFilter Field:=1
        
        Sheets("fundosResgates").Cells(24, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E24") = "#Nome do Fundo"
        Sheets("fundosResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E24") = "#Nome do Fundo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub fundosResgatesClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por nome do ativo
    ActiveWorkbook.Worksheets("fundosResgates").ListObjects("tabFundosResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fundosResgates").ListObjects("tabFundosResgates").Sort. _
        SortFields.Add Key:=Range("tabFundosResgates[[#Headers],[Fundo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fundosResgates").ListObjects("tabFundosResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de resgate
    ActiveWorkbook.Worksheets("fundosResgates").ListObjects("tabFundosResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("fundosResgates").ListObjects("tabFundosResgates").Sort. _
        SortFields.Add Key:=Range("tabFundosResgates[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("fundosResgates").ListObjects("tabFundosResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_LetrasAplic"
Sub letrasAplicRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE APLICA|fffd||fffd|O
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E17") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("letrasAplic").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    letra = Range("H4")
    emissor = Range("F6")
    qtde = Range("E15")
    puCompra = Range("E16")
    indexador = Range("I5")
    taxaAnual = Range("I6")
    vencimento = Range("I7")
    valorCompra = Range("E18")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H17")
    barraAlerta = Range("C9")
    
' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de aplica|fffd||fffd|o
    data = Range("E13")
    tipoTitulo = Range("N3")
    codigoLetra = UCase(Range("F7"))
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = emissor
    finalidade = "Aumento Patrimonial"
    valorBruto = puCompra * qtde
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "LCA/LCI"
    tipoOrdem = Range("E14")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de aplica|fffd||fffd|o j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("letrasAplic").Unprotect
        statusOperacao = "2"
        Sheets("letrasAplic").Cells(4, 14) = statusOperacao
        Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If letra = "Selecione o emissor do t|fffd|tulo" Then
                MsgBox "Selecione o emissor do t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If indexador = "#Selecionar" Then
                    MsgBox "Selecione o indexador do t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("I5").Activate
                    Exit Sub
                    Else
                    
                    If tipoTitulo = "#Selecionar" Then
                        MsgBox "Selecione o tipo de t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("N3").Activate
                        Exit Sub
                        Else
                        
                        If taxaAnual <= 0 Then
                            MsgBox "Informe a taxa de rendimento anual do t|fffd|tulo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("I6").Activate
                            Exit Sub
                            Else
                            
                            If vencimento <= Range("A1") Then
                                MsgBox "Data de vencimento do t|fffd|tulo inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("I7").Activate
                                Exit Sub
                                Else
                                
                                If qtde <= "0" Then
                                    MsgBox "Quantidade de t|fffd|tulos inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E15").Activate
                                    Exit Sub
                                    Else
                                    
                                    If puCompra <= "0" Then
                                        MsgBox "Pre|fffd|o unit|fffd|rio do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("E16").Activate
                                        Exit Sub
                                        Else
                                        
                                        If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                                            MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E16").Activate
                                            Exit Sub
                                            Else
                                            
                                            If valorCompra <= 0 Then
                                                MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Range("E18").Activate
                                                Exit Sub
                                                Else
                                                
                                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    Else
                                                    
                                                    If data > Range("A1") Then
                                                        MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Range("E13").Activate
                                                        Exit Sub
                                                        Else
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de aplica|fffd||fffd|o
                                                        Dim confirmaAplicacao As VbMsgBoxResult
                                                        confirmaAplicacao = MsgBox("Deseja confirmar a aplica|fffd||fffd|o em " & letra & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                        
                                                        If confirmaAplicacao = vbNo Then
                                                            Exit Sub
                                                            Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA APLICA|fffd||fffd|O NA TABELA
' loop para localizar linha vazia
                                                            Sheets("letrasCarteira").Unprotect
                                                            Sheets("carteiraCaixa").Unprotect
                                                            Sheets("letrasAplic").Unprotect
                                                            
' loop para localizar linha vazia
                                                            If Sheets("letrasAplic").Cells(23, 3) = "" Then
                                                                contLinha = 23
                                                                Else
                                                                contLinha = Sheets("letrasAplic").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
' registra dados na tabela
                                                            Sheets("letrasAplic").Cells(contLinha, 3) = data
                                                            Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra
                                                            Sheets("letrasAplic").Cells(contLinha, 5) = emissor
                                                            Sheets("letrasAplic").Cells(contLinha, 7) = vencimento
                                                            Sheets("letrasAplic").Cells(contLinha, 8) = indexador
                                                            Sheets("letrasAplic").Cells(contLinha, 9) = taxaAnual
                                                            Sheets("letrasAplic").Cells(contLinha, 10) = qtde
                                                            Sheets("letrasAplic").Cells(contLinha, 11) = puCompra
                                                            Sheets("letrasAplic").Cells(contLinha, 14) = corretora
                                                            
' reestabelece formato da coluna e classifica
                                                            Range("tabLetrasAplica|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Range("tabLetrasAplica|fffd||fffd|es[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                            Call letrasAplicClassificar
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE LCA/LCI - RECOMPRA
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                                            contLinha = 18
                                                            Do Until Sheets("letrasCarteira").Cells(contLinha, 3) = "" Or Sheets("letrasCarteira").Cells(contLinha, 3) = codigoLetra
                                                            contLinha = contLinha + 1
                                                            Loop
                                                            
' verifica|fffd||fffd|o de nova aplica|fffd||fffd|o e reaplica|fffd||fffd|o
                                                            If Sheets("letrasCarteira").Cells(contLinha, 3) = codigoLetra Then
                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RECOMPRA EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = emissor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                    contLinha = 20
                                                                    Else
                                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                    
                                                                End If
                                                                
' registra aplica|fffd||fffd|o na tabela de opera|fffd||fffd|es do caixa
                                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoLetra
                                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                                                
' reestabelece formato da coluna e classifica
                                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                Call carteiraCaixaClassificar
                                                                Call carteiraCaixaID
    
' finaliza registro de aplica|fffd||fffd|o e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                If data > validaData Then
                                                                    statusOperacao = "3"
                                                                    Else
                                                                    
                                                                    statusOperacao = "1"
                                                                
                                                                End If
                                                            
                                                                Sheets("letrasAplic").Cells(4, 14) = statusOperacao
                                                                
' bloqueia planilhas em uso
                                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                Sheets("letrasAplic").Activate
                                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                
                                                                Range("F5").Select
                                                                Call planAutoSave
                                                                MsgBox "Reaplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                Exit Sub
                                                                    
                                                                Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE LCA/LCI - NOVA APLICA|fffd||fffd|O
' registro de nova aplica|fffd||fffd|o na carteira de t|fffd|tulos
                                                                If Sheets("letrasCarteira").Cells(contLinha, 3) <> codigoLetra Then
                                                                    Do Until Sheets("letrasCarteira").Cells(contLinha, 3) = ""
                                                                    contLinha = contLinha + 1
                                                                    Loop
                                                                    
                                                                    Sheets("letrasCarteira").Cells(contLinha, 3) = codigoLetra
                                                                    
' atualiza saldo da LCA/LCI
                                                                    contLinha = 18
                                                                    Do Until Sheets("letrasCarteira").Cells(contLinha, 3) = codigoLetra
                                                                    contLinha = contLinha + 1
                                                                    Loop
                                                                    
                                                                    valorSaldo = Sheets("letrasCarteira").Cells(contLinha, 11)
                                                                    Sheets("letrasCarteira").Cells(contLinha, 11) = valorBruto + valorSaldo
                                                                    Range("tabLetrasCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                                    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                                    If Sheets("letrasCarteira").Cells(18, 3) <> "" And Sheets("letrasCarteira").Cells(19, 3) = "" Then
                                                                        Call letrasCarteiraAjustarGrafico
                                                                        Else
                                                                        
                                                                    End If
                                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA APLICA|fffd||fffd|O EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = emissor
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                        contLinha = 20
                                                                        Else
                                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                        
                                                                    End If
                                                                    
' registra aplica|fffd||fffd|o na tabela de opera|fffd||fffd|es do caixa
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoLetra
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
    
' reestabelece formato da coluna e classifica
                                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                                    Call carteiraCaixaClassificar
                                                                    Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de aplica|fffd||fffd|o e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

' verifica se ordem ser|fffd| para o mesmo dia ou posterior
                                                                    If data > validaData Then
                                                                        statusOperacao = "3"
                                                                        Else
                                                                        
                                                                        statusOperacao = "1"
                                                                    
                                                                    End If
                                                            
                                                                    Sheets("letrasAplic").Cells(4, 14) = statusOperacao
                                                                    
' bloqueia planilhas em uso
                                                                    Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                    Sheets("letrasAplic").Activate
                                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                                    
                                                                    Range("F5").Select
                                                                    Call planAutoSave
                                                                    MsgBox "Nova aplica|fffd||fffd|o efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                    Exit Sub
                                                                    
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub letrasAplicLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE APLICA|fffd||fffd|O
' reseta valores dos campos
    Sheets("letrasAplic").Cells(15, 5) = "0"
    Sheets("letrasAplic").Cells(16, 5) = "0"
    Sheets("letrasAplic").Cells(18, 5) = "0"
    
End Sub
Sub letrasAplicNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#Selecionar" And Range("E15") = 0 And Range("E16") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("letrasAplic").Unprotect
        
        If Range("E17") = "Erro" Then
            Range("E15") = "0"
            Range("E16") = "0"
            Range("E18") = "0"
            
' reseta valores dos campos
            Range("E13").FormulaR1C1 = "=TODAY()"
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("letrasAplic").Cells(5, 9) = "#Selecionar"
            Sheets("letrasAplic").Cells(5, 6) = "#Selecionar"
            Sheets("letrasAplic").Cells(3, 14) = "#Selecionar"
            Sheets("letrasAplic").Cells(6, 9) = "0"
            Sheets("letrasAplic").Cells(15, 5) = "0"
            Sheets("letrasAplic").Cells(16, 5) = "0"
            Sheets("letrasAplic").Cells(18, 5) = "0"
            Sheets("letrasAplic").Cells(4, 14) = "0"
            Sheets("letrasAplic").Cells(6, 6) = "#Selecionar"
            
            Range("F5").Select
            Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E13").FormulaR1C1 = "=TODAY()"
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("letrasAplic").Cells(4, 14) = "0"
            Sheets("letrasAplic").Cells(5, 9) = "#Selecionar"
            Sheets("letrasAplic").Cells(5, 6) = "#Selecionar"
            Sheets("letrasAplic").Cells(3, 14) = "#Selecionar"
            Sheets("letrasAplic").Cells(6, 9) = "0"
            Sheets("letrasAplic").Cells(15, 5) = "0"
            Sheets("letrasAplic").Cells(16, 5) = "0"
            Sheets("letrasAplic").Cells(18, 5) = "0"
            Sheets("letrasAplic").Cells(6, 6) = "#Selecionar"
            
            Range("F5").Select
            Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    
End Sub
Sub letrasAplicFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA APLICA|fffd||fffd|ES DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoLetra = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoLetra = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoLetra = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("letrasAplic").Unprotect
                Range("tabLetrasAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabLetrasAplica|fffd||fffd|es").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("letrasAplic").Cells(contLinha, 3) = "" Or Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra
                contLinha = contLinha + 1
                Loop
                
                If Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra Then
                    Sheets("letrasAplic").Unprotect
                    Range("tabLetrasAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabLetrasAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=codigoLetra
                    
                    Sheets("letrasAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada para " & codigoLetra & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("letrasAplic").Cells(contLinha, 3) = "" Or Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra
                contLinha = contLinha + 1
                Loop
                
                If Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra Then
                    Sheets("letrasAplic").Unprotect
                    Range("tabLetrasAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabLetrasAplica|fffd||fffd|es").Range.AutoFilter Field:=2, Criteria1:=codigoLetra
                    
                    Sheets("letrasAplic").Cells(21, 14) = "Limpar filtro"
                    Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    MsgBox "Nenhuma aplica|fffd||fffd|o realizada para " & codigoLetra & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub letrasAplicLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE APLICA|fffd||fffd|ES
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("letrasAplic").Unprotect
        Range("tabLetrasAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabLetrasAplica|fffd||fffd|es").Range.AutoFilter Field:=1
        
        Sheets("letrasAplic").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub letrasAplicClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE APLICA|fffd||fffd|ES
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("letrasAplic").ListObjects("tabLetrasAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("letrasAplic").ListObjects("tabLetrasAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabLetrasAplica|fffd||fffd|es[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("letrasAplic").ListObjects("tabLetrasAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de aplica|fffd||fffd|o
    ActiveWorkbook.Worksheets("letrasAplic").ListObjects("tabLetrasAplica|fffd||fffd|es").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("letrasAplic").ListObjects("tabLetrasAplica|fffd||fffd|es").Sort. _
        SortFields.Add Key:=Range("tabLetrasAplica|fffd||fffd|es[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("letrasAplic").ListObjects("tabLetrasAplica|fffd||fffd|es").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub



Attribute VB_Name = "M_LetrasCarteira"
Sub letrasCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  CARTEIRA
' vari|fffd|veis
    codigoAtivo = UCase(Sheets("letrasCarteira").Range("H5"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo
    logoLetra = ThisWorkbook.Path & "\imagery\bancos\" & codigoAtivo & ".jpg"
    Sheets("letrasCarteira").logoField.Picture = LoadPicture(logoLetra)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoLetra = ThisWorkbook.Path & "\imagery\bancos\_none.jpg"
        Sheets("letrasCarteira").logoField.Picture = LoadPicture(logoLetra)
    
    End If
    
End Sub
Sub letrasAplicLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO APLICA|fffd||fffd|ES
' vari|fffd|veis
    codigoAtivo = UCase(Range("F6"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoLetra = ThisWorkbook.Path & "\imagery\bancos\" & codigoAtivo & ".jpg"
    Sheets("letrasAplic").logoField.Picture = LoadPicture(logoLetra)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoLetra = ThisWorkbook.Path & "\imagery\bancos\_none.jpg"
        Sheets("letrasAplic").logoField.Picture = LoadPicture(logoLetra)
    
    End If
    
End Sub
Sub letrasResgatesLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO RESGATES
' vari|fffd|veis
    codigoAtivo = UCase(Range("F7"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoLetra = ThisWorkbook.Path & "\imagery\bancos\" & codigoAtivo & ".jpg"
    Sheets("letrasResgates").logoField.Picture = LoadPicture(logoLetra)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoLetra = ThisWorkbook.Path & "\imagery\bancos\_none.jpg"
        Sheets("letrasResgates").logoField.Picture = LoadPicture(logoLetra)
    
    End If
    
End Sub
Sub letrasLinkBancoData()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE BANCO DATA
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkBcoData = Range("N8")
    
' valida link e acessa site Banco Data
    If Range("H4") = "Selecione o emissor do t|fffd|tulo" Then
        MsgBox "Nenhum t|fffd|tulo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkBcoData = "" Or linkBcoData = "Link indispon|fffd|vel" Or linkBcoData = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkBcoData
            Exit Sub
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub letrasLinkInstituicao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DA INSTITUI|fffd||fffd|O
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkInst = Range("N7")
    
' valida link e acessa site da institui|fffd||fffd|o
    If Range("H4") = "Selecione o emissor do t|fffd|tulo" Then
        MsgBox "Nenhum t|fffd|tulo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkInst = "" Or linkInst = "Link indispon|fffd|vel" Or linkInst = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkInst
            
        End If
    End If
    
errorHandler:
    MsgBox "Ops! Parece que esse link n|fffd|o est|fffd| mais dispon|fffd|vel. Recomendamos que atualize sua base de dados na op|fffd||fffd|o CONFIGURA|fffd||fffd|ES > BANCO DE DADOS.", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub

End Sub
Sub letrasCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        ActiveSheet.Unprotect
        ActiveSheet.Shapes.Range(Array("grfLetrasVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfLetrasAnal|fffd|tico")).Visible = False
        Sheets("letrasCarteira").Cells(15, 3) = "Volum|fffd|trico"
        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            ActiveSheet.Unprotect
            ActiveSheet.Shapes.Range(Array("grfLetrasVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfLetrasAnal|fffd|tico")).Visible = True
            Sheets("letrasCarteira").Cells(15, 3) = "Anal|fffd|tico"
            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub letrasCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("letrasCarteira").Unprotect
    Sheets("letrasCarteira").ChartObjects("grfLetrasVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabLetrasCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub letrasCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call letrasCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("letrasCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfLetrasAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("letrasCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("letrasCarteira").Unprotect

                ActiveSheet.ChartObjects("grfLetrasAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfLetrasAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("letrasCarteira").Cells(4, 3) = "Com identificador"
                Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub letrasCarteiraReaplicacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS RENT|fffd|VEL PARA REAPLICA|fffd||fffd|O
' vari|fffd|veis
    emissor = Range("H5")

' valida c|fffd|digo para reaplica|fffd||fffd|o
    If emissor = "" Or emissor = "#C|fffd|digo" Or emissor = "#Selecionar" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de aplica|fffd||fffd|o
    MsgBox emissor
        Sheets("letrasAplic").Select
        Sheets("letrasAplic").Cells(6, 6) = emissor

    End If
    
End Sub
Sub letrasCarteiraLiquidarTitulos()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA TAXAS DE RENTABILIDADE
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("letrasCarteira").Cells(18, 3) = "" Then
        Sheets("letrasCarteira").Unprotect
        Range("F3") = 0
        Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida status de t|fffd|tulos comprados
    If Range("N16") = "AJUSTAR SALDO" Then
        Sheets("letrasCarteira").Unprotect
        Sheets("letrasCarteira").Cells(16, 12) = "SALVAR ALTERA|fffd||fffd|ES"
        Range("tabLetrasCarteira[Saldo]").Locked = False
        Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Range("K18").Select
        Else
        
        If Range("N16") = "SALVAR ALTERA|fffd||fffd|ES" Then
            Sheets("letrasCarteira").Unprotect
            Sheets("letrasCarteira").Cells(16, 12) = ""
            Range("tabLetrasCarteira").Locked = True
            Range("J16") = Range("A1")
            Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Call planAutoSave
            MsgBox "Dados atualizados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
'*************************************************************************************************************************** LIQUIDA T|fffd|TULOS VENCIDOS
' loop para encontrar t|fffd|tulos liquidados
            contLinha = 18
            Do Until Sheets("letrasCarteira").Cells(contLinha, 3) = "" Or Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO"
            contLinha = contLinha + 1
            Loop
            
            If Sheets("letrasCarteira").Cells(contLinha, 3) = "" Or Sheets("letrasCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Then
                MsgBox "Nenhum t|fffd|tulo dispon|fffd|vel para liquida|fffd||fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                    
' vari|fffd|veis
                    codigoAtivo = Sheets("letrasCarteira").Cells(contLinha, 3)
                    nomeAtivo = Sheets("letrasCarteira").Cells(contLinha, 4) & " " & Sheets("letrasCarteira").Cells(contLinha, 6) * 100 & "%" & _
                    " " & Sheets("letrasCarteira").Cells(contLinha, 5)
    
' confirma|fffd||fffd|o e execu|fffd||fffd|o da liquida|fffd||fffd|o
                    Dim confirmaLiquidacao As VbMsgBoxResult
                    confirmaLiquidacao = MsgBox("Deseja realizar a liquida|fffd||fffd|o de " & nomeAtivo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaLiquidacao = vbNo Then
                        Exit Sub
                        Else
                        
' envia ativo para tela de resgate
                        Sheets("letrasResgates").Cells(6, 6) = codigoAtivo
                        Sheets("letrasResgates").Activate
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub




Attribute VB_Name = "M_LetrasResgates"
Sub letrasResgatesRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE RESGATE
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Range("H4") = "T|fffd|tulo resgatado" Then
            MsgBox "Esta ordem de resgate j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
            Sheets("letrasResgates").Unprotect
            statusOperacao = "2"
            Sheets("letrasResgates").Cells(4, 14) = statusOperacao
            Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            
        End If
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("letrasResgates").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    letra = Range("H4")
    emissor = Range("F7")
    qtde = Range("E14")
    vencimento = Range("E17")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")
    status = Range("J10")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de resgate
    data = Range("E12")
    codigoLetra = UCase(Range("F6"))
    pmCompra = Range("H13")

' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Resgate de Ativos"
    origem = emissor
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde

' vari|fffd|veis para ordens pendentes
    tipoInvest = "LCA/LCI"
    tipoOrdem = Range("E13")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de resgate j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("letrasResgates").Unprotect
        statusOperacao = "2"
        Sheets("letrasResgates").Cells(4, 14) = statusOperacao
        Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If letra = "Selecione o t|fffd|tulo" Or letra = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de t|fffd|tulos inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de t|fffd|tulos indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                    
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If valorVenda <= 0 Then
                                MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E18").Activate
                                Exit Sub
                                Else
                                
                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    If status <> "LIQUIDADO" Then
                                        MsgBox "O t|fffd|tulo selecionado ainda n|fffd|o est|fffd| dispon|fffd|vel para resgate.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("F6").Activate
                                        Exit Sub
                                        Else
                                        
                                        If data > Range("A1") Then
                                            MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("E12").Activate
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para resgate
                                            Dim confirmaResgate As VbMsgBoxResult
                                            confirmaResgate = MsgBox("Deseja confirmar o resgate de " & letra & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                            
                                            If confirmaResgate = vbNo Then
                                                Exit Sub
                                                Else
                                                
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE SEM PREJU|fffd|ZO
' alerta de resgate sem preju|fffd|zo
                                                If alertaPrejuizo >= "0" Then
    
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("letrasResgates").Unprotect
                                                    Sheets("letrasCarteira").Unprotect
                                                    
' loop para localizar linha vazia
                                                    If Sheets("letrasResgates").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("letrasResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("letrasResgates").Cells(contLinha, 3) = data
                                                    Sheets("letrasResgates").Cells(contLinha, 4) = codigoLetra
                                                    Sheets("letrasResgates").Cells(contLinha, 6) = vencimento
                                                    Sheets("letrasResgates").Cells(contLinha, 9) = pmCompra
                                                    Sheets("letrasResgates").Cells(contLinha, 8) = puVenda
                                                    Sheets("letrasResgates").Cells(contLinha, 7) = qtde
                                                    Sheets("letrasResgates").Cells(contLinha, 11) = valorVenda
                                                    Sheets("letrasResgates").Cells(contLinha, 14) = ghostCell & corretora
    
' reestabelece formato da coluna e classifica
                                                    Range("tabLetrasResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call letrasResgatesClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS EM RESGATE PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("letrasCarteira").Cells(contLinha, 9) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
                                                    
                                                    If Sheets("letrasCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Or Sheets("letrasCarteira").Cells(contLinha, 9) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoLetra
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
                                                        
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                        statusOperacao = "1"
                                                        Sheets("letrasResgates").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("letrasResgates").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS EM RESGATE TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("letrasResgates").Unprotect
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("letrasAplic").Unprotect
                                                        Sheets("letrasCarteira").Unprotect
                                                        
' localiza linha com status "LIQUIDADO" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("letrasCarteira").Cells(contLinha, 9) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de resgate total
                                                        If Sheets("letrasCarteira").Cells(contLinha, 3) = codigoLetra And Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                                                            Sheets("letrasCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO T|fffd|TULO LIQUIDADO
' deleta compras realizadas com o c|fffd|digo do ativo LIQUIDADO
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("letrasAplic").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra Then
                                                            Sheets("letrasAplic").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                            
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoLetra
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
    
                                                        statusOperacao = "1"
                                                        Sheets("letrasResgates").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("letrasResgates").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                    End If
                                                    Else
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE RESGATE COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de resgate com preju|fffd|zo
                                                    validaPrejuizo = MsgBox("Este resgate causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                    
                                                    If validaPrejuizo = vbNo Then
                                                        Exit Sub
                                                        Else
                                                        
'*************************************************************************************************************************** REGISTRA RESGATE NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("letrasCarteira").Unprotect
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("letrasResgates").Unprotect
    
' loop para localizar linha vazia
                                                        If Sheets("letrasResgates").Cells(23, 3) = "" Then
                                                            contLinha = 23
                                                            Else
                                                            contLinha = Sheets("letrasResgates").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra dados na tabela
                                                        Sheets("letrasResgates").Cells(contLinha, 3) = data
                                                        Sheets("letrasResgates").Cells(contLinha, 4) = codigoLetra
                                                        Sheets("letrasResgates").Cells(contLinha, 6) = vencimento
                                                        Sheets("letrasResgates").Cells(contLinha, 8) = puVenda
                                                        Sheets("letrasResgates").Cells(contLinha, 9) = pmCompra
                                                        Sheets("letrasResgates").Cells(contLinha, 11) = valorVenda
                                                        Sheets("letrasResgates").Cells(contLinha, 7) = qtde
                                                        Sheets("letrasResgates").Cells(contLinha, 14) = ghostCell & corretora
    
' reestabelece formato da coluna e classifica
                                                        Range("tabLetrasResgates[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call letrasResgatesClassificar
                                                        
' ajusta ghostcell
                                                        Call ajustaGhostCell
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS EM RESGATE PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "LIQUIDADO" na carteira
                                                        contLinha = 18
                                                        Do Until Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("letrasCarteira").Cells(contLinha, 9) = 0
                                                        contLinha = contLinha + 1
                                                        Loop
                                                        
                                                        If Sheets("letrasCarteira").Cells(contLinha, 13) <> "LIQUIDADO" Or Sheets("letrasCarteira").Cells(contLinha, 9) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                contLinha = 20
                                                                Else
                                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
' registra resgate na tabela de opera|fffd||fffd|es do caixa
                                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoLetra
                                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call carteiraCaixaClassificar
                                                            Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de resgate e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                            statusOperacao = "1"
                                                            Sheets("letrasResgates").Cells(4, 14) = statusOperacao
    
' bloqueia planilhas em uso
                                                            Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("letrasResgates").Activate
                                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            
                                                            Range("F5").Select
                                                            Call planAutoSave
                                                            MsgBox "Resgate parcial efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            
                                                            Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS - RESGATE TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                            Sheets("carteiraCaixa").Unprotect
                                                            Sheets("letrasResgates").Unprotect
                                                            Sheets("letrasAplic").Unprotect
                                                            Sheets("letrasCarteira").Unprotect
                                                            
' localiza linha com status "LIQUIDADO" na carteira
                                                            contLinha = 18
                                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                                            Do Until Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Or Sheets("letrasCarteira").Cells(contLinha, 9) = 0
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                            If Sheets("letrasCarteira").Cells(contLinha, 3) = codigoLetra And Sheets("letrasCarteira").Cells(contLinha, 13) = "LIQUIDADO" Then
                                                                Sheets("letrasCarteira").Activate
                                                                Cells(contLinha, 3).Select
                                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                                Else
                                                            
                                                            End If
                                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE APLICA|fffd||fffd|ES EFETUADAS DO T|fffd|TULO LIQUIDADO
' deleta compras realizadas com o c|fffd|digo do ativo LIQUIDADO
                                                            contLinha = 23
                                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                                            Do Until Sheets("letrasAplic").Cells(contLinha, 3) = ""
                                                            
                                                            If Sheets("letrasAplic").Cells(contLinha, 4) = codigoLetra Then
                                                                Sheets("letrasAplic").Activate
                                                                Cells(contLinha, 3).Select
                                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                                
                                                                Else
                                                                contLinha = contLinha + 1
                                                                tabLinha = tabLinha + 1
                                                                
                                                            End If
                                                            Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RESGATE TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Resgate de Ativos"
' origem = emissor
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                                contLinha = 20
                                                                Else
                                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoLetra
                                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call carteiraCaixaClassificar
                                                            Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                        
                                                            statusOperacao = "1"
                                                            Sheets("letrasResgates").Cells(4, 14) = statusOperacao
                                                            
' bloqueia planilhas em uso
                                                            Sheets("letrasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("letrasResgates").Activate
                                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            
                                                            Range("F5").Select
                                                            Call planAutoSave
                                                            MsgBox "Resgate total efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub letrasResgatesLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE RESGATE
' reseta valores dos campos
    Sheets("letrasResgates").Cells(14, 5) = "0"
    Sheets("letrasResgates").Cells(15, 5) = "0"
    Sheets("letrasResgates").Cells(18, 5) = "0"
    
End Sub
Sub letrasResgatesNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("letrasResgates").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("letrasResgates").Cells(5, 6) = "#Selecionar"
            Sheets("letrasResgates").Cells(6, 6) = "#C|fffd|digo"
            Sheets("letrasResgates").Cells(14, 5) = "0"
            Sheets("letrasResgates").Cells(15, 5) = "0"
            Sheets("letrasResgates").Cells(18, 5) = "0"
            Sheets("letrasResgates").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("letrasResgates").Cells(5, 6) = "#Selecionar"
            Sheets("letrasResgates").Cells(6, 6) = "#C|fffd|digo"
            Sheets("letrasResgates").Cells(14, 5) = "0"
            Sheets("letrasResgates").Cells(15, 5) = "0"
            Sheets("letrasResgates").Cells(18, 5) = "0"
            Sheets("letrasResgates").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub letrasLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("letrasResgates").Cells(23, 3) = "" Then
        MsgBox "Nenhum resgate total registrado at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de resgates totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("letrasResgates").Unprotect
            
            Do Until Sheets("letrasResgates").Cells(contLinha, 3) = ""
            If Sheets("letrasResgates").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("letrasResgates").Activate
                Sheets("letrasResgates").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de resgates removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub letrasResgatesFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RESGATES DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoLetra = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoLetra = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoLetra = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("letrasResgates").Unprotect
                Range("tabLetrasResgates[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabLetrasResgates").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("letrasResgates").Cells(contLinha, 3) = "" Or Sheets("letrasResgates").Cells(contLinha, 4) = codigoLetra
                contLinha = contLinha + 1
                Loop
                
                If Sheets("letrasResgates").Cells(contLinha, 4) = codigoLetra Then
                    Sheets("letrasResgates").Unprotect
                    Range("tabLetrasResgates[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabLetrasResgates").Range.AutoFilter Field:=2, Criteria1:=codigoLetra
                    
                    Sheets("letrasResgates").Cells(21, 14) = "Limpar filtro"
                    Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum resgate realizado para " & codigoLetra & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("letrasResgates").Cells(contLinha, 3) = "" Or Sheets("letrasResgates").Cells(contLinha, 4) = codigoLetra
                contLinha = contLinha + 1
                Loop
                
                If Sheets("letrasResgates").Cells(contLinha, 4) = codigoLetra Then
                    Sheets("letrasResgates").Unprotect
                    Range("tabLetrasResgates[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabLetrasResgates").Range.AutoFilter Field:=2, Criteria1:=codigoLetra
                    
                    Sheets("letrasResgates").Cells(21, 14) = "Limpar filtro"
                    Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    MsgBox "Nenhum resgate realizado para " & codigoLetra & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub letrasResgatesLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RESGATES
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("letrasResgates").Unprotect
        Range("tabLetrasResgates[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabLetrasResgates").Range.AutoFilter Field:=1
        
        Sheets("letrasResgates").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("letrasResgates").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub letrasResgatesClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("letrasResgates").ListObjects("tabLetrasResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("letrasResgates").ListObjects("tabLetrasResgates").Sort. _
        SortFields.Add Key:=Range("tabLetrasResgates[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("letrasResgates").ListObjects("tabLetrasResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("letrasResgates").ListObjects("tabLetrasResgates").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("letrasResgates").ListObjects("tabLetrasResgates").Sort. _
        SortFields.Add Key:=Range("tabLetrasResgates[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("letrasResgates").ListObjects("tabLetrasResgates").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub




Attribute VB_Name = "M_MercadoBenchmarks"
Sub mercadoBenchmarksEditar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O DE INDICADORES DE MERCADO
' vari|fffd|veis
    mes = Sheets("carteiraAcompanha").Range("J1")
    ano = Sheets("carteiraAcompanha").Range("K1")
    periodo = mes & "/" & ano
    rentabBenchCarteira = Sheets("carteiraPosi|fffd||fffd|o").Cells(6, 10)
    rentabBenchAcoes = Sheets("a|fffd||fffd|esCarteira").Cells(5, 6)
    rentabBenchFIIs = Sheets("fiisCarteira").Cells(5, 6)
    rentabBenchTesouro = Sheets("tesouroCarteira").Cells(5, 6)
    
' verifica modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
    End If
    
' verifica se m|fffd|s corrente j|fffd| est|fffd| dispon|fffd|vel para edi|fffd||fffd|o
    contLinha = 18
    Do Until Sheets("mercadoBenchmarks").Cells(18, 3) = "" Or Sheets("mercadoBenchmarks").Cells(contLinha, 3) = "" Or _
    Month(Sheets("mercadoBenchmarks").Cells(18, 3)) & "/" & Year(Sheets("mercadoBenchmarks").Cells(18, 3)) = periodo
    contLinha = contLinha + 1
    Loop

' verifica status da tabela para libera|fffd||fffd|o
    If Range("N16") = "ATUALIZAR DADOS" Then
        If Sheets("mercadoBenchmarks").Cells(18, 3) = "" Then
            
' atualiza dados dispon|fffd|veis e libera edi|fffd||fffd|o de campos extras
            Sheets("mercadoBenchmarks").Unprotect
            Sheets("mercadoBenchmarks").Cells(contLinha, 3) = periodo
            Sheets("mercadoBenchmarks").Cells(contLinha, 4) = rentabBenchCarteira
            Sheets("mercadoBenchmarks").Cells(contLinha, 5) = rentabBenchAcoes
            Sheets("mercadoBenchmarks").Cells(contLinha, 6) = rentabBenchFIIs
            Sheets("mercadoBenchmarks").Cells(contLinha, 7) = rentabBenchTesouro
            Sheets("mercadoBenchmarks").Range(Cells(contLinha, 8), Cells(contLinha, 10)) = "0"
            
' libera campos de edi|fffd||fffd|o
            Range("tabMercadoBenchmarks[Ibovespa]").Locked = False
            Range("tabMercadoBenchmarks[IFIX]").Locked = False
            Range("tabMercadoBenchmarks[D|fffd|lar]").Locked = False
            
            Sheets("mercadoBenchmarks").Cells(16, 14) = "SALVAR ALTERA|fffd||fffd|ES"
            Range("tabMercadoBenchmarks[M|fffd|s]").NumberFormat = "mmm/yy"
            Call mercadoBenchmarksClassificar
            
            Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Range("H18").Select
            Exit Sub
            Else
            
' atualiza dados dispon|fffd|veis e libera edi|fffd||fffd|o de campos extras
            If Sheets("mercadoBenchmarks").Cells(contLinha, 3) = "" Then
                Sheets("mercadoBenchmarks").Unprotect
                Sheets("mercadoBenchmarks").Cells(contLinha, 3) = periodo
                Sheets("mercadoBenchmarks").Cells(contLinha, 4) = rentabBenchCarteira
                Sheets("mercadoBenchmarks").Cells(contLinha, 5) = rentabBenchAcoes
                Sheets("mercadoBenchmarks").Cells(contLinha, 6) = rentabBenchFIIs
                Sheets("mercadoBenchmarks").Cells(contLinha, 7) = rentabBenchTesouro
                Sheets("mercadoBenchmarks").Range(Cells(contLinha, 8), Cells(contLinha, 10)) = "0"
                
' libera campos de edi|fffd||fffd|o
                Range("tabMercadoBenchmarks[Ibovespa]").Locked = False
                Range("tabMercadoBenchmarks[IFIX]").Locked = False
                Range("tabMercadoBenchmarks[D|fffd|lar (Ptax)]").Locked = False
                
                Sheets("mercadoBenchmarks").Cells(16, 14) = "SALVAR ALTERA|fffd||fffd|ES"
                Range("tabMercadoBenchmarks[M|fffd|s]").NumberFormat = "mmm/yy"
                Call mercadoBenchmarksClassificar
                
                Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Range("H18").Select
                Exit Sub
                Else
                
' edita dados caso m|fffd|s corrente j|fffd| esteja dispon|fffd|vel
                If Month(Sheets("mercadoBenchmarks").Cells(18, 3)) & "/" & Year(Sheets("mercadoBenchmarks").Cells(18, 3)) = periodo Then
                    Sheets("mercadoBenchmarks").Unprotect
                    Sheets("mercadoBenchmarks").Cells(contLinha, 4) = rentabBenchCarteira
                    Sheets("mercadoBenchmarks").Cells(contLinha, 5) = rentabBenchAcoes
                    Sheets("mercadoBenchmarks").Cells(contLinha, 6) = rentabBenchFIIs
                    Sheets("mercadoBenchmarks").Cells(contLinha, 7) = rentabBenchTesouro
                    
' libera campos de edi|fffd||fffd|o
                    Range("tabMercadoBenchmarks[Ibovespa]").Locked = False
                    Range("tabMercadoBenchmarks[IFIX]").Locked = False
                    Range("tabMercadoBenchmarks[D|fffd|lar (Ptax)]").Locked = False
                    
                    Sheets("mercadoBenchmarks").Cells(16, 14) = "SALVAR ALTERA|fffd||fffd|ES"
                    Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("H18").Select
                    Exit Sub
                    
                End If
            End If
        End If
        Else
        
' salva altera|fffd||fffd|es e bloqueia edi|fffd||fffd|o
        Sheets("mercadoBenchmarks").Unprotect
        Range("tabMercadoBenchmarks").Locked = True
        Sheets("mercadoBenchmarks").Cells(16, 14) = "ATUALIZAR DADOS"
        Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Call planAutoSave
        MsgBox "Dados alterados com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
End Sub
Sub mercadoBenchmarksClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE BENCHMARKS
' classifica|fffd||fffd|o por ordem mensal decrescente
    ActiveWorkbook.Worksheets("mercadoBenchmarks").ListObjects("tabMercadoBenchmarks").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("mercadoBenchmarks").ListObjects("tabMercadoBenchmarks").Sort. _
        SortFields.Add Key:=Range("tabMercadoBenchmarks[[#Headers],[M|fffd|s]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("mercadoBenchmarks").ListObjects("tabMercadoBenchmarks").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_MercadoIndicadores"
Sub mercadoIndicadoresAtualizacaoCompleta()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA|fffd||fffd|O COMPLETA
' vari|fffd|veis
    tipoOpDatabase = "Atualiza|fffd||fffd|o Geral"
    
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Fun|fffd||fffd|o indispon|fffd|vel. O 'Modo Sigiloso' est|fffd| ativado.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
    End If
    
' confirma atualiza|fffd||fffd|o completa
    Dim confirmaAtualizacaoCompleta As VbMsgBoxResult
    confirmaAtualizacaoCompleta = MsgBox("Deseja confirmar a atualiza|fffd||fffd|o de dados?" & vbNewLine & "Isto levar|fffd| alguns minutos.", _
    vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaAtualizacaoCompleta = vbNo Then
        Exit Sub
        Else
        
' verifica tipo de conex|fffd|o
        Call IsConnected
        If temp = "Finalizar" Then
            temp = ""
            Exit Sub
            Else
            
' inicia contagem de tempo e abre conex|fffd|o database
            Sheets("mercadoIndicadores").Unprotect
            tempoInicial = TimeValue(Now)
            Call databaseUpdateCompleto
            
' retona para dados de mercado
            Sheets("mercadoIndicadores").Cells(3, 13) = DateValue(Now)
            Sheets("mercadoIndicadores").Cells(3, 14) = TimeValue(Now)
            
' finaliza contagem de tempo e opera|fffd||fffd|es
            Sheets("mercadoIndicadores").Activate
            Range("A1").Select
            
' finaliza contagem de tempo e opera|fffd||fffd|es
            tempoFinal = TimeValue(Now)
            tempoTotal = tempoFinal - tempoInicial
            
            Range("A1").Activate
            Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("carteiraPosi|fffd||fffd|o").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Call sysLogDatabase
            Call planAutoSave
            Application.StatusBar = ""
            MsgBox "Dados atualizados com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
    End If
    
End Sub
Sub mercadoIndicadoresAtualizacaoBolsas()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EURO
' confirma atualiza|fffd||fffd|o
    Dim confirmaAtualizacao  As VbMsgBoxResult
    confirmaAtualizacao = MsgBox("Deseja atualizar os Indicadores de Mercado?", vbQuestion + vbYesNo, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaAtualizacao = vbNo Then
        Exit Sub
        Else
        
' inicia contagem de tempo e abre conex|fffd|o database
        tempoInicial = Time
        Call databaseBolsas
        
' finaliza contagem de tempo e retorna para carteira de a|fffd||fffd|es
        Sheets("mercadoIndicadores").Activate
        
' verifica poss|fffd|vel ocorr|fffd|ncia de erro
        If temp = "erro" Then
            MsgBox "Servi|fffd|o temporariamente indispon|fffd|vel. Tente mais tarde.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        
        tempoFinal = Time
        tempoTotal = tempoFinal - tempoInicial
        
        Call planAutoSave
        Application.StatusBar = ""
        MsgBox "Indicadores de Mercado atualizados com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If

End Sub
Sub mercadoIndicadoresEditar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O DE INDICADORES
' vari|fffd|veis
    ano = Year(Range("A1"))
    
' valida status
    If Sheets("mercadoIndicadores").Cells(3, 6) = "Editar" Then
    
' libera edi|fffd||fffd|o de tabelas e seleciona ano corrente IGPM
        Sheets("mercadoIndicadores").Unprotect
        Sheets("databaseWebIndicadores").Unprotect
        Range("tabDatabaseIndicadoresIGPM").Locked = False
        Range("tabDatabaseIndicadoresIPCA").Locked = False
        Range("tabDatabaseIndicadoresSELIC").Locked = False
        Range("tabDatabaseIndicadoresCDI").Locked = False
        
        Sheets("databaseWebIndicadores").Shapes.Range(Array("btnEdi|fffd||fffd|o")).Visible = True
        Sheets("databaseWebIndicadores").Shapes.Range(Array("icoEditarIGPM", "icoEditarIPCA", "icoEditarSELIC", "icoEditarCDI")).Visible = False
        Sheets("databaseWebIndicadores").Shapes.Range(Array("icoCheckIGPM", "icoCheckIPCA", "icoCheckSELIC", "icoCheckCDI")).Visible = True
        
        contLinha = 5
        Do Until Sheets("databaseWebIndicadores").Cells(contLinha, 3) = ano
        contLinha = contLinha + 1
        Loop
        
' registra finaliza|fffd||fffd|o de edi|fffd||fffd|o em tabelas
        Sheets("mercadoIndicadores").Cells(3, 6) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(3, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(32, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(61, 5) = "Finalizar edi|fffd||fffd|o"
        Sheets("databaseWebIndicadores").Cells(90, 5) = "Finalizar edi|fffd||fffd|o"
        
        Sheets("databaseWebIndicadores").Activate
        Sheets("databaseWebIndicadores").Cells(contLinha, 4).Select
        Sheets("mercadoIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Sheets("databaseWebIndicadores").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        Else
        
        If Sheets("mercadoIndicadores").Cells(3, 6) = "Finalizar edi|fffd||fffd|o" Then
            MsgBox "A edi|fffd||fffd|o dos indicadores j|fffd| est|fffd| liberada; finalize-a.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Sheets("databaseWebIndicadores").Activate
            
        End If
    End If
    
End Sub

Attribute VB_Name = "M_MercadoNot|fffd|cias"
Sub mercadoNoticiasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO
' vari|fffd|veis
    tipoInvest = Range("E6")
    codigoAtivo = UCase(Range("E8"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' valida tipo de investimento
    If tipoInvest = "A|fffd||fffd|es" Then
    
' define logotipo a|fffd||fffd|es
        logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
        Sheets("mercadoNot|fffd|cias").logoField.Picture = LoadPicture(logoAcao)
        Exit Sub
        Else
        
        If tipoInvest = "Fundos Imobili|fffd|rios" Then
            logoFII = ThisWorkbook.Path & "\imagery\fiis\" & codigoAtivo & ".jpg"
            Sheets("mercadoNot|fffd|cias").logoField.Picture = LoadPicture(logoFII)
            Exit Sub
            
            Else
            logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
            Sheets("mercadoNot|fffd|cias").logoField.Picture = LoadPicture(logoAcao)
            Exit Sub
            
        End If
    End If
    
errorHandler:
    logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
    Sheets("a|fffd||fffd|esCompras").logoField.Picture = LoadPicture(logoAcao)
    
End Sub
Sub mercadoNoticiasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRO DOS DADOS DA NOT|fffd|CIA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' gerenciamento de erros
    On Error Resume Next
    
' valida campos com dados inv|fffd|lidos
    If Range("N9") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If Range("J7") = "Data indefinida" Then
            MsgBox "Selecione o tipo de not|fffd|cia a ser registrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
        
        End If
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("mercadoNot|fffd|cias").Cells(21, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis
    tipoNoticia = Range("E5")
    tipoInvest = Range("E6")
    data = Range("J5")
    dataLimite = Range("J6")
    codigoAtivo = UCase(Range("E8"))
    codigoAtivoConvert = UCase(Range("F8"))
    nomeAtivo = Range("E9")
    valorUnit = Range("J9")
    
    If tipoNoticia = "Leil|fffd|o" Then
        qtde = Range("J10")
        proporcao = 0
        Else
        qtde = Range("N8")
        proporcao = Range("J10")
        
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If tipoNoticia = "#Selecionar" Then
        MsgBox "Selecione o tipo de not|fffd|cia.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("E5").Activate
        Exit Sub
        Else
        
        If tipoInvest = "#Selecionar" Then
            MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("E6").Activate
            Exit Sub
            Else

            If codigoAtivo = "#C|fffd|DIGO" Or nomeAtivo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do ativo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("E8").Activate
                Exit Sub
                Else
                
                If tipoNoticia = "Ex-juros" And tipoInvest = "Fundos Imobili|fffd|rios" Or tipoNoticia = "Ex-dividendos" And tipoInvest = "Fundos Imobili|fffd|rios" Then
                    MsgBox "Tipo de registro inv|fffd|lido para Fundos Imobili|fffd|rios.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E5").Activate
                    Exit Sub
                    Else
                    
                    If tipoNoticia = "Convers|fffd|o" And codigoAtivo = "#C|fffd|DIGO" Or tipoNoticia = "Convers|fffd|o" And codigoAtivoConvert = "#C|fffd|DIGO" Then
                        MsgBox "Selecione o c|fffd|digo do ativo para o qual " & codigoAtivo & " ser|fffd| convertido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("F8").Activate
                        Exit Sub
                        Else
                        
                        If tipoNoticia = "Convers|fffd|o" And codigoAtivo = codigoAtivoConvert Then
                            MsgBox "Os c|fffd|digos dos ativos est|fffd|o iguais. Selecione outra op|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("F8").Activate
                            Exit Sub
                            Else
                            
                            If tipoNoticia = "Ex-juros" And valorUnit = "0" Or tipoNoticia = "Ex-dividendos" And valorUnit = "0" Then
                                MsgBox "Valor de recebimento inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("J9").Activate
                                Exit Sub
                                Else
                                
                                If tipoNoticia = "Leil|fffd|o" And qtde = 0 Or tipoNoticia = "Leil|fffd|o" And valorUnit = 0 Then
                                    MsgBox "Informe o valor unit|fffd|rio e a quantidade de ativos disponibilizados.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("J9").Activate
                                    Exit Sub
                                    Else
                                    
                                    If Range("J7") = "Prazo expirado" Then
                                        MsgBox "O prazo da not|fffd|cia indicada j|fffd| est|fffd| expirado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("J6").Activate
                                        Exit Sub
                                        Else
                                        
                                        If tipoNoticia = "Bonifica|fffd||fffd|o" And valorUnit <> "0" And proporcao = "0" Or tipoNoticia = "Bonifica|fffd||fffd|o" And valorUnit = "0" And proporcao <> "0" Or _
                                        tipoNoticia = "Esfor|fffd|os Restritos" And valorUnit <> "0" And proporcao = "0" Or tipoNoticia = "Esfor|fffd|os Restritos" And valorUnit = "0" And proporcao <> "0" Or _
                                        tipoNoticia = "Subscri|fffd||fffd|o" And valorUnit <> "0" And proporcao = "0" Or tipoNoticia = "Subscri|fffd||fffd|o" And valorUnit = "0" And proporcao <> "0" Or _
                                        valorUnit = "0" And proporcao = "0" Then
                                            MsgBox "Informe a propor|fffd||fffd|o para " & tipoNoticia & " e o valor por ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("J10").Activate
                                            Exit Sub
                                            Else
                                            
' verifica se not|fffd|cia j|fffd| est|fffd| cadastrada na tabela, evitando duplicidade
                                            contLinha = 17
                                            Do Until Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "" Or Sheets("mercadoNot|fffd|cias").Cells(contLinha, 7) = tipoNoticia And _
                                            Sheets("mercadoNot|fffd|cias").Cells(contLinha, 8) = codigoAtivo
                                            contLinha = contLinha + 1
                                            Loop
                                            
                                            If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 7) = tipoNoticia And Sheets("mercadoNot|fffd|cias").Cells(contLinha, 8) = codigoAtivo And _
                                            Sheets("mercadoNot|fffd|cias").Cells(contLinha, 10) = qtde Then
                                                MsgBox "A " & tipoNoticia & " de " & nomeAtivo & " j|fffd| est|fffd| cadastrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                            End If
                                            
'*************************************************************************************************************************** REGISTRO DE NOT|fffd|CIA
' confirma|fffd||fffd|o para registro dos dados
                                            Dim confirmaNoticia As VbMsgBoxResult
                                            
' valida tipo de not|fffd|cia e ajusta frase de confirma|fffd||fffd|o
                                            If tipoNoticia = "Convers|fffd|o" Then
                                                confirmaNoticia = MsgBox("Deseja confirmar o registro de " & tipoNoticia & " de " & nomeAtivo & " (" & codigoAtivo & " - " & codigoAtivoConvert & ")?", _
                                                vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                Else
                                                confirmaNoticia = MsgBox("Deseja confirmar o registro de " & tipoNoticia & " de " & nomeAtivo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                
                                            End If
                                            
' corrige valor de propor|fffd||fffd|o em caso de ex-juros e ex-dividendos
                                            If tipoNoticia = "Ex-juros" Or tipoNoticia = "Ex-dividendos" Then
                                                proporcao = 0
                                            End If
                                            
                                            If confirmaNoticia = vbNo Then
                                                Exit Sub
                                                Else
                                                
' localiza linha vazia na tabela de not|fffd|cias e registra dados
                                                Sheets("mercadoNot|fffd|cias").Unprotect
                                                
                                                If Sheets("mercadoNot|fffd|cias").Cells(17, 3) = "" Then
                                                    contLinha = 17
                                                    Else
                                                    contLinha = Sheets("mercadoNot|fffd|cias").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 4) = data
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 5) = dataLimite
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 6) = tipoInvest
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 7) = tipoNoticia
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 8) = codigoAtivo
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 10) = qtde
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 11) = valorUnit
                                                Sheets("mercadoNot|fffd|cias").Cells(contLinha, 13) = proporcao
                                                
' reestabelece formato das colunas e protege tabela
                                                Range("tabMercadoNot|fffd|cias[Data Registro]").NumberFormat = "dd/mm/yyyy"
                                                Range("tabMercadoNot|fffd|cias[Data Final]").NumberFormat = "dd/mm/yyyy"
                                                
                                                Call mercadoNoticiasClassificar
                                                Range("E5").Select
                                                Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
' valida modo de registro |fffd|nico ou sequencial
                                                If Range("N3") = "|fffd|nico" Then
                                                    Call planAutoSave
                                                    MsgBox "Not|fffd|cia registrada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    Else
                                                    
                                                    Call mercadoNoticiasNovoRegistro
                                                    MsgBox "Not|fffd|cia registrada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                                
' finaliza|fffd||fffd|o geral
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub mercadoNoticiasNovoRegistro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA NOT|fffd|CIA
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E8") = "#C|fffd|digo" And Range("J5") = Range("J6") And Range("J9") = 0 And Range("J10") = 0 Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("mercadoNot|fffd|cias").Unprotect
        
        Range("J5").FormulaR1C1 = "=TODAY()"
        Range("J6").FormulaR1C1 = "=TODAY()"
        Sheets("mercadoNot|fffd|cias").Cells(5, 5) = "#Selecionar"
        Sheets("mercadoNot|fffd|cias").Cells(6, 5) = "#Selecionar"
        Sheets("mercadoNot|fffd|cias").Cells(8, 5) = "#C|fffd|digo"
        Sheets("mercadoNot|fffd|cias").Cells(9, 10) = "0"
        Sheets("mercadoNot|fffd|cias").Cells(10, 10) = "0"
        
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
        Range("E5").Select
        Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    End If
    
End Sub
Sub mercadoNoticiasComprar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DIRECIONA COMPRA DE ATIVOS
' vari|fffd|veis
    tipoInvest = Range("E6")
    codigoAtivo = UCase(Range("E8"))

' valida|fffd||fffd|o geral
    If tipoInvest = "#Selecionar" Then
        MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

        If codigoAtivo = "#C|fffd|digo" Then
            MsgBox "Selecione o c|fffd|digo do ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else

' identifica tipo de investimento e direciona para compra
            If tipoInvest = "A|fffd||fffd|es" Then
                Sheets("a|fffd||fffd|esCompras").Select
                Sheets("a|fffd||fffd|esCompras").Cells(6, 6) = codigoAtivo
                
                Else
                If tipoInvest = "Fundos Imobili|fffd|rios" Then
                    Sheets("fiisCompras").Select
                    Sheets("fiisCompras").Cells(6, 6) = codigoAtivo
                    
                    Else
                    MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub mercadoNoticiasLimparHistorico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' verifica modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
    End If
    
' loop para localiza|fffd||fffd|o de status expirado
    contLinha = 17
    tabLinha = ((contLinha * -1) + 1) + contLinha
    Do Until Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "" Or Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "Expirado"
    contLinha = contLinha + 1
    tabLinha = tabLinha + 1
    Loop

    If contLinha = 17 And Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhum hist|fffd|rico dispon|fffd|vel para limpeza at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

        If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) <> "Expirado" Then
            MsgBox "Os eventos registrados ainda est|fffd|o em andamento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else

            If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "Expirado" Then

' confirma|fffd||fffd|o e execu|fffd||fffd|o da limpeza
                Dim confirmaLimpeza As VbMsgBoxResult
                confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de not|fffd|cias?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                
                If confirmaLimpeza = vbNo Then
                    Exit Sub
                    Else

' loop para limpeza de todas as linhas expiradas
                    Sheets("mercadoNot|fffd|cias").Unprotect

                    Do Until Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = ""
                    If Sheets("mercadoNot|fffd|cias").Cells(contLinha, 3) = "Expirado" Then
                        Sheets("mercadoNot|fffd|cias").Activate
                        Cells(contLinha, 3).Select
                        Selection.ListObject.ListRows(tabLinha).Delete
                        Else
                        
                        contLinha = contLinha + 1
                        tabLinha = tabLinha + 1
                    
                    End If
                    Loop
                    
' finaliza opera|fffd||fffd|es
                    Range("E5").Activate
                    Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
                    Call planAutoSave
                    MsgBox "Hist|fffd|rico de not|fffd|cias exclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                        
                End If
            End If
        End If
    End If
    
End Sub
Sub mercadoNoticiasClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE NOT|fffd|CIAS
' classifica|fffd||fffd|o decrescente por c|fffd|digo
    ActiveWorkbook.Worksheets("mercadoNot|fffd|cias").ListObjects("tabMercadoNot|fffd|cias").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("mercadoNot|fffd|cias").ListObjects("tabMercadoNot|fffd|cias").Sort. _
        SortFields.Add Key:=Range("tabMercadoNot|fffd|cias[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("mercadoNot|fffd|cias").ListObjects("tabMercadoNot|fffd|cias").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por data de not|fffd|cia
    ActiveWorkbook.Worksheets("mercadoNot|fffd|cias").ListObjects("tabMercadoNot|fffd|cias").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("mercadoNot|fffd|cias").ListObjects("tabMercadoNot|fffd|cias").Sort. _
        SortFields.Add Key:=Range("tabMercadoNot|fffd|cias[[#Headers],[Data Final]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("mercadoNot|fffd|cias").ListObjects("tabMercadoNot|fffd|cias").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_MoedasCarteira"
Sub moedasCarteiraAtualizarCotacoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA MOEDAS REUTERS
' gerenciamento de erros
    On Error GoTo errorHandler
    
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("moedasCarteira").Cells(18, 3) = "" Then
        Sheets("moedasCarteira").Unprotect
        Range("F3") = 0
        Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' valida quantidade de ativos em carteira
    If Sheets("moedasCarteira").Cells(18, 3) <> "" Then
        
' array e defini|fffd||fffd|es HTML
        Dim ws As Worksheet
        Dim XMLPage As New MSXML2.XMLHTTP60
        Dim HTML As New MSHTML.HTMLDocument
        Dim dadosReferencia() As String
        Dim elemento As MSHTML.IHTMLElement
        Dim conjElementos As MSHTML.IHTMLElementCollection
        
' vari|fffd|veis
        Set wsTemp = Sheets("moedasCarteira")
        tempCell = 18
        tempAtivo = wsTemp.Cells(tempCell, 3)
        
        Set ws = Sheets("databaseWebC|fffd|mbio")
        contLinha = 6
        codigoAtivo = ws.Cells(contLinha, 4)
        ws.Unprotect
        
        tempoInicial = TimeValue(Now)
        contDB = Range("tabMoedasCarteira").Rows.Count
        contUnit = 1
        
' loop para sincronizar ativo da carteira com a base de dados
        Do Until tempAtivo = ""
        
' acessa site
        XMLPage.Open "GET", "https://www.reuters.com/finance/currencies/quote?srcAmt=1&srcCurr=" & codigoAtivo & "&destAmt=&destCurr=BRL", False
        XMLPage.Send
        
' localiza dados no site e formata dados obtidos
        HTML.body.innerHTML = XMLPage.ResponseText
        Set conjElementos = HTML.getElementsByClassName("moduleBody")
        On Error Resume Next
        
        For Each elemento In conjElementos
            If elemento.className = "moduleBody" Then
                
                elemento.innerText = Replace(elemento.innerText, "Bid", "")
                elemento.innerText = Replace(elemento.innerText, "Offer", "")
                elemento.innerText = Replace(elemento.innerText, " ", "")
                elemento.innerText = Replace(elemento.innerText, vbNewLine, ";")
                elemento.innerText = Replace(elemento.innerText, "+", "")
                elemento.innerText = Replace(elemento.innerText, "--", "0,00")
                elemento.innerText = Replace(elemento.innerText, ",", "x")
                elemento.innerText = Replace(elemento.innerText, ".", ",")
                elemento.innerText = Replace(elemento.innerText, "x", ".")
                
' preenche dados na tabela
                dadosReferencia = Split(elemento.innerText, ";")
                ws.Cells(contLinha, 3) = dadosReferencia(0)
                ws.Cells(contLinha, 6) = "R$" & dadosReferencia(1)
                ws.Cells(contLinha, 7) = 0
                ws.Cells(contLinha, 8) = "R$" & dadosReferencia(4)
                ws.Cells(contLinha, 9) = "R$" & dadosReferencia(5)
                Exit For
                
            End If
        Next
    
' incrementa vari|fffd|veis
        contUnit = contUnit + 1
        
        tempCell = tempCell + 1
        tempAtivo = wsTemp.Cells(tempCell, 3)
        
        contLinha = contLinha + 1
        codigoAtivo = ws.Cells(contLinha, 4)
        
' atualiza status de atualiza|fffd||fffd|o
        If Round((contUnit / contDB * 100), 2) <= 100 Then
            Application.StatusBar = "     Atualizando C|fffd|mbio... " & Round((contUnit / contDB * 100), 2) & "%"
            Else
            Application.StatusBar = "     Atualizando C|fffd|mbio... 100%"
            
        End If
        Loop
        
' finaliza navegador e atualiza|fffd||fffd|es
        Application.StatusBar = "     Moedas Estrangeiras atualizadas com sucesso!"
        Application.StatusBar = ""
        
        tempoFinal = TimeValue(Now)
        tempoTotal = tempoFinal - tempoInicial
        ws.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
' define logotipo
        codigoAtivo = UCase(Sheets("moedasCarteira").Range("H4"))
        logoMoeda = ThisWorkbook.Path & "\imagery\moedas\" & codigoAtivo & ".jpg"
        Sheets("moedasCarteira").logoField.Picture = LoadPicture(logoMoeda)
        
        MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!" & vbNewLine & "(Tempo de execu|fffd||fffd|o: " & tempoTotal & ")", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        Dim validaCarteira As VbMsgBoxResult
        validaCarteira = MsgBox("Ops! Parece que voc|fffd| ainda n|fffd|o possui Moedas Estrangeiras em sua carteira. Deseja realizar a atualiza|fffd||fffd|o geral das cota|fffd||fffd|es?", _
        vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If validaCarteira = vbNo Then
            Exit Sub
            Else
            
            Call databaseCambio
            MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
errorHandler:
    Exit Sub
    MsgBox "Houve um erro inesperado durante a atualiza|fffd||fffd|o. Entre em contato com o administrador do sistema", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub moedasCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  CARTEIRA
' vari|fffd|veis
    codigoAtivo = UCase(Sheets("moedasCarteira").Range("H4"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo
    logoMoeda = ThisWorkbook.Path & "\imagery\moedas\" & codigoAtivo & ".jpg"
    Sheets("moedasCarteira").logoField.Picture = LoadPicture(logoMoeda)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoMoeda = ThisWorkbook.Path & "\imagery\moedas\_none.jpg"
        Sheets("moedasCarteira").logoField.Picture = LoadPicture(logoMoeda)
    
    End If
    
End Sub
Sub moedasComprasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO COMPRAS
' vari|fffd|veis
    codigoAtivo = UCase(Range("H4"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoMoeda = ThisWorkbook.Path & "\imagery\moedas\" & codigoAtivo & ".jpg"
    Sheets("moedasCompras").logoField.Picture = LoadPicture(logoMoeda)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoMoeda = ThisWorkbook.Path & "\imagery\moedas\_none.jpg"
        Sheets("moedasCompras").logoField.Picture = LoadPicture(logoMoeda)
    
    End If
    
End Sub
Sub moedasVendasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO VENDAS
' vari|fffd|veis
    codigoAtivo = UCase(Range("H4"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoMoeda = ThisWorkbook.Path & "\imagery\moedas\" & codigoAtivo & ".jpg"
    Sheets("moedasVendas").logoField.Picture = LoadPicture(logoMoeda)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoMoeda = ThisWorkbook.Path & "\imagery\moedas\_none.jpg"
        Sheets("moedasVendas").logoField.Picture = LoadPicture(logoMoeda)
    
    End If
    
End Sub
Sub moedasCarteiraAltGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        Sheets("moedasCarteira").Unprotect
        ActiveSheet.Shapes.Range(Array("grfMoedasVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfMoedasAnal|fffd|tico")).Visible = False
        Sheets("moedasCarteira").Cells(15, 3) = "Volum|fffd|trico"
        Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            Sheets("moedasCarteira").Unprotect
            ActiveSheet.Shapes.Range(Array("grfMoedasVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfMoedasAnal|fffd|tico")).Visible = True
            Sheets("moedasCarteira").Cells(15, 3) = "Anal|fffd|tico"
            Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub moedasCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("moedasCarteira").Unprotect
    Sheets("moedasCarteira").ChartObjects("grfMoedasVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabMoedasCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub moedasCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call moedasCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("moedasCarteira").Unprotect

' remove r|fffd|tudo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfMoedasAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            Sheets("moedasCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("moedasCarteira").Unprotect

                ActiveSheet.ChartObjects("grfMoedasAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfMoedasAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("moedasCarteira").Cells(4, 3) = "Com identificador"
                Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub moedasCarteiraRecompra()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS DESCONTADO PARA RECOMPRA
' vari|fffd|veis
    codigoMoeda = UCase(Range("H4"))

' valida c|fffd|digo para recompra
    If codigoMoeda = "#C|fffd|DIGO" Or codigoMoeda = "" Or codigoMoeda = "#SELECIONAR" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de compra
        Sheets("moedasCompras").Select
        Sheets("moedasCompras").Cells(6, 6) = codigoMoeda

    End If
    
End Sub
Attribute VB_Name = "M_MoedasCompras"
Sub moedasComprasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE COMPRA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("moedasCompras").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    loja = Range("F5")
    moeda = Range("H4")
    qtde = Range("E14")
    puCompra = Range("E15")
    valorCompra = Range("E18")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    data = Range("E12")
    codigoMoeda = UCase(Range("F6"))

' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Banc|fffd|ria"
    destino = "C|fffd|mbio"
    finalidade = "Aumento Patrimonial"
    valorBruto = puCompra * qtde
    tipoInvest = "Moedas Estrangeiras"
    tipoOrdem = Range("E13")
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de compra j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("moedasCompras").Unprotect
        statusOperacao = "2"
        Sheets("moedasCompras").Cells(4, 14) = statusOperacao
        Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If loja = "#Selecionar" Then
            MsgBox "Selecione uma loja de c|fffd|mbio.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If moeda = "Selecione a moeda" Or moeda = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo da moeda inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de moedas inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If puCompra <= "0" Then
                        MsgBox "Pre|fffd|o unit|fffd|rio da moeda inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E15").Activate
                        Exit Sub
                        Else
                        
                        If valorCompra <= "0" Then
                            MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E18").Activate
                            Exit Sub
                            Else
                            
                            If barraAlerta = "Ops! Aconteceu um erro:" Then
                                MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                If data > Range("A1") Then
                                    MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("E12").Activate
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                    Dim confirmaCompra As VbMsgBoxResult
                                    confirmaCompra = MsgBox("Deseja confirmar a compra de " & moeda & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                    
                                    If confirmaCompra = vbNo Then
                                        Exit Sub
                                        Else
                                    
'*************************************************************************************************************************** REGISTRA COMPRA NA TABELA
' desbloqueia planilhas em uso
                                        Sheets("carteiraCaixa").Unprotect
                                        Sheets("moedasCarteira").Unprotect
                                        Sheets("moedasCompras").Unprotect
                                    
' loop para localizar linha vazia
                                        If Sheets("moedasCompras").Cells(23, 3) = "" Then
                                            contLinha = 23
                                            Else
                                            contLinha = Sheets("moedasCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' registra dados na tabela
                                        Sheets("moedasCompras").Cells(contLinha, 3) = data
                                        Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda
                                        Sheets("moedasCompras").Cells(contLinha, 6) = "Esp|fffd|cie"
                                        Sheets("moedasCompras").Cells(contLinha, 7) = qtde
                                        Sheets("moedasCompras").Cells(contLinha, 8) = puCompra
                                        Sheets("moedasCompras").Cells(contLinha, 11) = valorCompra
                                        Sheets("moedasCompras").Cells(contLinha, 14) = loja
    
' reestabelece formato da coluna
                                        Range("tabMoedasCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call moedasComprasClassificar
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE MOEDAS - RECOMPRA
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                        contLinha = 18
                                        Do Until Sheets("moedasCarteira").Cells(contLinha, 3) = "" Or Sheets("moedasCarteira").Cells(contLinha, 3) = codigoMoeda
                                        contLinha = contLinha + 1
                                        Loop
                                        
' verifica|fffd||fffd|o de nova compra e recompra
                                        If Sheets("moedasCarteira").Cells(contLinha, 3) = codigoMoeda Then
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RECOMPRA EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Banc|fffd|ria"
' destino = "C|fffd|mbio"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                contLinha = 20
                                                Else
                                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoMoeda
                                            Sheets("carteiraCaixa").Cells(contLinha, 11) = loja
                                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
    
' reestabelece formato da coluna e classifica
                                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                            Call carteiraCaixaClassificar
                                            Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
                                            statusOperacao = "1"
                                            Sheets("moedasCompras").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
                                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            Sheets("moedasCompras").Activate
                                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Range("F5").Select
                                            Call planAutoSave
                                            MsgBox "Recompra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                            
                                            Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE MOEDAS - NOVA COMPRA
' registro de nova compra na carteira de moedas
                                            If Sheets("moedasCarteira").Cells(contLinha, 3) <> codigoMoeda Then
                                                Do Until Sheets("moedasCarteira").Cells(contLinha, 3) = ""
                                                contLinha = contLinha + 1
                                                Loop
                                                
                                                Sheets("moedasCarteira").Cells(contLinha, 3) = codigoMoeda
                                                
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                If Sheets("moedasCarteira").Cells(18, 3) <> "" And Sheets("moedasCarteira").Cells(19, 3) = "" Then
                                                    Call moedasCarteiraAjustarGrafico
                                                    Else
                                                    
                                                End If
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA COMPRA EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Bovespa (B3)"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoMoeda
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = loja
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra

' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
                                                statusOperacao = "1"
                                                Sheets("moedasCompras").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("moedasCompras").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Nova compra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
  
End Sub
Sub moedasComprasLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE COMPRA
' reseta valores dos campos
    Sheets("moedasCompras").Cells(14, 5) = "0"
    Sheets("moedasCompras").Cells(15, 5) = "0"
    Sheets("moedasCompras").Cells(18, 5) = "0"
    
End Sub
Sub moedasComprasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#ID" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("moedasCompras").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("moedasCompras").Cells(5, 6) = "#Selecionar"
            Sheets("moedasCompras").Cells(6, 6) = "#ID"
            Sheets("moedasCompras").Cells(14, 5) = "0"
            Sheets("moedasCompras").Cells(15, 5) = "0"
            Sheets("moedasCompras").Cells(18, 5) = "0"
            Sheets("moedasCompras").Cells(4, 14) = "0"
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("moedasCompras").Cells(5, 6) = "#Selecionar"
            Sheets("moedasCompras").Cells(6, 6) = "#ID"
            Sheets("moedasCompras").Cells(14, 5) = "0"
            Sheets("moedasCompras").Cells(15, 5) = "0"
            Sheets("moedasCompras").Cells(18, 5) = "0"
            Sheets("moedasCompras").Cells(4, 14) = "0"
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub moedasComprasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoMoeda = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoMoeda = "#ID" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoMoeda = "" Then
            Range("E21") = "#ID"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("moedasCompras").Unprotect
                Range("tabMoedasCompras[[#Headers],[ID]]").Select
                ActiveSheet.ListObjects("tabMoedasCompras").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("moedasCompras").Cells(contLinha, 3) = "" Or Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda
                contLinha = contLinha + 1
                Loop
                
                If Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda Then
                    Sheets("moedasCompras").Unprotect
                    Range("tabMoedasCompras[[#Headers],[ID]]").Select
                    ActiveSheet.ListObjects("tabMoedasCompras").Range.AutoFilter Field:=2, Criteria1:=codigoMoeda
                    
                    Sheets("moedasCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#ID"
                    Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma compra realizada para " & codigoMoeda & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("moedasCompras").Cells(contLinha, 3) = "" Or Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda
                contLinha = contLinha + 1
                Loop
                
                If Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda Then
                    Sheets("moedasCompras").Unprotect
                    Range("tabMoedasCompras[[#Headers],[ID]]").Select
                    ActiveSheet.ListObjects("tabMoedasCompras").Range.AutoFilter Field:=2, Criteria1:=codigoMoeda
                    
                    Sheets("moedasCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#ID"
                    MsgBox "Nenhuma compra realizada para " & codigoMoeda & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If

End Sub
Sub moedasComprasLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("moedasCompras").Unprotect
        Range("tabMoedasCompras[[#Headers],[ID]]").Select
        ActiveSheet.ListObjects("tabMoedasCompras").Range.AutoFilter Field:=1
        
        Sheets("moedasCompras").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#ID"
        Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub moedasComprasClassificar()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("moedasCompras").ListObjects("tabMoedasCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("moedasCompras").ListObjects("tabMoedasCompras").Sort. _
        SortFields.Add Key:=Range("tabMoedasCompras[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("moedasCompras").ListObjects("tabMoedasCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("moedasCompras").ListObjects("tabMoedasCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("moedasCompras").ListObjects("tabMoedasCompras").Sort. _
        SortFields.Add Key:=Range("tabMoedasCompras[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("moedasCompras").ListObjects("tabMoedasCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_MoedasVendas"
Sub moedasVendasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE VENDA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("moedasVendas").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    loja = Range("F5")
    moeda = Range("H4")
    qtde = Range("E14")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| loja
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de venda
    data = Range("E12")
    codigoMoeda = UCase(Range("F6"))
    pmCompra = Range("H13")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Venda de Ativos"
    origem = "C|fffd|mbio"
    destino = "Conta Banc|fffd|ria"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde
    
    tipoInvest = "Moedas Estrangeiras"
    tipoOrdem = Range("E13")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de venda j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("moedasVendas").Unprotect
        statusOperacao = "2"
        Sheets("moedasVendas").Cells(4, 14) = statusOperacao
        Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If loja = "#Selecionar" Then
            MsgBox "Selecione uma loja de c|fffd|mbio.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If moeda = "Selecione a moeda" Or moeda = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo da moeda inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de moedas inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de moedas indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                    
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio da moeda inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If valorVenda <= "0" Then
                                MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E18").Activate
                                Exit Sub
                                Else
                                
                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    If data > Range("A1") Then
                                        MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("E12").Activate
                                        Exit Sub
                                        Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para venda
                                        Dim confirmaVenda As VbMsgBoxResult
                                        confirmaVenda = MsgBox("Deseja confirmar a venda de " & moeda & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                        If confirmaVenda = vbNo Then
                                            Exit Sub
                                            Else
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA SEM PREJU|fffd|ZO
' alerta de venda sem preju|fffd|zo
                                            If alertaPrejuizo >= "0" Then
                                                
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("moedasCarteira").Unprotect
                                                Sheets("moedasVendas").Unprotect
    
' loop para localizar linha vazia
                                                If Sheets("moedasVendas").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("moedasVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra dados na tabela
                                                Sheets("moedasVendas").Cells(contLinha, 3) = data
                                                Sheets("moedasVendas").Cells(contLinha, 4) = codigoMoeda
                                                Sheets("moedasVendas").Cells(contLinha, 8) = puVenda
                                                Sheets("moedasVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("moedasVendas").Cells(contLinha, 7) = qtde
                                                Sheets("moedasVendas").Cells(contLinha, 11) = valorVenda
                                                Sheets("moedasVendas").Cells(contLinha, 14) = ghostCell & loja
        
' reestabelece formato da coluna
                                                Range("tabMoedasVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call moedasVendasClassificar
                                                
' ajusta ghostcell
                                                Call ajustaGhostCell
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE MOEDAS EM VENDA PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                contLinha = 18
                                                Do Until Sheets("moedasCarteira").Cells(contLinha, 13) = "Vendido" Or Sheets("moedasCarteira").Cells(contLinha, 7) = 0
                                                contLinha = contLinha + 1
                                                Loop
        
                                                If Sheets("moedasCarteira").Cells(contLinha, 13) <> "Vendido" Or Sheets("moedasCarteira").Cells(contLinha, 7) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "C|fffd|mbio"
' destino = "Conta Banc|fffd|ria"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoMoeda
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(loja, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("moedasVendas").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("moedasVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                    Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE MOEDAS EM VENDA TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("moedasVendas").Unprotect
                                                    Sheets("moedasCompras").Unprotect
                                                    Sheets("moedasCarteira").Unprotect
                                                
' localiza linha com status "vendido" na carteira
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    
                                                    Do Until Sheets("moedasCarteira").Cells(contLinha, 13) = "Vendido" Or Sheets("moedasCarteira").Cells(contLinha, 7) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                                
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    If Sheets("moedasCarteira").Cells(contLinha, 3) = codigoMoeda And Sheets("moedasCarteira").Cells(contLinha, 13) = "Vendido" Then
                                                        Sheets("moedasCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                    
                                                    End If
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DA MOEDA VENDIDA
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("moedasCompras").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda Then
                                                        Sheets("moedasCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "C|fffd|mbio"
' destino = loja
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoMoeda
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(loja, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
                                                    statusOperacao = "1"
                                                    Sheets("moedasVendas").Cells(4, 14) = statusOperacao
                                                    Call moedasVendasClassificar
                                                
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("moedasVendas").Activate
                                                    Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                                Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de venda com preju|fffd|zo
                                                    
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
                                                
'*************************************************************************************************************************** REGISTRA VENDA NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("moedasVendas").Unprotect
                                                    Sheets("moedasCarteira").Unprotect
    
' loop para localizar linha vazia
                                                    If Sheets("moedasVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("moedasVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("moedasVendas").Cells(contLinha, 3) = data
                                                    Sheets("moedasVendas").Cells(contLinha, 4) = codigoMoeda
                                                    Sheets("moedasVendas").Cells(contLinha, 8) = puVenda
                                                    Sheets("moedasVendas").Cells(contLinha, 9) = pmCompra
                                                    Sheets("moedasVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("moedasVendas").Cells(contLinha, 11) = valorVenda
                                                    Sheets("moedasVendas").Cells(contLinha, 14) = ghostCell & loja
                                                    
' reestabelece formato da coluna
                                                    Range("tabMoedasVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call moedasVendasClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE MOEDAS EM VENDA PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("moedasCarteira").Cells(contLinha, 13) = "Vendido" Or Sheets("moedasCarteira").Cells(contLinha, 7) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
            
                                                    If Sheets("moedasCarteira").Cells(contLinha, 13) <> "Vendido" Or Sheets("moedasCarteira").Cells(contLinha, 7) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "C|fffd|mbio"
' destino="Conta Banc|fffd|ria"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoMoeda
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(loja, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
                                                        statusOperacao = "1"
                                                        Sheets("moedasVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("moedasVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE MOEDAS - VENDA TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("moedasVendas").Unprotect
                                                        Sheets("moedasCompras").Unprotect
                                                        Sheets("moedasCarteira").Unprotect
                                                    
' localiza linha com status "vendido" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("moedasCarteira").Cells(contLinha, 13) = "Vendido" Or Sheets("moedasCarteira").Cells(contLinha, 7) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                        
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                        If Sheets("moedasCarteira").Cells(contLinha, 3) = codigoMoeda And Sheets("moedasCarteira").Cells(contLinha, 13) = "Vendido" Then
                                                            Sheets("moedasCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DA MOEDA VENDIDA
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("moedasCompras").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("moedasCompras").Cells(contLinha, 4) = codigoMoeda Then
                                                            Sheets("moedasCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                        
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "C|fffd|mbio"
' destino="Conta Banc|fffd|ria"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoMoeda
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(loja, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda

                                                        statusOperacao = "1"
                                                        Sheets("moedasVendas").Cells(4, 14) = statusOperacao
                                                        Call moedasVendasClassificar
                                                    
' bloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("moedasCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("moedasCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("moedasVendas").Activate
                                                        Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                    
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub moedasVendasLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE VENDA
' reseta valores dos campos
    Sheets("moedasVendas").Cells(14, 5) = "0"
    Sheets("moedasVendas").Cells(15, 5) = "0"
    Sheets("moedasVendas").Cells(18, 5) = "0"
    
End Sub
Sub moedasVendasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#ID" And Range("E14") = 0 And Range("E15") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("moedasVendas").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("moedasVendas").Cells(5, 6) = "#Selecionar"
            Sheets("moedasVendas").Cells(6, 6) = "#ID"
            Sheets("moedasVendas").Cells(14, 5) = "0"
            Sheets("moedasVendas").Cells(15, 5) = "0"
            Sheets("moedasVendas").Cells(18, 5) = "0"
            Sheets("moedasVendas").Cells(4, 14) = "0"
            
            Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("moedasVendas").Cells(5, 6) = "#Selecionar"
            Sheets("moedasVendas").Cells(6, 6) = "#ID"
            Sheets("moedasVendas").Cells(14, 5) = "0"
            Sheets("moedasVendas").Cells(15, 5) = "0"
            Sheets("moedasVendas").Cells(18, 5) = "0"
            Sheets("moedasVendas").Cells(4, 14) = "0"
            
            Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    
End Sub
Sub moedasLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("moedasVendas").Cells(23, 3) = "" Then
        MsgBox "Nenhuma venda total registrada at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de vendas totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("moedasVendas").Unprotect
            
            Do Until Sheets("moedasVendas").Cells(contLinha, 3) = ""
            If Sheets("moedasVendas").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("moedasVendas").Activate
                Sheets("moedasVendas").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de vendas removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub moedasVendasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA VENDAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoMoeda = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoMoeda = "#ID" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoMoeda = "" Then
            Range("E21") = "#ID"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("moedasVendas").Unprotect
                Range("tabMoedasVendas[[#Headers],[ID]]").Select
                ActiveSheet.ListObjects("tabMoedasVendas").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("moedasVendas").Cells(contLinha, 3) = "" Or Sheets("moedasVendas").Cells(contLinha, 4) = codigoMoeda
                contLinha = contLinha + 1
                Loop
                
                If Sheets("moedasVendas").Cells(contLinha, 4) = codigoMoeda Then
                    Sheets("moedasVendas").Unprotect
                    Range("tabMoedasVendas[[#Headers],[ID]]").Select
                    ActiveSheet.ListObjects("tabMoedasVendas").Range.AutoFilter Field:=2, Criteria1:=codigoMoeda
                    
                    Sheets("moedasVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#ID"
                    Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma venda realizada para " & codigoMoeda & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("moedasVendas").Cells(contLinha, 3) = "" Or Sheets("moedasVendas").Cells(contLinha, 4) = codigoMoeda
                contLinha = contLinha + 1
                Loop
                
                If Sheets("moedasVendas").Cells(contLinha, 4) = codigoMoeda Then
                    Sheets("moedasVendas").Unprotect
                    Range("tabMoedasVendas[[#Headers],[ID]]").Select
                    ActiveSheet.ListObjects("tabMoedasVendas").Range.AutoFilter Field:=2, Criteria1:=codigoMoeda
                
                    Sheets("moedasVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    Else
                    
                    Range("E21") = "#ID"
                    MsgBox "Nenhuma venda realizada para " & codigoMoeda & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub moedasVendasLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE VENDAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("moedasVendas").Unprotect
        Range("tabMoedasVendas[[#Headers],[ID]]").Select
        ActiveSheet.ListObjects("tabMoedasVendas").Range.AutoFilter Field:=1
        
        Sheets("moedasVendas").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#ID"
        Sheets("moedasVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub moedasVendasClassificar()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("moedasVendas").ListObjects("tabMoedasVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("moedasVendas").ListObjects("tabMoedasVendas").Sort. _
        SortFields.Add Key:=Range("tabMoedasVendas[[#Headers],[ID]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("moedasVendas").ListObjects("tabMoedasVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("moedasVendas").ListObjects("tabMoedasVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("moedasVendas").ListObjects("tabMoedasVendas").Sort. _
        SortFields.Add Key:=Range("tabMoedasVendas[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("moedasVendas").ListObjects("tabMoedasVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub



Attribute VB_Name = "M_OpEspeciais"
Sub opEspeciaisRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CADASTRO DE OPERA|fffd||fffd|ES ESPECIAIS
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("J7") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("opEspeciais").Cells(22, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis
    If Range("D10") = "" Then
        Else
        posicaoAtual = Range("E10")
    
    End If
    
    tipoOperacao = Range("E5")
    tipoInvest = Range("E6")
    data = Range("J5")
    dataLimite = Range("J6")
    codigoAtivo = UCase(Range("E8"))
    codigoAtivoConvert = UCase(Range("F8"))
    codigoAtivoUnit = UCase(Range("C13")) & "11"
    nomeAtivo = Range("E9")
    
    corretora = Range("M8")
    proporcao = Range("J8")
    valorUnit = Range("J9")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If tipoOperacao = "#Selecionar" Then
        MsgBox "Selecione o tipo de opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Range("E5").Activate
        Exit Sub
        Else
        
        If tipoInvest = "#Selecionar" Then
            MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("E6").Activate
            Exit Sub
            Else

            If Range("E5") = "#Selecionar" Or nomeAtivo = "Selecione o tipo de investimento" Then
                MsgBox "Selecione o tipo de investimento e o c|fffd|digo do ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("E5").Activate
                Exit Sub
                Else
                
                If codigoAtivo = "#C|fffd|DIGO" Or nomeAtivo = "C|fffd|digo inv|fffd|lido" Then
                    MsgBox "C|fffd|digo do ativo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E8").Activate
                    Exit Sub
                    Else
                    
                    If tipoOperacao <> "Altera|fffd||fffd|o de C|fffd|digo" And tipoOperacao <> "Subscri|fffd||fffd|o (+)" And tipoOperacao <> "Esfor|fffd|os Restritos (+)" And Range("E10") <= 0 Then
                        MsgBox "Voc|fffd| ainda n|fffd|o possui " & nomeAtivo & " em carteira.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E8").Activate
                        Exit Sub
                        Else
                        
                        If tipoOperacao = "Convers|fffd|o" And codigoAtivoConvert = "#C|fffd|DIGO" Then
                            MsgBox "Selecione o c|fffd|digo do ativo para o qual " & codigoAtivo & " ser|fffd| convertido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("F8").Activate
                            Exit Sub
                            Else
                            
                            If tipoOperacao = "Altera|fffd||fffd|o de C|fffd|digo" And codigoAtivoConvert = "#C|fffd|DIGO" Then
                                MsgBox "Selecione o c|fffd|digo do ativo para o qual " & codigoAtivo & " ser|fffd| alterado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("F8").Activate
                                Exit Sub
                                Else
                                
                                If tipoOperacao = "Convers|fffd|o" And codigoAtivo = codigoAtivoConvert Or tipoOperacao = "Altera|fffd||fffd|o de C|fffd|digo" And codigoAtivo = codigoAtivoConvert Then
                                    MsgBox "Os c|fffd|digos dos ativos est|fffd|o iguais. Selecione outra op|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Range("F8").Activate
                                    Exit Sub
                                    Else
                                    
                                    If tipoOperacao = "Unifica|fffd||fffd|o (Units)" And Range("J8") = 0 Or tipoOperacao = "Unifica|fffd||fffd|o (Units)" And Range("J9") = 0 Then
                                        MsgBox "Informe a propor|fffd||fffd|o de a|fffd||fffd|es ON e PN para unifica|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("J8").Activate
                                        Exit Sub
                                        Else
                                        
                                        If dataLimite = data And tipoOperacao <> "Altera|fffd||fffd|o de C|fffd|digo" And tipoOperacao <> "Convers|fffd|o" And tipoOperacao <> "Unifica|fffd||fffd|o (Units)" Then
                                            MsgBox "Informe a data prevista para execu|fffd||fffd|o da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Range("J6").Activate
                                            Exit Sub
                                            Else
                                            
' verifica se h|fffd| alguma edi|fffd||fffd|o em andamento
                                            If Sheets("opEspeciais").Cells(16, 12) = "SALVAR EDI|fffd||fffd|O" Then
                                                MsgBox "Ops! Parece que h|fffd| uma edi|fffd||fffd|o em andamento." & vbNewLine & "Finalize-a antes de continuar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                Else
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA|fffd||fffd|O DE C|fffd|DIGO
' procedimento especial de altera|fffd||fffd|o de c|fffd|digo
                                                If tipoOperacao = "Altera|fffd||fffd|o de C|fffd|digo" Then
                                                    
                                                    Dim confirmaAlteracao As VbMsgBoxResult
                                                    confirmaAlteracao = MsgBox("Deseja confirmar a altera|fffd||fffd|o de " & codigoAtivo & " para " & codigoAtivoConvert & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                    
                                                    If confirmaAlteracao = vbNo Then
                                                        Exit Sub
                                                        Else
                                                        
                                                        Call opEspeciaisAltCodigo
                                                        
                                                        Sheets("opEspeciais").Activate
                                                        Range("E8") = "#C|fffd|digo"
                                                        Range("E6") = "#Selecionar"
                                                        Range("E5") = "#Selecionar"
                                                        
                                                        Call planAutoSave
                                                        MsgBox "C|fffd|digo " & codigoAtivo & " alterado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                    End If
                                                    Else
                                                    
'*************************************************************************************************************************** UNIFICA|fffd||fffd|O DE UNITS
                                                    If tipoOperacao = "Unifica|fffd||fffd|o (Units)" Then
                                                        If Range("K10") = "Erro" Then
                                                            MsgBox "Ops! Parece que voc|fffd| ainda n|fffd|o possui a quantidade necess|fffd|ria de a|fffd||fffd|es para unifica|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            Else
                                                            
' valida campos para evitar duplicidade
                                                            contLinha = 18
                                                            Do Until Sheets("opEspeciais").Cells(contLinha, 3) = "" Or Sheets("opEspeciais").Cells(contLinha, 6) = tipoOperacao And _
                                                            Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo
                                                            contLinha = contLinha + 1
                                                            Loop
                                                            
                                                            If Sheets("opEspeciais").Cells(contLinha, 6) = tipoOperacao And Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                                                MsgBox "A opera|fffd||fffd|o indicada j|fffd| est|fffd| cadastrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                Exit Sub
                                                                
                                                            End If
                                                        End If
                                                        Else
                                                        
' finaliza procedimento de altera|fffd||fffd|o
'*************************************************************************************************************************** OPERA|fffd||fffd|ES DE SOBRAS (+)
                                                        If tipoOperacao = "Subscri|fffd||fffd|o (+)" Or tipoOperacao = "Esfor|fffd|os Restritos (+)" Then
                                                            If qtde = 0 Then
                                                                MsgBox "Informe a propor|fffd||fffd|o para " & tipoOperacao & " do ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                Exit Sub
                                                                Else
                                                                
' continua|fffd||fffd|o dos procedimentos
                                                                If proporcao = 0 Then
                                                                    MsgBox "Informe a propor|fffd||fffd|o para " & tipoOperacao & " do ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                    Exit Sub
                                                                    Else
                                                                    
                                                                    If valorUnit = 0 And tipoOperacao <> "Bonifica|fffd||fffd|o" Then
                                                                        MsgBox "Informe a cota|fffd||fffd|o base para " & tipoOperacao & " do ativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                        Exit Sub
                                                                        Else
                                                                        
' valida campos para evitar duplicidade
                                                                        contLinha = 18
                                                                        Do Until Sheets("opEspeciais").Cells(contLinha, 3) = "" Or Sheets("opEspeciais").Cells(contLinha, 6) = tipoOperacao And _
                                                                        Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo
                                                                        contLinha = contLinha + 1
                                                                        Loop
                                                                        
                                                                        If Sheets("opEspeciais").Cells(contLinha, 6) = tipoOperacao And Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                                                            MsgBox "A opera|fffd||fffd|o indicada j|fffd| est|fffd| cadastrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                                            Exit Sub
                                                                            
                                                                        End If
                                                                    End If
                                                                End If
                                                            End If
                                                        End If
                                                    End If
                                                End If
                                                
'*************************************************************************************************************************** REGISTRO DE DADOS
' confirma|fffd||fffd|o para registro dos dados
                                                Dim confirmaOperacao As VbMsgBoxResult
                                                confirmaOperacao = MsgBox("Confirma o registro de " & tipoOperacao & " de " & nomeAtivo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                
                                                If confirmaOperacao = vbNo Then
                                                    Exit Sub
                                                    Else
                                                    
' localiza linha vazia na tabela de not|fffd|cias e registra dados
                                                    Sheets("opEspeciais").Unprotect
                                                    
                                                    If Sheets("opEspeciais").Cells(18, 3) = "" Then
                                                        contLinha = 18
                                                        Else
                                                        contLinha = Sheets("opEspeciais").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("opEspeciais").Cells(contLinha, 3) = data
                                                    Sheets("opEspeciais").Cells(contLinha, 4) = dataLimite
                                                    Sheets("opEspeciais").Cells(contLinha, 5) = tipoInvest
                                                    
                                                    If tipoOperacao = "Convers|fffd|o" Then
                                                        Sheets("opEspeciais").Cells(contLinha, 6) = tipoOperacao & " " & codigoAtivoConvert
                                                        Else
                                                        Sheets("opEspeciais").Cells(contLinha, 6) = tipoOperacao
                                                        
                                                    End If
                                                    
                                                    Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo
                                                    Sheets("opEspeciais").Cells(contLinha, 9) = posicaoAtual
                                                    Sheets("opEspeciais").Cells(contLinha, 10) = proporcao
                                                    
                                                    If tipoOperacao = "Unifica|fffd||fffd|o (Units)" Then
                                                        Sheets("opEspeciais").Cells(contLinha, 12) = Range("J11")
                                                        Else
                                                        Sheets("opEspeciais").Cells(contLinha, 12) = valorUnit
                                                        
                                                    End If
                                                    
' reestabelece formato das colunas e protege tabela
                                                    Range("tabOpEspeciaisRegistros[Data Registro]").NumberFormat = "dd/mm/yyyy"
                                                    Range("tabOpEspeciaisRegistros[Data Exec.]").NumberFormat = "dd/mm/yyyy"
                                                    
                                                    Call opEspeciaisClassificar
                                                    Call opEspeciaisNovaOperacao
                                                    
                                                    Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
' finaliza|fffd||fffd|o geral
                                                    Range("E5").Select
                                                    Call planAutoSave
                                                    MsgBox "Registro de " & tipoOperacao & " efetuado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub opEspeciaisRemoverOperacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMO|fffd||fffd|O DE ATIVO INDICADO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| alguma edi|fffd||fffd|o em andamento
    If Sheets("opEspeciais").Cells(16, 12) = "SALVAR EDI|fffd||fffd|O" Then
        MsgBox "Ops! Parece que h|fffd| uma edi|fffd||fffd|o em andamento." & vbNewLine & "Finalize-a antes de continuar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' identifica ativo selecionado para remo|fffd||fffd|o
        contLinha = 18
        codigoAtivo = UCase(Range("F16"))
        
        If codigoAtivo = "#C|fffd|DIGO" Or codigoAtivo = "" Then
            MsgBox "Selecione um ativo para remo|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            Do Until Sheets("opEspeciais").Cells(contLinha, 3) = "" Or Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo
            contLinha = contLinha + 1
            Loop
            
' verifica se h|fffd| edi|fffd||fffd|o em andamento
            If Range("L16") = "SALVAR EDI|fffd||fffd|O" Then
                MsgBox "Ops! Parece que existe uma edi|fffd||fffd|o em andamento; finalize-a.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                nomeAtivo = Sheets("opEspeciais").Cells(contLinha, 8)
                Dim confirmaRemocao As VbMsgBoxResult
                confirmaRemocao = MsgBox("Deseja confirmar a remo|fffd||fffd|o de '" & nomeAtivo & "'?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                
                If confirmaRemocao = vbNo Then
                    Range("F16") = "#C|fffd|digo"
                    Exit Sub
                    Else
                    
' localiza ativo indicado na tabela e efetua remo|fffd||fffd|o
                    Sheets("opEspeciais").Unprotect
                    contLinha = 18
                    tabLinha = ((contLinha * -1) + 1) + contLinha
                    
                    Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                    
                    If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                        Sheets("opEspeciais").Activate
                        Cells(contLinha, 3).Select
                        Selection.ListObject.ListRows(tabLinha).Delete
                        Sheets("opEspeciais").Cells(16, 6) = "#C|fffd|digo"
                        
                        Else
                        contLinha = contLinha + 1
                        tabLinha = tabLinha + 1
                        
                    End If
                    Loop
                    
' finaliza opera|fffd||fffd|es
                    Sheets("opEspeciais").Range("F16") = "#C|fffd|digo"
                    Sheets("opEspeciais").Range("M7") = "#C|fffd|digo"
                    Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Call planAutoSave
                    MsgBox "Opera|fffd||fffd|o removida com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If

End Sub
Sub opEspeciaisEditarOperacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EDI|fffd||fffd|O DE CAMPOS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida disponibilidade de edi|fffd|ao
    contLinha = 18
    
    If Sheets("opEspeciais").Cells(contLinha, 7) = "" Then
        MsgBox "Nenhuma opera|fffd||fffd|o dispon|fffd|vel para altera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' loop para reconhecimento do status e liberar edi|fffd||fffd|o
        If Sheets("opEspeciais").Cells(16, 12) = "EDITAR OPERA|fffd||fffd|ES" Then
            
            Sheets("opEspeciais").Unprotect
            Sheets("opEspeciais").Range("tabOpEspeciaisRegistros").Locked = True
            Sheets("opEspeciais").Range("tabOpEspeciaisRegistros[Data Exec.]").Locked = False
            Sheets("opEspeciais").Range("tabOpEspeciaisRegistros[Tipo Op.]").Locked = False
            Sheets("opEspeciais").Range("tabOpEspeciaisRegistros[Propor|fffd||fffd|o]").Locked = False
            Sheets("opEspeciais").Range("tabOpEspeciaisRegistros[Pre|fffd|o Unit.]").Locked = False
            Sheets("opEspeciais").Cells(16, 12) = "SALVAR EDI|fffd||fffd|O"
            
            Call opEspeciaisClassificar
            Range("D18").Activate
            Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' reconhecimento do status para finalizar edi|fffd||fffd|o
            If Sheets("opEspeciais").Cells(16, 12) = "SALVAR EDI|fffd||fffd|O" Then
                
                Sheets("opEspeciais").Unprotect
                Sheets("opEspeciais").Range("tabOpEspeciaisRegistros").Locked = True
                Sheets("opEspeciais").Cells(16, 12) = "EDITAR OPERA|fffd||fffd|ES"
                
                Call opEspeciaisClassificar
                Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                MsgBox "Opera|fffd||fffd|es editadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub opEspeciaisLiquidar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIQUIDA OPERA|fffd||fffd|ES ESPECIAIS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| alguma edi|fffd||fffd|o em andamento
    If Sheets("opEspeciais").Cells(16, 12) = "SALVAR EDI|fffd||fffd|O" Then
        MsgBox "Ops! Parece que h|fffd| uma edi|fffd||fffd|o em andamento." & vbNewLine & "Finalize-a antes de continuar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
'vari|fffd|veis principais
        codigoAtivo = UCase(Range("M7"))
        corretora = Range("M9")
        
' valida c|fffd|digo selecionado e corretora
        If codigoAtivo = "#C|fffd|DIGO" Then
            MsgBox "Selecione o c|fffd|digo do ativo a ser liquidado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("M7").Activate
            Exit Sub
            Else
            
            If codigoAtivo = "" Then
                MsgBox "Selecione o c|fffd|digo do ativo a ser liquidado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("M7").Activate
                Range("M7") = "#C|fffd|digo"
                Exit Sub
                Else
                
                If corretora = "" Or corretora = "#Selecionar" Then
                    MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("M9").Activate
                    Exit Sub
                    Else
                    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES E VARI|fffd|VEIS
' vari|fffd|veis secund|fffd|rias
                    contLinha = 18
                    Do Until Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Or Sheets("opEspeciais").Cells(contLinha, 3) = ""
                    contLinha = contLinha + 1
                    Loop
                    
                    If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                        codigoAcaoPrincipal = Sheets("opEspeciais").Cells(12, 12)
                        codigoAcaoSecundaria = Sheets("opEspeciais").Cells(12, 13)
                        data = Sheets("opEspeciais").Cells(contLinha, 3)
                        dataLimite = Sheets("opEspeciais").Cells(contLinha, 4)
                        tipoInvest = Sheets("opEspeciais").Cells(contLinha, 5)
                        tipoOperacao = Sheets("opEspeciais").Cells(contLinha, 6)
                        posicaoAtual = Sheets("opEspeciais").Cells(contLinha, 9)
                        proporcao = Sheets("opEspeciais").Cells(contLinha, 10)
                        qtde = Sheets("opEspeciais").Cells(contLinha, 11)
                        valorUnit = Sheets("opEspeciais").Cells(contLinha, 12)
                        status = Sheets("opEspeciais").Cells(contLinha, 14)
                        valorCompra = qtde * valorUnit
                        Else
                        Exit Sub
                        
                    End If
                    
' vari|fffd|veis para registro em caixa
                    origem = "Conta Corretora"
                    destino = "B3"
                    finalidade = "Aumento Patrimonial"
                    valorBruto = valorUnit * qtde
                    valorCompra = valorBruto
                    
' valida status da opera|fffd||fffd|o
                    If status = "EM ANDAMENTO" Then
                        MsgBox "A liquida|fffd||fffd|o de " & codigoAtivo & " ainda n|fffd|o est|fffd| dispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("M7") = "#C|fffd|digo"
                        Range("M7").Activate
                        Exit Sub
                        Else
                        
' confirma|fffd||fffd|o para registro dos dados
                        Dim confirmaLiquidacao As VbMsgBoxResult
                        confirmaLiquidacao = MsgBox("Deseja confirmar a liquida|fffd||fffd|o de " & codigoAtivo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                        
                        If confirmaLiquidacao = vbNo Then
                            Exit Sub
                            Else
                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIQUIDA OPERA|fffd||fffd|ES ESPECIAIS SIMPLES
'*************************************************************************************************************************** REGISTRO OPERA|fffd||fffd|ES DE BONIFICA|fffd||fffd|O
' valida registro de bonifica|fffd||fffd|o (apenas inclus|fffd|o de ativo na tabela de opera|fffd||fffd|es especiais)
                            If tipoOperacao = "Bonifica|fffd||fffd|o" Then
                                
' localiza linha vazia na tabela de opera|fffd||fffd|es e registra dados
                                Sheets("opEspeciais").Unprotect
                                Sheets("opEspeciaisExec").Unprotect
                                
                                If Sheets("opEspeciaisExec").Cells(5, 3) = "" Then
                                    contLinha = 5
                                    Else
                                    contLinha = Sheets("opEspeciaisExec").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                    
                                End If
                                
' registra dados na tabela
                                Sheets("opEspeciaisExec").Cells(contLinha, 3) = data
                                Sheets("opEspeciaisExec").Cells(contLinha, 4) = dataLimite
                                Sheets("opEspeciaisExec").Cells(contLinha, 5) = tipoInvest
                                Sheets("opEspeciaisExec").Cells(contLinha, 6) = tipoOperacao
                                Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAtivo
                                Sheets("opEspeciaisExec").Cells(contLinha, 9) = posicaoAtual
                                Sheets("opEspeciaisExec").Cells(contLinha, 10) = proporcao
                                Sheets("opEspeciaisExec").Cells(contLinha, 12) = valorUnit
                                Sheets("opEspeciaisExec").Cells(contLinha, 14) = corretora
                                
' reestabelece formato das colunas e protege tabela
                                Range("tabOpEspeciaisExecutadas[Data Registro]").NumberFormat = "dd/mm/yyyy"
                                Range("tabOpEspeciaisExecutadas[Data Exec.]").NumberFormat = "dd/mm/yyyy"
                                        
                                Call opEspeciaisExecClassificar
                                Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                
'*************************************************************************************************************************** FINALIZA LIQUIDA|fffd||fffd|O DE BONIFICA|fffd||fffd|O
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                contLinha = 18
                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                
                                If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                    Sheets("opEspeciais").Activate
                                    Cells(contLinha, 3).Select
                                    Selection.ListObject.ListRows(tabLinha).Delete
                                    
                                    Else
                                    contLinha = contLinha + 1
                                    tabLinha = tabLinha + 1
                                    
                                End If
                                Loop
                                
                                Range("M7") = "#C|fffd|digo"
                                Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                
' finaliza|fffd||fffd|o geral
                                Call planAutoSave
                                MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRO OPERA|fffd||fffd|ES DE ESFOR|fffd|OS, SUBSCRI|fffd||fffd|O
' valida tipo de opera|fffd||fffd|o sem alterar carteira de ativos (mesmos c|fffd|digos)
                                If tipoOperacao = "Esfor|fffd|os Restritos" Or tipoOperacao = "Subscri|fffd||fffd|o" Then
                                    
' localiza linha vazia na tabela de opera|fffd||fffd|es e registra dados
                                    Sheets("opEspeciais").Unprotect
                                    Sheets("opEspeciaisExec").Unprotect
                                    Sheets("carteiraCaixa").Unprotect
                                    
                                    If Sheets("opEspeciaisExec").Cells(5, 3) = "" Then
                                        contLinha = 5
                                        Else
                                        contLinha = Sheets("opEspeciaisExec").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                        
                                    End If
                                    
' registra dados na tabela
                                    Sheets("opEspeciaisExec").Cells(contLinha, 3) = data
                                    Sheets("opEspeciaisExec").Cells(contLinha, 4) = dataLimite
                                    Sheets("opEspeciaisExec").Cells(contLinha, 5) = tipoInvest
                                    Sheets("opEspeciaisExec").Cells(contLinha, 6) = tipoOperacao
                                    Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAtivo
                                    Sheets("opEspeciaisExec").Cells(contLinha, 9) = posicaoAtual
                                    Sheets("opEspeciaisExec").Cells(contLinha, 10) = proporcao
                                    Sheets("opEspeciaisExec").Cells(contLinha, 12) = valorUnit
                                    Sheets("opEspeciaisExec").Cells(contLinha, 14) = corretora
                                    
' reestabelece formato das colunas e protege tabela
                                    Range("tabOpEspeciaisExecutadas[Data Registro]").NumberFormat = "dd/mm/yyyy"
                                    Range("tabOpEspeciaisExecutadas[Data Exec.]").NumberFormat = "dd/mm/yyyy"
                                            
                                    Call opEspeciaisExecClassificar
                                    
'*************************************************************************************************************************** REGISTRO DE DADOS EM CAIXA
' loop para localizar linha vazia
                                    contLinha = 20
                                    Do Until Sheets("carteiraCaixa").Cells(contLinha, 3) = ""
                                    contLinha = contLinha + 1
                                    Loop
                                    
' registra opera|fffd||fffd|o na tabela do caixa
                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = dataLimite
                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                    
' reestabelece formato da coluna e classifica
                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                    Call carteiraCaixaClassificar
                                    
'*************************************************************************************************************************** FINALIZA LIQUIDA|fffd||fffd|O DE ESFOR|fffd|OS, SUBSCRI|fffd||fffd|O
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                    contLinha = 18
                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                    Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                    
                                    If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                        Sheets("opEspeciais").Activate
                                        Cells(contLinha, 3).Select
                                        Selection.ListObject.ListRows(tabLinha).Delete
                                        
                                        Else
                                        contLinha = contLinha + 1
                                        tabLinha = tabLinha + 1
                                        
                                    End If
                                    Loop
                                    
                                    Range("M7") = "#C|fffd|digo"
                                    Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    
' finaliza|fffd||fffd|o geral
                                    Call planAutoSave
                                    MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIQUIDA OPERA|fffd||fffd|ES ESPECIAIS COMPLEXAS
'*************************************************************************************************************************** REGISTRO OPERA|fffd||fffd|ES DE ESFOR|fffd|OS (+), SUBSCRI|fffd||fffd|O (+)
' valida tipo de opera|fffd||fffd|o com inclus|fffd|o de novo c|fffd|digo (sobras)
                                    If tipoOperacao = "Esfor|fffd|os Restritos (+)" Or tipoOperacao = "Subscri|fffd||fffd|o (+)" Then
                                        
' localiza linha vazia na tabela de opera|fffd||fffd|es e registra dados
                                        Sheets("opEspeciais").Unprotect
                                        Sheets("opEspeciaisExec").Unprotect
                                        Sheets("carteiraCaixa").Unprotect
                                        
                                        If Sheets("opEspeciaisExec").Cells(5, 3) = "" Then
                                            contLinha = 5
                                            Else
                                            contLinha = Sheets("opEspeciaisExec").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' registra dados na tabela
                                        Sheets("opEspeciaisExec").Cells(contLinha, 3) = data
                                        Sheets("opEspeciaisExec").Cells(contLinha, 4) = dataLimite
                                        Sheets("opEspeciaisExec").Cells(contLinha, 5) = tipoInvest
                                        Sheets("opEspeciaisExec").Cells(contLinha, 6) = tipoOperacao
                                        Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAtivo
                                        Sheets("opEspeciaisExec").Cells(contLinha, 9) = posicaoAtual
                                        Sheets("opEspeciaisExec").Cells(contLinha, 10) = proporcao
                                        Sheets("opEspeciaisExec").Cells(contLinha, 12) = valorUnit
                                        Sheets("opEspeciaisExec").Cells(contLinha, 14) = corretora
                                        
' reestabelece formato das colunas e protege tabela
                                        Range("tabOpEspeciaisExecutadas[Data Registro]").NumberFormat = "dd/mm/yyyy"
                                        Range("tabOpEspeciaisExecutadas[Data Exec.]").NumberFormat = "dd/mm/yyyy"
                                        
                                        Call opEspeciaisExecClassificar
                                        
'*************************************************************************************************************************** REGISTRO DE DADOS EM CAIXA
' loop para localizar linha vazia
                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                            contLinha = 20
                                            Else
                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                            
                                        End If
                                        
' registra opera|fffd||fffd|o na tabela do caixa
                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = dataLimite
                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo
                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra
                                        
' reestabelece formato da coluna e classifica
                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                        Call carteiraCaixaClassificar
                                        Call carteiraCaixaID
                                        
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE A|fffd||fffd|ES E FIIS
' inclui ativo na tabela
                                        If tipoInvest = "A|fffd||fffd|es" Then
                                            Sheets("a|fffd||fffd|esCarteira").Unprotect
                                            
                                            If Sheets("a|fffd||fffd|esCarteira").Cells(18, 3) = "" Then
                                                contLinha = 18
                                                Else
                                                contLinha = Sheets("a|fffd||fffd|esCarteira").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
                                            Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivo
                                            Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
                                            Else
                                            If tipoInvest = "Fundos Imobili|fffd|rios" Then
                                                Sheets("fiisCarteira").Unprotect
                                                
                                                If Sheets("fiisCarteira").Cells(18, 3) = "" Then
                                                    contLinha = 18
                                                    Else
                                                    contLinha = Sheets("fiisCarteira").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("fiisCarteira").Cells(contLinha, 3) = codigoAtivo
                                                Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                            End If
                                        End If
                                        
'*************************************************************************************************************************** FINALIZA LIQUIDA|fffd||fffd|O DE ESFOR|fffd|OS (+), SUBSCRI|fffd||fffd|O (+)
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                        contLinha = 18
                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                        Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                        
                                        If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                            Sheets("opEspeciais").Activate
                                            Cells(contLinha, 3).Select
                                            Selection.ListObject.ListRows(tabLinha).Delete
                                            
                                            Else
                                            contLinha = contLinha + 1
                                            tabLinha = tabLinha + 1
                                            
                                        End If
                                        Loop
                                        
                                        Range("M7") = "#C|fffd|digo"
                                        Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                        
' finaliza|fffd||fffd|o geral
                                        Call planAutoSave
                                        MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Exit Sub
                                        Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRO OPERA|fffd||fffd|ES DE CONVERS|fffd|O
' valida tipo de opera|fffd||fffd|o com altera|fffd||fffd|o de registros em carteira (mudan|fffd|a de c|fffd|digos ou qtde de ativos)
                                        If tipoOperacao = "Convers|fffd|o" Then
                                            Sheets("opEspeciais").Unprotect
                                        
'*************************************************************************************************************************** CONVERTE A|fffd||fffd|ES
' valida tipo de investimento
                                            If tipoInvest = "A|fffd||fffd|es" Then
                                                
' desbloqueia e altera c|fffd|digo da a|fffd||fffd|o nas tabelas
                                                Sheets("a|fffd||fffd|esCarteira").Unprotect
                                                Sheets("a|fffd||fffd|esCompras").Unprotect
                                                Sheets("a|fffd||fffd|esProventos").Unprotect
                                                
' loop para remo|fffd||fffd|o de compras e inclus|fffd|o de novo c|fffd|digo
                                                contLinha = 23
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
                                                
                                                    If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo Then
                                                        Sheets("a|fffd||fffd|esCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                Loop
                                                
                                                Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = dataLimite
                                                Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivoConvert
                                                Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 7) = qtde
                                                Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 8) = valorUnit
                                                Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 10) = valorCompra
                                                Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 14) = corretora
                                                
' reestabelece formato das colunas e protege tabela
                                                Range("tabA|fffd||fffd|esCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call acoesComprasClassificar
                                                
' loop para altera|fffd||fffd|o de proventos
                                                contLinha = 24
                                                Do Until Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = ""
                                                    If Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAtivo Then
                                                        Sheets("a|fffd||fffd|esProventos").Activate
                                                        Cells(contLinha, 5).Select
                                                        Selection.Value = codigoAtivoConvert
                                                        contLinha = contLinha + 1
                                                        Else
                                                        contLinha = contLinha + 1
                                                        
                                                    End If
                                                Loop
                                                
' loop para altera|fffd||fffd|o de ativo na carteira
                                                contLinha = 18
                                                Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = ""
                                                    If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivo Then
                                                        Sheets("a|fffd||fffd|esCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.Value = codigoAtivoConvert
                                                        Exit Do
                                                        Else
                                                        contLinha = contLinha + 1
                                                        
                                                    End If
                                                Loop
                                                
                                                Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Else
                                                
'*************************************************************************************************************************** CONVERTE FIIS
' valida tipo de investimento
                                                If tipoInvest = "Fundos Imobili|fffd|rios" Then
                                                    
' desbloqueia e altera c|fffd|digo do fundo nas tabelas
                                                    Sheets("fiisCarteira").Unprotect
                                                    Sheets("fiisCompras").Unprotect
                                                    Sheets("fiisRendimentos").Unprotect
                                                    
' loop para remo|fffd||fffd|o de compras e inclus|fffd|o de novo c|fffd|digo
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("fiisCompras").Cells(contLinha, 3) = ""
                                                    
                                                        If Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivo Then
                                                            Sheets("fiisCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                    Loop
                                                    
                                                    Sheets("fiisCompras").Cells(contLinha, 3) = dataLimite
                                                    Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivoConvert
                                                    Sheets("fiisCompras").Cells(contLinha, 7) = qtde
                                                    Sheets("fiisCompras").Cells(contLinha, 8) = valorUnit
                                                    Sheets("fiisCompras").Cells(contLinha, 10) = valorCompra
                                                    Sheets("fiisCompras").Cells(contLinha, 14) = corretora
                                                    
' reestabelece formato das colunas e protege tabela
                                                    Range("tabFIIsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call fiisComprasClassificar
                                                    
' loop para altera|fffd||fffd|o de rendimentos
                                                    contLinha = 24
                                                    Do Until Sheets("fiisRendimentos").Cells(contLinha, 5) = ""
                                                        If Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoAtivo Then
                                                            Sheets("fiisRendimentos").Activate
                                                            Cells(contLinha, 5).Select
                                                            Selection.Value = codigoAtivoConvert
                                                            contLinha = contLinha + 1
                                                            Else
                                                            contLinha = contLinha + 1
                                                            
                                                        End If
                                                    Loop
                                                    
' loop para altera|fffd||fffd|o de ativo na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = ""
                                                        If Sheets("fiisCarteira").Cells(contLinha, 3) = codigoAtivo Then
                                                            Sheets("fiisCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.Value = codigoAtivoConvert
                                                            Exit Do
                                                            Else
                                                            contLinha = contLinha + 1
                                                            
                                                        End If
                                                    Loop
                                                    
                                                    Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                End If
                                            End If
                                            
'*************************************************************************************************************************** FINALIZA LIQUIDA|fffd||fffd|O DE CONVERS|fffd|O
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                            contLinha = 18
                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                            Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                            
                                            If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                                Sheets("opEspeciais").Activate
                                                Cells(contLinha, 3).Select
                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                
                                                Else
                                                contLinha = contLinha + 1
                                                tabLinha = tabLinha + 1
                                                
                                            End If
                                            Loop
                                            
                                            Range("M7") = "#C|fffd|digo"
                                            Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                            
' finaliza|fffd||fffd|o geral
                                            Call planAutoSave
                                            MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                            Exit Sub
                                            Else
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRO OPERA|fffd||fffd|ES DE UNIFICA|fffd||fffd|O
' valida registro de unifica|fffd||fffd|o
                                            If tipoOperacao = "Unifica|fffd||fffd|o (Units)" Then
                                            
' desbloqueia e altera c|fffd|digo da a|fffd||fffd|o nas tabelas
'MsgBox codigoAcaoPrincipal & "/" & codigoAcaoSecundaria
                                                Sheets("opEspeciais").Unprotect
                                                Sheets("opEspeciaisExec").Unprotect
                                                Sheets("a|fffd||fffd|esCarteira").Unprotect
                                                Sheets("a|fffd||fffd|esCompras").Unprotect
                                                Sheets("a|fffd||fffd|esVendas").Unprotect
                                                
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES DE COMPRAS
' loop para localizar c|fffd|digo
                                                contLinha = 23
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
                                                
' remove compras das a|fffd||fffd|es principal e secund|fffd|ria
                                                If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcaoPrincipal Or Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAcaoSecundaria Then
                                                    Sheets("a|fffd||fffd|esCompras").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
                                                
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES DE VENDAS
' loop para localizar c|fffd|digo
                                                contLinha = 23
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 3) = ""
                                                
' remove vendas das a|fffd||fffd|es principal e secund|fffd|ria
                                                If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcaoPrincipal Or Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAcaoSecundaria Then
                                                    Sheets("a|fffd||fffd|esVendas").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
                                                
'*************************************************************************************************************************** REMOVE OPERA|fffd||fffd|ES ESPECIAIS EXECUTADAS
' loop para localizar c|fffd|digo
                                                contLinha = 5
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("opEspeciaisExec").Cells(contLinha, 3) = ""
                                                
' remove registros de opera|fffd||fffd|es especiais executadas
                                                If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAcaoPrincipal Or Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAcaoSecundaria Then
                                                    Sheets("opEspeciaisExec").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
                                                
'*************************************************************************************************************************** REMOVE C|fffd|DIGOS UNIFICADOS DA CARTEIRA E INSERE NOVO
' remove compras da a|fffd||fffd|o secund|fffd|ria
                                                contLinha = 18
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = ""
                                                    
                                                If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcaoPrincipal Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAcaoSecundaria Then
                                                    Sheets("a|fffd||fffd|esCarteira").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
                                                
' inclus|fffd|o de novo c|fffd|digo na carteira, caso ainda n|fffd|o exista
                                                contLinha = 18
                                                codigoAtivoConvert = Sheets("opEspeciais").Cells(12, 14)
                                                Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = "" Or Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivoConvert
                                                
                                                If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = "" Then
                                                    Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivoConvert
                                                    Else
                                                    contLinha = contLinha + 1
                                                    
                                                End If
                                                Loop
                                                
'*************************************************************************************************************************** REGISTRA OPERA|fffd||fffd|O EM OPERA|fffd||fffd|ES ESPECIAIS E FINALIZA|fffd||fffd|O
' registra dados na tabela de ordens especiais
                                                If Sheets("opEspeciaisExec").Cells(5, 3) = "" Then
                                                    contLinha = 5
                                                    Else
                                                    contLinha = Sheets("opEspeciaisExec").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
                                                Sheets("opEspeciaisExec").Cells(contLinha, 3) = data
                                                Sheets("opEspeciaisExec").Cells(contLinha, 4) = dataLimite
                                                Sheets("opEspeciaisExec").Cells(contLinha, 5) = tipoInvest
                                                Sheets("opEspeciaisExec").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAtivoConvert
                                                Sheets("opEspeciaisExec").Cells(contLinha, 9) = posicaoAtual
                                                Sheets("opEspeciaisExec").Cells(contLinha, 10) = proporcao
                                                Sheets("opEspeciaisExec").Cells(contLinha, 12) = valorUnit
                                                Sheets("opEspeciaisExec").Cells(contLinha, 14) = corretora
                                                
' reestabelece formato das colunas e protege tabela
                                                Range("tabOpEspeciaisExecutadas[Data Registro]").NumberFormat = "dd/mm/yyyy"
                                                Range("tabOpEspeciaisExecutadas[Data Exec.]").NumberFormat = "dd/mm/yyyy"
                                                Call opEspeciaisExecClassificar
                                                
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                                contLinha = 18
                                                tabLinha = ((contLinha * -1) + 1) + contLinha
                                                Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                                
                                                If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                                    Sheets("opEspeciais").Activate
                                                    Cells(contLinha, 3).Select
                                                    Selection.ListObject.ListRows(tabLinha).Delete
                                                    
                                                    Else
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    
                                                End If
                                                Loop
                                                
                                                Range("M7") = "#C|fffd|digo"
                                                Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Call planAutoSave
                                                MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                Else
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRO OPERA|fffd||fffd|ES DE DESDOBRAMENTO, GRUPAMENTO
                                                If tipoOperacao = "Desdobramento" Or tipoOperacao = "Grupamento" Then
                                                    Sheets("opEspeciais").Unprotect
                                                    
'*************************************************************************************************************************** LIQUIDA DESDOBRAMENTO E GRUPAMENTO DE A|fffd||fffd|ES
' valida tipo de investimento
                                                    If tipoInvest = "A|fffd||fffd|es" Then
                                                    
' desbloqueia e altera c|fffd|digo da a|fffd||fffd|o nas tabelas
                                                        Sheets("a|fffd||fffd|esCompras").Unprotect
                                                        
' remove compras efetuadas para a a|fffd||fffd|o
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = ""
                                                        
                                                        codigoAtivo = Sheets("opEspeciais").Range("M7")
                                                        If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo Then
                                                            Sheets("a|fffd||fffd|esCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
                                                        
' registra nova compra com quantidade do desdobramento
                                                        If Sheets("a|fffd||fffd|esCompras").Cells(23, 3) = "" Then
                                                            contLinha = 23
                                                            Else
                                                            contLinha = Sheets("a|fffd||fffd|esCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
                                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 3) = dataLimite
                                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo
                                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 7) = qtde
                                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 8) = valorUnit
                                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 11) = valorCompra
                                                        Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 14) = corretora
                                                        
' reestabelece formato das colunas e protege tabela
                                                        Range("tabA|fffd||fffd|esCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call acoesComprasClassificar
                                                        
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                                            Sheets("opEspeciais").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
                                                        
                                                        Range("M7") = "#C|fffd|digo"
                                                        Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
' finaliza|fffd||fffd|o geral
                                                        Call planAutoSave
                                                        MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
                                                        
'*************************************************************************************************************************** LIQUIDA DESDOBRAMENTO E GRUPAMENTO DE FIIS
' valida tipo de investimento
                                                        If tipoInvest = "Fundos Imobili|fffd|rios" Then
                                                            
' desbloqueia e altera c|fffd|digo da a|fffd||fffd|o nas tabelas
                                                            Sheets("fiisCompras").Unprotect
                                                            
' remove compras efetuadas para o fundo
                                                            contLinha = 23
                                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                                            Do Until Sheets("fiisCompras").Cells(contLinha, 3) = ""
                                                            
                                                            If Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivo Then
                                                                Sheets("fiisCompras").Activate
                                                                Cells(contLinha, 3).Select
                                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                                
                                                                Else
                                                                contLinha = contLinha + 1
                                                                tabLinha = tabLinha + 1
                                                                
                                                            End If
                                                            Loop
                                                            
' registra nova compra com quantidade do desdobramento
                                                            If Sheets("fiisCompras").Cells(23, 3) = "" Then
                                                                contLinha = 23
                                                                Else
                                                                contLinha = Sheets("fiisCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                                
                                                            End If
                                                            
                                                            Sheets("fiisCompras").Cells(contLinha, 3) = dataLimite
                                                            Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivo
                                                            Sheets("fiisCompras").Cells(contLinha, 7) = qtde
                                                            Sheets("fiisCompras").Cells(contLinha, 8) = valorUnit
                                                            Sheets("fiisCompras").Cells(contLinha, 11) = valorCompra
                                                            Sheets("fiisCompras").Cells(contLinha, 14) = corretora
                                                            
' reestabelece formato das colunas e protege tabela
                                                            Range("tabFIIsCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                                            Call fiisComprasClassificar
                                                            
' remove registro liquidado da tabela e altera c|fffd|digo na sele|fffd||fffd|o de liquida|fffd||fffd|o
                                                            contLinha = 18
                                                            tabLinha = ((contLinha * -1) + 1) + contLinha
                                                            Do Until Sheets("opEspeciais").Cells(contLinha, 3) = ""
                                                            
                                                            If Sheets("opEspeciais").Cells(contLinha, 7) = codigoAtivo Then
                                                                Sheets("opEspeciais").Activate
                                                                Cells(contLinha, 3).Select
                                                                Selection.ListObject.ListRows(tabLinha).Delete
                                                                
                                                                Else
                                                                contLinha = contLinha + 1
                                                                tabLinha = tabLinha + 1
                                                                
                                                            End If
                                                            Loop
                                                            
                                                            Range("M7") = "#C|fffd|digo"
                                                            Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                            
' finaliza|fffd||fffd|o geral
                                                            Range("M7").Select
                                                            Call planAutoSave
                                                            MsgBox "Opera|fffd||fffd|o liquidada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                            Exit Sub
                                                            
                                                        End If
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub opEspeciaisAltCodigo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA TABELAS GERAIS
' libera tabelas do sistema
    Sheets("ativosRadarRV").Unprotect
    Sheets("ativosRadarMulti").Unprotect
    Sheets("opEspeciaisExec").Unprotect
    Sheets("carteiraCaixa").Unprotect
    Sheets("carteiraOp").Unprotect

' altera radar renda vari|fffd|vel
    contLinha = 15
    Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = ""
        If Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo Then
            Sheets("ativosRadarRV").Activate
            Cells(contLinha, 3).Select
            Selection.Value = codigoAtivoConvert
            Exit Do
            Else
            contLinha = contLinha + 1
        
        End If
    Loop
    
' altera opera|fffd||fffd|es especiais
    contLinha = 5
    Do Until Sheets("opEspeciaisExec").Cells(contLinha, 7) = ""
        If Sheets("opEspeciaisExec").Cells(contLinha, 7) = codigoAtivo Then
            Sheets("opEspeciaisExec").Activate
            Cells(contLinha, 7).Select
            Selection.Value = codigoAtivoConvert
            contLinha = contLinha + 1
            Else
            contLinha = contLinha + 1

        End If
    Loop
    
' altera ordens pendentes
    contLinha = 5
    Do Until Sheets("carteiraOp").Cells(contLinha, 7) = ""
        If Sheets("carteiraOp").Cells(contLinha, 7) = codigoAtivo Then
            Sheets("carteiraOp").Activate
            Cells(contLinha, 7).Select
            Selection.Value = codigoAtivoConvert
            contLinha = contLinha + 1
            Else
            contLinha = contLinha + 1

        End If
    Loop
    
' altera caixa
    contLinha = 20
    Do Until Sheets("carteiraCaixa").Cells(contLinha, 10) = ""
        If Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoAtivo Then
            Sheets("carteiraCaixa").Activate
            Cells(contLinha, 10).Select
            Selection.Value = codigoAtivoConvert
            contLinha = contLinha + 1
            Else
            contLinha = contLinha + 1

        End If
    Loop
    
' bloqueia tabelas do sistema
    Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Sheets("ativosRadarMulti").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Sheets("opEspeciaisExec").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    Sheets("carteiraOp").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
'*************************************************************************************************************************** ALTERA A|fffd||fffd|ES
' valida tipo de ativo e libera tabelas da aplica|fffd||fffd|o
    If tipoInvest = "A|fffd||fffd|es" Then
        
        Sheets("databaseWebA|fffd||fffd|es").Unprotect
        Sheets("a|fffd||fffd|esCarteira").Unprotect
        Sheets("a|fffd||fffd|esCompras").Unprotect
        Sheets("a|fffd||fffd|esVendas").Unprotect
        Sheets("a|fffd||fffd|esProventos").Unprotect

' loop para altera|fffd||fffd|o de carteira
        contLinha = 18
        Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = ""
            If Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = codigoAtivo Then
                Sheets("a|fffd||fffd|esCarteira").Activate
                Cells(contLinha, 3).Select
                Selection.Value = codigoAtivoConvert
                Exit Do
                Else
                contLinha = contLinha + 1
                
            End If
        Loop

' loop para altera|fffd||fffd|o de compras
        contLinha = 23
        Do Until Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = ""
            If Sheets("a|fffd||fffd|esCompras").Cells(contLinha, 4) = codigoAtivo Then
                Sheets("a|fffd||fffd|esCompras").Activate
                Cells(contLinha, 4).Select
                Selection.Value = codigoAtivoConvert
                contLinha = contLinha + 1
                Else
                contLinha = contLinha + 1
                
            End If
        Loop
        
' loop para altera|fffd||fffd|o de vendas
        contLinha = 23
        Do Until Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = ""
            If Sheets("a|fffd||fffd|esVendas").Cells(contLinha, 4) = codigoAtivo Then
                Sheets("a|fffd||fffd|esVendas").Activate
                Cells(contLinha, 4).Select
                Selection.Value = codigoAtivoConvert
                contLinha = contLinha + 1
                Else
                contLinha = contLinha + 1
                
            End If
        Loop
        
' loop para altera|fffd||fffd|o de proventos
        contLinha = 24
        Do Until Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = ""
            If Sheets("a|fffd||fffd|esProventos").Cells(contLinha, 5) = codigoAtivo Then
                Sheets("a|fffd||fffd|esProventos").Activate
                Cells(contLinha, 5).Select
                Selection.Value = codigoAtivoConvert
                contLinha = contLinha + 1
                Else
                contLinha = contLinha + 1

            End If
        Loop
        
' loop para altera|fffd||fffd|o banco de dados
        contLinha = 6
        Do Until Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = ""
            If Sheets("databaseWebA|fffd||fffd|es").Cells(contLinha, 3) = codigoAtivo Then
                Sheets("databaseWebA|fffd||fffd|es").Activate
                Cells(contLinha, 3).Select
                Selection.Value = codigoAtivoConvert
                Exit Do
                Else
                contLinha = contLinha + 1

            End If
        Loop
        
        Call databaseAcoesClassificar
        
' bloqueia tabelas do sistema
        Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("a|fffd||fffd|esCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("a|fffd||fffd|esCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("a|fffd||fffd|esVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub

        Else
        
'*************************************************************************************************************************** ALTERA FIIS
' valida tipo de ativo e libera tabelas da aplica|fffd||fffd|o
        If tipoInvest = "Fundos Imobili|fffd|rios" Then
            
            Sheets("databaseWebFIIs").Unprotect
            Sheets("fiisCarteira").Unprotect
            Sheets("fiisCompras").Unprotect
            Sheets("fiisVendas").Unprotect
            Sheets("fiisRendimentos").Unprotect

' loop para altera|fffd||fffd|o de carteira
            contLinha = 18
            Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = ""
                If Sheets("fiisCarteira").Cells(contLinha, 3) = codigoAtivo Then
                    Sheets("fiisCarteira").Activate
                    Cells(contLinha, 3).Select
                    Selection.Value = codigoAtivoConvert
                    Exit Do
                    Else
                    contLinha = contLinha + 1
                    
                End If
            Loop

' loop para altera|fffd||fffd|o de compras
            contLinha = 23
            Do Until Sheets("fiisCompras").Cells(contLinha, 4) = ""
                If Sheets("fiisCompras").Cells(contLinha, 4) = codigoAtivo Then
                    Sheets("fiisCompras").Activate
                    Cells(contLinha, 4).Select
                    Selection.Value = codigoAtivoConvert
                    contLinha = contLinha + 1
                    Else
                    contLinha = contLinha + 1
                    
                End If
            Loop
            
' loop para altera|fffd||fffd|o de vendas
            contLinha = 23
            Do Until Sheets("fiisVendas").Cells(contLinha, 4) = ""
                If Sheets("fiisVendas").Cells(contLinha, 4) = codigoAtivo Then
                    Sheets("fiisVendas").Activate
                    Cells(contLinha, 4).Select
                    Selection.Value = codigoAtivoConvert
                    contLinha = contLinha + 1
                    Else
                    contLinha = contLinha + 1
                    
                End If
            Loop
            
' loop para altera|fffd||fffd|o de proventos
            contLinha = 24
            Do Until Sheets("fiisRendimentos").Cells(contLinha, 5) = ""
                If Sheets("fiisRendimentos").Cells(contLinha, 5) = codigoAtivo Then
                    Sheets("fiisRendimentos").Activate
                    Cells(contLinha, 5).Select
                    Selection.Value = codigoAtivoConvert
                    contLinha = contLinha + 1
                    Else
                    contLinha = contLinha + 1
    
                End If
            Loop
            
' loop para altera|fffd||fffd|o banco de dados
            contLinha = 6
            Do Until Sheets("databaseWebFIIs").Cells(contLinha, 3) = ""
                If Sheets("databaseWebFIIs").Cells(contLinha, 3) = codigoAtivo Then
                    Sheets("databaseWebFIIs").Activate
                    Cells(contLinha, 3).Select
                    Selection.Value = codigoAtivoConvert
                    Exit Do
                    Else
                    contLinha = contLinha + 1

                End If
            Loop
            
            Call databaseFIIsClassificar
            
' bloqueia tabela do sistema
            Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("fiisCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("fiisCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("fiisVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Sheets("fiisRendimentos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            
        End If
    End If

End Sub
Sub opEspeciaisNovaOperacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA OPERA|fffd||fffd|O
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E8") = "#C|fffd|digo" And Range("J5") = Range("J6") And Range("J8") = 0 And Range("J9") = 0 Then
        Exit Sub
        Else

' reseta valores dos campos
        Sheets("opEspeciais").Unprotect
        
        Sheets("opEspeciais").Cells(6, 5) = "#Selecionar"
        Sheets("opEspeciais").Cells(8, 5) = "#C|fffd|digo"
        Sheets("opEspeciais").Cells(8, 10) = "0"
        Sheets("opEspeciais").Cells(9, 10) = "0"
        Range("J5").FormulaR1C1 = "=TODAY()"
        Range("J6").FormulaR1C1 = "=TODAY()"
        Sheets("opEspeciais").Cells(5, 5) = "#Selecionar"
        
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
        Range("E5").Select
        Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
    End If
    
End Sub
Sub opEspeciaisExecClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE OPERA|fffd||fffd|ES ESPECIAIS
' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("opEspeciaisExec").ListObjects("tabOpEspeciaisExecutadas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("opEspeciaisExec").ListObjects("tabOpEspeciaisExecutadas").Sort. _
        SortFields.Add Key:=Range("tabOpEspeciaisExecutadas[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("opEspeciaisExec").ListObjects("tabOpEspeciaisExecutadas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por data de not|fffd|cia
    ActiveWorkbook.Worksheets("opEspeciaisExec").ListObjects("tabOpEspeciaisExecutadas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("opEspeciaisExec").ListObjects("tabOpEspeciaisExecutadas").Sort. _
        SortFields.Add Key:=Range("tabOpEspeciaisExecutadas[[#Headers],[Data Exec.]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("opEspeciaisExec").ListObjects("tabOpEspeciaisExecutadas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Sub opEspeciaisClassificar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE OPERA|fffd||fffd|ES
' classifica|fffd||fffd|o crescente por c|fffd|digo
    ActiveWorkbook.Worksheets("opEspeciais").ListObjects("tabOpEspeciaisRegistros").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("opEspeciais").ListObjects("tabOpEspeciaisRegistros").Sort. _
        SortFields.Add Key:=Range("tabOpEspeciaisRegistros[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("opEspeciais").ListObjects("tabOpEspeciaisRegistros").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por data de liquida|fffd||fffd|o
    ActiveWorkbook.Worksheets("opEspeciais").ListObjects("tabOpEspeciaisRegistros").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("opEspeciais").ListObjects("tabOpEspeciaisRegistros").Sort. _
        SortFields.Add Key:=Range("tabOpEspeciaisRegistros[[#Headers],[Data Exec.]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("opEspeciais").ListObjects("tabOpEspeciaisRegistros").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_TesouroCarteira"
Sub tesouroCarteiraAtualizarCotacoes()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
' ************************************************************************************************************************** ATUALIZA TESOURO DIRETO
' gerenciamento de erros
    On Error GoTo errorHandler
    
' valida modo sigiloso e carteira vazia
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
    If Sheets("tesouroCarteira").Cells(18, 3) = "" Then
        Sheets("tesouroCarteira").Unprotect
        Range("F3") = 0
        Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        
    End If
    
' executa atualiza|fffd||fffd|o completa dos t|fffd|tulos
    Call databaseTesouro
    MsgBox "Cota|fffd||fffd|es atualizadas com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    Exit Sub
    
errorHandler:
    Exit Sub
    MsgBox "Houve um erro inesperado durante a atualiza|fffd||fffd|o. Entre em contato com o administrador do sistema", _
    vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub tesouroCarteiraLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  CARTEIRA
' vari|fffd|veis
    codigoAtivo = UCase(Sheets("tesouroCarteira").Range("H2"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo
    logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\" & codigoAtivo & ".jpg"
    Sheets("tesouroCarteira").logoField.Picture = LoadPicture(logoTesouro)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\_none.jpg"
        Sheets("tesouroCarteira").logoField.Picture = LoadPicture(logoTesouro)
    
    End If
    
End Sub
Sub tesouroComprasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO COMPRAS
' vari|fffd|veis
    codigoAtivo = UCase(Range("F6"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\" & Range("N3") & ".jpg"
    Sheets("tesouroCompras").logoField.Picture = LoadPicture(logoTesouro)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\_none.jpg"
        Sheets("tesouroCompras").logoField.Picture = LoadPicture(logoTesouro)
    
    End If
    
End Sub
Sub tesouroVendasLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO VENDAS
' vari|fffd|veis
    codigoAtivo = UCase(Range("F6"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
        
' define logotipo
    logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\" & Range("N3") & ".jpg"
    Sheets("tesouroVendas").logoField.Picture = LoadPicture(logoTesouro)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\_none.jpg"
        Sheets("tesouroVendas").logoField.Picture = LoadPicture(logoTesouro)
    
    End If
    
End Sub
Sub tesouroJurosLogo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO PROVENTOS
' vari|fffd|veis
    codigoAtivo = UCase(Range("N19"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo
    logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\tesouro.jpg"
    Sheets("tesouroJuros").logoField.Picture = LoadPicture(logoTesouro)
    Exit Sub
    
errorHandler:
    If Err = 76 Then
        Resume Next
        Else
        logoTesouro = ThisWorkbook.Path & "\imagery\tesouro\_none.jpg"
        Sheets("tesouroJuros").logoField.Picture = LoadPicture(logoTesouro)
    
    End If
    
End Sub
Sub tesouroCarteiraAltGrafico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE E OCULTA GR|fffd|FICO DE COMPARA|fffd||fffd|O
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' ativa visualiza|fffd||fffd|o do gr|fffd|fico
    If Range("C15") = "Anal|fffd|tico" Then
        Sheets("tesouroCarteira").Unprotect
        ActiveSheet.Shapes.Range(Array("grfTesouroVol")).Visible = True
        ActiveSheet.Shapes.Range(Array("grfTesouroAnal|fffd|tico")).Visible = False
        Sheets("tesouroCarteira").Cells(15, 3) = "Volum|fffd|trico"
        Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Else
        
' desativa gr|fffd|fico e exibe cadastro de objetivos
        If Range("C15") = "Volum|fffd|trico" Then
            Sheets("tesouroCarteira").Unprotect
            ActiveSheet.Shapes.Range(Array("grfTesouroVol")).Visible = False
            ActiveSheet.Shapes.Range(Array("grfTesouroAnal|fffd|tico")).Visible = True
            Sheets("tesouroCarteira").Cells(15, 3) = "Anal|fffd|tico"
            Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If

End Sub
Sub tesouroCarteiraAjustarGrafico()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CORRIGE EXIBI|fffd||fffd|O DE GR|fffd|FICO CARTEIRA NA 1|fffd| COMPRA
' ajusta r|fffd|tulo de dados
    Sheets("tesouroCarteira").Unprotect
    Sheets("tesouroCarteira").ChartObjects("grfTesouroVol").Activate
    ActiveChart.SetElement (msoElementDataLabelNone)
    ActiveChart.SetElement (msoElementDataLabelOutSideEnd)
    ActiveChart.ApplyDataLabels
    ActiveChart.FullSeriesCollection(1).DataLabels.Select
    Selection.ShowCategoryName = True
    Selection.ShowValue = False
    ActiveChart.SeriesCollection(1).DataLabels.Format.TextFrame2.TextRange.InsertChartField msoChartFieldRange, "=tabTesouroCarteira[Varia|fffd||fffd|o]", 0
    Selection.ShowRange = True
    Selection.Position = xlLabelPositionInsideEnd
    Selection.Separator = "" & Chr(13) & ""
    Selection.Format.TextFrame2.TextRange.Font.Size = 8
    With Selection.Format.TextFrame2.TextRange.Font.Fill
        .Visible = msoTrue
        .ForeColor.ObjectThemeColor = msoThemeColorBackground1
        .ForeColor.TintAndShade = 0
        .ForeColor.Brightness = -0.150000006
        .Transparency = 0
        .Solid
    End With
    ActiveChart.FullSeriesCollection(2).DataLabels.Select
    Selection.ShowValue = False
    Sheets("tesouroCarteira").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub tesouroCarteiraID()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERENCIA IDENTIFICADOR EM GR|fffd|FICO
'*************************************************************************************************************************** INSERE ID GR|fffd|FICO ANAL|fffd|TICO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida gr|fffd|fico aberto
    If Range("C15") = "Volum|fffd|trico" Then
        Call tesouroCarteiraAjustarGrafico
        Exit Sub
        Else
    
' valida status do identificador
        If Range("C4") = "Com identificador" Then
            Sheets("tesouroCarteira").Unprotect

' remove r|fffd|tulo de gr|fffd|fico anal|fffd|tico
            ActiveSheet.ChartObjects("grfTesouroAnal|fffd|tico").Activate
            ActiveChart.SetElement (msoElementDataLabelNone)
            
            Sheets("tesouroCarteira").Cells(4, 3) = "Sem identificador"
            Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
' exibe r|fffd|tulo de gr|fffd|fico anal|fffd|tico
             If Range("C4") = "Sem identificador" Then
                Sheets("tesouroCarteira").Unprotect

                ActiveSheet.ChartObjects("grfTesouroAnal|fffd|tico").Activate
                ActiveChart.SetElement (msoElementDataLabelTop)
                ActiveSheet.ChartObjects("grfTesouroAnal|fffd|tico").Activate
                ActiveChart.FullSeriesCollection(1).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                ActiveChart.FullSeriesCollection(2).DataLabels.Select
                Selection.NumberFormat = "$#.##0"
                Selection.Format.TextFrame2.TextRange.Font.Size = 8
                With Selection.Format.TextFrame2.TextRange.Font.Fill
                    .Visible = msoTrue
                    .ForeColor.ObjectThemeColor = msoThemeColorBackground1
                    .ForeColor.TintAndShade = 0
                    .ForeColor.Brightness = -0.5
                    .Transparency = 0
                    .Solid
                End With
                
                Sheets("tesouroCarteira").Cells(4, 3) = "Com identificador"
                Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True

            End If
        End If
    End If
    
End Sub
Sub tesouroCarteiraRecompra()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENVIA ATIVO MAIS DESCONTADO PARA RECOMPRA
' vari|fffd|veis
    codigoTesouro = UCase(Range("H4"))

' valida c|fffd|digo para recompra
    If codigoTesouro = "#C|fffd|DIGO" Or codigoTesouro = "" Or codigoTesouro = "#SELECIONAR" Then
        Exit Sub
        Else
        
' envia c|fffd|digo do ativo para boleta de compra
        Sheets("tesouroCompras").Select
        Sheets("tesouroCompras").Cells(6, 6) = codigoTesouro

    End If
    
End Sub

Attribute VB_Name = "M_TesouroCompras"
Sub tesouroComprasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE COMPRA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E14") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("tesouroCompras").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
'vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    titulo = Range("H4")
    qtde = Range("E14")
    puCompra = Range("E15")
    taxaAnual = Range("E16")
    vencimento = Range("E17")
    statusOperacao = Range("N4")
    saldoDisponivel = Range("H17")
    barraAlerta = Range("C8")

' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de compra
    data = Range("E12")
    codigoTesouro = UCase(Range("F6"))
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Compra de Ativos"
    origem = "Conta Corretora"
    destino = "Tesouro Nacional"
    finalidade = "Aumento Patrimonial"
    valorCompra = puCompra * qtde
    
' vari|fffd|veis para ordens pendentes
    tipoInvest = "Tesouro"
    tipoOrdem = Range("E13")

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de compra j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("tesouroCompras").Unprotect
        statusOperacao = "2"
        Sheets("tesouroCompras").Cells(4, 14) = statusOperacao
        Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If Range("H5") = "T|fffd|tulo indispon|fffd|vel" Then
            MsgBox "O t|fffd|tulo indicado est|fffd| indispon|fffd|vel para compras no momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F6").Activate
            Exit Sub
            Else
            
            If corretora = "#Selecionar" Then
                MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F5").Activate
                Exit Sub
                Else
                
                If titulo = "Selecione o ativo" Or titulo = "C|fffd|digo inv|fffd|lido" Then
                    MsgBox "C|fffd|digo do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("F6").Activate
                    Exit Sub
                    Else
                    
                    If qtde <= "0" Then
                        MsgBox "Quantidade de t|fffd|tulos inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                        
                        If puCompra <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If saldoDisponivel < valorCompra And valorCompra > 0 Or saldoDisponivel < valorBruto And valorBruto > 0 Then
                                MsgBox "Saldo insuficiente para esta opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E15").Activate
                                Exit Sub
                                Else
                                
                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    If data > Range("A1") Then
                                        MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("E12").Activate
                                        Exit Sub
                                        Else
                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal de compra
                                        Dim confirmaCompra As VbMsgBoxResult
                                        confirmaCompra = MsgBox("Deseja confirmar a compra de " & titulo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                        
                                        If confirmaCompra = vbNo Then
                                            Exit Sub
                                            Else
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA COMPRA NA TABELA
' loop para localizar linha vazia
                                            Sheets("tesouroCarteira").Unprotect
                                            Sheets("carteiraCaixa").Unprotect
                                            Sheets("tesouroCompras").Unprotect
                                            
' loop para localizar linha vazia
                                            If Sheets("tesouroCompras").Cells(23, 3) = "" Then
                                                contLinha = 23
                                                Else
                                                contLinha = Sheets("tesouroCompras").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                
                                            End If
                                            
' registra dados na tabela
                                            Sheets("tesouroCompras").Cells(contLinha, 3) = data
                                            Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro
                                            Sheets("tesouroCompras").Cells(contLinha, 6) = vencimento
                                            Sheets("tesouroCompras").Cells(contLinha, 7) = qtde
                                            Sheets("tesouroCompras").Cells(contLinha, 8) = puCompra
                                            Sheets("tesouroCompras").Cells(contLinha, 9) = taxaAnual
                                            Sheets("tesouroCompras").Cells(contLinha, 10) = valorCompra
                                            Sheets("tesouroCompras").Cells(contLinha, 14) = corretora
                                            
' reestabelece formato da coluna e classifica
                                            Range("tabTesouroCompras[Data]").NumberFormat = "dd/mm/yyyy"
                                            Range("tabTesouroCompras[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                            Call tesouroComprasClassificar
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS - RECOMPRA
' atribui c|fffd|digo do ativo |fffd| vari|fffd|vel e verifica se ativo comprado j|fffd| est|fffd| na carteira
                                            contLinha = 18
                                            Do Until Sheets("tesouroCarteira").Cells(contLinha, 3) = "" Or Sheets("tesouroCarteira").Cells(contLinha, 3) = codigoTesouro
                                            contLinha = contLinha + 1
                                            Loop
                                            
' verifica|fffd||fffd|o de nova compra e recompra
                                            If Sheets("tesouroCarteira").Cells(contLinha, 3) = codigoTesouro Then
                                            
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE RECOMPRA EM CAIXA
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Tesouro Nacional"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                    contLinha = 20
                                                    Else
                                                    contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                                                Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra

' reestabelece formato da coluna e classifica
                                                Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call carteiraCaixaClassificar
                                                Call carteiraCaixaID

' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro
                                                statusOperacao = "1"
                                                Sheets("tesouroCompras").Cells(4, 14) = statusOperacao
                                                
' bloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                Sheets("tesouroCompras").Activate
                                                ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                
                                                Range("F5").Select
                                                Call planAutoSave
                                                MsgBox "Recompra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                Exit Sub
                                                
                                                Else

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS - NOVA COMPRA
' registro de nova compra na carteira de t|fffd|tulos
                                                If Sheets("tesouroCarteira").Cells(contLinha, 3) <> codigoTesouro Then
                                                    Do Until Sheets("tesouroCarteira").Cells(contLinha, 3) = ""
                                                    contLinha = contLinha + 1
                                                    Loop
                                                    
                                                    Sheets("tesouroCarteira").Cells(contLinha, 3) = codigoTesouro
                                                    Range("tabTesouroCarteira[Vencimento]").NumberFormat = "dd/mm/yyyy"
                                                    
' ajusta r|fffd|tulo de gr|fffd|fico principal da carteira
                                                    If Sheets("tesouroCarteira").Cells(18, 3) <> "" And Sheets("tesouroCarteira").Cells(19, 3) = "" Then
                                                        Call tesouroCarteiraAjustarGrafico
                                                        Else
                                                        
                                                    End If
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE NOVA COMPRA EM CAIXA
' v|fffd|nculo com tabela de movimenta|fffd||fffd|o de caixa e inser|fffd||fffd|o de par|fffd|metros
' tipoOperacao = "Compra de Ativos"
' origem = "Conta Corretora"
' destino = "Tesouro Nacional"
' finalidade = "Aumento Patrimonial"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra compra na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorCompra

' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza registro de compra e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = ordem pendente
' status <> = erro

                                                    statusOperacao = "1"
                                                    Sheets("tesouroCompras").Cells(4, 14) = statusOperacao
                                            
' bloqueia planilhas em uso
                                                    Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("tesouroCompras").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Nova compra efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub tesouroComprasLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE COMPRA
' reseta valores dos campos
    Sheets("tesouroCompras").Cells(15, 5) = "0"
    Sheets("tesouroCompras").Cells(16, 5) = "0"
    Sheets("tesouroCompras").Cells(18, 5) = "0"
    
End Sub
Sub tesouroComprasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E15") = 0 And Range("E16") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("tesouroCompras").Unprotect
        
        If Range("E18") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("tesouroCompras").Cells(5, 6) = "#Selecionar"
            Sheets("tesouroCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("tesouroCompras").Cells(14, 5) = "0"
            Sheets("tesouroCompras").Cells(15, 5) = "0"
            Sheets("tesouroCompras").Cells(16, 5) = "0"
            Sheets("tesouroCompras").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("tesouroCompras").Cells(5, 6) = "#Selecionar"
            Sheets("tesouroCompras").Cells(6, 6) = "#C|fffd|digo"
            Sheets("tesouroCompras").Cells(14, 5) = "0"
            Sheets("tesouroCompras").Cells(15, 5) = "0"
            Sheets("tesouroCompras").Cells(16, 5) = "0"
            Sheets("tesouroCompras").Cells(4, 14) = "0"
            
            Range("F5").Select
            Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    
End Sub
Sub tesouroComprasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA COMPRAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoTesouro = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoTesouro = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoTesouro = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("tesouroCompras").Unprotect
                Range("tabTesouroCompras[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabTesouroCompras").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("tesouroCompras").Cells(contLinha, 3) = "" Or Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro
                contLinha = contLinha + 1
                Loop
                
                If Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro Then
                    Sheets("tesouroCompras").Unprotect
                    Range("tabTesouroCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabTesouroCompras").Range.AutoFilter Field:=2, Criteria1:=codigoTesouro
                    
                    Sheets("tesouroCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma compra realizada para " & codigoTesouro & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("tesouroCompras").Cells(contLinha, 3) = "" Or Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro
                contLinha = contLinha + 1
                Loop
                
                If Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro Then
                    Sheets("tesouroCompras").Unprotect
                    Range("tabTesouroCompras[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabTesouroCompras").Range.AutoFilter Field:=2, Criteria1:=codigoTesouro
                    
                    Sheets("tesouroCompras").Cells(21, 14) = "Limpar filtro"
                    Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma compra realizada para " & codigoTesouro & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub tesouroComprasLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("tesouroCompras").Unprotect
        Range("tabTesouroCompras[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabTesouroCompras").Range.AutoFilter Field:=1
        
        Sheets("tesouroCompras").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub tesouroComprasClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE COMPRAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("tesouroCompras").ListObjects("tabTesouroCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("tesouroCompras").ListObjects("tabTesouroCompras").Sort. _
        SortFields.Add Key:=Range("tabTesouroCompras[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("tesouroCompras").ListObjects("tabTesouroCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("tesouroCompras").ListObjects("tabTesouroCompras").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("tesouroCompras").ListObjects("tabTesouroCompras").Sort. _
        SortFields.Add Key:=Range("tabTesouroCompras[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("tesouroCompras").ListObjects("tabTesouroCompras").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub



Attribute VB_Name = "M_TesouroJuros"
Sub tesouroJurosRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVO CUPOM
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("I9") = "Erro" Or Range("M6") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("tesouroJuros").Cells(28, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    titulo = Range("E6")
    validaData = Range("A1")
    
' vari|fffd|veis para registro de recebimento
    data = Range("I7")
    codigoTesouro = UCase(Range("D6"))
    valorCupom = Range("I8")
    valorLiq = Range("I9")
    valorImposto = valorCupom - valorLiq
    patrimonio = Range("E8")
    statusOperacao = Range("N4")
    barraAlerta = Range("C12")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoInvest = "Tesouro"
    tipoOperacao = "Recebimento"
    origem = "Proventos de Ativos"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    corretora = Range("I5")

' gerenciamento de erro de vari|fffd|vel (div/0)
    If valorCupom = 0 Or Range("C11") = 0 Then
        valorUnit = 0
        Else
        valorUnit = valorCupom / Range("C11")
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Este recebimento j|fffd| foi cadastrado. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else

        If corretora = "#Selecionar" Then
           MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
           Range("I5").Activate
           Exit Sub
           Else
                
            If titulo = "Selecione o t|fffd|tulo" Or titulo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("D6").Activate
                Exit Sub
                Else
                
                If barraAlerta = "Ops! Aconteceu um erro:" Or barraAlerta = "T|fffd|tulo inv|fffd|lido:" Then
                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
                    If valorCupom <= "0" And valorLiq <= "0" Then
                        MsgBox "Valor de recebimento inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("I8").Activate
                        Exit Sub
                        Else
                        
' valida|fffd||fffd|o para evitar duplicidade de registro
                        contLinha = 24
                        Do Until Sheets("tesouroJuros").Cells(contLinha, 3) = "" Or Sheets("tesouroJuros").Cells(contLinha, 4) = data And _
                        Sheets("tesouroJuros").Cells(contLinha, 5) = codigoTesouro And Sheets("tesouroJuros").Cells(contLinha, 9) = valorCupom
                        contLinha = contLinha + 1
                        Loop
                        
                        If Sheets("tesouroJuros").Cells(contLinha, 4) = data And Sheets("tesouroJuros").Cells(contLinha, 5) = codigoTesouro And _
                        Sheets("tesouroJuros").Cells(contLinha, 9) = valorCupom Then
                        
                            Call tesouroJurosNovoRecebimento
                            MsgBox "Este recebimento j|fffd| foi cadastrado. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Exit Sub
                            
                            Else
                        End If

' valida|fffd||fffd|o principal de recebimento
                        Dim confirmaRecebimento As VbMsgBoxResult
                        confirmaRecebimento = MsgBox("Deseja confirmar o recebimento de " & titulo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                        If confirmaRecebimento = vbNo Then
                            Exit Sub
                            Else
    
'*************************************************************************************************************************** REGISTRA RECEBIMENTO NA TABELA
' loop para localizar linha vazia
                            Sheets("carteiraCaixa").Unprotect
                            Sheets("tesouroJuros").Unprotect
                            
' loop para localizar linha vazia
                            If Sheets("tesouroJuros").Cells(24, 3) = "" Then
                                contLinha = 24
                                Else
                                contLinha = Sheets("tesouroJuros").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                
                            End If
                            
' registra recebimento na tabela de proventos
                            Sheets("tesouroJuros").Cells(contLinha, 4) = data
                            Sheets("tesouroJuros").Cells(contLinha, 5) = codigoTesouro
                            Sheets("tesouroJuros").Cells(contLinha, 7) = patrimonio
                            Sheets("tesouroJuros").Cells(contLinha, 8) = valorCupom
                            Sheets("tesouroJuros").Cells(contLinha, 9) = valorImposto
                            Sheets("tesouroJuros").Cells(contLinha, 11) = valorUnit
                            Sheets("tesouroJuros").Cells(contLinha, 13) = corretora

' reestabelece formato da coluna e classifica
                            Range("tabTesouroJuros[Data Pgto.]").NumberFormat = "dd/mm/yyyy"
                            Call tesouroJurosClassificar

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA RECEBIMENTO EM CAIXA
' tipoOperacao = "Recebimento"
' origem = "Proventos de Ativos"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                            If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                contLinha = 20
                                Else
                                contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                
                            End If
                            
' registra provento na tabela de opera|fffd||fffd|es do caixa
                            Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                            Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                            Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                            Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                            Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                            Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                            Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                            Sheets("carteiraCaixa").Cells(contLinha, 11) = corretora
                            Sheets("carteiraCaixa").Cells(contLinha, 12) = valorCupom
                            Sheets("carteiraCaixa").Cells(contLinha, 13) = valorLiq

' reestabelece formato da coluna e classifica
                            Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                            Call carteiraCaixaClassificar
                            Call carteiraCaixaID

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' status 0 = em branco / em andamento
' status 1 = recebimento confirmado
' status 2 = recebimento pendente
' status 3 = erro

' finaliza opera|fffd||fffd|o e altera status do recebimento
                            Sheets("tesouroJuros").Select

                            If data <= validaData Then
                                statusOperacao = "1"
                                Sheets("tesouroJuros").Cells(4, 14) = statusOperacao
        
                                Else
                                statusOperacao = "2"
                                Sheets("tesouroJuros").Cells(4, 14) = statusOperacao
        
                            End If
                            
' bloqueia planilhas em uso
                            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Sheets("tesouroJuros").Activate
                            Range("D6").Select
                            ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            
' valida modo de registro |fffd|nico ou sequencial
                            If Range("N3") = "|fffd|nico" Then
                                Range("D6").Select
                                Call planAutoSave
                                MsgBox "Recebimento registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
                                Call tesouroJurosNovoRecebimento
                                Range("I5") = corretora
                                MsgBox "Recebimento registrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
' finaliza|fffd||fffd|o geral
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub tesouroJurosLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA RECEBIMENTO
' reseta valores dos campos
    Sheets("tesouroJuros").Cells(8, 9) = "0"

End Sub
Sub tesouroJurosNovoRecebimento()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVO RECEBIMENTO COM ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("D6") = "#C|fffd|digo" And Range("I5") = "#Selecionar" And Range("I9") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("tesouroJuros").Unprotect
        
        If Range("I9") = "Erro" Then
            Range("I8") = "0"
            Range("I10") = "0"
            
' reseta valores dos campos
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("tesouroJuros").Cells(6, 4) = "#C|fffd|digo"
            Sheets("tesouroJuros").Cells(5, 9) = "#Selecionar"
            Sheets("tesouroJuros").Cells(8, 9) = "0"
            Sheets("tesouroJuros").Cells(4, 14) = "0"
            
            Range("D6").Select
            Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVO RECEBIMENTO SEM ERROS
' reseta valores dos campos
            Range("I7").FormulaR1C1 = "=TODAY()"
            Sheets("tesouroJuros").Cells(6, 4) = "#C|fffd|digo"
            Sheets("tesouroJuros").Cells(5, 9) = "#Selecionar"
            Sheets("tesouroJuros").Cells(8, 9) = "0"
            Sheets("tesouroJuros").Cells(4, 14) = "0"
            
            Range("D6").Select
            Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub tesouroJurosFiltrarRendimentosAno()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RECEBIMENTOS DO ANO CORRENTE
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    ano = Range("M22")
    
' valida c|fffd|digo do ativo para filtro
    Sheets("tesouroJuros").Unprotect
    Range("tabTesouroJuros[[#Headers],[Ano]]").Select
    ActiveSheet.ListObjects("tabTesouroJuros").Range.AutoFilter Field:=1, Criteria1:=ano
    
    Sheets("tesouroJuros").Cells(22, 14) = "Limpar filtro"
    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
    
End Sub
Sub tesouroJurosFiltrarRendimentos()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA RENDIMENTOS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoTesouro = UCase(Range("F22"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoTesouro = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoTesouro = "" Then
            Range("F22") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("tesouroJuros").Unprotect
                Range("tabTesouroJuros[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabTesouroJuros").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("F22").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("tesouroJuros").Cells(contLinha, 3) = "" Or Sheets("tesouroJuros").Cells(contLinha, 4) = codigoTesouro
                contLinha = contLinha + 1
                Loop
                
                If Sheets("tesouroJuros").Cells(contLinha, 4) = codigoTesouro Then
                    Sheets("tesouroJuros").Unprotect
                    Range("tabTesouroJuros[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabTesouroJuros").Range.AutoFilter Field:=3, Criteria1:=codigoTesouro
                    
                    Sheets("tesouroJuros").Cells(21, 14) = "Limpar filtro"
                    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
                    Else
                    Range("F22") = "#C|fffd|digo"
                    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhum cupom recebido de " & codigoTesouro & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 24
                Do Until Sheets("tesouroJuros").Cells(contLinha, 3) = "" Or Sheets("tesouroJuros").Cells(contLinha, 5) = codigoTesouro
                contLinha = contLinha + 1
                Loop
                
                If Sheets("tesouroJuros").Cells(contLinha, 5) = codigoTesouro Then
                    Sheets("tesouroJuros").Unprotect
                    Range("tabTesouroJuros[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabTesouroJuros").Range.AutoFilter Field:=3, Criteria1:=codigoTesouro
                    
                    Sheets("tesouroJuros").Cells(22, 14) = "Limpar filtro"
                    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Else
                    
                    Range("F22") = "#C|fffd|digo"
                    MsgBox "Nenhum cupom recebido de " & codigoTesouro & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                
                End If
            End If
        End If
    End If
    
End Sub
Sub tesouroJurosLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE RECEBIMENTOS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N22") = "Limpar filtro" Then
        Sheets("tesouroJuros").Unprotect
        Range("tabTesouroJuros[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabTesouroJuros").Range.AutoFilter Field:=1
        
        Sheets("tesouroJuros").Cells(22, 14) = "Filtrar"
        Selection.AutoFilter
        Range("F22") = "#C|fffd|digo"
        Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("F22") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
End Sub
Sub tesouroJurosClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICAR TABELA DE RENDIMENTOS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("tesouroJuros").ListObjects("tabTesouroJuros").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("tesouroJuros").ListObjects("tabTesouroJuros").Sort. _
        SortFields.Add Key:=Range("tabTesouroJuros[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("tesouroJuros").ListObjects("tabTesouroJuros").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de compra
    ActiveWorkbook.Worksheets("tesouroJuros").ListObjects("tabTesouroJuros").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("tesouroJuros").ListObjects("tabTesouroJuros").Sort. _
        SortFields.Add Key:=Range("tabTesouroJuros[[#Headers],[Data Pgto.]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("tesouroJuros").ListObjects("tabTesouroJuros").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_TesouroVendas"
Sub tesouroVendasRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVA ORDEM DE VENDA
'*************************************************************************************************************************** GERENCIADOR DE ERROS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida campos com dados inv|fffd|lidos
    If Range("E16") = "Erro" Then
        MsgBox "Tipo de caractere inv|fffd|lido. Use apenas n|fffd|meros.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
    End If
    
'*************************************************************************************************************************** LIMITA VERS|fffd|O FREE
' valida limite de registros da vers|fffd|o Free
    Call planValidaVersao
    
    If versaoLimitada = "Sim" Then
        If Sheets("tesouroVendas").Cells(27, 3) <> "" Then
            MsgBox "Ops! Seu limite de registros foi atingido. Acesse nosso site e obtenha a  vers|fffd|o Premium para registros ilimitados.", _
            vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        Else
        
    End If
    
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis para valida|fffd||fffd|o de campos
    corretora = Range("F5")
    titulo = Range("H4")
    qtde = Range("E14")
    vencimento = Range("E17")
    qtdeLimite = Range("M12")
    puVenda = Range("E15")
    valorVenda = Range("E18")
    alertaPrejuizo = Range("M13")
    statusOperacao = Range("N4")
    barraAlerta = Range("C8")
    
' vari|fffd|veis para acesso |fffd| corretora
    validaData = Range("A1")

' vari|fffd|veis para efetiva|fffd||fffd|o de venda
    data = Range("E12")
    codigoTesouro = UCase(Range("F6"))
    pmCompra = Range("H13")
    
' vari|fffd|veis para registro da opera|fffd||fffd|o no caixa
    tipoOperacao = "Venda de Ativos"
    origem = "Tesouro Nacional"
    destino = "Conta Corretora"
    finalidade = "Investimento Futuro"
    valorBruto = puVenda * qtde

' vari|fffd|veis para ordens pendentes
    tipoInvest = "Tesouro"
    tipoOrdem = Range("E13")
    
    If tipoOrdem = "Venda total" Or tipoOrdem = "Resgate total" Then
        ghostCell = "*"
        Else
        ghostCell = ""
    
    End If
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
    If statusOperacao <> "0" Then
        MsgBox "Esta ordem de venda j|fffd| foi cadastrada. Inicie outra opera|fffd||fffd|o.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
        Sheets("tesouroVendas").Unprotect
        statusOperacao = "2"
        Sheets("tesouroVendas").Cells(4, 14) = statusOperacao
        Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Range("F5").Activate
            Exit Sub
            Else
            
            If titulo = "Selecione o t|fffd|tulo" Or titulo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Range("F6").Activate
                Exit Sub
                Else
                
                If qtde <= "0" Then
                    MsgBox "Quantidade de t|fffd|tulos inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Range("E14").Activate
                    Exit Sub
                    Else
                    
                    If qtdeLimite < "0" Then
                        MsgBox "Quantidade de t|fffd|tulos indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Range("E14").Activate
                        Exit Sub
                        Else
                        
                        If puVenda <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio do t|fffd|tulo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Range("E15").Activate
                            Exit Sub
                            Else
                            
                            If valorVenda <= 0 Then
                                MsgBox "Informe o valor total da opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Range("E18").Activate
                                Exit Sub
                                Else
                            
                                If barraAlerta = "Ops! Aconteceu um erro:" Then
                                    MsgBox "Foi encontrado um erro na Opera|fffd||fffd|o." & vbNewLine & "Por favor, leia o alerta na tela.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    Else
                                    
                                    If data > Range("A1") Then
                                        MsgBox "A data da opera|fffd||fffd|o n|fffd|o pode ser agendada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                        Range("E12").Activate
                                        Exit Sub
                                        Else
                                        
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' valida|fffd||fffd|o principal para venda
                                        Dim confirmaVenda As VbMsgBoxResult
                                        confirmaVenda = MsgBox("Deseja confirmar a venda de " & titulo & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
                                        If confirmaVenda = vbNo Then
                                            Exit Sub
                                            Else
                                            
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA SEM PREJU|fffd|ZO
' alerta de venda sem preju|fffd|zo
                                            If alertaPrejuizo >= "0" Then
    
' desbloqueia planilhas em uso
                                                Sheets("carteiraCaixa").Unprotect
                                                Sheets("tesouroVendas").Unprotect
                                                Sheets("tesouroCarteira").Unprotect
                                            
' loop para localizar linha vazia
                                                If Sheets("tesouroVendas").Cells(23, 3) = "" Then
                                                    contLinha = 23
                                                    Else
                                                    contLinha = Sheets("tesouroVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                    
                                                End If
                                                
' registra dados na tabela
                                                Sheets("tesouroVendas").Cells(contLinha, 3) = data
                                                Sheets("tesouroVendas").Cells(contLinha, 4) = codigoTesouro
                                                Sheets("tesouroVendas").Cells(contLinha, 6) = vencimento
                                                Sheets("tesouroVendas").Cells(contLinha, 8) = puVenda
                                                Sheets("tesouroVendas").Cells(contLinha, 9) = pmCompra
                                                Sheets("tesouroVendas").Cells(contLinha, 7) = qtde
                                                Sheets("tesouroVendas").Cells(contLinha, 11) = valorVenda
                                                Sheets("tesouroVendas").Cells(contLinha, 14) = ghostCell & corretora
    
' reestabelece formato da coluna e classifica
                                                Range("tabTesouroVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                Call tesouroVendasClassificar
                                                
' ajusta ghostcell
                                                Call ajustaGhostCell
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS EM VENDA PARCIAL SEM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                contLinha = 18
                                                Do Until Sheets("tesouroCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("tesouroCarteira").Cells(contLinha, 6) = 0
                                                contLinha = contLinha + 1
                                                Loop
                                                
                                                If Sheets("tesouroCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("tesouroCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Tesouro Nacional"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
                                                
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                    statusOperacao = "1"
                                                    Sheets("tesouroVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("tesouroVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                    Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS EM VENDA TOTAL SEM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("tesouroVendas").Unprotect
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("tesouroCompras").Unprotect
                                                    Sheets("tesouroCarteira").Unprotect
                                                    Sheets("tesouroJuros").Unprotect
    
' localiza linha com status "vendido" na carteira
                                                    contLinha = 18
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("tesouroCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("tesouroCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    tabLinha = tabLinha + 1
                                                    Loop
                                                    
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                    If Sheets("tesouroCarteira").Cells(contLinha, 3) = codigoTesouro And Sheets("tesouroCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                        Sheets("tesouroCarteira").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                    
                                                    End If
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DO T|fffd|TULO VENDIDO
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                    contLinha = 23
                                                    tabLinha = ((contLinha * -1) + 1) + contLinha
                                                    Do Until Sheets("tesouroCompras").Cells(contLinha, 3) = ""
                                                    
                                                    If Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro Then
                                                        Sheets("tesouroCompras").Activate
                                                        Cells(contLinha, 3).Select
                                                        Selection.ListObject.ListRows(tabLinha).Delete
                                                        Else
                                                        
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        
                                                    End If
                                                    Loop
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA SEM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Tesouro Nacional"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                    If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                        contLinha = 20
                                                        Else
                                                        contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                    Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                    Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                    Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                    Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                    Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                    Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                    Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                                                    Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                    Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                    Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                    Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call carteiraCaixaClassificar
                                                    Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
    
                                                    statusOperacao = "1"
                                                    Sheets("tesouroVendas").Cells(4, 14) = statusOperacao
                                                    
' bloqueia planilhas em uso
                                                    Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("tesouroJuros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    Sheets("tesouroVendas").Activate
                                                    ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                    
                                                    Range("F5").Select
                                                    Call planAutoSave
                                                    MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                    Exit Sub
                                                    
                                                End If
                                                Else
                                                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES DE VENDA COM PREJU|fffd|ZO
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES FINAIS
' alerta de venda com preju|fffd|zo
                                                validaPrejuizo = MsgBox("Esta venda causar|fffd| preju|fffd|zo em sua carteira. Deseja continuar?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                                
                                                If validaPrejuizo = vbNo Then
                                                    Exit Sub
                                                    Else
                                                    
'*************************************************************************************************************************** REGISTRA VENDA NA TABELA COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                    Sheets("tesouroCarteira").Unprotect
                                                    Sheets("carteiraCaixa").Unprotect
                                                    Sheets("tesouroVendas").Unprotect
    
' loop para localizar linha vazia
                                                    If Sheets("tesouroVendas").Cells(23, 3) = "" Then
                                                        contLinha = 23
                                                        Else
                                                        contLinha = Sheets("tesouroVendas").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                        
                                                    End If
                                                    
' registra dados na tabela
                                                    Sheets("tesouroVendas").Cells(contLinha, 3) = data
                                                    Sheets("tesouroVendas").Cells(contLinha, 4) = codigoTesouro
                                                    Sheets("tesouroVendas").Cells(contLinha, 6) = vencimento
                                                    Sheets("tesouroVendas").Cells(contLinha, 8) = puVenda
                                                    Sheets("tesouroVendas").Cells(contLinha, 9) = puVenda
                                                    Sheets("tesouroVendas").Cells(contLinha, 11) = valorVenda
                                                    Sheets("tesouroVendas").Cells(contLinha, 7) = qtde
                                                    Sheets("tesouroVendas").Cells(contLinha, 14) = ghostCell & corretora
                                                    
' reestabelece formato da coluna e classifica
                                                    Range("tabTesouroVendas[Data]").NumberFormat = "dd/mm/yyyy"
                                                    Call tesouroVendasClassificar
                                                    
' ajusta ghostcell
                                                    Call ajustaGhostCell
                                                    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERIFICA CARTEIRA DE T|fffd|TULOS EM VENDA PARCIAL COM PREJU|fffd|ZO
' localiza linha sem status "vendido" na carteira
                                                    contLinha = 18
                                                    Do Until Sheets("tesouroCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("tesouroCarteira").Cells(contLinha, 6) = 0
                                                    contLinha = contLinha + 1
                                                    Loop
                                                    
                                                    If Sheets("tesouroCarteira").Cells(contLinha, 12) <> "Vendido" Or Sheets("tesouroCarteira").Cells(contLinha, 6) <> 0 Then
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA PARCIAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Tesouro Nacional"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
' finaliza opera|fffd||fffd|o de venda e altera status
' status 0 = em branco / em andamento
' status 1 = ordem confirmada
' status 2 = ordem finalizada
' status 3 = pendente
' status <> = erro
                                                    
                                                        statusOperacao = "1"
                                                        Sheets("tesouroVendas").Cells(4, 14) = statusOperacao
    
' bloqueia planilhas em uso
                                                        Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("tesouroVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda parcial efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                        Else
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA CARTEIRA DE T|fffd|TULOS - VENDA TOTAL COM PREJU|fffd|ZO
' desbloqueia planilhas em uso
                                                        Sheets("carteiraCaixa").Unprotect
                                                        Sheets("tesouroVendas").Unprotect
                                                        Sheets("tesouroCompras").Unprotect
                                                        Sheets("tesouroCarteira").Unprotect
                                                        Sheets("tesouroJuros").Unprotect
    
' localiza linha com status "vendido" na carteira
                                                        contLinha = 18
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("tesouroCarteira").Cells(contLinha, 12) = "Vendido" Or Sheets("tesouroCarteira").Cells(contLinha, 6) = 0
                                                        contLinha = contLinha + 1
                                                        tabLinha = tabLinha + 1
                                                        Loop
                                                    
' deleta ativo da carteira ap|fffd|s registro de venda total
                                                        If Sheets("tesouroCarteira").Cells(contLinha, 3) = codigoTesouro And Sheets("tesouroCarteira").Cells(contLinha, 12) = "Vendido" Then
                                                            Sheets("tesouroCarteira").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            Else
                                                        
                                                        End If
                                                        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE COMPRAS EFETUADAS DO T|fffd|TULO VENDIDO
' deleta compras realizadas com o c|fffd|digo do ativo vendido
                                                        contLinha = 23
                                                        tabLinha = ((contLinha * -1) + 1) + contLinha
                                                        Do Until Sheets("tesouroCompras").Cells(contLinha, 3) = ""
                                                        
                                                        If Sheets("tesouroCompras").Cells(contLinha, 4) = codigoTesouro Then
                                                            Sheets("tesouroCompras").Activate
                                                            Cells(contLinha, 3).Select
                                                            Selection.ListObject.ListRows(tabLinha).Delete
                                                            
                                                            Else
                                                            contLinha = contLinha + 1
                                                            tabLinha = tabLinha + 1
                                                            
                                                        End If
                                                        Loop
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA REGISTRO DE VENDA TOTAL EM CAIXA COM PREJU|fffd|ZO
' tipoOperacao = "Venda de Ativos"
' origem = "Tesouro Nacional"
' destino = "Conta Corretora"
' finalidade = "Investimento Futuro"

' loop para localizar linha vazia
                                                        If Sheets("carteiraCaixa").Cells(20, 3) = "" Then
                                                            contLinha = 20
                                                            Else
                                                            contLinha = Sheets("carteiraCaixa").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                                            
                                                        End If
                                                        
' registra venda na tabela de opera|fffd||fffd|es do caixa
                                                        Sheets("carteiraCaixa").Cells(contLinha, 4) = data
                                                        Sheets("carteiraCaixa").Cells(contLinha, 5) = tipoInvest
                                                        Sheets("carteiraCaixa").Cells(contLinha, 6) = tipoOperacao
                                                        Sheets("carteiraCaixa").Cells(contLinha, 7) = origem
                                                        Sheets("carteiraCaixa").Cells(contLinha, 8) = destino
                                                        Sheets("carteiraCaixa").Cells(contLinha, 9) = finalidade
                                                        Sheets("carteiraCaixa").Cells(contLinha, 10) = codigoTesouro
                                                        Sheets("carteiraCaixa").Cells(contLinha, 11) = Replace(corretora, "*", "")
                                                        Sheets("carteiraCaixa").Cells(contLinha, 12) = valorBruto
                                                        Sheets("carteiraCaixa").Cells(contLinha, 13) = valorVenda
    
' reestabelece formato da coluna e classifica
                                                        Range("tabCarteiraCaixaOpera|fffd||fffd|es[Data]").NumberFormat = "dd/mm/yyyy"
                                                        Call carteiraCaixaClassificar
                                                        Call carteiraCaixaID
    
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ENCERRAMENTO GERAL
' finaliza status da opera|fffd||fffd|o na tabela de venda
                                                        
                                                        statusOperacao = "1"
                                                        Sheets("tesouroVendas").Cells(4, 14) = statusOperacao
                                                        
' bloqueia planilhas em uso
                                                        Sheets("tesouroCarteira").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("tesouroCompras").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        Sheets("tesouroVendas").Activate
                                                        ActiveSheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                                        
                                                        Range("F5").Select
                                                        Call planAutoSave
                                                        MsgBox "Venda total efetuada com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                                        Exit Sub
                                                        
                                                    End If
                                                End If
                                            End If
                                        End If
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Sub tesouroVendasLimpar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA ORDEM DE VENDA
' reseta valores dos campos
    Sheets("tesouroVendas").Cells(14, 5) = "0"
    Sheets("tesouroVendas").Cells(15, 5) = "0"
    Sheets("tesouroVendas").Cells(18, 5) = "0"
    
End Sub
Sub tesouroLimparHistorico()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA HIST|fffd|RICO DE VENDAS
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' verifica se h|fffd| vendas totais registradas
    If Sheets("tesouroVendas").Cells(23, 3) = "" Then
        MsgBox "Nenhuma venda total registrada at|fffd| o momento.", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' confirma limpeza
        Dim confirmaLimpeza As VbMsgBoxResult
        confirmaLimpeza = MsgBox("Deseja limpar o hist|fffd|rico de vendas totais?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaLimpeza = vbNo Then
            Exit Sub
            Else
            
' limpa hist|fffd|rico de vendas totais
            contLinha = 23
            Sheets("tesouroVendas").Unprotect
            
            Do Until Sheets("tesouroVendas").Cells(contLinha, 3) = ""
            If Sheets("tesouroVendas").Cells(contLinha, 16) = "" Then
                contLinha = contLinha + 1
                Else
                
                Sheets("tesouroVendas").Activate
                Sheets("tesouroVendas").Cells(contLinha, 16) = ""
                Cells(contLinha, 3).Select
                Rows(contLinha).EntireRow.Delete
            
            End If
            Loop
            
            Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Call planAutoSave
            MsgBox "Hist|fffd|rico de vendas removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub tesouroVendasNovaOrdem()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA ORDEM EM CASO DE ERROS
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("F6") = "#C|fffd|digo" And Range("E15") = 0 And Range("E16") = 0 Then
        Exit Sub
        Else
        
' gerenciador de falhas de caracteres inv|fffd|lidos
        Sheets("tesouroVendas").Unprotect
        
        If Range("E16") = "Erro" Then
            Range("E14") = "0"
            Range("E15") = "0"
            
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("tesouroVendas").Cells(5, 6) = "#Selecionar"
            Sheets("tesouroVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("tesouroVendas").Cells(14, 5) = "0"
            Sheets("tesouroVendas").Cells(15, 5) = "0"
            Sheets("tesouroVendas").Cells(18, 5) = "0"
            Sheets("tesouroVendas").Cells(4, 14) = "0"
            
            Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Else
            
'*************************************************************************************************************************** GERA NOVA ORDEM SEM ERROS
' reseta valores dos campos
            Range("E12").FormulaR1C1 = "=TODAY()"
            Sheets("tesouroVendas").Cells(5, 6) = "#Selecionar"
            Sheets("tesouroVendas").Cells(6, 6) = "#C|fffd|digo"
            Sheets("tesouroVendas").Cells(14, 5) = "0"
            Sheets("tesouroVendas").Cells(15, 5) = "0"
            Sheets("tesouroVendas").Cells(18, 5) = "0"
            Sheets("tesouroVendas").Cells(4, 14) = "0"
            
            Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
End Sub
Sub tesouroVendasFiltrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FILTRA VENDAS DE UM DETERMINADO ATIVO
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' vari|fffd|veis
    codigoTesouro = UCase(Range("E21"))
    
' valida c|fffd|digo do ativo para filtro
    If codigoTesouro = "#C|fffd|DIGO" Then
        MsgBox "Selecione um ativo para filtrar.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoTesouro = "" Then
            Range("E21") = "#C|fffd|digo"
            Exit Sub
            Else
            
' valida filtro em sobreposi|fffd||fffd|o
            If Range("N21") = "Limpar filtro" Then
                
                Sheets("tesouroVendas").Unprotect
                Range("tabTesouroVendas[[#Headers],[C|fffd|digo]]").Select
                ActiveSheet.ListObjects("tabTesouroVendas").Range.AutoFilter Field:=1
                Selection.AutoFilter
                Range("E21").Activate
                
' valida campo de capta|fffd||fffd|o do ativo
                contLinha = 23
                Do Until Sheets("tesouroVendas").Cells(contLinha, 3) = "" Or Sheets("tesouroVendas").Cells(contLinha, 4) = codigoTesouro
                contLinha = contLinha + 1
                Loop
                
                If Sheets("tesouroVendas").Cells(contLinha, 4) = codigoTesouro Then
                    Sheets("tesouroVendas").Unprotect
                    Range("tabTesouroVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabTesouroVendas").Range.AutoFilter Field:=2, Criteria1:=codigoTesouro
                    
                    Sheets("tesouroVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    MsgBox "Nenhuma venda realizada para " & codigoTesouro & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
                Else
                
' valida campo de capta|fffd||fffd|o do filtro e define modo filtro
                contLinha = 23
                Do Until Sheets("tesouroVendas").Cells(contLinha, 3) = "" Or Sheets("tesouroVendas").Cells(contLinha, 4) = codigoTesouro
                contLinha = contLinha + 1
                Loop
                
                If Sheets("tesouroVendas").Cells(contLinha, 4) = codigoTesouro Then
                    Sheets("tesouroVendas").Unprotect
                    Range("tabTesouroVendas[[#Headers],[C|fffd|digo]]").Select
                    ActiveSheet.ListObjects("tabTesouroVendas").Range.AutoFilter Field:=2, Criteria1:=codigoTesouro
                    
                    Sheets("tesouroVendas").Cells(21, 14) = "Limpar filtro"
                    Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("E21").Activate
                    
                    Else
                    Range("E21") = "#C|fffd|digo"
                    MsgBox "Nenhuma venda realizada para " & codigoTesouro & ".", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
        End If
    End If
    
End Sub
Sub tesouroVendasLimparFiltro()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LIMPA FILTRO DE COMPRAS
' valida campo de capta|fffd||fffd|o do filtro e define modo para limpeza de filtro
    If Range("N21") = "Limpar filtro" Then
        Sheets("tesouroVendas").Unprotect
        Range("tabTesouroVendas[[#Headers],[C|fffd|digo]]").Select
        ActiveSheet.ListObjects("tabTesouroVendas").Range.AutoFilter Field:=1
        
        Sheets("tesouroVendas").Cells(21, 14) = "Filtrar"
        Selection.AutoFilter
        Range("E21") = "#C|fffd|digo"
        Sheets("tesouroVendas").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Else
        Range("E21") = "#C|fffd|digo"
        MsgBox "Nenhum filtro aplicado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Sub tesouroVendasClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE VENDAS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("tesouroVendas").ListObjects("tabTesouroVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("tesouroVendas").ListObjects("tabTesouroVendas").Sort. _
        SortFields.Add Key:=Range("tabTesouroVendas[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("tesouroVendas").ListObjects("tabTesouroVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por data de venda
    ActiveWorkbook.Worksheets("tesouroVendas").ListObjects("tabTesouroVendas").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("tesouroVendas").ListObjects("tabTesouroVendas").Sort. _
        SortFields.Add Key:=Range("tabTesouroVendas[[#Headers],[Data]]"), SortOn:= _
        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("tesouroVendas").ListObjects("tabTesouroVendas").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub
Attribute VB_Name = "M_ToolsCompara"
Sub toolsComparaAdicionar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis
    valorInvest = Range("E5")
    prazoInvest = Range("E6")
    tipoInvest = Range("E8")
    indexador = Range("E9")
    taxaRentab = Range("E10")
    taxaRentabAdicional = Range("E11")
    taxaAdm = Range("F13")
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
' valida campos de preenchimento
    If valorInvest <= 0 Or prazoInvest <= 0 Then
        MsgBox "Informe o valor e o prazo do investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If tipoInvest = "#Selecionar" Then
            MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            If indexador = "#Selecionar" Then
                MsgBox "Selecione o indexador do investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If taxaRentab <= "0" Then
                    MsgBox "Informe a taxa de rentabilidade anual do investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
' verifica se ativo j|fffd| est|fffd| cadastrado na tabela, evitando duplicidade
                    contLinha = 20
                    Do Until Sheets("toolsCompara").Cells(contLinha, 3) = "" Or Sheets("toolsCompara").Cells(contLinha, 3) = tipoInvest And _
                    Sheets("toolsCompara").Cells(contLinha, 4) = indexador And Sheets("toolsCompara").Cells(contLinha, 6) = taxaRentab
                    contLinha = contLinha + 1
                    Loop
                    
                    If Sheets("toolsCompara").Cells(contLinha, 3) = tipoInvest And Sheets("toolsCompara").Cells(contLinha, 4) = indexador And _
                    Sheets("toolsCompara").Cells(contLinha, 6) = taxaRentab And Sheets("toolsCompara").Cells(contLinha, 7) = taxaRentabAdicional Then
                        MsgBox "O investimento indicado j|fffd| est|fffd| registrado no comparativo.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
                    End If
                    
'*************************************************************************************************************************** REGISTRO DE ATIVO
' confirma|fffd||fffd|o para registro dos dados
                    Dim confirmaComparacao As VbMsgBoxResult
                    confirmaComparacao = MsgBox("Deseja incluir o ativo " & tipoInvest & " |fffd| compara|fffd||fffd|o?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                    
                    If confirmaComparacao = vbNo Then
                        Exit Sub
                        Else
                        
' localiza linha vazia na tabela de ativos e registra dados
                        Sheets("toolsCompara").Unprotect
                        
                        If Sheets("toolsCompara").Cells(20, 3) = "" Then
                            contLinha = 20
                            Else
                            contLinha = Sheets("toolsCompara").Cells(Rows.Count, 3).End(xlUp).Row + 1
                            
                        End If
                        
                        Sheets("toolsCompara").Cells(contLinha, 3) = tipoInvest
                        Sheets("toolsCompara").Cells(contLinha, 4) = indexador
                        Sheets("toolsCompara").Cells(contLinha, 6) = taxaRentab
                        Sheets("toolsCompara").Cells(contLinha, 7) = taxaRentabAdicional
                        Sheets("toolsCompara").Cells(contLinha, 8) = valorInvest
                        Sheets("toolsCompara").Cells(contLinha, 9) = prazoInvest
                        Sheets("toolsCompara").Cells(contLinha, 12) = taxaAdm
                        
                        Call toolsComparaClassificar
                        
' finaliza|fffd||fffd|o geral
                        Range("E5").Activate
                        Sheets("toolsCompara").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        
' remove dados preenchidos
                        Sheets("toolsCompara").Cells(8, 5) = "#Selecionar"
                        Sheets("toolsCompara").Cells(10, 5) = "0"
                        Sheets("toolsCompara").Cells(11, 5) = "0"
                        Sheets("toolsCompara").Cells(13, 5) = "0"
                        
                        MsgBox "Ativo inclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub toolsComparaNovaComparacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA COMPARA|fffd||fffd|O
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E5") = 0 And Range("E6") = 0 And Range("E8") = "#Selecionar" Then
        Exit Sub
        Else
        
' confirma|fffd||fffd|o para registro dos dados
        Dim confirmaNovaComparacao As VbMsgBoxResult
        confirmaNovaComparacao = MsgBox("Deseja apagar todos os dados e gerar uma nova compara|fffd||fffd|o?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaNovaComparacao = vbNo Then
            Exit Sub
            Else
            
' reseta valores dos campos
            Sheets("toolsCompara").Unprotect
            
            Sheets("toolsCompara").Cells(5, 5) = "0"
            Sheets("toolsCompara").Cells(6, 5) = "0"
            Sheets("toolsCompara").Cells(8, 5) = "#Selecionar"
            Sheets("toolsCompara").Cells(9, 5) = "#Selecionar"
            Sheets("toolsCompara").Cells(10, 5) = "0"
            Sheets("toolsCompara").Cells(11, 5) = "0"
            Sheets("toolsCompara").Cells(13, 5) = "0"
            
' remove lista de ativos da tabela
            contLinha = 20
            tabLinha = ((contLinha * -1) + 1) + contLinha
            Do Until Sheets("toolsCompara").Cells(contLinha, 3) = ""
            
            If Sheets("toolsCompara").Cells(contLinha, 3) <> "" Then
                Sheets("toolsCompara").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                
                Else
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
                
            End If
            Loop
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Range("E5").Activate
            Sheets("toolsCompara").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    
End Sub
Sub toolsComparaClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ATIVOS
' classifica|fffd||fffd|o decrescente por tipo de ativo
    ActiveWorkbook.Worksheets("toolsCompara").ListObjects("tabToolsCompara").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsCompara").ListObjects("tabToolsCompara").Sort. _
        SortFields.Add Key:=Range("tabToolsCompara[[#Headers],[Ativo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsCompara").ListObjects("tabToolsCompara").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With
    
End Sub
Attribute VB_Name = "M_ToolsCorretagem"
Sub toolsCorretagemAdicionar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VARI|fffd|VEIS
' vari|fffd|veis
    tipoInvest = Range("E5")
    corretora = Range("E6")
    codigoAtivo = UCase(Range("E7"))
    nomeAtivo = Range("E8")
    posicaoAtual = Range("J6")
    tipoOperacao = Range("K6")
    valorUnit = Range("L6")
    qtde = Range("M6")
    
    If tipoInvest = "A|fffd||fffd|es" Then
        temp = "a|fffd||fffd|es"
        Else
        
        If tipoInvest = "Fundos Imobili|fffd|rios" Or tipoInvest = "ETFs" Then
            temp = "cotas"
            Else
        
        End If
    End If

'*************************************************************************************************************************** VALIDA|fffd||fffd|O DE CAMPOS
' valida campos de preenchimento
    If tipoInvest = "#Selecionar" Then
        MsgBox "Selecione o tipo de investimento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If corretora = "#Selecionar" Then
            MsgBox "Selecione uma corretora.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else

            If codigoAtivo = "#C|fffd|DIGO" Or nomeAtivo = "C|fffd|digo inv|fffd|lido" Then
                MsgBox "C|fffd|digo do ativo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If tipoOperacao = "#Selecionar" Then
                    MsgBox "Selecione o tipo de opera|fffd||fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    Else
                    
                    If tipoOperacao = "Venda" And qtde > posicaoAtual Then
                        MsgBox "Quantidade de " & temp & " indispon|fffd|vel.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                        Exit Sub
                        Else
                        
                        If valorUnit <= "0" Then
                            MsgBox "Pre|fffd|o unit|fffd|rio do ativo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                            Exit Sub
                            Else
                            
                            If qtde <= 0 Then
                                MsgBox "Quantidade de " & temp & " inv|fffd|lida.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                Exit Sub
                                Else
                                
' verifica se opera|fffd||fffd|o j|fffd| est|fffd| cadastrada na tabela, evitando duplicidade
                                contLinha = 16
                                Do Until Sheets("toolsCorretagem").Cells(contLinha, 3) = "" Or Sheets("toolsCorretagem").Cells(contLinha, 4) = tipoOperacao And _
                                Sheets("toolsCorretagem").Cells(contLinha, 5) = codigoAtivo And Sheets("toolsCorretagem").Cells(contLinha, 7) = qtde
                                contLinha = contLinha + 1
                                Loop
                                
                                If Sheets("toolsCorretagem").Cells(contLinha, 4) = tipoOperacao And Sheets("toolsCorretagem").Cells(contLinha, 5) = codigoAtivo And _
                                Sheets("toolsCorretagem").Cells(contLinha, 7) = qtde Then
                                    MsgBox "A " & tipoOperacao & " de " & nomeAtivo & " j|fffd| est|fffd| registrada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    
                                End If
                                
'*************************************************************************************************************************** REGISTRO DE OPERA|fffd||fffd|O
' confirma|fffd||fffd|o para registro dos dados
                                Dim confirmaOp As VbMsgBoxResult
                                confirmaOp = MsgBox("Deseja confirmar a " & tipoOperacao & " de " & nomeAtivo & " na simula|fffd||fffd|o?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
                                
                                If confirmaOp = vbNo Then
                                    Exit Sub
                                    Else
                                    
' localiza linha vazia na tabela e registra dados
                                    Sheets("toolsCorretagem").Unprotect
                                    
' loop para localizar linha vazia
                                    If Sheets("toolsCorretagem").Cells(16, 3) = "" Then
                                        contLinha = 16
                                        Else
                                        contLinha = Sheets("toolsCorretagem").Cells(Rows.Count, 3).End(xlUp).Row + 1
                                        
                                    End If
                                    
                                    Sheets("toolsCorretagem").Cells(contLinha, 3) = tipoInvest
                                    Sheets("toolsCorretagem").Cells(contLinha, 4) = tipoOperacao
                                    Sheets("toolsCorretagem").Cells(contLinha, 5) = codigoAtivo
                                    Sheets("toolsCorretagem").Cells(contLinha, 7) = qtde
                                    Sheets("toolsCorretagem").Cells(contLinha, 8) = valorUnit
                                    
                                    Call toolsCorretagemClassificar
                                    
' finaliza|fffd||fffd|o geral
                                    Range("E7").Activate
                                    Sheets("toolsCorretagem").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                                    
' remove dados preenchidos
                                    Sheets("toolsCorretagem").Cells(7, 5) = "#C|fffd|digo"
                                    Sheets("toolsCorretagem").Cells(6, 11) = "#Selecionar"
                                    Sheets("toolsCorretagem").Cells(6, 12) = "0"
                                    Sheets("toolsCorretagem").Cells(6, 13) = "0"
                                    
                                    MsgBox "Ativo inclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                                    Exit Sub
                                    
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Sub toolsCorretagemNovaSimulacao()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVA SIMULA|fffd||fffd|O
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E6") = "#Selecionar" And Range("E7") = "#C|fffd|digo" And Range("L6") = 0 Then
        Exit Sub
        Else
        
' confirma|fffd||fffd|o para registro dos dados
        Dim confirmaNovaSimulacao As VbMsgBoxResult
        confirmaNovaSimulacao = MsgBox("Deseja apagar todos os dados e gerar uma nova simula|fffd||fffd|o?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaNovaSimulacao = vbNo Then
            Exit Sub
            Else
            
' reseta valores dos campos
            Sheets("toolsCorretagem").Unprotect
            
            Sheets("toolsCorretagem").Cells(5, 5) = "#Selecionar"
            Sheets("toolsCorretagem").Cells(6, 5) = "#Selecionar"
            Sheets("toolsCorretagem").Cells(7, 5) = "#C|fffd|digo"
            Sheets("toolsCorretagem").Cells(6, 11) = "#Selecionar"
            Sheets("toolsCorretagem").Cells(6, 12) = "0"
            Sheets("toolsCorretagem").Cells(6, 13) = "0"
            
' remove lista de ativos da tabela
            contLinha = 16
            tabLinha = ((contLinha * -1) + 1) + contLinha
            Do Until Sheets("toolsCorretagem").Cells(contLinha, 3) = ""
            
            If Sheets("toolsCorretagem").Cells(contLinha, 3) <> "" Then
                Sheets("toolsCorretagem").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                
                Else
                contLinha = contLinha + 1
                tabLinha = tabLinha + 1
                
            End If
            Loop
            
' bloqueia planilha e finaliza gera|fffd||fffd|o de ordem em branco
            Range("E5").Activate
            Sheets("toolsCorretagem").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    
End Sub
Sub toolsCorretagemRemover()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE ATIVOS SELECIONADOS
' vari|fffd|veis
    contLinha = 16
    tabLinha = ((contLinha * -1) + 1) + contLinha
    codigoAtivo = UCase(Range("E14"))
    
' valida|fffd|oes
    If Sheets("toolsCorretagem").Cells(contLinha, 3) = "" Then
        MsgBox "Nenhum ativo dispon|fffd|vel para exclus|fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If codigoAtivo = "#C|fffd|DIGO" Then
            MsgBox "Selecione um ativo para exclus|fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' loop para localiza|fffd||fffd|o do ativo indicado
            Do Until Sheets("toolsCorretagem").Cells(contLinha, 3) = "" Or Sheets("toolsCorretagem").Cells(contLinha, 5) = codigoAtivo
            contLinha = contLinha + 1
            tabLinha = tabLinha + 1
            Loop
            
' valida remo|fffd||fffd|o de ativo espec|fffd|fico
            Dim confirmaRemocao As VbMsgBoxResult
            confirmaRemocao = MsgBox("Deseja confirmar a exclus|fffd|o de " & codigoAtivo & " da simula|fffd||fffd|o?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaRemocao = vbNo Then
                Exit Sub
                Else
                
                Sheets("toolsCorretagem").Unprotect
                Sheets("toolsCorretagem").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                
' define lista de ativos #C|fffd|digo
                Sheets("toolsCorretagem").Cells(14, 5) = "#C|fffd|digo"
                Sheets("toolsCorretagem").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' finaliza opera|fffd||fffd|es
                MsgBox "Ativo exclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub toolsCorretagemClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ORDENS
' classifica|fffd||fffd|o decrescente por c|fffd|digo
    ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort. _
        SortFields.Add Key:=Range("tabToolsCorretagem[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por tipo de investimento
    ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort. _
        SortFields.Add Key:=Range("tabToolsCorretagem[[#Headers],[Investimento]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o crescente por tipo de opera|fffd||fffd|o
    ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort. _
        SortFields.Add Key:=Range("tabToolsCorretagem[[#Headers],[Opera|fffd||fffd|o]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsCorretagem").ListObjects("tabToolsCorretagem").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_ToolsImposto"
Sub toolsImpostoNovoInforme()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' confirma valida|fffd||fffd|o de informe
    Dim confirmaInforme As VbMsgBoxResult
    confirmaInforme = MsgBox("Este procedimento ir|fffd| gerar o informe de investimentos conforme a posi|fffd||fffd|o atual. Deseja continuar?", _
    vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaInforme = vbNo Then
        Exit Sub
        Else
        
' valida|fffd||fffd|o de per|fffd|odo de emiss|fffd|o do arquivo
        If Range("A1") < "20/12/" & Range("M5") Or Range("A1") > "31/12" & Range("M5") Then
            MsgBox "Este informe exibir|fffd| apenas as posi|fffd||fffd|es registradas at|fffd| o momento. Para obter os dados definitivos para o I.R., realize este mesmo procedimento nos |fffd|ltimos dias do ano.", _
            vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            
        End If
        
        If Range("C15") <> "" Then
            Call toolsImpostoExcluirRegistros
            Else
        
        End If
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - A|fffd||fffd|ES
' loop para localiza|fffd||fffd|o de ativos
        Sheets("toolsImposto").Unprotect
        contLinha = 18
        Do Until Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "A|fffd||fffd|es"
        codigoAcao = Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 3)
        empresa = Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 4)
        qtde = Sheets("a|fffd||fffd|esCarteira").Cells(contLinha, 6)
        
' registro de a|fffd||fffd|es na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoAcao
        Sheets("toolsImposto").Cells(contUnit, 5) = empresa
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - ETFS
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("etfsCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "ETFs"
        codigoFundo = Sheets("etfsCarteira").Cells(contLinha, 3)
        fundo = Sheets("etfsCarteira").Cells(contLinha, 4)
        qtde = Sheets("etfsCarteira").Cells(contLinha, 6)
        
' registro de ETFs na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoFundo
        Sheets("toolsImposto").Cells(contUnit, 5) = fundo
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - FIIS
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("fiisCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "Fundos Imobili|fffd|rios"
        codigoFundo = Sheets("fiisCarteira").Cells(contLinha, 3)
        fundo = Sheets("fiisCarteira").Cells(contLinha, 4)
        qtde = Sheets("fiisCarteira").Cells(contLinha, 6)
        
' registro de FIIs na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoFundo
        Sheets("toolsImposto").Cells(contUnit, 5) = fundo
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - TESOURO DIRETO
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("tesouroCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "Tesouro Direto"
        codigoTesouro = Sheets("tesouroCarteira").Cells(contLinha, 3)
        titulo = Sheets("tesouroCarteira").Cells(contLinha, 4)
        qtde = Sheets("tesouroCarteira").Cells(contLinha, 6)
        
' registro de t|fffd|tulos na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoTesouro
        Sheets("toolsImposto").Cells(contUnit, 5) = titulo
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - CDBS
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("cdbsCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "CDBs"
        codigoCertificado = Sheets("cdbsCarteira").Cells(contLinha, 3)
        certificado = Sheets("cdbsCarteira").Cells(contLinha, 4)
        qtde = Sheets("cdbsCarteira").Cells(contLinha, 9)
        
' registro de certificados na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoCertificado
        Sheets("toolsImposto").Cells(contUnit, 5) = certificado
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - LCA/LCI
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("letrasCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "LCA/LCI"
        codigoLetra = Sheets("letrasCarteira").Cells(contLinha, 3)
        letra = Sheets("letrasCarteira").Cells(contLinha, 4)
        qtde = Sheets("letrasCarteira").Cells(contLinha, 9)
        
' registro de letras na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoLetra
        Sheets("toolsImposto").Cells(contUnit, 5) = letra
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - FUNDOS
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("fundosCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "Fundos"
        nomeFundo = Sheets("fundosCarteira").Cells(contLinha, 3)
        valorAplicacao = Sheets("fundosCarteira").Cells(contLinha, 10)
        
' registro de fundos na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = "-"
        Sheets("toolsImposto").Cells(contUnit, 5) = nomeFundo
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
      contLinha = contLinha + 1
        Loop
    
'*************************************************************************************************************************** REGISTRO DE ATIVOS - COES
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("coesCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "COEs"
        nomeCOE = Sheets("coesCarteira").Cells(contLinha, 3)
        valorAplicacao = Sheets("coesCarteira").Cells(contLinha, 10)
        
' registro de COEs na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = "-"
        Sheets("toolsImposto").Cells(contUnit, 5) = nomeCOE
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'*************************************************************************************************************************** REGISTRO DE ATIVOS - MOEDAS ESTRANGEIRAS
' loop para localiza|fffd||fffd|o de ativos
        contLinha = 18
        Do Until Sheets("moedasCarteira").Cells(contLinha, 3) = ""
        
' identifica|fffd||fffd|o dos campos e vari|fffd|veis
        tipoInvest = "Moedas Estrangeiras"
        codigoMoeda = Sheets("moedasCarteira").Cells(contLinha, 3)
        moeda = Sheets("moedasCarteira").Cells(contLinha, 4)
        qtde = Sheets("moedasCarteira").Cells(contLinha, 6)
        
' registro de moedas na tabela de imposto
        contUnit = 15
        Do Until Sheets("toolsImposto").Cells(contUnit, 3) = ""
        contUnit = contUnit + 1
        Loop
        
        Sheets("toolsImposto").Cells(contUnit, 3) = tipoInvest
        Sheets("toolsImposto").Cells(contUnit, 4) = codigoMoeda
        Sheets("toolsImposto").Cells(contUnit, 5) = moeda
        Sheets("toolsImposto").Cells(contUnit, 5).HorizontalAlignment = xlGeneral
        Sheets("toolsImposto").Cells(contUnit, 5).InsertIndent 2
        
' retorna ao loop da tabela carteira
        contLinha = contLinha + 1
        Loop
        
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FINALIZA|fffd||fffd|O
' finaliza|fffd||fffd|o geral
        Call toolsImpostoClassificar
        Sheets("toolsImposto").Shapes.Range(Array("btnAdd")).Visible = False
        Sheets("toolsImposto").Shapes.Range(Array("btnTrash")).Visible = True
        Sheets("toolsImposto").Cells(9, 3) = "Arquivo gerado dia " & DateValue(Now) & "."
        Sheets("toolsImposto").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        
        Call planAutoSave
        MsgBox "Informe gerado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
End Sub
Sub toolsImpostoExcluirRegistros()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE REGISTROS EFETUADOS
' deleta registros efetuados para novo informe
    Sheets("toolsImposto").Unprotect
    
    contLinha = 15
    tabLinha = ((contLinha * -1) + 1) + contLinha
    Do Until Sheets("toolsImposto").Cells(contLinha, 3) = ""
    
    Sheets("toolsImposto").Activate
    Cells(contLinha, 3).Select
    Selection.ListObject.ListRows(tabLinha).Delete
    
    Loop
    
' altera|fffd||fffd|o de |fffd|cones
    Sheets("toolsImposto").Shapes.Range(Array("btnAdd")).Visible = True
    Sheets("toolsImposto").Shapes.Range(Array("btnTrash")).Visible = False

' finaliza|fffd||fffd|o
    Sheets("toolsImposto").Cells(9, 3) = ""
    Sheets("toolsImposto").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub
Sub toolsImpostoPDF()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXPORTA|fffd||fffd|O DE ARQUIVO PDF
' verifica modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Fun|fffd||fffd|o indispon|fffd|vel. O 'Modo Sigiloso' est|fffd| ativado.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' vari|fffd|veis
        contLinha = Range("M14").End(xlDown).Row
        textoMsg = Range("F5") & " " & Range("M5")
        temp = ThisWorkbook.Path & "\" & textoMsg
        
' valida|fffd||fffd|o do informe
        If Range("C15") = "" Then
            MsgBox "Nenhum informe dispon|fffd|vel para exporta|fffd||fffd|o no momento.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' exporta|fffd||fffd|o para PDF
            Dim confirmaExportacao As VbMsgBoxResult
            confirmaExportacao = MsgBox("Deseja confirmar a exporta|fffd||fffd|o do " & textoMsg & "?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaExportacao = vbNo Then
                Exit Sub
                Else
                
                Range("C4:M" & contLinha).ExportAsFixedFormat Type:=xlTypePDF, filename:=temp & ".pdf", Quality:=xlQualityStandard, IncludeDocProperties:=True, _
                IgnorePrintAreas:=False, OpenAfterPublish:=True
                
' finaliza|fffd||fffd|o geral
            End If
        End If
    End If
    
End Sub
Sub toolsImpostoClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE ATIVOS
' classifica|fffd||fffd|o crescente por c|fffd|digo do ativo
    ActiveWorkbook.Worksheets("toolsImposto").ListObjects("tabToolsImposto").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsImposto").ListObjects("tabToolsImposto").Sort. _
        SortFields.Add Key:=Range("tabToolsImposto[[#Headers],[C|fffd|digo]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsImposto").ListObjects("tabToolsImposto").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        SortMethod = xlPinYin
        .Apply
    End With

' classifica|fffd||fffd|o decrescente por tipo de investimento
    ActiveWorkbook.Worksheets("toolsImposto").ListObjects("tabToolsImposto").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsImposto").ListObjects("tabToolsImposto").Sort. _
        SortFields.Add Key:=Range("tabToolsImposto[[#Headers],[Investimento]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsImposto").ListObjects("tabToolsImposto").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub


Attribute VB_Name = "M_ToolsLinks"
Sub toolsLinksAcessarSite()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE DESTACADO
' gerenciamento de erros
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkSite = Range("G9")
    
' abre site destacado
    ActiveWorkbook.FollowHyperlink Address:=linkSite
    Range("E9") = "#Selecionar"
    Exit Sub
    
errorHandler:
    MsgBox "Selecione um site para acesso ao link.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub toolsLinksRemover()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REMOVE LINK SELECIONADO
' vari|fffd|veis
    contLinha = 11
    tabLinha = ((contLinha * -1) + 1) + contLinha
    nomeLink = Range("E9")
    
' valida|fffd||fffd|es
    If Sheets("toolsLinks").Cells(contLinha, 5) = "" Then
        MsgBox "Nenhum link dispon|fffd|vel para exclus|fffd|o at|fffd| o momento.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If nomeLink = "#Selecionar" Then
            MsgBox "Selecione um link para exclus|fffd|o.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' loop para localiza|fffd||fffd|o do link indicado
            Do Until Sheets("toolsLinks").Cells(contLinha, 5) = "" Or Sheets("toolsLinks").Cells(contLinha, 5) = nomeLink
            contLinha = contLinha + 1
            tabLinha = tabLinha + 1
            Loop
            
' valida remo|fffd||fffd|o de link espec|fffd|fico
            Dim confirmaRemocao As VbMsgBoxResult
            confirmaRemocao = MsgBox("Deseja confirmar a exclus|fffd|o de " & nomeLink & " da lista?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaRemocao = vbNo Then
                Exit Sub
                Else
                
                Sheets("toolsLinks").Unprotect
                Sheets("toolsLinks").Activate
                Cells(contLinha, 3).Select
                Selection.ListObject.ListRows(tabLinha).Delete
                
' define lista de ativos #C|fffd|digo
                Sheets("toolsLinks").Cells(9, 5) = "#Selecionar"
                Sheets("toolsLinks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' finaliza opera|fffd||fffd|es
                MsgBox nomeLink & " exclu|fffd|do com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub toolsLinksSalvar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** INSERE ATIVO NO RADAR
' vari|fffd|veis
    nomeLink = Range("E5")
    linkSite = Range("E6")
    
' valida|fffd||fffd|es
    If nomeLink = "#Site" Then
        MsgBox "Informe o nome do site.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkSite = "#Endere|fffd|o" Then
            MsgBox "Informe o endere|fffd|o completo do site.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
' localiza linha vazia e valida poss|fffd|vel duplicidade
            contLinha = 11
            Do Until Sheets("toolsLinks").Cells(contLinha, 5) = "" Or Sheets("toolsLinks").Cells(contLinha, 5) = nomeLink Or Sheets("toolsLinks").Cells(contLinha, 6) = linkSite
            contLinha = contLinha + 1
            Loop
            
            If Sheets("toolsLinks").Cells(contLinha, 5) = nomeLink Then
                MsgBox "O site " & nomeLink & " j|fffd| est|fffd| cadastrado na lista.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                Else
                
                If Sheets("toolsLinks").Cells(contLinha, 6) = linkSite Then
                    MsgBox "Este endere|fffd|o j|fffd| est|fffd| cadastrado na lista.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    Exit Sub
                    
                End If
            End If
            
' confirma|fffd||fffd|o para registro no radar
            Dim confirmaLink As VbMsgBoxResult
            confirmaLink = MsgBox("Deseja inserir " & nomeLink & " na lista de links?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
            
            If confirmaLink = vbNo Then
                Exit Sub
                Else
                
' localiza linha vazia na tabela de links e registra dados
                Sheets("toolsLinks").Unprotect
                
                contLinha = 11
                Do Until Sheets("toolsLinks").Cells(contLinha, 5) = ""
                contLinha = contLinha + 1
                Loop
                
                Sheets("toolsLinks").Cells(contLinha, 5) = nomeLink
                Sheets("toolsLinks").Cells(contLinha, 6) = linkSite
                
                Call toolsLinksClassificar
                Call toolsLinksNovoRegistro
                Sheets("toolsLinks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' finaliza|fffd||fffd|o geral
                Call planAutoSave
                MsgBox "Link cadastrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Sub toolsLinksNovoRegistro()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GERA NOVO REGISTRO
' verifica se campos j|fffd| est|fffd|o em branco
    If Range("E5") = "#Site" And Range("E6") = "#Endere|fffd|o" Then
        Exit Sub
        Else
        
' reseta valores dos campos
        Sheets("toolsLinks").Cells(5, 5) = "#Site"
        Sheets("toolsLinks").Cells(6, 5) = "#Endere|fffd|o"
        
        Range("E6").Select
        With Selection
            .Hyperlinks.Delete
        End With
        
        Range("E5:I5").Copy
        Range("E6:I6").PasteSpecial Paste:=xlPasteFormats, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
        Application.CutCopyMode = False
            Range("E5").Select
            
        End If
    
End Sub
Sub toolsLinksClassificar()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA TABELA DE RADAR
' classifica|fffd||fffd|o crescente por nome
    ActiveWorkbook.Worksheets("toolsLinks").ListObjects("tabToolsLinks").Sort.SortFields.Clear
    ActiveWorkbook.Worksheets("toolsLinks").ListObjects("tabToolsLinks").Sort. _
        SortFields.Add Key:=Range("tabToolsLinks[[#Headers],[Site]]"), SortOn:= _
        xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
    With ActiveWorkbook.Worksheets("toolsLinks").ListObjects("tabToolsLinks").Sort
        .Header = xlYes
        .MatchCase = False
        .Orientation = xlTopToBottom
        .SortMethod = xlPinYin
        .Apply
    End With

End Sub

Attribute VB_Name = "M_ToolsValuation"
Sub toolsVal1Logo()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** LOGOTIPO  VALUATION
' vari|fffd|veis
    codigoAtivo = UCase(Sheets("toolsValuation1").Range("E6"))
    
' gerenciamento de erros
    On Error GoTo errorHandler
    
' define logotipo
    logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\" & codigoAtivo & ".jpg"
    Sheets("toolsValuation1").logoField.Picture = LoadPicture(logoAcao)
    Exit Sub
    
errorHandler:
    logoAcao = ThisWorkbook.Path & "\imagery\a|fffd||fffd|es\_none.jpg"
    Sheets("toolsValuation1").logoField.Picture = LoadPicture(logoAcao)

End Sub
Sub toolsVal1NovoValuation()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** NOVO VALUATION
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' reseta valores e altera logo
    Call toolsVal1Logo
    
    Sheets("toolsValuation1").Unprotect
    Range("L9") = 0
    Range("L10") = 0
    Sheets("toolsValuation1").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
            
End Sub
Sub toolsVal1Reset()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** NOVO VALUATION
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If
    
' valida status
    If Range("E6") = "#C|fffd|digo" Then
        Exit Sub
        Else

' reseta valores e altera logo
        Call toolsVal1Logo
        
        Sheets("toolsValuation1").Unprotect
        Range("E6") = "#C|fffd|digo"
        Range("L9") = 0
        Range("L10") = 0
        Sheets("toolsValuation1").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
        
    End If
    
End Sub
Sub toolsVal1RadarRVRegistrar()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** INSERE ATIVO NO RADAR
' valida modo sigiloso
    If Sheets("config").Cells(12, 5) = "Sigiloso" Then
        MsgBox "Modo Sigiloso: fun|fffd||fffd|o indispon|fffd|vel temporariamente.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        
    End If

' vari|fffd|veis
    tipoInvest = "A|fffd||fffd|es"
    codigoAtivo = UCase(Range("E6"))
    nomeAtivo = Range("E7")
    contVal = Range("G17")
    
' valida|fffd||fffd|es
    If codigoAtivo = "#C|fffd|DIGO" Or nomeAtivo = "C|fffd|digo inv|fffd|lido" Then
        MsgBox "C|fffd|digo do ativo inv|fffd|lido.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
' localiza linha vazia e valida poss|fffd|vel duplicidade
        contLinha = 15
        Do Until Sheets("ativosRadarRV").Cells(contLinha, 3) = "" Or Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo
        contLinha = contLinha + 1
        Loop
        
' atualiza pre|fffd|o teto de ativo j|fffd| cadastrado no radar
        If Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo Then
            Sheets("ativosRadarRV").Unprotect
            Sheets("ativosRadarRV").Cells(contLinha, 9) = contVal
            Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            MsgBox "O ativo " & nomeAtivo & " j|fffd| est|fffd| cadastrado no Radar.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
        
' confirma|fffd||fffd|o para registro no radar
        Dim confirmaRadar As VbMsgBoxResult
        confirmaRadar = MsgBox("Deseja inserir " & nomeAtivo & " no Radar de Ativos?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
        
        If confirmaRadar = vbNo Then
            Exit Sub
            Else
            
' localiza linha vazia na tabela de radar e registra dados
            Sheets("ativosRadarRV").Unprotect
            
            If Sheets("ativosRadarRV").Cells(15, 3) = "" Then
                contLinha = 15
                Else
                contLinha = Sheets("ativosRadarRV").Cells(Rows.Count, 3).End(xlUp).Row + 1
                
            End If
            
            Sheets("ativosRadarRV").Cells(contLinha, 3) = codigoAtivo
            Sheets("ativosRadarRV").Cells(contLinha, 4) = tipoInvest
            Sheets("ativosRadarRV").Cells(contLinha, 9) = contVal
            
            Call ativosRadarRVClassificar
            Call ativosRadarRVNovoRegistro
            Sheets("ativosRadarRV").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
' finaliza|fffd||fffd|o geral
            Sheets("toolsValuation1").Range("E6").Select
            Call planAutoSave
            MsgBox "Ativo cadastrado com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Sub toolsVal1LinkRI()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE RI DA EMPRESA SELECIONADA
' gerenciamento de erro
    On Error GoTo errorHandler
    
' vari|fffd|veis
    linkRI = Range("H13")
    
' valida link e acessa site RI
    If Range("E7") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
        
        If linkRI = "" Or linkRI = "Link indispon|fffd|vel" Or linkRI = "0" Then
            MsgBox "Acesso indispon|fffd|vel temporariamente.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:=linkRI
            
        End If
    End If
    Exit Sub
    
errorHandler:
    MsgBox "Ops! Parece que o link indicado est|fffd| temporariamente indispon|fffd|vel ou foi modificado.", vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
    
End Sub
Sub toolsVal1LinkFundamentus()
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSA SITE FUNDAMENTUS DA EMPRESA SELECIONADA
' vari|fffd|veis
    codigoAcao = UCase(Range("E6"))
    
' abre p|fffd|gina do site fundamentus com o c|fffd|digo da a|fffd||fffd|o
    If Range("E7") = "Selecione o ativo" Then
        MsgBox "Nenhum ativo selecionado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        Exit Sub
        Else
            
        If Range("E7") = "C|fffd|digo inv|fffd|lido" Then
            MsgBox "O ativo selecionado n|fffd|o foi encontrado.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            Exit Sub
            Else
            
            ActiveWorkbook.FollowHyperlink Address:="http://fundamentus.com.br/detalhes.php?papel=" & codigoAcao & "&x=0&y=0"
            
        End If
    End If
    
End Sub

Attribute VB_Name = "P_Ajuda"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
    
' registra vers|fffd|o atual do sistema
    Call versaoAtualizada
    
    Sheets("ajuda").Unprotect
    Sheets("ajuda").Cells(3, 14) = versaoSys
    Sheets("ajuda").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    
End Sub

Attribute VB_Name = "P_AjudaLinks"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnExcluir, 4, 0, MSForms, Image"
Private Sub btnExcluir_Click()
    Call toolsLinksRemover
End Sub

Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_AtivosRadar"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_AtivosRadarMulti"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_AtivosRadarRV"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnRadarExcluir, 3, 0, MSForms, Image"
Attribute VB_Control = "btnRadarSite, 4, 1, MSForms, Image"
Attribute VB_Control = "logoField, 12, 2, MSForms, Image"
Attribute VB_Control = "btnVal1, 16, 3, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        If Not (Application.Intersect(Worksheets("ativosRadarRV").Range("E6"), Target) Is Nothing) Then
            Call ativosRadarRVLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub btnRadarExcluir_Click()
    Call ativosRadarRVRemoverComprados
End Sub
Private Sub btnRadarExcluir_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipRadarFunc1
End Sub
Private Sub btnRadarSite_Click()
    Call ativosRadarRVLink
End Sub
Private Sub btnRadarSite_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipRadarSite1
End Sub
Private Sub btnVal1_Click()
    If Range("E6") = "#C|fffd|digo" Then
        Sheets("toolsValuation1").Activate
        Exit Sub
        Else
        
        codigoAtivo = Range("E6")
        Sheets("toolsValuation1").Activate
        Sheets("toolsValuation1").Cells(6, 5) = codigoAtivo
        
    End If
    
End Sub
Private Sub btnVal1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipVal11
End Sub
Attribute VB_Name = "P_A|fffd||fffd|esCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 3631, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5546, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 5551, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call acoesCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabA|fffd||fffd|esCarteira
        On Error GoTo finalizaClassificacao
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esCarteira").Range("C18:C100"), Target) Is Nothing) Then
        
' classifica|fffd||fffd|o crescente por data de opera|fffd||fffd|o
        ActiveWorkbook.Worksheets("a|fffd||fffd|esCarteira").ListObjects("tabA|fffd||fffd|esCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("a|fffd||fffd|esCarteira").ListObjects("tabA|fffd||fffd|esCarteira").Sort. _
            SortFields.Add Key:=Range("tabA|fffd||fffd|esCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("a|fffd||fffd|esCarteira").ListObjects("tabA|fffd||fffd|esCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With
            Exit Sub
            
        End If
    End If
    
finalizaClassificacao:
    Exit Sub
    
End Sub
Private Sub btnGrafico_Click()
    Call acoesCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesGraf1
End Sub
Private Sub btnRotulo_Click()
    Call acoesCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesRotulo1
End Sub
Private Sub logoField_Click()
    Call acoesCarteiraRecompra
End Sub

Attribute VB_Name = "P_A|fffd||fffd|esCompras"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLink3, 3468, 1, MSForms, Image"
Attribute VB_Control = "btnLink2, 3467, 2, MSForms, Image"
Attribute VB_Control = "btnLink1, 3466, 3, MSForms, Image"
Attribute VB_Control = "logoField, 5405, 4, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esCompras").Range("F6"), Target) Is Nothing) Then
            Call acoesComprasLogo
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esCompras").Range("tabA|fffd||fffd|esCompras"), Target) Is Nothing) Then
            Call acoesCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub btnLink1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesBitbolsa1
End Sub
Private Sub btnLink1_Click()
    Call acoesLinkBitbolsa
End Sub
Private Sub btnLink2_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesRI1
End Sub
Private Sub btnLink2_Click()
    Call acoesLinkRI
End Sub
Private Sub btnLink3_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesFundamentus1
End Sub
Private Sub btnLink3_Click()
    Call acoesLinkFundamentus
End Sub


Attribute VB_Name = "P_A|fffd||fffd|esProventos"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "Image1, 3437, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5262, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esProventos").Range("D6"), Target) Is Nothing) Then
            Call acoesProventosLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub Image1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesProv1
End Sub

Attribute VB_Name = "P_A|fffd||fffd|esVendas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLimparHist, 5203, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5200, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call acoesLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipAcoesHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Or Sheets("carteiraOp").Cells(1, 12) > 0 Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esVendas").Range("F6"), Target) Is Nothing) Then
            Call acoesVendasLogo
            Call ajustaGhostCell
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esVendas").Range("tabA|fffd||fffd|esVendas"), Target) Is Nothing) Then
            Call acoesCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub

Attribute VB_Name = "P_CDBsAplic"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLink1, 3507, 0, MSForms, Image"
Attribute VB_Control = "btnLink2, 3508, 1, MSForms, Image"
Attribute VB_Control = "logoField, 5495, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA|fffd||fffd|O DE CAMPOS
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe campos de edi|fffd||fffd|o ao iniciar registros
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("cdbsAplic").Range("F6"), Target) Is Nothing) Then
        
' valida status de campos preenchidos
            If Range("H4") <> "Selecione o emissor do t|fffd|tulo" And Range("I5") <> "#Selecionar" Then
                Exit Sub
                Else
                
' desativa campos de edi|fffd||fffd|o para ordem vazia
                If Range("H4") = "Selecione o emissor do t|fffd|tulo" Then
                    Sheets("cdbsAplic").Unprotect
                    Range("I5:I7").Locked = True
                    Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Else
                    
' reativa campos de edi|fffd||fffd|o ao indicar emissor do t|fffd|tulo
                    If Range("H4") <> "Selecione o emissor do t|fffd|tulo" Then
                        Sheets("cdbsAplic").Unprotect
                        Range("I5:I7").Locked = False
                        Sheets("cdbsAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
                    End If
                End If
            End If
            
' exibe logotipo com imagem em pasta
            Call cdbsAplicLogo
            
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
            If Not (Application.Intersect(Worksheets("cdbsAplic").Range("tabCDBsAplica|fffd||fffd|es"), Target) Is Nothing) Then
                Call cdbsCarteiraLogo
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Private Sub btnLink1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCDBsSite1
End Sub
Private Sub btnLink1_Click()
    Call cdbsLinkInstituicao
End Sub
Private Sub btnLink2_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCDBsBancodata1
End Sub
Private Sub btnLink2_Click()
    Call cdbsLinkBancoData
End Sub


Attribute VB_Name = "P_CDBsCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 3086, 0, MSForms, Image"
Attribute VB_Control = "logoField, 4905, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 4937, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call cdbsCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabCDBsCarteira
        On Error GoTo finalizaClassificacao
        If Not (Application.Intersect(Worksheets("cdbsCarteira").Range("C18:C100"), Target) Is Nothing) Then
        
' classifica|fffd||fffd|o crescente por c|fffd|digo
        ActiveWorkbook.Worksheets("cdbsCarteira").ListObjects("tabCDBsCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("cdbsCarteira").ListObjects("tabCDBsCarteira").Sort. _
            SortFields.Add Key:=Range("tabCDBsCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("cdbsCarteira").ListObjects("tabCDBsCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With
        Exit Sub
        
    End If
    End If
    
finalizaClassificacao:
    Exit Sub
End Sub
Private Sub btnGrafico_Click()
    Call cdbsCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCDBsGraf1
End Sub
Private Sub btnRotulo_Click()
    Call cdbsCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCDBsRotulo1
End Sub
Private Sub logoField_Click()
    Call cdbsCarteiraReaplicacao
End Sub


Attribute VB_Name = "P_CDBsResgates"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 4928, 0, MSForms, Image"
Attribute VB_Control = "btnLimparHist, 4929, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call cdbsLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCDBsHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' exibe logotipo com imagem em pasta
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("cdbsResgates").Range("F6"), Target) Is Nothing) Then
        Call cdbsResgatesLogo
        Call ajustaGhostCell
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
    If Not (Application.Intersect(Worksheets("cdbsResgates").Range("tabCDBsResgates"), Target) Is Nothing) Then
        Call cdbsCarteiraLogo
        Exit Sub
        
    End If
    
End Sub



Attribute VB_Name = "P_COEsAplic"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_COEsCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 1, 0, MSForms, Image"
Attribute VB_Control = "btnRotulo, 2, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabCOEsCarteira
    On Error GoTo finalizaClassificacao
    If Not (Application.Intersect(Worksheets("coesCarteira").Range("C18:C100"), Target) Is Nothing) Then
    
' classifica|fffd||fffd|o crescente por nome
        Sheets("coesCarteira").Cells(contLinha, 3).HorizontalAlignment = xlGeneral
        Sheets("coesCarteira").Cells(contLinha, 3).InsertIndent 2
        
        ActiveWorkbook.Worksheets("coesCarteira").ListObjects("tabCOEsCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("coesCarteira").ListObjects("tabCOEsCarteira").Sort. _
            SortFields.Add Key:=Range("tabCOEsCarteira[[#Headers],[COE]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("coesCarteira").ListObjects("tabCOEsCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With

    End If
    
finalizaClassificacao:
    Exit Sub
End Sub
Private Sub btnGrafico_Click()
    Call coesCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCOEsGraf1
End Sub
Private Sub btnRotulo_Click()
    Call coesCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCOEsRotulo1
End Sub




Attribute VB_Name = "P_COEsResgates"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLimparHist, 2, 0, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call coesLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCOEsHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GHOSTCELL
' ajusta ghostcell
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("coesResgates").Range("F6"), Target) Is Nothing) Then
        Call ajustaGhostCell
        Exit Sub
        
    End If
    
End Sub
Attribute VB_Name = "P_CarteiraAcompanha"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnAcompTxtGraf, 6, 3, MSForms, Image"
Attribute VB_Control = "btnAcompGirarGraf, 5, 4, MSForms, Image"
Attribute VB_Control = "btnAcompGraf, 4, 5, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub btnAcompGraf_Click()
    Call carteiraAcompanhaAltGrafico
End Sub
Private Sub btnAcompGraf_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraAcompGraf1
End Sub
Private Sub btnAcompGirarGraf_Click()
    Call carteiraAcompanhaAjustarID
End Sub
Private Sub btnAcompGirarGraf_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraAcompGirarGraf1
End Sub
Private Sub btnAcompTxtGraf_Click()
    Call carteiraAcompanhaID
End Sub
Private Sub btnAcompTxtGraf_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraAcompTxtGraf1
End Sub
Attribute VB_Name = "P_CarteiraAtivos"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA|fffd||fffd|O DE GR|fffd|FICOS
' altera gr|fffd|fico automaticamente de acordo com tipo de ativo
    If Not (Application.Intersect(Worksheets("carteiraAtivos").Range("N3"), Target) Is Nothing) Then

'*************************************************************************************************************************** A|fffd||fffd|ES
        If Range("N3") = "A|fffd||fffd|es" Then
            Sheets("carteiraAtivos").Unprotect
            ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esSeg")).Visible = True
            ActiveSheet.Shapes.Range(Array("grfCOEsSeg", "grfFIIsSeg", "grfFundosSeg", "grfTesouroSeg")).Visible = False
            Sheets("carteiraAtivos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
' classifica|fffd||fffd|o decrescente por % em carteira
            ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresA|fffd||fffd|es").Sort.SortFields.Clear
            ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresA|fffd||fffd|es").Sort. _
                SortFields.Add Key:=Range("tabSetoresA|fffd||fffd|es[[#Headers],[% Carteira]]"), SortOn:= _
                xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
            With ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresA|fffd||fffd|es").Sort
                .Header = xlYes
                .MatchCase = False
                .Orientation = xlTopToBottom
                .SortMethod = xlPinYin
                .Apply
            End With
            Else
            
'*************************************************************************************************************************** COES
            If Range("N3") = "COEs" Then
                Sheets("carteiraAtivos").Unprotect
                ActiveSheet.Shapes.Range(Array("grfCOEsSeg")).Visible = True
                ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esSeg", "grfFIIsSeg", "grfFundosSeg", "grfTesouroSeg")).Visible = False
                Sheets("carteiraAtivos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
' classifica|fffd||fffd|o decrescente por % em carteira
                ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresCOEs").Sort.SortFields.Clear
                ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresCOEs").Sort. _
                    SortFields.Add Key:=Range("tabSetoresCOEs[[#Headers],[% Carteira]]"), SortOn:= _
                    xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
                With ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresCOEs").Sort
                    .Header = xlYes
                    .MatchCase = False
                    .Orientation = xlTopToBottom
                    .SortMethod = xlPinYin
                    .Apply
                End With
                Else
                
'*************************************************************************************************************************** FIIS
                If Range("N3") = "FIIs" Then
                    Sheets("carteiraAtivos").Unprotect
                    ActiveSheet.Shapes.Range(Array("grfFIIsSeg")).Visible = True
                    ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esSeg", "grfCOEsSeg", "grfFundosSeg", "grfTesouroSeg")).Visible = False
                    Sheets("carteiraAtivos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
' classifica|fffd||fffd|o decrescente por % em carteira
                    ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresFIIs").Sort.SortFields.Clear
                    ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresFIIs").Sort. _
                        SortFields.Add Key:=Range("tabSetoresFIIs[[#Headers],[% Carteira]]"), SortOn:= _
                        xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
                    With ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresFIIs").Sort
                        .Header = xlYes
                        .MatchCase = False
                        .Orientation = xlTopToBottom
                        .SortMethod = xlPinYin
                        .Apply
                    End With
                    Else
                    
'*************************************************************************************************************************** FUNDOS
                    If Range("N3") = "Fundos" Then
                        Sheets("carteiraAtivos").Unprotect
                        ActiveSheet.Shapes.Range(Array("grfFundosSeg")).Visible = True
                        ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esSeg", "grfCOEsSeg", "grfFIIsSeg", "grfTesouroSeg")).Visible = False
                        Sheets("carteiraAtivos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        
' classifica|fffd||fffd|o decrescente por % em carteira
                        ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresFundos").Sort.SortFields.Clear
                        ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresFundos").Sort. _
                            SortFields.Add Key:=Range("tabSetoresFundos[[#Headers],[% Carteira]]"), SortOn:= _
                            xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
                        With ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresFundos").Sort
                            .Header = xlYes
                            .MatchCase = False
                            .Orientation = xlTopToBottom
                            .SortMethod = xlPinYin
                            .Apply
                        End With
                        Else
                        
'*************************************************************************************************************************** TESOURO
                        If Range("N3") = "Tesouro" Then
                            Sheets("carteiraAtivos").Unprotect
                            ActiveSheet.Shapes.Range(Array("grfTesouroSeg")).Visible = True
                            ActiveSheet.Shapes.Range(Array("grfA|fffd||fffd|esSeg", "grfCOEsSeg", "grfFIIsSeg", "grfFundosSeg")).Visible = False
                            Sheets("carteiraAtivos").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            
' classifica|fffd||fffd|o decrescente por % em carteira
                            ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresTesouro").Sort.SortFields.Clear
                            ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresTesouro").Sort. _
                                SortFields.Add Key:=Range("tabSetoresTesouro[[#Headers],[% Carteira]]"), SortOn:= _
                                xlSortOnValues, Order:=xlDescending, DataOption:=xlSortNormal
                            With ActiveWorkbook.Worksheets("carteiraAtivos").ListObjects("tabSetoresTesouro").Sort
                                .Header = xlYes
                                .MatchCase = False
                                .Orientation = xlTopToBottom
                                .SortMethod = xlPinYin
                                .Apply
                            End With
                            
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub



Attribute VB_Name = "P_CarteiraCaixa"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnCaixaSaldo, 10072, 0, MSForms, Image"
Attribute VB_Control = "btnCaixaSaldoBM, 10078, 1, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora1, 10099, 2, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora2, 10157, 3, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora3, 10158, 4, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora4, 10159, 5, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora5, 10160, 6, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub btnCaixaSaldo_Click()
    Call carteiraCaixaAtualizaSaldo
End Sub
Private Sub btnCaixaSaldo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraCaixa1
End Sub
Private Sub btnCaixaSaldoBM_Click()
    Call carteiraCaixaAtualizaSaldoBM
End Sub
Private Sub btnCaixaSaldoBM_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraCaixa1
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ACESSAR CORRETORAS
Private Sub shpLogoCorretora1_Click()
    Call carteiraCaixaAcessarCorretora1
End Sub
Private Sub shpLogoCorretora2_Click()
    Call carteiraCaixaAcessarCorretora2
End Sub
Private Sub shpLogoCorretora3_Click()
    Call carteiraCaixaAcessarCorretora3
End Sub
Private Sub shpLogoCorretora4_Click()
    Call carteiraCaixaAcessarCorretora4
End Sub
Private Sub shpLogoCorretora5_Click()
    Call carteiraCaixaAcessarCorretora5
End Sub

Attribute VB_Name = "P_CarteiraOfertas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_CarteiraOp"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnEditarOrdens, 2, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub btnEditarOrdens_Click()
    Call carteiraOpEditarOrdens
End Sub
Private Sub btnEditarOrdens_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraOrdensEditar1
End Sub
Attribute VB_Name = "P_CarteiraPosi|fffd||fffd|o"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnSigilosoOFF, 1, 0, MSForms, Image"
Attribute VB_Control = "btnGraf1, 2, 1, MSForms, Image"
Attribute VB_Control = "btnGraf2, 4, 2, MSForms, Image"
Attribute VB_Control = "btnGraf3, 5, 3, MSForms, Image"
Attribute VB_Control = "btnSigilosoON, 6, 4, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub btnSigilosoON_Click()
    Call configModoSigiloso
End Sub
Private Sub btnSigilosoON_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraSigiloso1
End Sub
Private Sub btnSigilosoOFF_Click()
    Call configModoSigiloso
End Sub
Private Sub btnSigilosoOFF_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraSigiloso3
End Sub
Private Sub btnGraf1_Click()
    Call carteiraPosicaoExpo
End Sub
Private Sub btnGraf1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraGrafExp1
End Sub
Private Sub btnGraf2_Click()
    Call carteiraPosicaoAltGrafico
End Sub
Private Sub btnGraf2_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraGrafGer1
End Sub
Private Sub btnGraf3_Click()
    Call carteiraPosicaoDiv
End Sub
Private Sub btnGraf3_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraGrafDivGeral1
End Sub


Attribute VB_Name = "P_CarteiraProje|fffd||fffd|es"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnEditar, 3, 0, MSForms, Image"
Attribute VB_Control = "btnGrafico, 2, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SELE|fffd||fffd|O DE ATIVOS
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' disponibiliza ativo secund|fffd|rio em caso de convers|fffd|o
        If Not (Application.Intersect(Worksheets("carteiraProje|fffd||fffd|es").Range("E6"), Target) Is Nothing) Then
            Sheets("carteiraProje|fffd||fffd|es").Unprotect
            If Range("E6") <> "Outros" Then
                Sheets("carteiraProje|fffd||fffd|es").Cells(7, 5) = ""
                Range("E7:F7").Locked = True
                Else
            
                If Range("E6").Value = "Outros" Then
                    Sheets("carteiraProje|fffd||fffd|es").Cells(7, 5) = "#Informe seu objetivo"
                    Range("E7:F7").Locked = False
                    
                End If
            End If
            
            Sheets("carteiraProje|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        End If
    End If
    
End Sub
Private Sub btnEditar_Click()
    Call carteiraProjecoesEditar
End Sub
Private Sub btnEditar_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraMetasEditar1
End Sub
Private Sub btnGrafico_Click()
    Call carteiraProjecoesExibirGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraMetasGraf1
End Sub





Attribute VB_Name = "P_Configura|fffd||fffd|es"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CheckBoxSave, 29072, 0, MSForms, CheckBox"
Attribute VB_Control = "imgDBC, 29070, 1, MSForms, Image"
Attribute VB_Control = "imgDBB, 29069, 2, MSForms, Image"
Attribute VB_Control = "btnLimpeza, 29068, 3, MSForms, Image"
Attribute VB_Control = "imgField, 9388, 4, MSForms, Image"
Attribute VB_Control = "btnSigilosoOFF, 28930, 5, MSForms, Image"
Attribute VB_Control = "btnSigilosoON, 28931, 6, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora1, 29048, 7, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora2, 29064, 8, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora3, 29065, 9, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora4, 29066, 10, MSForms, Image"
Attribute VB_Control = "shpLogoCorretora5, 29067, 11, MSForms, Image"
Attribute VB_Control = "btnUpdate, 29071, 12, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call configAjustarLogosCorretoras
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** AJUSTA CORRETORA 1
    If Not (Application.Intersect(Worksheets("config").Range("D19"), Target) Is Nothing) Then
        Call configRemoverCorretora1
        
    End If
    
'*************************************************************************************************************************** AJUSTA CORRETORAS 2 A 5
' altera status de edi|fffd||fffd|o das corretoras cadastradas
    If Not (Application.Intersect(Worksheets("config").Range("tabConfigCorretoras[Corretora]"), Target) Is Nothing) Then
        
' define logotipo corretora 1
        If Sheets("config").Range("C19") <> "" Then
            On Error Resume Next
            logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\" & Range("D19") & ".jpg"
            Sheets("config").shpLogoCorretora1.Picture = LoadPicture(logoCorretora)
            Sheets("carteiraCaixa").shpLogoCorretora1.Picture = LoadPicture(logoCorretora)
        
        End If
        
' define logotipo corretora 2
        If Sheets("config").Range("C20") <> "" Then
            On Error Resume Next
            logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\" & Range("D20") & ".jpg"
            Sheets("config").shpLogoCorretora2.Picture = LoadPicture(logoCorretora)
            Sheets("carteiraCaixa").shpLogoCorretora2.Picture = LoadPicture(logoCorretora)
        
        End If
        
' define logotipo corretora 3
        If Sheets("config").Range("C21") <> "" Then
            On Error Resume Next
            logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\" & Range("D21") & ".jpg"
            Sheets("config").shpLogoCorretora3.Picture = LoadPicture(logoCorretora)
            Sheets("carteiraCaixa").shpLogoCorretora3.Picture = LoadPicture(logoCorretora)
        
        End If
        
' define logotipo corretora 4
        If Sheets("config").Range("C22") <> "" Then
            On Error Resume Next
            logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\" & Range("D22") & ".jpg"
            Sheets("config").shpLogoCorretora4.Picture = LoadPicture(logoCorretora)
            Sheets("carteiraCaixa").shpLogoCorretora4.Picture = LoadPicture(logoCorretora)
        
        End If
        
' define logotipo corretora 5
        If Sheets("config").Range("C23") <> "" Then
            On Error Resume Next
            logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\" & Range("D23") & ".jpg"
            Sheets("config").shpLogoCorretora5.Picture = LoadPicture(logoCorretora)
            Sheets("carteiraCaixa").shpLogoCorretora5.Picture = LoadPicture(logoCorretora)
        
        End If

'***************************************************************************************************************************
        If Sheets("config").Range("C19") = "" Then
            Sheets("config").Shapes.Range(Array("shpLogoCorretora2", "shpLogoCorretora3", "shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
            Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora2", "shpLogoCorretora2", "shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
            
            logoCorretora = ThisWorkbook.Path & "\imagery\corretoras\_none.jpg"
            Sheets("config").shpLogoCorretora1.Picture = LoadPicture(logoCorretora)
            Sheets("carteiraCaixa").shpLogoCorretora1.Picture = LoadPicture(logoCorretora)
            Else
                            
            If Sheets("config").Range("C20") = "" Then
                Sheets("config").Shapes.Range(Array("shpLogoCorretora2", "shpLogoCorretora3", "shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
                Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora2", "shpLogoCorretora2", "shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
                Else
                
                If Sheets("config").Range("C21") = "" Then
                    Sheets("config").Shapes.Range(Array("shpLogoCorretora3", "shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
                    Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora3", "shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
                    Else
                    
                    If Sheets("config").Range("C22") = "" Then
                        Sheets("config").Shapes.Range(Array("shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
                        Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora4", "shpLogoCorretora5")).Visible = False
                        Else
                        
                        If Sheets("config").Range("C23") = "" Then
                            Sheets("config").Shapes.Range(Array("shpLogoCorretora5")).Visible = False
                            Sheets("carteiraCaixa").Shapes.Range(Array("shpLogoCorretora5")).Visible = False
                            
                        End If
                    End If
                End If
            End If
        End If
        
' bloqueia config
    Sheets("config").Unprotect
    Sheets("config").Range("A1").Select
    Sheets("config").Range("tabConfigCorretoras[Corretora]").Locked = True
    Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    Exit Sub
    End If
    
'***************************************************************************************************************************
' disponibiliza balanceamento personalizado
    If Not (Application.Intersect(Worksheets("config").Range("E11"), Target) Is Nothing) Then
        If Sheets("config").Cells(11, 5) <> "Personalizado" Then
            Sheets("config").Unprotect
            Range("K8:M8").Locked = True
            Range("K8:M8") = ""
            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            Else
            
            Sheets("config").Unprotect
            Range("K8:M8").Locked = False
            Range("K8:M8") = 0
            Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
        End If
    End If
    Exit Sub
    
End Sub
Private Sub btnSigilosoON_Click()
    Call configModoSigiloso
End Sub
Private Sub btnSigilosoON_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraSigiloso1
End Sub
Private Sub btnSigilosoOFF_Click()
    Call configModoSigiloso
End Sub
Private Sub btnSigilosoOFF_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCarteiraSigiloso3
End Sub
Private Sub imgDBB_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    tooltipConfigDatabase1
End Sub
Private Sub imgDBB_Click()
    Call configAcessarDatabase
End Sub
Private Sub imgDBC_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    tooltipConfigDatabase1
End Sub
Private Sub imgDBC_Click()
    Call configAcessarDatabase
End Sub
Private Sub btnLimpeza_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    tooltipConfigLimpeza1
End Sub
Private Sub btnLimpeza_Click()
    Call configLimpezaGeral
End Sub
Private Sub btnUpdate_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    tooltipConfigUpdate1
End Sub
Private Sub btnUpdate_Click()
    Call configUpdate
End Sub



Attribute VB_Name = "P_Contato"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_DatabaseA|fffd||fffd|es"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "icoInclus|fffd|o, 4, 1, MSForms, Image"
Attribute VB_Control = "icoAltera|fffd||fffd|o, 12, 2, MSForms, Image"
Attribute VB_Control = "icoExclus|fffd|o, 13, 3, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA|fffd||fffd|O DE CAMPOS
' gerenciamento de erro
    If Not (Application.Intersect(Worksheets("databaseWebA|fffd||fffd|es").Range("F3"), Target) Is Nothing) Then
        
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
        If Sheets("databaseWebA|fffd||fffd|es").Range("J3") <> "" Or Sheets("databaseWebA|fffd||fffd|es").Range("L3") <> "" Then
            MsgBox "Ops! Existe outra tarefa em andamento. Finalize-a primeiro.", vbCritical, "  Invest Masterplan |fffd| " & Year(Now)
            Exit Sub
            Else
            
' protege campo com nome da empresa
            If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "Inclus|fffd|o" Then
                Sheets("databaseWebA|fffd||fffd|es").Unprotect
                Range("H3:I3").Locked = False
                Else
                
                Sheets("databaseWebA|fffd||fffd|es").Unprotect
                Range("H3:I3").Locked = True
                Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
            End If
            
' reseta valores dos campos
            If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "#Selecionar" Then
                Sheets("databaseWebA|fffd||fffd|es").Unprotect
                Sheets("databaseWebA|fffd||fffd|es").Range("G3:H3") = ""
                Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoAltera|fffd||fffd|o", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoNone")).Visible = True
                Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
                If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "Altera|fffd||fffd|o" Then
                    Sheets("databaseWebA|fffd||fffd|es").Unprotect
                    Sheets("databaseWebA|fffd||fffd|es").Cells(3, 7) = "#C|fffd|digo"
                    Sheets("databaseWebA|fffd||fffd|es").Range("H3").FormulaR1C1 = "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Empresa"",VLOOKUP(RC[-1],tabDatabaseWebA|fffd||fffd|es,3,0)),""C|fffd|digo inv|fffd|lido"")"
                    Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoNone", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                    Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = True
                    Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Exit Sub
                    Else
                    
                    If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "Exclus|fffd|o" Then
                        Sheets("databaseWebA|fffd||fffd|es").Unprotect
                        Sheets("databaseWebA|fffd||fffd|es").Cells(3, 7) = "#C|fffd|digo"
                        Sheets("databaseWebA|fffd||fffd|es").Range("H3").FormulaR1C1 = "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Empresa"",VLOOKUP(RC[-1],tabDatabaseWebA|fffd||fffd|es,3,0)),""C|fffd|digo inv|fffd|lido"")"
                        Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoInclus|fffd|o")).Visible = False
                        Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
                        Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        Else
                        
                        If Sheets("databaseWebA|fffd||fffd|es").Cells(3, 6) = "Inclus|fffd|o" Then
                            Sheets("databaseWebA|fffd||fffd|es").Unprotect
                            Sheets("databaseWebA|fffd||fffd|es").Cells(3, 7) = "#C|fffd|digo"
                            Sheets("databaseWebA|fffd||fffd|es").Cells(3, 8) = "#Empresa"
                            Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoExclus|fffd|o")).Visible = False
                            Sheets("databaseWebA|fffd||fffd|es").Shapes.Range(Array("icoInclus|fffd|o")).Visible = True
                            Sheets("databaseWebA|fffd||fffd|es").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Exit Sub
                            Else
                            
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Private Sub icoAltera|fffd||fffd|o_Click()
    Call databaseAcoesAlteracao
End Sub
Private Sub icoExclus|fffd|o_Click()
    Call databaseAcoesExclusao
End Sub
Private Sub icoInclus|fffd|o_Click()
    Call databaseAcoesInclusao
End Sub


Attribute VB_Name = "P_DatabaseBolsas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_DatabaseCadastros"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_DatabaseC|fffd|mbio"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "icoExclus|fffd|o, 6, 0, MSForms, Image"
Attribute VB_Control = "icoAltera|fffd||fffd|o, 7, 1, MSForms, Image"
Attribute VB_Control = "icoInclus|fffd|o, 8, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA|fffd||fffd|O DE CAMPOS
' gerenciamento de erro
    If Not (Application.Intersect(Worksheets("databaseWebC|fffd|mbio").Range("F3"), Target) Is Nothing) Then
        
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
        If Range("J3") <> "" Or Range("L3") <> "" Then
            MsgBox "Ops! Parece que existe outra tarefa em andamento. Finalize-a primeiro.", vbCritical, "  Invest Masterplan |fffd| " & Year(Now)
            Exit Sub
            Else
            
' protege campo com nome da empresa
            If Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "Inclus|fffd|o" Then
                Sheets("databaseWebC|fffd|mbio").Unprotect
                Range("H3:I3").Locked = False
                Else
                Sheets("databaseWebC|fffd|mbio").Unprotect
                Range("H3:I3").Locked = True
                Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
            End If
            
' reseta valores dos campos
            If Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "#Selecionar" Then
                Sheets("databaseWebC|fffd|mbio").Unprotect
                Sheets("databaseWebC|fffd|mbio").Range("G3:H3") = ""
                Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoAltera|fffd||fffd|o", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoNone")).Visible = True
                Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
                If Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "Altera|fffd||fffd|o" Then
                    Sheets("databaseWebC|fffd|mbio").Unprotect
                    Sheets("databaseWebC|fffd|mbio").Cells(3, 7) = "#C|fffd|digo"
                    Sheets("databaseWebC|fffd|mbio").Range("H3").FormulaR1C1 = _
                    "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Moeda"",INDEX(tabDatabaseWebC|fffd|mbio[Moeda],MATCH(RC[-1],tabDatabaseWebC|fffd|mbio[C|fffd|digo],0))),""C|fffd|digo inv|fffd|lido"")"
                    Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoNone", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                    Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = True
                    Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Range("G3").Select
                    Exit Sub
                    Else
                    
                    If Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "Exclus|fffd|o" Then
                        Sheets("databaseWebC|fffd|mbio").Unprotect
                        Sheets("databaseWebC|fffd|mbio").Cells(3, 7) = "#C|fffd|digo"
                        Sheets("databaseWebC|fffd|mbio").Range("H3").FormulaR1C1 = _
                        "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Moeda"",INDEX(tabDatabaseWebC|fffd|mbio[Moeda],MATCH(RC[-1],tabDatabaseWebC|fffd|mbio[C|fffd|digo],0))),""C|fffd|digo inv|fffd|lido"")"
                        Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoInclus|fffd|o")).Visible = False
                        Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
                        Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Range("G3").Select
                        Exit Sub
                        Else
                        
                        If Sheets("databaseWebC|fffd|mbio").Cells(3, 6) = "Inclus|fffd|o" Then
                            Sheets("databaseWebC|fffd|mbio").Unprotect
                            Sheets("databaseWebC|fffd|mbio").Cells(3, 7) = "#C|fffd|digo"
                            Sheets("databaseWebC|fffd|mbio").Cells(3, 8) = "#Moeda"
                            Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoExclus|fffd|o")).Visible = False
                            Sheets("databaseWebC|fffd|mbio").Shapes.Range(Array("icoInclus|fffd|o")).Visible = True
                            Sheets("databaseWebC|fffd|mbio").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Range("G3").Select
                            Exit Sub
                            Else
                            
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Private Sub icoExclus|fffd|o_Click()
    Call databaseCambioExclusao
End Sub
Private Sub icoInclus|fffd|o_Click()
    Call databaseCambioInclusao
End Sub
Private Sub icoAltera|fffd||fffd|o_Click()
    Call databaseCambioAlteracao
End Sub


Attribute VB_Name = "P_DatabaseETFs"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "icoInclus|fffd|o, 2, 0, MSForms, Image"
Attribute VB_Control = "icoAltera|fffd||fffd|o, 3, 1, MSForms, Image"
Attribute VB_Control = "icoExclus|fffd|o, 7, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA|fffd||fffd|O DE CAMPOS
' gerenciamento de erro
    If Not (Application.Intersect(Worksheets("databaseWebETFs").Range("F3"), Target) Is Nothing) Then
        
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
        If Sheets("databaseWebETFs").Range("J3") <> "" Or Sheets("databaseWebETFs").Range("L3") <> "" Then
            MsgBox "Ops! Existe outra tarefa em andamento. Finalize-a primeiro.", vbCritical, "  Invest Masterplan |fffd| " & Year(Now)
            Exit Sub
            Else
            
' protege campo com nome da empresa
            If Sheets("databaseWebETFs").Cells(3, 6) = "Inclus|fffd|o" Then
                Sheets("databaseWebETFs").Unprotect
                Range("H3:I3").Locked = False
                Else
                Sheets("databaseWebETFs").Unprotect
                Range("H3:I3").Locked = True
                Sheets("databaseWebETFs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
            End If
            
' reseta valores dos campos
            If Sheets("databaseWebETFs").Cells(3, 6) = "#Selecionar" Then
                Sheets("databaseWebETFs").Unprotect
                Sheets("databaseWebETFs").Range("G3:H3") = ""
                Sheets("databaseWebETFs").Shapes.Range(Array("icoAltera|fffd||fffd|o", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                Sheets("databaseWebETFs").Shapes.Range(Array("icoNone")).Visible = True
                Sheets("databaseWebETFs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
                If Sheets("databaseWebETFs").Cells(3, 6) = "Altera|fffd||fffd|o" Then
                    Sheets("databaseWebETFs").Unprotect
                    Sheets("databaseWebETFs").Cells(3, 7) = "#C|fffd|digo"
                    Sheets("databaseWebETFs").Range("H3").FormulaR1C1 = "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Fundo"",VLOOKUP(RC[-1],tabDatabaseWebETFs,3,0)),""C|fffd|digo inv|fffd|lido"")"
                    Sheets("databaseWebETFs").Shapes.Range(Array("icoNone", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                    Sheets("databaseWebETFs").Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = True
                    Sheets("databaseWebETFs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Exit Sub
                    Else
                    
                    If Sheets("databaseWebETFs").Cells(3, 6) = "Exclus|fffd|o" Then
                        Sheets("databaseWebETFs").Unprotect
                        Sheets("databaseWebETFs").Cells(3, 7) = "#C|fffd|digo"
                        Sheets("databaseWebETFs").Range("H3").FormulaR1C1 = "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Fundo"",VLOOKUP(RC[-1],tabDatabaseWebETFs,3,0)),""C|fffd|digo inv|fffd|lido"")"
                        Sheets("databaseWebETFs").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoInclus|fffd|o")).Visible = False
                        Sheets("databaseWebETFs").Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
                        Sheets("databaseWebETFs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        Else
                        
                        If Sheets("databaseWebETFs").Cells(3, 6) = "Inclus|fffd|o" Then
                            Sheets("databaseWebETFs").Unprotect
                            Sheets("databaseWebETFs").Cells(3, 7) = "#C|fffd|digo"
                            Sheets("databaseWebETFs").Cells(3, 8) = "#Fundo"
                            Sheets("databaseWebETFs").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoExclus|fffd|o")).Visible = False
                            Sheets("databaseWebETFs").Shapes.Range(Array("icoInclus|fffd|o")).Visible = True
                            Sheets("databaseWebETFs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Exit Sub
                            Else
                            
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Private Sub icoAltera|fffd||fffd|o_Click()
    Call databaseETFsAlteracao
End Sub
Private Sub icoInclus|fffd|o_Click()
    Call databaseETFsInclusao
End Sub
Private Sub icoExclus|fffd|o_Click()
    Call databaseETFsExclusao
End Sub




Attribute VB_Name = "P_DatabaseFIIs"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "icoInclus|fffd|o, 2, 0, MSForms, Image"
Attribute VB_Control = "icoAltera|fffd||fffd|o, 3, 1, MSForms, Image"
Attribute VB_Control = "icoExclus|fffd|o, 5, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IDENTIFICA|fffd||fffd|O DE CAMPOS
' gerenciamento de erro
    If Not (Application.Intersect(Worksheets("databaseWebFIIs").Range("F3"), Target) Is Nothing) Then
        
' verifica se h|fffd| outra opera|fffd||fffd|o em andamento
        If Range("J3") <> "" Or Range("L3") <> "" Then
            MsgBox "Ops! Parece que existe outra tarefa em andamento. Finalize-a primeiro.", vbCritical, "  Invest Masterplan |fffd| " & Year(Now)
            Exit Sub
            Else
            
' protege campo com nome da empresa
            If Sheets("databaseWebFIIs").Cells(3, 6) = "Inclus|fffd|o" Then
                Sheets("databaseWebFIIs").Unprotect
                Range("H3:I3").Locked = False
                Else
                Sheets("databaseWebFIIs").Unprotect
                Range("H3:I3").Locked = True
                Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
            End If
            
' reseta valores dos campos
            If Sheets("databaseWebFIIs").Cells(3, 6) = "#Selecionar" Then
                Sheets("databaseWebFIIs").Unprotect
                Sheets("databaseWebFIIs").Range("G3:H3") = ""
                Sheets("databaseWebFIIs").Shapes.Range(Array("icoAltera|fffd||fffd|o", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                Sheets("databaseWebFIIs").Shapes.Range(Array("icoNone")).Visible = True
                Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
                If Sheets("databaseWebFIIs").Cells(3, 6) = "Altera|fffd||fffd|o" Then
                    Sheets("databaseWebFIIs").Unprotect
                    Sheets("databaseWebFIIs").Cells(3, 7) = "#C|fffd|digo"
                    Sheets("databaseWebFIIs").Range("H3").FormulaR1C1 = "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Fundo"",VLOOKUP(RC[-1],tabDatabaseWebFIIs,3,0)),""C|fffd|digo inv|fffd|lido"")"
                    Sheets("databaseWebFIIs").Shapes.Range(Array("icoNone", "icoExclus|fffd|o", "icoInclus|fffd|o")).Visible = False
                    Sheets("databaseWebFIIs").Shapes.Range(Array("icoAltera|fffd||fffd|o")).Visible = True
                    Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Exit Sub
                    Else
                    
                    If Sheets("databaseWebFIIs").Cells(3, 6) = "Exclus|fffd|o" Then
                        Sheets("databaseWebFIIs").Unprotect
                        Sheets("databaseWebFIIs").Cells(3, 7) = "#C|fffd|digo"
                        Sheets("databaseWebFIIs").Range("H3").FormulaR1C1 = "=IFERROR(IF(RC[-1]=""#C|fffd|digo"",""#Fundo"",VLOOKUP(RC[-1],tabDatabaseWebFIIs,3,0)),""C|fffd|digo inv|fffd|lido"")"
                        Sheets("databaseWebFIIs").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoInclus|fffd|o")).Visible = False
                        Sheets("databaseWebFIIs").Shapes.Range(Array("icoExclus|fffd|o")).Visible = True
                        Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        Else
                        
                        If Sheets("databaseWebFIIs").Cells(3, 6) = "Inclus|fffd|o" Then
                            Sheets("databaseWebFIIs").Unprotect
                            Sheets("databaseWebFIIs").Cells(3, 7) = "#C|fffd|digo"
                            Sheets("databaseWebFIIs").Cells(3, 8) = "#Fundo"
                            Sheets("databaseWebFIIs").Shapes.Range(Array("icoNone", "icoAltera|fffd||fffd|o", "icoExclus|fffd|o")).Visible = False
                            Sheets("databaseWebFIIs").Shapes.Range(Array("icoInclus|fffd|o")).Visible = True
                            Sheets("databaseWebFIIs").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Exit Sub
                            Else
                            
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub
Private Sub icoAltera|fffd||fffd|o_Click()
    Call databaseFIIsAlteracao
End Sub
Private Sub icoInclus|fffd|o_Click()
    Call databaseFIIsInclusao
End Sub
Private Sub icoExclus|fffd|o_Click()
    Call databaseAcoesExclusao
End Sub



Attribute VB_Name = "P_DatabaseIndicadores"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_DatabaseInst"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_DatabaseTesouro"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_Database|fffd|ndices"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_ETFsCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 4430, 0, MSForms, Image"
Attribute VB_Control = "btnGrafico, 2609, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 4435, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call etfsCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabA|fffd||fffd|esCarteira
        On Error GoTo finalizaClassificacao
        If Not (Application.Intersect(Worksheets("a|fffd||fffd|esCarteira").Range("C18:C100"), Target) Is Nothing) Then
        
' classifica|fffd||fffd|o crescente por data de opera|fffd||fffd|o
            ActiveWorkbook.Worksheets("a|fffd||fffd|esCarteira").ListObjects("tabA|fffd||fffd|esCarteira").Sort.SortFields.Clear
            ActiveWorkbook.Worksheets("a|fffd||fffd|esCarteira").ListObjects("tabA|fffd||fffd|esCarteira").Sort. _
                SortFields.Add Key:=Range("tabA|fffd||fffd|esCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
                xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
            With ActiveWorkbook.Worksheets("a|fffd||fffd|esCarteira").ListObjects("tabA|fffd||fffd|esCarteira").Sort
                .Header = xlYes
                .MatchCase = False
                .Orientation = xlTopToBottom
                .SortMethod = xlPinYin
                .Apply
            End With
            Exit Sub
            
        End If
    End If
    
finalizaClassificacao:
    Exit Sub
    
End Sub
Private Sub btnGrafico_Click()
    Call etfsCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipETFsGraf1
End Sub
Private Sub btnRotulo_Click()
    Call etfsCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipETFsRotulo1
End Sub
Private Sub logoField_Click()
    Call etfsCarteiraRecompra
End Sub

Attribute VB_Name = "P_ETFsCompras"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 4426, 1, MSForms, Image"
Attribute VB_Control = "btnLink1, 2575, 2, MSForms, Image"
Attribute VB_Control = "btnLink2, 2576, 3, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("etfsCompras").Range("F6"), Target) Is Nothing) Then
            Call etfsComprasLogo
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("etfsCompras").Range("tabETFsCompras"), Target) Is Nothing) Then
            Call etfsCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub btnLink1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipETFsBitbolsa1
End Sub
Private Sub btnLink1_Click()
    Call etfsLinkBitbolsa
End Sub
Private Sub btnLink2_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipETFsSite1
End Sub
Private Sub btnLink2_Click()
    Call etfsLinkSite
End Sub
Attribute VB_Name = "P_ETFsVendas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLimparHist, 4384, 0, MSForms, Image"
Attribute VB_Control = "logoField, 4381, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call etfsLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipETFsHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Or Sheets("carteiraOp").Cells(1, 12) > 0 Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("etfsVendas").Range("F6"), Target) Is Nothing) Then
            Call etfsVendasLogo
            Call ajustaGhostCell
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("etfsVendas").Range("tabETFsVendas"), Target) Is Nothing) Then
            Call etfsCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub


Attribute VB_Name = "P_FIIsCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 3486, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5570, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 5591, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call fiisCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabFIIsCarteira
        On Error GoTo finalizaClassificacao
        If Not (Application.Intersect(Worksheets("fiisCarteira").Range("C18:C100"), Target) Is Nothing) Then
        
' classifica|fffd||fffd|o crescente por c|fffd|digo
        ActiveWorkbook.Worksheets("fiisCarteira").ListObjects("tabFIIsCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("fiisCarteira").ListObjects("tabFIIsCarteira").Sort. _
            SortFields.Add Key:=Range("tabFIIsCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("fiisCarteira").ListObjects("tabFIIsCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With
        Exit Sub
        
    End If
    End If
    
finalizaClassificacao:
    Exit Sub
    
End Sub
Private Sub btnGrafico_Click()
    Call fiisCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFIIsGraf1
End Sub
Private Sub btnRotulo_Click()
    Call fiisCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFIIsRotulo1
End Sub
Private Sub logoField_Click()
    Call fiisCarteiraRecompra
End Sub

Attribute VB_Name = "P_FIIsCompras"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLink1, 3458, 1, MSForms, Image"
Attribute VB_Control = "btnLink2, 3460, 2, MSForms, Image"
Attribute VB_Control = "btnLink3, 3461, 3, MSForms, Image"
Attribute VB_Control = "logoField, 5564, 4, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("fiisCompras").Range("F6"), Target) Is Nothing) Then
            Call fiisComprasLogo
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("fiisCompras").Range("tabFIIsCompras"), Target) Is Nothing) Then
            Call fiisCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub btnLink1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFIIsBitbolsa1
End Sub
Private Sub btnLink1_Click()
    Call fiisLinkBitbolsa
End Sub
Private Sub btnLink2_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFIIsSite1
End Sub
Private Sub btnLink2_Click()
    Call fiisLinkSite
End Sub
Private Sub btnLink3_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipClubeFIIsSite1
End Sub
Private Sub btnLink3_Click()
    Call fiisLinkClubeFII
End Sub


Attribute VB_Name = "P_FIIsRendimentos"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "Image1, 3440, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5457, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("fiisRendimentos").Range("D6"), Target) Is Nothing) Then
            Call fiisRendimentosLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub Image1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFIIsProv1
End Sub


Attribute VB_Name = "P_FIIsVendas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLimparHist, 5371, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5368, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call fiisLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFIIsHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Or Sheets("carteiraOp").Cells(1, 12) > 0 Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("fiisVendas").Range("F6"), Target) Is Nothing) Then
            Call fiisVendasLogo
            Call ajustaGhostCell
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("fiisVendas").Range("tabFIIsVendas"), Target) Is Nothing) Then
            Call fiisCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub


Attribute VB_Name = "P_FundosAplic"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Attribute VB_Name = "P_FundosCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 1, 0, MSForms, Image"
Attribute VB_Control = "btnRotulo, 2, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabFundosCarteira
    On Error GoTo finalizaClassificacao
    If Not (Application.Intersect(Worksheets("fundosCarteira").Range("C18:C100"), Target) Is Nothing) Then
    
' classifica|fffd||fffd|o crescente por nome
        Sheets("fundosCarteira").Cells(contLinha, 3).HorizontalAlignment = xlGeneral
        Sheets("fundosCarteira").Cells(contLinha, 3).InsertIndent 2
        
        ActiveWorkbook.Worksheets("fundosCarteira").ListObjects("tabFundosCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("fundosCarteira").ListObjects("tabFundosCarteira").Sort. _
            SortFields.Add Key:=Range("tabFundosCarteira[[#Headers],[Fundo]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("fundosCarteira").ListObjects("tabFundosCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With
        Exit Sub
        
    End If
    End If
    
finalizaClassificacao:
    Exit Sub
End Sub
Private Sub btnGrafico_Click()
    Call fundosCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFundosGraf1
End Sub
Private Sub btnRotulo_Click()
    Call fundosCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFundosRotulo1
End Sub


Attribute VB_Name = "P_FundosResgates"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLimparHist, 2, 0, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call fundosLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFundosHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** GHOSTCELL
' ajusta ghostcell
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("fundosResgates").Range("F6"), Target) Is Nothing) Then
        Call ajustaGhostCell
        Exit Sub
        
    End If
    
End Sub

Attribute VB_Name = "P_LetrasAplic"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLink1, 3538, 0, MSForms, Image"
Attribute VB_Control = "btnLink2, 3539, 1, MSForms, Image"
Attribute VB_Control = "logoField, 5563, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA|fffd||fffd|O DE CAMPOS
' exibe campos de edi|fffd||fffd|o ao iniciar registros
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("letrasAplic").Range("F6"), Target) Is Nothing) Then

' valida status de campos preenchidos
        If Range("H4") <> "Selecione o emissor do t|fffd|tulo" And Range("I5") <> "#Selecionar" Then
            Exit Sub
            Else
            
' desativa campos de edi|fffd||fffd|o para ordem vazia
            If Range("H4") = "Selecione o emissor do t|fffd|tulo" Then
                Sheets("letrasAplic").Unprotect
                Range("I5:I7").Locked = True
                Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Else
                
' reativa campos de edi|fffd||fffd|o ao indicar emissor do t|fffd|tulo
                If Range("H4") <> "Selecione o emissor do t|fffd|tulo" Then
                    Sheets("letrasAplic").Unprotect
                    Range("I5:I7").Locked = False
                    Sheets("letrasAplic").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                
                End If
            End If
        End If
        
' exibe logotipo com imagem em pasta
        Call letrasAplicLogo
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("letrasAplic").Range("tabLetrasAplica|fffd||fffd|es"), Target) Is Nothing) Then
            Call letrasCarteiraLogo
            Exit Sub
            
        End If
        
    End If

End Sub
Private Sub btnLink1_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipLetrasSite1
End Sub
Private Sub btnLink1_Click()
    Call letrasLinkInstituicao
End Sub
Private Sub btnLink2_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipLetrasBancodata1
End Sub
Private Sub btnLink2_Click()
    Call letrasLinkBancoData
End Sub


Attribute VB_Name = "P_LetrasCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 3126, 0, MSForms, Image"
Attribute VB_Control = "logoField, 4932, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 4940, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call letrasCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabLetrasCarteira
    On Error GoTo finalizaClassificacao
    If Not (Application.Intersect(Worksheets("letrasCarteira").Range("C18:C100"), Target) Is Nothing) Then
    
' classifica|fffd||fffd|o crescente por c|fffd|digo
        ActiveWorkbook.Worksheets("letrasCarteira").ListObjects("tabLetrasCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("letrasCarteira").ListObjects("tabLetrasCarteira").Sort. _
            SortFields.Add Key:=Range("tabLetrasCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("letrasCarteira").ListObjects("tabLetrasCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With
        Exit Sub
        
    End If
    
finalizaClassificacao:
    Exit Sub
    
End Sub
Private Sub btnGrafico_Click()
    Call letrasCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipLetrasGraf1
End Sub
Private Sub btnRotulo_Click()
    Call letrasCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipLetrasRotulo1
End Sub
Private Sub logoField_Click()
    Call letrasCarteiraReaplicacao
End Sub

Attribute VB_Name = "P_LetrasResgates"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 4247, 0, MSForms, Image"
Attribute VB_Control = "btnLimparHist, 4249, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call letrasLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipLetrasHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
    Call ajustaGhostCell
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' exibe logotipo com imagem em pasta
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("letrasResgates").Range("F6"), Target) Is Nothing) Then
        Call letrasResgatesLogo
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
    If Not (Application.Intersect(Worksheets("letrasResgates").Range("tabLetrasResgates"), Target) Is Nothing) Then
        Call letrasCarteiraLogo
        Exit Sub
        
    End If
    
End Sub




Attribute VB_Name = "P_Loading"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "imgLoad, 2, 0, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_MercadoBenchmarks"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnBenchIndicadores, 2, 0, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA|fffd||fffd|O DE GR|fffd|FICOS
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' altera gr|fffd|fico automaticamente de acordo com tipo de benchmark
        If Not (Application.Intersect(Worksheets("mercadoBenchmarks").Range("N3"), Target) Is Nothing) Then
            
' benchmark carteira
            If Range("N3") = "Carteira" Then
                Sheets("mercadoBenchmarks").Unprotect
                ActiveSheet.Shapes.Range(Array("grfBenchA|fffd||fffd|es", "grfBenchFIIs", "grfBenchTesouro")).Visible = False
                ActiveSheet.Shapes.Range(Array("grfBenchCarteira")).Visible = True
                Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
' benchmark a|fffd||fffd|es
                If Range("N3") = "A|fffd||fffd|es" Then
                    Sheets("mercadoBenchmarks").Unprotect
                    ActiveSheet.Shapes.Range(Array("grfBenchCarteira", "grfBenchFIIs", "grfBenchTesouro")).Visible = False
                    ActiveSheet.Shapes.Range(Array("grfBenchA|fffd||fffd|es")).Visible = True
                    Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Exit Sub
                    Else
                    
' benchmark fiis
                    If Range("N3") = "FIIs" Then
                        Sheets("mercadoBenchmarks").Unprotect
                        ActiveSheet.Shapes.Range(Array("grfBenchCarteira", "grfBenchA|fffd||fffd|es", "grfBenchTesouro")).Visible = False
                        ActiveSheet.Shapes.Range(Array("grfBenchFIIs")).Visible = True
                        Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        Else
                        
' benchmark tesouro
                        If Range("N3") = "Tesouro" Then
                            Sheets("mercadoBenchmarks").Unprotect
                            ActiveSheet.Shapes.Range(Array("grfBenchCarteira", "grfBenchA|fffd||fffd|es", "grfBenchFIIs")).Visible = False
                            ActiveSheet.Shapes.Range(Array("grfBenchTesouro")).Visible = True
                            Sheets("mercadoBenchmarks").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Exit Sub
                            Else
                            
                        End If
                    End If
                End If
            End If
            
            Else
            Exit Sub
        End If
    End If
    
End Sub
Private Sub btnIndicadores_Click()
    Call mercadoIndicadoresEditar
End Sub
Private Sub btnIndicadores_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMercadoIndicadores1
End Sub
Private Sub btnBenchIndicadores_Click()
    Call mercadoIndicadoresAtualizacaoBolsas
End Sub
Private Sub btnBenchIndicadores_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMercadoBenchIndicadores1
End Sub
Attribute VB_Name = "P_MercadoIndicadores"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "imgPT, 2352, 0, MSForms, Image"
Attribute VB_Control = "imgFRA, 2350, 1, MSForms, Image"
Attribute VB_Control = "imgING, 2349, 2, MSForms, Image"
Attribute VB_Control = "imgESP, 2348, 3, MSForms, Image"
Attribute VB_Control = "imgALE, 2347, 4, MSForms, Image"
Attribute VB_Control = "imgUE, 2346, 5, MSForms, Image"
Attribute VB_Control = "imgEUA, 2340, 6, MSForms, Image"
Attribute VB_Control = "imgCHI, 2339, 7, MSForms, Image"
Attribute VB_Control = "imgMEX, 2338, 8, MSForms, Image"
Attribute VB_Control = "imgBRA, 2337, 9, MSForms, Image"
Attribute VB_Control = "imgJAP, 2335, 10, MSForms, Image"
Attribute VB_Control = "imgCAN, 2333, 11, MSForms, Image"
Attribute VB_Control = "btnIndicadores, 2304, 12, MSForms, Image"
Attribute VB_Control = "btnRadar, 610, 13, MSForms, Image"
Attribute VB_Control = "btnTab, 849, 14, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS MERCADO
Private Sub btnRadar_Click()
    Call mercadoIndicadoresAtualizacaoBolsas
End Sub
Private Sub btnRadar_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMercadoRadar1
End Sub
Private Sub btnIndicadores_Click()
    Call mercadoIndicadoresEditar
End Sub
Private Sub btnIndicadores_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMercadoIndicadores1
End Sub
Private Sub btnTab_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMercadoTab1
End Sub

'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** TOOLTIPS BOLSAS
Private Sub imgCAN_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCAN1
End Sub
Private Sub imgJAP_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipJAP1
End Sub
Private Sub imgEUA_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipEUA1
End Sub
Private Sub imgBRA_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipBRA1
End Sub
Private Sub imgMEX_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMEX1
End Sub
Private Sub imgALE_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipALE1
End Sub
Private Sub imgCHI_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipCHI1
End Sub
Private Sub imgUE_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipUE1
End Sub
Private Sub imgFRA_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipFRA1
End Sub
Private Sub imgING_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipING1
End Sub
Private Sub imgESP_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipESP1
End Sub
Private Sub imgPT_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipPT1
End Sub

Attribute VB_Name = "P_MercadoNot|fffd|cias"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 2534, 0, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    On Error Resume Next
    
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        If Not (Application.Intersect(Worksheets("mercadoNot|fffd|cias").Range("E8"), Target) Is Nothing) Then
            Call mercadoNoticiasLogo
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** SELE|fffd||fffd|O DE ATIVOS
' disponibiliza ativo secund|fffd|rio em caso de convers|fffd|o
        If Not (Application.Intersect(Worksheets("mercadoNot|fffd|cias").Range("E5"), Target) Is Nothing) Then
            
            If Range("E5") = "Ex-dividendos" Or Range("E5") = "Ex-juros" Then
                Sheets("mercadoNot|fffd|cias").Unprotect
                Range("J10").Locked = True
                Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
                Range("J10").Locked = False
                Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
                If Range("E5") <> "Convers|fffd|o" Or Range("E5") <> "Altera|fffd||fffd|o de C|fffd|digo" Then
                    Sheets("mercadoNot|fffd|cias").Unprotect
                    ActiveSheet.Shapes.Range(Array("imgConvert")).Visible = False
                    Sheets("mercadoNot|fffd|cias").Cells(8, 6) = ""
                    Range("F8").Locked = True
                    Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Exit Sub
                    Else
                    
                    If Range("E5").Value = "Convers|fffd|o" Or Range("E5") = "Altera|fffd||fffd|o de C|fffd|digo" Then
                        Sheets("mercadoNot|fffd|cias").Unprotect
                        ActiveSheet.Shapes.Range(Array("imgConvert")).Visible = True
                        Sheets("mercadoNot|fffd|cias").Cells(8, 6) = "#C|fffd|digo"
                        Range("F8").Locked = False
                        Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        
                    End If
                End If
            End If
            
            Sheets("mercadoNot|fffd|cias").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
        End If
    End If

End Sub


Attribute VB_Name = "P_MoedasCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 3126, 0, MSForms, Image"
Attribute VB_Control = "logoField, 4932, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 4973, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call moedasCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabMoedasCarteira
    On Error GoTo finalizaClassificacao
    If Not (Application.Intersect(Worksheets("moedasCarteira").Range("C18:C50"), Target) Is Nothing) Then
    
' classifica|fffd||fffd|o crescente por data de opera|fffd||fffd|o
        ActiveWorkbook.Worksheets("moedasCarteira").ListObjects("tabMoedasCarteira").Sort.SortFields.Clear
        ActiveWorkbook.Worksheets("moedasCarteira").ListObjects("tabMoedasCarteira").Sort. _
            SortFields.Add Key:=Range("tabMoedasCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
            xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
        With ActiveWorkbook.Worksheets("moedasCarteira").ListObjects("tabMoedasCarteira").Sort
            .Header = xlYes
            .MatchCase = False
            .Orientation = xlTopToBottom
            .SortMethod = xlPinYin
            .Apply
        End With

    End If
    
finalizaClassificacao:
    Exit Sub
End Sub
Private Sub btnGrafico_Click()
    Call moedasCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMoedasGraf1
End Sub
Private Sub btnRotulo_Click()
    Call moedasCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMoedasRotulo1
End Sub
Private Sub logoField_Click()
    Call moedasCarteiraRecompra
End Sub





Attribute VB_Name = "P_MoedasCompras"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 5447, 0, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' exibe logotipo com imagem em pasta
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("moedasResgates").Range("F6"), Target) Is Nothing) Then
        Call moedasComprasLogo
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
    If Not (Application.Intersect(Worksheets("MOEDAsResgates").Range("tabMoedasResgates"), Target) Is Nothing) Then
        Call moedasCarteiraLogo
        Exit Sub
        
    End If
    
End Sub





Attribute VB_Name = "P_MoedasVendas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 5528, 0, MSForms, Image"
Attribute VB_Control = "btnLimparHist, 5530, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call moedasLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipMoedasHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' exibe logotipo com imagem em pasta
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("moedasResgates").Range("F6"), Target) Is Nothing) Then
        Call moedasVendasLogo
        Exit Sub
        
    End If
    
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
    If Not (Application.Intersect(Worksheets("moedasResgates").Range("tabMoedasResgates"), Target) Is Nothing) Then
        Call moedasCarteiraLogo
        Exit Sub
        
    End If
    
End Sub





Attribute VB_Name = "P_OpEspeciais"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnExcluir, 3, 0, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** SELE|fffd||fffd|O DE ATIVOS
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' disponibiliza ativo secund|fffd|rio em caso de convers|fffd|o
        If Not (Application.Intersect(Worksheets("opEspeciais").Range("E5"), Target) Is Nothing) Then
            Sheets("opEspeciais").Unprotect
            If Range("E5") <> "Convers|fffd|o" And Range("E5") <> "Altera|fffd||fffd|o de C|fffd|digo" Then
                ActiveSheet.Shapes.Range(Array("imgConvert")).Visible = False
                Sheets("opEspeciais").Cells(8, 6) = ""
                Range("F8").Locked = True
                Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Else
                
                If Range("E5") = "Convers|fffd|o" Or Range("E5") = "Altera|fffd||fffd|o de C|fffd|digo" Then
                    ActiveSheet.Shapes.Range(Array("imgConvert")).Visible = True
                    Sheets("opEspeciais").Cells(8, 6) = "#C|fffd|digo"
                    Range("F8").Locked = False
                    Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    
                End If
            End If
            
            
        End If
        
' ajusta campo de liquida|fffd||fffd|o de opera|fffd||fffd|es
        If Not (Application.Intersect(Worksheets("opEspeciais").Range("M7"), Target) Is Nothing) Then
            If Range("M7") = "#C|fffd|digo" Or Range("M7") = "" Then
                Sheets("opEspeciais").Unprotect
                Range("M9").Locked = True
                Range("M9") = ""
                Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                
                Else
                Sheets("opEspeciais").Unprotect
                Range("M9").Locked = False
                Range("M9") = "#Selecionar"
                Sheets("opEspeciais").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Private Sub btnExcluir_Click()
    Call opEspeciaisRemoverOperacao
End Sub

Attribute VB_Name = "P_OpEspeciaisExec"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_TesouroCarteira"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnGrafico, 3086, 0, MSForms, Image"
Attribute VB_Control = "logoField, 4814, 1, MSForms, Image"
Attribute VB_Control = "btnRotulo, 4901, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
    Call tesouroCarteiraLogo
    
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CLASSIFICA|fffd||fffd|O AUTOM|fffd|TICA
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' classifica|fffd||fffd|o autom|fffd|tica da tabela tabTesouroCarteira
        On Error GoTo finalizaClassificacao
        If Not (Application.Intersect(Worksheets("tesouroCarteira").Range("C18:C100"), Target) Is Nothing) Then
        
' classifica|fffd||fffd|o crescente por c|fffd|digo
            ActiveWorkbook.Worksheets("tesouroCarteira").ListObjects("tabTesouroCarteira").Sort.SortFields.Clear
            ActiveWorkbook.Worksheets("tesouroCarteira").ListObjects("tabTesouroCarteira").Sort. _
                SortFields.Add Key:=Range("tabTesouroCarteira[[#Headers],[C|fffd|digo]]"), SortOn:= _
                xlSortOnValues, Order:=xlAscending, DataOption:=xlSortNormal
            With ActiveWorkbook.Worksheets("tesouroCarteira").ListObjects("tabTesouroCarteira").Sort
                .Header = xlYes
                .MatchCase = False
                .Orientation = xlTopToBottom
                .SortMethod = xlPinYin
                .Apply
            End With
            Exit Sub
            
        End If
    End If
    
finalizaClassificacao:
    Exit Sub
    
End Sub
Private Sub btnGrafico_Click()
    Call tesouroCarteiraAltGrafico
End Sub
Private Sub btnGrafico_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipTesouroGraf1
End Sub
Private Sub btnRotulo_Click()
    Call tesouroCarteiraID
End Sub
Private Sub btnRotulo_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipTesouroRotulo1
End Sub
Private Sub logoField_Click()
    Call tesouroCarteiraRecompra
End Sub


Attribute VB_Name = "P_TesouroCompras"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "logoField, 5451, 0, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("tesouroCompras").Range("F6"), Target) Is Nothing) Then
            Call tesouroComprasLogo
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("tesouroCompras").Range("tabTesouroCompras"), Target) Is Nothing) Then
            Call tesouroCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub

Attribute VB_Name = "P_TesouroJuros"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnAno, 3512, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5425, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("tesouroJuros").Range("D6"), Target) Is Nothing) Then
            Call tesouroJurosLogo
            Exit Sub
            
        End If
    End If
    
End Sub
Private Sub btnAno_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipTesouroProv1
End Sub


Attribute VB_Name = "P_TesouroVendas"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLimparHist, 5356, 0, MSForms, Image"
Attribute VB_Control = "logoField, 5353, 1, MSForms, Image"
Private Sub btnLimparHist_Click()
    Call tesouroLimparHistorico
End Sub
Private Sub btnLimparHist_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipTesouroHist1
End Sub
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' gerenciamento de erros
    If up = True Then
        Exit Sub
        Else
        
' exibe logotipo com imagem em pasta
        On Error Resume Next
        
        If Not (Application.Intersect(Worksheets("tesouroVendas").Range("F6"), Target) Is Nothing) Then
            Call tesouroVendasLogo
            Exit Sub
            
        End If
        
'*************************************************************************************************************************** RECOMPRA
' exibe logotipo de recompra na carteira
        If Not (Application.Intersect(Worksheets("tesouroVendas").Range("tabTesouroVendas"), Target) Is Nothing) Then
            Call tesouroCarteiraLogo
            Exit Sub
            
        End If
    End If
    
End Sub


Attribute VB_Name = "P_Tools"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA LOGO
' exibe logotipo com imagem em pasta
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("tools").Range("E23"), Target) Is Nothing) Then
        Call toolsVal1Logo
        Exit Sub
        
    End If
    

End Sub
Attribute VB_Name = "P_ToolsCalculadora"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA|fffd||fffd|O DE C|fffd|LCULOS
' reseta campos de preenchimento
    If Not (Application.Intersect(Worksheets("toolsCalc").Range("M3"), Target) Is Nothing) Then
        Sheets("toolsCalc").Unprotect
        ActiveSheet.Range(Cells(7, 6), Cells(10, 6)).Select
        Selection.Locked = True
        
        If Range("M3") = "#Selecionar" Then
            ActiveSheet.Range(Cells(7, 6), Cells(10, 6)) = "0"
            Range("M3").Select
            Sheets("toolsCalc").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            Exit Sub
            Else
            
            If Range("M3") = "Quanto investir por m|fffd|s?" Then
                ActiveSheet.Cells(10, 6) = ""
                ActiveSheet.Range(Cells(7, 6), Cells(9, 6)) = "0"
                ActiveSheet.Range(Cells(7, 6), Cells(9, 6)).Select
                Selection.Locked = False
                Range("F7").Select
                Sheets("toolsCalc").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                Exit Sub
                Else
                
                If Range("M3") = "Quanto patrim|fffd|nio acumular?" Then
                    ActiveSheet.Range(Cells(9, 6), Cells(10, 6)) = ""
                    ActiveSheet.Range(Cells(7, 6), Cells(8, 6)) = "0"
                    ActiveSheet.Range(Cells(7, 6), Cells(8, 6)).Select
                    Selection.Locked = False
                    Range("F7").Select
                    Sheets("toolsCalc").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                    Exit Sub
                    Else
                    
                    If Range("M3") = "Quanto tempo investir?" Then
                        ActiveSheet.Range(Cells(7, 6), Cells(10, 6)) = "0"
                        ActiveSheet.Range(Cells(7, 6), Cells(10, 6)).Select
                        Selection.Locked = False
                        Range("F7").Select
                        Sheets("toolsCalc").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                        Exit Sub
                        Else
                        
                        If Range("M3") = "Quanto terei no futuro?" Or Range("M3") = "Quanto tempo investir?" Then
                            ActiveSheet.Range(Cells(7, 6), Cells(10, 6)) = "0"
                            ActiveSheet.Range(Cells(7, 6), Cells(10, 6)).Select
                            Selection.Locked = False
                            Range("F7").Select
                            Sheets("toolsCalc").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            Exit Sub
                    
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub

Attribute VB_Name = "P_ToolsCompara"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_ToolsCorretagem"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    contRep = 0
End Sub

Attribute VB_Name = "P_ToolsImposto"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnTrash, 2, 0, MSForms, Image"
Attribute VB_Control = "btnAdd, 1, 1, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub btnAdd_Click()
    Call toolsImpostoNovoInforme
End Sub
Private Sub btnTrash_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXCLUS|fffd|O DE REGISTROS
' confirma exclus|fffd|o de informe
    Dim confirmaExclusao As VbMsgBoxResult
    confirmaExclusao = MsgBox("Deseja remover o informe criado at|fffd| o momento?", vbYesNo + vbQuestion, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now))
    
    If confirmaExclusao = vbNo Then
        Exit Sub
        Else

        Call toolsImpostoExcluirRegistros
        MsgBox "Informe removido com sucesso!", vbInformation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
        
    End If
    
End Sub
Private Sub btnAdd_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal Y As Single)
    Call tooltipLeaoInforme1
End Sub


Attribute VB_Name = "P_ToolsVal1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "btnLink2, 8, 0, MSForms, Image"
Attribute VB_Control = "btnLink1, 7, 1, MSForms, Image"
Attribute VB_Control = "logoField, 1, 2, MSForms, Image"
Private Sub Worksheet_Activate()
    contRep = 0
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = False
Application.OnKey "{ESCAPE}", ""
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** NOVO VALUATION
' exibe logotipo com imagem em pasta
    On Error Resume Next
    
    If Not (Application.Intersect(Worksheets("toolsValuation1").Range("E6"), Target) Is Nothing) Then
        Call toolsVal1NovoValuation
    
    End If
    
End Sub
Private Sub btnLink1_Click()
    Call toolsVal1LinkRI
End Sub
Private Sub btnLink2_Click()
    Call toolsVal1LinkFundamentus
End Sub


Attribute VB_Name = "ThisWorksheet"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
Application.Visible = True
Application.ScreenUpdating = True
ThisWorkbook.UpdateLinks = xlUpdateLinksNever
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** V|fffd|NCULO SUITE
' valida se j|fffd| existe outra aplica|fffd||fffd|o do projeto aberta ou em atualiza|fffd||fffd|o e desativa login
    On Error Resume Next
    
    If up = True Or ThisWorkbook.Name = "Invest Masterplan (old).xlsm" Or ThisWorkbook.Name = "Invest Masterplan (Free) (old).xlsm" Or _
    ThisWorkbook.Name = "Invest Masterplan Premium (old).xlsm" Or ThisWorkbook.Name = "Invest Masterplan Premium (Free) (old).xlsm" Then
        Exit Sub
        Else
        
' verifica se outro arquivo da suite est|fffd| dispon|fffd|vel e libera acesso
        For Each wb In Workbooks
            nomePlan = wb.Name
            
            If nomePlan = "Budget Masterplan.xlsm" Or nomePlan = "Budget Masterplan (Free).xlsm" Then
                ThisWorkbook.Activate
                Application.WindowState = xlMaximized
                Sheets("carteiraPosi|fffd||fffd|o").Activate
                Exit Sub
                Else
                
                If nomePlan = "Travel Masterplan.xlsm" Or nomePlan = "Travel Masterplan (Free).xlsm" Then
                    ThisWorkbook.Activate
                    Application.WindowState = xlMaximized
                    Sheets("carteiraPosi|fffd||fffd|o").Activate
                    Exit Sub
                    Else
                    
                End If
            End If
            
        Next wb
        
'*************************************************************************************************************************** C|fffd|PIA E DESATIVA|fffd||fffd|O
' verifica c|fffd|pia n|fffd|o autorizada
        If ThisWorkbook.Name <> "Invest Masterplan.xlsm" And ThisWorkbook.Name <> "Invest Masterplan (old).xlsm" Then
            MsgBox "Esta c|fffd|pia n|fffd|o foi autorizada.", vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
            ThisWorkbook.Save
            Application.Quit
            Exit Sub
            Else
            
' verifica pedido de cancelamento
            If Sheets("contato").Cells(3, 14) = "Aplica|fffd||fffd|o cancelada" Then
                MsgBox "Esta aplica|fffd||fffd|o foi desativada por pedido de cancelamento. Para mais, acesse 'www.creatifica.com.br/contato'.", _
                vbCritical, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                ThisWorkbook.Save
                Application.Quit
                Exit Sub
                Else
                
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VERS|fffd|O OFFICE E STATUS DA APLICA|fffd||fffd|O
' verifica vers|fffd|o atual do office
                If Application.Version < "15.0" Then
                    MsgBox "Ops! Parece que a vers|fffd|o do seu Pacote Office est|fffd| desatualizada. Para utiliza|fffd||fffd|o dos sistemas Masterplan |fffd| Creatifica |fffd| necess|fffd|rio obter o Office 2013 ou superior.", _
                    vbExclamation, "  " & Replace(ThisWorkbook.Name, ".xlsm", " ") & Year(Now)
                    ThisWorkbook.Save
                    Application.Quit
                    Exit Sub
                    Else
                    
' maximiza tela
                    ThisWorkbook.Activate
                    Sheets("loading").Activate
                    With Application
                        .Wait Now + TimeValue("00:00:02")
                        .DisplayAlerts = False
                        .Caption = " Copyright |fffd| " & Year(Now) & " Creatifica"
                        .WindowState = xlMaximized
                        .ScreenUpdating = False
                        .Visible = False
                        .OnKey "{ESCAPE}", ""
                    End With
                    
'*************************************************************************************************************************** AJUSTES DE RESOLU|fffd||fffd|O
' identifica largura e altura da tela
                    resLargura = GetSystemMetrics(SM_CXSCREEN)
                    resAltura = GetSystemMetrics(SM_CYSCREEN)
                    
' identifica resolu|fffd||fffd|es padr|fffd|o e ajusta formul|fffd|rio
                    If resLargura < 1920 Then
                        frmLoginB.txtEmailB.SetFocus
                        frmLoginB.lblCopyrightB = "|fffd| " & Year(Now) & " Creatifica. Todos os direitos reservados."
                        frmLoginB.Show
                        Exit Sub
                        Else
                        
' esconde aplica|fffd||fffd|o e exibe formul|fffd|rio de login
                        frmLogin.txtEmail.SetFocus
                        frmLogin.lblCopyright = "|fffd| " & Year(Now) & " Creatifica. Todos os direitos reservados."
                        frmLogin.Show
                        Exit Sub
                        
                    End If
                End If
            End If
        End If
    End If
    
End Sub


Attribute VB_Name = "frmAtualizarDados"
Attribute VB_Base = "0{5A396672-FCE1-4AB8-97A5-88651C82B033}{518DC9CF-C947-4A21-9CCE-67E15DCA7F71}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtNovaSenhaConfirma_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnAtualizarDados_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub btnAtualizarDados_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA EMAIL, USUARIO E SENHA
' vari|fffd|veis
    hora = TimeValue(Now)
    data = Range("A1")
    atividade = "Altera|fffd||fffd|o de dados de acesso"
    fNovoUsuario = frmAtualizarDados.txtNovoUsuario.Value
    fNovoEmail = frmAtualizarDados.txtNovoEmail.Value
    fNovaSenha = frmAtualizarDados.txtNovaSenha.Value
    fNovaSenhaConfirma = frmAtualizarDados.txtNovaSenhaConfirma.Value
    
' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
' valida preenchimento de campos
    If fNovoUsuario = "" Then
        MsgBox "Informe o nome de usu|fffd|rio que deseja manter cadastrado.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        frmAtualizarDados.txtNovoUsuario.SetFocus
        Exit Sub
        Else
        
        If fNovoEmail = "" Then
            MsgBox "Informe o e-mail que deseja manter cadastrado.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmAtualizarDados.txtNovoEmail.SetFocus
            Exit Sub
            Else
            
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
            email = validaEmail.Test(frmAtualizarDados.txtNovoEmail.Value)
            If email = False Then
                MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                frmAtualizarDados.txtNovoEmail.SetFocus
                Exit Sub
                Else
                
                If fNovaSenha = "" Then
                    MsgBox "Informe a nova senha.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                    frmAtualizarDados.txtNovaSenha.SetFocus
                    Exit Sub
                    Else
                    
                    If fNovaSenhaConfirma = "" Then
                        MsgBox "Confirme a nova senha para altera|fffd||fffd|o.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                        frmAtualizarDados.txtNovaSenhaConfirma.SetFocus
                        Exit Sub
                        Else
                        
                        If fNovaSenhaConfirma <> fNovaSenha Then
                            MsgBox "A senha informada n|fffd|o confere.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                            Exit Sub
                            Else
                            
' loop para localiza|fffd||fffd|o do usu|fffd|rio
                            contLinha = 5
                            Do Until Sheets("databaseCadastros").Cells(contLinha, 5) = fEmail Or Sheets("databaseCadastros").Cells(contLinha, 5) = ""
                            contLinha = contLinha + 1
                            Loop
                            
' loop para validar se novo email ou novo usu|fffd|rio j|fffd| est|fffd|o cadastrados
                            If fNovoEmail = Sheets("databaseCadastros").Cells(5, 5) Then
                                MsgBox "Ops! Este e-mail j|fffd| est|fffd| sendo utilizado em outra conta. Tente outro!", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                frmAtualizarDados.txtNovoEmail.SetFocus
                                Exit Sub
                                Else
                                
                                If fNovoUsuario = Sheets("databaseCadastros").Cells(5, 4) Then
                                    MsgBox "Ops! Este nome de usu|fffd|rio j|fffd| est|fffd| sendo utilizado em outra conta. Tente outro!", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                    frmAtualizarDados.txtNovoUsuario.SetFocus
                                    Exit Sub
                                
                                End If
                            End If
                            
' registra altera|fffd||fffd|es no banco de dados
                            Sheets("databaseCadastros").Unprotect
                            
                            Sheets("databaseCadastros").Cells(contLinha, 4) = fNovoUsuario
                            Sheets("databaseCadastros").Cells(contLinha, 5) = fNovoEmail
                            Sheets("databaseCadastros").Cells(contLinha, 6) = fNovaSenhaConfirma
                            Sheets("databaseCadastros").Cells(contLinha, 9) = data
                            Sheets("databaseCadastros").Cells(contLinha, 10) = hora
                            Sheets("databaseCadastros").Cells(contLinha, 11) = atividade
                            
' reestabelece formato das colunas e registra log
                            Range("tabDatabaseCadastros[Data]").NumberFormat = "dd/mm/yyyy"
                            Range("A1").Activate
                            Call sysLog
                            
' finaliza|fffd||fffd|es
                            Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            
                            Unload Me
                            MsgBox "Dados alterados com sucesso!", vbInformation, "  Invest Masterplan Premium " & Year(Now)
                            Exit Sub
                            
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Private Sub btnVoltar_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ALTERA|fffd||fffd|O
' cancela altera|fffd||fffd|o de dados
    frmAtualizarDados.txtNovaSenha = ""
    frmAtualizarDados.txtNovaSenhaConfirma = ""
    Unload Me

End Sub

Attribute VB_Name = "frmAtualizarDadosB"
Attribute VB_Base = "0{23DA17F2-F849-4735-B99C-3A369578FCAD}{5E2B17FB-2228-4266-9C77-8B221754BA3A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtNovaSenhaConfirmaB_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnAtualizarDadosB_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub btnAtualizarDadosB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ALTERA EMAIL, USUARIO E SENHA
' vari|fffd|veis
    hora = TimeValue(Now)
    data = Range("A1")
    atividade = "Altera|fffd||fffd|o de dados de acesso"
    fNovoUsuarioB = frmAtualizarDadosB.txtNovoUsuarioB.Value
    fNovoEmailB = frmAtualizarDadosB.txtNovoEmailB.Value
    fNovaSenhaB = frmAtualizarDadosB.txtNovaSenhaB.Value
    fNovaSenhaConfirmaB = frmAtualizarDadosB.txtNovaSenhaConfirmaB.Value
    
' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
' valida preenchimento de campos
    If fNovoUsuarioB = "" Then
        MsgBox "Informe o nome de usu|fffd|rio que deseja manter cadastrado.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        frmAtualizarDadosB.txtNovoUsuarioB.SetFocus
        Exit Sub
        Else
        
        If fNovoEmailB = "" Then
            MsgBox "Informe o e-mail que deseja manter cadastrado.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmAtualizarDadosB.txtNovoEmailB.SetFocus
            Exit Sub
            Else
            
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
            email = validaEmail.Test(frmAtualizarDadosB.txtNovoEmailB.Value)
            If email = False Then
                MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                frmAtualizarDadosB.txtNovoEmailB.SetFocus
                Exit Sub
                Else
                
                If fNovaSenhaB = "" Then
                    MsgBox "Informe a nova senha.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                    frmAtualizarDadosB.txtNovaSenhaB.SetFocus
                    Exit Sub
                    Else
                    
                    If fNovaSenhaConfirmaB = "" Then
                        MsgBox "Confirme a nova senha para altera|fffd||fffd|o.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                        frmAtualizarDadosB.txtNovaSenhaConfirmaB.SetFocus
                        Exit Sub
                        Else
                        
                        If fNovaSenhaConfirmaB <> fNovaSenhaB Then
                            MsgBox "A senha informada n|fffd|o confere.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                            Exit Sub
                            Else
                            
' loop para localiza|fffd||fffd|o do usu|fffd|rio
                            contLinha = 5
                            Do Until Sheets("databaseCadastros").Cells(contLinha, 5) = fEmailB Or Sheets("databaseCadastros").Cells(contLinha, 5) = ""
                            contLinha = contLinha + 1
                            Loop
                            
' loop para validar se novo email ou novo usu|fffd|rio j|fffd| est|fffd|o cadastrados
                            If fNovoEmailB = Sheets("databaseCadastros").Cells(5, 5) Then
                                MsgBox "Ops! Este e-mail j|fffd| est|fffd| sendo utilizado em outra conta. Tente outro!", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                frmAtualizarDadosB.txtNovoEmailB.SetFocus
                                Exit Sub
                                Else
                                
                                If fNovoUsuarioB = Sheets("databaseCadastros").Cells(5, 4) Then
                                    MsgBox "Ops! Este nome de usu|fffd|rio j|fffd| est|fffd| sendo utilizado em outra conta. Tente outro!", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                    frmAtualizarDadosB.txtNovoUsuarioB.SetFocus
                                    Exit Sub
                                
                                End If
                            End If
                            
' registra altera|fffd||fffd|es no banco de dados
                            Sheets("databaseCadastros").Unprotect
                            
                            Sheets("databaseCadastros").Cells(contLinha, 4) = fNovoUsuarioB
                            Sheets("databaseCadastros").Cells(contLinha, 5) = fNovoEmailB
                            Sheets("databaseCadastros").Cells(contLinha, 6) = fNovaSenhaConfirmaB
                            Sheets("databaseCadastros").Cells(contLinha, 9) = data
                            Sheets("databaseCadastros").Cells(contLinha, 10) = hora
                            Sheets("databaseCadastros").Cells(contLinha, 11) = atividade
                            
' reestabelece formato das colunas e registra log
                            Range("tabDatabaseCadastros[Data]").NumberFormat = "dd/mm/yyyy"
                            Range("A1").Activate
                            Call sysLog
                            
' finaliza|fffd||fffd|es
                            Sheets("databaseCadastros").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                            
                            Unload Me
                            MsgBox "Dados alterados com sucesso!", vbInformation, "  Invest Masterplan Premium " & Year(Now)
                            Exit Sub
                            
                        End If
                    End If
                End If
            End If
        End If
    End If

End Sub
Private Sub btnVoltarB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ALTERA|fffd||fffd|O
' cancela altera|fffd||fffd|o de dados
    frmAtualizarDadosB.txtNovaSenhaB = ""
    frmAtualizarDadosB.txtNovaSenhaConfirmaB = ""
    Unload Me

End Sub

Attribute VB_Name = "frmCadastro"
Attribute VB_Base = "0{D1D09653-13E3-407C-BC00-60D2CB8C34DD}{F1FD0A26-F77C-45AE-9171-169390006B7E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtCadSenhaConfirma_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnCadastrar_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub txtCadUsuario_Change()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' limita caracteres do usu|fffd|rio
    txtCadUsuario.MaxLength = 20
    
End Sub
Private Sub txtCadNome_Change()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' limita caracteres do nome
    txtCadNome.MaxLength = 35
    
' define campo num|fffd|rico
    If Len(txtCadNome) > 0 Then
        temp = Len(txtCadNome)
        contVal = Right(txtCadNome, 1)
        
        If IsNumeric(contVal) Then
            txtCadNome = Left(txtCadNome, temp - 1)
            
        End If
    End If

End Sub
Private Sub btnVoltar_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA CADASTRO
' cancela cadastro e volta ao formul|fffd|rio login
    frmCadastro.txtCadNome = ""
    frmCadastro.txtCadUsuario = ""
    frmCadastro.txtCadEmail = ""
    frmCadastro.txtCadSenha = ""
    frmCadastro.txtCadSenhaConfirma = ""
    
    Unload Me
    frmLogin.Show
    frmLogin.txtEmail.SetFocus

End Sub
Private Sub btnCadastrar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVO CADASTRO
' vari|fffd|veis
    hora = TimeValue(Now)
    data = Sheets("mercadoIndicadores").Cells(1, 1)
    atividade = "Cadastro Usu|fffd|rio"
    fNome = frmCadastro.txtCadNome.Value
    fUsuario = frmCadastro.txtCadUsuario.Value
    fEmail = frmCadastro.txtCadEmail.Value
    fSenha = frmCadastro.txtCadSenha.Value
    fSenhaConfirma = frmCadastro.txtCadSenhaConfirma.Value
    
' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
' valida|fffd||fffd|o de campos
    If fNome = "" Then
        MsgBox "Informe seu nome completo para cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        frmCadastro.txtCadNome.SetFocus
        Exit Sub
        Else
        
        If fUsuario = "" Then
            MsgBox "Informe um nome de usu|fffd|rio para seu cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmCadastro.txtCadUsuario.SetFocus
            Exit Sub
            Else
            
            If fEmail = "" Then
                MsgBox "Informe seu e-mail para cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                frmCadastro.txtCadEmail.SetFocus
                Exit Sub
                Else
                
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
                email = validaEmail.Test(frmCadastro.txtCadEmail.Value)
                If email = False Then
                    MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                    frmCadastro.txtCadEmail.SetFocus
                    Exit Sub
                    Else
                    
                    If fSenha = "" Then
                        MsgBox "Informe uma senha para cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                        frmCadastro.txtCadSenha.SetFocus
                        Exit Sub
                        Else
                        
                        If fSenhaConfirma = "" Then
                            MsgBox "Confirme a senha digitada.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                            frmCadastro.txtCadSenhaConfirma.SetFocus
                            Exit Sub
                            Else
                            
                            If fSenha <> fSenhaConfirma Then
                                MsgBox "A senha informada n|fffd|o confere.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                frmCadastro.txtCadSenhaConfirma.SetFocus
                                Exit Sub
                                Else
                                
                                If IsNumeric(fSenha) Then
                                    MsgBox "Ops! Para maior seguran|fffd|a, a senha precisa conter tamb|fffd|m letras e/ou caracteres especiais.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                    frmCadastro.txtCadSenha.SetFocus
                                    Exit Sub
                                    Else
                                    
' loop para verificar se dados cadastrados j|fffd| existem, evitando duplicidade
                                    contLinha = 5
                                    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
                                    
' loop para validar se dados j|fffd| est|fffd|o cadastrados
                                    If Sheets("databaseCadastros").Cells(contLinha, 3) = fNome Then
                                        MsgBox "Ops! Este nome j|fffd| est|fffd| sendo utilizado em outra conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                        frmCadastro.txtCadNome.SetFocus
                                        Exit Sub
                                        Else
                                        
                                        If Sheets("databaseCadastros").Cells(contLinha, 4) = fUsuario Then
                                            MsgBox "Ops! Este usu|fffd|rio j|fffd| est|fffd| sendo utilizado em outra conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                            frmCadastro.txtCadUsuario.SetFocus
                                            Exit Sub
                                            Else
                                            
                                            If Sheets("databaseCadastros").Cells(contLinha, 5) = fEmail Then
                                                MsgBox "Ops! Este  e-mail j|fffd| est|fffd| sendo utilizado em outra conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                                frmCadastro.txtCadEmail.SetFocus
                                                Exit Sub
                                                Else
                                            
                                            End If
                                        End If
                                    End If
                                    
                                    contLinha = contLinha + 1
                                    Loop
                                    
' loop para validar quantidade de usu|fffd|rios cadastrados para limitar acessos
                                    contLinha = 5
                                    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
                                    contLinha = contLinha + 1
                                    Loop
                                    
' registro de dados na tabela de cadastros
                                    Sheets("databaseCadastros").Unprotect
                                    
                                    Sheets("databaseCadastros").Cells(contLinha, 3) = fNome
                                    Sheets("databaseCadastros").Cells(contLinha, 4) = fUsuario
                                    Sheets("databaseCadastros").Cells(contLinha, 5) = fEmail
                                    Sheets("databaseCadastros").Cells(contLinha, 6) = fSenhaConfirma
                                    Sheets("databaseCadastros").Cells(contLinha, 8) = "Usu|fffd|rio"
                                    Sheets("databaseCadastros").Cells(contLinha, 9) = data
                                    Sheets("databaseCadastros").Cells(contLinha, 10) = hora
                                    Sheets("databaseCadastros").Cells(contLinha, 11) = atividade
                                    
' reestabelece formato das colunas e protege tabela
                                    Range("tabDatabaseCadastros[Data]").NumberFormat = "dd/mm/yyyy"
                                    
' realiza log do cadastro
                                    Call sysLog
                                    MsgBox "Cadastro realizado com sucesso! A seguir, faremos a configura|fffd||fffd|o inicial para uso do sistema.", vbInformation, "  Invest Masterplan Premium " & Year(Now)
                                    Unload Me
                                    frmConfig.Show
                                    Exit Sub
                                    
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub


Attribute VB_Name = "frmCadastroB"
Attribute VB_Base = "0{4F06C660-19E7-4F80-AA9D-DDB1A22937DC}{D8041FC4-8663-403D-BEAF-FAED81B53649}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub txtCadUsuarioB_Change()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' limita caracteres do usu|fffd|rio
    txtCadUsuarioB.MaxLength = 20

End Sub
Private Sub txtCadNomeB_Change()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' limita caracteres do nome
    txtCadNomeB.MaxLength = 35
    
' define campo num|fffd|rico
    If Len(txtCadNomeB) > 0 Then
        temp = Len(txtCadNomeB)
        contVal = Right(txtCadNomeB, 1)
        
        If IsNumeric(contVal) Then
            txtCadNomeB = Left(txtCadNomeB, temp - 1)
            
        End If
    End If

End Sub
Private Sub btnVoltarB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA CADASTRO
' cancela cadastro e volta ao formul|fffd|rio login
    frmCadastroB.txtCadNomeB = ""
    frmCadastroB.txtCadUsuarioB = ""
    frmCadastroB.txtCadEmailB = ""
    frmCadastroB.txtCadSenhaB = ""
    frmCadastroB.txtCadSenhaConfirmaB = ""
    
    Unload Me
    frmLoginB.Show

End Sub
Private Sub btnCadastrarB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** REGISTRA NOVO CADASTRO
' vari|fffd|veis
    hora = TimeValue(Now)
    data = Sheets("mercadoIndicadores").Cells(1, 1)
    atividade = "Cadastro Usu|fffd|rio"
    fNomeB = frmCadastroB.txtCadNomeB.Value
    fUsuarioB = frmCadastroB.txtCadUsuarioB.Value
    fEmailB = frmCadastroB.txtCadEmailB.Value
    fSenhaB = frmCadastroB.txtCadSenhaB.Value
    fSenhaConfirmaB = frmCadastroB.txtCadSenhaConfirmaB.Value
    
' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
' valida|fffd||fffd|o de campos
    If fNomeB = "" Then
        MsgBox "Informe seu nome completo para cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        frmCadastroB.txtCadNomeB.SetFocus
        Exit Sub
        Else
        
        If fUsuarioB = "" Then
            MsgBox "Informe um nome de usu|fffd|rio para seu cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmCadastroB.txtCadUsuarioB.SetFocus
            Exit Sub
            Else
            
            If fEmailB = "" Then
                MsgBox "Informe seu e-mail para cadastro.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                frmCadastroB.txtCadEmailB.SetFocus
                Exit Sub
                Else
                
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
                email = validaEmail.Test(frmCadastroB.txtCadEmailB.Value)
                If email = False Then
                    MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                    frmCadastroB.txtCadEmailB.SetFocus
                    Exit Sub
                    Else
                    
                    If fSenhaB = "" Then
                        MsgBox "Informe uma senha para cadastro.", "  Invest Masterplan Premium " & Year(Now)
                        frmCadastroB.txtCadSenhaB.SetFocus
                        Exit Sub
                        Else
                        
                        If fSenhaConfirmaB = "" Then
                            MsgBox "Confirme a senha digitada.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                            frmCadastroB.txtCadSenhaConfirmaB.SetFocus
                            Exit Sub
                            Else
                            
                            If fSenhaB <> fSenhaConfirmaB Then
                                MsgBox "A senha informada n|fffd|o confere.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                frmCadastroB.txtCadSenhaConfirmaB.SetFocus
                                Exit Sub
                                Else
                                
                                If IsNumeric(fSenhaB) Then
                                    MsgBox "Ops! Para maior seguran|fffd|a, a senha precisa conter tamb|fffd|m letras e/ou caracteres especiais.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                    frmCadastroB.txtCadSenhaB.SetFocus
                                    Exit Sub
                                    Else
                                    
' loop para verificar se dados cadastrados j|fffd| existem, evitando duplicidade
                                    contLinha = 5
                                    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
                                    
' loop para validar se dados j|fffd| est|fffd|o cadastrados
                                    If Sheets("databaseCadastros").Cells(contLinha, 3) = fNomeB Then
                                        MsgBox "Ops! Este nome j|fffd| est|fffd| sendo utilizado em outra conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                        frmCadastroB.txtCadNomeB.SetFocus
                                        Exit Sub
                                        Else
                                        
                                        If Sheets("databaseCadastros").Cells(contLinha, 4) = fUsuarioB Then
                                            MsgBox "Ops! Este usu|fffd|rio j|fffd| est|fffd| sendo utilizado em outra conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                            frmCadastroB.txtCadUsuarioB.SetFocus
                                            Exit Sub
                                            Else
                                            
                                            If Sheets("databaseCadastros").Cells(contLinha, 5) = fEmailB Then
                                                MsgBox "Ops! Este  e-mail j|fffd| est|fffd| sendo utilizado em outra conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                                                frmCadastroB.txtCadEmailB.SetFocus
                                                Exit Sub
                                                Else
                                            
                                            End If
                                        End If
                                    End If
                                        
                                    contLinha = contLinha + 1
                                    Loop
                                    
' loop para validar quantidade de usu|fffd|rios cadastrados para limitar acessos
                                    contLinha = 5
                                    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
                                    contLinha = contLinha + 1
                                    Loop
                                    
' registro de dados na tabela de cadastros
                                    Sheets("databaseCadastros").Unprotect
                                    
                                    Sheets("databaseCadastros").Cells(contLinha, 3) = fNomeB
                                    Sheets("databaseCadastros").Cells(contLinha, 4) = fUsuarioB
                                    Sheets("databaseCadastros").Cells(contLinha, 5) = fEmailB
                                    Sheets("databaseCadastros").Cells(contLinha, 6) = fSenhaConfirmaB
                                    Sheets("databaseCadastros").Cells(contLinha, 8) = "Usu|fffd|rio"
                                    Sheets("databaseCadastros").Cells(contLinha, 9) = data
                                    Sheets("databaseCadastros").Cells(contLinha, 10) = hora
                                    Sheets("databaseCadastros").Cells(contLinha, 11) = atividade
                                    
' reestabelece formato das colunas e protege tabela
                                    Range("tabDatabaseCadastros[Data]").NumberFormat = "dd/mm/yyyy"
                                    
' realiza log do cadastro
                                    Call sysLog
                                    MsgBox "Cadastro realizado com sucesso! A seguir, faremos a configura|fffd||fffd|o inicial para uso do sistema.", vbInformation, "  Invest Masterplan Premium " & Year(Now)
                                    Unload Me
                                    frmConfigB.Show
                                    Exit Sub
                                    
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If
    
End Sub



Attribute VB_Name = "frmConfig"
Attribute VB_Base = "0{BAFB5707-C6B7-46DA-9E46-4A6968097E5D}{87BD7657-CCD3-4865-BB5D-9DA71FBDE629}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtConfigAno_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnFinalizar_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub UserForm_Activate()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA FORM
' ativa marcador padr|fffd|o
    optOutras.Value = True
    
End Sub
Private Sub txtConfigSaldo_Change()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' define campo num|fffd|rico
    If Len(txtConfigSaldo) > 0 Then
        temp = Len(txtConfigSaldo)
        contVal = Right(txtConfigSaldo, 1)
        
        If Not IsNumeric(contVal) Then
            txtConfigSaldo = Left(txtConfigSaldo, temp - 1)
            txtConfigSaldo.SetFocus
            
        End If
    End If
    
End Sub
Private Sub txtConfigSaldo_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FORMATA MOEDA
' formata padr|fffd|o moeda
    txtConfigSaldo = Format(txtConfigSaldo, "#,##0.00")

End Sub
Private Sub btnFinalizar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CONFIGURA|fffd||fffd|ES INICIAIS
' vari|fffd|veis
    fSaldo = txtConfigSaldo.Value
    
    If optXP.Value = True Then
        fCorretora = "XPI CCTVM"
        Else
        If optRico = True Then
            fCorretora = "Rico CTVM"
            Else
            If optClear.Value = True Then
                fCorretora = "Clear CTVM"
                Else
                If optEasyinvest.Value = True Then
                    fCorretora = "Easynvest CVTM"
                    Else
                    If optModal = True Then
                        fCorretora = "Modal Mais"
                        Else
                        If optSantander.Value = True Then
                            fCorretora = "Santander CCVM"
                            Else
                            If optItau = True Then
                                fCorretora = "Ita|fffd| Corretora"
                                Else
                                If optBradesco.Value = True Then
                                    fCorretora = "Bradesco CTVM"
                                    Else
                                    If optOutras = True Then
                                        fCorretora = "#Selecionar"
                                        Else
                                    
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

' valida status dos campos saldo
    If fSaldo = "" Then
        fSaldo = 0
        Else
        
        If fSaldo < 0 Then
            MsgBox "O saldo inicial n|fffd|o pode ser inferior a 0.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            txtConfigSaldo.SetFocus
            Exit Sub
            Else
            
        End If
    End If

' registra saldo banc|fffd|rio e corretora
    Sheets("carteiraCaixa").Unprotect
    Sheets("config").Unprotect
    Sheets("a|fffd||fffd|esProventos").Unprotect
    
    Sheets("carteiraCaixa").Cells(13, 13) = fSaldo
    Sheets("a|fffd||fffd|esProventos").Cells(19, 3) = Year(Now)
    
    If fCorretora = "" Or fCorretora = "#Selecionar" Then
        Sheets("config").Cells(19, 4) = "#Selecionar"
        Else
        Sheets("config").Cells(19, 4) = fCorretora
        
    End If

' protege tabelas
    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True

' finaliza|fffd||fffd|o geral
    Unload Me
    MsgBox "Tudo pronto! Voc|fffd| j|fffd| pode realizar o login.", vbInformation, "  Invest Masterplan Premium " & Year(Now)
    frmLogin.Show
    
End Sub

Attribute VB_Name = "frmConfigB"
Attribute VB_Base = "0{DBE4FD2A-1D4A-42D8-A9E7-7479DEA0EC46}{E73FFA92-9251-4428-BC85-402109C327B8}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtConfigAnoB_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnFinalizarB_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub UserForm_Activate()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'***************************************************************************************************************************
' ativa marcador padr|fffd|o
    optOutras.Value = True
    
End Sub
Private Sub txtConfigSaldoB_Change()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' define campo num|fffd|rico
    If Len(txtConfigSaldoB) > 0 Then
        temp = Len(txtConfigSaldoB)
        contVal = Right(txtConfigSaldoB, 1)
        
        If Not IsNumeric(contVal) Then
            txtConfigSaldoB = Left(txtConfigSaldoB, temp - 1)
            txtConfigSaldoB.SetFocus
            
        End If
    End If
    
End Sub
Private Sub txtConfigSaldoB_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FORMATA MOEDA
' formata padr|fffd|o moeda
    txtConfigSaldoB = Format(txtConfigSaldoB, "#,##0.00")

End Sub
Private Sub btnFinalizarB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CONFIGURA|fffd||fffd|ES INICIAIS
' vari|fffd|veis
    fSaldoB = txtConfigSaldoB.Value
    
    If optXP.Value = True Then
        fCorretoraB = "XPI CCTVM"
        Else
        If optRico = True Then
            fCorretoraB = "Rico CTVM"
            Else
            If optClear.Value = True Then
                fCorretoraB = "Clear CTVM"
                Else
                If optEasyinvest.Value = True Then
                    fCorretoraB = "Easynvest CTVM"
                    Else
                    If optModal = True Then
                        fCorretoraB = "Modal Mais"
                        Else
                        If optSantander.Value = True Then
                            fCorretoraB = "Santander CCVM"
                            Else
                            If optItau = True Then
                                fCorretoraB = "Ita|fffd| Corretora"
                                Else
                                If optBradesco.Value = True Then
                                    fCorretoraB = "Bradesco CTVM"
                                    Else
                                    If optOutras = True Then
                                        fCorretoraB = "#Selecionar"
                                        Else
                                    
                                    End If
                                End If
                            End If
                        End If
                    End If
                End If
            End If
        End If
    End If

' valida status dos campos saldo
    If fSaldoB = "" Then
        fSaldoB = 0
        Else
        
        If fSaldoB < 0 Then
            MsgBox "O saldo inicial n|fffd|o pode ser inferior a 0.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            txtConfigSaldoB.SetFocus
            Exit Sub
            Else
            
        End If
    End If

' registra saldo banc|fffd|rio e corretora
    Sheets("carteiraCaixa").Unprotect
    Sheets("config").Unprotect
    Sheets("a|fffd||fffd|esProventos").Unprotect
    
    Sheets("carteiraCaixa").Cells(13, 13) = fSaldoB
    Sheets("a|fffd||fffd|esProventos").Cells(19, 3) = Year(Now)
    
    If fCorretoraB = "" Or fCorretoraB = "#Selecionar" Then
        Sheets("config").Cells(19, 4) = "#Selecionar"
        Else
        Sheets("config").Cells(19, 4) = fCorretoraB
        
    End If

' protege tabelas
    Sheets("a|fffd||fffd|esProventos").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    Sheets("carteiraCaixa").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True
    Sheets("config").Protect DrawingObjects:=True, Scenarios:=True, Contents:=True

' finaliza|fffd||fffd|o geral
    Unload Me
    MsgBox "Tudo pronto! Voc|fffd| j|fffd| pode realizar o login.", vbInformation, "  Invest Masterplan Premium " & Year(Now)
    frmLoginB.Show
    
End Sub


Attribute VB_Name = "frmIntro"
Attribute VB_Base = "0{E42CF9CF-1D7E-43EF-9054-8C982F35243E}{5AB1CE0B-CE4D-4AF1-BE26-C1D913413ADD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub UserForm_Activate()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE SAUDA|fffd||fffd|O
' aguarda sauda|fffd||fffd|o e desativa form
    Application.Wait Now + TimeValue("00:00:04")
    Unload Me
    
End Sub

Attribute VB_Name = "frmIntroB"
Attribute VB_Base = "0{E7645FD5-F898-4A3F-A1D4-E708FD8C74B2}{6796FAD4-3717-46F0-A4AB-86F5A89C0337}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub UserForm_Activate()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** EXIBE SAUDA|fffd||fffd|O
' aguarda sauda|fffd||fffd|o e desativa form
    Application.Wait Now + TimeValue("00:00:04")
    Unload Me
    
End Sub


Attribute VB_Name = "frmLogin"
Attribute VB_Base = "0{2BBC245E-3D51-4C9C-ABB9-C15B07CF7EC9}{A18EC5B7-512B-468D-BAC6-F87135FB2646}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtSenha_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnEntrar_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA BOT|fffd|O X
' desabilita fechamento autom|fffd|tico pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
' confirma sa|fffd|da do sistema
        Dim confirmaSaida As VbMsgBoxResult
        confirmaSaida = MsgBox("Deseja realmente encerrar a aplica|fffd||fffd|o?", vbQuestion + vbYesNo, "  Invest Masterplan |fffd| " & Year(Now))
        
        If confirmaSaida = vbNo Then
            Exit Sub
            Else
            
            Unload Me
            With ThisWorkbook
                .Save
                .Close
            End With
            
        End If
    End If
    
End Sub
Private Sub btnEntrar_Click()
ThisWorkbook.Activate
ActiveSheet.Unprotect
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA DADOS DE ACESSO
' vari|fffd|veis
    atividade = "Login"
    fEmail = frmLogin.txtEmail.Value
    fSenha = frmLogin.txtSenha.Value
    
' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
' valida dados preenchidos
    If fEmail = "" Or fSenha = "" Then
        MsgBox "Preencha os campos de e-mail e senha para acesso.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        Exit Sub
        Else
        
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
        email = validaEmail.Test(frmLogin.txtEmail.Value)
        If email = False Then
            MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            Exit Sub
            Else
            
' loop para localiza|fffd||fffd|o do usu|fffd|rio
            contLinha = 5
            tempEmail = Sheets("databaseCadastros").Cells(contLinha, 5)
            tempSenha = Sheets("databaseCadastros").Cells(contLinha, 6)
            
            Do Until tempEmail = "" Or tempEmail = fEmail
            contLinha = contLinha + 1
            tempEmail = Sheets("databaseCadastros").Cells(contLinha, 5)
            tempSenha = Sheets("databaseCadastros").Cells(contLinha, 6)
            Loop
            
' valida acesso
            If tempEmail = fEmail And tempSenha = fSenha Then
                Sheets("config").Unprotect
                nome = Sheets("databaseCadastros").Cells(contLinha, 3)
                Sheets("config").Cells(6, 6) = nome
                Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                fSenha = ""
                
                Unload Me
                Call sysInfoPC
                Call sysLog
                Call sysIniciar
                Exit Sub
                
                Else
                MsgBox "Dados de acesso inv|fffd|lidos.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Private Sub btnEsqueciSenha_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RECUPERA|fffd||fffd|O DE SENHA
' exibe formul|fffd|rio
    Unload Me
    frmRecuperarSenha.txtUsuario.SetFocus
    frmRecuperarSenha.Show

End Sub
Private Sub btnNovoCadastro_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** NOVO CADASTRO
' valida n|fffd|mero limite de cadastros
    contLinha = 5
    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
    contLinha = contLinha + 1
    Loop
    
    If contLinha > 6 Then
        MsgBox "O limite de usu|fffd|rios desta aplica|fffd||fffd|o j|fffd| foi atingido.", vbExclamation, "  Invest Masterplan Premium " & Year(Now)
        Exit Sub
        Else
        
' exibe formul|fffd|rio
        Unload Me
        frmCadastro.txtCadNome.SetFocus
        frmCadastro.Show
        
    End If
    
End Sub

Attribute VB_Name = "frmLoginB"
Attribute VB_Base = "0{816B7653-18BD-440A-9739-AD5395930DBE}{8252E48A-3244-457E-8B81-8EA13AAAC7DE}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtSenhaB_Keydown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnEntrarB_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA BOT|fffd|O X
' desabilita fechamento autom|fffd|tico pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
' confirma sa|fffd|da do sistema
        Dim confirmaSaida As VbMsgBoxResult
        confirmaSaida = MsgBox("Deseja realmente encerrar a aplica|fffd||fffd|o?", vbQuestion + vbYesNo, "  Invest Masterplan |fffd| " & Year(Now))
        
        If confirmaSaida = vbNo Then
            Exit Sub
            Else
            
            Unload Me
            With ThisWorkbook
                .Save
                .Close
            End With
            
        End If
    End If
    
End Sub
Private Sub btnEntrarB_Click()
ThisWorkbook.Activate
ActiveSheet.Unprotect
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** VALIDA DADOS DE ACESSO
' vari|fffd|veis
    atividade = "Login"
    fEmailB = frmLoginB.txtEmailB.Value
    fSenhaB = frmLoginB.txtSenhaB.Value
    
' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
' valida dados preenchidos
    If fEmailB = "" Or fSenhaB = "" Then
        MsgBox "Preencha os campos de e-mail e senha para acesso.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        Exit Sub
        Else
        
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
        email = validaEmail.Test(frmLoginB.txtEmailB.Value)
        If email = False Then
            MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            Exit Sub
            Else
            
' loop para localiza|fffd||fffd|o do usu|fffd|rio
            contLinha = 5
            tempEmail = Sheets("databaseCadastros").Cells(contLinha, 5)
            tempSenha = Sheets("databaseCadastros").Cells(contLinha, 6)
            
            Do Until tempEmail = "" Or tempEmail = fEmailB
            contLinha = contLinha + 1
            tempEmail = Sheets("databaseCadastros").Cells(contLinha, 5)
            tempSenha = Sheets("databaseCadastros").Cells(contLinha, 6)
            Loop
            
' valida acesso
            If tempEmail = fEmailB And tempSenha = fSenhaB Then
                Sheets("config").Unprotect
                nome = Sheets("databaseCadastros").Cells(contLinha, 3)
                Sheets("config").Cells(6, 6) = nome
                Sheets("config").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
                fSenha = ""
                
                Unload Me
                Call sysInfoPC
                Call sysLog
                Call sysIniciar
                Exit Sub
                
                Else
                MsgBox "Dados de acesso inv|fffd|lidos.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                Exit Sub
                
            End If
        End If
    End If
    
End Sub
Private Sub btnSairB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ACESSO
' encerra formul|fffd|rio e aplica|fffd||fffd|o
    Unload Me
    ThisWorkbook.Save
    Application.Quit
    
End Sub
Private Sub btnEsqueciSenhaB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RECUPERA|fffd||fffd|O DE SENHA
' exibe formul|fffd|rio
    Unload Me
    frmRecuperarSenhaB.txtUsuarioB.SetFocus
    frmRecuperarSenhaB.Show

End Sub
Private Sub btnNovoCadastroB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** NOVO CADASTRO
' valida n|fffd|mero limite de cadastros
    contLinha = 5
    Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = ""
    contLinha = contLinha + 1
    Loop
    
    If contLinha > 6 Then
        MsgBox "O limite de usu|fffd|rios desta aplica|fffd||fffd|o j|fffd| foi atingido.", vbExclamation, "  Invest Masterplan Premium " & Year(Now)
        Exit Sub
        Else
        
' exibe formul|fffd|rio
        Unload Me
        frmCadastroB.txtCadNomeB.SetFocus
        frmCadastroB.Show
        
    End If
    
End Sub


Attribute VB_Name = "frmRecuperarSenha"
Attribute VB_Base = "0{2DBD355C-C993-4364-B275-6007A7793F15}{5A4D4377-F0DF-4E78-B5F3-194F11EC1BA4}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtEmail_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnRecuperarSenha_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub btnRecuperarSenha_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RECUPERA|fffd||fffd|O DE SENHA
' vari|fffd|veis
    Dim Outlook As Outlook.Application
    Dim OutlookMail As Outlook.MailItem
    
    fEmail = frmRecuperarSenha.txtEmail.Value
    fUsuario = frmRecuperarSenha.txtUsuario.Value

' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES INICIAIS
' valida dados preenchidos
    If fEmail = "" Or fUsuario = "" Then
        MsgBox "Informe usu|fffd|rio e e-mail para recuperar a senha.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        Exit Sub
        Else

' loop para localiza|fffd||fffd|o do usu|fffd|rio
        contLinha = 5
        Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = "" Or Sheets("databaseCadastros").Cells(contLinha, 4) = fUsuario Or _
        Sheets("databaseCadastros").Cells(contLinha, 5) = fEmail
        contLinha = contLinha + 1
        Loop
        
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
        email = validaEmail.Test(frmRecuperarSenha.txtEmail.Value)
        If email = False Then
            MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmRecuperarSenha.txtEmail.SetFocus
            Exit Sub
            Else
            
' valida dados cadastrados para envio da senha por email
            If Sheets("databaseCadastros").Cells(contLinha, 4) <> fUsuario Or Sheets("databaseCadastros").Cells(contLinha, 5) <> fEmail Then
                MsgBox "Dados cadastrais inv|fffd|lidos.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                Exit Sub
                Else
                
' obt|fffd|m a senha na base de dados
                senha = Sheets("databaseCadastros").Cells(contLinha, 6)
            
'*************************************************************************************************************************** VARI|fffd|VEIS DE EMAIL ENVIO DE MSG
                nome = fUsuario
                emailDestinatario = fEmail
                emailRemetente = "contato@creatifica.com.br"
                tipoMsg = "Recupera|fffd||fffd|o de Senha"
                
' define texto da mensagem de recupera|fffd||fffd|o
                Call planSaudacao
                textoMsg = saudacao & nome & "!" & vbNewLine & _
                            "Este |fffd| um e-mail autom|fffd|tico referente ao pedido de recupera|fffd||fffd|o de senha. " & _
                            "A senha cadastrada anteriormente |fffd|: " & senha & "." & vbNewLine & vbNewLine & vbNewLine & vbNewLine & _
                            "Bons investimentos," & vbNewLine & _
                            "Creatifica |fffd|" & Year(Now) & " - Invest Masterplan."
                            
' define e identifica contas Outlook
                Set Outlook = CreateObject("Outlook.Application")
                
                For contOut = 1 To Outlook.Session.Accounts.Count
                    If Outlook.Session.Accounts.item(contOut) = emailRemetente Then
                        Exit For
                    End If
                Next contOut
                
                Set OutlookMail = Outlook.CreateItem(olMailItem)
                
'*************************************************************************************************************************** ENVIO DE EMAIL
' defini|fffd||fffd|es do email e envio da senha para o email cadastrado
                With OutlookMail
                    .To = emailDestinatario
                    .Subject = tipoMsg
                    .body = textoMsg
                    .SendUsingAccount = Outlook.Session.Accounts.item(contOut)
                    .Send
                End With
                
' esconde formul|fffd|rio e retorna ao menu principal
                MsgBox "Senha recuperada com sucesso!" & vbNewLine & "Verifique sua Caixa de Entrada.", vbInformation, "  Invest Masterplan Premium " & Year(Now)
                Unload Me
                frmLogin.Show
                Exit Sub
                
            End If
        End If
    End If
End Sub
Private Sub btnVoltar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA RECUPERA|fffd||fffd|O
' cancela cadastro e volta ao formul|fffd|rio login
    frmRecuperarSenha.txtUsuario = ""
    frmRecuperarSenha.txtEmail = ""
    
    Unload Me
    frmLogin.Show

End Sub


Attribute VB_Name = "frmRecuperarSenhaB"
Attribute VB_Base = "0{6AA80FB0-DD3D-49E2-9A1D-884D6C549BC9}{85C012D7-1D9D-4B28-98BB-48D4D421B8ED}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtEmailB_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnRecuperarSenhaB_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub btnRecuperarSenhaB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** RECUPERA|fffd||fffd|O DE SENHA
' vari|fffd|veis
    Dim Outlook As Outlook.Application
    Dim OutlookMail As Outlook.MailItem
    
    fEmailB = frmRecuperarSenhaB.txtEmailB.Value
    fUsuarioB = frmRecuperarSenhaB.txtUsuarioB.Value

' vari|fffd|veis de express|fffd|o regular
    Set validaEmail = New VBScript_RegExp_55.RegExp
    validaEmail.Pattern = "^([a-zA-Z0-9_\-\.]+)@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$"
    
'*************************************************************************************************************************** VALIDA|fffd||fffd|ES INICIAIS
' valida dados preenchidos
    If fEmailB = "" Or fUsuarioB = "" Then
        MsgBox "Informe usu|fffd|rio e e-mail para recuperar a senha.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        Exit Sub
        Else

' loop para localiza|fffd||fffd|o do usu|fffd|rio
        contLinha = 5
        Do Until Sheets("databaseCadastros").Cells(contLinha, 3) = "" Or Sheets("databaseCadastros").Cells(contLinha, 4) = fUsuarioB Or _
        Sheets("databaseCadastros").Cells(contLinha, 13) = fEmailB
        contLinha = contLinha + 1
        Loop
        
' executa fun|fffd||fffd|o de valida|fffd||fffd|o do email
        email = validaEmail.Test(frmRecuperarSenhaB.txtEmailB.Value)
        If email = False Then
            MsgBox "Ops! Parece que este endere|fffd|o de e-mail |fffd| inv|fffd|lido.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmRecuperarSenhaB.txtEmailB.SetFocus
            Exit Sub
            Else
            
' valida dados cadastrados para envio da senha por email
            If Sheets("databaseCadastros").Cells(contLinha, 4) <> fUsuarioB Or Sheets("databaseCadastros").Cells(contLinha, 5) <> fEmailB Then
                MsgBox "Dados cadastrais inv|fffd|lidos.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
                Exit Sub
                Else
                
' obt|fffd|m a senha na base de dados
                senha = Sheets("databaseCadastros").Cells(contLinha, 6)
                
'*************************************************************************************************************************** VARI|fffd|VEIS DE EMAIL ENVIO DE MSG
                nome = fUsuarioB
                emailDestinatario = fEmailB
                emailRemetente = "contato@creatifica.com.br"
                tipoMsg = "Recupera|fffd||fffd|o de Senha"
                
' define texto da mensagem de recupera|fffd||fffd|o
                Call planSaudacao
                textoMsg = saudacao & nome & "!" & vbNewLine & _
                            "Este |fffd| um e-mail autom|fffd|tico referente ao pedido de recupera|fffd||fffd|o de senha. " & _
                            "A senha cadastrada anteriormente |fffd| " & senha & "." & vbNewLine & vbNewLine & vbNewLine & vbNewLine & _
                            "Bons investimentos," & vbNewLine & _
                            "Creatifica |fffd|" & Year(Now) & " - Invest Masterplan."
                            
' define e identifica contas Outlook
                Set Outlook = CreateObject("Outlook.Application")
                
                For contOut = 1 To Outlook.Session.Accounts.Count
                    If Outlook.Session.Accounts.item(contOut) = emailRemetente Then
                        Exit For
                    End If
                Next contOut
                
                Set OutlookMail = Outlook.CreateItem(olMailItem)
                
'*************************************************************************************************************************** ENVIO DE EMAIL
' defini|fffd||fffd|es do email e envio da senha para o email cadastrado
                With OutlookMail
                    .To = emailDestinatario
                    .Subject = tipoMsg
                    .body = textoMsg
                    .SendUsingAccount = Outlook.Session.Accounts.item(contOut)
                    .Send
                End With
                
' esconde formul|fffd|rio e retorna ao menu principal
                MsgBox "Senha recuperada com sucesso!" & vbNewLine & "Verifique sua Caixa de Entrada.", vbInformation, "  Invest Masterplan Premium " & Year(Now)
                Unload Me
                frmLoginB.Show
                Exit Sub
                
            End If
        End If
    End If
End Sub
Private Sub btnVoltarB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA RECUPERA|fffd||fffd|O
' cancela cadastro e volta ao formul|fffd|rio login
    frmRecuperarSenhaB.txtUsuarioB = ""
    frmRecuperarSenhaB.txtEmailB = ""
    
    Unload Me
    frmLoginB.Show

End Sub
Attribute VB_Name = "frmSaldo"
Attribute VB_Base = "0{345DE031-C0DB-45F6-A11F-4D8209DA12A6}{D7489580-77A5-43CF-B8DF-6D4457A7C268}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtPoup_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnAtualizarSaldo_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub txtConta_Change()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' define campo num|fffd|rico
    If Len(txtConta) > 0 Then
        temp = Len(txtConta)
        contVal = Right(txtConta, 1)
        
        If Not IsNumeric(contVal) Then
            txtConta = Left(txtConta, temp - 1)
            txtConta.SetFocus
            
        End If
    End If
    
End Sub
Private Sub txtConta_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FORMATA MOEDA
' formata padr|fffd|o moeda
    txtConta = Format(txtConta, "#,##0.00")

End Sub
Private Sub txtPoup_Change()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' define campo num|fffd|rico
    If Len(txtPoup) > 0 Then
        temp = Len(txtPoup)
        contVal = Right(txtPoup, 1)
        
        If Not IsNumeric(contVal) Then
            txtPoup = Left(txtPoup, temp - 1)
            txtPoup.SetFocus
            
        End If
    End If
    
End Sub
Private Sub txtPoup_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FORMATA MOEDA
' formata padr|fffd|o moeda
    txtPoup = Format(txtPoup, "#,##0.00")

End Sub
Private Sub btnVoltar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ATUALIZA|fffd||fffd|O
' cancela atualiza|fffd||fffd|o
    frmSaldo.txtConta = 0
    frmSaldo.txtPoup = 0
    
    Unload Me

End Sub
Private Sub btnAtualizarSaldo_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDO DE CONTA E POUPAN|fffd|A
' vari|fffd|veis
    fSaldoConta = frmSaldo.txtConta.Value
    fSaldoPoup = frmSaldo.txtPoup.Value
    
' valida preenchimento de campos
    If fSaldoConta = "" Then
        fSaldoConta = 0
        
    End If
    
    If fSaldoPoup = "" Then
        fSaldoPoup = 0
        
    End If
    
    If fSaldoConta <= 0 Then
        MsgBox "Informe o valor positivo do saldo em conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        frmSaldo.txtConta.SetFocus
        Exit Sub
        Else
        
        If fSaldoConta < 0 Then
            MsgBox "Informe o valor positivo em conta Poupan|fffd|a.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmSaldo.txtPoup.SetFocus
            Exit Sub
            Else
            
' registra altera|fffd||fffd|es no caixa
            Sheets("carteiraCaixa").Unprotect
            
            Sheets("carteiraCaixa").Cells(13, 13) = fSaldoConta
            Sheets("carteiraCaixa").Cells(13, 14) = fSaldoPoup
            Range("E7").Activate
                            
' finaliza|fffd||fffd|es
            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Unload Me
            MsgBox "Saldo atualizado com sucesso!", vbInformation, "  Invest Masterplan Premium " & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub


Attribute VB_Name = "frmSaldoB"
Attribute VB_Base = "0{51DD156D-B443-4828-A234-D6CA008AB407}{C0D3EA9A-F1FF-4F2F-ACC4-C3718A79BAAE}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub txtPoupB_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATIVA TECLA ENTER
    If KeyCode = "13" Then
        btnAtualizarSaldoB_Click
        Else
        
    End If
    
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub txtContaB_Change()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' define campo num|fffd|rico
    If Len(txtContaB) > 0 Then
        temp = Len(txtContaB)
        contVal = Right(txtContaB, 1)
        
        If Not IsNumeric(contVal) Then
            txtContaB = Left(txtContaB, temp - 1)
            txtContaB.SetFocus
            
        End If
    End If
    
End Sub
Private Sub txtContaB_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FORMATA MOEDA
' formata padr|fffd|o moeda
    txtContaB = Format(txtContaB, "#,##0.00")

End Sub
Private Sub txtPoupB_Change()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PADRONIZA CAIXA DE TEXTO
' define campo num|fffd|rico
    If Len(txtPoupB) > 0 Then
        temp = Len(txtPoupB)
        contVal = Right(txtPoupB, 1)
        
        If Not IsNumeric(contVal) Then
            txtPoupB = Left(txtPoupB, temp - 1)
            txtPoupB.SetFocus
            
        End If
    End If
    
End Sub
Private Sub txtPoupB_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FORMATA MOEDA
' formata padr|fffd|o moeda
    txtPoupB = Format(txtPoupB, "#,##0.00")

End Sub
Private Sub btnVoltarB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ATUALIZA|fffd||fffd|O
' cancela atualiza|fffd||fffd|o
    frmSaldoB.txtContaB = ""
    frmSaldoB.txtPoupB = ""
    
    Unload Me

End Sub
Private Sub btnAtualizarSaldoB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ATUALIZA SALDO DE CONTA E POUPAN|fffd|A
' vari|fffd|veis
    fSaldoContaB = frmSaldoB.txtContaB.Value
    fSaldoPoupB = frmSaldoB.txtPoupB.Value
    
' valida preenchimento de campos
    If fSaldoContaB = "" Then
        fSaldoContaB = 0
        
    End If
    
    If fSaldoPoupB = "" Then
        fSaldoPoupB = 0
        
    End If
    
    If fSaldoContaB <= 0 Then
        MsgBox "Informe o valor positivo do saldo em conta.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
        frmSaldoB.txtContaB.SetFocus
        Exit Sub
        Else
        
        If fSaldoContaB <= 0 Then
            MsgBox "Informe o valor positivo em conta Poupan|fffd|a.", vbCritical, "  Invest Masterplan Premium " & Year(Now)
            frmSaldo.txtPoup.SetFocus
            Exit Sub
            Else
            
' registra altera|fffd||fffd|es no caixa
            Sheets("carteiraCaixa").Unprotect
            
            Sheets("carteiraCaixa").Cells(13, 13) = fSaldoContaB
            Sheets("carteiraCaixa").Cells(13, 14) = fSaldoPoupB
            Range("E7").Activate
                            
' finaliza|fffd||fffd|es
            Sheets("carteiraCaixa").Protect DrawingObjects:=True, Contents:=True, Scenarios:=True
            
            Unload Me
            MsgBox "Saldo atualizado com sucesso!", vbInformation, "  Invest Masterplan Premium " & Year(Now)
            Exit Sub
            
        End If
    End If
    
End Sub
Attribute VB_Name = "frmTooltipCaixa"
Attribute VB_Base = "0{6893E826-9147-4EC6-818F-1917A71EDF9F}{8A5D165F-90DF-4EEA-8326-550A99F1D874}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub lblX_Click()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FECHA MSG
' oculta formul|fffd|rio
    Unload Me

End Sub

Attribute VB_Name = "frmTooltipMetas"
Attribute VB_Base = "0{3AD0B414-E490-4D1B-BBF9-5A18B5601584}{6DC9AFB2-ED18-427C-A610-2D411FA76B1C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub lblX_Click()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FECHA MSG
' oculta formul|fffd|rio
    Unload Me
    
End Sub
Private Sub lblAnt_Click()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** ANT MSG
' oculta formul|fffd|rio
    Unload Me
    frmTooltipProj.Show

End Sub
Attribute VB_Name = "frmTooltipProj"
Attribute VB_Base = "0{3AD9161A-7211-4466-A3C0-DE0D4399DDD4}{71877112-C0BA-4C1C-9325-3857EE7D531D}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub lblX_Click()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** FECHA MSG
' oculta formul|fffd|rio
    Unload Me

End Sub
Private Sub lblProx_Click()
Application.ScreenUpdating = False
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PROX MSG
' oculta formul|fffd|rio
    Unload Me
    frmTooltipMetas.Show

End Sub

Attribute VB_Name = "frmUpdate"
Attribute VB_Base = "0{8314A8AA-9F1C-4EEA-B89D-964A63541AE2}{E1C0CCC2-319D-4402-9446-1B7CDD607766}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub btnImportar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA ARQUIVO PARA ATUALIZA|fffd||fffd|O
' chama rotina para importa|fffd||fffd|o dos dados
    Unload Me
    Call updateValidarArquivo
    
End Sub
Private Sub btnCancelar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ATUALIZA|fffd||fffd|O
' cancela importa|fffd||fffd|o
    Application.Visible = True
    Unload Me
    
End Sub
 
Attribute VB_Name = "frmUpdateB"
Attribute VB_Base = "0{5EC9A921-CA74-4DF4-B917-76AE3BDF8EA4}{BDC9B6C1-A887-4F13-A3FF-2EC3966868A5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub btnImportarB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** IMPORTA ARQUIVO PARA ATUALIZA|fffd||fffd|O
' chama rotina para importa|fffd||fffd|o dos dados
    Unload Me
    Call updateValidarArquivo
    
End Sub
Private Sub btnCancelarB_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CANCELA ATUALIZA|fffd||fffd|O
' cancela importa|fffd||fffd|o
    Application.Visible = True
    Unload Me
    
End Sub
 

Attribute VB_Name = "frmUpdateConfirma"
Attribute VB_Base = "0{B39ED799-418F-4AC1-87EE-77A142019B60}{FBCAE676-461A-4FCB-9B45-B1024CF1B4E6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub btnContinuar_Click()
ThisWorkbook.Activate
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** CONTINUA ATUALIZA|fffd||fffd|O
' continua importa|fffd||fffd|o
    Unload Me
    
End Sub
Attribute VB_Name = "frmWelcome"
Attribute VB_Base = "0{2D54A155-0A8B-4901-8C1A-B501880E103D}{12832FAA-AA53-44CB-B378-263CACF1DB7F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub btnFechar_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PRIMEIRO ACESSO
' fecha formul|fffd|rio e direciona para tela de ajuda
    Unload Me
    Application.Visible = True
    
End Sub

Attribute VB_Name = "frmWelcomeB"
Attribute VB_Base = "0{38AFA9D8-0B02-4712-ACE1-ABD817D91D6C}{F2037334-0599-4C2B-97D8-43DB0CAF9999}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** DESATIVA BOT|fffd|O X
' desabilita fechamento pelo bot|fffd|o x
    If CloseMode = vbFormControlMenu Then
        Cancel = True
        
    End If
End Sub
Private Sub btnFecharB_Click()
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
'*************************************************************************************************************************** PRIMEIRO ACESSO
' fecha formul|fffd|rio e direciona para tela de ajuda
    Unload Me
    Application.Visible = True
    
End Sub


' InQuest injected base64 decoded content
' *Azw!"wbq
' Lbn*
' zw"z
' "wbq
' "wbq
' "wbq
' zw"z
' zj/z
' zj/z

INQUEST-PP=macro
