Attribute VB_Name = "FormCitlAn"
Attribute VB_Base = "0{235A825C-06DA-4A79-8EF2-71EA8C20835C}{FA01295A-C0EF-4197-B306-9948A5D0D967}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Private Sub ButtOK_Click()
can.Range("e4") = CBHodnKrit.Value
can.Range("a4") = CBMenHodn.Value
can.Range("b4") = TBPokles.Value
can.Range("c4") = TBNarust.Value
inic.Range("h16") = CBMenHodn.ListIndex
citlan = True
FormCitlAn.Hide
End Sub

Private Sub ButtStorno_Click()
FormCitlAn.Hide
End Sub

Private Sub SBNarust_Change()
TBNarust.Value = SBNarust.Value
End Sub

Private Sub SBPokles_Change()
TBPokles.Value = SBPokles.Value
End Sub

Private Sub TBNarust_Change()
SBNarust.Value = NaseVal(TBNarust.Value)
End Sub

Private Sub TBPokles_Change()
SBPokles.Value = NaseVal(TBPokles.Value)
End Sub

Private Sub UserForm_Initialize()
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")

If IsEmpty(can.Range("a4")) Then
  FormCitlAn.CBHodnKrit.ListIndex = 0
  FormCitlAn.CBMenHodn.ListIndex = 0
Else
  CBHodnKrit.Value = can.Range("e4")
  CBMenHodn.ListIndex = inic.Range("h16")
End If
TBPokles.Value = can.Range("b4")
SBPokles.Value = MojeVal(TBPokles.Value)
TBNarust.Value = can.Range("c4")
SBNarust.Value = MojeVal(TBNarust.Value)
End Sub
Attribute VB_Name = "FormUvod"
Attribute VB_Base = "0{F870EB54-4116-42FC-9B1F-E58D2DEB07FB}{004DFD07-9BDB-4B9B-A906-BACF9CA238C0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False






Private Sub ButtUvodOK_Click()
FormUvod.Hide
End Sub

Private Sub UserForm_Initialize()
LabLicence.Caption = "|fffd||fffd|slo licence: " & Sheets("Konstanty").Range("Licence").Value
LabJmeno.Caption = Sheets("Konstanty").Range("Jmeno").Value
LabVerze.Caption = Sheets("Konstanty").Range("Verze").Value
End Sub
Attribute VB_Name = "FormVstup"
Attribute VB_Base = "0{B0F27225-C65C-4C55-8A17-39FF5EEC07E4}{82DA2801-79A6-4346-B78F-8EEB2BC24214}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Dim invdotp As Double
Dim pomoc As Double
Dim proco1 As Single
Dim proco2 As Single
Dim proco3 As Single
Dim proco4 As Single
Dim proco5 As Single
Dim proco6 As Single
Dim procoN As Single
Dim soucp As Single
Dim souco As Double
Dim odp1 As Double
Dim odp2 As Double
Dim odp3 As Double
Dim odp4 As Double
Dim odp5 As Double
Dim odp6 As Double
Dim odpN As Double

Private Sub ButtonOK_Click()
TBUverPr_Change
SBInvDotP_Change
PrepoctiOdpisy
MultiPage1_Change
' nejprve test o zadani potrebnych hodnot
If TBNazev.Value = "" Then
  MsgBox ("Nezadali jste projektu jm|fffd|no, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageInvest").index
  TBNazev.SetFocus
  Exit Sub
End If
If inv <= 0 Then
  If vbCancel = MsgBox("Zadali jste projektu nulov|fffd| investi|fffd|n|fffd| v|fffd|daje. Pro jejich dopln|fffd|n|fffd| stiskn|fffd|te Storno.", vbOKCancel) Then
    Me.MultiPage1.Value = Me.MultiPage1.Pages("PageInvest").index
    TBInv2.SetFocus
    Exit Sub
  End If
End If
If MojeVal(TBZivot.Value) <= 0 Then
  MsgBox ("Doba |fffd|ivotnosti (hodnocen|fffd|) projektu mus|fffd| b|fffd|t v|fffd|t|fffd||fffd| ne|fffd| nula, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageInvest").index
  TBZivot.SetFocus
  Exit Sub
End If
' odpocitatelnou polozku jiz zakon neumoznuje 10.1.2004
' opet zpristupneno 21.11.2004
If ChOdpPol.Value = True Then
  If MojeVal(TBOdpPol.Value) = 0 Then
    MsgBox ("Nezadali jste velikost odpo|fffd|itateln|fffd| polo|fffd|ky, opravte se.")
    Me.MultiPage1.Value = Me.MultiPage1.Pages("PageObecne").index
    TBOdpPol.SetFocus
    Exit Sub
  End If
End If
If MojeVal(TBDisk.Value) = 0 Then
  MsgBox ("Nezadali jste velikost diskontu, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageObecne").index
  TBDisk.SetFocus
  Exit Sub
End If
If ChInvDot.Value = True Then
  If MojeVal(TBInvDotP.Value) = 0 Then
    MsgBox ("Nezadali jste velikost investi|fffd|n|fffd| dotace, opravte se.")
    Me.MultiPage1.Value = Me.MultiPage1.Pages("PageFinanc").index
    TBInvDotP.SetFocus
    Exit Sub
  End If
End If
If OptUver.Value = True Then
  If MojeVal(TBUver.Value) = 0 Then
    MsgBox ("Nezadali jste pot|fffd|ebn|fffd| informace o |fffd|v|fffd|ru, opravte se.")
    Me.MultiPage1.Value = Me.MultiPage1.Pages("PageFinanc").index
    TBUver.SetFocus
    Exit Sub
  End If
  If MojeVal(TBUrok.Value) = 0 Then
    If vbCancel = MsgBox("Zadali jste nulov|fffd| |fffd|rok z |fffd|v|fffd|ru. Pro jeho zm|fffd|nu stiskn|fffd|te Storno.", vbOKCancel) Then
      Me.MultiPage1.Value = Me.MultiPage1.Pages("PageFinanc").index
      TBUrok.SetFocus
      Exit Sub
    End If
  End If
  If MojeVal(TBDobaUver.Value) = 0 Then
    MsgBox ("Nezadali jste pot|fffd|ebn|fffd| informace o |fffd|v|fffd|ru, opravte se.")
    Me.MultiPage1.Value = Me.MultiPage1.Pages("PageFinanc").index
    TBDobaUver.SetFocus
    Exit Sub
  End If
End If
If MojeVal(TBObnov1) = 0 And MojeVal(TBOdp1) <> 0 Then
  MsgBox ("Doba technick|fffd| |fffd|ivotnosti nem|fffd||fffd|e b|fffd|t nulov|fffd|, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageOdpisy").index
  TBObnov1.SetFocus
  Exit Sub
End If
If MojeVal(TBObnov2) = 0 And MojeVal(TBOdp2) <> 0 Then
  MsgBox ("Doba technick|fffd| |fffd|ivotnosti nem|fffd||fffd|e b|fffd|t nulov|fffd|, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageOdpisy").index
  TBObnov2.SetFocus
  Exit Sub
End If
If MojeVal(TBObnov3) = 0 And MojeVal(TBOdp3) <> 0 Then
  MsgBox ("Doba technick|fffd| |fffd|ivotnosti nem|fffd||fffd|e b|fffd|t nulov|fffd|, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageOdpisy").index
  TBObnov3.SetFocus
  Exit Sub
End If
If MojeVal(TBObnov4) = 0 And MojeVal(TBOdp4) <> 0 Then
  MsgBox ("Doba technick|fffd| |fffd|ivotnosti nem|fffd||fffd|e b|fffd|t nulov|fffd|, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageOdpisy").index
  TBObnov4.SetFocus
  Exit Sub
End If
If MojeVal(TBObnov5) = 0 And MojeVal(TBOdp5) <> 0 Then
  MsgBox ("Doba technick|fffd| |fffd|ivotnosti nem|fffd||fffd|e b|fffd|t nulov|fffd|, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageOdpisy").index
  TBObnov5.SetFocus
  Exit Sub
End If
If MojeVal(TBObnov6) = 0 And MojeVal(TBOdp6) <> 0 Then
  MsgBox ("Doba technick|fffd| |fffd|ivotnosti nem|fffd||fffd|e b|fffd|t nulov|fffd|, opravte se.")
  Me.MultiPage1.Value = Me.MultiPage1.Pages("PageOdpisy").index
  TBObnov6.SetFocus
  Exit Sub
End If
' nasleduje samotne ulozeni hodnot z formulare do listu vstupy
If Abs(souco - (inv + invu - invdot)) < 0.1 Then
  vst.Range("b1") = TBNazev.Value
  vst.Range("c5") = CBMesVyst.Value
  vst.Range("c6") = CBMesVyst.ListIndex + 1
  vst.Range("d5") = MojeVal(TBRokVyst.Value)
  If MojeVal(TBRokVyst.Value) < MojeVal(TBRokPro.Value) Then
    vst.Range("c7") = MojeVal(TBInv1.Value)
  Else
    vst.Range("c7") = 0
  End If
  vst.Range("c8") = MojeVal(TBInv2.Value)
  vst.Range("b7") = "Rok " & Str(MojeVal(TBRokPro.Value) - 1)
  vst.Range("b8") = "Rok " & Str(TBRokPro.Value)
  vst.Range("b3") = CBMesicPro.Value
  vst.Range("b4") = CBMesicPro.ListIndex + 1
  vst.Range("c3") = MojeVal(TBRokPro.Value)
  vst.Range("e3") = MojeVal(TBZivot.Value)
  dobaz = MojeVal(TBZivot.Value)
  If OptUver.Value = True Then 'uvery
    vst.Range("c20") = MojeVal(TBUverPr.Value)
    vst.Range("e20") = MojeVal(TBUver.Value)
    vst.Range("a21") = OptUrokyInv.Value
    vst.Range("c21") = MojeVal(TBUrok.Value)
    vst.Range("c22") = MojeVal(TBDobaUver.Value)
    If OptKonstUmor.Value = True Then vst.Range("b19") = "Konstantn|fffd| |fffd|mor" _
      Else vst.Range("b19") = "Anuitn|fffd| spl|fffd|cen|fffd|"
    vst.Range("c9") = invu
  Else
    vst.Range("c9") = 0
    vst.Range("c20") = 0
    vst.Range("e20") = 0
    vst.Range("c21").Clear
    vst.Range("c21").Style = "vstupn|fffd|Proc"
    vst.Range("c22").Clear
    vst.Range("c22").Style = "vstupn|fffd|Rok"
    vst.Range("b19").Clear
  End If
  vst.Range("a11").Value = ChInvDot.Value   'investicni dotace
  If ChInvDot.Value = True Then
    vst.Range("c11") = MojeVal(TBInvDot.Value)
    vst.Range("e11") = MojeVal(TBInvDotP.Value)
  Else
    vst.Range("c11") = 0
    vst.Range("e11") = 0
  End If
  vst.Range("b25") = TBDan.Value  'dane
  vst.Range("a26") = ChZapDan.Value
  vst.Range("a27") = ChRozpZtr.Value
  vst.Range("a23").Value = ChDanPrazdniny.Value

' odpocitatelnou polozku jiz zakon neumoznuje 10.1.2004
' opet zpristupneno 21.11.2004
  vst.Range("a29").Value = ChOdpPol.Value   'odpocitatelna polozka
  If ChOdpPol.Value = True Then vst.Range("e28") = TBOdpPol.Value _
    Else vst.Range("e28") = 0
  
  vst.Range("a17").Value = ChZustHodn.Value
  vst.Range("a16").Value = OptZustHodnVyp.Value 'uprava 18.11.2004
  If OptZustHodnVyp.Value Then vst.Range("a15").ClearContents Else vst.Range("a15").Value = MojeVal(TBZustHodn.Value) 'uprava 18.11.2004 (mazani doplneno 2.12.2004)
  vst.Range("b24") = TBDisk.Value
  vst.Range("e24") = TBRokDisk.Value
  vst.Range(vst.Cells(15, 3), vst.Cells(16, 9)).Clear
  If OptOdpZry.Value = True Then vst.Range("b13") = "Zrychlen|fffd|" _
    Else vst.Range("b13") = "Rovnom|fffd|rn|fffd|"
  vst.Range("a18").Value = ChDanOdepisovat.Value
  If inv = 0 Then vst.Range("b13").ClearContents 'maze typ odepisovani, v pripade nulove investice
  If MojeVal(TBProcI1.Value) > 0 Then  'odpisy
    vst.Range("c14") = "1. (" & inic.Range("f1") & inic.Range("j1") & ")"
    vst.Range("c15") = MojeVal(TBOdp1.Value)
    vst.Range("c16") = TBObnov1.Value
  Else
    vst.Range("c14") = "1."
  End If
  If MojeVal(TBProcI2.Value) > 0 Then
    vst.Range("d14") = "2. (" & inic.Range("f2") & inic.Range("j2") & ")"
    vst.Range("d15") = MojeVal(TBOdp2.Value)
    vst.Range("d16") = TBObnov2.Value
  Else
    vst.Range("d14") = "2."
  End If
  If MojeVal(TBProcI3.Value) > 0 Then
    vst.Range("e14") = "3. (" & inic.Range("f3") & inic.Range("j3") & ")"
    vst.Range("e15") = MojeVal(TBOdp3.Value)
    vst.Range("e16") = TBObnov3.Value
  Else
    vst.Range("e14") = "3."
  End If
  If MojeVal(TBProcI4.Value) > 0 Then
    vst.Range("f14") = "4. (" & inic.Range("f4") & inic.Range("j4") & ")"
    vst.Range("f15") = MojeVal(TBOdp4.Value)
    vst.Range("f16") = TBObnov4.Value
  Else
    vst.Range("f14") = "4."
  End If
  If MojeVal(TBProcI5.Value) > 0 Then
    vst.Range("g14") = "5. (" & inic.Range("f5") & inic.Range("j5") & ")"
    vst.Range("g15") = MojeVal(TBOdp5.Value)
    vst.Range("g16") = TBObnov5.Value
  Else
    vst.Range("g14") = "5."
  End If
  If MojeVal(TBProcI6.Value) > 0 Then
    vst.Range("h14") = "6. (" & inic.Range("f6") & inic.Range("j6") & ")"
    vst.Range("h15") = MojeVal(TBOdp6.Value)
    vst.Range("h16") = TBObnov6.Value
  Else
    vst.Range("h14") = "6."
  End If
  If MojeVal(TBProcIN.Value) > 0 Then
    vst.Range("i15") = MojeVal(TBOdpN.Value)
  End If
  inic.Range("mena") = TBMena.Value
  FormVstup.Hide
  vst.Range("C15:i15").Style = "vstupn|fffd|"
  ' styl pro dobu obnovy se nastavi jen pro odpis. tridy (pouze do h nikoliv i), nikoli pro neodepisovanou castku
  vst.Range("C16:h16").Style = "vstupn|fffd|Rok"
  Prepocet
Else
  MsgBox ("Sou|fffd|et zadan|fffd|ch odpis|fffd| neodpov|fffd|d|fffd| po|fffd|izovac|fffd| cen|fffd|, opravte se.")
End If
End Sub

Private Sub ButtonStorno_Click()
FormVstup.Hide
storno = True
End Sub

Private Sub ChInvDot_Click()
If ChInvDot.Value = True Then
  TBInvDotP.Value = inic.Range("b17")
  TBInvDotP.Visible = True
  SBInvDotP.Visible = True
  TBInvDot.Visible = True
  LInvDot.Visible = True
  LInvDotP.Visible = True
  TBInvDot.Value = inic.Range("b17") * inv / 100
Else
  TBInvDotP.Value = 0
  TBInvDotP.Visible = False
  SBInvDotP.Visible = False
  TBInvDot.Visible = False
  LInvDot.Visible = False
  LInvDotP.Visible = False
  TBInvDot.Value = 0
End If
End Sub

Private Sub ChOdpPol_Click()
If ChOdpPol.Value = True Then
  TBOdpPol.Visible = True
  SBOdpPol.Visible = True
  LOdpPol.Visible = True
  TBOdpPol.Value = inic.Range("b18")
Else
  TBOdpPol.Visible = False
  SBOdpPol.Visible = False
  LOdpPol.Visible = False
  TBOdpPol.Value = 0
End If
End Sub

Private Sub ChZapDan_Click()
If ChZapDan.Value = True Then
  ChRozpZtr.Value = False
  ChRozpZtr.Visible = False
Else
  ChRozpZtr.Visible = True
End If
End Sub

Private Sub ChZustHodn_Click()
If ChZustHodn.Value Then
  OptZustHodnVyp.Enabled = True
  OptZustHodnStanov.Enabled = True
  If OptZustHodnStanov.Value Then
    LabelZustHodn1.Enabled = True
    LabelZustHodn2.Enabled = True
    TBZustHodn.Enabled = True
  Else
    LabelZustHodn1.Enabled = False
    LabelZustHodn2.Enabled = False
    TBZustHodn.Enabled = False
  End If
Else
  OptZustHodnVyp.Enabled = False
  OptZustHodnStanov.Enabled = False
  LabelZustHodn1.Enabled = False
  LabelZustHodn2.Enabled = False
  TBZustHodn.Enabled = False
End If
End Sub

Private Sub MultiPage1_Change()
souco = NaseVal(TBOdp1.Value) + NaseVal(TBOdp2.Value) + NaseVal(TBOdp3.Value) + NaseVal(TBOdp4.Value) + NaseVal(TBOdp5.Value) + NaseVal(TBOdp6.Value) + NaseVal(TBOdpN.Value)
'souco = inv
TBUrok_Change
If Not OptUver Then invu = 0
TBUverPr_Change
SBInvDotP_Change
PrepoctiOdpisy
End Sub
Private Sub PrepoctiOdpisy()
TBProcI1_Change
TBProcI2_Change
TBProcI3_Change
TBProcI4_Change
TBProcI5_Change
TBProcI6_Change
TBProcIN_Change
End Sub
Private Sub OptDiskJinyRok_Click()
SBRokDisk.Enabled = True
End Sub

Private Sub OptDiskZacPr_Click()
TBRokDisk.Value = TBRokPro.Value
SBRokDisk.Enabled = False
End Sub

Private Sub OptUrokyInv_Click()
If OptUrokyInv = True Then invu = invu1 + invu2
End Sub

Private Sub OptUrokyProv_Click()
If OptUrokyProv = True Then invu = 0
End Sub

Private Sub OptUver_Click()
If OptUver = True Then FrUver.Visible = True
End Sub

Private Sub OptVlZdroj_Click()
If OptVlZdroj.Value = True Then
  FrUver.Visible = False
Else
  FrUver.Visible = True
End If
End Sub

Private Sub OptZustHodnStanov_Click()
If OptZustHodnStanov.Value Then
  LabelZustHodn1.Enabled = True
  LabelZustHodn2.Enabled = True
  TBZustHodn.Enabled = True
Else
  LabelZustHodn1.Enabled = False
  LabelZustHodn2.Enabled = False
  TBZustHodn.Enabled = False
End If
End Sub

Private Sub OptZustHodnVyp_Click()
If OptZustHodnVyp.Value Then
  LabelZustHodn1.Enabled = False
  LabelZustHodn2.Enabled = False
  TBZustHodn.Enabled = False
Else
  LabelZustHodn1.Enabled = True
  LabelZustHodn2.Enabled = True
  TBZustHodn.Enabled = True
End If
End Sub

Private Sub SBDan_Change()
TBDan.Value = NaseVal(SBDan.Value)
End Sub

'Private Sub SBDisk_Change()
'TBDisk.Value = NaseVal(SBDisk.Value)
'End Sub

Private Sub SBDisk_SpinDown()
If SBDisk.Value <= SBDisk.Min Then
  SBDisk.Value = SBDisk.Min
  TBDisk.Value = SBDisk.Min
Else
  TBDisk.Value = MojeVal(TBDisk.Value) - SBDisk.SmallChange
End If
End Sub

Private Sub SBDisk_SpinUp()
If SBDisk.Value >= SBDisk.Max Then
  SBDisk.Value = SBDisk.Max
  TBDisk.Value = SBDisk.Max
Else
  TBDisk.Value = MojeVal(TBDisk.Value) + SBDisk.SmallChange
End If
End Sub

'Private Sub SBDobaUver_Change()
'TBDobaUver.Value = NaseVal(SBDobaUver.Value)
'End Sub

Private Sub SBDobaUver_SpinDown()
If SBDobaUver.Value <= SBDobaUver.Min Then
  SBDobaUver.Value = SBDobaUver.Min
  TBDobaUver.Value = SBDobaUver.Min
Else
  TBDobaUver.Value = MojeVal(TBDobaUver.Value) - SBDobaUver.SmallChange
End If
End Sub

Private Sub SBDobaUver_SpinUp()
If SBDobaUver.Value >= SBDobaUver.Max Then
  SBDobaUver.Value = SBDobaUver.Max
  TBDobaUver.Value = SBDobaUver.Max
Else
  TBDobaUver.Value = MojeVal(TBDobaUver.Value) + SBDobaUver.SmallChange
End If
End Sub

'Private Sub SBInv1_Change()
'inv1 = NaseVal(SBInv1.Value)
'TBInv1.Value = inv1
'inv = inv1 + inv2
'End Sub

Private Sub SBInv1_SpinDown()
If SBInv1.Value <= SBInv1.Min Then
  SBInv1.Value = SBInv1.Min
  inv1 = SBInv1.Min
  TBInv1.Value = inv1
  inv = inv1 + inv2
Else
  inv1 = SBInv1.Value
  TBInv1.Value = inv1
  inv = inv1 + inv2
End If
End Sub

Private Sub SBInv1_SpinUp()
If SBInv1.Value >= SBInv1.Max Then
  SBInv1.Value = SBInv1.Max
  inv1 = SBInv1.Max
  TBInv1.Value = inv1
  inv = inv1 + inv2
Else
  inv1 = SBInv1.Value
  TBInv1.Value = inv1
  inv = inv1 + inv2
End If
End Sub

'Private Sub SBInv2_Change()
'inv2 = NaseVal(SBInv2.Value)
'TBInv2.Value = inv2
'inv = inv1 + inv2
'End Sub

Private Sub SBInv2_SpinDown()
If SBInv2.Value <= SBInv2.Min Then
  SBInv2.Value = SBInv2.Min
  inv2 = SBInv2.Min
  TBInv2.Value = inv2
  inv = inv1 + inv2
Else
  inv2 = SBInv2.Value
  TBInv2.Value = inv2
  inv = inv1 + inv2
End If
End Sub

Private Sub SBInv2_SpinUp()
If SBInv2.Value >= SBInv2.Max Then
  SBInv2.Value = SBInv2.Max
  inv2 = SBInv2.Max
  TBInv2.Value = inv2
  inv = inv1 + inv2
Else
  inv2 = SBInv2.Value
  TBInv2.Value = inv2
  inv = inv1 + inv2
End If
End Sub

Private Sub SBInvDotP_Change()
invdotp = NaseVal(SBInvDotP.Value)
TBInvDotP.Value = invdotp
TBInvDot.Value = invdotp * inv / 100
If ChInvDot = True Then
  invdot = invdotp * inv / 100
Else
  invdot = 0
End If
End Sub

Private Sub SBOdpPol_Change()
TBOdpPol.Value = NaseVal(SBOdpPol.Value)
End Sub

Private Sub SBRokDisk_Change()
TBRokDisk.Value = SBRokDisk.Value
End Sub

Private Sub SBRokPro_Change()
TBRokPro.Value = NaseVal(SBRokPro.Value)
End Sub

Private Sub SBRokVyst_Change()
TBRokVyst = SBRokVyst
End Sub

'Private Sub SBUrok_Change()
'TBUrok.Value = NaseVal(SBUrok.Value)
'End Sub

Private Sub SBUrok_SpinDown()
If SBUrok.Value <= SBUrok.Min Then
  SBUrok.Value = SBUrok.Min
  TBUrok.Value = SBUrok.Min
Else
  TBUrok.Value = MojeVal(TBUrok.Value) - SBUrok.SmallChange
End If
End Sub

Private Sub SBUrok_SpinUp()
If SBUrok.Value >= SBUrok.Max Then
  SBUrok.Value = SBUrok.Max
  TBUrok.Value = SBUrok.Max
Else
  TBUrok.Value = MojeVal(TBUrok.Value) + SBUrok.SmallChange
End If
End Sub

'Private Sub SBUverPr_Change()
'pomoc = NaseVal(SBUverPr.Value)
'TBUverPr.Value = pomoc
'End Sub

Private Sub SBUverPr_SpinDown()
If SBUverPr.Value <= SBUverPr.Min Then
  SBUverPr.Value = SBUverPr.Min
  TBUverPr.Value = SBUverPr.Min
Else
  TBUverPr.Value = MojeVal(TBUverPr.Value) - SBUverPr.SmallChange
End If
End Sub

Private Sub SBUverPr_SpinUp()
If SBUverPr.Value >= SBUverPr.Max Then
  SBUverPr.Value = SBUverPr.Max
  TBUverPr.Value = SBUverPr.Max
Else
  TBUverPr.Value = MojeVal(TBUverPr.Value) + SBUverPr.SmallChange
End If
End Sub

Private Sub SBZivot_Change()
dobaz = NaseVal(SBZivot.Value)
TBZivot.Value = dobaz
End Sub

Private Sub TBDan_Change()
hodn = NaseVal(TBDan.Value)
If hodn > SBDan.Max Then
    SBDan.Value = SBDan.Max
    TBDan.Value = SBDan.Max
Else
    SBDan.Value = NaseVal(TBDan.Value)
End If
End Sub

Private Sub TBDanOdp1_AfterUpdate()
inic.Range("f1").Value = MojeVal(TBDanOdp1.Value)
End Sub

Private Sub TBDanOdp2_AfterUpdate()
inic.Range("f2").Value = MojeVal(TBDanOdp2.Value)
End Sub

Private Sub TBDanOdp3_AfterUpdate()
inic.Range("f3").Value = MojeVal(TBDanOdp3.Value)
End Sub

Private Sub TBDanOdp4_AfterUpdate()
inic.Range("f4").Value = MojeVal(TBDanOdp4.Value)
End Sub

Private Sub TBDanOdp5_AfterUpdate()
inic.Range("f5").Value = MojeVal(TBDanOdp5.Value)
End Sub

Private Sub TBDanOdp6_AfterUpdate()
inic.Range("f6").Value = MojeVal(TBDanOdp6.Value)
End Sub

Private Sub TBDisk_AfterUpdate()
pomoc = Fix(MojeVal(TBDisk.Value))
If pomoc > SBDisk.Max Then
  SBDisk.Value = SBDisk.Max
  MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
Else
  If pomoc < SBDisk.Min Then
    SBDisk.Value = SBDisk.Min
    MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
  Else
    SBDisk.Value = CInt(pomoc)
  End If
End If
End Sub

'Private Sub TBDobaUver_Change()
'SBDobaUver.Value = NaseVal(TBDobaUver.Value)
'End Sub

Private Sub TBDobaUver_AfterUpdate()
pomoc = Fix(MojeVal(TBDobaUver.Value))
If pomoc > SBDobaUver.Max Then
  SBDobaUver.Value = SBDobaUver.Max
  MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
Else
  If pomoc < SBDobaUver.Min Then
    SBDobaUver.Value = SBDobaUver.Min
    MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
  Else
    SBDobaUver.Value = CInt(pomoc)
  End If
End If
End Sub

'Private Sub TBInv1_Change()
'inv1 = NaseVal(TBInv1.Value)
'SBInv1.Value = inv1
'inv = inv1 + inv2
'MultiPage1_Change
'End Sub

Private Sub TBInv1_AfterUpdate()
inv1 = MojeVal(TBInv1.Value)
pomoc = Fix(inv1)
If pomoc > SBInv1.Max Then
  SBInv1.Value = SBInv1.Max
  MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
Else
  If pomoc < SBInv1.Min Then
    SBInv1.Value = SBInv1.Min
    MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
  Else
    SBInv1.Value = CLng(pomoc)
  End If
End If
inv = inv1 + inv2
MultiPage1_Change
End Sub

'Private Sub TBInv2_Change()
'inv2 = NaseVal(TBInv2.Value)
'SBInv2.Value = inv2
'inv = inv1 + inv2
'MultiPage1_Change
'End Sub

Private Sub TBInv2_AfterUpdate()
inv2 = MojeVal(TBInv2.Value)
pomoc = Fix(inv2)
If pomoc > SBInv2.Max Then
  SBInv2.Value = SBInv2.Max
  MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
Else
  If pomoc < SBInv2.Min Then
    SBInv2.Value = SBInv2.Min
    MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
  Else
    SBInv2.Value = CLng(pomoc)
  End If
End If
inv = inv1 + inv2
MultiPage1_Change
End Sub

Private Sub TBInvDot_AfterUpdate()
If inv <> 0 Then
  invdot = MojeVal(TBInvDot.Value)
  invdotp = invdot / inv * 100
  TBInvDotP.Value = Application.Round(invdotp, 3)
  SBInvDotP.Value = CInt(TBInvDotP.Value)
Else
  MsgBox ("Zad|fffd|vate investi|fffd|n|fffd| dotaci, a p|fffd|itom m|fffd|te nulov|fffd| investi|fffd|n|fffd| v|fffd|daje.")
End If
MultiPage1_Change
End Sub

Private Sub TBInvDotP_Change()
invdotp = MojeVal(TBInvDotP.Value)
SBInvDotP.Value = CInt(invdotp)
TBInvDot.Value = invdotp * inv / 100
MultiPage1_Change
End Sub

Private Sub TBMena_AfterUpdate()
Label41.Caption = TBMena.Value
Label42.Caption = TBMena.Value
Label43.Caption = TBMena.Value
Label44.Caption = TBMena.Value
LInvDot.Caption = TBMena.Value
LabelZustHodn2.Caption = TBMena.Value
End Sub

Private Sub TBMena_Change()

End Sub

Private Sub TBOdp1_AfterUpdate()
odp1 = NaseVal(TBOdp1.Value)
TBProcI1.Value = 100 * odp1 / (inv + invu - invdot)
End Sub

Private Sub TBOdp2_AfterUpdate()
odp2 = NaseVal(TBOdp2.Value)
TBProcI2.Value = 100 * odp2 / (inv + invu - invdot)
End Sub

Private Sub TBOdp3_AfterUpdate()
odp3 = NaseVal(TBOdp3.Value)
TBProcI3.Value = 100 * odp3 / (inv + invu - invdot)
End Sub

Private Sub TBOdp4_AfterUpdate()
odp4 = NaseVal(TBOdp4.Value)
TBProcI4.Value = 100 * odp4 / (inv + invu - invdot)
End Sub

Private Sub TBOdp5_AfterUpdate()
odp5 = NaseVal(TBOdp5.Value)
TBProcI5.Value = 100 * odp5 / (inv + invu - invdot)
End Sub

Private Sub TBOdp6_AfterUpdate()
odp6 = NaseVal(TBOdp6.Value)
TBProcI6.Value = 100 * odp6 / (inv + invu - invdot)
End Sub

Private Sub TBOdpN_AfterUpdate()
odpN = NaseVal(TBOdpN.Value)
TBProcIN.Value = 100 * odpN / (inv + invu - invdot)
End Sub

Private Sub TBOdpPol_AfterUpdate()
If TBOdpPol.Value > SBOdpPol.Max Then
  SBOdpPol.Value = SBOdpPol.Max
  TBOdpPol.Value = SBOdpPol.Max
Else
  If TBOdpPol.Value < SBOdpPol.Min Then
    SBOdpPol.Value = SBOdpPol.Min
    TBOdpPol.Value = SBOdpPol.Min
  Else
    SBOdpPol.Value = NaseVal(TBOdpPol.Value)
  End If
End If
End Sub

Private Sub TBProcI1_Change()
proco1 = NaseVal(TBProcI1.Value)
odp1 = proco1 * (inv + invu - invdot) / 100
TBOdp1.Value = Application.Round(odp1, 3)
UpravTextOdpisu
End Sub
Private Sub TBProcI2_Change()
proco2 = NaseVal(TBProcI2.Value)
odp2 = proco2 * (inv + invu - invdot) / 100
TBOdp2.Value = Application.Round(odp2, 3)
UpravTextOdpisu
End Sub
Private Sub TBProcI3_Change()
proco3 = NaseVal(TBProcI3.Value)
odp3 = proco3 * (inv + invu - invdot) / 100
TBOdp3.Value = Application.Round(odp3, 3)
UpravTextOdpisu
End Sub
Private Sub TBProcI4_Change()
proco4 = NaseVal(TBProcI4.Value)
odp4 = proco4 * (inv + invu - invdot) / 100
TBOdp4.Value = Application.Round(odp4, 3)
UpravTextOdpisu
End Sub
Private Sub TBProcI5_Change()
proco5 = NaseVal(TBProcI5.Value)
odp5 = proco5 * (inv + invu - invdot) / 100
TBOdp5.Value = Application.Round(odp5, 3)
UpravTextOdpisu
End Sub
Private Sub TBProcI6_Change()
proco6 = NaseVal(TBProcI6.Value)
odp6 = proco6 * (inv + invu - invdot) / 100
TBOdp6.Value = Application.Round(odp6, 3)
UpravTextOdpisu
End Sub
Private Sub TBProcIN_Change()
procoN = NaseVal(TBProcIN.Value)
odpN = procoN * (inv + invu - invdot) / 100
TBOdpN.Value = Application.Round(odpN, 3)
UpravTextOdpisu
End Sub
Private Sub UpravTextOdpisu()
soucp = proco1 + proco2 + proco3 + proco4 + proco5 + proco6 + procoN
LabelSoucP.Caption = soucp
souco = odp1 + odp2 + odp3 + odp4 + odp5 + odp6 + odpN
LabelSoucO.Caption = souco
pomoc = souco - (inv + invu - invdot)
If pomoc >= 0 Then LabelRozdO.Caption = "(+" & Str(Application.Round(pomoc, 3)) & ")" _
    Else LabelRozdO.Caption = "(" & Str(Application.Round(pomoc, 3)) & ")"
pomoc = soucp - 100
If pomoc >= 0 Then LabelRozdP.Caption = "(+" & Str(Application.Round(pomoc, 2)) & ")" _
    Else LabelRozdP.Caption = "(" & Str(Application.Round(pomoc, 2)) & ")"
End Sub

Private Sub TBRokDisk_AfterUpdate()
SBRokDisk.Value = NaseVal(TBRokDisk.Value)
End Sub

Private Sub TBRokPro_Change()
SBRokPro.Value = NaseVal(TBRokPro.Value)
If OptDiskZacPr.Value = True Then TBRokDisk.Value = TBRokPro.Value
If NaseVal(TBRokPro) > SBRokVyst + 1 Then
  SBRokVyst = TBRokPro - 1
Else
  If NaseVal(TBRokPro.Value) < SBRokVyst Then SBRokVyst = TBRokPro
End If
If (NaseVal(TBRokPro) - NaseVal(TBRokVyst)) = 0 Then
  SBInv1 = 0
  inv1 = 0
  inv = inv1 + inv2
  Label11.Visible = False
  TBInv1.Visible = False
  SBInv1.Visible = False
  Label41.Visible = False
Else
  inv1 = NaseVal(TBInv1.Value)
  inv = inv1 + inv2
  Label11.Visible = True
  TBInv1.Visible = True
  SBInv1.Visible = True
  Label41.Visible = True
End If
TBUrok_Change
MultiPage1_Change
End Sub

Private Sub TBRokVyst_Change()
SBRokVyst = TBRokVyst
If NaseVal(TBRokPro) > SBRokVyst + 1 Then
  TBRokPro = SBRokVyst + 1
Else
  If NaseVal(TBRokPro.Value) < SBRokVyst Then TBRokPro = SBRokVyst
End If
If (NaseVal(TBRokPro) - NaseVal(TBRokVyst)) = 0 Then
  SBInv1 = 0
  inv1 = 0
  inv = inv1 + inv2
  Label11.Visible = False
  TBInv1.Visible = False
  SBInv1.Visible = False
  Label41.Visible = False
Else
  inv1 = NaseVal(TBInv1.Value)
  inv = inv1 + inv2
  Label11.Visible = True
  TBInv1.Visible = True
  SBInv1.Visible = True
  Label41.Visible = True
End If
TBUrok_Change
MultiPage1_Change
End Sub

Private Sub TBUrok_Change()
Dim urok As Double
Dim uvproc As Double
Dim co As Double
urok = MojeVal(TBUrok.Value) / 100
uvproc = MojeVal(TBUverPr.Value) / 100
'SBUrok.Value = urok * 100
pomoc = urok * 100
co = Fix(pomoc)
If co > SBUrok.Max Then
  SBUrok.Value = SBUrok.Max
  MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
Else
  If co < SBUrok.Min Then
    SBUrok.Value = SBUrok.Min
    MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
  Else
    SBUrok.Value = CInt(co)
  End If
End If
' tento komentar je druha zavorka pro nahradu predchazejiciho komentare

invu1 = MojeVal(TBInv1) * uvproc * urok
invu2 = MojeVal(TBInv2) * uvproc * urok
If NaseVal(TBRokVyst) = NaseVal(TBRokPro) Then
    invu2 = invu2 * (CBMesicPro.ListIndex - CBMesVyst.ListIndex) / 12
    invu1 = 0
Else
    invu1 = invu1 * (12 - CBMesVyst.ListIndex) / 12
    invu2 = (NaseVal(TBInv2) * uvproc * urok + NaseVal(TBInv1) * uvproc * urok) * (CBMesicPro.ListIndex) / 12
End If
If OptUrokyInv.Value = True Then invu = invu1 + invu2 Else invu = 0
End Sub

Private Sub TBUver_AfterUpdate()
If inv <> 0 Then
  pomoc = NaseVal(TBUver.Value) * 100 / inv
  TBUverPr.Value = pomoc
Else
  MsgBox ("Zad|fffd|vate |fffd|v|fffd|r, kter|fffd| nen|fffd| na co |fffd|erpat (investi|fffd|n|fffd| v|fffd|daje = 0).")
End If
End Sub

Private Sub TBUverPr_Change()
Dim co As Double
pomoc = MojeVal(TBUverPr.Value)
'SBUverPr.Value = pomoc
co = Fix(pomoc)
If co > SBUverPr.Max Then
  SBUverPr.Value = SBUverPr.Max
  MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
Else
  If co < SBUverPr.Min Then
    SBUverPr.Value = SBUverPr.Min
    MsgBox "Opravdu trv|fffd|te na v|fffd|mi zadan|fffd| hodnot|fffd|?", , "Efekt - vstupn|fffd| data"
  Else
    SBUverPr.Value = CInt(co)
  End If
End If
TBUver.Value = pomoc * inv / 100
End Sub

Private Sub TBZivot_Change()
dobaz = NaseVal(TBZivot.Value)
SBZivot.Value = dobaz
End Sub

Private Sub UserForm_Initialize()
Set vst = Worksheets("Vstupy")
Set vyst = Worksheets("V|fffd|sledky")
Set prop = Worksheets("Propo|fffd|ty")
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")
formvstupinic = True
ChRozpZtr.Caption = ChRozpZtr.Caption & inic.Range("b19") & " let"
ChDanPrazdniny.Caption = ChDanPrazdniny.Caption & inic.Range("b21") & " let"
TBMena.Value = inic.Range("mena")
Label41.Caption = inic.Range("mena")
Label42.Caption = inic.Range("mena")
Label43.Caption = inic.Range("mena")
Label44.Caption = inic.Range("mena")
LInvDot.Caption = inic.Range("mena")
LabelZustHodn2.Caption = inic.Range("mena")



If IsEmpty(vst.Range("b1")) Then
  CBMesVyst.Value = inic.Range("b2")
  TBRokVyst.Value = Year(Date)
  SBRokVyst.Value = Year(Date)
  CBMesicPro.Value = inic.Range("b2")
  TBRokPro.Value = Year(Date) + 1
  SBZivot.Value = TBZivot.Value
  OptUver.Value = inic.Range("b29")
  OptVlZdroj.Value = Not (inic.Range("b29"))
  ChInvDot.Value = False
  TBInvDotP.Value = inic.Range("b17")
  TBInvDotP.Visible = False
  SBInvDotP.Value = inic.Range("b17")
  SBInvDotP.Visible = False
  TBInvDot.Visible = False
  LInvDot.Visible = False
  LInvDotP.Visible = False
  TBUverPr.Value = inic.Range("b30")
  SBUverPr.Value = TBUverPr.Value
  TBUrok.Value = inic.Range("b31")
  SBUrok.Value = TBUrok.Value
  TBDobaUver.Value = inic.Range("b32")
  SBDobaUver.Value = TBDobaUver.Value
  OptKonstUmor.Value = inic.Range("b33")
  OptUrokyInv.Value = inic.Range("b36")
  OptUrokyProv.Value = Not (inic.Range("b36"))
  TBDan.Value = inic.Range("b1")
  ' odpocitatelnou polozku jiz zakon nedovoluje 10.1.2004
  ' opet zpristupneno 21.11.2004
  ChOdpPol.Value = False
  TBOdpPol.Value = inic.Range("b18")
  SBOdpPol.Value = inic.Range("b18")
  TBDisk.Value = inic.Range("b20")
  SBDisk.Value = inic.Range("b20")
  OptDiskZacPr.Value = True
  TBRokDisk.Value = TBRokPro.Value
  TBRokDisk.Enabled = False
  SBRokDisk.Value = TBRokPro.Value
  SBRokDisk.Enabled = False
  OptOdpZry.Value = False
  OptOdpRov.Value = True
  ChDanOdepisovat.Value = inic.Range("b22")
  TBDanOdp1.Value = inic.Range("f1")
  TBDanOdp2.Value = inic.Range("f2")
  TBDanOdp3.Value = inic.Range("f3")
  TBDanOdp4.Value = inic.Range("f4")
  TBDanOdp5.Value = inic.Range("f5")
  TBDanOdp6.Value = inic.Range("f6")
  TBObnov1.Value = inic.Range("h1")
  TBObnov2.Value = inic.Range("h2")
  TBObnov3.Value = inic.Range("h3")
  TBObnov4.Value = inic.Range("h4")
  TBObnov5.Value = inic.Range("h5")
  TBObnov6.Value = inic.Range("h6")
Else
  TBNazev.Value = vst.Range("b1")
  CBMesVyst.Value = vst.Range("c5")
  SBRokVyst.Value = vst.Range("d5")
  TBRokVyst.Value = vst.Range("d5")
  inv1 = NaseVal(vst.Range("c7"))
  SBInv1.Value = inv1
  TBInv1.Value = inv1
  inv2 = NaseVal(vst.Range("c8"))
  SBInv2.Value = inv2
  TBInv2.Value = inv2
  inv = inv1 + inv2
  CBMesicPro.Value = vst.Range("b3")
  TBRokPro.Value = vst.Range("c3")
  TBZivot.Value = vst.Range("e3")
  If vst.Range("c20") > 0 Then 'uvery
    OptUver.Value = True
    SBUverPr.Value = vst.Range("c20")
    TBUverPr.Value = vst.Range("c20")
    TBUver.Value = vst.Range("e20")
    SBDobaUver.Value = vst.Range("c22")
    TBDobaUver.Value = vst.Range("c22")
    SBUrok.Value = vst.Range("c21")
    TBUrok.Value = vst.Range("c21")
    OptUrokyInv.Value = vst.Range("a21")
    OptUrokyProv.Value = Not (vst.Range("a21"))
    If vst.Range("b19") = "Konstantn|fffd| |fffd|mor" Then OptKonstUmor.Value = True _
      Else OptAnuitUver.Value = True
  Else
    OptVlZdroj.Value = True
    FrUver.Visible = False
  End If
  ChInvDot.Value = vst.Range("a11").Value 'investicni dotace
  If vst.Range("a11").Value = True Then
    TBInvDot.Value = vst.Range("c11")
    SBInvDotP.Value = vst.Range("e11")
    TBInvDotP.Value = vst.Range("e11")
  End If
  TBDan.Value = vst.Range("b25")  'dane
  ChDanPrazdniny.Value = vst.Range("a23").Value
  ChZapDan.Value = vst.Range("a26").Value
  If vst.Range("a26").Value = False Then
    ChRozpZtr.Value = vst.Range("a27").Value
  End If
  'nastaveni odpocitatelne polozky zruseno - zakon jiz nedovoluje 10.1.2004
  ' opet zpristupneno 21.11.2004
  ChOdpPol.Value = vst.Range("a29").Value 'odpocitatelna polozka
  If vst.Range("a29") = True Then
    TBOdpPol.Visible = True
    SBOdpPol.Visible = True
    LOdpPol.Visible = True
    SBOdpPol.Value = vst.Range("e28")
    TBOdpPol.Value = vst.Range("e28")
  Else
    TBOdpPol.Visible = False
    SBOdpPol.Visible = False
    LOdpPol.Visible = False
  End If
  ChZustHodn.Value = vst.Range("a17").Value
  If vst.Range("a16") Then OptZustHodnVyp.Value = True Else OptZustHodnStanov.Value = True 'uprava 18.11.2004 oprava 2.12.2004
  TBZustHodn.Value = vst.Range("a15").Value 'uprava 18.11.2004
  SBDisk.Value = vst.Range("b24")
  TBDisk.Value = vst.Range("b24")
  SBRokDisk.Value = vst.Range("e24")
  TBRokDisk.Value = vst.Range("e24")
  If vst.Range("e24") = vst.Range("c3") Then
    OptDiskZacPr.Value = True
    TBRokDisk.Enabled = False
    SBRokDisk.Enabled = False
  Else
    OptDiskJinyRok.Value = True
    TBRokDisk.Enabled = True
    SBRokDisk.Enabled = True
  End If
  If vst.Range("b13") = "Zrychlen|fffd|" Then OptOdpZry.Value = True _
    Else OptOdpRov.Value = True
  ChDanOdepisovat.Value = vst.Range("a18").Value
  TBDanOdp1.Value = inic.Range("f1")
  TBDanOdp2.Value = inic.Range("f2")
  TBDanOdp3.Value = inic.Range("f3")
  TBDanOdp4.Value = inic.Range("f4")
  TBDanOdp5.Value = inic.Range("f5")
  TBDanOdp6.Value = inic.Range("f6")
  invu = NaseVal(vst.Range("c9"))
  invdot = NaseVal(vst.Range("c11"))
  If inv <> 0 Then
    TBProcI1 = Application.Round(vst.Range("c15") * 100 / (inv + invu - invdot), 2)
    TBProcI2 = Application.Round(vst.Range("d15") * 100 / (inv + invu - invdot), 2)
    TBProcI3 = Application.Round(vst.Range("e15") * 100 / (inv + invu - invdot), 2)
    TBProcI4 = Application.Round(vst.Range("f15") * 100 / (inv + invu - invdot), 2)
    TBProcI5 = Application.Round(vst.Range("g15") * 100 / (inv + invu - invdot), 2)
    TBProcI6 = Application.Round(vst.Range("h15") * 100 / (inv + invu - invdot), 2)
    TBProcIN = Application.Round(vst.Range("i15") * 100 / (inv + invu - invdot), 2)
    TBOdp1.Value = vst.Range("c15")
    TBOdp2.Value = vst.Range("d15")
    TBOdp3.Value = vst.Range("e15")
    TBOdp4.Value = vst.Range("f15")
    TBOdp5.Value = vst.Range("g15")
    TBOdp6.Value = vst.Range("h15")
    TBOdpN.Value = vst.Range("i15")
    souco = vst.Range("c15") + vst.Range("d15") + vst.Range("e15") + vst.Range("f15") + vst.Range("g15") + vst.Range("h15") + vst.Range("i15")
    If IsEmpty(vst.Range("c16")) Then TBObnov1.Value = inic.Range("h1") Else TBObnov1.Value = vst.Range("c16")
    If IsEmpty(vst.Range("d16")) Then TBObnov2.Value = inic.Range("h2") Else TBObnov2.Value = vst.Range("d16")
    If IsEmpty(vst.Range("e16")) Then TBObnov3.Value = inic.Range("h3") Else TBObnov3.Value = vst.Range("e16")
    If IsEmpty(vst.Range("f16")) Then TBObnov4.Value = inic.Range("h4") Else TBObnov4.Value = vst.Range("f16")
    If IsEmpty(vst.Range("g16")) Then TBObnov5.Value = inic.Range("h5") Else TBObnov5.Value = vst.Range("g16")
    If IsEmpty(vst.Range("h16")) Then TBObnov6.Value = inic.Range("h6") Else TBObnov6.Value = vst.Range("h16")
  End If
End If
End Sub



Attribute VB_Name = "Graf1"
Attribute VB_Base = "0{00020821-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True






Attribute VB_Name = "Graf2"
Attribute VB_Base = "0{00020821-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True






Attribute VB_Name = "List1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True







Attribute VB_Name = "List2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True







Attribute VB_Name = "List3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True







Attribute VB_Name = "List4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True





Attribute VB_Name = "List5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True







Attribute VB_Name = "MinimalniCena"
Sub CenaNPV()
' Nalezne cenu v 1. roce takovou, aby bylo IRR rovna diskontu
' Cena ve 2. roce je o zvolen|fffd| procento vy|fffd||fffd||fffd|.
' Toto je druh|fffd| varianta, kter|fffd| hled|fffd| NPV nulov|fffd| pro diskont rovn|fffd| hledan|fffd| hodnot|fffd| IRR
' Tento postup by m|fffd|l v|fffd|st k rychlej|fffd||fffd|mu |fffd|e|fffd|en|fffd|.
' Nejd|fffd||fffd|ve se najde interval, kde je NPV kladn|fffd| a z|fffd|porn|fffd|,
' pot|fffd| se pou|fffd|ije metoda p|fffd|len|fffd| intervalu.
' Nastavovan|fffd| hodnoty

maxiter = 100
odchylka = 0.001
' Um|fffd|st|fffd|n|fffd| bun|fffd|k s daty a NPV
AdrNPV = "Propo|fffd|ty!C58"
AdrCena = "Vstupy!C48"
AdrCena2 = "Vstupy!D48"
AdrDiskont = "Vstupy!B24"
AdrRustCeny = "Vstupy!E48"

' Na|fffd|ten|fffd| hodnot
PrRust = Range(AdrRustCeny)
Range(AdrCena2).FormulaLocal = "=" & AdrCena & "*" & (1 + PrRust)
cakt = Range(AdrCena)
diskont = Range(AdrDiskont)
' Nastaven|fffd| cel|fffd|ho intervalu, pokud nen|fffd| zadan|fffd| cena v 1. roce, program se zastav|fffd|
cmin = 0
' nalezen|fffd| hranice, pro kterou je NPV kladn|fffd| a z|fffd|porn|fffd|
' Kdy|fffd| alespo|fffd| pro jednu hranici (sou|fffd|asnou cenu, minimum a maximum) je
oldsb = Application.DisplayStatusBar
Application.DisplayStatusBar = True
Application.StatusBar = "|fffd|ekejte, prob|fffd|h|fffd| v|fffd|po|fffd|et."
' Pro nulovou cenu je NPV kladn|fffd|, proto se v|fffd|po|fffd|et kon|fffd||fffd|.
Range(AdrCena) = cmin
If Range(AdrNPV) > 0 Then
  resp = MsgBox("NPV je kladn|fffd| i pro minim|fffd|ln|fffd| cenu " & cd, vbInformation + vbOKOnly, "Nenalezeno |fffd|e|fffd|en|fffd|")
  Range(AdrCena) = cakt
  Application.StatusBar = False
  Application.DisplayStatusBar = oldsb
  Exit Sub
End If
' Hled|fffd|n|fffd| maxim|fffd|ln|fffd| ceny kde je NPV kladn|fffd|
cmax = cakt / 2
' Pokud nen|fffd| zadan|fffd| cena, nastav|fffd|me 1, to sta|fffd||fffd| na za|fffd||fffd|tek v|fffd|po|fffd|tu
If cmax = 0 Then cmax = 1
Range(AdrCena) = cmax
ch = cmax
iter = 1
Do While Range(AdrNPV) < 0
  ch = ch * 2
  Range(AdrCena) = ch
  Application.StatusBar = "|fffd|ekejte, prob|fffd|h|fffd| hled|fffd|n|fffd| maxim|fffd|ln|fffd| ceny, iterace: " & iter
  iter = iter + 1
  If iter > 50 Then
      resp = MsgBox("NPV je z|fffd|porn|fffd| i pro maxim|fffd|ln|fffd| cenu " & ch, vbInformation + vbOKOnly, "Nenalezeno |fffd|e|fffd|en|fffd|")
      Range(AdrCena) = cakt
      Application.StatusBar = False
      Application.DisplayStatusBar = oldsb
      Exit Sub
      End If
Loop
' Nyn|fffd| metodou p|fffd|len|fffd| intervalu nalezneme |fffd|e|fffd|en|fffd| tak, aby bylo dosa|fffd|eno bu|fffd| po|fffd|adovan|fffd| odchylky nebo maxim|fffd|ln|fffd|ho po|fffd|tu iterac|fffd|
iter = 1
Do While iter < maxiter
  Application.StatusBar = "|fffd|ekejte, prob|fffd|h|fffd| hled|fffd|n|fffd| ceny, iterace: " & iter
  cxx = (cd + ch) / 2
  Range(AdrCena) = cxx
  If Range(AdrNPV) > 0 Then
    ch = cxx
  Else
    cd = cxx
  End If
' Nalezeno |fffd|e|fffd|en|fffd|
  If (Range(AdrNPV) - odchylka) < 0 And (Range(AdrNPV) + odchylka) > 0 Then
    resp = MsgBox("Bylo nalezeno |fffd|e|fffd|en|fffd|!", vbInformation + vbOKOnly, "|fffd|e|fffd|en|fffd|")
    Application.StatusBar = False
    Application.DisplayStatusBar = oldsb
    Exit Sub
  End If
  iter = iter + 1
Loop
' P|fffd|ekro|fffd|en  po|fffd|et iterac|fffd|
    resp = MsgBox("Bylo dosa|fffd|eno maxim|fffd|ln|fffd|ho po|fffd|tu iterac|fffd|" & maxiter, vbInformation + vbOKOnly, "Nenalezeno |fffd|e|fffd|en|fffd|")
    Application.StatusBar = False
    Application.DisplayStatusBar = oldsb
End Sub
Attribute VB_Name = "ModCitlAn"
Public citlan As Boolean
Dim count As Byte

Sub vyplnproc()
Dim pom1 As Double
Dim pom2 As Double
pom1 = can.Range("c4") - can.Range("b4")
For count = 0 To 10
  pom2 = can.Range("b4") + count * (pom1 / 10)
  can.Cells(7 + count, 1) = pom2
Next count
End Sub

Sub UpravGrafCA()
Dim graf As ChartObject
Set graf = can.ChartObjects(1)

vystup = inic.Range("g19").Offset(FormCitlAn.CBHodnKrit.ListIndex, 1).Value
If vystup = "IRR" Then
    graf.Chart.Axes(xlValue).TickLabels.NumberFormat = "0.00%"
Else
    graf.Chart.Axes(xlValue).TickLabels.NumberFormat = "general"
End If
graf.Chart.Axes(xlValue).AxisTitle.Text = inic.Range("g19").Offset(FormCitlAn.CBHodnKrit.ListIndex, 2).Value
graf.Chart.Axes(xlCategory).AxisTitle.Text = FormCitlAn.CBMenHodn.Value & "  " & _
        inic.Range("g9").Offset(FormCitlAn.CBMenHodn.ListIndex, 3).Value

End Sub

Sub CitlAnalyza()
Set vst = Worksheets("Vstupy")
Set vyst = Worksheets("V|fffd|sledky")
Set prop = Worksheets("Propo|fffd|ty")
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")

dobaz = vst.Range("e3")
citlan = False

' napln|fffd|n|fffd| seznamu podle konstant, nejprve seznam krit|fffd|ri|fffd|
' zjistit adresu prom|fffd|nn|fffd|
' ulo|fffd|it p|fffd|vodn|fffd| hodnotu prom|fffd|nn|fffd|
' vyplnit tabulku s procenty a s hodnotami (rozumn|fffd| zaokrouhlen|fffd|ch 11 hodnot)
' zjistit, kde je v|fffd|sledn|fffd| vzorec pro CA
' v cyklu m|fffd|nit prom|fffd|nnou a p|fffd|en|fffd|et v|fffd|sledek do tabulky
' vr|fffd|tit p|fffd|vodn|fffd| hodnotu
' zm|fffd|nit textov|fffd| popisy u grafu nap|fffd|. NPV=f(cena tepla)
' aktivovat str|fffd|nku s v|fffd|sledkem CA

FormCitlAn.Show
If citlan = True Then
  can.Activate
  Application.Calculation = xlCalculationManual
  vyplnproc
  can.Range("b7:b17").Clear
  vstup1 = inic.Range("g9").Offset(FormCitlAn.CBMenHodn.ListIndex, 1).Value
  vstup2 = inic.Range("g9").Offset(FormCitlAn.CBMenHodn.ListIndex, 2).Value
  vystup = inic.Range("g19").Offset(FormCitlAn.CBHodnKrit.ListIndex, 1).Value
  If vystup = "IRR" Then
    can.Range("c7:c17").NumberFormat = "0.00%"
  Else
    can.Range("c7:c17").Style = "CA"
  End If
  can.Range("a7:a17").NumberFormat = "0.0"
  can.Range("b7:b17").Style = "CA"
  old1 = vst.Range(vstup1)
  If vstup2 = "" Then   'vliv diskontu
    For count = 0 To 10
      can.Cells(7 + count, 2) = old1 * (1 + can.Cells(7 + count, 1) / 100)
      vst.Range(vstup1) = old1 * (1 + can.Cells(7 + count, 1) / 100)
      Calculate
      can.Cells(7 + count, 3) = Range(vystup).Value
    Next count
    vst.Range(vstup1) = old1
  Else    'vliv jinych parametru
    old2 = vst.Range(vstup2)
    If FormCitlAn.CBMenHodn.Value = "Investi|fffd|n|fffd| v|fffd|daje" Then   'vliv inv. vydaju
      Application.CutCopyMode = False
      vst.Range("c15:h15").Copy
      vst.Range("c13:h13").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
      For count = 0 To 10
        can.Cells(7 + count, 2) = (old1 + old2 + vst.Range("c9")) * (1 + can.Cells(7 + count, 1) / 100)
        vst.Range(vstup1) = old1 * (1 + can.Cells(7 + count, 1) / 100)
        vst.Range(vstup2) = old2 * (1 + can.Cells(7 + count, 1) / 100)
        For count1 = 0 To 5
          vst.Cells(15, 3 + count1).Value = vst.Cells(13, 3 + count1) * (1 + can.Cells(7 + count, 1) / 100)
        Next count1
        Calculate
        Investice
        Calculate
        UcOdpisy
        Calculate
        'If vst.Range("b13") = "Zrychlen|fffd|" Then DanOdpisy (0) _
            Else DanOdpisy (1)
        'volani danovych odpisu je nize - oprava 11.1.2004
        If vst.Range("a18").Value = True Then 'odepisovat danove?
          If vst.Range("b13") = "Zrychlen|fffd|" Then DanOdpisy (1) Else DanOdpisy (2)
        Else   'danove neodepisovat
          DanOdpisy (0)
        End If
        Calculate
        PropUver
        Calculate
        can.Cells(7 + count, 3) = Range(vystup).Value
      Next count
      vst.Range(vstup1) = old1
      vst.Range(vstup2) = old2
      vst.Range("c13:h13").Copy
      vst.Range("c15:h15").PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:= _
        False, Transpose:=False
      vst.Range("c13:h13").Clear
      Investice
      UcOdpisy
      If vst.Range("b13") = "Zrychlen|fffd|" Then DanOdpisy (0) _
          Else DanOdpisy (1)
      PropUver
    Else   'vliv jedne z cen
      For count = 0 To 10
        can.Cells(7 + count, 2) = old1 * (1 + can.Cells(7 + count, 1) / 100)
        vst.Range(vstup1) = old1 * (1 + can.Cells(7 + count, 1) / 100)
        vst.Range(vstup2) = old2 * (1 + can.Cells(7 + count, 1) / 100)
        Calculate
        can.Cells(7 + count, 3) = Range(vystup).Value
      Next count
      vst.Range(vstup1) = old1
      vst.Range(vstup2) = old2
    End If
  End If
Application.ScreenUpdating = False
vst.Activate
vst.Range("a1").Select
can.Activate
can.Range("a1").Select
Selection.Activate
Application.ScreenUpdating = True
ActiveWorkbook.Sheets("Citl. anal|fffd|za").Unprotect
UpravGrafCA
Application.Calculation = xlCalculationAutomatic
ActiveWorkbook.Sheets("Citl. anal|fffd|za").Protect UserInterfaceOnly:=True
End If
End Sub
Attribute VB_Name = "ModOvladani"
Public cx As Object
Public mojemenu As CommandBarPopup
Public menugr As CommandBarPopup
Public ActDir
Public vst As Worksheet
Public vyst As Worksheet
Public prop As Worksheet
Public inic As Worksheet
Public can As Worksheet
Public formvstupinic As Boolean
Public otevirame As Boolean

Sub PriOtevreni()
Application.EnableCancelKey = xlDisabled
Application.ScreenUpdating = False
For Each cx In ActiveWorkbook.Sheets
  cx.Protect UserInterfaceOnly:=True
Next cx
Set vst = Worksheets("Vstupy")
Set vyst = Worksheets("V|fffd|sledky")
Set prop = Worksheets("Propo|fffd|ty")
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")
otevirame = True
Sheets("Graf CF").Activate
VytvorMenuGraf
Sheets("Vstupy").Activate
VytvorMenu
Application.ScreenUpdating = True
FormUvod.Show
formvstupinic = False
End Sub

Sub PriZavreni()
Application.ScreenUpdating = False
For Each cx In ActiveWorkbook.Sheets
  cx.Unprotect
Next cx
Sheets("Graf CF").Activate
OdstranMenu
Sheets("Vstupy").Activate
OdstranMenu
Application.ScreenUpdating = True
Application.EnableCancelKey = xlInterrupt
End Sub

Sub VytvorMenu()
ActDir = ActiveWorkbook.Path & "\"
Set beznemenu = Application.CommandBars.ActiveMenuBar
Set mojemenu = beznemenu.Controls.Add(Type:=msoControlPopup, Temporary:=True)
mojemenu.Caption = "&Efekt"

Set poloz1 = mojemenu.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz1.Caption = "&Vstupy"
  Set poloz11 = poloz1.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz11
    .Caption = "&Vstupn|fffd| hodnoty"
    .OnAction = "VstupHodnot"
  End With
  Set poloz12 = poloz1.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz12
    .Caption = "&Projekt"
    .OnAction = "ZobrazListVstupy"
  End With
  Set poloz13 = poloz1.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz13
    .Caption = "&N|fffd|klady a v|fffd|nosy"
    .OnAction = "NaklNaVstupu"
  End With

Set poloz2 = mojemenu.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz2
    .Caption = "V|fffd|&po|fffd|et"
    .OnAction = "Prepocet"
  End With
  
Set poloz3 = mojemenu.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz3.Caption = "V|fffd|sl&edky"
  Set poloz31 = poloz3.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz31
    .Caption = "&Tabulka CF"
    .OnAction = "ZobrazTabCF"
  End With
  Set poloz32 = poloz3.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz32
    .Caption = "Hodnoty &krit|fffd|ri|fffd|"
    .OnAction = "ZobrazKrit"
  End With
    
Set poloz4 = mojemenu.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz4.Caption = "&Grafy"
  Set poloz41 = poloz4.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz41
    .Caption = "&Cash flow"
    .OnAction = "ZobrazGrafCF"
  End With
  Set poloz42 = poloz4.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz42
    .Caption = "&Diskontovan|fffd| cash flow"
    .OnAction = "ZobrazGrafDCF"
  End With
  Set poloz43 = poloz4.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz43
    .Caption = "Citlivostn|fffd| &anal|fffd|za"
    .OnAction = "ZobrazCitlAn"
  End With
  
Set poloz5 = mojemenu.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz5.Caption = "&Citlivostn|fffd| anal|fffd|za"
  Set poloz51 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz51
    .Caption = "&Nastaven|fffd|"
    .OnAction = "CitlAnalyza"
  End With
  Set poloz52 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz52
    .Caption = "&Graf"
    .OnAction = "ZobrazCitlan"
  End With
  Set poloz53 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz53
    .Caption = "&Tabulka"
    .OnAction = "ZobrazTabCitlAn"
  End With
  Set poloz54 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz54
    .Caption = "&Minim|fffd|ln|fffd| cena"
    .OnAction = "CenaNPV"
  End With
  
Set poloz6 = mojemenu.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz6.Caption = "&Sloupec"
  poloz6.BeginGroup = True
  Set poloz61 = poloz6.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz61
    .Caption = "&Roz|fffd||fffd||fffd|it"
    .OnAction = "RozsirSloupec"
  End With
  Set poloz62 = poloz6.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz62
    .Caption = "&Z|fffd||fffd|it"
    .OnAction = "ZuzitSloupec"
  End With
  Set poloz63 = poloz6.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz63
    .Caption = "&P|fffd|izp|fffd|sobit"
    .OnAction = "PrizpusobSloupec"
  End With
  Set poloz64 = poloz6.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz64
    .Caption = "&Standard"
    .OnAction = "StandardniSloupec"
  End With

Set poloz7 = mojemenu.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz7
    .Caption = "&N|fffd|pov|fffd|da"
    .OnAction = "MujHelp"
    .BeginGroup = True
  End With
  
Set poloz8 = mojemenu.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz8
    .Caption = "&O programu"
    .OnAction = "OProgramu"
  End With
  
Application.OnKey "{F1}", "MujHelp"

End Sub

Sub VytvorMenuGraf()
ActDir = ActiveWorkbook.Path & "\"
Set beznemenu = Application.CommandBars.ActiveMenuBar
Set menugr = beznemenu.Controls.Add(Type:=msoControlPopup, Temporary:=True)
menugr.Caption = "&Efekt"
menugr.Enabled = True

Set poloz1 = menugr.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz1.Caption = "&Vstupy"
  Set poloz11 = poloz1.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz11
    .Caption = "&Vstupn|fffd| hodnoty"
    .OnAction = "VstupHodnot"
  End With
  Set poloz12 = poloz1.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz12
    .Caption = "&Projekt"
    .OnAction = "ZobrazListVstupy"
  End With
  Set poloz13 = poloz1.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz13
    .Caption = "&N|fffd|klady a v|fffd|nosy"
    .OnAction = "NaklNaVstupu"
  End With

Set poloz2 = menugr.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz2
    .Caption = "V|fffd|&po|fffd|et"
    .OnAction = "Prepocet"
  End With
  
Set poloz3 = menugr.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz3.Caption = "V|fffd|sl&edky"
  Set poloz31 = poloz3.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz31
    .Caption = "&Tabulka CF"
    .OnAction = "ZobrazTabCF"
  End With
  Set poloz32 = poloz3.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz32
    .Caption = "Hodnoty &krit|fffd|ri|fffd|"
    .OnAction = "ZobrazKrit"
  End With
    
Set poloz4 = menugr.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz4.Caption = "&Grafy"
  Set poloz41 = poloz4.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz41
    .Caption = "&Cash flow"
    .OnAction = "ZobrazGrafCF"
  End With
  Set poloz42 = poloz4.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz42
    .Caption = "&Diskontovan|fffd| cash flow"
    .OnAction = "ZobrazGrafDCF"
  End With
  Set poloz43 = poloz4.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz43
    .Caption = "Citlivostn|fffd| &anal|fffd|za"
    .OnAction = "ZobrazCitlAn"
  End With
  
Set poloz5 = menugr.Controls.Add(Type:=msoControlPopup, Id:=1)
  poloz5.Caption = "&Citlivostn|fffd| anal|fffd|za"
  Set poloz51 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz51
    .Caption = "&Nastaven|fffd|"
    .OnAction = "CitlAnalyza"
  End With
  Set poloz52 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz52
    .Caption = "&Graf"
    .OnAction = "ZobrazCitlan"
  End With
  Set poloz53 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz53
    .Caption = "&Tabulka"
    .OnAction = "ZobrazTabCitlAn"
  End With
  Set poloz54 = poloz5.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz54
    .Caption = "&Minim|fffd|ln|fffd| cena"
    .OnAction = "CenaNPV"
  End With
  
Set poloz6 = menugr.Controls.Add(Type:=msoControlPopup, Id:=1)
  With poloz6
  poloz6.Caption = "&Sloupec"
  poloz6.BeginGroup = True
  poloz6.Enabled = False
  End With

Set poloz7 = menugr.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz7
    .Caption = "&N|fffd|pov|fffd|da"
    .OnAction = "MujHelp"
    .BeginGroup = True
  End With
  
Set poloz8 = menugr.Controls.Add(Type:=msoControlButton, Id:=1)
  With poloz8
    .Caption = "&O programu"
    .OnAction = "OProgramu"
  End With
  
Application.OnKey "{F1}", "MujHelp"

End Sub

Sub OdstranMenu()
Application.CommandBars.ActiveMenuBar.Reset
Application.OnKey "%{F8}"
Application.OnKey "{F1}"
End Sub

Sub OProgramu()
FormUvod.Show
End Sub

Sub StandardniSloupec()
Selection.ColumnWidth = 8.43
End Sub

Sub PrizpusobSloupec()
Selection.Columns.AutoFit
End Sub

Sub ZuzitSloupec()
Dim pocrad As Double
For Each Row In Selection
  pocrad = pocrad + 1
Next Row
If pocrad < 8192 Then
  For Each Column In Selection
    Column.ColumnWidth = Column.ColumnWidth / 1.2
  Next Column
Else ' pracuje pouze s jednou aktivni bunkou ve vyberu
  ActiveSheet.Columns(ActiveCell.Column).ColumnWidth = ActiveSheet.Columns(ActiveCell.Column).ColumnWidth / 1.2
End If
End Sub

Sub RozsirSloupec()
Dim pocrad As Double
For Each Row In Selection
  pocrad = pocrad + 1
Next Row
If pocrad < 8192 Then
  For Each Column In Selection
    Column.ColumnWidth = Column.ColumnWidth * 1.2
  Next Column
Else  ' pracuje pouze s jednou aktivni bunkou ve vyberu
ActiveSheet.Columns(ActiveCell.Column).ColumnWidth = 1.2 * ActiveSheet.Columns(ActiveCell.Column).ColumnWidth
End If
End Sub

Sub ZobrazTabCitlAn()
ActiveWorkbook.Sheets("Citl. anal|fffd|za").Activate
ActiveSheet.Cells(1, 1).Activate
ActiveWindow.SmallScroll down:=2
End Sub

Sub ZobrazCitlAn()
ActiveWorkbook.Sheets("Citl. anal|fffd|za").Activate
ActiveSheet.Cells(1, 1).Activate
End Sub

Sub ZobrazGrafDCF()
ActiveWorkbook.Sheets("Graf DCF").Activate
End Sub

Sub ZobrazGrafCF()
Application.ScreenUpdating = False
ActiveWorkbook.Sheets("Graf CF").Activate
Application.ScreenUpdating = True
End Sub

Sub ZobrazKrit()
ActiveWorkbook.Sheets("V|fffd|sledky").Activate
ActiveSheet.Cells(1, 1).Activate
ActiveWindow.SmallScroll down:=25
ActiveSheet.Range("a26").Select
End Sub

Sub ZobrazTabCF()
ActiveWorkbook.Sheets("V|fffd|sledky").Activate
ActiveSheet.Cells(1, 1).Activate
Range("a1").Select
End Sub

Sub ZobrazListVstupy()
ActiveWorkbook.Sheets("Vstupy").Activate
ActiveSheet.Range("a1").Select
End Sub

Sub NaklNaVstupu()
ActiveWorkbook.Sheets("Vstupy").Activate
ActiveSheet.Cells(1, 1).Activate
ActiveWindow.SmallScroll down:=29
Range("a30").Select
End Sub

Sub MujHelp()
ActDir = ActiveWorkbook.Path & "\"
Application.Help ActDir & "efekt.hlp", 0
End Sub

Sub PrazdnySoubor() ' sma|fffd|e v|fffd|echny hodnoty
Set vst = Worksheets("Vstupy")
Set vyst = Worksheets("V|fffd|sledky")
Set prop = Worksheets("Propo|fffd|ty")
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")

prop.Range(prop.Cells(1, 5), prop.Cells(1, 255)).Clear
prop.Range(prop.Cells(3, 7), prop.Cells(10, 255)).Clear  'vynosy
prop.Range(prop.Cells(13, 7), prop.Cells(24, 255)).Clear 'naklady
prop.Range(prop.Cells(25, 3), prop.Cells(26, 255)).Clear 'investice
prop.Range(prop.Cells(33, 3), prop.Cells(39, 255)).Clear 'uc. odpisy a neodepisovana castka
prop.Range(prop.Cells(27, 3), prop.Cells(32, 255)).Clear 'dan. odpisy
prop.Range(prop.Cells(41, 3), prop.Cells(44, 255)).Clear 'uver
prop.Range(prop.Cells(45, 4), prop.Cells(46, 255)).Clear 'dane
prop.Range(prop.Cells(48, 4), prop.Cells(52, 255)).Clear 'CF
prop.Range(prop.Cells(53, 5), prop.Cells(54, 255)).Clear 'doba splaceni
prop.Range(prop.Cells(66, 5), prop.Cells(69, 255)).Clear 'rozpousteni dan. ztraty

vyst.Range(vyst.Cells(4, 4), vyst.Cells(26, 255)).Clear 'vysledky

vst.Range("b1:g1").ClearContents
vst.Range("b3").Value = inic.Range("b2").Value
vst.Range("c3").Value = Year(Date) + 1
vst.Range("e3").ClearContents
vst.Range("c5").Value = inic.Range("b2").Value
vst.Range("d5").Value = Year(Date)
vst.Range("c7:c9").ClearContents
vst.Range("c11").ClearContents
vst.Range("e11").ClearContents
vst.Range("b13").ClearContents
vst.Range("c14") = "'1."
vst.Range("d14") = "'2."
vst.Range("e14") = "'3."
vst.Range("f14") = "'4."
vst.Range("g14") = "'5."
vst.Range("h14") = "'6."
vst.Range("c15:i15").ClearContents
vst.Range("c16:h16").ClearContents
vst.Range("a16").Value = True
vst.Range("a17").Value = False
vst.Range("a15").ClearContents
vst.Range("a18").Value = inic.Range("b22").Value
vst.Range("b19").ClearContents
vst.Range("c20:c22").ClearContents
vst.Range("e20").ClearContents
vst.Range("b24").Value = inic.Range("b20").Value
vst.Range("b25").Value = inic.Range("b1").Value
vst.Range("e24").Value = vst.Range("c3").Value
vst.Range("a32").Value = "palivo1"
vst.Range("a33").Value = "jednotka"
vst.Range("c32:d33").ClearContents
vst.Range("e32").Value = 0
vst.Range("e33").Value = 0.02
vst.Range("a35").Value = "palivo2"
vst.Range("a36").Value = "jednotka"
vst.Range("c35:d36").ClearContents
vst.Range("e35").Value = 0
vst.Range("e36").Value = 0.02
vst.Range("a38").Value = "osobn|fffd| n|fffd|klady"
vst.Range("a39").Value = "opravy a |fffd|dr|fffd|ba"
vst.Range("a40").Value = "ostatn|fffd| n|fffd|klady"
vst.Range("a41").Value = "poplatky a dan|fffd|"
vst.Range("a42").Value = "emisn|fffd| poplatky"
vst.Range("c38:d42").ClearContents
vst.Range("e38:e42").Value = 0.02
vst.Range("a47").Value = "produkce1"
vst.Range("a48").Value = "jednotka"
vst.Range("c47:d48").ClearContents
vst.Range("e47").Value = 0
vst.Range("e48").Value = 0.02
vst.Range("a50").Value = "produkce2"
vst.Range("a51").Value = "jednotka"
vst.Range("c50:d51").ClearContents
vst.Range("e50").Value = 0
vst.Range("e51").Value = 0.02
vst.Range("c53:d53").ClearContents
vst.Range("e53").Value = 0.02

can.Range("b7:c17").ClearContents
can.Range("a4").ClearContents
FormCitlAn.Show
can.Range("a4").Value = FormCitlAn.CBMenHodn.Value
can.Range("e4").Value = FormCitlAn.CBHodnKrit.Value
FormCitlAn.Hide
UpravGrafCA

vyst.Activate
With ActiveWindow
  .DisplayGridlines = False
  .DisplayHeadings = False
End With
vyst.Range("a1").Select
prop.Activate
ActiveWindow.DisplayHeadings = True
prop.Range("a1").Select
can.Activate
With ActiveWindow
  .DisplayGridlines = False
  .DisplayHeadings = False
End With
can.Range("a1").Select
vst.Activate
With ActiveWindow
  .DisplayGridlines = False
  .DisplayHeadings = False
End With
vst.Range("a1").Select

For Each cx In ActiveWorkbook.Sheets
  cx.Protect UserInterfaceOnly:=True
Next cx
    
inic.Visible = xlSheetVeryHidden
ActiveWorkbook.Save
ActiveWorkbook.Saved = True

End Sub
Attribute VB_Name = "ModProp"
Public i As Byte
Dim sloupec As Integer  'reseni, aby se nemazaly vzorce na listu Propocty
Public storno As Boolean  'indikator stisteni storno pri opusteni formvstup

Sub VlozRoky()
sloupec = 3 + dobaz + i - 1
If sloupec < 4 Then sloupec = 4
prop.Range(prop.Cells(1, sloupec + 1), prop.Cells(1, 255)).Clear
prop.Range("d1").Copy prop.Range(prop.Cells(1, 5), prop.Cells(1, sloupec))
End Sub

Sub PropVynosy()
prop.Range(prop.Cells(3, 7), prop.Cells(10, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 6 Then sloupec = 6
prop.Range("f3:f10").Copy prop.Range(prop.Cells(3, 7), prop.Cells(10, sloupec))
End Sub

Sub PropNakl()
prop.Range(prop.Cells(13, 7), prop.Cells(24, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 6 Then sloupec = 6
prop.Range("f13:f24").Copy prop.Range(prop.Cells(13, 7), prop.Cells(24, sloupec))
End Sub

Sub Investice()
Dim pom1 As Integer
Dim pom2 As Integer
Dim obn As Integer
Dim castka As Double

prop.Range(prop.Cells(25, 3), prop.Cells(26, 255)).Clear
If vst.Range("c3") - vst.Range("d5") > 0 Then
  prop.Range("c26") = vst.Range("c7")
  prop.Range("d26") = vst.Range("c8")
Else
  prop.Range("c26") = vst.Range("c8")
End If
If dobaz < 1 Then sloupec = 1 Else sloupec = 0 'posun pouze v nasledujicim prikaze
If vst.Range("a17").Value = True Then prop.Cells(25, dobaz + i + 3 + sloupec) = "Z|fffd|st. hodnota"
For pom1 = 0 To 4
  obn = vst.Cells(16, 3 + pom1)
  castka = vst.Cells(15, 3 + pom1) 'castka vynalozena na obnovu
  If obn > 0 Then
    For pom2 = obn To dobaz - 1 Step obn
      prop.Cells(26, 3 + pom2 + i) = prop.Cells(26, 3 + pom2 + i) + castka
    Next pom2
  End If
Next pom1
End Sub

Sub ZustatHodn(rad As Integer, sloup As Integer)
Dim pom As Integer
pom = 1
While prop.Cells(rad, sloup + pom) > 0
  prop.Cells(rad, sloup) = prop.Cells(rad, sloup) + prop.Cells(rad, sloup + pom)
  prop.Cells(rad, sloup + pom).Clear
  pom = pom + 1
Wend
End Sub

Sub UcOdpisy()
Dim dobn As Integer  'doba obnovy
Dim castka As Double 'castka v dane odp. tride
Dim odp As Double    'velikost odpisu
Dim radek As Byte
Dim ti As Integer    'index roku odepisovani v ramci cyklu obnovy
Dim rok As Integer
Dim mesic As Integer
Dim proci As Double
Dim pomoc As Double
Dim zh As Double

prop.Range(prop.Cells(33, 3), prop.Cells(39, 255)).Clear ' mazani i jedne radky pod
mesic = vst.Range("b4") 'mesic provozu
zh = 0
For radek = 1 To 6
  rok = 1
  pomoc = vst.Cells(15, 2 + radek)
  dobn = vst.Cells(16, 2 + radek)
  While pomoc > 0 And rok < dobaz
    If (vst.Range("c10") - vst.Range("c11")) <> 0 Then
      proci = pomoc / (vst.Range("c10") - vst.Range("c11"))
    Else
      ' o|fffd|et|fffd|en|fffd| d|fffd|len|fffd| nulou
      proci = 0
    End If
    castka = proci * vst.Range("c10")
    For ti = 0 To dobn
      If ti = 0 Then  'odpis 1.rok dle mesice uvedeni do provozu
        odp = castka * (12 - mesic + 1) / (12 * dobn)
        prop.Cells(32 + radek, 2 + rok + i) = prop.Cells(32 + radek, 2 + rok + i) + odp
      Else
        If ti <> dobn Then 'odpisy za cely rok
          odp = castka / dobn
        Else  'posledni odpis dle mesice uvedeni do provozu
          odp = castka * (mesic - 1) / (12 * dobn)
        End If
        prop.Cells(32 + radek, 2 + i + rok + ti) = odp
      End If
    Next ti
    rok = rok + dobn
  Wend
  If vst.Range("a17").Value = True Then
    ZustatHodn 32 + radek, 3 + i + dobaz
    zh = zh + prop.Cells(32 + radek, 3 + i + dobaz)
  End If
Next radek
If vst.Range("a17").Value = True Then
  prop.Cells(32 + radek, 3 + i + dobaz) = vst.Range("i15")
  zh = zh + vst.Range("i15")
End If
'If vst.Range("a17").Value = True And vst.Range("a16").Value = False Then 'zust. hodnota je stanovena explicitne
'  prop.Cells(32 + radek, 3 + i + dobaz) = zh - vst.Range("a15")
'  prop.Range(prop.Cells(33, 3 + i + dobaz), prop.Cells(38, 255)).Clear
'End If
If vst.Range("a17").Value = False Then prop.Range(prop.Cells(33, 3 + i + dobaz), prop.Cells(39, 255)).Clear
End Sub

Sub DanOdpisy(typ As Byte)
Dim dobn As Integer
Dim dodp As Integer
Dim castka As Double
Dim odp As Double
Dim ti As Integer
Dim rok As Integer
Dim trida As Byte

prop.Range(prop.Cells(27, 3), prop.Cells(32, 255)).Clear
If typ <> 0 Then 'typ=0 znamena nepocitat danove odpisy -> jdi na konec
  For trida = 1 To 6
    castka = vst.Cells(15, 2 + trida)
    dobn = vst.Cells(16, 2 + trida)
    dodp = inic.Cells(trida, 6)
    rok = 0
    While (rok < dobaz) And (castka > 0)
      If typ = 1 Then 'zrychlene odpisy
        odp = castka / dodp
        prop.Cells(26 + trida, 3 + i + rok) = odp
        If dobn >= dodp Then
          For ti = 2 To dodp
            odp = 2 * castka * (dodp + 1 - ti) / (dodp ^ 2)
            prop.Cells(26 + trida, 3 + i + rok + ti - 1) = odp
          Next ti
        Else
          For ti = 2 To dobn
            odp = 2 * castka * (dodp + 1 - ti) / (dodp ^ 2)
            prop.Cells(26 + trida, 3 + i + rok + ti - 1) = odp
          Next ti
          For ti = dobn + 1 To dodp
            odp = 2 * castka * (dodp + 1 - ti) / (dodp ^ 2)
            prop.Cells(26 + trida, 3 + i + rok + dobn - 1) = prop.Cells(26 + trida, 3 + i + rok + dobn - 1) + odp
          Next ti
        End If
      Else  'typ = 2 znamena rovnomerne odpisy
        odp = castka / (2 * dodp - 1)
        prop.Cells(26 + trida, 3 + i + rok) = odp
        If dobn >= dodp Then
          For ti = 2 To dodp
            odp = 2 * castka / (2 * dodp - 1)
            prop.Cells(26 + trida, 3 + i + rok + ti - 1) = odp
          Next ti
        Else
          For ti = 2 To dobn
            odp = 2 * castka / (2 * dodp - 1)
            prop.Cells(26 + trida, 3 + i + rok + ti - 1) = odp
          Next ti
          For ti = dobn + 1 To dodp
            odp = 2 * castka / (2 * dodp - 1)
            prop.Cells(26 + trida, 3 + i + rok + dobn - 1) = prop.Cells(26 + trida, 3 + i + rok + dobn - 1) + odp
          Next ti
        End If
      End If
    rok = rok + dobn
    Wend
    If vst.Range("a17").Value = True Then ZustatHodn 26 + trida, 3 + i + dobaz
  Next trida
  If vst.Range("a17").Value = False Then prop.Range(prop.Cells(27, 3 + i + dobaz), prop.Cells(32, 255)).Clear
End If
End Sub

Sub PropUver()
Dim doba As Byte
Dim castka As Double
Dim sazba As Double
Dim ti As Byte
Dim urok As Double
Dim umor As Double
Dim splatka As Double
Dim mesic As Integer

prop.Range(prop.Cells(41, 3), prop.Cells(44, 255)).Clear
sazba = vst.Range("c21") / 100
doba = vst.Range("c22")
castka = vst.Range("e20")
mesic = vst.Range("c6")
mesicuv = vst.Range("b4")
'zacatek uprav provozni/investicni upravy ze dne 9.11.2004
If vst.Range("a21") = True Then
  prop.Range("c41") = vst.Range("c7") * vst.Range("C20") / 100 * sazba * (12 - mesic + 1) / 12
  prop.Range("d41") = castka * sazba * (mesicuv - 1) / 12
  prop.Range("d44") = castka * sazba * (12 - mesicuv + 1) / 12
Else
  prop.Range("c44") = vst.Range("c7") * vst.Range("C20") / 100 * sazba * (12 - mesic + 1) / 12
  prop.Range("d44") = castka * sazba
  '(castka * sazba * (12 - mesicuv + 1) / 12) + (castka * sazba * (mesicuv - 1) / 12)
End If

'If vst.Range("c7") > 0 Then 'uroky po dobu investovani (investicni i provozni)
'  prop.Range("c41") = vst.Range("c7") * vst.Range("C20") / 100 * sazba * (12 - mesic + 1) / 12
'  prop.Range("d41") = castka * sazba * (mesicuv - 1) / 12
'  prop.Range("d44") = castka * sazba * (12 - mesicuv + 1) / 12
'Else
'  If vst.Range("C3") = vst.Range("D5") Then
'    prop.Range("c41") = castka * sazba * (mesicuv - mesic) / 12
'    prop.Range("c44") = castka * sazba * (12 - mesicuv + 1) / 12
'  End If
'End If
'konec uprav provozni/investicni upravy ze dne 9.11.2004

If vst.Range("b19") = "Konstantn|fffd| |fffd|mor" Then
  If doba = 0 Then
    umor = castka
  Else
    umor = castka / doba
  End If
  For ti = 1 To doba
    urok = castka * sazba
    prop.Cells(44, 3 + i + ti) = urok
    prop.Cells(42, 3 + i + ti) = umor
    prop.Cells(43, 3 + i + ti) = umor + urok
    castka = castka - umor
  Next ti
Else   'konstantni splatka = anuitn|fffd| spl|fffd|cen|fffd|
  If doba > 0 Then
    If sazba = 0 Then
      splatka = castka / doba
    Else
      splatka = (sazba * ((1 + sazba) ^ doba)) / (((1 + sazba) ^ doba) - 1) * castka
    End If
  Else
    splatka = castka
  End If
  For ti = 1 To doba
    urok = castka * sazba
    umor = splatka - urok
    prop.Cells(44, 3 + i + ti) = urok
    prop.Cells(42, 3 + i + ti) = umor
    prop.Cells(43, 3 + i + ti) = umor + urok
    castka = castka - umor
  Next ti
End If
End Sub

Sub PropUver_1()
Dim doba As Byte
Dim castka As Double
Dim sazba As Double
Dim ti As Byte
Dim urok As Double
Dim umor As Double
Dim splatka As Double
Dim mesic As Integer

prop.Range(prop.Cells(41, 3), prop.Cells(44, 255)).Clear
sazba = vst.Range("c21") / 100
doba = vst.Range("c22")
castka = vst.Range("e20")
mesic = vst.Range("c6")
mesicuv = vst.Range("b4")
If vst.Range("c7") > 0 Then 'uroky po dobu investovani (investicni i provozni)
  prop.Range("c41") = vst.Range("c7") * vst.Range("C20") / 100 * sazba * (12 - mesic + 1) / 12
  prop.Range("d41") = castka * sazba * (mesicuv - 1) / 12
  prop.Range("d44") = castka * sazba * (12 - mesicuv + 1) / 12
Else
  If vst.Range("C3") = vst.Range("D5") Then
    prop.Range("c41") = castka * sazba * (mesicuv - mesic) / 12
    prop.Range("c44") = castka * sazba * (12 - mesicuv + 1) / 12
  End If
End If
If vst.Range("b19") = "Konstantn|fffd| |fffd|mor" Then
  If doba = 0 Then
    umor = castka
  Else
    umor = castka / doba
  End If
  For ti = 1 To doba
    urok = castka * sazba
    prop.Cells(44, 3 + i + ti) = urok
    prop.Cells(42, 3 + i + ti) = umor
    prop.Cells(43, 3 + i + ti) = umor + urok
    castka = castka - umor
  Next ti
Else   'konstantni splatka = anuitn|fffd| spl|fffd|cen|fffd|
  If doba > 0 Then
    If sazba = 0 Then
      splatka = castka / doba
    Else
      splatka = (sazba * ((1 + sazba) ^ doba)) / (((1 + sazba) ^ doba) - 1) * castka
    End If
  Else
    splatka = castka
  End If
  For ti = 1 To doba
    urok = castka * sazba
    umor = splatka - urok
    prop.Cells(44, 3 + i + ti) = urok
    prop.Cells(42, 3 + i + ti) = umor
    prop.Cells(43, 3 + i + ti) = umor + urok
    castka = castka - umor
  Next ti
End If
End Sub

Sub PropDane()
'Dim ti As Byte
prop.Range(prop.Cells(45, 4), prop.Cells(46, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 4 Then sloupec = 4
prop.Range("c45:c46").Copy prop.Range(prop.Cells(45, 4), prop.Cells(46, sloupec))
End Sub

Sub CashFlow()
prop.Range(prop.Cells(48, 4), prop.Cells(52, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 4 Then sloupec = 4
prop.Range("c48:c52").Copy prop.Range(prop.Cells(48, 4), prop.Cells(52, sloupec))
prop.Range(prop.Cells(66, 5), prop.Cells(69, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 5 Then sloupec = 5
prop.Range("d66:d69").Copy prop.Range(prop.Cells(66, 5), prop.Cells(69, sloupec))
End Sub

Sub DobaSplaceni()
prop.Range(prop.Cells(53, 4), prop.Cells(54, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 5 Then sloupec = 5
prop.Range("d53:d54").Copy prop.Range(prop.Cells(53, 5), prop.Cells(54, sloupec))
'prop.Range("c58").Value = DobaSpl(prop.Range(prop.Cells(47, 3), prop.Cells(47, sloupec)))
'prop.Range("c59").Value = DobaSpl(prop.Range(prop.Cells(50, 3), prop.Cells(50, sloupec)))
End Sub

Sub VlozVysledky()
vyst.Range(vyst.Cells(4, 4), vyst.Cells(26, 255)).Clear
sloupec = 3 + dobaz + i - 1
If sloupec < 4 Then sloupec = 4
vyst.Range(vyst.Cells(4, 3), vyst.Cells(26, 3)).Copy _
  vyst.Range(vyst.Cells(4, 4), vyst.Cells(26, sloupec))
  
End Sub

Sub Grafy()
    sloupec = dobaz + 3 + i - 1
    Sheets("Graf CF").Unprotect
    Sheets("Graf DCF").Unprotect
    If sloupec < 4 Then sloupec = 4
    Sheets("Graf CF").SeriesCollection(1).XValues = "=V|fffd|sledky!R4C3:R4C" & sloupec
    Sheets("Graf CF").SeriesCollection(1).Values = "=V|fffd|sledky!R22C3:R22C" & sloupec
    Sheets("Graf CF").SeriesCollection(2).XValues = "=V|fffd|sledky!R4C3:R4C" & sloupec
    Sheets("Graf CF").SeriesCollection(2).Values = "=V|fffd|sledky!R23C3:R23C" & sloupec

    Sheets("Graf DCF").SeriesCollection(1).XValues = "=V|fffd|sledky!R4C3:R4C" & sloupec
    Sheets("Graf DCF").SeriesCollection(1).Values = "=V|fffd|sledky!R26C3:R26C" & sloupec
    ActiveWorkbook.Sheets("Graf CF").Protect UserInterfaceOnly:=True
    ActiveWorkbook.Sheets("Graf DCF").Protect UserInterfaceOnly:=True
End Sub

Sub Prepocet()
Set vst = Worksheets("Vstupy")
Set vyst = Worksheets("V|fffd|sledky")
Set prop = Worksheets("Propo|fffd|ty")
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")

If formvstupinic = False And IsEmpty(vst.Range("b1")) Then FormVstup.Show
storno = False
If storno And IsEmpty(vst.Range("b1")) Then Exit Sub
oldsb = Application.DisplayStatusBar
Application.DisplayStatusBar = True
Application.StatusBar = "|fffd|ekejte, prob|fffd|h|fffd| v|fffd|po|fffd|et."
dobaz = vst.Range("e3")
i = vst.Range("c3").Value - vst.Range("d5").Value
Application.Calculation = xlCalculationManual
VlozRoky
PropVynosy
PropNakl
Investice
UcOdpisy
If vst.Range("a18").Value = True Then 'odepisovat danove?
    If vst.Range("b13") = "Zrychlen|fffd|" Then DanOdpisy (1) Else DanOdpisy (2)
  Else   'danove neodepisovat
    DanOdpisy (0)
End If

PropUver
PropDane
CashFlow
DobaSplaceni
VlozVysledky
Grafy
For Each cx In ActiveWorkbook.Sheets
  cx.Protect UserInterfaceOnly:=True
Next cx
Application.Calculate
Application.Calculation = xlCalculationAutomatic
vyst.Activate
Application.StatusBar = False
Application.DisplayStatusBar = oldsb
End Sub

Function SumLast(blok As Object, n)
Dim ix As Integer
suma = 0
On Error GoTo konec
'poc = blok.count
poc = Application.WorksheetFunction.count(blok)
'poc = prop.Range(prop.Cells(1, 1), prop.Cells(1, 2)).Columns
If poc <= n Then
  For ix = 1 To poc
    If blok(ix) < 0 Then suma = suma + blok(ix)
  Next ix
Else
  For ix = poc To poc - n + 1 Step -1
    If blok(ix) < 0 Then suma = suma + blok(ix)
  Next ix
End If
konec:
SumLast = suma
End Function

Public Function NaseVal(Vstup As Variant)
If Application.International(xlDecimalSeparator) = "." Or InStr(1, Vstup, ".") <> 0 Then
    NaseVal = Val(Vstup)
Else
    On Error GoTo chyba
    NaseVal = Val(Vstup)
    On Error GoTo 0
End If
Exit Function
chyba:
    NaseVal = 0
    On Error GoTo 0
End Function

Public Function MojeVal(Vstup As Variant)

If Application.International(xlDecimalSeparator) = "." Or InStr(1, Vstup, ".") <> 0 Then
  MojeVal = Val(Vstup)
Else
  If Vstup = "" Then Vstup = 0
  MojeVal = CDbl(Vstup)
End If
End Function

Function DobaSpl(CF As Object)
  Dim pomHodnota As Double
  
  pomHodnota = CF.Cells(1, 1).Value
  If pomHodnota > 0 Then
    hodnoty = 0
  Else
    hodnoty = ""
  End If
  
  For ixx = 2 To CF.Cells.count
    If (CF.Cells(1, ixx) >= 0) And (pomHodnota < 0) And (CF.Cells(1, ixx) <> "") Then
      If hodnoty <> "" Then
        hodnoty = hodnoty & " | " & ixx - 1
      Else
        hodnoty = ixx - 1
      End If
    End If
    pomHodnota = CF.Cells(1, ixx)
  Next ixx
  If hodnoty <> "" Then
    DobaSpl = hodnoty
  Else
    DobaSpl = "Neexistuje!"
  End If
End Function

Attribute VB_Name = "ModVstup"
Public inv As Double
Public inv1 As Double
Public inv2 As Double
Public invu As Double
Public invu1 As Double
Public invu2 As Double
Public invdot As Double
Public dobaz As Integer

Sub VstupHodnot()
Set vst = Worksheets("Vstupy")
Set vyst = Worksheets("V|fffd|sledky")
Set prop = Worksheets("Propo|fffd|ty")
Set inic = Worksheets("Konstanty")
Set can = Worksheets("Citl. anal|fffd|za")

FormVstup.Show

End Sub

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Private Sub Workbook_BeforeClose(Cancel As Boolean)
PriZavreni
Application.EnableCancelKey = xlInterrupt
End Sub

Private Sub Workbook_Open()
Application.EnableCancelKey = xlDisabled
PriOtevreni
End Sub



INQUEST-PP=macro
