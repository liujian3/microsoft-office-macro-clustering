Attribute VB_Name = "Added_Fun"
Option Base 1
' Mantis 004720 |fffd||33d||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||375||fffd|  2011-11-23

Function DmsAvr(Data As RANGE)
   Dim JJ As Integer, Deg() As Double, Total As Double
   Dim Temp() As String, DMS As String
   
   ReDim Deg(Data.Count)
   
    For JJ = 1 To Data.Count
        Temp = Split(Data(JJ), ":")
        
        Deg(JJ) = Abs(Temp(0)) + Temp(1) / 60 + Temp(2) / 3600
        If Left(Temp(0), 1) = "-" Then Deg(JJ) = -Deg(JJ)

        Total = Total + Deg(JJ)
    Next
        DmsAvr = Total / Data.Count
        
        JJ = Application.WorksheetFunction.RoundDown(DmsAvr, 0)
        DMS = JJ & ":"      '-----> Degrees
        
            DmsAvr = (JJ - DmsAvr) * 60   ' 10.3750
            JJ = Application.WorksheetFunction.RoundDown(DmsAvr, 0)                  '--> 0.1729 * 60 = 10.3750  JJ=10
        DMS = DMS & Format(Abs(JJ), "00") & ":"     '----> Minutes
        
             DmsAvr = Abs(Round((JJ - DmsAvr) * 60, 0)) '----> 0.3750 * 60 = 22.5  jj=22.5
        DmsAvr = DMS & Format(DmsAvr, "00") '---> Second
        
End Function

Function DmsSum(Data As RANGE)
   Dim JJ As Integer, Deg() As Double, Total As Double
   Dim Temp() As String, DMS As String
   
   ReDim Deg(Data.Count)
   
    For JJ = 1 To Data.Count
        Temp = Split(Data(JJ), ":")
        
        Deg(JJ) = Abs(Temp(0)) + Temp(1) / 60 + Temp(2) / 3600
        If Left(Temp(0), 1) = "-" Then Deg(JJ) = -Deg(JJ)

        Total = Total + Deg(JJ)
    Next
        DmsSum = Total
        
        JJ = Application.WorksheetFunction.RoundDown(DmsSum, 0)
        DMS = JJ & ":"      '-----> Degrees
        
            DmsSum = (JJ - DmsSum) * 60   ' 10.3750
            JJ = Application.WorksheetFunction.RoundDown(DmsSum, 0)                  '--> 0.1729 * 60 = 10.3750  JJ=10
        DMS = DMS & Format(Abs(JJ), "00") & ":"     '----> Minutes
        
             DmsSum = Abs(Round((JJ - DmsSum) * 60, 0)) '----> 0.3750 * 60 = 22.5  jj=22.5
        DmsSum = DMS & Format(DmsSum, "00") '---> Second
        
End Function


Function DmsMax(Data As RANGE)
   Dim JJ As Integer, Deg() As Double, Total As Double
   Dim Temp() As String, DMS As String
   
   ReDim Deg(Data.Count)
   
    For JJ = 1 To Data.Count
        Temp = Split(Data(JJ), ":")
        
        Deg(JJ) = Abs(Temp(0)) + Temp(1) / 60 + Temp(2) / 3600
        If Left(Temp(0), 1) = "-" Then Deg(JJ) = -Deg(JJ)

        Total = Total + Deg(JJ)
    Next
    
        DmsMax = Application.WorksheetFunction.Max(Deg)
        
        JJ = Application.WorksheetFunction.RoundDown(DmsMax, 0)
        DMS = JJ & ":"      '-----> Degrees
        
            DmsMax = (JJ - DmsMax) * 60   ' 10.3750
            JJ = Application.WorksheetFunction.RoundDown(DmsMax, 0)                 '--> 0.1729 * 60 = 10.3750  JJ=10
        DMS = DMS & Format(Abs(JJ), "00") & ":"     '----> Minutes
        
             DmsMax = Abs(Round((JJ - DmsMax) * 60, 0)) '----> 0.3750 * 60 = 22.5  jj=22.5
        DmsMax = DMS & Format(DmsMax, "00") '---> Second
        
End Function

Function DmsMin(Data As RANGE)
   Dim JJ As Integer, Deg() As Double, Total As Double
   Dim Temp() As String, DMS As String
   
   ReDim Deg(Data.Count)
   
    For JJ = 1 To Data.Count
        Temp = Split(Data(JJ), ":")
        
        Deg(JJ) = Abs(Temp(0)) + Temp(1) / 60 + Temp(2) / 3600
        If Left(Temp(0), 1) = "-" Then Deg(JJ) = -Deg(JJ)

        Total = Total + Deg(JJ)
    Next
    
        DmsMin = Application.WorksheetFunction.Min(Deg)
        
        JJ = Application.WorksheetFunction.RoundDown(DmsMin, 0)
        DMS = JJ & ":"      '-----> Degrees
        
            DmsMin = (JJ - DmsMin) * 60   ' 10.3750
            JJ = Application.WorksheetFunction.RoundDown(DmsMin, 0)                 '--> 0.1729 * 60 = 10.3750  JJ=10
        DMS = DMS & Format(Abs(JJ), "00") & ":"     '----> Minutes
        
             DmsMin = Abs(Round((JJ - DmsMin) * 60, 0)) '----> 0.3750 * 60 = 22.5  jj=22.5
        DmsMin = DMS & Format(DmsMin, "00") '---> Second
        
End Function

Function DmsDeg(Data As RANGE)
   Dim JJ As Integer, Deg() As Double, Total As Double
   Dim Temp() As String, DMS As String
   
   ReDim Deg(Data.Count)
   
   If Data.Count > 1 Then
        MsgBox "Select just one cell, Multi-cell is not supported."
        Exit Function
   End If
   
        Temp = Split(Data(1), ":")
        Deg(1) = Abs(Temp(0)) + Temp(1) / 60 + Temp(2) / 3600
        If Left(Temp(0), 1) = "-" Then Deg(1) = -Deg(1)
        
        DmsDeg = Deg(1)
        
End Function
Attribute VB_Name = "Module1"
Declare Function SHGetPathFromIDList Lib "shell32.dll" Alias "SHGetPathFromIDListA" (ByVal pidl As Long, ByVal pszPath As String) As Long
Declare Function SHBrowseForFolder Lib "shell32.dll" Alias "SHBrowseForFolderA" (lpBrowseInfo As BROWSEINFO) As Long
Declare Function NmrFunc Lib "NmrFunc.dll" (ByVal no As String, ByVal item As String, ByVal path As String, _
                                          ByVal Text As String) As Integer
Declare Function NmrFunc2 Lib "NmrFunc.dll" (ByVal Name As String, ByVal item As String, ByVal path As String, _
                                           ByVal Text As String) As Integer

Type BROWSEINFO
     hOwner As Long
     pidlRoot As Long
     pszDisplayName As String
     lpszTitle As String
     ulFlags As Long
     lpfn As Long
     lParam As Long
     iImage As Long
End Type

Global Response As Integer

Global Const NOERROR = 0
Global Const CSIDL_DESKTOP = &H0 'constants for determining where to browse
Global Const CSIDL_PROGRAMS = &H2
Global Const CSIDL_CONTROLS = &H3
Global Const CSIDL_PRINTERS = &H4
Global Const CSIDL_PERSONAL = &H5
Global Const CSIDL_FAVORITES = &H6
Global Const CSIDL_STARTUP = &H7
Global Const CSIDL_RECENT = &H8
Global Const CSIDL_SENDTO = &H9
Global Const CSIDL_BITBUCKET = &HA
Global Const CSIDL_STARTMENU = &HB
Global Const CSIDL_DESKTOPDIRECTORY = &H10
Global Const CSIDL_DRIVES = &H11
Global Const CSIDL_NETWORK = &H12
Global Const CSIDL_NETHOOD = &H13
Global Const CSIDL_FONTS = &H14
Global Const CSIDL_TEMPLATES = &H15

Global Const BIF_RETURNONLYFSDIRS = &H1
Global Const BIF_DONTGOBELOWDOMAIN = &H2
Global Const BIF_STATUSTEXT = &H4
Global Const BIF_RETURNFSANCESTORS = &H8
Global Const BIF_BROWSEFORCOMPUTER = &H1000
Global Const BIF_BROWSEFORPRINTER = &H2000

Sub Auto_Open()
    If Sheets(1).Visible = True Then
      'Sheets("File_Table").Select
      'range("B2:L1001").Select
      'Selection.ClearContents
      RANGE("A1").Select
      
      Sheets(1).Initialize
      Sheets(1).Select
    End If
End Sub

Function nmr(no As Integer, item As String, path As String)
    Dim ans As Integer, Text As String * 100, folder As String
    Dim Check_A As Double, Check_N As Double
    Dim File_path As String
    File_path = path
    
    Trim (item)
    Trim (path)
    
    'folder = Worksheets("|fffd||2ebb||fffd||7b4||fffd|").TextBox1.Value     Mantis 6297 : 2012-08-20 by lim
    folder = Worksheets(1).TextBox1.Value
    path = folder + "\" + path
    
    '|fffd||2ebb||fffd||7b4||fffd| Combobox|fffd||fffd| |fffd||fffd||fffd||fffd| |f3||fffd||fffd|
    'If Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ComboBox2.ListIndex = 0 Then         Mantis 6297 : 2012-08-20 by lim
    If Worksheets(1).ComboBox2.ListIndex = 0 Then
        If no > 0 And Len(item) > 0 And Len(path) > 0 Then
            ans = NmrFunc(Str(no), item, path, Text)
            Select Case ans
                Case -2:    nmr = " "
                Case -1:    nmr = " "
                Case 0:     nmr = " "
                Case 1:     nmr = Val(Text)
                Case Else:  nmr = Text
            End Select
            
                    If IsNumeric(nmr) = True Then
                        nmr = Val(Text)
                    End If
            
        ElseIf no < 1 Then
            nmr = "No Result"
        ElseIf Len(item) = 0 Then
            nmr = "error"
        Else
            nmr = "No File"
        End If
    End If
    
    
    'If Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ComboBox2.ListIndex = 1 Then             Mantis 6297 : 2012-08-20 by lim
    If Worksheets(1).ComboBox2.ListIndex = 1 Then
        If no > 0 And Len(item) > 0 And Len(path) > 0 Then
            ans = NmrFunc(Str(no), item, path, Text)
            Select Case ans
                Case -2:    nmr = "-"
                Case -1:    nmr = "-"
                Case 0:     nmr = "-"
                Case 1:     nmr = Val(Text)
                Case Else:  nmr = Text
            End Select
            
                    If IsNumeric(nmr) = True Then
                        nmr = Val(Text)
                    End If
            
        ElseIf no < 1 Then
            nmr = "No Result"
        ElseIf Len(item) = 0 Then
            nmr = "error"
        Else
            nmr = "No File"
        End If
    End If
    
    
    'If Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ComboBox2.ListIndex = 2 Then             Mantis 6297 : 2012-08-20 by lim
    If Worksheets(1).ComboBox2.ListIndex = 2 Then
        If no > 0 And Len(item) > 0 And Len(path) > 0 Then
            ans = NmrFunc(Str(no), item, path, Text)
            Select Case ans
                Case -2:    nmr = "No File"
                Case -1:    nmr = "No Result"
                Case 0:     nmr = "Error"
                Case 1:     nmr = Val(Text)
                Case Else:  nmr = Text
            End Select
            
                    If IsNumeric(nmr) = True Then
                        nmr = Val(Text)
                    End If
            
        ElseIf no < 1 Then
            nmr = "No Result"
        ElseIf Len(item) = 0 Then
            nmr = "error"
        Else
            nmr = "No File"
        End If
    End If
    
    
    'NMR |fffd||fffd||fffd||fffd||fffd||37f||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||cfe1| |fffd||fffd||fffd||fffd| |f3||fffd||fffd|(07-03-17 by limhc)
    If nmr = "0" And Mid(item, 1, 1) = "d" Then
    
      path = File_path
    
       Check_A = nmr(no, Right(item, 1), path)
       path = File_path
       Check_N = nmr(no, "n" & Right(item, 1), path)
            
        
       If nmr = (Abs(Check_A) - Abs(Check_N)) Then
          nmr = nmr
        Else
          nmr = (Abs(Check_A) - Abs(Check_N))
        End If
            
    End If
    
End Function

Function Nmr2(Name As String, item As String, path As String)
    Dim ans As Integer, Text As String * 100, folder As String
    Trim (Name)
    Trim (item)
    Trim (path)
    
    'folder = Worksheets("|fffd||2ebb||fffd||7b4||fffd|").TextBox1.Value         Mantis 6297 : 2012-08-20 by lim
    folder = Worksheets(1).TextBox1.Value
    path = folder + "\" + path
    
    'If Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ComboBox2.ListIndex = 0 Then         Mantis 6297 : 2012-08-20 by lim
    If Worksheets(1).ComboBox2.ListIndex = 0 Then
        If Len(Name) > 0 And Len(item) > 0 And Len(path) > 0 Then
            ans = NmrFunc2(Name, item, path, Text)
            Select Case ans
                Case -2:    Nmr2 = " "
                Case -1:    Nmr2 = " "
                Case 0:     Nmr2 = " "
                Case 1:     Nmr2 = Val(Text)
                Case Else:  Nmr2 = Text
            End Select
            
                    If IsNumeric(Nmr2) = True Then
                        Nmr2 = Val(Text)
                    End If
            
        ElseIf no < 1 Then
            Nmr2 = "No Result"
        ElseIf Len(item) = 0 Then
            Nmr2 = "error"
        Else
            Nmr2 = "No File"
        End If
    End If
    
    'If Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ComboBox2.ListIndex = 1 Then         Mantis 6297 : 2012-08-20 by lim
    If Worksheets(1).ComboBox2.ListIndex = 1 Then
        If Len(Name) > 0 And Len(item) > 0 And Len(path) > 0 Then
            ans = NmrFunc2(Name, item, path, Text)
            Select Case ans
                Case -2:    Nmr2 = "-"
                Case -1:    Nmr2 = "-"
                Case 0:     Nmr2 = "-"
                Case 1:     Nmr2 = Val(Text)
                Case Else:  Nmr2 = Text
            End Select
            
                    If IsNumeric(Nmr2) = True Then
                        Nmr2 = Val(Text)
                    End If
            
        ElseIf no < 1 Then
            Nmr2 = "No Result"
        ElseIf Len(item) = 0 Then
            Nmr2 = "error"
        Else
            Nmr2 = "No File"
        End If
    End If

    'If Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ComboBox2.ListIndex = 2 Then         Mantis 6297 : 2012-08-20 by lim
    If Worksheets(1).ComboBox2.ListIndex = 2 Then
        If Len(Name) > 0 And Len(item) > 0 And Len(path) > 0 Then
            ans = NmrFunc2(Name, item, path, Text)
            Select Case ans
                Case -2:    Nmr2 = "No File"
                Case -1:    Nmr2 = "No Result"
                Case 0:     Nmr2 = "Error"
                Case 1:     Nmr2 = Val(Text)
                Case Else:  Nmr2 = Text
            End Select
            
                    If IsNumeric(Nmr2) = True Then
                        Nmr2 = Val(Text)
                    End If
            
        ElseIf no < 1 Then
            Nmr2 = "No Result"
        ElseIf Len(item) = 0 Then
            Nmr2 = "error"
        Else
            Nmr2 = "No File"
        End If
    End If

    'NMR |fffd||fffd||fffd||fffd||fffd||37f||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||cfe1| |fffd||fffd||fffd||fffd| |f3||fffd||fffd|(07-03-17 by limhc)
    If Nmr2 = "0" And Mid(item, 1, 1) = "d" Then
    
      path = File_path
    
       Check_A = Nmr2(Name, Right(item, 1), path)
       path = File_path
       Check_N = Nmr2(Name, "n" & Right(item, 1), path)
            
        
       If Nmr2 = (Abs(Check_A) - Abs(Check_N)) Then
          Nmr2 = Nmr2
        Else
          Nmr2 = (Abs(Check_A) - Abs(Check_N))
        End If
            
    End If

    
End Function

Sub RunList()
    If Worksheets(1).ComboBox1.ListIndex = -1 Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||138||fffd| |fffd||fffd||fffd||fffd||fffd||3fc||fffd||fffd||fffd|."
        Exit Sub
    End If
    
    If Worksheets(1).ListBox2.ListCount = 0 Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6fc||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3fc||fffd||fffd||fffd|."
        Exit Sub
    End If
    
    If Sheets(1).ChkSave.Value Then
        xlsPath = Application.GetSaveAsFilename(0, "Microsoft Excel Files(*.xls),*.xls", 0, "|fffd||fffd||fffd||3ff||fffd||fffd||fffd|", 0)
        If xlsPath = False Then Exit Sub

        ActiveWorkbook.SaveAs Filename:=xlsPath, FileFormat:=xlNormal
    End If
    
    sheet_name = Worksheets(1).ComboBox1.List(Worksheets(1).ComboBox1.ListIndex)
    
    Dim Msg, Style, TitlE, Help, Ctxt, MyString
    
    Msg = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||3fd||f0||fffd||fffd||fffd||fffd||3f1||fffd|?"
    Style = vbYesNo + vbQuestion + vbDefaultButton2
    TitlE = "|fffd||fffd||fffd||fffd|"
    
    Response = vbNo
    If Sheets(1).ChkSave.Value Then
       Response = MsgBox(Msg, Style, TitlE)
    End If
        
    If Sheets(1).OptNmr.Value Then
       Call Sheets("File_Table").WriteFileTable
    Else
       TextProc (sheet_name)
    End If
        
    If Response = vbYes Then
       For i = Sheets.Count To 1 Step -1
           If Sheets(i).Name <> "|fffd||2ebb||fffd||7b4||fffd|" And Sheets(i).Name <> "File_Table" Then
                Sheets(i).Select
                SaveAsProc (Sheets(i).Name)
                'If Sheets("|fffd||2ebb||fffd||7b4||fffd|").ChkSave.Value Then           Mantis 6297 : 2012-08-20 by lim
                If Sheets(1).ChkSave.Value Then
                    ActiveWorkbook.Save
                End If
            End If
        Next i
        For i = Sheets.Count To 1 Step -1
                  If Sheets(i).Name = "|fffd||2ebb||fffd||7b4||fffd|" Or Sheets(i).Name = "File_Table" Then
                      Sheets(i).Visible = False
                  End If
        Next i
    Else
           Sheets(sheet_name).Select
           SaveAsProc (sheet_name)
    
           If Sheets(1).ChkSave.Value Then
               ActiveWorkbook.Save
           End If
    End If
    
    If Worksheets(1).ChkPrint.Value = True Then ActiveSheet.PrintOut
    
End Sub

Sub SaveAsProc(sheet_name As String)
    If Sheets(1).ChkSave.Value Then
        Cells.Select
        Selection.Copy
        Selection.PasteSpecial Paste:=xlValues, Operation:=xlNone, SkipBlanks:=False, Transpose:=False
        Application.CutCopyMode = False
        RANGE("A1").Select
        
        If Response = vbNo Then
            For i = Sheets.Count To 1 Step -1
                  If Sheets(i).Name = "|fffd||2ebb||fffd||7b4||fffd|" Then
                      Sheets(i).Visible = False
                  ElseIf Sheets(i).Name <> sheet_name Then
                      Sheets(i).Cells.Delete
                      Sheets(i).Visible = False
                  End If
            Next i
        End If
    End If
End Sub

Sub TextProc(sheet_name As String)
    If Sheets(1).OptTxt.Value Then
        Sheets(sheet_name).Select
        RANGE("A1").Select
        
        'UserForm1.Show
        Call Txt
        
    End If
End Sub
Function NmrTime(path As String)        'LIMhc ADD FUNCTIONS.
    'NmrTime = Left(FileDateTime(path), 10) '|fffd||fffd||a5|(|fffd||fffd||fffd||fffd|_|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||6fc||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||7f0||fffd|)
    
    NmrTime = FileDateTime(path) 'Mantis 004418  |f3||fffd||fffd|
    
End Function
Function range1(RANGE)

range1 = WorksheetFunction.Max(RANGE) - WorksheetFunction.Min(RANGE)

End Function
Function CP(Data As RANGE, Nom As Double, UpTol As Double, LowTol As Double, Optional GD_T As Integer)
'2009 03-16  |fffd||fffd||fc||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|(lim)
                
    If UpTol = 0 And LowTol = 0 Then
        CP = "Tol=0"
    ElseIf UpTol = LowTol Then
        CP = "Same Tol"
    ElseIf UpTol < LowTol Then
        CP = "UpTol<LowTol"
    Else
    
        If Application.Max(Data) - Application.Min(Data) > 0 And GD_T = 0 Then
            CP = (UpTol - LowTol) / (6 * Application.StDev(Data))
        ElseIf Application.Max(Data) - Application.Min(Data) > 0 And GD_T = 1 Then
            CP = ((UpTol + Nom) - Application.Average(Data)) / (3 * Application.StDev(Data))
        Else
            CP = 0
        End If
    
    End If
    
    If CP < 0 Then
        CP = 0
    End If
    

End Function

Function CPK(Data As RANGE, Nom As Double, UpTol As Double, LowTol As Double, Optional GD_T As Integer)
Dim Temp1 As Double, temp2 As Double, MIDDLE As Double
'2009 03-16  |fffd||fffd||fc||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|(lim)

    If Application.Max(Data) - Application.Min(Data) > 0 Then
    
        If UpTol = 0 And LowTol = 0 Then
            CPK = "Tol=0"
        ElseIf UpTol = LowTol Then
            CPK = "Same Tol"
        ElseIf UpTol < LowTol Then
            CPK = "UpTol<LowTol"
        
        ElseIf GD_T = 1 Then  '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||3f0||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |f3||fffd||fffd|)
            K = (Application.Average(Data) - Nom) / UpTol
                If K < 0 Then
                    K = 1
                End If
            CPK = (1 - K) * ((Abs(UpTol)) / (3 * Application.StDev(Data)))
                    
        Else    '|fffd||fffd||fffd||3f0||fffd||fffd||fffd||fffd||fffd| |fffd||1b4||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||470||fffd| |fffd||fffd||fffd|
            MIDDLE = ((Nom + UpTol) + (Nom + LowTol)) / 2
            LowTol = Abs(MIDDLE - (Nom + LowTol))
            UpTol = Abs((Nom + UpTol) - MIDDLE)
            
                Temp1 = CPL(Data, MIDDLE, -LowTol)
                temp2 = CPU(Data, MIDDLE, UpTol)
            
            CPK = Application.Max(Temp1, temp2)
            
        End If
    Else
        CPK = 0
    End If


If CPK <= 0 Then
    CPK = 0
End If


End Function
Function CPU(Data As RANGE, Nom As Double, UpTol As Double)
'CPK, CPU, CPL |fffd||fffd||fc||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|.(2008_07_10  limhc   |fffd||ec21||fffd||fffd| Over|fffd||fffd| |fffd||fffd||fffd| |f3||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
    
    If Application.Max(Data) - Application.Min(Data) > 0 Then
        If UpTol = 0 Then
            CPU = "Tol=0"
        Else
            'CPU = (Abs(Nom + UpTol - Application.Average(Data))) / (3 * Application.StDev(Data))
            
            K = (Application.Average(Data) - Nom) / UpTol
                If K < 0 Then
                    K = 1
                End If
            CPU = (1 - K) * ((Abs(UpTol)) / (3 * Application.StDev(Data)))
        End If
    Else
       CPU = 0
    End If
        
    If CPU <= 0 Then
        CPU = 0
    End If
    
    
End Function
Function CPL(Data As RANGE, Nom As Double, LowTol As Double)
'CPK, CPU, CPL |fffd||fffd||fc||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|.(2008_07_10  limhc   |fffd||ec21||fffd||fffd| Over|fffd||fffd| |fffd||fffd||fffd| |f3||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)

    If Application.Max(Data) - Application.Min(Data) > 0 Then
        
        If LowTol = 0 Then
            CPL = "Tol=0"
        Else
            'CPL = (Abs(Nom + LowTol - Application.Average(Data))) / (3 * Application.StDev(Data))
            
            K = (Application.Average(Data) - Nom) / LowTol
                If K < 0 Then
                    K = 1
                End If
            CPL = (1 - K) * ((Abs(LowTol)) / (3 * Application.StDev(Data)))
            
        End If
    Else
        CPL = 0
    End If
    
    If CPL <= 0 Then
        CPL = 0
    End If

End Function
'MID RANGE |fffd||fffd||fffd||fffd| |fffd||7f0||fffd||fffd||fffd|. 2010-12-06 limhc, kangmy
'MID RANGE
Function MIDRNG(Data As RANGE)
    Dim D1 As Double, D2 As Double

D1 = Application.WorksheetFunction.Max(Data)
D2 = Application.WorksheetFunction.Min(Data)
MIDRNG = Application.WorksheetFunction.Sum(D1, D2) / 2

End Function
Function Good_or_Not(Data As RANGE, Nominal As Double, UpTol As Double, LowTol As Double, Optional OK_Message As String, Optional NG_Message As String)
    Dim i As Integer, NG_Count As Integer

    For i = 1 To Data.Count
        If Data(i) > Nominal + UpTol Or Data(i) < Nominal + LowTol Then
            NG_Count = NG_Count + 1
        End If
    Next
    
    If OK_Message = "" Then OK_Message = "OK"
    If NG_Message = "" Then NG_Message = "NG"
   
    If NG_Count > 0 Then
        Good_or_Not = NG_Message
    Else
        Good_or_Not = OK_Message
    End If

    '|fffd||570||fffd||fffd||fffd| = (Data.Count - NG_Count / Data.Count) * 100
    '|fffd||fffd||fffd||570||fffd||fffd||fffd| = (NG_Count / Data.Count) * 100
End Function
'|fffd||570||777||fffd|
Function WT(Data As RANGE, Nominal As Double, UpTol As Double, LowTol As Double)
    Dim i As Integer, NG_Count As Integer

    For i = 1 To Data.Count
        If Data(i) > Nominal + UpTol Or Data(i) < Nominal + LowTol Then
            NG_Count = NG_Count + 1
        End If
    Next

    WT = ((Data.Count - NG_Count) / Data.Count) * 100
End Function
'|fffd||fffd||fffd||570||777||fffd|
Function OT(Data As RANGE, Nominal As Double, UpTol As Double, LowTol As Double)
    Dim i As Integer, NG_Count As Integer

    For i = 1 To Data.Count
        If Data(i) > Nominal + UpTol Or Data(i) < Nominal + LowTol Then
            NG_Count = NG_Count + 1
        End If
    Next

    OT = (NG_Count / Data.Count) * 100

End Function
'|fffd||fffd||fffd||47a||fffd||fffd||570||777||fffd|
Function UOT(Data As RANGE, Nominal As Double, UpTol As Double)
    Dim i As Integer, NG_Count As Integer

    For i = 1 To Data.Count
        If Data(i) > Nominal + UpTol Then
            NG_Count = NG_Count + 1
        End If
    Next

    UOT = (NG_Count / Data.Count) * 100

End Function
'|fffd||fffd||fffd||47a||fffd||fffd||570||777||fffd|
Function LOT(Data As RANGE, Nominal As Double, LowTol As Double)
    Dim i As Integer, NG_Count As Integer

    For i = 1 To Data.Count
        If Data(i) < Nominal + LowTol Then
            NG_Count = NG_Count + 1
        End If
    Next

    LOT = (NG_Count / Data.Count) * 100

End Function
'|fffd||4b7||fffd| |fffd||fffd||fffd||fffd|
Function NG_Count(Data As RANGE, Nominal As Double, UpTol As Double, LowTol As Double)
    Dim i As Integer, NG_C As Integer

    For i = 1 To Data.Count
        If Data(i) > Nominal + UpTol Or Data(i) < Nominal + LowTol Then
            NG_C = NG_C + 1
        End If
    Next
            NG_Count = NG_C

End Function
Attribute VB_Name = "Module2"
Public Total As Integer

Sub Txt()
    Dim i As Integer
    Dim folder As String, path As String
    
    For i = 1 To Worksheets(1).ListBox2.ListCount
    
        folder = Worksheets(1).TextBox1.Value
        path = Worksheets(1).ListBox2.List(i - 1)
        path = folder & "\" & path
        
            Call Open_text(path)
            Call arrange
            
            Call Write_cell
        
        'If UserForm1.OptionButton1.Value = True Then       '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
                
        'Else                                                '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
            
        'End If
        
    Next i

End Sub

Sub Open_text(path As String)
    Dim Main As String, Temp As String
    Dim i As Integer
    
    Main = ActiveWorkbook.Name
    'Columns("A:A").Select
    'Selection.ClearContents
    Sheets.Add After:=Sheets(Sheets.Count)

        Workbooks.OpenText Filename:=path, Origin:=949 _
            , StartRow:=1, DataType:=xlDelimited, TextQualifier:=xlDoubleQuote, _
            ConsecutiveDelimiter:=False, Tab:=False, Semicolon:=False, Comma:=False _
            , Space:=False, Other:=False, OtherChar:=" ", FieldInfo:=Array(1, 1), _
            TrailingMinusNumbers:=True
        Columns("A:A").Select
        
        Temp = ActiveWorkbook.Name
        Selection.Copy

        Windows(Main).Activate
        Columns("A:A").Select
        ActiveSheet.Paste
        RANGE("a1").Select
        
        Windows(Temp).Activate
        Application.DisplayAlerts = False
        ActiveWindow.Close
        
        ddd = "DDDD"
        For i = 1 To 25
            If Cells(i, 1) = "" Or ddd = Empty Then
                i = 20
                Columns("A:A").Select
                Selection.SpecialCells(xlCellTypeBlanks).Select
                Selection.Delete Shift:=xlUp
                i = 25
            End If
            i = i + 1: ddd = Cells(i, 1)
        Next i
        
        ActiveSheet.Name = Mid(Temp, 1, Len(Temp) - 4)
        RANGE("A1").Select
    
End Sub

Sub arrange()
    Dim i As Integer

        RANGE("A1").Select
        Selection.End(xlDown).Select
        Total = ActiveCell.Row
        RANGE("A1").Select
    
    For i = 1 To Total
                
        If IsNumeric(Left(Cells(i, 1), 5)) = False Then
                    
            Cells(i, 1).TextToColumns Destination:=Cells(i, 1), DataType:=xlDelimited, _
                TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=True, Tab:=False, _
                Semicolon:=False, Comma:=False, Space:=True, Other:=False, OtherChar _
                :=" ", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
                1), Array(6, 1), Array(7, 1), Array(8, 1)), TrailingMinusNumbers:=True

        Else    'in Case of No.
            Cells(i, 1) = Trim(Left(Cells(i, 1), 5)) & Mid(Cells(i, 1), 6, 100)
        End If

    Next i
    
    With ActiveSheet.RANGE("a1:aa500")
        Set sear = .Find("|fffd||fffd||223|", LookIn:=xlValues)
        If Not sear Is Nothing Then
                sear.Select
                Cells(ActiveCell.Row, 1) = "|fffd||fffd||223|"
                Cells(ActiveCell.Row, 2) = "|fffd||5f8||fffd|"
                Cells(ActiveCell.Row, 3) = "|fffd||fffd||fffd||fffd||fffd||fffd|"
                Cells(ActiveCell.Row, 4) = "|fffd||fffd||fffd||630||fffd|"
                Cells(ActiveCell.Row, 5) = "|fffd||fffd||fffd||470||fffd||fffd||fffd|"
                Cells(ActiveCell.Row, 6) = "|fffd||fffd||fffd||470||fffd||fffd||fffd|"
                Cells(ActiveCell.Row, 7) = "|fffd||fffd||fffd||fffd|"
                Cells(ActiveCell.Row, 8) = "|fffd||fffd||fffd||fffd|"
                
                Cells(ActiveCell.Row, 9) = ""
                Cells(ActiveCell.Row, 10) = ""
                Cells(ActiveCell.Row, 11) = ""
                Cells(ActiveCell.Row, 12) = ""
                
        End If
    End With

    With ActiveSheet.RANGE("a1:aa500")
        Set sear = .Find("-------------------------------------------------------------------------------------------------", LookIn:=xlValues)
        If Not sear Is Nothing Then
                sear.Select
                Cells(ActiveCell.Row, 1) = "----------------------------------------------------------------------"
        End If
    End With

    With ActiveSheet.RANGE("a1:aa500")
        Set sear = .Find("-------------------------------------------------------------------------------------------------", LookIn:=xlValues)
        If Not sear Is Nothing Then
                sear.Select
                Cells(ActiveCell.Row, 1) = "----------------------------------------------------------------------"
        End If
    End With


End Sub


Sub Write_cell()
    Dim i As Integer, j As Integer, Count As Integer
    Dim FName() As String
    
    Total = 20
    
    For i = 1 To Total
        
        If IsNumeric(Left(Cells(i, 1), 1)) And Right(Cells(i, 1), 1) > 0 Then
                 
            Do Until Mid(Cells(i, 1), j + 1, 1) = " ": j = j + 1
            Loop: Count = Count + 1
            ReDim Preserve FName(Count) As String: FName(Count) = Mid(Cells(i, 1), j + 2, 1000): j = 0
        Else
        
        End If
        
    Next i


End Sub



Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "TextBox1, 8, 1, MSForms, TextBox"
Attribute VB_Control = "ListBox1, 9, 2, MSForms, ListBox"
Attribute VB_Control = "cmdSelect, 10, 3, MSForms, CommandButton"
Attribute VB_Control = "CmdSelectAll, 11, 4, MSForms, CommandButton"
Attribute VB_Control = "CmdDelete, 12, 5, MSForms, CommandButton"
Attribute VB_Control = "ListBox2, 13, 6, MSForms, ListBox"
Attribute VB_Control = "ComboBox1, 14, 7, MSForms, ComboBox"
Attribute VB_Control = "CmdRun, 15, 8, MSForms, CommandButton"
Attribute VB_Control = "CmdSearch, 16, 9, MSForms, CommandButton"
Attribute VB_Control = "OptTxt, 17, 10, MSForms, OptionButton"
Attribute VB_Control = "OptNmr, 18, 11, MSForms, OptionButton"
Attribute VB_Control = "CmdClose, 19, 12, MSForms, CommandButton"
Attribute VB_Control = "ChkPrint, 20, 13, MSForms, CheckBox"
Attribute VB_Control = "CmdDeleteAll, 21, 14, MSForms, CommandButton"
Attribute VB_Control = "ChkSave, 24, 15, MSForms, CheckBox"
Attribute VB_Control = "cmdOpen, 25, 16, MSForms, CommandButton"
Attribute VB_Control = "ComboBox2, 30, 17, MSForms, ComboBox"
Attribute VB_Control = "CheckBox1, 29, 18, MSForms, CheckBox"
Sub Initialize()
    Dim path As String, Name As String
    path = ThisWorkbook.path
    
    ListBox1.Clear
    ListBox2.Clear
    'TextBox1.Value = path
    
    ComboBox1.Clear
    ComboBox2.Clear
    
    For i = 1 To Sheets.Count
        Name = Sheets(i).Name
        If Sheets(i).Visible = True And Name <> "|fffd||2ebb||fffd||7b4||fffd|" And Name <> "File_Table" Then
            ComboBox1.AddItem Name
        End If
    Next i
    
    ComboBox2.AddItem "|fffd||fffd||fffd||fffd|"
    ComboBox2.AddItem "-"
    ComboBox2.AddItem "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
    
    'ComboBox1.ListIndex = 2
    ComboBox2.ListIndex = 0
End Sub

Sub WriteFiles()
    Dim array_file(1 To 10000) As String, i As Integer

    ListBox1.Clear
    ListBox2.Clear
    
    ChDrive TextBox1.Value
    ChDir TextBox1.Value
    
    Dim Name As String
    If OptTxt.Value = True Then
        Name = dir("*.txt")
    Else
        Name = dir("*.nmp")
    End If
    
    i = 1
    While Len(Name)
'       ListBox1.AddItem name
        array_file(i) = Name
        i = i + 1
        Name = dir()
    Wend
    
    For j = 1 To i - 1
        If CheckBox1.Value = True Then
            ListBox1.AddItem Trim(array_file(i - j))
        Else
            ListBox1.AddItem Trim(array_file(j))
        End If
    Next j
        
    If ListBox1.ListCount Then ListBox1.ListIndex = 0
End Sub

Private Sub CheckBox1_Click()
    WriteFiles
End Sub

Private Sub CmdSearch_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

End Sub

Private Sub optnmr_Click()
    WriteFiles
End Sub

Private Sub optTxt_Click()
    WriteFiles
End Sub

Private Sub CmdSelect_Click()
    If ListBox1.ListCount = 0 Then Exit Sub
    
    For i = 1 To ListBox1.ListCount
        If ListBox1.Selected(i - 1) Then
            'If Sheets("|fffd||2ebb||fffd||7b4||fffd|").OptNmr.Value Then            Mantis 6297 : 2012-08-20 by lim
            If Sheets(1).OptNmr.Value Then
                ListBox2.AddItem ListBox1.List(i - 1)
            Else
                'ListBox2.AddItem Format(ListBox2.ListCount + 1, "00") + ":  " + ListBox1.List(i - 1)
                '|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||63d||fffd||1ae| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||3f1||fffd| |fffd||fffd||fffd||fffd|.(090129 limhc)
                ListBox2.AddItem ListBox1.List(i - 1)
            End If
            ListBox2.ListIndex = ListBox2.ListCount - 1
        End If
    Next i
    
End Sub

Private Sub CmdSelectAll_Click()
    For i = 1 To ListBox1.ListCount
'        ListBox2.AddItem Format(ListBox2.ListCount + 1, "00") + ":  " + ListBox1.List(i - 1)
        ListBox2.AddItem ListBox1.List(i - 1)
    Next i
    
    If ListBox2.ListCount Then ListBox2.ListIndex = ListBox2.ListCount - 1
End Sub

Private Sub CmdDelete_Click()
    If ListBox2.ListIndex = -1 Then Exit Sub
    j = 0
    For i = 1 To ListBox2.ListCount
        If ListBox2.Selected(i - 1 - j) Then
            ListBox2.RemoveItem (i - 1 - j)
            j = j + 1
        End If
    Next i
End Sub

Private Sub CmdDeleteAll_Click()
    ListBox2.Clear
End Sub

Private Sub cmdSearch_Click()
    WriteFiles
    Dim Name As String, Old As String

        Old = ComboBox1.Text
        ComboBox1.Clear
    For i = 1 To Sheets.Count
        Name = Sheets(i).Name
        If Sheets(i).Visible = True And Name <> "|fffd||2ebb||fffd||7b4||fffd|" And Name <> "File_Table" Then
            ComboBox1.AddItem Name
            If Name = Old Then ComboBox1.Text = Old
        End If
    Next
        
    
End Sub

Private Sub cmdRun_Click()
    RunList
End Sub

Private Sub CmdOpen_Click()
'On Error GoTo OnErrorGoto
'    Dim bi As BROWSEINFO
'    Dim pidl, path As String * 512
'
'    bi.lpszTitle = "|fffd||6fe||fffd| |fffd||fffd||fffd||4e2e| |fffd||fffd||fffd||fffd|"
'    bi.ulFlags = BIF_RETURNONLYFSDIRS
'    pidl = SHBrowseForFolder(bi)
'
'    lResult = SHGetPathFromIDList(ByVal pidl, ByVal path)
'    If lResult Then
'        TextBox1.Value = path
'        WriteFiles
'    End If
'    Exit Sub
'
'OnErrorGoto:
'    MsgBox "BrowseForFolder |fffd||431||fffd| |fffd||fffd||fffd||fffd|"
    
    
'++++++++++++++++++++++++++++++  2012-11-01 Select Folder. Make it more simple.

    On Error Resume Next
    Application.DefaultFilePath = "C:\"
        With Application.FileDialog(msoFileDialogFolderPicker)
            .Show
            TextBox1.Value = .SelectedItems(1)
        End With
    
    Call cmdSearch_Click        '0006885: |fffd||2fb||7f3a||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd|, |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| .nmp |fffd||fffd||fffd||fffd||fffd||375||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||1ae||fffd||fffd| |fffd||fffd||178||fffd||fffd||fffd||fffd| |fffd||2b0||fffd|, |e3||fffd||2e26| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||cfe1||fffd||fffd| |fffd||fffd||178||fffd||fffd|.
 
    
End Sub

Private Sub cmdClose_Click()
On Error GoTo OnErrorGoto
    ActiveWindow.Close
    Exit Sub
    
OnErrorGoto:
    MsgBox "|fffd||771||fffd| |fffd||fffd||fffd||fffd|"
End Sub

Private Sub ListBox1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    CmdSelect_Click
End Sub

Private Sub ListBox1_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    If KeyAscii = vbKeyReturn Or KeyAscii = vbKeySpace Then
        CmdSelect_Click
    End If
End Sub

Private Sub ListBox2_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    CmdDelete_Click
End Sub
Private Sub ListBox2_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
    If KeyAscii = vbKeyReturn Or KeyAscii = vbKeySpace Then
        CmdDelete_Click
    End If
End Sub
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet99"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Sub WriteFileTable()
    Dim folder As String, path  As String
    'folder = Worksheets("|fffd||2ebb||fffd||7b4||fffd|").TextBox1.Value         Mantis 6297 : 2012-08-20 by lim
    folder = Worksheets(1).TextBox1.Value
    
    'For i = 1 To Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ListBox2.ListCount         Mantis 6297 : 2012-08-20 by lim
    For i = 1 To Worksheets(1).ListBox2.ListCount
        'path = Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ListBox2.List(i - 1)         Mantis 6297 : 2012-08-20 by lim
        path = Worksheets(1).ListBox2.List(i - 1)
'        pos = InStr(1, path, " ")
'        path = Mid(path, pos + 2)
        Sheets("File_Table").Cells(i + 1, 2).Value = path
    Next i
        'edited by lim 090201   Delete left old file list
        Sheets("File_Table").RANGE(Cells(i + 1, 2), Cells(i + 1000, 2)).ClearContents
End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "UserForm1"
Attribute VB_Base = "0{B1486359-F647-45BE-B57F-B2F1C810F9BB}{F6AF9F68-5CF2-4C8B-AA22-D8F415EDC6B6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub cmdCancel_Click()
    Sheet1.Activate
    End
End Sub

Private Sub cmdOK_Click()
    Dim folder As String, path As String
    'folder = Worksheets("|fffd||2ebb||fffd||7b4||fffd|").TextBox1.Value         Mantis 6297 : 2012-08-20 by lim
    folder = Worksheets(1).TextBox1.Value
    'path = Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ListBox2.List(Worksheets("|fffd||2ebb||fffd||7b4||fffd|").ListBox2.ListIndex)         Mantis 6297 : 2012-08-20 by lim
    path = Worksheets(1).ListBox2.List(Worksheets(1).ListBox2.ListIndex)
    
    'path = Mid(path, InStr(path, ":") + 3)         : 090123 lim |fffd||fffd||fffd||fffd|
    path = folder & "\" & path
    
    If Not IsValidTxtFile(path) Then
        Sheet1.Activate
        End
    End If
    
    Dim line As Integer
    line = Me.txtLine
    Call WriteTxtFile(path, line, Me.chkBlank.Value)
    
    Unload Me
End Sub

Function IsValidTxtFile(path As String) As Boolean
    Close
    file = FreeFile
    Open path For Input As #file
    
    Line Input #file, Text
    If Mid(Text, 5, 10) <> "----------" Then GoTo OnErrorGoto
        
    
    'Line Input #file, text
    'text = Trim(text)
    'If Len(text) < 4 Or Trim(Left(text, 4)) = " |fffd||fffd||223|" Then GoTo OnErrorGoto
    
    'Line Input #file, text
 '   If Left(text, 1) <> "-" Then GoTo OnErrorGoto
    
    Close
    IsValidTxtFile = True
    Exit Function
    
OnErrorGoto:
    Close
    MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||678||fffd| |fffd||fffd||fffd||fffd||fffd||534||3f4||fffd|.", 48, "|fffd||fffd||fffd||fffd| |fffd||7bc||fffd||fffd||fffd|"
    IsValidTxtFile = False
End Function


Sub WriteTxtFile(path As String, line As Integer, bBlank As Boolean)
    Dim Text As String, Temp(2) As String
    Dim cnt As Integer, TitlE As Boolean

    Close
    file = FreeFile()
    Open path For Input As #file
    
    '---------------------------From here, Edited by lim 090201 for NM 5.x Text file
    Line Input #file, Text
        Temp(1) = Text
        
    Line Input #file, Text
    Line Input #file, Text
        Temp(2) = Text
    
        'Separate title strip
        If Temp(1) = Temp(2) Then   'Without title strip
            TitlE = False
        Else                        'with title strip
            TitlE = True
                Do Until Mid(Text, 5, 10) = "----------"
                    Line Input #file, Text
                Loop
        End If
            
    Line Input #file, Text
    
    If Left(Text, 1) <> "-" Then
        cnt = 0
        Do Until (cnt >= 2)
            Line Input #file, Text
            If Left(Text, 1) = "-" Then cnt = cnt + 1
        Loop
    End If
    
    Do Until EOF(file)
        Line Input #file, Text
        If Len(Text) < 5 Then
            If bBlank Then
                Rows(line).ClearContents
                line = line + 1
            End If
        Else
            Call WriteTxtLine(Text, line)
        End If
    Loop
    
    Rows(Format(line) & ":5000").ClearContents
    Close
End Sub

Sub WriteTxtLine(Text As String, line As Integer)
    Rows(line).ClearContents
    
    buf = Mid(Text, 1, 5)
    If buf <> Space(5) Then
        Cells(line, 1) = Int(buf)
        Cells(line, 2) = Trim(Mid(Text, 6))
    Else
        fc2 = InStr(1, Text, "FC2")
        If fc2 Then
            buf = Trim(Mid(Text, 6, fc2 - 6)):  Cells(line, 2) = buf
            buf = Trim(Mid(Text, fc2)):         Cells(line, 5) = buf
        Else
            buf = Trim(Mid(Text, 6, 12)):   Cells(line, 2) = buf
            buf = Trim(Mid(Text, 18, 12)):  Cells(line, 3) = buf
            buf = Trim(Mid(Text, 30, 12)):  Cells(line, 4) = buf
            buf = Trim(Mid(Text, 42, 12)):  Cells(line, 5) = buf
            buf = Trim(Mid(Text, 54, 12)):  Cells(line, 6) = buf
            buf = Trim(Mid(Text, 66, 12)):  Cells(line, 7) = buf
            buf = Trim(Mid(Text, 78, 12)):  Cells(line, 8) = buf
        End If
    End If
    
    line = line + 1
End Sub


INQUEST-PP=macro
