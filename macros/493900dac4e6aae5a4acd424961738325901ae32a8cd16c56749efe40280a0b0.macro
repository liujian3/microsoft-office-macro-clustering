Attribute VB_Name = "EstaPasta_de_trabalho"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True









Attribute VB_Name = "M|fffd|d11Recib"
Public Recib As Range

Public Sub ReciboVBA()
    NomeArqHist = "Recib.hst"
    Set Recib = Workbooks("cpap_rec.mac").Excel4MacroSheets(1).Range("Recib")
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)    'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, True) Then
        ActiveWindow.Close False
    End If
    ThisWorkbook.Sheets("Recibo").Select
    Application.ScreenUpdating = True
    'Ajuda
    I = InStr(1, Recib(2).Value, "!"): bHtmlHelp = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("bHtmlHelp").Value
    'Com o proj. proteg. essa instru|fffd||fffd|o falha. A solu|fffd||fffd|o foi colocar ..\cpap.hlp nas propriedades e fazer o diret|fffd|rio do cpap ativo.
    'Application.VBE.VBProjects("VBAProjectCxIdent").HelpFile = Left(Recib(2).Value, I - 1)
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDrive ThisWorkbook.Path
    If Mid(ThisWorkbook.Path, 2, 1) = ":" Then ChDir ThisWorkbook.Path Else Application.Run "CPAP_EX8.MAC!DirectoryVBA", ThisWorkbook.Path, False
    UserForm1Recib.HelpContextID = Right(Recib(2).Value, Len(Recib(2).Value) - I)

    UserForm1Recib.UMonet_Cb.Value = Recib(10).Value
    UserForm1Recib.Extenso_Cb.Value = Recib(11).Value
    UserForm1Recib.Principal_Cb.Value = Format(Recib(4).Value, "#,##0.00")
    UserForm1Recib.Corre|fffd||fffd|o_Cb.Value = Format(Recib(5).Value, "#,##0.00")
    UserForm1Recib.Juros_Cb.Value = Format(Recib(6).Value, "#,##0.00")
    UserForm1Recib.Multa_Cb.Value = Format(Recib(7).Value, "#,##0.00")
    UserForm1Recib.JurosComMora_Cb.Value = Format(Recib(8).Value, "#,##0.00")
    UserForm1Recib.Desconto_Cb.Value = Format(Recib(9).Value, "#,##0.00")
    UserForm1Recib.Valor_Cb.Value = Format(Recib(12).Value, "#,##0.00")
    UserForm1Recib.Recebedor_Cb.Value = Recib(14).Value
    UserForm1Recib.CNPJrecebedor_Cb.Value = Recib(15).Value
    UserForm1Recib.Pagador_Cb.Value = Recib(17).Value
    UserForm1Recib.CNPJpagador_Cb.Value = Recib(18).Value
    UserForm1Recib.Referente_Cb.Value = Recib(20).Value
    UserForm1Recib.ReferenteCont_Cb.Value = Recib(22).Value
    UserForm1Recib.Par|fffd|grafoExtra_Cb.Value = Recib(24).Value
    UserForm1Recib.CidadeUf_Cb.Value = Recib(25).Value
    UserForm1Recib.Data_Cb.Value = Format(DateValue(IIf(Len(Recib(26).Value) > 3, Recib(26).Value, Now)), "dd/mm/yy")

    UserForm1Recib.Data_Chb.Value = Len(Recib(26).Value) > 3
    UserForm1Recib.Decompor_Chb.Value = Recib(32).Value
    OcultarExibControles
    vEnableEvents = True    'Application.EnableEvents = True
    Application.ScreenUpdating = True
    Application.StatusBar = False
    UserForm1Recib.Pagador_Cb.SetFocus
    UserForm1Recib.Show
    Application.ScreenUpdating = True
    Recib(1).Value = BotAcionado
    If FecharArq Then Recib(2).Value = "Fechar"
    If BotAcionado = 26 Or BotAcionado = 31 Then
        'Eliminar espa|fffd|os no final de textos
        Application.ScreenUpdating = False
        For Each Ctr In UserForm1Recib.Controls
            If Right(Ctr.Name, 2) = "Cb" Then Ctr.Value = RTrim(Ctr.Value)
        Next

        'Atualizar hist|fffd|rico
        If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
            SalvarHist = False
            AtuHist "UMonet", UserForm1Recib.UMonet_Cb.Value, Recib(10).Value
            AtuHist "Extenso", UserForm1Recib.Extenso_Cb.Value, Recib(11).Value
            AtuHist "Principal", UserForm1Recib.Principal_Cb.Value, Format(Recib(4).Value, "#,##0.00")
            AtuHist "Corre|fffd||fffd|o", UserForm1Recib.Corre|fffd||fffd|o_Cb.Value, Format(Recib(5).Value, "#,##0.00")
            AtuHist "Juros", UserForm1Recib.Juros_Cb.Value, Format(Recib(6).Value, "#,##0.00")
            AtuHist "Multa", UserForm1Recib.Multa_Cb.Value, Format(Recib(7).Value, "#,##0.00")
            AtuHist "JurosComMora", UserForm1Recib.JurosComMora_Cb.Value, Format(Recib(8).Value, "#,##0.00")
            AtuHist "Desconto", UserForm1Recib.Desconto_Cb.Value, Format(Recib(9).Value, "#,##0.00")
            AtuHist "Valor", UserForm1Recib.Valor_Cb.Value, Format(Recib(12).Value, "#,##0.00")
            AtuHist "Recebedor", UserForm1Recib.Recebedor_Cb.Value, Recib(14).Value
            AtuHist "CNPJrecebedor", UserForm1Recib.CNPJrecebedor_Cb.Value, Recib(15).Value
            AtuHist "Pagador", UserForm1Recib.Pagador_Cb.Value, Recib(17).Value
            AtuHist "CNPJpagador", UserForm1Recib.CNPJpagador_Cb.Value, Recib(18).Value
            AtuHist "Referente", UserForm1Recib.Referente_Cb.Value, Recib(20).Value
            AtuHist "ReferenteCont", UserForm1Recib.ReferenteCont_Cb.Value, Recib(22).Value
            AtuHist "Par|fffd|grafoExtra", UserForm1Recib.Par|fffd|grafoExtra_Cb.Value, Recib(24).Value
            AtuHist "CidadeUf", UserForm1Recib.CidadeUf_Cb.Value, Recib(25).Value
            AtuHist "Data", UserForm1Recib.Data_Cb.Value, Format(DateValue(IIf(Len(Recib(26).Value) > 3, Recib(26).Value, Now)), "dd/mm/yy")
            If SalvarHist Then SalvandoHist Else Workbooks(NomeArqHist).Close False
        End If
        'Transferindo dados
        Recib(10).Value = UserForm1Recib.UMonet_Cb.Value
        Recib(11).Value = UserForm1Recib.Extenso_Cb.Value
        Recib(4).Value = CDbl(UserForm1Recib.Principal_Cb.Value)
        Recib(5).Value = CDbl(UserForm1Recib.Corre|fffd||fffd|o_Cb.Value)
        Recib(6).Value = CDbl(UserForm1Recib.Juros_Cb.Value)
        Recib(7).Value = CDbl(UserForm1Recib.Multa_Cb.Value)
        Recib(8).Value = CDbl(UserForm1Recib.JurosComMora_Cb.Value)
        Recib(9).Value = CDbl(UserForm1Recib.Desconto_Cb.Value)
        Recib(12).Value = CDbl(UserForm1Recib.Valor_Cb.Value)
        Recib(14).Value = UserForm1Recib.Recebedor_Cb.Value
        Recib(15).Value = UserForm1Recib.CNPJrecebedor_Cb.Value
        Recib(17).Value = UserForm1Recib.Pagador_Cb.Value
        Recib(18).Value = UserForm1Recib.CNPJpagador_Cb.Value
        Recib(20).Value = UserForm1Recib.Referente_Cb.Value
        Recib(22).Value = UserForm1Recib.ReferenteCont_Cb.Value
        Recib(24).Value = UserForm1Recib.Par|fffd|grafoExtra_Cb.Value
        Recib(25).Value = UserForm1Recib.CidadeUf_Cb.Value
        Recib(26).Value = IIf(UserForm1Recib.Data_Chb.Value, DateValue(UserForm1Recib.Data_Cb.Value), "")
        Recib(32).Value = UserForm1Recib.Decompor_Chb.Value
        Application.ScreenUpdating = False
    End If
    Unload UserForm1Recib
    ThisWorkbook.Saved = True
End Sub

Sub OcultarExibControles()
    With UserForm1Recib
        I = .Decompor_Chb.Value
        .|fffd|cone_img.Visible = Not I
        .Principal_Lb.Visible = I
        .Principal_Cb.Visible = I
        .PrincipalCalculadora_Bt.Visible = I
        .Corre|fffd||fffd|o_Lb.Visible = I
        .Corre|fffd||fffd|o_Cb.Visible = I
        .Corre|fffd||fffd|oCalculadora_Bt.Visible = I
        .Juros_Lb.Visible = I
        .Juros_Cb.Visible = I
        .JurosCalculadora_Bt.Visible = I
        .Multa_Lb.Visible = I
        .Multa_Cb.Visible = I
        .MultaCalculadora_Bt.Visible = I
        .JurosComMora_Lb.Visible = I
        .JurosComMora_Cb.Visible = I
        .JurosComMoraCalculadora_Bt.Visible = I
        .Desconto_Lb.Visible = I
        .Desconto_Cb.Visible = I
        .DescontoCalculadora_Bt.Visible = I

        .Data_Cb.Visible = .Data_Chb.Value
        .Calend_Bt.Visible = .Data_Chb.Value

        On Error Resume Next
        I = .Principal_Cb.Value * 1 + .Corre|fffd||fffd|o_Cb.Value * 1 + .Juros_Cb.Value * 1 + .Multa_Cb.Value * 1 + .JurosComMora_Cb.Value * 1 + .Desconto_Cb.Value * 1
        I = I = .Valor_Cb.Value * 1
        .Calcular_Lb.Visible = Not I And .Decompor_Chb.Value
    End With
End Sub

Function FormatFontCellVBA(vName, vSize, vBold, vUnderline, lStart As Long, lLength As Long) As Boolean
    On Error Resume Next
    With Application.ActiveWindow.ActiveCell.Characters(Start:=lStart, Length:=lLength).Font
        If Not IsMissing(vName) Then .Name = vName
        If Not IsMissing(vSize) Then .Size = vSize
        If Not IsMissing(vBold) Then .Bold = vBold
        If Not IsMissing(vUnderline) Then .Underline = xlUnderlineStyleDouble
    End With
    FormatFontCellVBA = Err.Number = 0
End Function

'    With Selection.Font
'        .Name = "Courier New"
'        .FontStyle = "Bold"
'        .Size = 10
'        .Strikethrough = False
'        .Superscript = False
'        .Subscript = False
'        .OutlineFont = False
'        .Shadow = False
'        .Underline = xlUnderlineStyleNone
'        .ColorIndex = xlAutomatic
'    End With
Attribute VB_Name = "M|fffd|d2Comum"
Public Const MarcHist = "|fffd|Hist|fffd|rico|fffd|"
Public NomeArqHist As String
Public vEnableEvents As Boolean
Public BotAcionado As Variant
Public SalvarHist As Boolean
Public FormatoHist As String
Public HistEditCampo As String
Public vCloseMode As Integer
Public FecharArq As Boolean
Public NmesIndMax As Long: Public bHtmlHelp As Boolean

Sub AtuHist(vCampo As String, ValorCb As String, ValorOrig As String)
    If ValorCb = "" Or ValorCb = ValorOrig Then Exit Sub
    'Verificando exist|fffd|ncia - Sug. Fixas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo)
    j = 0
    For Each C In campo
        j = j + 1
        If j > 1 And IIf(IsError(C.Value), "", C.Value) = ValorCb Then Exit Sub
    Next

    'Verificando exist|fffd|ncia - Sug. Hist|fffd|ricas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist").End(xlDown))
    If campo.Rows.Count > 10000 Then Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist")
    j = 0
    For Each C In campo
        j = j + 1
        If j > 1 And IIf(IsError(C.Value), "", C.Value) = ValorCb Then Exit Sub
    Next
    'Adicionando |fffd| lista de hist|fffd|rico
    campo.Rows(2).Insert Shift:=xlDown
    campo.Rows(2).Value = "'" & ValorCb   'O ap|fffd|strofo arquivo tudo como texto, previnindo erro em caso de f|fffd|rmula e altera no formato de n|fffd|meros pela planilha
    NumM|fffd|x = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist").Offset(-1, 0).Value
    If campo.Rows.Count > NumM|fffd|x Then campo(NumM|fffd|x + 2).ClearContents
    SalvarHist = True
End Sub

Function MyOpenFile(vFileName As String, vReadOnly As Boolean)
    On Error Resume Next
Retry:
    Application.DisplayAlerts = False
    '                                                         bEnableEvents = Application.EnableEvents
    Application.Run "cpap_ex8.mac!EnableEventsVBA", False    'Application.EnableEvents = False
    Set I = Workbooks.Open(Filename:=vFileName, ReadOnly:=vReadOnly, Notify:=False)
    Application.Run "cpap_ex8.mac!EnableEventsVBA", True    'Application.EnableEvents = bEnableEvents

    'Testar integridade. Ver se abre como texto, se n|fffd|o existe o nome DadosHist, se A1&His<>Ahist
    t1 = I.FileFormat = xlCurrentPlatformText
    t2 = I.Sheets(1).Range("DadosHist").Value
    t2 = t2 = Empty
    If t2 = False Then t3 = I.Sheets(1).Range("DadosHist").Offset(1).Value <> I.Sheets(1).Range("A1").Value & "Hist" Else t3 = False
    If t1 Or t2 Or t3 Then I.Close False

    Application.DisplayAlerts = True
    If I.Name = "" Then
        Select Case MsgBox("O arquivo " & vFileName & " contendo o hist|fffd|rico das caixas de inclus|fffd|o n|fffd|o foi encontrado ou est|fffd| corrompido." & Chr(10) & Chr(10) & "Se acionar Ignorar, o arquivo ser|fffd| ignorado e um novo ser|fffd| gerado para iniciar outro hist|fffd|rico.", vbQuestion + vbAbortRetryIgnore + vbDefaultButton2, "CPAP|fffd| - Tentando Abrir Arquivo de Hist|fffd|rico")
        Case Is = vbRetry
            GoTo Retry
        Case Is = vbAbort
            MyOpenFile = False
            Exit Function
        Case Is = vbIgnore
            Application.Workbooks.Add xlWBATWorksheet
            ActiveWorkbook.Names.Add Name:="DadosHist", RefersToR1C1:=Cells(100, 1)
            If Dir(vFileName) <> "" Then Kill vFileName
            ActiveWorkbook.SaveAs vFileName, IIf(Val(Application.Version) >= 12, 56, xlWorkbookNormal)    'xlExcel8 56
            SalvandoHist
            GoTo Retry
        End Select
    End If
    On Error GoTo 0
    If vReadOnly = False And I.ReadOnly Then
        I.Close False
        j = j + 1
        If j < 4 Then
            Application.Wait Now + TimeValue("00:00:01")
            GoTo Retry
        Else
            If MsgBox("O arquivo " & vFileName & " contendo o hist|fffd|rico das caixas de inclus|fffd|o pode estar em uso por outra esta|fffd||fffd|o. Acione OK para continuar tentando ou Cancelar para desistir?", vbQuestion + vbOKCancel, "CPAP|fffd|") = vbOK Then
                GoTo Retry
            Else
                MyOpenFile = False
                Exit Function
            End If
        End If
    End If
    ActiveWorkbook.ActiveSheet.Unprotect "MP542"
    ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos").CurrentRegion.ClearContents
    Set CopyRng = Range("A1").CurrentRegion
    Set PasteRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2

    ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").CurrentRegion.ClearContents
    Set CopyRng = Range("DadosHist").CurrentRegion
    Set PasteRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2
    MyOpenFile = True
End Function

Sub SalvandoHist()
    Workbooks(NomeArqHist).Sheets(1).Range("A1").CurrentRegion.ClearContents
    Set CopyRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos").CurrentRegion
    Set PasteRng = Workbooks(NomeArqHist).Sheets(1).Range("A1")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2

    Workbooks(NomeArqHist).Sheets(1).Range("DadosHist").CurrentRegion.ClearContents
    I = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").Row
    Workbooks(NomeArqHist).Names.Add Name:="DadosHist", RefersToR1C1:=Workbooks(NomeArqHist).Sheets(1).Cells(I, 1)
    Set CopyRng = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").CurrentRegion
    Set PasteRng = Workbooks(NomeArqHist).Sheets(1).Range("DadosHist")
    PasteRng.Resize(CopyRng.Rows.Count, CopyRng.Columns.Count).Value2 = CopyRng.Value2

    Workbooks(NomeArqHist).Activate
    ActiveWorkbook.ActiveSheet.Protect "MP542"
    If Run("cpap_ex8.mac!SaveVBA") Then ActiveWorkbook.Close False
End Sub

Sub ConfHist(vComboBox As Object, vOriginal As String, Optional SemEditSring As Boolean = False, Optional Formato As String)
    I = InStr(1, vComboBox.Name, "_")
    HistEditCampo = Left(vComboBox.Name, I - 1)
    I = MsgBox("OK  -  Configurar sugest|fffd|es fixas e hist|fffd|ricas;" & Chr(10) & Chr(10) & "Cancelar - Restaurar inicial.", vbQuestion + vbOKCancel, "Hist|fffd|rico de Inclus|fffd|es no Campo " & HistEditCampo) = vbOK
    If I Then
        FormatoHist = Formato
        UserFormEditHist.Nova_Bt.Enabled = Not SemEditSring
        UserFormEditHist.SugFixas_Ct.Enabled = Not SemEditSring
        UserFormEditHist.SugHist_Ct.Enabled = Not SemEditSring
        UserFormEditHist.Show
        Unload UserFormEditHist
    End If
    vComboBox.Value = vOriginal
    If I Then ListandoComboBox vComboBox, Formato
    SendKeys "{RIGHT}"
End Sub

Sub ListandoComboBox(vComboBox As Object, Optional Formato As String)
    I = InStr(1, vComboBox.Name, "_")
    vCampo = Left(vComboBox.Name, I - 1)
    'Limpando comboboxes
    While vComboBox.ListCount >= 1
        vComboBox.RemoveItem (0)
    Wend
    'Listando comboboxes - Lista de sug. fixas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo, ThisWorkbook.Sheets(NomeArqHist).Range(vCampo).End(xlDown))
    If campo.Rows.Count < 100 Then
        j = 0
        For Each C In campo
            cf = Format(IIf(IsError(C.Value), "", C.Value), Formato)
            j = j + 1
            If j > 1 Then
                vRep = False
                For I = 1 To vComboBox.ListCount
                    If vComboBox.List(I - 1) = cf Then vRep = True
                Next
                If vRep = False And cf <> "" Then vComboBox.AddItem (cf)
            End If
        Next
    End If
    'Listando comboboxes - Lista de sug. hist|fffd|ricas
    vComboBox.AddItem (MarcHist)
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(vCampo & "Hist").End(xlDown))
    If campo.Rows.Count > 10000 Then Exit Sub
    j = 0
    For Each C In campo
        cf = Format(IIf(IsError(C.Value), "", C.Value), Formato)
        j = j + 1
        If j > 1 Then
            vRep = False
            For I = 1 To vComboBox.ListCount
                If vComboBox.List(I - 1) = cf Then vRep = True
            Next
            If vRep = False And cf <> "" Then vComboBox.AddItem (cf)
        End If
        Application.StatusBar = "Sugest|fffd|es Hist|fffd|ricas em " & vCampo & " " & j & "/" & campo.Rows.Count
    Next
    Application.StatusBar = False
End Sub


'EVENTOS DE CAIXA DE TEXTO PARA VALOR FINANCEIRO

Sub EvValor_Cb_MouseMove(Valor_Cb As Control, ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Valor_Cb.Locked = False
    sd = Application.International(xlDecimalSeparator)
    If Valor_Cb.Text = "0" Or Valor_Cb.Text = "0" & sd & "00" Then
        Valor_Cb.SelStart = 0
        Valor_Cb.SelLength = Len(Valor_Cb.Text)
    End If
End Sub

Sub EvValor_Cb_KeyDown(Valor_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    sd = Application.International(xlDecimalSeparator)
    vKeyCode = IIf(sd = ",", 188, 190)
    Valor_Cb.Locked = False
    If KeyCode = 37 Or (Shift = 2 And KeyCode = 86) Or (Shift = 1 And KeyCode = 45) Or (Shift = 2 And KeyCode = 88) Then Exit Sub   'Seta Esquerda e teclas do clipboard
    If KeyCode = 110 Or KeyCode = 190 Then KeyCode = vKeyCode
    If KeyCode = 188 Then If InStr(1, Valor_Cb.Value, sd) > 0 Then Valor_Cb.Locked = True
    If (KeyCode >= 96 And KeyCode <= 105) _
            Or (KeyCode >= 48 And KeyCode <= 57 And Shift = 0) _
            Or KeyCode = 188 Or KeyCode = 8 Or KeyCode = 46 _
            Or KeyCode = 107 Or (KeyCode = 187 And Shift = 1) _
            Or KeyCode = 109 Or (KeyCode = 189 And Shift = 0) Then Else Valor_Cb.Locked = True
End Sub

Sub EvValor_Cb_Change(Valor_Cb As Control, Optional vAbs As Boolean = False)
    I = Valor_Cb.Value
    j = Valor_Cb.SelStart
    SinNeg = vAbs = False And InStr(1, I, "-") > 0 And InStr(1, I, "+") = 0
    I = Application.WorksheetFunction.Substitute(I, "-", "")
    I = Application.WorksheetFunction.Substitute(I, "+", "")
    PartInt = I
    sd = Application.International(xlDecimalSeparator)
    sm = Application.International(xlThousandsSeparator)
    k = InStr(1, I, sd)
    If k > 0 Then
        PartFrac = Mid(I, k + 1, 100)
        PartFrac = Application.WorksheetFunction.Substitute(PartFrac, sm, "")
        PartInt = Mid(I, 1, k - 1)
        If PartInt = "" Then PartInt = "0"
    End If
    TamPartInt = Len(PartInt)
    PartInt = Application.WorksheetFunction.Substitute(PartInt, sm, "")
    PartInt = Format(PartInt, "#,##0")
    RepCurs = Len(PartInt) - TamPartInt
    vEnableEvents = False
    Valor_Cb.Value = IIf(SinNeg, "-", "") & PartInt & IIf(PartInt = "" Or k = 0, "", sd) & PartFrac
    vEnableEvents = True
    j = -(j + RepCurs) * (j + RepCurs >= 0)
    If Left(Valor_Cb.Value, 2) = "0" & sd And j < 3 Then j = 2
    Valor_Cb.SelStart = j

    'Evita colar texto
    Static ValorOld
    If Valor_Cb.Value <> "" And Valor_Cb.Value <> "-" And Not (IsNumeric(Valor_Cb.Value)) Then
        MsgBox Valor_Cb.Value, vbCritical, "Valor Inv|fffd|lido!"
        Valor_Cb.Value = ValorOld
    Else
        ValorOld = Valor_Cb.Value
    End If
End Sub

Sub EvValor_Cb_Exit(Valor_Cb As Control, Cancel As MSForms.ReturnBoolean, Formato As String)
    If Valor_Cb.Value = "" Then Valor_Cb.Value = 0
    If IsNumeric(Valor_Cb.Value) Then
        If Valor_Cb.Value <> Format(Valor_Cb.Value, Formato) Then Valor_Cb.Value = Format(Valor_Cb.Value, Formato)
    Else
        MsgBox "Data inv|fffd|lida!", vbCritical, "CPAP|fffd|"
        Cancel = True
    End If
End Sub


Sub CalculadoraBtClick(vForm As Object, Valor_Cb As Control, Calculadora_Bt As Control, NumDecim As Integer)
    Calculadora_Bt.SpecialEffect = fmSpecialEffectSunken
    If IsNumeric(Valor_Cb.Value) Then CalculadoraValorIni = IIf(Valor_Cb.Value * 1 = 0, 0, Valor_Cb.Value) Else CalculadoraValorIni = 0
    Workbooks("cpap_pri.mac").Sheets(1).Range("CalcVal").Value = CalculadoraValorIni
    Workbooks("cpap_pri.mac").Sheets(1).Range("CalcDec").Value = NumDecim

    Application.ExecuteExcel4Macro ("cpap_pri.mac!CalcVBA()")

    Valor_Cb.Value = Workbooks("cpap_pri.mac").Sheets(1).Range("CalcVal").Value
    Valor_Cb.SetFocus
    Calculadora_Bt.SpecialEffect = fmSpecialEffectEtched
End Sub



'EVENTOS DE CAIXA DE TEXTO DO CALEND|fffd|RIO

Sub EvCalend_Cb_MouseMove(Data_Cb As Control, ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Data_Cb.Locked = False
End Sub

Sub EvCalend_Cb_KeyDown(Data_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    j = Data_Cb.SelStart
    If KeyCode = 220 Or KeyCode = 191 Then KeyCode = 111   'Trocando \ por /
    If KeyCode = 8 Then KeyCode = 37    'Trocando Backspace por ser a esquerda

    'Setas, teclas do clipboard e /
    If KeyCode = 16 Or KeyCode = 17 _
            Or KeyCode = 37 Or KeyCode = 39 _
            Or (Shift = 2 And KeyCode = 67) _
            Or (Shift = 2 And KeyCode = 86) _
            Or (Shift = 1 And KeyCode = 45) _
            Or (Shift = 2 And KeyCode = 88) _
            Or (KeyCode = 111 And j > 0 And j < 8) Then
        Data_Cb.Locked = False
        Exit Sub
    End If
    If Data_Cb.SelLength > 1 Then Data_Cb.SelStart = j
    If j = 2 Or j = 5 Then Data_Cb.SelStart = j + 1
    Data_Cb.Locked = False
    If (KeyCode >= 96 And KeyCode <= 105) Or (KeyCode >= 48 And KeyCode <= 57 And Shift = 0) Then Else Data_Cb.Locked = True
    If j >= 8 Then Data_Cb.Locked = True
End Sub

Sub EvCalend_Cb_Change(Data_Cb As Control)
    If vEnableEvents = False Then Exit Sub
    I = Data_Cb.Value
    j = Data_Cb.SelStart
    'Eliminando barra dupla
    iSbd = Application.WorksheetFunction.Substitute(I, "//", "/")
    If I <> iSbd Then
        vEnableEvents = False
        Data_Cb.Value = iSbd
        vEnableEvents = True
        j = InStr(1, I, "//")
        Data_Cb.SelStart = j
        Exit Sub
    End If
    'Prevendo e para manter o formato dd/mm/yy, substituir
    If Len(I) > 8 And j > 0 Then
        vEnableEvents = False
        Data_Cb.Value = Left(I, j) & Mid(I, j + 2, 200)
        vEnableEvents = True
        If j = 2 Or j = 5 Then
            Data_Cb.SelStart = j + 1
        Else
            Data_Cb.SelStart = j
        End If
    End If
    'Tentando limitar a parte do dia
    I = Data_Cb.Value
    If Mid(I, 3, 1) = "/" And IsNumeric(Left(I, 2)) Then
        If Left(I, 2) > 31 And Left(I, 2) < 40 Then
            vEnableEvents = False
            Data_Cb.Value = "30" & Mid(I, 3, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 1
        End If
        If Left(I, 2) > 39 Then
            vEnableEvents = False
            Data_Cb.Value = "0" & Left(I, 1) & Mid(I, 3, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 3
        End If
    End If
    'Tentando limitar a parte do m|fffd|s
    If Mid(I, 3, 1) = "/" And Mid(I, 6, 1) = "/" And IsNumeric(Mid(I, 4, 2)) Then
        If Mid(I, 4, 2) > 12 And Mid(I, 4, 2) < 20 Then
            vEnableEvents = False
            Data_Cb.Value = Left(I, 3) & "12" & Mid(I, 6, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 4
        End If
        If Mid(I, 4, 2) > 19 Then
            vEnableEvents = False
            Data_Cb.Value = Left(I, 3) & "0" & Mid(I, 4, 1) & Mid(I, 6, 200)
            vEnableEvents = True
            Data_Cb.SelStart = 6
        End If
    End If
End Sub

Sub EvCalend_Cb_Exit(Data_Cb As Control, ByVal Cancel As MSForms.ReturnBoolean, Optional DataIni As Date)
    If DataIni = 0 Then DataIni = Now
    I = Data_Cb.Value
    If IsDate(I) Then
        If NmesIndMax = 0 Then NmesIndMax = Workbooks("cpap_pri.mac").Excel4MacroSheets(1).Range("NmesIndMax").Value
        If DateValue(I) < DateSerial(1970, 5, 15) Or DateValue(Data_Cb.Value) > DateSerial(1970, 5 + NmesIndMax, 1) Then
            MsgBox "Data inv|fffd|lida. Digite uma data entre " & Format(DateSerial(1970, 5, 15), "dd/mm/yyyy") & " e " & Format(DateSerial(1970, 5 + NmesIndMax, 1), "dd/mm/yyyy") & ".", vbCritical, "CPAP|fffd|"
            Cancel = True
        End If
        If I <> Format(DateValue(I), "dd/mm/yy") Then Data_Cb.Value = Format(DateValue(I), "dd/mm/yy")
    Else
        'Tentando resolver final de m|fffd|s
        z = InStr(1, I, "/")
        If z > 1 Then
            I1 = Left(I, z - 1)
            i2 = Mid(I, z, 250)
            If IsNumeric(I1) Then
                If IsDate(I1 - 1 & i2) Then
                    Data_Cb.Value = Format(DateValue(I1 - 1 & i2), "dd/mm/yy")
                    Exit Sub
                End If
                If IsDate(I1 - 2 & i2) Then
                    Data_Cb.Value = Format(DateValue(I1 - 2 & i2), "dd/mm/yy")
                    Exit Sub
                End If
                If IsDate(I1 - 3 & i2) Then
                    Data_Cb.Value = Format(DateValue(I1 - 3 & i2), "dd/mm/yy")
                    Exit Sub
                End If
            End If
        End If
        If MsgBox("OK  -  Restaurar inicial, " & Format(DataIni, "dd/mm/yy") & ";" & Chr(10) & Chr(10) & "Cancelar - Voltar para alterar.", vbQuestion + vbOKCancel, "Data Inv|fffd|lida!  Campo: " & Left(Data_Cb.Name, InStr(1, Data_Cb.Name, "_") - 1)) = vbOK Then
            Data_Cb.Value = Format(DataIni, "dd/mm/yy")
        Else
            Cancel = True
        End If
    End If
End Sub


Sub CalendBtClick(vForm As Object, Data_Cb As Control, Calend_Bt As Control)
    Calend_Bt.SpecialEffect = fmSpecialEffectSunken
    CalendDataIni = IIf(IsDate(Data_Cb.Value), Data_Cb.Value, Date)
    Workbooks("cpap_pri.mac").Sheets(1).Range("CalendVal").Value = CalendDataIni

    Application.ExecuteExcel4Macro ("cpap_pri.mac!CalendVBA()")

    Data_Cb.Value = Format(Workbooks("cpap_pri.mac").Sheets(1).Range("CalendVal").Value, "dd/mm/yy")
    Data_Cb.SetFocus
    Calend_Bt.SpecialEffect = fmSpecialEffectEtched
End Sub



'EVENTOS DE CAIXA DE TEXTO PARA N|fffd|MERO DE TELEFONE

Sub EvFone_Cb_Change(Fone_Cb As Control)
    I = Fone_Cb.Value
    j = Fone_Cb.SelStart
    k = Len(I)
    I = Application.WorksheetFunction.Substitute(I, ".", "")
    I = Application.WorksheetFunction.Substitute(I, "-", "")
    vEnableEvents = False
    Fone_Cb.Value = IIf(Len(I) > 3, Left(I, 3) & "-" & Mid(I, 4, 20), I)
    If Len(I) > 7 Then Fone_Cb.Value = Left(I, Len(I) + 4 * (Len(I) > 4)) & "-" & Right(I, 4)
    vEnableEvents = True
    If j < k Then Fone_Cb.SelStart = j
End Sub

Sub EvFone_Cb_KeyDown(Fone_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    Fone_Cb.Locked = False
    If KeyCode = 37 Or (Shift = 2 And KeyCode = 86) Or (Shift = 1 And KeyCode = 45) Or (Shift = 2 And KeyCode = 88) Then Exit Sub   'Seta Esquerda e teclas do clipboard
    If KeyCode = 188 Then If InStr(1, Fone_Cb.Value, sd) > 0 Then Fone_Cb.Locked = True
    If (KeyCode >= 96 And KeyCode <= 105) Or (KeyCode >= 48 And KeyCode <= 57 And Shift = 0) Or KeyCode = 188 Or KeyCode = 8 Or KeyCode = 46 Then Else Fone_Cb.Locked = True
End Sub

Sub DesvanecerMesmoPa|fffd|s(Fone_Cb As Control)
    Pa|fffd|sEmpr = Workbooks("Cpap_pri.mac").Excel4MacroSheets(1).Range("Pa|fffd|sEmpr").Value & ""
    Fone_Cb.BackColor = IIf(Fone_Cb.Value = Pa|fffd|sEmpr, &H8000000F, &H80000005)
    Fone_Cb.ForeColor = IIf(Fone_Cb.Value = Pa|fffd|sEmpr, &H80000016, &H80000008)
End Sub

Sub DesvanecerMesmaCid(Fone_Cb As Control)
    CidEmpr = Workbooks("Cpap_pri.mac").Excel4MacroSheets(1).Range("CidEmpr").Value & ""
    Fone_Cb.BackColor = IIf(Fone_Cb.Value = CidEmpr, &H8000000F, &H80000005)
    Fone_Cb.ForeColor = IIf(Fone_Cb.Value = CidEmpr, &H80000016, &H80000008)
End Sub


Attribute VB_Name = "M|fffd|d3VrfCNPJ"

Function DVCGC(CGC As String) As String
    On Error GoTo Err_CGC
    Dim I As Integer   'utilizada nos FOR... NEXT
    Dim strCGC As String   'armazena a parte do CGC entre /0001- ou seja 0001
    Dim strcampo As String   'armazena do CPF que ser|fffd| utilizada para o c|fffd|lculo
    Dim strCaracter As String   'armazena os digitos do CPF da direita para a esquerda
    Dim intNumero As Integer   'armazena o digito separado para c|fffd|lculo (uma a um)
    Dim intMais As Integer   'armazena o digito espec|fffd|fico multiplicado pela sua base
    Dim intSoma As Long   'armazena a soma dos digitos multiplicados pela sua base(intmais)
    Dim intSoma1 As Long   'armazena a soma dos 8 primeiros digitos multiplicados pela sua base(intmais)
    Dim intSoma2 As Long   ''armazena a soma dos 4 ultimos digitos multiplicados pela sua base(intmais)
    Dim dblDivisao As Double   'armazena a divis|fffd|o dos digitos*base por 11
    Dim intInteiro As Long   'armazena inteiro da divis|fffd|o
    Dim intResto As Integer   'armazena o resto
    Dim intDig1 As Integer   'armazena o 1|fffd| digito verificador
    Dim intDig2 As Integer   'armazena o 2|fffd| digito verificador
    Dim strConf As String   'armazena o digito verificador

    intSoma = 0
    intSoma1 = 0
    intSoma2 = 0
    intNumero = 0
    intMais = 0
    'Inicia c|fffd|lculos do 1|fffd| d|fffd|gito
    'Separa os d|fffd|gitos do CGC que ser|fffd|o multiplicados de 2 a 9.
    'Retira a "/" da m|fffd|scara de entrada.
    strCGC = Right(CGC, 7 - 1)   'Tirei 1 ao eliminar o h|fffd|fen
    strCGC = Left(strCGC, 4)
    strcampo = Left(CGC, 8)
    strcampo = Right(strcampo, 4) & strCGC
    For I = 2 To 9
        strCaracter = Right(strcampo, I - 1)
        intNumero = Left(strCaracter, 1)
        intMais = intNumero * I
        intSoma1 = intSoma1 + intMais
    Next I
    'Separa os 4 primeiros d|fffd|gitos do CGC
    strcampo = Left(CGC, 4)
    For I = 2 To 5
        strCaracter = Right(strcampo, I - 1)
        intNumero = Left(strCaracter, 1)
        intMais = intNumero * I
        intSoma2 = intSoma2 + intMais
    Next I
    intSoma = intSoma1 + intSoma2
    dblDivisao = intSoma / 11
    intInteiro = Int(dblDivisao) * 11
    intResto = intSoma - intInteiro
    If intResto = 0 Or intResto = 1 Then
        intDig1 = 0
    Else
        intDig1 = 11 - intResto
    End If
    intSoma = 0
    intSoma1 = 0
    intSoma2 = 0
    intNumero = 0
    intMais = 0
    'Inicia c|fffd|lculos do 2|fffd| d|fffd|gito
    strCGC = Right(CGC, 7 - 1)   'Tirei 1 ao eliminar o h|fffd|fen
    strCGC = Left(strCGC, 4)
    strcampo = Left(CGC, 8)
    strcampo = Right(strcampo, 3) & strCGC & intDig1
    For I = 2 To 9
        strCaracter = Right(strcampo, I - 1)
        intNumero = Left(strCaracter, 1)
        intMais = intNumero * I
        intSoma1 = intSoma1 + intMais
    Next I
    strcampo = Left(CGC, 5)
    For I = 2 To 6
        strCaracter = Right(strcampo, I - 1)
        intNumero = Left(strCaracter, 1)
        intMais = intNumero * I
        intSoma2 = intSoma2 + intMais
    Next I
    intSoma = intSoma1 + intSoma2
    dblDivisao = intSoma / 11
    intInteiro = Int(dblDivisao) * 11
    intResto = intSoma - intInteiro
    If intResto = 0 Or intResto = 1 Then
        intDig2 = 0
    Else
        intDig2 = 11 - intResto
    End If
    strConf = intDig1 & intDig2
    'Caso o CGC esteja errado dispara a mensagem
    If strConf <> Right(CGC, 2) Then
        DVCGC = "False"
    Else
        DVCGC = "True"
    End If
    Exit Function
Exit_CGC:
    Exit Function
Err_CGC:
    '    MsgBox Error$
    DVCGC = "False"   'Eu coloquei
    Resume Exit_CGC
End Function

Function DVCPF(CPF As String) As String
    On Error GoTo Err_CPF
    Dim I As Integer   'utilizada nos FOR... NEXT
    Dim strcampo As String   'armazena do CPF que ser|fffd| utilizada para o c|fffd|lculo
    Dim strCaracter As String   'armazena os digitos do CPF da direita para a esquerda
    Dim intNumero As Integer   'armazena o digito separado para c|fffd|lculo (uma a um)
    Dim intMais As Integer   'armazena o digito espec|fffd|fico multiplicado pela sua base
    Dim lngSoma As Long   'armazena a soma dos digitos multiplicados pela sua base(intmais)
    Dim dblDivisao As Double   'armazena a divis|fffd|o dos digitos*base por 11
    Dim lngInteiro As Long   'armazena inteiro da divis|fffd|o
    Dim intResto As Integer   'armazena o resto
    Dim intDig1 As Integer   'armazena o 1|fffd| digito verificador
    Dim intDig2 As Integer   'armazena o 2|fffd| digito verificador
    Dim strConf As String   'armazena o digito verificador

    If Len(CPF) < 11 Then
        DVCPF = "False"
        Exit Function
    End If

    lngSoma = 0
    intNumero = 0
    intMais = 0
    strcampo = Left(CPF, 9)

    'Inicia c|fffd|lculos do 1|fffd| d|fffd|gito
    For I = 2 To 10
        strCaracter = Right(strcampo, I - 1)
        intNumero = Left(strCaracter, 1)
        intMais = intNumero * I
        lngSoma = lngSoma + intMais
    Next I
    dblDivisao = lngSoma / 11

    lngInteiro = Int(dblDivisao) * 11
    intResto = lngSoma - lngInteiro
    If intResto = 0 Or intResto = 1 Then
        intDig1 = 0
    Else
        intDig1 = 11 - intResto
    End If

    strcampo = strcampo & intDig1   'concatena o CPF com o primeiro digito verificador
    lngSoma = 0
    intNumero = 0
    intMais = 0
    'Inicia c|fffd|lculos do 2|fffd| d|fffd|gito
    For I = 2 To 11
        strCaracter = Right(strcampo, I - 1)
        intNumero = Left(strCaracter, 1)
        intMais = intNumero * I
        lngSoma = lngSoma + intMais
    Next I
    dblDivisao = lngSoma / 11
    lngInteiro = Int(dblDivisao) * 11
    intResto = lngSoma - lngInteiro
    If intResto = 0 Or intResto = 1 Then
        intDig2 = 0
    Else
        intDig2 = 11 - intResto
    End If
    strConf = intDig1 & intDig2
    'Caso o CPF esteja errado dispara a mensagem
    If strConf <> Right(CPF, 2) Then
        DVCPF = "False"
    Else
        DVCPF = "True"
    End If
    Exit Function
Exit_CPF:
    Exit Function
Err_CPF:
    '    MsgBox Error$
    DVCPF = "False"   'Eu coloquei
    Resume Exit_CPF
End Function

Attribute VB_Name = "M|fffd|d4Editada"
Sub Editada()
    Dim WbEditada As Workbook
    Set WbEditada = ThisWorkbook
    Windows(WbEditada.Windows(1).Caption).Visible = True
    WbEditada.Activate

    For Each Sh In WbEditada.Sheets
        'Este loop |fffd| usado s|fffd| onde houver planilha de hist|fffd|rico
        If Right(Sh.Name, 4) = ".hst" Then
            Sh.Activate
            NumCampos = Range("A1").CurrentRegion.Columns.Count
            NumSugPadr = Range("A1").CurrentRegion.Rows.Count
            Set Campos = Range(Cells(1, 1), Cells(1, NumCampos))

            'Limpando
            Range("DadosFixos").CurrentRegion.Clear
            Range("DadosHist").CurrentRegion.Clear
            For Each Nome In ActiveWorkbook.ActiveSheet.Names
                Nome.Delete
            Next
            With ActiveWindow
                .SplitColumn = 0
                .SplitRow = 12
            End With

            'Redefinindo
            LFix = 4 + 100   'N|fffd|m de linhas reservadas para sug. fixas. Pode ser alterado o c|fffd|digo |fffd| flex|fffd|vel
            With ActiveWorkbook.ActiveSheet.Names
                Ref = "=" & ActiveWorkbook.ActiveSheet.Name & "!" & Cells(NumSugPadr + 4, 1).Address(ReferenceStyle:=xlR1C1)
                .Add Name:="DadosFixos", RefersToR1C1:=Ref
                Ref = "=" & ActiveWorkbook.ActiveSheet.Name & "!" & Cells(NumSugPadr + 4 + LFix + 1, 1).Address(ReferenceStyle:=xlR1C1)
                .Add Name:="DadosHist", RefersToR1C1:=Ref


                For Each C In Campos
                    .Add Name:=C.Value, RefersToR1C1:=Cells(NumSugPadr + 4, C.Column)
                    .Add Name:=C.Value & "Hist", RefersToR1C1:=Cells(NumSugPadr + 4 + LFix + 2, C.Column)
                    C.Offset(NumSugPadr + 4 + LFix, 0).Value = 15
                    C.Offset(NumSugPadr + 4 + LFix + 1, 0).Value = C.Value & "Hist"
                Next
            End With
            Range("A1").CurrentRegion.Copy
            Range("DadosFixos").PasteSpecial xlPasteValues
            Application.CutCopyMode = False

            ActiveWindow.Panes(1).Activate
            Application.GoTo Reference:="DadosFixos", Scroll:=True
            ActiveWindow.Panes(3).Activate
            Application.GoTo Reference:="DadosHist", Scroll:=True
        End If
    Next

    If WbEditada.ReadOnly Then WbEditada.ChangeFileAccess xlReadWrite
    If Val(Application.Version) < 9 Then If MsgBox(WbEditada.Name & ".  Indenter? (Distanciar margens)", vbOKCancel) = vbOK Then Run "Indenter97.xla!IndentProject"
    WbEditada.Sheets(1).Select
    If MsgBox(WbEditada.Name & ".  Limpar C|fffd|digo?", vbOKCancel) = vbOK Then
        Application.OnTime Now, "VBACodeCleaner.xla!CodeCleanerMain"
    Else
        WbEditada.Save
    End If
End Sub
Attribute VB_Name = "Plan1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
































Attribute VB_Name = "UserForm1Recib"
Attribute VB_Base = "0{8BBD695B-49DD-47BA-AB2C-D33C56298AC1}{22F55FDC-DAE2-4B39-88E4-2B220FE3AD03}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
Public ControleAtivo As Control

Private Sub UserForm_Activate()
    Finalizar_Bt.SetFocus
    ControleAtivo.SetFocus
End Sub
Private Sub UserForm_Deactivate()
    Set ControleAtivo = ActiveControl
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    ListandoComboBox UMonet_Cb
    ListandoComboBox Extenso_Cb
    ListandoComboBox Principal_Cb, "#,##0.00"
    ListandoComboBox Corre|fffd||fffd|o_Cb, "#,##0.00"
    ListandoComboBox Juros_Cb, "#,##0.00"
    ListandoComboBox Multa_Cb, "#,##0.00"
    ListandoComboBox JurosComMora_Cb, "#,##0.00"
    ListandoComboBox Desconto_Cb, "#,##0.00"
    ListandoComboBox Valor_Cb, "#,##0.00"
    ListandoComboBox Recebedor_Cb
    ListandoComboBox CNPJrecebedor_Cb
    ListandoComboBox Pagador_Cb
    ListandoComboBox CNPJpagador_Cb
    ListandoComboBox Referente_Cb
    ListandoComboBox ReferenteCont_Cb
    ListandoComboBox Par|fffd|grafoExtra_Cb
    ListandoComboBox CidadeUf_Cb
    ListandoComboBox Data_Cb, "dd/mm/yy"
    Set ControleAtivo = Pagador_Cb

    'S|fffd| exibe controles se o xls existir na pasta do cpap. S|fffd| no Martmag
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value): DBFiltroR_Lb.Visible = Dir(DirBD & "\Banco\DBFiltro.xls") <> ""
    DBFiltroP_Lb.Visible = DBFiltroR_Lb.Visible
End Sub

Private Sub Calend_Bt_Click()
    CalendBtClick UserForm1Recib, Data_Cb, Calend_Bt
    Application.ScreenUpdating = True
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    BotAcionado = False
End Sub

Private Sub Finalizar_Bt_Click()
'Criticar interroga|fffd||fffd|es
    If CritInterog(Referente_Tb, "Referente") Then Exit Sub
    If CritInterog(ReferenteCont_Tb, "Referente Continua|fffd||fffd|o") Then Exit Sub
    If CritInterog(Par|fffd|grafoExtra_Tb, "Par|fffd|grafo Extra") Then Exit Sub
    Hide
    BotAcionado = 26
End Sub

Function CritInterog(vCtrl As Control, nCampo As String) As Boolean
'Esse procedimento |fffd| t|fffd|pico do M|fffd|d2Comum, e deve ir para l|fffd| se eu resolver estender para outras caixas
'O ideal |fffd| que a interroga|fffd||fffd|o esteja no in|fffd|cio da vari|fffd|vel e precedida por um espa|fffd|o
    CritInterog = False
    I = InStr(1, vCtrl.Value, "?")
    I1 = Len(vCtrl.Value)
    If I <> 0 Then
        If MsgBox("No texto da sugest|fffd|o do campo """ & nCampo & """ ainda h|fffd| interroga|fffd||fffd|o por responder." & Chr(10) & Chr(10) & "Acione OK para responder.", vbOKCancel + vbQuestion, nCampo & " (?)") = vbOK Then
            CritInterog = True
            vCtrl.SetFocus
            vCtrl.SelStart = InStr(1, vCtrl.Value, "?") - 1
            vCtrl.SelLength = 1

            'Tenta estender a sele|fffd||fffd|o at|fffd| o pr|fffd|x. espa|fffd|o ou quebra de linha
            If I > 1 And I < I1 Then
                If Mid(vCtrl.Value, I - 1, 1) = " " Then   'Esta condi|fffd||fffd|o |fffd| apenas para evitar que interroga|fffd||fffd|o postas ao final vari|fffd|vel a sele|fffd||fffd|o se estenda ao contr|fffd|rio
                    For k = I To I1
                        If Mid(vCtrl.Value, k, 1) = " " Or Mid(vCtrl.Value, k, 1) = Chr(13) Then Exit For
                    Next
                    If Mid(vCtrl.Value, k - 1, 1) = "," Or Mid(vCtrl.Value, k - 1, 1) = "." Or Mid(vCtrl.Value, k - 1, 1) = ":" Or Mid(vCtrl.Value, k, 1) = ";" Then k = k - 1
                    vCtrl.SelLength = I - k
                End If
            End If

        End If
    End If
End Function


Private Sub Calcular_Lb_Click()
    Hide
    BotAcionado = 31
End Sub

Private Sub Cancelar_Bt_Click()
    Hide
    BotAcionado = False
End Sub

Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub UMonet_Cb_Change()
    If UMonet_Cb.Value = MarcHist Then ConfHist UMonet_Cb, Recib(10).Value
End Sub

Private Sub Extenso_Cb_Change()
    If Extenso_Cb.Value = MarcHist Then ConfHist Extenso_Cb, Recib(11).Value
End Sub


Private Sub Principal_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Principal_Cb, Button, Shift, x, y
End Sub
Private Sub Principal_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Principal_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then PrincipalCalculadora_Bt_Click
End Sub
Private Sub Principal_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Principal_Cb.Value = MarcHist Then ConfHist Principal_Cb, Format(Recib(4).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Principal_Cb, True
    OcultarExibControles
End Sub
Private Sub Principal_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Principal_Cb, Cancel, "#,##0.00"
End Sub
Private Sub PrincipalCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, Principal_Cb, PrincipalCalculadora_Bt, 2
End Sub


Private Sub Corre|fffd||fffd|o_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Corre|fffd||fffd|o_Cb, Button, Shift, x, y
End Sub
Private Sub Corre|fffd||fffd|o_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Corre|fffd||fffd|o_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then Corre|fffd||fffd|oCalculadora_Bt_Click
End Sub
Private Sub Corre|fffd||fffd|o_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Corre|fffd||fffd|o_Cb.Value = MarcHist Then ConfHist Corre|fffd||fffd|o_Cb, Format(Recib(5).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Corre|fffd||fffd|o_Cb, True
    OcultarExibControles
End Sub
Private Sub Corre|fffd||fffd|o_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Corre|fffd||fffd|o_Cb, Cancel, "#,##0.00"
End Sub
Private Sub Corre|fffd||fffd|oCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, Corre|fffd||fffd|o_Cb, Corre|fffd||fffd|oCalculadora_Bt, 2
End Sub


Private Sub Juros_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Juros_Cb, Button, Shift, x, y
End Sub
Private Sub Juros_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Juros_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then JurosCalculadora_Bt_Click
End Sub
Private Sub Juros_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Juros_Cb.Value = MarcHist Then ConfHist Juros_Cb, Format(Recib(6).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Juros_Cb, True
    OcultarExibControles
End Sub
Private Sub Juros_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Juros_Cb, Cancel, "#,##0.00"
End Sub
Private Sub JurosCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, Juros_Cb, JurosCalculadora_Bt, 2
End Sub


Private Sub Multa_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Multa_Cb, Button, Shift, x, y
End Sub
Private Sub Multa_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Multa_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then MultaCalculadora_Bt_Click
End Sub
Private Sub Multa_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Multa_Cb.Value = MarcHist Then ConfHist Multa_Cb, Format(Recib(7).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Multa_Cb, True
    OcultarExibControles
End Sub
Private Sub Multa_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Multa_Cb, Cancel, "#,##0.00"
End Sub
Private Sub MultaCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, Multa_Cb, MultaCalculadora_Bt, 2
End Sub


Private Sub JurosComMora_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove JurosComMora_Cb, Button, Shift, x, y
End Sub
Private Sub JurosComMora_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown JurosComMora_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then JurosComMoraCalculadora_Bt_Click
End Sub
Private Sub JurosComMora_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If JurosComMora_Cb.Value = MarcHist Then ConfHist JurosComMora_Cb, Format(Recib(8).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change JurosComMora_Cb, True
    OcultarExibControles
End Sub
Private Sub JurosComMora_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit JurosComMora_Cb, Cancel, "#,##0.00"
End Sub
Private Sub JurosComMoraCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, JurosComMora_Cb, JurosComMoraCalculadora_Bt, 2
End Sub


Private Sub Desconto_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Desconto_Cb, Button, Shift, x, y
End Sub
Private Sub Desconto_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Desconto_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then DescontoCalculadora_Bt_Click
End Sub
Private Sub Desconto_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Desconto_Cb.Value = MarcHist Then ConfHist Desconto_Cb, Format(Recib(9).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Desconto_Cb
    OcultarExibControles
End Sub
Private Sub Desconto_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Desconto_Cb, Cancel, "#,##0.00"
End Sub
Private Sub DescontoCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, Desconto_Cb, DescontoCalculadora_Bt, 2
End Sub


Private Sub Valor_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvValor_Cb_MouseMove Valor_Cb, Button, Shift, x, y
End Sub
Private Sub Valor_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvValor_Cb_KeyDown Valor_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then ValorCalculadora_Bt_Click
End Sub
Private Sub Valor_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If Valor_Cb.Value = MarcHist Then ConfHist Valor_Cb, Format(Recib(12).Value, "#,##0.00"), False, "#,##0.00"
    EvValor_Cb_Change Valor_Cb, True
    OcultarExibControles
End Sub
Private Sub Valor_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvValor_Cb_Exit Valor_Cb, Cancel, "#,##0.00"
End Sub
Private Sub ValorCalculadora_Bt_Click()
    CalculadoraBtClick UserForm1Recib, Valor_Cb, ValorCalculadora_Bt, 2
End Sub


Private Sub Recebedor_Cb_Change()
    If Recebedor_Cb.Value = MarcHist Then ConfHist Recebedor_Cb, Recib(14).Value
    I = Recebedor_Cb.Value
    j = Recebedor_Cb.SelStart
    k = Len(I)
    Recebedor_Cb.Value = LTrim(Application.Run("Cpap_pri.mac!PROPERx", Recebedor_Cb.Value))
    If j < k Then Recebedor_Cb.SelStart = j
End Sub
Private Sub CNPJrecebedor_Cb_Change()
    If CNPJrecebedor_Cb.Value = MarcHist Then ConfHist CNPJrecebedor_Cb, Recib(15).Value
End Sub
Private Sub CNPJrecebedor_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    I = CNPJrecebedor_Cb.Value
    j = CNPJrecebedor_Cb.SelStart
    k = Len(I)
    I = Application.WorksheetFunction.Substitute(I, ".", "")
    I = Application.WorksheetFunction.Substitute(I, "-", "")
    I = Application.WorksheetFunction.Substitute(I, "/", "")
    cnpj = DVCGC((I))
    CPF = DVCPF((I))
    If cnpj = "True" Then
        I = Left(I, Len(I) - 12) & "." & Mid(Right(I, 12), 1, 3) & "." & Mid(Right(I, 12), 4, 3) & "/" & Mid(Right(I, 12), 7, 4) & "-" & Right(I, 2)
    End If
    If CPF = "True" Then
        I = Left(I, Len(I) - 8) & "." & Mid(Right(I, 8), 1, 3) & "." & Mid(Right(I, 8), 4, 3) & "-" & Right(I, 2)
    End If
    If cnpj = "True" Or CPF = "True" Then
        CNPJrecebedor_Cb.Value = I
        CNPJrecebedor_Cb.ForeColor = RGB(0, 0, 0)
    Else
        If MsgBox("N|fffd|mero inv|fffd|lido para CPF e para CNPJ! Continua assim mesmo?", vbQuestion + vbOKCancel, "N|fffd|mero Inv|fffd|lido") = vbCancel Then Cancel = True
        CNPJrecebedor_Cb.ForeColor = RGB(255, 0, 0)  'Cor - Ciano
        If j < k Then CNPJrecebedor_Cb.SelStart = j
    End If
End Sub


Private Sub Pagador_Cb_Change()
    If Pagador_Cb.Value = MarcHist Then ConfHist Pagador_Cb, Recib(17).Value
    I = Pagador_Cb.Value
    j = Pagador_Cb.SelStart
    k = Len(I)
    Pagador_Cb.Value = LTrim(Application.Run("Cpap_pri.mac!PROPERx", Pagador_Cb.Value))
    If j < k Then Pagador_Cb.SelStart = j
End Sub
Private Sub CNPJpagador_Cb_Change()
    If CNPJpagador_Cb.Value = MarcHist Then ConfHist CNPJpagador_Cb, Recib(18).Value
End Sub
Private Sub CNPJpagador_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    I = CNPJpagador_Cb.Value
    j = CNPJpagador_Cb.SelStart
    k = Len(I)
    I = Application.WorksheetFunction.Substitute(I, ".", "")
    I = Application.WorksheetFunction.Substitute(I, "-", "")
    I = Application.WorksheetFunction.Substitute(I, "/", "")
    cnpj = DVCGC((I))
    CPF = DVCPF((I))
    If cnpj = "True" Then
        I = Left(I, Len(I) - 12) & "." & Mid(Right(I, 12), 1, 3) & "." & Mid(Right(I, 12), 4, 3) & "/" & Mid(Right(I, 12), 7, 4) & "-" & Right(I, 2)
    End If
    If CPF = "True" Then
        I = Left(I, Len(I) - 8) & "." & Mid(Right(I, 8), 1, 3) & "." & Mid(Right(I, 8), 4, 3) & "-" & Right(I, 2)
    End If
    If cnpj = "True" Or CPF = "True" Then
        CNPJpagador_Cb.Value = I
        CNPJpagador_Cb.ForeColor = RGB(0, 0, 0)
    Else
        If MsgBox("N|fffd|mero inv|fffd|lido para CPF e para CNPJ! Continua assim mesmo?", vbQuestion + vbOKCancel, "N|fffd|mero Inv|fffd|lido") = vbCancel Then Cancel = True
        CNPJpagador_Cb.ForeColor = RGB(255, 0, 0)  'Cor - Ciano
        If j < k Then CNPJpagador_Cb.SelStart = j
    End If
End Sub


Private Sub Referente_Tb_Change()
    If Referente_Tb.Value = MarcHist Then ConfHist Referente_Cb, Recib(20).Value
    I = Referente_Tb.Value
    j = Referente_Tb.SelStart
    k = Len(I)
    Referente_Tb.Value = LTrim(Referente_Tb.Value)
    If j < k Then Referente_Tb.SelStart = j
End Sub
Private Sub Referente_Cb_Change()
    Referente_Tb.Value = Referente_Cb.Value
    On Error Resume Next   'Se altera|fffd||fffd|es forem detectada ao fechar a caixa, o controle j|fffd| n|fffd|o poder|fffd| ser focado
    Referente_Tb.SetFocus
End Sub
Private Sub Referente_Tb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    Referente_Cb.Value = Referente_Tb.Value
End Sub


Private Sub ReferenteCont_Tb_Change()
    If ReferenteCont_Tb.Value = MarcHist Then ConfHist ReferenteCont_Cb, Recib(22).Value
    I = ReferenteCont_Tb.Value
    j = ReferenteCont_Tb.SelStart
    k = Len(I)
    ReferenteCont_Tb.Value = LTrim(ReferenteCont_Tb.Value)
    If j < k Then ReferenteCont_Tb.SelStart = j
End Sub
Private Sub ReferenteCont_Cb_Change()
    ReferenteCont_Tb.Value = ReferenteCont_Cb.Value
    On Error Resume Next   'Se altera|fffd||fffd|es forem detectada ao fechar a caixa, o controle j|fffd| n|fffd|o poder|fffd| ser focado
    ReferenteCont_Tb.SetFocus
End Sub
Private Sub ReferenteCont_Tb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    ReferenteCont_Cb.Value = ReferenteCont_Tb.Value
End Sub


Private Sub Par|fffd|grafoExtra_Tb_Change()
    If Par|fffd|grafoExtra_Tb.Value = MarcHist Then ConfHist Par|fffd|grafoExtra_Cb, Recib(24).Value
    I = Par|fffd|grafoExtra_Tb.Value
    j = Par|fffd|grafoExtra_Tb.SelStart
    k = Len(I)
    Par|fffd|grafoExtra_Tb.Value = LTrim(UCase(Left(Par|fffd|grafoExtra_Tb.Value, 1)) & Mid(Par|fffd|grafoExtra_Tb.Value, 2, 254))
    If j < k Then Par|fffd|grafoExtra_Tb.SelStart = j
End Sub
Private Sub Par|fffd|grafoExtra_Cb_Change()
    Par|fffd|grafoExtra_Tb.Value = Par|fffd|grafoExtra_Cb.Value
    On Error Resume Next   'Se altera|fffd||fffd|es forem detectada ao fechar a caixa, o controle j|fffd| n|fffd|o poder|fffd| ser focado
    Par|fffd|grafoExtra_Tb.SetFocus
End Sub
Private Sub Par|fffd|grafoExtra_Tb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    Par|fffd|grafoExtra_Cb.Value = Par|fffd|grafoExtra_Tb.Value
End Sub


Private Sub CidadeUf_Cb_Change()
    If vEnableEvents = False Then Exit Sub
    If CidadeUf_Cb.Value = MarcHist Then ConfHist CidadeUf_Cb, Recib(25).Value
    I = CidadeUf_Cb.Value
    j = CidadeUf_Cb.SelStart
    k = Len(I)
    vEnableEvents = False
    CidadeUf_Cb.Value = LTrim(Application.Run("Cpap_pri.mac!PROPERx", CidadeUf_Cb.Value))
    vEnableEvents = True
    If j < k Then CidadeUf_Cb.SelStart = j
End Sub


Private Sub Data_Cb_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    EvCalend_Cb_MouseMove Data_Cb, Button, Shift, x, y
End Sub
Private Sub Data_Cb_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    EvCalend_Cb_KeyDown Data_Cb, KeyCode, Shift
    If KeyCode = 40 Or KeyCode = 38 Then Calend_Bt_Click
End Sub
Private Sub Data_Cb_Change()
    If Data_Cb.Value = MarcHist Then ConfHist Data_Cb, Format(DateValue(IIf(Len(Recib(26).Value) > 3, Recib(26).Value, Now)), "dd/mm/yy"), False, "dd/mm/yy"
    EvCalend_Cb_Change Data_Cb
End Sub
Private Sub Data_Cb_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    EvCalend_Cb_Exit Data_Cb, Cancel
End Sub
Private Sub Data_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    OcultarExibControles
End Sub


Private Sub Decompor_Chb_Click()
    If vEnableEvents = False Then Exit Sub
    OcultarExibControles
End Sub

Private Sub Agenda_Click()
    Application.ExecuteExcel4Macro ("cpap_pri.mac!Calendario()")
End Sub


'Isso |fffd| s|fffd| para Martmag pegar nome e cnpj
Private Sub DBFiltroR_Lb_Click()
    DBFiltro DBFiltroR_Lb, Recebedor_Cb, CNPJrecebedor_Cb
End Sub
Private Sub DBFiltroP_Lb_Click()
    DBFiltro DBFiltroP_Lb, Pagador_Cb, CNPJpagador_Cb
End Sub
Private Sub DBFiltro(Button_Lb As Object, Nome_Cb As Object, CNPJ_Cb As Object)
    Dim vRetDados As Variant
    On Error Resume Next
    Workbooks("DBFiltro.xls").Saved = True    'Verif. se j|fffd| est|fffd| aberto, depois de aberto s|fffd| fecha com o cpap
    If Err.Number <> 0 Then
        Button_Lb.Enabled = False: DoEvents
        Application.ScreenUpdating = False: DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value)
        vRetDados = Application.Run("CPAP_Ex8.mac!OpenVBA", DirBD & "\Banco\DBFiltro.xls", True, False)
        Windows(Workbooks("DBFiltro.xls").Windows(1).Caption).Visible = False
        ThisWorkbook.Activate
        Application.ScreenUpdating = True
        Button_Lb.Enabled = True
        If vRetDados = False Then Exit Sub
    End If
    On Error GoTo 0

    vRetDados = Application.Run("DBFiltro.xls!fDBFiltro")
    Workbooks("DBFiltro.xls").Saved = True
    If TypeName(vRetDados) = "Boolean" Then Exit Sub
    Nome_Cb.Value = vRetDados(0)
    CNPJ_Cb.Value = vRetDados(1)

    On Error Resume Next
    CNPJ_Cb.SetFocus    'Para disparar evento exit
    Finalizar_Bt.SetFocus
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub


Attribute VB_Name = "UserFormEditHist"
Attribute VB_Base = "0{688E6E7A-4AD7-46E5-A9CD-C955032CE18A}{F8E297A3-ECF8-4AA2-A8BB-AB5E08B28682}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private vListBox As Control
Private vTextBox As Control
Private SemAltera|fffd||fffd|es As Boolean


Private Sub Ajuda_Bt_Click()
    If bHtmlHelp Then Application.Run "CPAP_EX8.MAC!HelpVBA", ThisWorkbook.Path & "\CPAP.chm", HelpContextID, 2 Else Application.Help ThisWorkbook.Path & "\cpap.hlp", HelpContextID
End Sub

Private Sub UserForm_Initialize()
    vEnableEvents = True
    Caption = "Editando Sugest|fffd|es do Campo " & HistEditCampo
    'Listando listboxes - Lista de sug fixas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo, ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).End(xlDown))
    If campo.Rows.Count < 100 Then
        j = 0
        For Each C In campo
            cf = Format(IIf(IsError(C.Value), "", C.Value), FormatoHist)
            j = j + 1
            If j > 1 Then
                vRep = False
                For I = 1 To SugFixas_Lb.ListCount
                    If SugFixas_Lb.List(I - 1) = cf Then vRep = True
                Next
                If vRep = False Then SugFixas_Lb.AddItem (cf)
            End If
        Next
    End If

    'Listando ListBox - Sugest Hist|fffd|ricas
    Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").End(xlDown))
    If campo.Rows.Count < 10000 Then
        j = 0
        For Each C In campo
            cf = Format(IIf(IsError(C.Value), "", C.Value), FormatoHist)
            j = j + 1
            If j > 1 Then
                vRep = False
                For I = 1 To SugHist_Lb.ListCount
                    If SugHist_Lb.List(I - 1) = cf Then vRep = True
                Next
                If vRep = False And cf <> "" Then SugHist_Lb.AddItem (cf)
            End If
        Next
    End If
    NumMax_Ct.Value = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(-1, 0)
    MultiPage1.Value = 0
    MultiPage1_Change
    SemAltera|fffd||fffd|es = True
    OcultarExibControlesHist
End Sub

Private Sub NumMax_Ct_Change()
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub NumMax_Ct_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    If IsNumeric(NumMax_Ct.Value) Then
        If NumMax_Ct.Value < 0 Then NumMax_Ct.Value = 0
        If NumMax_Ct.Value > 100 Then NumMax_Ct.Value = 100
    Else
        NumMax_Ct.Value = 15
    End If
End Sub

Private Sub Fechar_Bt_Click()
    Hide
    If SemAltera|fffd||fffd|es = True Then Exit Sub
    If MsgBox("Salvar altera|fffd||fffd|es nas sugest|fffd|es para o campo " & HistEditCampo & "?", vbQuestion + vbOKCancel, "CPAP|fffd|") = vbCancel Then Exit Sub
    DirBD = Application.Evaluate(Workbooks("cpap_pri.mac").Names("DirBD").Value) 'DirP = ThisWorkbook.Path
    Application.ScreenUpdating = False
    If MyOpenFile(DirBD & "\banco\" & NomeArqHist, False) Then
        'Limpando c|fffd|lulas
        Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo, ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).End(xlDown))
        If campo.Rows.Count < 100 Then
            I = campo(1)
            campo.ClearContents
            campo(1) = I
        End If
        Set campo = ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist", ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").End(xlDown))
        If campo.Rows.Count > 10000 Then
        Else
            I = campo(1)
            campo.ClearContents
            campo(1) = I
        End If

        'Descaregando comboboxes - Sug. Fixas
        k = 0
        NumM|fffd|x = ThisWorkbook.Sheets(NomeArqHist).Range("DadosHist").Row - ThisWorkbook.Sheets(NomeArqHist).Range("DadosFixos").Row - 3
        For j = 1 To SugFixas_Lb.ListCount
            If j > NumM|fffd|x Then Exit For
            vRep = False
            If j > 1 Then
                For I = 1 To j
                    If ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).Offset(I, 0) = SugFixas_Lb.List(j - 1) Then vRep = True
                Next
            End If
            If vRep = False Then
                k = k + 1
                ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo).Offset(k, 0) = SugFixas_Lb.List(j - 1)
            End If
        Next

        'Descarregando comboboxes - Sug. Hist|fffd|ricas
        k = 0
        For j = 1 To SugHist_Lb.ListCount
            If j > NumMax_Ct.Value * 1 Then Exit For
            vRep = False
            If j > 1 Then
                For I = 1 To j
                    If ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(I, 0) = SugHist_Lb.List(j - 1) Then vRep = True
                Next
            End If
            If vRep = False Then
                k = k + 1
                ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(k, 0) = SugHist_Lb.List(j - 1)
            End If
        Next
    End If
    ThisWorkbook.Sheets(NomeArqHist).Range(HistEditCampo & "Hist").Offset(-1, 0) = NumMax_Ct.Value
    SalvandoHist
    Application.ScreenUpdating = True
End Sub

Private Sub Mover_Sb_SpinUp()
    I = vListBox.ListIndex
    If I < 1 Then Exit Sub
    vListBox.AddItem vListBox.List(I), I - 1
    vListBox.RemoveItem I + 1
    vListBox.Selected(I - 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Mover_Sb_SpinDown()
    I = vListBox.ListIndex
    If I < 0 Or I + 1 >= vListBox.ListCount Then Exit Sub
    vListBox.AddItem vListBox.List(I), I + 2
    vListBox.RemoveItem I
    vListBox.Selected(I + 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Transf_Bt_Click()
    I = vListBox.ListIndex
    If I < 0 Then Exit Sub
    If vListBox.Selected(I) Then
        I1 = vListBox.Value
        vListBox.RemoveItem I
        vEnableEvents = False
        If vListBox.ListIndex = -1 Then vTextBox.Value = ""
        vEnableEvents = True
    End If
    If MultiPage1.Value = 0 Then MultiPage1.Value = 1 Else MultiPage1.Value = 0
    vListBox.AddItem I1
    vListBox.Selected(vListBox.ListCount - 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Excluir_Bt_Click()
    I = vListBox.ListIndex
    If I < 0 Then Exit Sub
    If vListBox.Selected(I) Then vListBox.RemoveItem I
    vEnableEvents = False
    If vListBox.ListIndex = -1 Then vTextBox.Value = ""
    vEnableEvents = True
    OcultarExibControlesHist
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub Nova_Bt_Click()
    vListBox.AddItem "Nova Sugest|fffd|o" & vListBox.ListCount + 1
    vListBox.Selected(vListBox.ListCount - 1) = True
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub MultiPage1_Change()
    If MultiPage1.Value = 0 Then
        Set vListBox = SugHist_Lb
        Set vTextBox = SugHist_Ct
    Else
        Set vListBox = SugFixas_Lb
        Set vTextBox = SugFixas_Ct
    End If
    OcultarExibControlesHist
End Sub

Private Sub SugFixas_Ct_Change()
    If vEnableEvents = False Then Exit Sub
    I = SugFixas_Lb.ListIndex
    I1 = SugFixas_Ct.SelStart
    If I < 0 Then
        j = SugFixas_Ct.Value
        Nova_Bt_Click
        SugFixas_Ct.Value = j
        I = SugFixas_Lb.ListCount - 1
    End If
    SugFixas_Lb.AddItem SugFixas_Ct.Value, I
    SugFixas_Lb.RemoveItem I + 1
    SugFixas_Lb.Selected(I) = True
    SugFixas_Ct.SelStart = I1
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub SugFixas_Ct_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    I = SugFixas_Lb.ListIndex
    If SugFixas_Ct.Value <> "" Or I < 0 Then Exit Sub
    SugFixas_Lb.RemoveItem I
End Sub

Private Sub SugFixas_LB_Click()
    vEnableEvents = False
    SugFixas_Ct.Value = SugFixas_Lb.Value
    If SugFixas_Ct.Enabled Then SugFixas_Ct.SetFocus
    vEnableEvents = True
    OcultarExibControlesHist
End Sub

Private Sub SugHist_Ct_Change()
    If vEnableEvents = False Then Exit Sub
    I = SugHist_Lb.ListIndex
    I1 = SugHist_Ct.SelStart
    If I < 0 Then
        j = SugHist_Ct.Value
        Nova_Bt_Click
        SugHist_Ct.Value = j
        I = SugHist_Lb.ListCount - 1
    End If
    SugHist_Lb.AddItem SugHist_Ct.Value, I
    SugHist_Lb.RemoveItem I + 1
    SugHist_Lb.Selected(I) = True
    SugHist_Ct.SelStart = I1
    SemAltera|fffd||fffd|es = False
End Sub

Private Sub SugHist_Ct_Exit(ByVal Cancel As MSForms.ReturnBoolean)
    I = SugHist_Lb.ListIndex
    If SugHist_Ct.Value <> "" Or I < 0 Then Exit Sub
    SugHist_Lb.RemoveItem I
End Sub

Private Sub SugHist_Lb_Click()
    vEnableEvents = False
    SugHist_Ct.Value = SugHist_Lb.Value
    If SugHist_Ct.Enabled Then SugHist_Ct.SetFocus
    vEnableEvents = True
    OcultarExibControlesHist
End Sub

Sub OcultarExibControlesHist()
    I = vListBox.ListIndex > -1
    Excluir_Bt.Enabled = I
    Mover_Sb.Enabled = I
    Mover_Lb.Enabled = I
    Transf_Bt.Enabled = I
    Transf_Bt.ControlTipText = "Transfere para " & IIf(MultiPage1.Value = 0, "Fixas", "Hist|fffd|ricas")
    WhatsThis_Img.Top = -50: If bHtmlHelp Then WhatsThis_Img.Top = -1: WhatsThis_Img.Left = Width - 10
End Sub

Private Sub WhatsThis_Img_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal x As Single, ByVal y As Single)
    Static cHHelpWhatsThis1 As Object
    If cHHelpWhatsThis1 Is Nothing Then Set cHHelpWhatsThis1 = Application.Run("CPAP_EX8.MAC!New_cHHelpWhatsThis")
    cHHelpWhatsThis1.WhatsThis_Img_MouseDown Button, Shift, x, y, Me
    If WhatsThis_Img.BackStyle = fmBackStyleOpaque Then Set cHHelpWhatsThis1 = Nothing
End Sub



INQUEST-PP=macro
