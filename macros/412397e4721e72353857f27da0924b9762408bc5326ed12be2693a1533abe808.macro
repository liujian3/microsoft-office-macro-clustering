Attribute VB_Name = "Class1"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub Workbook_Open()
    SetTime
End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    Disable
End Sub
Attribute VB_Name = "Leht1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Leht2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton2, 8, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 7, 2, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 9, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 10, 4, MSForms, CommandButton"
Attribute VB_Control = "CommandButton6, 14, 5, MSForms, CommandButton"
Private Sub CommandButton1_Click()
On Error Resume Next
Dim pt As PivotTable
Dim ws As Worksheet
    For Each ws In ThisWorkbook.Worksheets
        For Each pt In ws.PivotTables
          pt.RefreshTable
        Next pt
    Next ws
End Sub
Private Sub CommandButton2_Click()
On Error Resume Next
Dim slcr As SlicerCache
For Each slcr In ActiveWorkbook.SlicerCaches
slcr.ClearManualFilter
Next
    With Worksheets("statistika").PivotTables("PivotTable2").PivotFields("maakond")
        .PivotItems("(blank)").Visible = False
    End With
End Sub
Private Sub CommandButton3_Click()
Application.Run "Statistika"
End Sub
Private Sub CommandButton4_Click()
On Error Resume Next
Call CommandButton1_Click
Call CommandButton2_Click
ActiveWorkbook.SlicerCaches("Slicer_Toimingud1").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_kontroll").ClearManualFilter
    SelectSlicerValue "Slicer_toimingud1", "koolituse l|fffd|biviimine", False
    SelectSlicerValue "Slicer_toimingud1", "koolitusel osalemine", False
    SelectSlicerValue "Slicer_toimingud1", "materjali vormistamine", False
    SelectSlicerValue "Slicer_toimingud1", "muu", False
    SelectSlicerValue "Slicer_toimingud1", "muu uurimistoiming", False
    SelectSlicerValue "Slicer_toimingud1", "muu vaatlus(korduv)", False
    SelectSlicerValue "Slicer_toimingud1", "objekti (ei ole asit|fffd|end) vaatlus", False
    SelectSlicerValue "Slicer_toimingud1", "preventsiooni|fffd|ritus", False
    SelectSlicerValue "Slicer_toimingud1", "turvataktika", False
    SelectSlicerValue "Slicer_toimingud1", "v|fffd|rdlusmaterjali v|fffd|tmine", False
'    ActiveWorkbook.SlicerCaches("Slicer_kontroll").ClearManualFilter
    SelectSlicerValue "Slicer_kontroll", "FALSE", False
End Sub
Private Sub CommandButton6_Click()
ActiveWorkbook.SlicerCaches("Slicer_S|fffd|rmej|fffd|ljed").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Kiiruuring").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_S|fffd|iduki_rehvij|fffd|ljed").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Relv_kuul").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Kiud").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_P|fffd|levvedelik").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Bioloogiline_proov").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Jalatsij|fffd|ljed").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Materjaliosakesed").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Murdmisriista_j|fffd|ljed").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Lasuj|fffd|ljed").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_V|fffd|rviproovid").ClearManualFilter
ActiveWorkbook.SlicerCaches("Slicer_Materjaliosakesed").ClearManualFilter
'ActiveWorkbook.SlicerCaches("Slicer_Jalatsij|fffd|ljed").ClearManualFilter
End Sub

Sub SelectSlicerValue(ByVal slicerName As String, ByVal slicerVal As String, ByVal isSelected As Boolean)
    ActiveWorkbook.SlicerCaches(slicerName).SlicerItems(slicerVal).Selected = isSelected
End Sub

Private Sub Filtrid()
'ActiveSheet.Shapes.Range(Array("kontroll")).Visible = msoFalse  'TO HIDE THE SLICER
'ActiveSheet.Shapes.Range(Array("Aasta")).Visible = msoFalse  'TO HIDE THE SLICER
ActiveSheet.Shapes.Range(Array("kontroll")).Visible = msoTrue   'TO SHOW THE SLICER
End Sub
Attribute VB_Name = "Leht3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton11, 32, 0, MSForms, CommandButton"
Attribute VB_Control = "CommandButton9, 30, 1, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 18, 2, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 22, 3, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 23, 4, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 24, 5, MSForms, CommandButton"
Attribute VB_Control = "CommandButton5, 25, 6, MSForms, CommandButton"
Attribute VB_Control = "CommandButton6, 26, 7, MSForms, CommandButton"
Attribute VB_Control = "CommandButton7, 27, 8, MSForms, CommandButton"
Attribute VB_Control = "CommandButton8, 29, 9, MSForms, CommandButton"
Attribute VB_Control = "CommandButton10, 31, 10, MSForms, CommandButton"
Attribute VB_Control = "CommandButton12, 34, 11, MSForms, CommandButton"
Private Sub CommandButton1_Click()
'Loo seos
Application.ScreenUpdating = False
On Error Resume Next
    r = ActiveCell.Row
    Range(Cells(r, 3).Address).Select
    If IsEmpty(ActiveCell) Then GoTo j|fffd|tka
    Worksheets("SISEND").Range("H1").Value = Worksheets("piimaraamat").Range(Cells(r, 2), Cells(r, 2)).Value
    Worksheets("SISEND").Range("H2:H3").Value = Worksheets("piimaraamat").Range(Cells(r, 12), Cells(r, 12)).Value
    Worksheets("SISEND").Range("N29").Value = " Seotud UID " & Worksheets("piimaraamat").Range(Cells(r, 1), Cells(r, 1)).Value
    Worksheets("SISEND").Select
    Exit Sub
j|fffd|tka:
MsgBox ("T|fffd|HJALT REALT EI SAA SEOST LUUA")
Application.ScreenUpdating = True
End Sub

Private Sub CommandButton2_Click()
'mine l|fffd|ppu
Call vaba_rida
r = ActiveCell.Row
Range(Cells(r, 2), Cells(r, 2)).Select
End Sub

Private Sub CommandButton3_Click()
    'lisa t|fffd|hjad read
Application.ScreenUpdating = False
Dim pass As String
pass = Sheets("SISEND").Range("N42").Value
    Worksheets("PIIMARAAMAT").Unprotect Password:=pass
    Sheets("piimaraamat").Select
    Range("A2").Select
    Selection.End(xlDown).Select
    i = 0
    Do While i < 2
    Selection.ListObject.ListRows.Add AlwaysInsert:=True
    i = i + 1
    Loop
    Call vaba_rida
    Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=pass
Application.ScreenUpdating = True
End Sub

Private Sub CommandButton4_Click()
'puhasta rida
Dim adm As String
adm = Sheets("SISEND").Range("N43").Value
If adm > 0 Then
Application.ScreenUpdating = False
    r = ActiveCell.Row
    If CreateObject("Wscript.shell").Popup("KAS KUSTUTAN ANDMED? TOIMING POLE TAASTATAV!", 0, "TAHAD SELLEL REAL OLEVAD ANDMED KUSTUTADA?", 4 + 16) = 7 Then Exit Sub
    Range(Cells(r, 2), Cells(r, 4)).Select: Selection.ClearContents
    Range(Cells(r, 6), Cells(r, 40)).Select: Selection.ClearContents
    Range(Cells(r, 43), Cells(r, 44)).Select: Selection.ClearContents
Application.ScreenUpdating = True
Exit Sub
End If
MsgBox ("MUUTMIS|fffd|IGUS PUUDUB")
End Sub

Private Sub CommandButton5_Click()
Application.Run "Filtrid_Maha"
End Sub

Private Sub CommandButton6_Click()
'valmimisaeg
If Intersect(ActiveCell, Range("AN:AN")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.FormulaR1C1 = Now()
End Sub
Private Sub CommandButton7_Click()
' rida_|fffd|les Makro
Dim adm As String
adm = Sheets("SISEND").Range("N43").Value
If adm > 0 Then
Application.ScreenUpdating = False
    r = ActiveCell.Row
    Range(Cells(r, 2), Cells(r, 4)).Select
    Selection.Copy
    ActiveCell.Offset(RowOffset:=-1, ColumnOffset:=0).Activate
'   SIIT ALGAB KONTROLL
    If IsEmpty(ActiveCell) Then GoTo j|fffd|tka
    If CreateObject("Wscript.shell").Popup("KAS KIRJUTAN |fffd|LE?", 0, "RIDA POLE T|fffd|HI!", 4 + 16) = 7 Then Exit Sub
j|fffd|tka:
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone
    ActiveCell.Offset(RowOffset:=1, ColumnOffset:=0).Activate
    Range(Cells(r, 6), Cells(r, 40)).Select
    Selection.Copy
    ActiveCell.Offset(RowOffset:=-1, ColumnOffset:=0).Activate
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone

    ActiveCell.Offset(RowOffset:=1, ColumnOffset:=0).Activate
    Range(Cells(r, 43), Cells(r, 44)).Select
    Selection.Copy
    ActiveCell.Offset(RowOffset:=-1, ColumnOffset:=0).Activate
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone '
'puhasta
    ActiveCell.Offset(RowOffset:=1, ColumnOffset:=0).Activate
    Range(Cells(r, 2), Cells(r, 4)).Select: Selection.ClearContents
    Range(Cells(r, 6), Cells(r, 40)).Select: Selection.ClearContents
    Range(Cells(r, 43), Cells(r, 44)).Select: Selection.ClearContents
Application.ScreenUpdating = True
Exit Sub
End If
MsgBox ("MUUTMIS|fffd|IGUS PUUDUB")
End Sub

Private Sub CommandButton8_Click()
'FAILID EDASTATUD
If Intersect(ActiveCell, Range("AE:AE")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.FormulaR1C1 = "Fotod edastatud"
End Sub

Private Sub CommandButton9_Click()
Application.Run "module1.Muuda_arhiiviks"
End Sub

Private Sub CommandButton10_Click()
Dim leht As Worksheet
Dim muudetav As Variant
Dim muudetud As Variant
Dim muudetud1 As String
Dim pass As String

pass = Sheets("SISEND").Range("N42").Value
Worksheets("PIIMARAAMAT").Unprotect Password:=pass
    r = ActiveCell.Row
    Range(Cells(r, 2).Address).Select
muudetav = ActiveCell.Value
If muudetav = "" Then
    Prompt = "SISESTA NUMBER"
    Title = "NUMBRI LISAMISEKS"
    muudetud = InputBox(Prompt, Title)
Worksheets("SISEND").Range("H1").Value = muudetud
muudetud1 = Worksheets("SISEND").Range("c29").Value
 '   Range(Cells(r, 2).Address).Select
ActiveCell.Value = muudetud1
    GoTo l|fffd|pp:
End If
    Prompt = "SISESTA UUS NUMBER"
    Title = "NUMBER " & muudetav & " MUUTMISEKS"
    muudetud = InputBox(Prompt, Title)
Worksheets("SISEND").Range("H1").Value = muudetud
muudetud1 = Worksheets("SISEND").Range("c29").Value

    If muudetud <> "" Then
With Sheets("piimaraamat").Columns("B")
Cells.Replace what:=muudetav, Replacement:=muudetud1, _
LookAt:=xlPart, SearchOrder:=xlByRows, MatchCase:=False, _
SearchFormat:=False, ReplaceFormat:=False
End With
l|fffd|pp:
End If
    Worksheets("SISEND").Range("H1").Value = ""
Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=pass
End Sub

Private Sub CommandButton11_Click()
Application.Run "module1.Puhasta_piimaraamat"
End Sub

Private Sub CommandButton12_Click()
Application.Run "module1.Uude_Baasi"
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Target.Cells.Count > 1 Then Exit Sub
    On Error Resume Next
    Application.ScreenUpdating = False
    ' Clear the color of all the cells
    Cells.Interior.ColorIndex = 0
    With Target
        ' Highlight the entire row and column that contain the active cell
        .EntireRow.Interior.ColorIndex = 20
 '       .EntireColumn.Interior.ColorIndex = 20
    End With
    Application.ScreenUpdating = True
End Sub
Private Sub Workbook_SheetSelectionChange(ByVal Sh As Object, ByVal Target As Range)
    On Error Resume Next
    Target.PasteSpecial xlPasteValues
    Application.CutCopyMode = True
    Application.CutCopyMode = False
End Sub

Private Sub vaba_rida()
    Dim ws As Worksheet
    Set ws = ActiveSheet
    For Each cell In ws.Columns(3).Cells
       If IsEmpty(cell) = True Then cell.Select: Exit For
    Next cell
End Sub

Private Sub nupud()
Dim baas As String
Dim adm As String
baas = Sheets("SISEND").Range("H46").Value
adm = Sheets("SISEND").Range("N43").Value
    If adm = 0 Then GoTo l|fffd|pp:
    If adm >= 2 Then
        Me.CommandButton1.Visible = True
        Me.CommandButton3.Visible = True
        Me.CommandButton10.Visible = True
        Me.CommandButton4.Visible = True 'puhasta rida
        Me.CommandButton7.Visible = True 'rida |fffd|les
        Me.CommandButton9.Visible = True  'arhiiviks
        Me.CommandButton11.Visible = True  ' puhasta piimaraamat
    If baas = False Then
        Me.CommandButton12.Visible = True 'uude baasi
        Exit Sub
    End If
        Me.CommandButton12.Visible = False 'uude baasi
        Exit Sub
'    Else
    End If
    If adm = 1 Then
        Me.CommandButton1.Visible = True
        Me.CommandButton3.Visible = True
        Me.CommandButton10.Visible = True
        Me.CommandButton4.Visible = True
        Me.CommandButton7.Visible = True
        Me.CommandButton12.Visible = True
        Me.CommandButton9.Visible = False
        Me.CommandButton11.Visible = False
    If baas = False Then
        Me.CommandButton12.Visible = True 'uude baasi
    End If
        Exit Sub
    End If
    
    If adm = -1 Then
        Me.CommandButton1.Visible = False
        Me.CommandButton3.Visible = False
        Me.CommandButton10.Visible = False
        Me.CommandButton4.Visible = False
        Me.CommandButton7.Visible = False
        Me.CommandButton9.Visible = False
        Me.CommandButton11.Visible = False
        Me.CommandButton12.Visible = False
    End If
    Exit Sub
l|fffd|pp:
        Me.CommandButton1.Visible = True
        Me.CommandButton3.Visible = True
        Me.CommandButton10.Visible = True
        Me.CommandButton4.Visible = False
        Me.CommandButton7.Visible = False
        Me.CommandButton9.Visible = False
        Me.CommandButton11.Visible = False
        Me.CommandButton12.Visible = False
End Sub
Attribute VB_Name = "Leht4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Public Function Username()
    Username1 = Environ$("UserName")
End Function
Attribute VB_Name = "Leht5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton17, 48, 5, MSForms, CommandButton"
Attribute VB_Control = "CommandButton15, 43, 6, MSForms, CommandButton"
Attribute VB_Control = "CommandButton14, 42, 7, MSForms, CommandButton"
Attribute VB_Control = "CommandButton13, 41, 8, MSForms, CommandButton"
Attribute VB_Control = "CommandButton12, 40, 9, MSForms, CommandButton"
Attribute VB_Control = "CommandButton5, 39, 10, MSForms, CommandButton"
Attribute VB_Control = "TempCombo, 30, 11, MSForms, ComboBox"
Attribute VB_Control = "CommandButton6, 23, 12, MSForms, CommandButton"
Attribute VB_Control = "CommandButton1, 5, 13, MSForms, CommandButton"
Attribute VB_Control = "CommandButton2, 9, 14, MSForms, CommandButton"
Attribute VB_Control = "CommandButton3, 10, 15, MSForms, CommandButton"
Attribute VB_Control = "CommandButton7, 20, 16, MSForms, CommandButton"
Attribute VB_Control = "CommandButton4, 44, 17, MSForms, CommandButton"
Attribute VB_Control = "CommandButton8, 51, 18, MSForms, CommandButton"
'T|fffd||fffd|MAKROD
Private Sub Salvesta_baasi()
' VIIB ANDMED BAASI
Sheets("Sisend").Select
    Application.ScreenUpdating = False
    Range("C29:C66").Select
    Selection.Copy
    Sheets("piimaraamat").Select
    Application.Run "Leht3.CommandButton2_Click"
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=True, Transpose:=True
    Application.CutCopyMode = False
    Selection.ListObject.ListRows.Add AlwaysInsert:=True ' LISA TABELISSE RIDA
    Sheets("Sisend").Select
    Range("b2").Select
    Call puhasta
    Sheets("piimaraamat").Select
    If CreateObject("Wscript.shell").Popup("Andmed edukalt baasi salvestatud.", 3, "", 0 + 64) = 1 Then
    End If
    Application.ScreenUpdating = True
End Sub

'*******************************************************
'NUPUD
Private Sub CommandButton1_Click()
'nimi1
If Intersect(ActiveCell, Range("L18:L22")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.Value = Worksheets("Sisend").Range("M45")
End Sub

Private Sub CommandButton2_Click()
'nimi2
If Intersect(ActiveCell, Range("L18:L22")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.Value = Range("M46")
End Sub
Private Sub CommandButton3_Click()
'nimi3
If Intersect(ActiveCell, Range("L18:L22")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.Value = Worksheets("Sisend").Range("M47")
End Sub
Private Sub CommandButton4_Click()
'lukusta
On Error Resume Next
Application.Run "lukku"
End Sub

Private Sub CommandButton5_Click()
'kellaaeg
If Intersect(ActiveCell, Range("B2:B3")) Is Nothing Then
Range("B2").Select
End If
   If IsEmpty(Range("B2").Value) = True Then
      ActiveCell.FormulaR1C1 = Now()
      Exit Sub
    End If
Range("B3").Select
ActiveCell.FormulaR1C1 = Now()
End Sub
Private Sub CommandButton6_Click()
    Call puhasta
End Sub
Private Sub CommandButton7_Click()
'SALVESTA
Application.ScreenUpdating = False
Dim kontroll As String
Dim PASS1   As String
Dim korras As String
kontroll = Range("a1")
korras = Range("E29")
If kontroll = "Sisestus|fffd|iguseta" Then GoTo Teade
If korras = False Then GoTo viga
PASS1 = Range("SISEND!N42").Value
    If ThisWorkbook.ReadOnly = True Then GoTo j|fffd|tka
    Worksheets("PIIMARAAMAT").Unprotect Password:=PASS1
    Call Salvesta_baasi
GoTo l|fffd|pp
j|fffd|tka: ' kirjutuskaitstud
    Application.Run "puhvrisse"
Exit Sub
GoTo l|fffd|pp
Teade:
MsgBox ("PUUDUB SISESTUS|fffd|IGUS!")
l|fffd|pp:
    Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
    ActiveWorkbook.Save
Application.ScreenUpdating = True
Exit Sub
viga: ' v|fffd|ljad puudulikult t|fffd|idetud
    If CreateObject("Wscript.shell").Popup("Andmev|fffd|ljad ebakorrektselt t|fffd|idetud, paranda sissekanne ja proovi uuesti.", 0, "", 0 + 16) = 1 Then
    End If
End Sub
Private Sub CommandButton8_Click()
'MUUDATUSTE INFO
Dim info As String
info = Sheets("Andmed").Range("L2").Value
MsgBox (info)
End Sub

Private Sub CommandButton12_Click() '-15m'
    On Error Resume Next
If Intersect(ActiveCell, Range("B2:B3")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    On Error Resume Next
    ActiveCell.Value = ActiveCell.Value - TimeSerial(0, 15, 0)
End Sub
Private Sub CommandButton13_Click() '-1t
    On Error Resume Next
If Intersect(ActiveCell, Range("B2:B3")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.Value = ActiveCell.Value - TimeSerial(1, 0, 0)
End Sub
Private Sub CommandButton14_Click() '+15m
    On Error Resume Next
If Intersect(ActiveCell, Range("B2:B3")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.Value = ActiveCell.Value + TimeSerial(0, 15, 0)
End Sub
Private Sub CommandButton15_Click() '+1t
    On Error Resume Next
If Intersect(ActiveCell, Range("B2:B3")) Is Nothing Then
MsgBox ("Sobimatu lahter.")
Exit Sub
End If
    ActiveCell.Value = ActiveCell.Value + TimeSerial(1, 0, 0)
End Sub
Private Sub CommandButton17_Click()
Dim alg As String
Dim uus As String
alg = Range("H6").Value
uus = Range("P41").Value
Range("h6").Select
ActiveCell.Value = uus
End Sub

'T|fffd|ITMINE
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
    If Not Intersect(Target, Range("b12:b14,d12:d15,g7:g8,g12:g15,g18:g22,i12:i15,i18:i21,B20:B22")) Is Nothing Then
        Application.EnableEvents = False
        If ActiveCell.Value = ChrW(&H2713) Then
            ActiveCell.ClearContents
        Else
            ActiveCell.Value = ChrW(&H2713)
        End If
        Cancel = True
    End If
    Application.EnableEvents = True
    
Dim str As String
Dim cboTemp As OLEObject
Dim ws As Worksheet
Set ws = ActiveSheet

If Intersect(Target, Range("B2:Q23")) Is Nothing Then Exit Sub
Set cboTemp = ws.OLEObjects("TempCombo")
  On Error Resume Next
  With cboTemp
  'clear and hide the combo box
    .ListFillRange = ""
    .LinkedCell = ""
    .Visible = False
  End With
On Error GoTo errHandler
  If Target.Validation.Type = 3 Then
    'if the cell contains
      'a data validation list
    Cancel = True
    Application.EnableEvents = False
    'get the data validation formula
    str = Target.Validation.Formula1
    str = Right(str, Len(str) - 1)
    With cboTemp
      'show the combobox with the list
      .Visible = True
      .Left = Target.Left - 100
      .Top = Target.Top
      .Width = Target.Width + 120
      .Height = Target.Height + 5
      .ListFillRange = str
      .LinkedCell = Target.Address
    End With
    cboTemp.Activate
    'open the drop down list automatically
    Me.TempCombo.DropDown
  End If
errHandler:
  Application.EnableEvents = True
  Exit Sub
End Sub
Private Sub TempCombo_LostFocus()
  With Me.TempCombo
    .Top = 10
    .Left = 10
    .Width = 0
    .ListFillRange = ""
    .LinkedCell = ""
    .Visible = False
    .Value = ""
  End With
End Sub

Private Sub TempCombo_KeyDown(ByVal _
     KeyCode As MSForms.ReturnInteger, _
     ByVal Shift As Integer)
  Select Case KeyCode
    Case 9 'Tab
      ActiveCell.Offset(0, 1).Activate
    Case 13 'Enter
      ActiveCell.Offset(1, 0).Activate
    Case Else
        'do nothing
  End Select
End Sub
'***********************************************************************

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
Dim cel As Range, targ  As Range
If Target.Cells.Count > 3 Then Exit Sub
Set targ = Range("N1:S26")
If targ Is Nothing Then Exit Sub

Select Case Target.Address
'liigub algusesse
Case "$N$1": p|fffd||fffd|sta: Case "$N$2": p|fffd||fffd|sta: Case "$N$3": p|fffd||fffd|sta: Case "$N$4": p|fffd||fffd|sta: Case "$N$5": p|fffd||fffd|sta: Case "$N$6": p|fffd||fffd|sta: Case "$N$7": p|fffd||fffd|sta: Case "$N$8": p|fffd||fffd|sta: Case "$N$9": p|fffd||fffd|sta: Case "$N$10": p|fffd||fffd|sta
Case "$N$12": p|fffd||fffd|sta: Case "$N$13": p|fffd||fffd|sta: Case "$N$14": p|fffd||fffd|sta: Case "$N$15": p|fffd||fffd|sta
Case "$M$17": p|fffd||fffd|sta: Case "$M$18": p|fffd||fffd|sta: Case "$M$19": p|fffd||fffd|sta: Case "$M$20": p|fffd||fffd|sta: Case "$M$22": p|fffd||fffd|sta: Case "$M$23": p|fffd||fffd|sta
Case "$R$10": p|fffd||fffd|sta: Case "$K$18": p|fffd||fffd|sta: Case "$I$23": p|fffd||fffd|sta: Case "$R$1": p|fffd||fffd|sta
'TOIMING
Case "$Q$1": puhasta: Case "$Q$2": SKV: Case "$Q$3": ATV: Case "$Q$4": FTK: Case "$Q$5": VPK: Case "$Q$6": AVLO: Case "$Q$7": ILV: Case "$Q$8": MUUV: Case "$Q$9": SIMSAL
Case "$Q$20": vp_dna: Case "$Q$21": vp_dakto: Case "$Q$22": vp_dna_dakto: Case "$Q$23": vp_lask: Case "$Q$24": vp_k|fffd||fffd|n
'KURITEO LIIK
Case "$S$2": eluv: Case "$S$3": lsk: Case "$S$4": terv: Case "$S$5": v|fffd|gi: Case "$S$6": r|fffd||fffd|v: Case "$S$7": velu: Case "$S$8": vasu: Case "$S$9": stae: Case "$S$10": sok: Case "$S$11": vso: Case "$S$12": vvar
Case "$S$13": t|fffd||fffd|: Case "$S$14": tul: Case "$S$15": htul: Case "$S$16": liik: Case "$S$17": hliik
'SALVESTATUD AADRESS
Case "$S$19": Aadress1: Case "$S$20": Aadress2: Case "$S$21": Aadress3: Case "$S$22": Aadress4
Case "$S$23": Aadress5: Case "$S$24": Aadress6: Case "$S$25": Aadress7: Case "$S$26": Aadress8
End Select
End Sub
Private Sub puhasta()
' kustutab v|fffd|ljad sisendist
Application.DisplayAlerts = False
Application.ScreenUpdating = False
Dim pass    As String
pass = Range("SISEND!N41").Value
Sheets("SISEND").Select
Sheets("SISEND").Unprotect Password:=pass
Range("B2:C3,B6:E7,H1:H4,b12:b14,d12:d15,g12:g15,i12:i15,b18:D18,g18:g22,i18:i21,h23,h6,g7:g8,h9,k29,N29,k3:m9,k12:m15,l18:l19,l22:l23,B20:B22").Locked = False
    Range("H1").Select
With ActiveCell
    .Locked = False
    .NumberFormat = "0"
    .Font.Name = "Times new Roman"
    .Font.Size = 14
    .Font.FontStyle = "Bold"
    .Font.Color = vbBlack
End With
Sheets("SISEND").Protect Password:=pass
Range("B2:C3,B6:E7,H1:H4,b12:b14,d12:d15,g12:g15,i12:i15,b18:D18,g18:g22,i18:i21,h23,h6,g7:g8,h9,k29,N29,k3:m9,k12:m15,l18:l19,l22:l23,B20:B22").ClearContents
Range("q19").FormulaR1C1 = "KAHTLUSTATAV": Range("B2").Select
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub
Private Sub p|fffd||fffd|sta()
Range("b2").Select
End Sub
'AADRESSID
Private Sub Aadress1()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K30").Value: Range("B7").FormulaR1C1 = Range("L30").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress2()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K31").Value: Range("B7").FormulaR1C1 = Range("L31").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress3()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K32").Value: Range("B7").FormulaR1C1 = Range("L32").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress4()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K33").Value: Range("B7").FormulaR1C1 = Range("L33").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress5()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K34").Value: Range("B7").FormulaR1C1 = Range("L34").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress6()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K35").Value: Range("B7").FormulaR1C1 = Range("L35").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress7()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K36").Value: Range("B7").FormulaR1C1 = Range("L36").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub
Private Sub Aadress8()
Application.ScreenUpdating = False
Range("B6").FormulaR1C1 = Range("K37").Value: Range("B7").FormulaR1C1 = Range("L37").Value: Range("B2").Select
Application.ScreenUpdating = True
End Sub

' TOIMINGUD
Private Sub SKV()
Range("h4").FormulaR1C1 = "s|fffd|ndmuskoha vaatlus": Range("b18").FormulaR1C1 = "fotografeeritud": Call k|fffd|si
End Sub
Private Sub ATV()
Range("B6").FormulaR1C1 = Range("L48").Value: Range("B7").FormulaR1C1 = Range("M48").Value: Range("h4").FormulaR1C1 = "asit|fffd|endi vaatlus": Range("b18").FormulaR1C1 = "fotografeeritud": Range("h6").FormulaR1C1 = Range("Q29").Value: Range("B2").Select
End Sub
Private Sub FTK() 'fototabeli koostamine
Range("B6").FormulaR1C1 = Range("L48").Value: Range("B7").FormulaR1C1 = Range("M48").Value: Range("h4").FormulaR1C1 = "materjali vormistamine": Range("K29").FormulaR1C1 = "Fototabeli koostamine ": Range("B2").Select
End Sub
Private Sub VPK() 'vaatlusprotokolli kirjutamine
Range("B6").FormulaR1C1 = Range("L48").Value: Range("B7").FormulaR1C1 = Range("M48").Value: Range("h4").FormulaR1C1 = "materjali vormistamine": Range("K29").FormulaR1C1 = "Protokolli  vormistamine ": Range("B2").Select
End Sub
Private Sub ILV() 'isiku l|fffd|bivaatus
Range("h4").FormulaR1C1 = "isiku l|fffd|bivaatus": Range("b18").FormulaR1C1 = "fotografeeritud": Range("h6").FormulaR1C1 = Range("Q31").Value: Range("B2").Select
End Sub
Private Sub AVLO() 'Auto vaatlus liiklus|fffd|nnetusej|fffd|rgselt
Call ATV: Call dna: Range("B2").Select
End Sub
Private Sub MUUV() 'Muu vaatlus
Range("h4").FormulaR1C1 = "muu vaatlus (korduv)": Range("b18").FormulaR1C1 = "fotografeeritud": Call k|fffd|si
End Sub
Private Sub SIMSAL()
Range("B6").FormulaR1C1 = Range("L48").Value: Range("B7").FormulaR1C1 = Range("M48").Value: Range("h4").FormulaR1C1 = "SIMSALAPIM": Range("I18").FormulaR1C1 = ChrW(&H2713): Range("B2").Select
End Sub
Private Sub k|fffd|si()
        If CreateObject("Wscript.shell").Popup("KAS KOOSTATAKSE KA VAATLUSPROTOKOLL?", 0, "", 4 + 32) = 7 Then GoTo ei
Range("h6").FormulaR1C1 = Range("Q30").Value: Range("B2").Select
    Exit Sub
ei:
Range("h6").FormulaR1C1 = Range("Q31").Value: Range("B2").Select
End Sub

'******************************************************************************************************
'V|fffd|RDLUSPROOVID
Private Sub v|fffd|rdlusproov()
Selection.Copy: Range("K29").Select: Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone
Range("h4").FormulaR1C1 = "v|fffd|rdlusmaterjali v|fffd|tmine": Range("k3:m9").Select
End Sub
Private Sub vp_dna()
Call dna: Range("P9").Select: Call v|fffd|rdlusproov: Call dna
End Sub
Private Sub vp_dakto()
Range("P10").Select: Call v|fffd|rdlusproov: Call valik
End Sub
Private Sub vp_dna_dakto()
Range("P11").Select: Call v|fffd|rdlusproov: Call dna
Call valik
'L|fffd||fffd|ne prefektuuri erisus
'If Range("A1") = "L|fffd||fffd|ne prefektuur" Then Call SJK_dakto: Range("b13").ClearContents: Exit Sub
End Sub
Private Sub vp_lask()
Call lasu: Range("P12").Select: Call v|fffd|rdlusproov
End Sub
Private Sub vp_k|fffd||fffd|n()
Range("P13").Select: Call v|fffd|rdlusproov: Call dna
End Sub

'KORDUVAD
Private Sub dna()
Range("I12").FormulaR1C1 = ChrW(&H2713): Range("k3:m9").Select
End Sub
Private Sub lasu()
Range("G12").FormulaR1C1 = ChrW(&H2713): Range("k3:m9").Select
End Sub
Private Sub laip_lisa()
Range("h6").FormulaR1C1 = Range("Q31").Value: Range("b18").FormulaR1C1 = "fotografeeritud"
End Sub
' ERISUSED
Private Sub SJK_dakto()
Range("B14").FormulaR1C1 = ChrW(&H2713)
End Sub
Private Sub AFIS_dakto()
Range("B13").FormulaR1C1 = ChrW(&H2713)
End Sub
Private Sub valik()
    If Range("Q19").Value = "TUNNISTAJA" Then
    Call SJK_dakto
Else
    End If
    If Range("Q19").Value = "KANNATANU" Then
    Call SJK_dakto
Else
    End If
    If Range("Q19").Value = "KAHTLUSTATAV" Then
    Call AFIS_dakto
Else
    End If
    If Range("Q19").Value = "S|fffd||fffd|DISTATAV" Then
    Call AFIS_dakto
Else
    End If
If Range("Q19").Value = "LAIP" Then
    Call SJK_dakto: Call laip_lisa
End If
End Sub

'LIIGID
Private Sub eluv()
Range("h2").FormulaR1C1 = "eluvastane": Range("B2").Select
End Sub
Private Sub lsk()
Range("h2").FormulaR1C1 = "leitud v|fffd|givallatunnusteta surnukeha": Range("B2").Select
End Sub
Private Sub terv()
Range("h2").FormulaR1C1 = "tervisevastane": Range("B2").Select
End Sub
Private Sub v|fffd|gi()
Range("h2").FormulaR1C1 = "v|fffd|gistamine v|fffd|i muu seksuaalse enesem|fffd||fffd|ramise vastane": Range("B2").Select
End Sub
Private Sub r|fffd||fffd|v()
Range("h2").FormulaR1C1 = "r|fffd||fffd|vimine": Range("B2").Select
End Sub
Private Sub velu()
Range("h2").FormulaR1C1 = "vargus eluruumist": Range("B2").Select
End Sub
Private Sub vasu()
Range("h2").FormulaR1C1 = "vargus asutusest": Range("B2").Select
End Sub
Private Sub stae()
Range("h2").FormulaR1C1 = "sissetungimine eluruumi, asutusse": Range("B2").Select
End Sub
Private Sub sok()
Range("h2").FormulaR1C1 = "s|fffd|iduki vargus/omavoliline kasutamine": Range("B2").Select
End Sub
Private Sub vso()
Range("h2").FormulaR1C1 = "vargus s|fffd|idukist": Range("B2").Select
End Sub
Private Sub vvar()
Range("h2").FormulaR1C1 = "v|fffd|hev|fffd||fffd|rtuslik varavastane (kelder, garaa|fffd|, abihooned jmt))": Range("B2").Select
End Sub
Private Sub t|fffd||fffd|()
Range("h2").FormulaR1C1 = "raske t|fffd||fffd||fffd|nnetus": Range("B2").Select
End Sub
Private Sub tul()
Range("h2").FormulaR1C1 = "tulekahju": Range("B2").Select
End Sub
Private Sub htul()
Range("h2").FormulaR1C1 = "hukkunuga tulekahju": Range("B2").Select
End Sub
Private Sub liik()
Range("h2").FormulaR1C1 = "liiklus|fffd|nnetus": Range("B2").Select
End Sub
Private Sub hliik()
Range("h2").FormulaR1C1 = "hukkunuga liiklus|fffd|nnetus": Range("B2").Select
End Sub
'Boonused
Private Sub UserForm_Click()
    Worksheets("Sisend").Select
'    ActiveSheet.CommandButton5.ForeColor = RGB(192, 0, 0)' tumeroheline 111, 187, 135
'    ActiveSheet.CommandButton5.BackColor = RGB(192, 0, 0)
    CommandButton1.Caption = Leht5.Range("N45").Value
    CommandButton2.Caption = Leht5.Range("N46").Value
    CommandButton3.Caption = Leht5.Range("N47").Value
'    CommandButton4.Caption = Leht5.Range("N48").Value
End Sub
Public Function Username()
    Username1 = Environ$("UserName")
End Function
Attribute VB_Name = "Module1"
  'AJAARVESTUS
'https://www.mrexcel.com/forum/excel-questions/47274-timeout-use-save-close-down-automatically.html
Dim DownTime As Date
Private Sub SetTime()
'Dim DownTime As Date
DownTime = Now + TimeValue("00:10:00")
Application.StatusBar = "BAAS SULGUB: " & DownTime
Application.OnTime DownTime, "ShutDown"
End Sub
Private Sub ShutDown()
Dim objShell As Object
Set objShell = CreateObject("Shell.Application")
objShell.MinimizeAll
    If CreateObject("Wscript.shell").Popup("KAS SOOVID V|fffd|LJUDA?", 7, "BAAS SULETAKSE, KUI VASTATA JAH", 4 + 32) = 7 Then
        Application.Run "Disable"
        Application.Run "SetTime"
        ThisWorkbook.Activate
        Application.WindowState = xlMaximized
        Exit Sub
   End If
   ThisWorkbook.Close True 'Or ActiveWorkbook
End Sub

Private Sub Disable()
On Error Resume Next
Application.OnTime EarliestTime:=DownTime, Procedure:="ShutDown", Schedule:=False
End Sub

Function LetterOut(rng As Range)
Dim i As Integer
For i = 1 To Len(rng)
Select Case Asc(Mid(rng.Value, i, 1))
Case 0 To 31, 46 To 57, 123 To 197
LetterOut = LetterOut & Mid(rng.Value, i, 1)
End Select
Next i
End Function

Private Sub Filtrid_maha()
Application.ScreenUpdating = False
'v|fffd|tab piimaraamatu filtrid maha
On Error GoTo v|fffd|lju
Dim PASS1   As String
PASS1 = Range("SISEND!N42").Value
Sheets("piimaraamat").Select
Application.Run "leht3.Vaba_rida"
Application.Run "leht3.nupud"

With ActiveSheet
    .Unprotect Password:=PASS1
    .Columns("C:D").AutoFit
    .ShowAllData
v|fffd|lju:
    .Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
End With
Application.ScreenUpdating = True
End Sub

Private Sub STATISTIKA()
Application.DisplayAlerts = False
Application.ScreenUpdating = False
'Dim ver As String
Dim arv As Integer
'ver = Application.Version
arv = Range("STATISTIKA!E13").Value
If Range("sisend!f62") = 1 Then
Exit Sub
End If
'If ver < "16" Then
'    MsgBox ("TEOSTATAV ALATES OFFICE 2016")
'    Exit Sub
'End If
If arv < 2 Then
    MsgBox ("VALIMIGA ALLA KAHE POLE M|fffd|TET ARUANNET KOOSTADA")
    Exit Sub
End If
With ActiveSheet.PivotTables("PivotTable2")
   For Each c In .DataBodyRange.Resize( _
      .DataBodyRange.Rows.Count + .ColumnGrand, 1)
      c.ShowDetail = True
   Next c
 End With
' korrasta Makro
Set ws = ActiveSheet
    If ws.Name Like "Sheet*" Then GoTo edasi
    If ws.Name Like "Leht*" Then GoTo edasi
    MsgBox "Seda lahte ei saa liigutada"
    Exit Sub
edasi:
    ActiveSheet.Move
'murra ridu
    Range("F:H,J:L,O:Q,AD:AE").Select
    With Selection
        .HorizontalAlignment = xlGeneral
        .VerticalAlignment = xlBottom
        .WrapText = True
        .Orientation = 0
        .IndentLevel = 0
        .ReadingOrder = xlContext
    End With
'laius
    Range("B:B, F:F, M:M, AJ:AJ").ColumnWidth = 14
    Range("I:I, K:L, N:P").ColumnWidth = 20
    Range("E:E").ColumnWidth = 8
    Range("G:G").ColumnWidth = 11.5
    Range("H:H").ColumnWidth = 24
    Range("J:J").ColumnWidth = 60
    Range("Q:AI").ColumnWidth = 5.14
    Range("AD:AE").ColumnWidth = 16
    Range("C:D, G:P, AD:AE").EntireColumn.AutoFit 'kontrolli
'l|fffd|pp maha
    Columns("AK:BE").Select
    Selection.Delete Shift:=xlToLeft
    Rows("1:1").Select
    ActiveSheet.ListObjects(1).TableStyle = "TableStyleLight1"
    With Selection.Font
        .Name = "Calibri"
        .Size = 12
        .ThemeColor = xlThemeColorLight1
        .TintAndShade = 0
        .ThemeFont = xlThemeFontMinor
    End With
    With Selection
        .WrapText = True
        .HorizontalAlignment = xlCenter
        .VerticalAlignment = xlCenter
        .Orientation = 90
        .IndentLevel = 0
        .ReadingOrder = xlContext
    End With
    With ActiveWindow
        If .FreezePanes Then .FreezePanes = False
        .SplitColumn = 10
       .SplitRow = 1
        .FreezePanes = True
    End With
Call valmis1
Range("B2").Select
With ActiveCell
    .NumberFormat = "0"
End With
Dim activeTable As String
Dim tabel As String
activeTable = ActiveSheet.ListObjects(1).Name
tabel = activeTable & "[menetluse number]"
    Selection.AutoFill Destination:=Range(tabel), Type:= _
        xlFillFormats
'LISA KOKKUV|fffd|TE
    Dim used As Range
    Set used = ActiveSheet.UsedRange
    Dim lastRow As Integer
    lastRow = used.Row + used.Rows.Count - 1
    Range("A" & lastRow + 1).Select
    ActiveCell.Formula = "=subtotal(103,A2:A" & lastRow & ")"
ActiveSheet.Range("A" & lastRow + 1 & ":AJ" & lastRow + 1).FillRight
        
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub
Private Sub valmis1()
Dim cell As Range
Dim c As Long
Dim n As Long
    Range("A2:AM2").Select
    Range(Selection, Selection.End(xlDown)).Select
With Selection
.Value = .Value
End With
    n = Rows(1).Find(what:="*", SearchDirection:=xlPrevious).Column
    For c = 1 To n
        Cells(1, c).EntireColumn.Hidden = (Application.CountA(Columns(c)) < 2)
    Next c
    End Sub
'**************************************************
'MITTE IGAP|fffd|EVASED
Private Sub Uude_Baasi()
Application.ScreenUpdating = False
Application.DisplayAlerts = False
    Dim koht As String
    Dim nimi As String
    nimi = Range("SISEND!H48").Value
    Dim ver1    As Date
    Dim ver2    As Date
    Dim PASS1   As String
    Dim PASS2   As String
    Dim Prompt          As String
    Dim Title           As String
    Dim userpass        As String

ver1 = Range("SISEND!Q27").Value
PASS1 = Range("SISEND!N42").Value

koht = ThisWorkbook.Path
Set Target = Workbooks.Open(koht & "\t|fffd|hi baas.xlsm", UpdateLinks:=0)
ver2 = Range("SISEND!Q27").Value
PASS2 = Range("SISEND!N42").Value

If ver1 > ver2 Then
Prompt = "Vanemale baasip|fffd|hjale kopeerida ei saa"
Title = ""
MsgBox Prompt, vbCritical, Title
Exit Sub
End If

Prompt = "SISESTA SALAS|fffd|NA"
Title = "BAASI KOPEERIMISEKS "
userpass = InputBox(Prompt, Title)
If userpass <> "piimaraamat" Then
Prompt = "SISESTASID VALE SALAS|fffd|NA, ANDMEID EI KOPEERITUD"
Title = ""
MsgBox Prompt, vbCritical, Title
Exit Sub
End If

ThisWorkbook.Activate
Worksheets("piimaraamat").Unprotect Password:=PASS1
Dim lRow As Long
Dim esimene As String
Dim teine As String
Dim kolmas As String
Sheets("piimaraamat").Select
lRow = Cells(Rows.Count, 1).End(xlUp).Row
esimene = "B2:D" & lRow
teine = "F2:AN" & lRow
kolmas = "AQ2:AR" & lRow
    
Windows("t|fffd|hi baas.xlsm").Activate
Worksheets("piimaraamat").Unprotect Password:=PASS2
ThisWorkbook.Activate
    Sheets("piimaraamat").Select
    Range(esimene).Select
    Selection.Copy
Windows("t|fffd|hi baas.xlsm").Activate
    Sheets("piimaraamat").Select
    Range("B2").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone
ThisWorkbook.Activate
    Range(teine).Select
    Selection.Copy
Windows("t|fffd|hi baas.xlsm").Activate
    Range("F2").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone
ThisWorkbook.Activate
    Range(kolmas).Select
    Selection.Copy
Windows("t|fffd|hi baas.xlsm").Activate
    Range("AQ2").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone
ThisWorkbook.Activate
    Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
Windows("t|fffd|hi baas.xlsm").Activate
    Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS2
    MsgBox "ANDMED IMPORDITUD"
ActiveWorkbook.SaveAs nimi
ActiveWorkbook.Close Savechanges:=True
ThisWorkbook.Activate
ThisWorkbook.Close Savechanges:=False
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub

Private Sub Puhasta_piimaraamat()
' t|fffd|hjenda piimaraamat
Application.DisplayAlerts = False
Application.ScreenUpdating = False
    Dim pass            As String
    Dim Prompt          As String
    Dim Title           As String
    Dim userpass        As String
    Dim PASS1           As String
    Dim nimi As String
On Error GoTo viga
    pass = Range("SISEND!N41").Value
    PASS1 = Range("SISEND!N42").Value
    nimi = Range("SISEND!F48").Value
    Prompt = "sisesta salas|fffd|na"
    Title = "BAASI PUHASTAMISEKS (S|fffd|ilib isikkoosseis ja aadressid!"
    userpass = InputBox(Prompt, Title)
If userpass <> pass Then
Prompt = "SISESTASID VALE SALAS|fffd|NA, ANDMEID EI KUSTUTATUD"
Title = ""
MsgBox Prompt, vbCritical, Title
Exit Sub
End If
'ThisWorkbook.Activate
    Worksheets("piimaraamat").Unprotect Password:=PASS1
Sheets("piimaraamat").Select
    Rows("4:4").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Delete Shift:=xlUp
        Range("D3").Select
        r = ActiveCell.Row
        Range(Cells(r, 2), Cells(r, 4)).Select: Selection.ClearContents
        Range(Cells(r, 6), Cells(r, 40)).Select: Selection.ClearContents
        Range(Cells(r, 43), Cells(r, 44)).Select: Selection.ClearContents
        Range("D2").Select
        r = ActiveCell.Row
        Range(Cells(r, 2), Cells(r, 4)).Select: Selection.ClearContents
        Range(Cells(r, 6), Cells(r, 40)).Select: Selection.ClearContents
        Range(Cells(r, 43), Cells(r, 44)).Select: Selection.ClearContents
        Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
Application.CutCopyMode = False
Application.Run "Leht3.vaba_rida"
MsgBox "T|fffd|HI BAAS LOODUD"
ActiveWorkbook.SaveAs nimi
Application.DisplayAlerts = True
Application.ScreenUpdating = True
ThisWorkbook.Close Savechanges:=False
Exit Sub
viga:
MsgBox ("ARHIIVI EI SAA KUSTUTADA")
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub

Private Sub puhvrisse()
Application.ScreenUpdating = False
' puhvrisse Makro
On Error GoTo v|fffd|lju
Dim puhver      As String
Dim siht        As String
puhver = Range("H30")
siht = Range("H29")
Set Target = Workbooks.Open(puhver, UpdateLinks:=0)
ThisWorkbook.Activate
    Sheets("Sisend").Select
    Range("C29:C66").Select
    Selection.Copy
Windows(siht).Activate
    Sheets("piimaraamat").Select
    Range("A1").Select
    Selection.End(xlToRight).Select
    Row = 0
    clms = 1
    ActiveCell.Offset(rw, clms).Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone
    ActiveWorkbook.Close Savechanges:=True
'puhastab
    Sheets("Sisend").Select
    Range("B2:C3,B6:E7,H1:H4,b12:b14,d12:d15,g12:g15,i12:i15,b18:D18,g18:g22,i18:i21,h23,h6,g7:g8,h9,k3:m9,k12:m15,l18:l19,l22:l23,B20:B22").ClearContents
    With Range("b2:B3"): .Value = Now()
    End With
    If CreateObject("Wscript.shell").Popup("Andmed edukalt puhverfaili salvestatud. Numbri saab alles siis, kui andmed baasi |fffd|nnestub importida.", 5, "", 0 + 32) = 1 Then
    ActiveWorkbook.Close Savechanges:=False
    Application.ScreenUpdating = True
    Application.DisplayAlert = True
    End If
    Exit Sub
v|fffd|lju:
    If CreateObject("Wscript.shell").Popup("PUHVERFAIL PUUDUB! SAAB SALVESTADA VAID OTSE BAASI. OOTA, KUNI SEE VABANEBB", 0, "", 0 + 64) = 1 Then
    End If
 Application.ScreenUpdating = True
 Application.DisplayAlert = True
End Sub

Private Sub puhvrist()
Application.ScreenUpdating = False
On Error GoTo v|fffd|lju
Dim puhver      As String
Dim siht        As String
Dim PASS1   As String
Dim kontroll1 As String
Dim kontroll2 As String
kontroll1 = Range("SISEND!H28").Value
kontroll2 = Range("SISEND!H32").Value
If kontroll1 <> kontroll2 Then
Exit Sub
End If
PASS1 = Range("SISEND!N42").Value
puhver = Range("H30")
siht = Range("H29")
Set Target = Workbooks.Open(puhver, UpdateLinks:=0)
Windows(siht).Activate
    If ActiveSheet.Range("C2").Value = "" Then GoTo j|fffd|tka
i = 2
While Not IsEmpty(Cells(i, 3))
    Range("C1:C39").Select
    Selection.Copy
ThisWorkbook.Activate
    Sheets("piimaraamat").Select
    Application.Run "Leht3.vaba_rida"
    Row = 1
    clms = -1
   ActiveCell.Offset(rw, clms).Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=True, Transpose:=True
    Worksheets("PIIMARAAMAT").Unprotect Password:=PASS1
    Selection.ListObject.ListRows.Add AlwaysInsert:=True ' LISA TABELISSE RIDA
    Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
Windows(siht).Activate
    Columns("C:C").Select
    Selection.Delete Shift:=xlToLeft
i = i
Wend
    ActiveWorkbook.Close Savechanges:=True
ThisWorkbook.Activate
    Application.CutCopyMode = False
    ActiveWorkbook.Save
    If CreateObject("Wscript.shell").Popup("ANDMED PUHVERFAILIST |fffd|LE KANTUD", 3, "", 0 + 64) = 1 Then
    End If
Application.ScreenUpdating = True
Exit Sub
j|fffd|tka:
    ActiveWorkbook.Close , False
ThisWorkbook.Activate
v|fffd|lju:
Application.ScreenUpdating = True
End Sub

'*********************************
'ANDMEBAASI ADMINISTREERIMISEKS
Private Sub Peidust_v|fffd|lja1()
On Error Resume Next
    Columns.EntireColumn.Hidden = False
    Rows.EntireRow.Hidden = False
End Sub
Private Sub LUKKU()
'baas lukku ja maha
Application.ScreenUpdating = False
Dim adm  As String
Dim pass    As String
Dim PASS1   As String
Dim kontroll    As String
adm = Sheets("SISEND").Range("N43").Value
If adm >= 2 Then
pass = Sheets("SISEND").Range("N41").Value
PASS1 = Sheets("SISEND").Range("N42").Value
kontroll = Sheets("SISEND").Range("T29").Value
On Error Resume Next
Worksheets("SISEND").Select
If kontroll = 1 Then GoTo LUKKU
    Worksheets("SISEND").Unprotect Password:=pass
    Worksheets("PIIMARAAMAT").Unprotect Password:=PASS1
    Worksheets("ANDMED").Visible = xlSheetVisible
    Worksheets("Andmed").Select
    Call Peidust_v|fffd|lja1
    Worksheets("Aadressid").Visible = xlSheetVisible
    Worksheets("SISEND").Select
        With ActiveWindow
        If .FreezePanes Then .FreezePanes = True
        .FreezePanes = False
    End With
    Range("T30").Value = ""
    Call Peidust_v|fffd|lja1
Sheets("SISEND").ScrollArea = ""
Sheets("STATISTIKA").ScrollArea = ""
Application.ScreenUpdating = True
Exit Sub
LUKKU:
'peida
    Worksheets("STATISTIKA").Select
    Columns("A").EntireColumn.Hidden = True
    Columns("H:Q").EntireColumn.Hidden = True
    Range("A2").Select
    Worksheets("Sisend").Select
    Range("T30").Value = "X"
       Columns("O:P").EntireColumn.Hidden = True
       Columns("V:AA").EntireColumn.Hidden = True
       Rows("28:67").EntireRow.Hidden = True
    Range("a29").EntireRow.Select
Sheets("SISEND").ScrollArea = "A1:T27"
'lukku
    Worksheets("SISEND").Protect Password:=pass
    Worksheets("PIIMARAAMAT").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
    Worksheets("Aadressid").Visible = xlSheetVeryHidden
    Worksheets("ANDMED").Visible = xlSheetVeryHidden
    Worksheets("SISEND").Select
End If
Application.ScreenUpdating = True
End Sub

Private Sub Muuda_arhiiviks()
' t|fffd|hjenda piimaraamat
Application.DisplayAlerts = False
Application.ScreenUpdating = False
    Dim adm   As String
    Dim pass            As String
    Dim Prompt          As String
    Dim Title           As String
    Dim userpass        As String
adm = Sheets("SISEND").Range("N43").Value
If adm >= 2 Then
pass = Sheets("SISEND").Range("N41").Value
    Prompt = "sisesta salas|fffd|na"
    Title = "ARHIIVIKS MUUTMISEKS"
    userpass = InputBox(Prompt, Title)
If userpass <> pass Then
    Prompt = "SISESTASID VALE SALAS|fffd|NA, MUUTUSI EI TEHTUD"
    Title = ""
    MsgBox Prompt, vbCritical, Title
    Exit Sub
End If
    Worksheets("SISEND").Unprotect Password:=pass
    Worksheets("ANDMED").Visible = xlSheetVisible
    Worksheets("Aadressid").Visible = xlSheetVisible
For Each Sheet In ActiveWorkbook.Worksheets
     If Sheet.Name = "Aadressid" Then
          Sheet.Delete
     End If
Next Sheet
For Each Sheet In ActiveWorkbook.Worksheets
     If Sheet.Name = "ANDMED" Then
          Sheet.Delete
     End If
Next Sheet
Range("SISEND!C1").Value = "ARHIIV"
Worksheets("SISEND").Protect Password:=pass
Worksheets("SISEND").Visible = xlSheetHidden
Worksheets("PIIMARAAMAT").Select
MsgBox "Valmis"
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End If
End Sub

Sub H|fffd|DA()
Worksheets("SISEND").Visible = xlSheetVisible
End Sub

Attribute VB_Name = "Sellest_t|fffd||fffd|vihikust"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
On Error Resume Next
Application.DisplayAlerts = False
Application.ScreenUpdating = False
Application.WindowState = xlMaximized

Dim kontroll As String
Dim pass    As String
Dim PASS1 As String
Dim ridu As Integer
Dim andmeid As Integer
Dim alusta As Integer
Dim siit As String
Dim algus As Integer
Dim l|fffd|pp As Integer
Dim l|fffd|bi As Date
l|fffd|bi = Now
pass = Sheets("SISEND").Range("N41").Value
PASS1 = Sheets("SISEND").Range("N42").Value
ridu = Sheets("SISEND").Range("F60").Value
andmeid = Sheets("SISEND").Range("F62").Value
algus = Sheets("SISEND").Range("F63").Value
l|fffd|pp = Sheets("SISEND").Range("F64").Value
alusta = Sheets("SISEND").Range("F65").Value
siit = alusta & ":" & alusta

Range("SISEND!M45").Value = Application.Username
Dim adm As String
Dim testkasutaja As String
adm = Sheets("SISEND").Range("N43").Value
    If adm = 3 Then
    Prompt = "SISESTA NIMI"
    Title = "TEISE KASUTAJA TESTIMISEKS"
    testkasutaja = InputBox(Prompt, Title)
        If testkasutaja <> "" Then
        Range("SISEND!M45").Value = testkasutaja
        Else
        Range("SISEND!M45").Value = Application.Username
        End If
End If

adm = Sheets("SISEND").Range("N43").Value
If adm = -1 Then GoTo Vaatleja:
kontroll = Leht5.Range("C1")
If kontroll = "ARHIIV" Then GoTo l|fffd|pp:
If l|fffd|bi > "01.01.2020 05:00:00" Then GoTo Arhiveeri:
If algus <> l|fffd|pp Then GoTo Viga_baasis
Sheets("Statistika").Select
    Rows("1:27").Select
    ActiveWindow.Zoom = True
    Range("B2").Select
    Application.Run "Filtrid_maha"
If ridu - andmeid > 3 Then
Sheets("Piimaraamat").Select
    Worksheets("PIIMARAAMAT").Unprotect Password:=PASS1
    Rows(siit).Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Delete Shift:=xlUp
Application.Run "Leht3.CommandButton2_Click"
    Worksheets("piimaraamat").Protect contents:=True, AllowFiltering:=True, AllowInsertingRows:=True, userinterfaceonly:=True, Password:=PASS1
End If

Worksheets("SISEND").Visible = True
Sheets("SISEND").Select
Sheets("SISEND").ScrollArea = "A1:T27"
    Columns("A:S").Select
    ActiveWindow.Zoom = True
    Application.Run "Leht5.UserForm_Click"
    If ThisWorkbook.ReadOnly = True Then GoTo l|fffd|pp
    Application.Run "PUHVRIST"
GoTo l|fffd|pp
Viga_baasis:
MsgBox "BAASIS ON T|fffd|HI ALGUS V|fffd|I L|fffd|PUKELLAAEG. PARANDA SEE ENNE UUE SISSEKANDE TEGEMIST. VIGANE LAHTER ON ROOSA."
Sheets("PIIMARAAMAT").Select
GoTo l|fffd|pp
Exit Sub

Arhiveeri:
'testversioonis
MsgBox "Sinu arvuti seadesd on valed ja tapavad baasi. Enne korda tegemist baasi kasutada ei saa"
ThisWorkbook.Close False
Exit Sub

'|fffd|ige
Worksheets("SISEND").Select
Worksheets("SISEND").Unprotect Password:=pass
Range("C1").Value = "ARHIIV"
Worksheets("SISEND").Visible = xlSheetVeryHidden
Sheets("SISEND").Protect Password:=pass
GoTo l|fffd|pp:
Sheets("PIIMARAAMAT").Select
Exit Sub

Vaatleja:
Worksheets("SISEND").Visible = xlSheetHidden
Sheets("PIIMARAAMAT").Select
Application.Run "leht3.nupud"
l|fffd|pp:
Range("B2").Select
Application.DisplayAlerts = True
Application.ScreenUpdating = True
End Sub

Function LetterOut(rng As Range)
Dim i As Integer
For i = 1 To Len(rng)
Select Case Asc(Mid(rng.Value, i, 1))
Case 0 To 31, 46 To 57, 123 To 197
LetterOut = LetterOut & Mid(rng.Value, i, 1)
End Select
Next i
End Function
Private Sub Workbook_Open1()
Application.Run "SetTime"
End Sub
Private Sub Workbook_BeforeClose(Cancel As Boolean)
Application.Run "Disable"
End Sub
Private Sub Workbook_SheetCalculate(ByVal Sh As Object)
Application.Run "Disable"
Application.Run "SetTime"
End Sub
Private Sub Workbook_SheetSelectionChange(ByVal Sh As Object, ByVal Target As Excel.Range)
Application.Run "Disable"
Application.Run "SetTime"
End Sub
Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)
Dim adm  As String
adm = Sheets("SISEND").Range("N43").Value
If adm = -1 Then
    If (SaveAsUI = False) Then
        MsgBox "PUUDUB SALVESTUSTUS|fffd|IGUS."
        Cancel = True
        End If
End If
End Sub


INQUEST-PP=macro
