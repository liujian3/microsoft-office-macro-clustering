Attribute VB_Name = "Common"

'*********************************************************************8
'***
'*    Common Module across ALL Workbooks except EntFuncs.Xls
'***
'*********************************************************************8

Option Explicit
Option Private Module

Global EntServer As Object
Global ServerSet As Boolean


' returns True if the passed Nominal Code is valid
Public Function ValidCompany(Company$) As Boolean
    Company$ = Trim(Company$)
    
    If (Len(Company) > 0) And (Len(Company) <= 6) Then
        ValidCompany = True
    Else
        Error 516
        ValidCompany = False
    End If
End Function
 

' returns True if the passed General Ledger Code is valid
Public Function ValidGLCode(GLCode As Long) As Boolean
    If (GLCode <= 0) Then
        If (GLCode < 0) Then
            Error 511
        End If
        
        ValidGLCode = False
    Else
        ValidGLCode = True
    End If
End Function


' returns True if the passed year is valid
Public Function ValidYear(TheYear%) As Boolean
    If ((TheYear > 1900) And (TheYear < 2100)) Or (TheYear = -99) Then
        ' Actual Year or F6 Year
        ValidYear = True
    Else
        Error 512
        ValidYear = False
    End If
End Function


' returns True if the passed period is valid
Public Function ValidPeriod(ThePeriod%) As Boolean
    If ((ThePeriod >= 0) And (ThePeriod <= 99)) Or (ThePeriod = -99) Or (ThePeriod = -98) Or ((ThePeriod >= 101) And (ThePeriod <= 199)) Then
        ' Actual Period or F6 Period or CTD or CTD Period Offset
        ValidPeriod = True
    Else
        Error 513
        ValidPeriod = False
    End If
End Function

Public Function ValidTransactionPeriod(ThePeriod%) As Boolean
    If (ThePeriod >= 1) And (ThePeriod <= 99) Then
        ' Actual Period or F6 Period or CTD or CTD Period Offset
        ValidTransactionPeriod = True
    Else
        Error 513
        ValidTransactionPeriod = False
    End If
End Function


' returns True if the passed currency is valid
Public Function ValidCcy(TheCcy%) As Boolean
    If (TheCcy < 0) Or (TheCcy > 90) Then
        Error 514
        ValidCcy = False
    Else
        ValidCcy = True
    End If
End Function


' returns true if the passed customer code is valid
Public Function ValidCustCode(CustCode$, CSType$) As Boolean
    CustCode$ = UCase(Trim(CustCode$))

    If (Len(CustCode) > 0) And (Len(CustCode) <= 6) Then
        ValidCustCode = True
    Else
        ValidCustCode = False
        If (CSType$ = "C") Then
            Error 515
        Else
            Error 526
        End If
    End If
End Function

' returns True if the passed Stock Code is valid
Public Function ValidStockCode(StockCode$) As Boolean
    StockCode$ = UCase(Trim(StockCode$))
    
    ValidStockCode = True
End Function

' returns True if the passed Stock Code is valid
Public Function ValidLocation(LocCode$) As Boolean
    LocCode$ = UCase(Trim(LocCode$))
    
    If (Len(LocCode$) > 0) And (Len(LocCode$) <= 3) Then
        ValidLocation = True
    Else
        ValidLocation = False
        Error 527
    End If
End Function

' returns True if the passed Nominal Code is valid
Public Function ValidCCDep(IsCC%, ByRef CCDep$) As Boolean
    CCDep$ = UCase(Trim(CCDep$))

    If (Len(CCDep$) >= 0) And (Len(CCDep$) <= 3) Then
        ValidCCDep = True
    Else
        If IsCC% = True Then
            Error 519
        Else
            Error 520
        End If
        ValidCCDep = False
    End If
End Function


' Returns True if the passed JC Total Type is valid
Public Function ValidTotType(TType%) As Boolean
    If (TType% = 10) Or (TType% = 20) Or (TType% = 30) Or (TType% = 40) Or (TType% = 50) Or (TType% = 60) Or (TType% = 99) Or (TType% = 160) Or (TType% = 170) Or (TType% = 180) Or (TType% = 190) Then
        ValidTotType = True
    Else
        Error 531
        ValidTotType = False
    End If
End Function


' returns True if the passed Stock Code is valid
Public Function ValidJobCode(JobCode$) As Boolean
    JobCode$ = UCase(Trim(JobCode$))
    
    If (Len(JobCode$) > 0) And (Len(JobCode$) <= 10) Then
        ValidJobCode = True
    Else
        ValidJobCode = False
        Error 521
    End If
End Function


' returns True if the passed date is valid
Public Function ValidDate(TheDate$, ActDate As Date, ErrNo%) As Boolean
On Error GoTo ValidDate_Error

    If IsDate(TheDate) Then
        ValidDate = True
        ActDate = CDate(TheDate$)
    Else
        ValidDate = False
        Error ErrNo%
    End If
    
    GoTo ValidDate_Exit
    
ValidDate_Error:
    Error ErrNo%
    ValidDate = False

ValidDate_Exit:
End Function


' Validates the Posted/Committed parameter used in some JC history functions
Public Function ValidPC(PCStr$) As Boolean
    PCStr$ = UCase(PCStr$)
    
    If (Len(PCStr$) = 1) And ((Left$(PCStr$, 1) = "P") Or (Left$(PCStr$, 1) = "C")) Then
        ' 1 Char long and "P" or "C"
        ValidPC = True
    Else
        Error 533       ' Invalid Posted/Commited Flag
        ValidPC = False
    End If
End Function


' returns a formatted error string
Public Function GetErrorStr() As String
    GetErrorStr = "Error (" + Trim(Str(Err)) + "): " + EntErrorStr(Err)
End Function


' returns a formatted error string for number fields
Public Function GetErrorNumStr() As String
    GetErrorNumStr = "#(" + Trim(Str(Err)) + "): " + EntErrorStr(Err)
End Function


' Checks for the local server, and gets the server from EntFuncs.XLA if necessary
Public Function LocalCheckServer() As Boolean
On Error GoTo LocalCheckServer_Error

    If Not ServerSet Then
        ' Server Not Running - Start server
        If ZSYS9194(719, EntServer) Then
            ServerSet = True
        Else
            ServerSet = False
        End If
    End If

    ' Finish procedure without causing an error
    LocalCheckServer = ServerSet
    GoTo LocalCheckServer_Exit
    
LocalCheckServer_Error:
    Error 500
    LocalCheckServer = False

LocalCheckServer_Exit:
End Function



Attribute VB_Name = "SaveGL"
Option Explicit

' Saves a string to the customer/supplier record
Private Function SaveGLMiscStr(Company$, GLCode&, SaveNo%, NewVal$) As String
On Error GoTo SaveGLMiscStr_Error
    Dim StrVal$, IntVal%
       
    StrVal = "Error"
    
    If ValidCompany(Company) And ValidGLCode(GLCode) Then
        If LocalCheckServer() Then
            Company$ = UCase(Company$)
                     
            IntVal = EntServer.SaveGLMiscStr(Company$, GLCode&, SaveNo%, NewVal$)
        
            If (IntVal = 0) Then
                StrVal = "Saved"
            Else
                Error IntVal
            End If
        End If
    End If
      
    GoTo SaveGLMiscStr_Exit
           
SaveGLMiscStr_Error:
    StrVal = GetErrorStr$

SaveGLMiscStr_Exit:
    SaveGLMiscStr = StrVal
End Function
'*******************************************************************************
' Name:        EntGLSaveAltCode
' Description: Saves the Alternate code to the specified GL Code record
'*******************************************************************************
Public Function EntGLSaveAltCode(Company$, GLCode&, NewAltCode$) As String
Attribute EntGLSaveAltCode.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLSaveAltCode = SaveGLMiscStr(Company$, GLCode&, 1, NewAltCode$)
End Function

Attribute VB_Name = "SaveGLHist"
Option Explicit

' Saves a budget back to the General Ladger
Private Function SaveGlValue(Mode%, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, _
                             CostCentre$, Department$, CCDepType$, _
                             NewBudget#) As String
On Error GoTo SaveGlValue_Error
    Dim StrVal$, IntVal%, Mo%, CompStr$, Ty%, Tp%, TC%, GLC&, NewBudg#, CCDT$
    
    StrVal = "Error"
    
    If ValidCompany(Company) And ValidYear(TheYear) And ValidPeriod(ThePeriod) And ValidGLCode(GLCode) Then
        If LocalCheckServer() Then
            Mo% = Mode%
            CompStr$ = UCase(Company$)
            Ty% = TheYear%
            Tp% = ThePeriod%
            TC% = TheCcy%
            GLC& = GLCode&
            CCDT$ = CCDepType$
            NewBudg# = NewBudget#
            
            IntVal% = EntServer.SaveNominalValue(Mo%, CompStr$, Ty%, Tp%, TC%, GLC&, _
                                                 CostCentre$, Department$, CCDT$, _
                                                 NewBudg#)
         
            If (IntVal = 0) Then
                StrVal = "Saved"
            Else
                Error IntVal%
            End If
        End If
    End If
     
    GoTo SaveGlValue_Exit
          
SaveGlValue_Error:
    StrVal = GetErrorStr$

SaveGlValue_Exit:
    SaveGlValue = StrVal
End Function
'*******************************************************************************
' Name:        EntGLSaveBudget
' Description: Saves the Budget back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveBudget(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
Attribute EntGLSaveBudget.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLSaveBudget = SaveGlValue(1, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLSaveBudget2
' Description: Saves the Budget2 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveBudget2(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
Attribute EntGLSaveBudget2.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLSaveBudget2 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCSaveBudget
' Description: Saves the Budget back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveBudget(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
Attribute EntGLCCSaveBudget.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLCCSaveBudget = SaveGlValue(1, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCSaveBudget2
' Description: Saves the Budget2 back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveBudget2(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
Attribute EntGLCCSaveBudget2.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLCCSaveBudget2 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLDpSaveBudget
' Description: Saves the Budget back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveBudget(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
Attribute EntGLDpSaveBudget.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLDpSaveBudget = SaveGlValue(1, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLDpSaveBudget2
' Description: Saves the Budget2 back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveBudget2(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
Attribute EntGLDpSaveBudget2.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLDpSaveBudget2 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCDpSaveBudget
' Description: Saves the Budget back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveBudget(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
Attribute EntGLCCDpSaveBudget.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLCCDpSaveBudget = SaveGlValue(1, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function ' EntGLCCDpSaveBudget
'*******************************************************************************
' Name:        EntGLCCDpSaveBudget2
' Description: Saves the Budget2 back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveBudget2(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
Attribute EntGLCCDpSaveBudget2.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLCCDpSaveBudget2 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function ' EntGLCCDpSaveBudget2


'*******************************************************************************
' Name:        EntGLSaveRevisedBudget1
' Description: Saves the Revised Budget 1 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveRevisedBudget1(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
    EntGLSaveRevisedBudget1 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLSaveRevisedBudget2
' Description: Saves the Revised Budget 2 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveRevisedBudget2(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
    EntGLSaveRevisedBudget2 = SaveGlValue(3, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLSaveRevisedBudget3
' Description: Saves the Revised Budget 3 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveRevisedBudget3(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
    EntGLSaveRevisedBudget3 = SaveGlValue(4, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLSaveRevisedBudget4
' Description: Saves the Revised Budget 4 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveRevisedBudget4(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
    EntGLSaveRevisedBudget4 = SaveGlValue(5, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLSaveRevisedBudget5
' Description: Saves the Revised Budget 5 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLSaveRevisedBudget5(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, NewBudget As Double) As String
    EntGLSaveRevisedBudget5 = SaveGlValue(6, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", "", "", NewBudget#)
End Function


'*******************************************************************************
' Name:        EntGLCCSaveRevisedBudget1
' Description: Saves the Revised Budget 1 back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveRevisedBudget1(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
    EntGLCCSaveRevisedBudget1 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCSaveRevisedBudget2
' Description: Saves the Revised Budget 2 back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveRevisedBudget2(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
    EntGLCCSaveRevisedBudget2 = SaveGlValue(3, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCSaveRevisedBudget3
' Description: Saves the Revised Budget 3 back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveRevisedBudget3(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
    EntGLCCSaveRevisedBudget3 = SaveGlValue(4, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCSaveRevisedBudget4
' Description: Saves the Revised Budget 4 back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveRevisedBudget4(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
    EntGLCCSaveRevisedBudget4 = SaveGlValue(5, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCSaveRevisedBudget5
' Description: Saves the Revised Budget 5 back for the specified GL Code and Cost Centre
'*******************************************************************************
Public Function EntGLCCSaveRevisedBudget5(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, NewBudget#) As String
    EntGLCCSaveRevisedBudget5 = SaveGlValue(6, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, "", "C", NewBudget#)
End Function


'*******************************************************************************
' Name:        EntGLCCDpSaveRevisedBudget1
' Description: Saves the Revised Budget 1 back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveRevisedBudget1(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
    EntGLCCDpSaveRevisedBudget1 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCDpSaveRevisedBudget2
' Description: Saves the Revised Budget 2 back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveRevisedBudget2(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
    EntGLCCDpSaveRevisedBudget2 = SaveGlValue(3, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCDpSaveRevisedBudget3
' Description: Saves the Revised Budget 3 back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveRevisedBudget3(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
    EntGLCCDpSaveRevisedBudget3 = SaveGlValue(4, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCDpSaveRevisedBudget4
' Description: Saves the Revised Budget 4 back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveRevisedBudget4(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
    EntGLCCDpSaveRevisedBudget4 = SaveGlValue(5, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLCCDpSaveRevisedBudget5
' Description: Saves the Revised Budget 5 back for the specified Cost Centre and Department
'*******************************************************************************
Public Function EntGLCCDpSaveRevisedBudget5(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, NewBudget#) As String
    EntGLCCDpSaveRevisedBudget5 = SaveGlValue(6, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, CostCentre$, Dept$, "K", NewBudget#)
End Function


'*******************************************************************************
' Name:        EntGLDpSaveRevisedBudget1
' Description: Saves the Revised Budget 1 back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveRevisedBudget1(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
    EntGLDpSaveRevisedBudget1 = SaveGlValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLDpSaveRevisedBudget2
' Description: Saves the Revised Budget 2 back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveRevisedBudget2(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
    EntGLDpSaveRevisedBudget2 = SaveGlValue(3, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLDpSaveRevisedBudget3
' Description: Saves the Revised Budget 3 back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveRevisedBudget3(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
    EntGLDpSaveRevisedBudget3 = SaveGlValue(4, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLDpSaveRevisedBudget4
' Description: Saves the Revised Budget 4 back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveRevisedBudget4(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
    EntGLDpSaveRevisedBudget4 = SaveGlValue(5, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function
'*******************************************************************************
' Name:        EntGLDpSaveRevisedBudget5
' Description: Saves the Revised Budget 5 back for the specified GL Code and Department
'*******************************************************************************
Public Function EntGLDpSaveRevisedBudget5(Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, Dept$, NewBudget#) As String
    EntGLDpSaveRevisedBudget5 = SaveGlValue(6, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, "", Dept$, "D", NewBudget#)
End Function

Attribute VB_Name = "SaveGLView"
Option Explicit

' Saves a string to the GL View record
Private Function SaveGLViewMiscStr(Company$, GLView&, LineCode$, SaveNo%, NewVal$) As String
On Error GoTo SaveGLViewMiscStr_Error
    Dim StrVal$, IntVal%
       
    StrVal = "Error"
    
    If ValidCompany(Company) Then
        If LocalCheckServer() Then
            Company$ = UCase(Company$)
                     
            IntVal = EntServer.SaveGLViewMiscStr(Company$, GLView&, LineCode$, SaveNo%, NewVal$)
        
            If (IntVal = 0) Then
                StrVal = "Saved"
            Else
                Error IntVal
            End If
        End If
    End If
      
    GoTo SaveGLViewMiscStr_Exit
           
SaveGLViewMiscStr_Error:
    StrVal = GetErrorStr$

SaveGLViewMiscStr_Exit:
    SaveGLViewMiscStr = StrVal
End Function

' Saves a budget back to the General Ladger
Private Function SaveGLViewValue(Mode%, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, _
                             LineCode$, NewBudget#) As String
On Error GoTo SaveGLViewValue_Error
    Dim StrVal$, IntVal%, Mo%, CompStr$, Ty%, Tp%, TC%, GLV&, GLC$, NewBudg#, CCDT$
    
    StrVal = "Error"
    
    If ValidCompany(Company) And ValidYear(TheYear) And ValidPeriod(ThePeriod) Then
        If LocalCheckServer() Then
            Mo% = Mode%
            CompStr$ = UCase(Company$)
            Ty% = TheYear%
            Tp% = ThePeriod%
            TC% = TheCcy%
            GLV& = GLCode&
            GLC$ = LineCode$
            NewBudg# = NewBudget#
            
            IntVal% = EntServer.SaveGLViewValue(Mo%, CompStr$, Ty%, Tp%, TC%, GLV&, _
                                                GLC$, NewBudg#)
         
            If (IntVal = 0) Then
                StrVal = "Saved"
            Else
                Error IntVal%
            End If
        End If
    End If
     
    GoTo SaveGLViewValue_Exit
          
SaveGLViewValue_Error:
    StrVal = GetErrorStr$

SaveGLViewValue_Exit:
    SaveGLViewValue = StrVal
End Function

'*******************************************************************************
' Name:        EntGLViewSaveBudget
' Description: Saves the Budget back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLViewSaveBudget(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, LineCode As String, NewBudget As Double) As String
Attribute EntGLViewSaveBudget.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLViewSaveBudget = SaveGLViewValue(1, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, LineCode$, NewBudget#)
End Function

'*******************************************************************************
' Name:        EntGLViewSaveBudget2
' Description: Saves the Budget2 back for the specified GL, year, period, etc
'*******************************************************************************
Public Function EntGLViewSaveBudget2(Company As String, TheYear As Integer, ThePeriod As Integer, TheCcy As Integer, GLCode As Long, LineCode As String, NewBudget As Double) As String
Attribute EntGLViewSaveBudget2.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLViewSaveBudget2 = SaveGLViewValue(2, Company$, TheYear%, ThePeriod%, TheCcy%, GLCode&, LineCode$, NewBudget#)
End Function

'*******************************************************************************
' Name:        EntGLViewSaveAltCode
' Description: Saves the Alternate code to the specified GL View Line record
'*******************************************************************************
Public Function EntGLViewSaveAltCode(Company$, GLView&, LineCode$, NewAltCode$) As String
Attribute EntGLViewSaveAltCode.VB_ProcData.VB_Invoke_Func = " \n14"
    Dim Mode%
    Mode% = 1
    EntGLViewSaveAltCode = SaveGLViewMiscStr(Company$, GLView&, LineCode$, Mode%, NewAltCode$)
End Function

'*******************************************************************************
' Name:        EntGLViewSaveName
' Description: Saves the Name to the specified GL View Line record
'*******************************************************************************
Public Function EntGLViewSaveName(Company$, GLView&, LineCode$, NewName$) As String
Attribute EntGLViewSaveName.VB_ProcData.VB_Invoke_Func = " \n14"
    Dim Mode%
    Mode% = 2
    EntGLViewSaveName = SaveGLViewMiscStr(Company$, GLView&, LineCode$, Mode%, NewName$)
End Function



Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit
Private Sub Workbook_AddinInstall()
Dim EFMisc, EFGLS  As String
Dim ECHM As String

ECHM = "enterole.chm"
EFMisc = "User Defined" '"Exchequer Miscellaneous Gets"
EFGLS = EFMisc '"Exchequer General Ledger Saves"

If Application.Version >= 9 Then
    ' Add functions to Exchequer Miscellaneous Functions section of Insert Formula
    Application.MacroOptions macro:="EntGLSaveAddInVer", Description:="Returns the version of the Excel AddIn for Save GL Functions that you are using", Category:=EFMisc, HelpContextID:=20697, HelpFile:=ECHM

    ' Add functions to Exchequer General Ledger Save Functions section of Insert Formula
    Application.MacroOptions macro:="EntGLCCDpSaveBudget", Description:="Sets the General Ledger Budget value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20456, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCDpSaveBudget2", Description:="Sets the General Ledger Budget2 value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20457, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCSaveBudget", Description:="Sets the General Ledger Budget value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20088, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCSaveBudget2", Description:="Sets the General Ledger Budget2 value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20089, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLDpSaveBudget", Description:="Sets the General Ledger Budget value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20090, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLDpSaveBudget2", Description:="Sets the General Ledger Budget2 value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20091, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveAltCode", Description:="Sets the General Ledger Alternate Code to NewAlternateCode for the specified GLCode", Category:=EFGLS, HelpContextID:=20385, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveBudget", Description:="Sets the General Ledger Budget value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20018, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveBudget2", Description:="Sets the General Ledger Budget2 value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20019, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLViewSaveAltCode", Description:="Sets the General Ledger Alternate Code to NewAlternateCode for the specified GLView and ViewCode", Category:=EFGLS, HelpContextID:=20663, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLViewSaveBudget", Description:="Sets the General Ledger Budget value to NewBudget for the specified Currency, Year, Period, GLView and ViewCode", Category:=EFGLS, HelpContextID:=20664, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLViewSaveBudget2", Description:="Sets the General Ledger Budget2 value to NewBudget for the specified Currency, Year, Period, GLView and ViewCode", Category:=EFGLS, HelpContextID:=20665, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLViewSaveName", Description:="Sets the Description to NewName for the specified GLView and ViewCode", Category:=EFGLS, HelpContextID:=20666, HelpFile:=ECHM

    ' MH 04/05/2016 2016-R2 ABSEXCH-17353: Added Revised Budgets functions
    Application.MacroOptions macro:="EntGLSaveRevisedBudget1", Description:="Sets the General Ledger Revised Budget 1 value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20894, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveRevisedBudget2", Description:="Sets the General Ledger Revised Budget 2 value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20894, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveRevisedBudget3", Description:="Sets the General Ledger Revised Budget 3 value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20894, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveRevisedBudget4", Description:="Sets the General Ledger Revised Budget 4 value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20894, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLSaveRevisedBudget5", Description:="Sets the General Ledger Revised Budget 5 value to NewBudget for the specified Currency, Year, Period and GLCode", Category:=EFGLS, HelpContextID:=20894, HelpFile:=ECHM
    
    Application.MacroOptions macro:="EntGLCCSaveRevisedBudget1", Description:="Sets the General Ledger Revised Budget 1 value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20895, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCSaveRevisedBudget2", Description:="Sets the General Ledger Revised Budget 2 value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20895, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCSaveRevisedBudget3", Description:="Sets the General Ledger Revised Budget 3 value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20895, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCSaveRevisedBudget4", Description:="Sets the General Ledger Revised Budget 4 value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20895, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCSaveRevisedBudget5", Description:="Sets the General Ledger Revised Budget 5 value to NewBudget for the specified Currency, Year, Period, GLCode and CostCentre", Category:=EFGLS, HelpContextID:=20895, HelpFile:=ECHM
    
    Application.MacroOptions macro:="EntGLCCDpSaveRevisedBudget1", Description:="Sets the General Ledger Revised Budget 1 value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20896, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCDpSaveRevisedBudget2", Description:="Sets the General Ledger Revised Budget 2 value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20896, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCDpSaveRevisedBudget3", Description:="Sets the General Ledger Revised Budget 3 value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20896, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCDpSaveRevisedBudget4", Description:="Sets the General Ledger Revised Budget 4 value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20896, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLCCDpSaveRevisedBudget5", Description:="Sets the General Ledger Revised Budget 5 value to NewBudget for the specified Currency, Year, Period, GLCode, CostCentre and Department", Category:=EFGLS, HelpContextID:=20896, HelpFile:=ECHM
    
    Application.MacroOptions macro:="EntGLDpSaveRevisedBudget1", Description:="Sets the General Ledger Revised Budget 1 value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20897, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLDpSaveRevisedBudget2", Description:="Sets the General Ledger Revised Budget 2 value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20897, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLDpSaveRevisedBudget3", Description:="Sets the General Ledger Revised Budget 3 value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20897, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLDpSaveRevisedBudget4", Description:="Sets the General Ledger Revised Budget 4 value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20897, HelpFile:=ECHM
    Application.MacroOptions macro:="EntGLDpSaveRevisedBudget5", Description:="Sets the General Ledger Revised Budget 5 value to NewBudget for the specified Currency, Year, Period, GLCode and Department", Category:=EFGLS, HelpContextID:=20897, HelpFile:=ECHM
End If
End Sub
Attribute VB_Name = "Version"
Option Explicit

' Release Version Number
Const AddInVer = "Exchequer v12.0.0 Build 207"           ' should be incremented for each build


'*******************************************************************************
' Add-In History
'
' Exchequer v12.0.0 Build 207   Updated for v12.0.0 release
'
' Exchequer 2018 R1 Build 206   Updated for 2018-R1 release
'
' 2016 R2 Build 205   MH   04/05/2016   ABSEXCH-17353: Added Revised Budgets functions
'
' v2016R1.204 PKR   26/01/2016  Released for v2016 R1
'
' v7.0.203    MH    10/09/12    Released for v7.0
'
' v6.00.202   MH    31/10/07    Rebuild as reference to EntFuncs.Xla was lost
'
' v6.00.200   MH    16/07/07    Recreated from scratch under XL95 to try and fix help problems in XL2003
'
' v6.00.003   MH    20/06/07    Rebuilt after help stopped working due to an MS Office Update
'
' v6.00.002   MH    14/06/07    Modified to use HTML HElp
'
' v5.71.001   MH    21/06/06    Recompiled under Excel 95
'
' v5.71.000   CS    09/06/06    Created

'*******************************************************************************
' Name:        EntGLSaveAddInVer
' Description: Gets the version of this Add-In source code
'*******************************************************************************
Public Function EntGLSaveAddInVer() As String
Attribute EntGLSaveAddInVer.VB_Description = "Returns the version information for EntGL2.Xla"
Attribute EntGLSaveAddInVer.VB_HelpID = 20000
Attribute EntGLSaveAddInVer.VB_ProcData.VB_Invoke_Func = " \n14"
    EntGLSaveAddInVer = "Exchequer G/L Save Functions - " + AddInVer$
End Function

' InQuest injected base64 decoded content
' {F-&
' {F-&
' {F, 
' {F, 

INQUEST-PP=macro
