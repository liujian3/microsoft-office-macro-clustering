Attribute VB_Name = "ExportForm"
Attribute VB_Base = "0{A0EF3EFC-713B-49F3-AA62-230774D078AD}{1D18F3BB-3B2E-423D-9385-565FAE982DF4}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub ChBoxAll_Click()
  If ChBoxAll.Value Then
    ChBox1.Value = True
    ChBox2.Value = True
    ChBox3.Value = True
    ChBox4.Value = True
    ChBox5.Value = True
    ChBox6.Value = True
'    ChBox7.Value = True
    ChBox8.Value = True
    ChBox9.Value = True
    ChBox10.Value = True
'    ChBox11.Value = True
'    ChBox12.Value = True
    ChBox13.Value = True
    ChBox14.Value = True
    ChBox15.Value = True
    ChBox16.Value = True
'    ChBox17.Value = True
    ChBox18.Value = True
    ChBox19.Value = True
    ChBox20.Value = True
  Else
    ChBox1.Value = False
    ChBox2.Value = False
    ChBox3.Value = False
    ChBox4.Value = False
    ChBox5.Value = False
    ChBox6.Value = False
 '   ChBox7.Value = False
    ChBox8.Value = False
    ChBox9.Value = False
    ChBox10.Value = False
'    ChBox11.Value = False
'    ChBox12.Value = False
    ChBox13.Value = False
    ChBox14.Value = False
    ChBox15.Value = False
    ChBox16.Value = False
  '  ChBox17.Value = False
    ChBox18.Value = False
    ChBox19.Value = False
    ChBox20.Value = False
  End If
End Sub

Private Sub CmdBtnCancel_Click()
  Unload ExportForm
End Sub

Private Sub CmdBtnOk_Click()
  ChBox1Val = ChBox1.Value
  ChBox2Val = ChBox2.Value
  ChBox3Val = ChBox3.Value
  ChBox4Val = ChBox4.Value
  ChBox5Val = ChBox5.Value
  ChBox6Val = ChBox6.Value
'  ChBox7Val = ChBox7.Value
  ChBox8Val = ChBox8.Value
  ChBox9Val = ChBox9.Value
  ChBox10Val = ChBox10.Value
'  ChBox11Val = ChBox11.Value
'  ChBox12Val = ChBox12.Value
  ChBox13Val = ChBox13.Value
  ChBox14Val = ChBox14.Value
  ChBox15Val = ChBox15.Value
  ChBox16Val = ChBox16.Value
'  ChBox17Val = ChBox17.Value
  ChBox18Val = ChBox18.Value
  ChBox19Val = ChBox19.Value
  ChBox20Val = ChBox20.Value
  ExportFormResult = 1
  Unload ExportForm
End Sub

Private Sub UserForm_Click()

End Sub
Attribute VB_Name = "ModuleDBProc"

Sub WriteDBActiveList()
  On Error GoTo Errors
  Dim fmData As frmDataCsv
  
  If Application.ActiveWorkbook.BuiltinDocumentProperties(2) Like "*4.*" Then
    Set fmData = New frmDataCsv
    fmData.Show
    Unload fmData
  Else
   MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| object.mdb" + _
   Chr(13) + " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|  4.x", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If

Errors:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub

Sub WriteDBAllLists()
  On Error GoTo Errors
  Dim fmData As frmDataObjects
  
  If Application.ActiveWorkbook.BuiltinDocumentProperties(2) Like "*4.*" Then
    Set fmData = New frmDataObjects
    fmData.Show
    Unload fmData
  Else
   MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| object.mdb" + _
   Chr(13) + " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|  4.x", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
  
Errors:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub

Sub ReadDBActiveList()
  MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd|" + _
         Chr(13) + "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
End Sub

Sub ReadDBAllLists()
  MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd|" + _
         Chr(13) + "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
End Sub


Attribute VB_Name = "ModuleExp"
Public ChBox1Val As Boolean
Public ChBox2Val As Boolean
Public ChBox3Val As Boolean
Public ChBox4Val As Boolean
Public ChBox5Val As Boolean
Public ChBox6Val As Boolean
Public ChBox7Val As Boolean
Public ChBox8Val As Boolean
Public ChBox9Val As Boolean
Public ChBox10Val As Boolean
Public ChBox11Val As Boolean
Public ChBox12Val As Boolean
Public ChBox13Val As Boolean
Public ChBox14Val As Boolean
Public ChBox15Val As Boolean
Public ChBox16Val As Boolean
Public ChBox17Val As Boolean
Public ChBox18Val As Boolean
Public ChBox19Val As Boolean
Public ChBox20Val As Boolean
Public ChBox21Val As Boolean
Public ChBox22Val As Boolean
Public ChBox23Val As Boolean
Public ChBox24Val As Boolean
Public ChBox25Val As Boolean
Public ChBox26Val As Boolean
Public ChBox27Val As Boolean
Public ChBox28Val As Boolean

Public ExportFormResult As Integer

Public FileNameStr As String

Type CSVTagInfo
 IODRV As String
 IODRVName As String
 IOAddress As String
 IOAddress2 As String
 IOAddress3 As String
 TAG As String
 NextTAG As String
 DESC As String
 EGUDESC As String
 ScanTime As String
 Signal_Conditioning As String
 Low_EGU As String
 High_EGU As String
 Enable_Output As String
End Type


Sub ExpActiveList()
 On Error GoTo Errors
 
 If Not Application.ActiveWorkbook.BuiltinDocumentProperties(2) Like "*4.*" Then
   MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| object.mdb" + _
   Chr(13) + " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|  4.x", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
   Exit Sub
 End If
 
 Dim S As String
 S = Application.ActiveWorkbook.ActiveSheet.name
 If S = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|" Or S = "|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or _
    S = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "LIST2" Or _
    S = "LIST3" Or S = "LIST4" Or S = "LIST5" Or _
    S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or _
    S = "DI |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or _
    S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
  If S = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    DoCfgFile
  Else
    Load PathForm
    PathForm.CmnDlg.Filter = "|fffd||fffd||fffd| (*.*)|*.*"
    PathForm.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
    PathForm.Show vbModal
    If FileNameStr <> "" Then
      Load PForm
      PForm.Show vbModeless
      PForm.ProgressBar.Visible = True
      PForm.ProgressBar.Min = 0
      Dim PrnStr As String
      Dim CommentStr As String
      Dim TabStr1 As String
      Dim TabStr2 As String
      Open FileNameStr For Output As #1    ' Open file for output.
  '    If S = "|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
   '     Set WorkItem = Application.ActiveWorkbook.ActiveSheet
    '    PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
     '   PForm.ProgressBar.Max = 16
      '  Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
       ' For i = 1 To 16
      '    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
      '      Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 20).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
      '    End If
       '   PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
       '   DoEvents
       ' Next i
  
     If S = "|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 200
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 200
          If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 20).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
  
'      ElseIf S = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
'        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
'        PForm.ProgressBar.Max = 32
'        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
'        For i = 1 To 32
'          If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
'            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 20).Text; ";"; String(3, Chr(9)); _
'                              "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
'          End If
'          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
'          DoEvents
'        Next i
  
      ElseIf S = "|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 128
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 128
          If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 19).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
  
      ElseIf S = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        PForm.ProgressBar.Max = 128
        For i = 1 To 128
          If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 19).Text; ";"; String(3, Chr(9)); _
            "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
  
      ElseIf S = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 160
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 160
          If WorkItem.Cells(6 + i - 1, 4).Font.ColorIndex <> 15 And _
             (WorkItem.Cells(6 + i - 1, 12).Value <> 0 Or WorkItem.Cells(6 + i - 1, 20).Value <> 0) Then
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 12).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 5).Text + ":=" + WorkItem.Cells(6 + i - 1, 12).Text + ";" + Chr(9)
            End If
            If WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 13).Text + ":=" + WorkItem.Cells(6 + i - 1, 20).Text + ";"
            End If
            PrnStr = PrnStr + String(3, Chr(9)) + "(* " + Replace(Trim(WorkItem.Cells(6 + i - 1, 4).Text), "|fffd|", "|fffd|") + " *)"
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i

      ElseIf S = "LIST2" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| LIST2
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 62
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List2 - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 62
          If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
            CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd||fffd||fffd||fffd||fffd|.")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
            CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
            If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
            TabStr2 = String(3, Chr(9))
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + TabStr2 + CommentStr
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      ElseIf S = "LIST3" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| LIST3
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 1008
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List3 - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 160
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
          CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
          If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
          CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + TabStr2 + CommentStr
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i


      ElseIf S = "LIST4" Then
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| LIST4
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 512
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List4 - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 512
          If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
            CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd||fffd||fffd||fffd||fffd|.")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
'            If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
            CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
            If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
            TabStr2 = String(3, Chr(9))
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + TabStr2 + CommentStr
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      ElseIf S = "LIST5" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| LIST5
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 512
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List5 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 512
          If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
            CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd||fffd||fffd||fffd||fffd|.")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
            If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
            CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
            If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
            TabStr2 = String(3, Chr(9))
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + TabStr2 + CommentStr
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
  
      ElseIf S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 80
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 80
          If WorkItem.Cells(6 + 5 * ((i - 1) \ 5), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 5 * ((i - 1) \ 5), 1).Text <> "" And _
             WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
            If (i - 1) Mod 5 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            TabStr1 = Chr(9)
            TabStr2 = String(3, Chr(9))
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + TabStr1
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + TabStr2 + "(* " + Replace(Trim(WorkItem.Cells(6 + 5 * ((i - 1) \ 5), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i

      ElseIf S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 1200
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 1200
          If WorkItem.Cells(6 + 8 * ((i - 1) \ 8), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 8 * ((i - 1) \ 8), 1).Text <> "" And _
             WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
            If (i - 1) Mod 8 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
            TabStr2 = String(3, Chr(9))
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + TabStr1
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + TabStr2 + "(* " + Replace(Trim(WorkItem.Cells(6 + 8 * ((i - 1) \ 8), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      ElseIf S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 384
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 384
          If WorkItem.Cells(6 + 3 * ((i - 1) \ 3), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 3 * ((i - 1) \ 3), 1).Text <> "" And _
             WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
            If (i - 1) Mod 3 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + Chr(9)
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + String(3, Chr(9)) + "(* " + Replace(Trim(WorkItem.Cells(6 + 3 * ((i - 1) \ 3), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
  
      ElseIf S = "DI |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 128
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 128
          If WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "" And _
             WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
            If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + Chr(9)
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + String(3, Chr(9)) + "(* " + Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
            Print #1, Spc(2); PrnStr
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      ElseIf S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 32
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 32
          If (WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "") And _
             (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
            If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      ElseIf S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 856
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 856
          If (WorkItem.Cells(6 + 4 * ((i - 1) \ 4), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 4 * ((i - 1) \ 4), 1).Text <> "") And _
             (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
            If (i - 1) Mod 4 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + 4 * ((i - 1) \ 4), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i

      ElseIf S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 256
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 256
          If (WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "") And _
             (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
            If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      ElseIf S = "DO |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 128
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 128
          If (WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "") And _
             (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
            If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
    
      Else: S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Set WorkItem = Application.ActiveWorkbook.ActiveSheet
        PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
        PForm.ProgressBar.Max = 128
        Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
        For i = 1 To 128
          If (WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
            Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                              "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
          End If
          PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
          DoEvents
        Next i
      End If
      Close #1
      Shell "notepad " + FileNameStr, vbNormalFocus
    End If
  End If
  Unload PForm
 Else
   MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| Concept", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
 End If
 
Errors:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub

Sub ExpAllLists()
  On Error GoTo Errors
 
 If Not Application.ActiveWorkbook.BuiltinDocumentProperties(2) Like "*4.*" Then
   MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd| object.mdb" + _
   Chr(13) + " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|  4.x", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
   Exit Sub
 End If
 
  Load PathForm
  PathForm.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
  PathForm.Show vbModal
  If FileNameStr = "" Then Exit Sub
  Load ExportForm
  ExportForm.Show vbModal
  If ExportFormResult = 0 Then Exit Sub
  Load PForm
  PForm.Show vbModeless
  PForm.ProgressBar.Visible = True
  PForm.ProgressBar.Min = 0
  PForm.ProgressBar.Max = 5815
  Dim CommentStr As String
  Dim TabStr1 As String
  Dim TabStr2 As String
  Open FileNameStr For Output As #1    ' Open file for output.

' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox6Val Then
     ' Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
     ' Dim MNACnt, PNACnt, PNAFirst As Integer
     ' MNACnt = 0
     ' PNACnt = 0
     ' PNAFirst = 0
     ' For n = 1 To 16
     '   If ((UCase(WorkItem.Cells(6 + n - 1, 1).Text) Like UCase("|fffd||fffd||fffd|*")) Or (UCase(WorkItem.Cells(6 + n - 1, 1).Text) Like UCase("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|*"))) And _
     '       WorkItem.Cells(6 + n - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + n - 1, 1).Text <> "" Then
     '     MNACnt = MNACnt + 1
     '   End If
     '   If ((UCase(WorkItem.Cells(6 + n - 1, 1).Text) Like UCase("|fffd||fffd||fffd|*")) Or (WorkItem.Cells(6 + n - 1, 1).Text Like UCase("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|*"))) And _
     '       WorkItem.Cells(6 + n - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + n - 1, 1).Text <> "" Then
     '     If PNACnt = 0 Then PNAFirst = n
     '     PNACnt = PNACnt + 1
     '   End If
     ' Next n
     ' If PNACnt > 0 Then
     '   Print #1, Spc(2); "slStationWithPNS:=1"; ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     '   Print #1, Spc(2); "suAgrCount:="; CStr(PNAFirst - 1 + PNACnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     ' Else
     '   Print #1, Spc(2); "slStationWithPNS:=0"; ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     '   Print #1, Spc(2); "suAgrCount:="; CStr(MNACnt + PNACnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     ' End If
     ' Print #1, Spc(2); "suMNACount:="; CStr(MNACnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     ' Print #1, Spc(2); "suPNAFirst:="; CStr(PNAFirst); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     ' Print #1, Spc(2); "suPNACount:="; CStr(PNACnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     ' Print #1,
      
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      Dim fCnt As Integer
      fCnt = 0
      For i = 200 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suZDCount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
      Print #1, Spc(2); "suZDSimCount     := suZDCount;"
      
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 128 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suVSCount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
     
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd|. |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 128 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suVSGroupCount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
    
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 128 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suOtherDOCount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
    
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST4")
      fCnt = 0
      For i = 160 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = ((i - 1) \ 16) + 1
      Print #1, Spc(2); "suList4Count        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| LIST4 *)"
    
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST5")
      fCnt = 0
      For i = 512 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = ((i - 1) \ 16) + 1
      Print #1, Spc(2); "suList5Count        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| LIST5 *)"
      
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 64 To 1 Step -1
        If WorkItem.Cells(6 + 2 * (i - 1), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * (i - 1), 1).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suGroupsCnt        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
    
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 128 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" _
        And WorkItem.Cells(6 + i - 1, 1).Interior.ColorIndex = 36 Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suAlarmsCount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd|/|fffd||fffd||fffd||fffd||fffd| *)"
    
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 500 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suAICount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
    
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      fCnt = 0
      For i = 64 To 1 Step -1
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
          Exit For
        End If
      Next i
      fCnt = i
      Print #1, Spc(2); "suMVVCount        := "; CStr(fCnt); ";"; String(3, Chr(9)); "(* |fffd||fffd||fffd|-|fffd||fffd| |fffd|/|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox7Val Then
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1,
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 16
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 20).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox8Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 200
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 20).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox11Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 200
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 20).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox9Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 128
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 19).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox10Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 128
        If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" And WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 19).Text; ";"; String(3, Chr(9)); _
          "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox1Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 160
        If WorkItem.Cells(6 + i - 1, 4).Font.ColorIndex <> 15 And _
             (WorkItem.Cells(6 + i - 1, 12).Value <> 0 Or WorkItem.Cells(6 + i - 1, 20).Value <> 0) Then
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 12).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 5).Text + ":=" + WorkItem.Cells(6 + i - 1, 12).Text + ";" + Chr(9)
            End If
            If WorkItem.Cells(6 + i - 1, 20).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 13).Text + ":=" + WorkItem.Cells(6 + i - 1, 20).Text + ";"
            End If
            PrnStr = PrnStr + String(3, Chr(9)) + "(* " + Replace(Trim(WorkItem.Cells(6 + i - 1, 4).Text), "|fffd|", "|fffd|") + " *)"
            Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| LIST2
    If ChBox2Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST2")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List2 - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 62
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
          CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd||fffd||fffd||fffd||fffd|.")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
          CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
            PrnStr = ""
            If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
              PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
            Else
              PrnStr = String(6, Chr(9))
            End If
            If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
              PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
            Else
              PrnStr = PrnStr + String(4, Chr(9))
            End If
            PrnStr = PrnStr + TabStr2 + CommentStr
            Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| LIST3
    If ChBox3Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST3")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List3 - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      
      For i = 1 To 160
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
          CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
          If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
          CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + TabStr2 + CommentStr
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
      
      
   '   For j = 1 To 16
    '   Print #1,
     '  Print #1, Spc(2); "(* "; WorkItem.Cells(6 + 65 * (j - 1), 1).Text; " *)"
      ' For i = 1 To 63
       ' If WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 3).Text <> "" And _
'               (WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 39).Value <> 0 Or WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 47).Value <> 0) Then
 '         CommentStr = Trim(WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 3).Text)
 '         CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
 '         CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
  ''        CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
  '        If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
  '        CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
   ''       TabStr1 = Chr(9)
  '        TabStr2 = String(3, Chr(9))
  '        PrnStr = ""
  '        If WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 39).Value <> 0 Then
  '          PrnStr = WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 32).Text + ":=" + WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 39).Text + ";" + TabStr1
  '        Else
  '          PrnStr = String(6, Chr(9))
  '        End If
  '        If WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 47).Value <> 0 Then
  '          PrnStr = PrnStr + WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 40).Text + ":=" + WorkItem.Cells(7 + 65 * (j - 1) + i - 1, 47).Text + ";"
  '        Else
  '          PrnStr = PrnStr + String(4, Chr(9))
  '        End If
  '        PrnStr = PrnStr + TabStr2 + CommentStr
  '        Print #1, Spc(2); PrnStr
   '     End If
   '     PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
   '     DoEvents
   '    Next i
   '   Next j
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| LIST4
    If ChBox4Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST4")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List4 - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 160
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
          CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd||fffd||fffd||fffd||fffd|.")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
          CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + TabStr2 + CommentStr
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| LIST5
    If ChBox5Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST5")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| List5 - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 512
        If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 39).Value <> 0 Or WorkItem.Cells(6 + i - 1, 47).Value <> 0) Then
          CommentStr = Trim(WorkItem.Cells(6 + i - 1, 3).Text)
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|", "-")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd||fffd||fffd||fffd||fffd|.")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          CommentStr = Replace(CommentStr, "|fffd||fffd||fffd||fffd|-|fffd||fffd||fffd||fffd||fffd|", "|fffd|/|fffd|")
          If Len(CommentStr) > 53 Then CommentStr = Left(CommentStr, 53)
          CommentStr = "(* " + Replace(CommentStr, "|fffd|", "|fffd|") + " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 39).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 32).Text + ":=" + WorkItem.Cells(6 + i - 1, 39).Text + ";" + TabStr1
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 47).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 40).Text + ":=" + WorkItem.Cells(6 + i - 1, 47).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + TabStr2 + CommentStr
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox17Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 80
        If WorkItem.Cells(6 + 5 * ((i - 1) \ 5), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 5 * ((i - 1) \ 5), 1).Text <> "" And _
           WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
          If (i - 1) Mod 5 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + TabStr1
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + TabStr2 + "(* " + Replace(Trim(WorkItem.Cells(6 + 5 * ((i - 1) \ 5), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox18Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 1200
        If WorkItem.Cells(6 + 8 * ((i - 1) \ 8), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 8 * ((i - 1) \ 8), 1).Text <> "" And _
           WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
          If (i - 1) Mod 8 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + TabStr1
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + TabStr2 + "(* " + Replace(Trim(WorkItem.Cells(6 + 8 * ((i - 1) \ 6), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox19Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 384
        If WorkItem.Cells(6 + 3 * ((i - 1) \ 3), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 3 * ((i - 1) \ 3), 1).Text <> "" And _
           WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
          If (i - 1) Mod 3 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          If i < 10 Then TabStr1 = String(2, Chr(9)) Else TabStr1 = Chr(9)
          TabStr2 = String(3, Chr(9))
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + Chr(9)
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + String(3, Chr(9)) + "(* " + Replace(Trim(WorkItem.Cells(6 + 3 * ((i - 1) \ 3), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox20Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DI |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 128
        If WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "" And _
           WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" And _
             (WorkItem.Cells(6 + i - 1, 10).Value <> 0 Or WorkItem.Cells(6 + i - 1, 19).Value <> 0) Then
          If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          PrnStr = ""
          If WorkItem.Cells(6 + i - 1, 10).Value <> 0 Then
            PrnStr = WorkItem.Cells(6 + i - 1, 2).Text + ":=" + WorkItem.Cells(6 + i - 1, 10).Text + ";" + Chr(9)
          Else
            PrnStr = String(6, Chr(9))
          End If
          If WorkItem.Cells(6 + i - 1, 19).Value <> 0 Then
            PrnStr = PrnStr + WorkItem.Cells(6 + i - 1, 11).Text + ":=" + WorkItem.Cells(6 + i - 1, 19).Text + ";"
          Else
            PrnStr = PrnStr + String(4, Chr(9))
          End If
          PrnStr = PrnStr + String(3, Chr(9)) + "(* " + Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|") + " *)"
          Print #1, Spc(2); PrnStr
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox12Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 32
        If (WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "") And _
           (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
          If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox13Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 856
        If (WorkItem.Cells(6 + 4 * ((i - 1) \ 4), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 4 * ((i - 1) \ 4), 1).Text <> "") And _
           (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
          If (i - 1) Mod 4 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + 4 * ((i - 1) \ 4), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox14Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 256
        If (WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "") And _
           (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
          If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox15Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 128
        If (WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text <> "") And _
           (WorkItem.Cells(6 + i - 1, 2).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
          If (i - 1) Mod 2 = 0 Then Print #1, Spc(2); "(* "; WorkItem.Cells(6 + i - 1, 1).Text; " *)"
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + 2 * ((i - 1) \ 2), 1).Text + "  " + WorkItem.Cells(6 + i - 1, 3).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If ChBox16Val Then
      Print #1,
      Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      PForm.LblProc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|: " + WorkItem.name
      Print #1, "(* Beg |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| *)"    ' Print text to file.
      For i = 1 To 128
        If (WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "") And WorkItem.Cells(6 + i - 1, 7).Value <> 0 Then
          Print #1, Spc(2); WorkItem.Cells(6 + i - 1, 2).Text; ":="; WorkItem.Cells(6 + i - 1, 7).Text; ";"; String(3, Chr(9)); _
                            "(* "; Replace(Trim(WorkItem.Cells(6 + i - 1, 1).Text), "|fffd|", "|fffd|"); " *)"
        End If
        PForm.ProgressBar.Value = PForm.ProgressBar.Value + 1
        DoEvents
      Next i
    End If
    
  Close #1
  Shell "notepad " + FileNameStr, vbNormalFocus
  Unload PForm
  
Errors:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub

Sub UpdateD_YCO(cn As ADODB.Connection, rs As ADODB.Recordset, YCO As Long, DESC As String)
  Dim strSQL As String
  Dim cnt As Long
            
  rs.Open "select count(*) as cnt from D_YCO where nomer=" & YCO, cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
  
  If cnt > 0 Then
    strSQL = "update D_YCO set [caption]='" & DESC & "' where nomer=" & YCO
  Else
    strSQL = "insert into D_YCO([caption],nomer) values ('" & DESC & "'," & YCO & ")"
  End If
  
  cn.Execute strSQL
End Sub
  
Sub UpdateD_Tags(cn As ADODB.Connection, rs As ADODB.Recordset, TAG As String, DESC As String, YCO As Long, Rack As Long, Module As Long, Bits As Long)
  Dim strSQL As String
  Dim cnt As Long
            
  rs.Open "select count(*) as cnt from D_Tags where yco =" & YCO & _
          " and rack=" & Rack & " and [module]=" & Module & " and [bits]=" & Bits, _
          cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
  
  If cnt > 0 Then
    strSQL = "update D_Tags set f_enabled=1, [tag]='" & TAG & "', descript='" & DESC & "' where yco =" & YCO & _
             " and rack=" & Rack & " and module=" & Module & " and bits=" & Bits
  Else
    strSQL = "insert into D_Tags(f_enabled,[tag],[descript],yco,rack,[module],[bits]) values (1,'" & TAG & "','" & _
             DESC & "'," & YCO & "," & Rack & "," & Module & ", " & Bits & ")"
  End If
  
  cn.Execute strSQL
End Sub

Sub UpdateD_Modul(cn As ADODB.Connection, rs As ADODB.Recordset, tip As String, kod As String, Start_Addres As Long, nsign As Long, analog As Boolean, YCO As Long, Rack As Long, Module As Long)
  Dim strSQL As String
  Dim cnt As Long
          
          
  rs.Open "select count(*) as cnt from D_Modul where yco =" & YCO & _
          " and rack=" & Rack & " and nomer=" & Module, _
          cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  tip = Trim$(Replace$(tip, "'", "''"))
  
  If cnt > 0 Then
    strSQL = "update D_Modul set f_enabled=1,nsign=" & nsign & ",analog=" & analog & _
             ",Start_Addres=" & Start_Addres & ",kod='" & kod & "',tip='" & tip & _
             "' where yco =" & YCO & " and rack=" & Rack & " and nomer=" & Module
  Else
    strSQL = "insert into D_Modul(f_enabled,nsign,analog,Start_Addres,kod,tip,yco,rack,nomer) " & _
             "values (1," & nsign & "," & analog & "," & Start_Addres & ",'" & kod & _
            "','" & tip & "'," & YCO & "," & Rack & "," & Module & ")"
  End If
  
  cn.Execute strSQL
End Sub
 
  
Sub UpdateMsg(cn As ADODB.Connection, rs As ADODB.Recordset, tbname As String, DESC As String, idx As Long)
  Dim strSQL As String
  Dim cnt As Long
          
  rs.Open "select count(*) as cnt from " & tbname, cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
    
  If cnt > idx And cnt > 0 Then

    strSQL = "update " & tbname & " set [DESC]='" & DESC & _
             "' where [index]=" & idx
  Else
    strSQL = "insert into " & tbname & "([index],[desc]) " & _
             "values (" & idx & ",'" & DESC & "')"
  End If
  cn.Execute strSQL
  
End Sub

Sub UpdateListFe(cn As ADODB.Connection, rs As ADODB.Recordset, tbname As String, DESC As String, idx As Long, Optional f_ma As Boolean)
  Dim strSQL As String, tg As String, egu As String
  Dim cnt As Long
          
  rs.Open "select count(*) as cnt from " & tbname, cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
    
  
  If tbname = "MA" Then
  
    strSQL = "insert into " & tbname & "([id_Controller],[Name],[f_enabled],[f_ma] ) " & _
             "values (" & idx & ",'" & DESC & "', True," & IIf(Left(DESC, 3) = "|fffd||fffd||fffd|", True, False) & ")"
             
  Else
    strSQL = "insert into " & tbname & "([id_Controller],[Name],[f_enabled]) " & _
             "values (" & idx & ",'" & DESC & "', True)"
  End If
  cn.Execute strSQL
  
End Sub

Sub UpdateUstavkiAI(ExpBase As Boolean, cn As ADODB.Connection, rs As ADODB.Recordset, TAG As String, DESC As String, PLC_index As Long, offset As Long)
  Dim strSQL As String
  Dim egu As String
  Dim cnt As Long
          
  If Not ExpBase Then
    Exit Sub
  End If
          
  rs.Open "select count(*) as cnt from ustavki where id=1 and tag ='" & TAG & "'", cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
    
  Select Case Left(TAG, 2)
    Case "PT"
        egu = "|fffd||fffd||fffd|/|fffd||fffd|2"
    Case "TT"
        egu = "|fffd||fffd||fffd||fffd|.|fffd|"
    Case "QT", "GT"
        egu = "%"
    Case "BT"
        egu = "|fffd||fffd|"
    Case "CT"
        egu = "|fffd|"
    Case "MT"
        egu = "|fffd||fffd||fffd|"
    Case "XT"
        egu = "|fffd||fffd|/|fffd|"
    Case "YT"
        egu = "|fffd||fffd|"
    Case Else
        egu = " "
  End Select
  
        
  If cnt > 0 Then
    strSQL = "update ustavki set f_enabled=1,changed=1,controller_index=" & PLC_index & ",offset=" & offset & _
             ",condition=65535,DESCRIPTION='" & DESC & "'" & " where id=1 and tag ='" & TAG & "'"
  Else
    strSQL = "insert into ustavki(id,f_enabled,changed,controller_index,offset,DESCRIPTION,TAG,condition,SHORTDESC,type,EGUDESC,KC,Delta," & _
              " scale_min,scale_max,format,mask1,mask2,grp,HL,MAX2,MAX1,MIN1,MIN2,LL" & _
             ") " & "values (1,1,1," & PLC_index & "," & offset & ",'" & DESC & _
            "','" & TAG & "',65535" & ",''," & "1,'" & egu & "',1,0,4000,20000,2,56,48,1,100,100,100,0,0,0)"
  
'      strSQL = "insert into ustavki(id,f_enabled,changed,controller_index,offset,DESCRIPTION,TAG,condition,SHORTDESC,type,EGUDESC,KC,Delta," & _
'              " scale_min,scale_max,format,mask1,mask2,grp,HL,MAX2,MAX1,MIN1,MIN2,LL" & _
'             ") " & "values (1,1,1," & PLC_index & "," & offset & ",'" & DESC & _
'            "','" & TAG & "',65535" & ",'" & DESC & "'," & "1,'" & egu & "',1,0,4000,20000,2,56,48,1,100,100,100,0,0,0)"

  
  End If
  i = Len(strSQL)
  cn.Execute strSQL
End Sub

Sub UpdateUstavkiZD(ExpBase As Boolean, cn As ADODB.Connection, rs As ADODB.Recordset, TAG As String, DESC As String, PLC_index As Long, value1 As Long, type1 As Long)
  Dim strSQL As String
  Dim cnt As Long
          
  If Not ExpBase Then
    Exit Sub
  End If
          
  rs.Open "select count(*) as cnt from ustavki where id=3 and tag ='" & TAG & "'", cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
  
  If cnt > 0 Then
    strSQL = "update ustavki set f_enabled=1,changed=1,DESCRIPTION='" & DESC & "'" & _
             " where id=3 and tag ='" & TAG & "'"
  Else
    strSQL = "insert into ustavki(id,f_enabled,changed,DESCRIPTION,TAG,EGUDESC, type,controller_index,Value" & _
              ") " & "values (3,1,1,'" & DESC & "','" & TAG & "'," & "'c|fffd||fffd|.'," & type1 & "," & PLC_index & "," & _
              value1 & ")"
  End If
  
  cn.Execute strSQL
End Sub

Sub UpdateUstavkiVS(ExpBase As Boolean, cn As ADODB.Connection, rs As ADODB.Recordset, TAG As String, DESC As String, PLC_index As Long, value1 As Long)
  Dim strSQL As String
  Dim cnt As Long
          
  If Not ExpBase Then
    Exit Sub
  End If
          
  rs.Open "select count(*) as cnt from ustavki where id=3 and tag ='" & TAG & "'", cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  DESC = Trim$(Replace$(DESC, "'", "''"))
  
  If cnt > 0 Then
    strSQL = "update ustavki set f_enabled=1,changed=1,DESCRIPTION='" & DESC & "'" & _
             " where id=3 and tag ='" & TAG & "'"
  Else
  
    strSQL = "insert into ustavki(id,f_enabled,changed,DESCRIPTION,TAG,EGUDESC, type,controller_index,Value1" & _
              ") " & "values (3,1,1,'" & DESC & "','" & TAG & "'," & "'c|fffd||fffd|.',10," & PLC_index & "," & _
              IIf(value1 > 0, value1, IIf(PLC_index Mod 2, 20, 10)) & ")"
  End If
  
  cn.Execute strSQL
End Sub

Sub UpdateList(ExpBase As Boolean, cn As ADODB.Connection, rs As ADODB.Recordset, list As Long, Nomer As Long, Reg As Long, Bits As Long, name As String, TAG As String, Optional Enbld As Long = 1)
  Dim strSQL As String
  Dim cnt As Long
          
  If Not ExpBase Then
    Exit Sub
  End If
          
  rs.Open "select count(*) as cnt from List" & IIf(list = 7, "_DO", CStr(list)) & " where reg=" & Reg & _
          " and bits=" & Bits, cn, adOpenStatic, adLockReadOnly
  cnt = rs!cnt
  rs.Close
  
  name = Trim$(Replace$(name, "'", "''"))
   
  If list = 1 Then
    strSQL = "insert into List" & IIf(list = 7, "_DO", CStr(list)) & "(enabled,reg,[Name],bits,nomer,kodMA,TAG) " & _
             "values (" & IIf(Enbld = -1, 0, Enbld) & "," & Reg & ",'" & name & "'," & Bits & "," & IIf((Nomer Mod 16) = 0, 16, Nomer Mod 16) & _
              "," & Int((Nomer - 1) / IIf(list = 3, 64, 16)) + 1 & ",'" & TAG & "')"
  
  ElseIf list = 3 Then
    strSQL = "insert into List" & IIf(list = 7, "_DO", CStr(list)) & "(enabled,reg,[Name],bits,nomer,kodMA,TAG) " & _
             "values (" & IIf(Enbld = -1, 0, Enbld) & "," & Reg & ",'" & name & "'," & Bits & "," & IIf((Nomer Mod 64) = 0, 64, Nomer Mod 64) & _
              "," & Int((Nomer - 1) / IIf(list = 3, 64, 16)) + 1 & ",'" & TAG & "')"

  Else
    strSQL = "insert into List" & IIf(list = 7, "_DO", CStr(list)) & "(enabled,reg,[Name],bits,nomer,TAG) " & _
             "values (" & IIf(Enbld = -1, 0, Enbld) & "," & Reg & ",'" & name & "'," & Bits & "," & Nomer & _
             ",'" & TAG & "')"
  End If
  
  cn.Execute strSQL
End Sub

Sub CSV_Empty(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, ""
End Sub

Sub CSV_MainHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[NodeName : FIX;|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| : ;|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| : ;Date : " & Format(Now, "dd.mm.yyyy") & " ;Time : " & Format(Now, "hh:nn:ss") & "];;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"
End Sub

Sub CSV_AIHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[BLOCK TYPE;TAG;NEXT BLK;DESCRIPTION;INITIAL SCAN;SCAN TIME;SMOOTHING;I/O DEVICE;H/W OPTIONS;I/O ADDRESS;SIGNAL CONDITIONING;LOW EGU LIMIT;HIGH EGU LIMIT;EGU TAG;INITIAL A/M STATUS;ALARM ENABLE;ALARM AREA(S);LO LO ALARM LIMIT;LO ALARM LIMIT;HI ALARM LIMIT;HI HI ALARM LIMIT;ROC ALARM LIMIT;DEAD BAND;ALARM PRIORITY;ENABLE OUTPUT;SECURITY AREA 1;SECURITY AREA 2;SECURITY AREA 3;ALARM AREA 1;ALARM AREA 2;ALARM AREA 3;ALARM AREA 4;ALARM AREA 5;ALARM AREA 6;ALARM AREA 7;ALARM AREA 8;ALARM AREA 9;ALARM AREA 10;ALARM AREA 11;ALARM AREA 12;ALARM AREA 13;ALARM AREA 14;ALARM AREA 15;USER FIELD 1;USER FIELD 2;ESIG TYPE;ESIG ALLOW CONT USE;ESIG XMPT ALARM ACK;ESIG UNSIGNED WRITES]"
  Print #fh, "!A_NAME;A_TAG;A_NEXT;A_DESC;A_ISCAN;A_SCANT;A_SMOTH;A_IODV;A_IOHT;A_IOAD;A_IOSC;A_ELO;A_EHI;A_EGUDESC;A_IAM;A_IENAB;A_ADI;A_LOLO;A_LO;A_HI;A_HIHI;A_ROC;A_DBAND;A_PRI;A_EOUT;A_SA1;A_SA2;A_SA3;A_AREA1;A_AREA2;A_AREA3;A_AREA4;A_AREA5;A_AREA6;A_AREA7;A_AREA8;A_AREA9;A_AREA10;A_AREA11;A_AREA12;A_AREA13;A_AREA14;A_AREA15;A_ALMEXT1;A_ALMEXT2;A_ESIGTYPE;A_ESIGCONT;A_ESIGACK;A_ESIGTRAP!"
End Sub

Function CSV_AI(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If
  
  CSV_AI = inCSV & "AI;" & TAG.TAG & ";" & TAG.NextTAG & ";" & TAG.DESC & _
           ";ON;" & TAG.ScanTime & ";0;" & TAG.IODRV & ";;" & TAG.IODRVName & ":" & TAG.IOAddress & _
           ";" & TAG.Signal_Conditioning & ";" & TAG.Low_EGU & ";" & TAG.High_EGU & _
           ";;AUTO;DISABLE;NONE;0;0;0;0;0;0;L;" & TAG.Enable_Output & _
           ";NONE;NONE;NONE;ALL;;;;;;;;;;;;;;;;;NONE;YES;NO;REJECT" & vbCrLf
End Function

Function CSV_AI_SIM(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If
  
  CSV_AI_SIM = inCSV & "AI;" & TAG.TAG & ";" & TAG.NextTAG & ";" & TAG.DESC & _
           ";ON;" & TAG.ScanTime & ";0;" & TAG.IODRV & ";;" & TAG.IODRVName & TAG.IOAddress & _
           ";" & TAG.Signal_Conditioning & ";" & TAG.Low_EGU & ";" & TAG.High_EGU & _
           ";;AUTO;DISABLE;NONE;0;0;0;0;0;0;L;" & TAG.Enable_Output & _
           ";NONE;NONE;NONE;ALL;;;;;;;;;;;;;;;;;NONE;YES;NO;REJECT" & vbCrLf
End Function

Sub CSV_DIHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[BLOCK TYPE;TAG;NEXT BLOCK;DESCRIPTION;I/O DEVICE;H/W OPTIONS;I/O ADDRESS;INITIAL A/M STATUS;INITIAL SCAN;SCAN TIME;INVERT OUTPUT;OPEN TAG;CLOSE TAG;ALARM ENABLE;ALARM AREA(S);ALARM PRIORITY;ALARM TYPE;EVENT MESSAGES;SECURITY AREA 1;SECURITY AREA 2;SECURITY AREA 3;ENABLE OUTPUT;ALARM AREA 1;ALARM AREA 2;ALARM AREA 3;ALARM AREA 4;ALARM AREA 5;ALARM AREA 6;ALARM AREA 7;ALARM AREA 8;ALARM AREA 9;ALARM AREA 10;ALARM AREA 11;ALARM AREA 12;ALARM AREA 13;ALARM AREA 14;ALARM AREA 15;USER FIELD 1;USER FIELD 2;ESIG TYPE;ESIG ALLOW CONT USE;ESIG XMPT ALARM ACK;ESIG UNSIGNED WRITES];;;;;;"
  Print #fh, "!A_NAME;A_TAG;A_NEXT;A_DESC;A_IODV;A_IOHT;A_IOAD;A_IAM;A_ISCAN;A_SCANT;A_INV;A_OPENDESC;A_CLOSEDESC;A_IENAB;A_ADI;A_PRI;A_ALMCK;A_EVENT;A_SA1;A_SA2;A_SA3;A_EOUT;A_AREA1;A_AREA2;A_AREA3;A_AREA4;A_AREA5;A_AREA6;A_AREA7;A_AREA8;A_AREA9;A_AREA10;A_AREA11;A_AREA12;A_AREA13;A_AREA14;A_AREA15;A_ALMEXT1;A_ALMEXT2;A_ESIGTYPE;A_ESIGCONT;A_ESIGACK;A_ESIGTRAP!;;;;;;"
End Sub

Function CSV_DI(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

  CSV_DI = inCSV & "DI;" & TAG.TAG & ";" & TAG.NextTAG & ";" & TAG.DESC & _
           ";" & TAG.IODRV & ";;" & TAG.IODRVName & ":" & TAG.IOAddress & _
           ";AUTO;ON;" & TAG.ScanTime & ";NO;OPEN;CLOSE;DISABLE;NONE;L;COS;DISABLE;NONE;NONE;NONE;" & _
           TAG.Enable_Output & ";ALL;;;;;;;;;;;;;;;;;NONE;YES;NO;REJECT;;;;;;" & vbCrLf
End Function

Sub CSV_ARHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[BLOCK TYPE;TAG;DESCRIPTION;I/O DEVICE;H/W OPTIONS;I/O ADDRESS TYPE;I/O ADDRESS;SIGNAL CONDITIONING;LOW EGU LIMIT;HIGH EGU LIMIT;EGU TAG;OUTPUT ENABLE;EVENT MESSAGES;SECURITY AREA 1;SECURITY AREA 2;SECURITY AREA 3;USER FIELD 1;USER FIELD 2;ESIG TYPE;ESIG ALLOW CONT USE;ESIG XMPT ALARM ACK;ESIG UNSIGNED WRITES];;;;;;;;;;;;;;;;;;;;;"
  Print #fh, "!A_NAME;A_TAG;A_DESC;A_IODV;A_IOHT;A_NUMS;A_IOAD;A_IOSC;A_ELO;A_EHI;A_EGUDESC;A_OUT;A_EVENT;A_SA1;A_SA2;A_SA3;A_ALMEXT1;A_ALMEXT2;A_ESIGTYPE;A_ESIGCONT;A_ESIGACK;A_ESIGTRAP!;;;;;;;;;;;;;;;;;;;;;"
End Sub

Function CSV_AR(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

  CSV_AR = inCSV & "AR;" & TAG.TAG & ";" & TAG.DESC & ";" & TAG.IODRV & ";;DECIMAL;" & TAG.IODRVName & _
           ":" & TAG.IOAddress & ";" & TAG.Signal_Conditioning & ";" & TAG.Low_EGU & ";" & TAG.High_EGU & _
           ";" & TAG.EGUDESC & ";" & TAG.Enable_Output & _
           ";DISABLE;NONE;NONE;NONE;;;NONE;YES;NO;REJECT;;;;;;;;;;;;;;;;;;;;;" & vbCrLf
End Function

Sub CSV_DRHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[BLOCK TYPE;TAG;DESCRIPTION;I/O DEVICE;H/W OPTIONS;I/O ADDRESS TYPE;I/O ADDRESS;ENABLE OUTPUT;INVERT OUTPUT;OPEN TAG;CLOSE TAG;EVENT MESSAGES;SECURITY AREA 1;SECURITY AREA 2;SECURITY AREA 3;USER FIELD 1;USER FIELD 2;ESIG TYPE;ESIG ALLOW CONT USE;ESIG XMPT ALARM ACK;ESIG UNSIGNED WRITES];"
  Print #fh, "!A_NAME;A_TAG;A_DESC;A_IODV;A_IOHT;A_NUMS;A_IOAD;A_OUT;A_INV;A_OPENDESC;A_CLOSEDESC;A_EVENT;A_SA1;A_SA2;A_SA3;A_ALMEXT1;A_ALMEXT2;A_ESIGTYPE;A_ESIGCONT;A_ESIGACK;A_ESIGTRAP!;"
End Sub

Function CSV_DR(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

  CSV_DR = inCSV & "DR;" & TAG.TAG & ";" & TAG.DESC & ";" & TAG.IODRV & ";;DECIMAL;" & TAG.IODRVName & _
           ":" & TAG.IOAddress & ":" & TAG.IOAddress2 & ";" & TAG.Enable_Output & _
           ";NO;OPEN;CLOSE;DISABLE;NONE;NONE;NONE;;;NONE;YES;NO;REJECT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;" & vbCrLf
End Function

Function CSV_DR_SIM(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

  CSV_DR_SIM = inCSV & "DR;" & TAG.TAG & ";" & TAG.DESC & ";" & TAG.IODRV & ";;DECIMAL;" & TAG.IODRVName & _
           TAG.IOAddress & ":" & TAG.IOAddress2 & ";" & TAG.Enable_Output & _
           ";NO;OPEN;CLOSE;DISABLE;NONE;NONE;NONE;;;NONE;YES;NO;REJECT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;" & vbCrLf
End Function


Sub CSV_MDIHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[BLOCK TYPE;TAG;NEXT BLK;DESCRIPTION;ENABLE DEVICE 1;ENABLE DEVICE 2;DEVICE0;OPTIONS0;ADDRESS0;DEVICE1;OPTIONS1;ADDRESS1;DEVICE2;OPTIONS2;ADDRESS2;INITIAL SCAN;SCAN TIME;INITIAL A/M STATUS;REALARM;LABEL0;LABEL1;LABEL2;LABEL3;LABEL4;LABEL5;LABEL6;LABEL7;ALM0;ALM1;ALM2;ALM3;ALM4;ALM5;ALM6;ALM7;ALARM ENABLE;ALARM AREA(S);ALARM PRIORITY;SECURITY AREA 1;SECURITY AREA 2;SECURITY AREA 3;ALARM AREA 1;ALARM AREA 2;ALARM AREA 3;ALARM AREA 4;ALARM AREA 5;ALARM AREA 6;ALARM AREA 7;ALARM AREA 8;ALARM AREA 9;ALARM AREA 10;ALARM AREA 11;ALARM AREA 12;ALARM AREA 13;ALARM AREA 14;ALARM AREA 15;USER FIELD 1;USER FIELD 2;ESIG TYPE;ESIG ALLOW CONT USE;ESIG XMPT ALARM ACK;ESIG TRAP LEVEL]"
  Print #fh, "!A_NAME;A_TAG;A_NEXT;A_DESC;A_IO1;A_IO2;A_DIDV0;A_DIHT0;A_DIAD0;A_DIDV1;A_DIHT1;A_DIAD1;A_DIDV2;A_DIHT2;A_DIAD2;A_ISCAN;A_SCANT;A_IAM;A_REALM;A_TS0;A_TS1;A_TS2;A_TS3;A_TS4;A_TS5;A_TS6;A_TS7;A_AE0;A_AE1;A_AE2;A_AE3;A_AE4;A_AE5;A_AE6;A_AE7;A_IENAB;A_ADI;A_PRI;A_SA1;A_SA2;A_SA3;A_AREA1;A_AREA2;A_AREA3;A_AREA4;A_AREA5;A_AREA6;A_AREA7;A_AREA8;A_AREA9;A_AREA10;A_AREA11;A_AREA12;A_AREA13;A_AREA14;A_AREA15;A_ALMEXT1;A_ALMEXT2;A_ESIGTYPE;A_ESIGCONT;A_ESIGACK;A_ESIGTRAP!"
End Sub

Function CSV_MDI(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

  CSV_MDI = inCSV & "MDI;" & TAG.TAG & ";" & TAG.NextTAG & ";" & TAG.DESC & _
            ";" & IIf(TAG.IOAddress2 <> "", "YES", "NO") & ";" & IIf(TAG.IOAddress3 <> "", "YES", "NO") & _
            ";" & TAG.IODRV & ";;" & TAG.IODRVName & ":" & TAG.IOAddress & _
            ";" & TAG.IODRV & ";;" & TAG.IODRVName & ":" & TAG.IOAddress2 & _
            ";" & TAG.IODRV & ";;" & TAG.IODRVName & ":" & TAG.IOAddress3 & _
            ";ON;" & TAG.ScanTime & ";AUTO;NO;Sost_0;Sost_1;Sost_2;Sost_3;Sost_4;Sost_5;Sost_6;Sost_7;" & _
            "YES;YES;YES;YES;YES;YES;YES;YES;DISABLE;NONE;L;NONE;NONE;NONE;ALL;;;;;;;;;;;;;;;;;NONE;YES;NO;REJECT" & vbCrLf
End Function

Function CSV_MDI_SIM(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

CSV_MDI_SIM = inCSV & "MDI;" & TAG.TAG & ";" & TAG.NextTAG & ";" & TAG.DESC & _
            ";" & IIf(TAG.IOAddress2 <> "", "YES", "NO") & ";" & IIf(TAG.IOAddress3 <> "", "YES", "NO") & _
            ";" & TAG.IODRV & ";;" & TAG.IODRVName & TAG.IOAddress & _
            ";" & TAG.IODRV & ";;" & TAG.IODRVName & TAG.IOAddress2 & _
            ";" & TAG.IODRV & ";;" & TAG.IODRVName & TAG.IOAddress3 & _
            ";ON;" & TAG.ScanTime & ";AUTO;NO;Sost_0;Sost_1;Sost_2;Sost_3;Sost_4;Sost_5;Sost_6;Sost_7;" & _
            "YES;YES;YES;YES;YES;YES;YES;YES;DISABLE;NONE;L;NONE;NONE;NONE;ALL;;;;;;;;;;;;;;;;;NONE;YES;NO;REJECT" & vbCrLf
End Function


Sub CSV_ETRHdr(ExpCSV As Boolean, fh As Integer)
  If Not ExpCSV Then
    Exit Sub
  End If
  
  Print #fh, "[BLOCK TYPE;TAG;NEXT BLOCK;INPUT;LOW EGU LIMIT;HIGH EGU LIMIT;EGU TAG;COMPRESSION FACTOR;BUFFER CLEAR STATUS;SECURITY AREA 1;SECURITY AREA 2;SECURITY AREA 3;DESCRIPTION;ESIG TYPE;ESIG ALLOW CONT USE;ESIG XMPT ALARM ACK;ESIG UNSIGNED WRITES];;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"
  Print #fh, "!A_NAME;A_TAG;A_NEXT;A_GET1;A_ELO;A_EHI;A_EGUDESC;A_TIME;A_BC;A_SA1;A_SA2;A_SA3;A_DESC;A_ESIGTYPE;A_ESIGCONT;A_ESIGACK;A_ESIGTRAP!;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"
End Sub

Function CSV_ETR(ExpCSV As Boolean, fh As Integer, inCSV As String, TAG As CSVTagInfo) As String
  If Not ExpCSV Then
    Exit Function
  End If

  CSV_ETR = inCSV & "ETR;" & TAG.TAG & ";" & TAG.NextTAG & ";;" & TAG.Low_EGU & ";" & TAG.High_EGU & _
           ";;1;YES;NONE;NONE;NONE;" & TAG.DESC & ";NONE;YES;NO;REJECT;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;" & vbCrLf
End Function

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
Function GetUstAddr(name As String) As Long
  Dim arr As Variant, arr1 As Variant, WorkItem As Object
  Dim i As Long, j As Long, k As Long
  
  Set WorkItem = ThisWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  
  j = CLng(WorkItem.Cells(10, 7).Text)      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  k = CLng(WorkItem.Cells(12, 13).Text)     ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| !!!
  arr = Array("AIPUST16", "Delta", "cuAddrAID", _
              "AIPUST17", "Mask1", "cuAddrAIMask1", _
              "AIPUST18", "Mask2", "cuAddrAIMask2", _
              "AIPUST19", "DopKC", "cuAddrAIDopKC", _
              "AIPUST20", "Hys", "cuAddrAIHys", _
              "AIPUST21", "Enabled", "cuAddrAIEnabled", _
              "AIPUST22", "DV", "cuAddrAISpd", _
              "AIPUST1", "HL", "cuAddrAIVPD", _
              "AIPUST4", "MAX3", "cuAddrAIMAX3", _
              "AIPUST5", "MAX2", "cuAddrAIMAX2", _
              "AIPUST6", "MAX1", "cuAddrAIMAX1", _
              "AIPUST7", "MAX0", "cuAddrAIMAX0", _
              "AIPUST8", "MIN0", "cuAddrAIMIN0", _
              "AIPUST9", "MIN1", "cuAddrAIMIN1", _
              "AIPUST10", "MIN2", "cuAddrAIMIN2", _
              "AIPUST11", "MIN3", "cuAddrAIMIN3", _
              "AIPUST14", "LL", "cuAddrAINPD", _
              "AIPUST2", "MAX5", "cuAddrAIMAX5", _
              "AIPUST3", "MAX4", "cuAddrAIMAX4", _
              "AIPUST12", "MIN4", "cuAddrAIMIN4", _
              "AIPUST13", "MIN5", "cuAddrAIMIN5", _
              "AIPUST23", "|fffd||fffd||fffd||fffd||fffd||fffd|1", "|fffd||fffd||fffd||fffd||fffd||fffd|1", _
              "AIPUST24", "|fffd||fffd||fffd||fffd||fffd||fffd|2", "|fffd||fffd||fffd||fffd||fffd||fffd|2", _
              "AIPUST25", "|fffd||fffd||fffd||fffd||fffd||fffd|3", "|fffd||fffd||fffd||fffd||fffd||fffd|3")
  
  For i = LBound(arr) To UBound(arr)
    If UCase$(CStr(arr(i))) = UCase$(name) Then
      GetUstAddr = j + (i \ 3) * k
      Exit Function
    End If
  Next i

  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  arr1 = Array("AIPUST15", "AIPoint", "cuAddrAIPoints", WorkItem.Cells(8, 7).Text, _
               "N/A", "AIResults", "cuAddrAIBegin", WorkItem.Cells(14, 4).Text, _
               "N/A", "AISmooth", "cuAddrAISmooth", WorkItem.Cells(12, 4).Text)
  
  For i = LBound(arr1) To UBound(arr1)
    If (i + 1) Mod 4 <> 0 Then                  ' 4 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      If UCase$(CStr(arr1(i))) = UCase$(name) Then
        GetUstAddr = arr1((i \ 4) * 4 + 3)      ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 4 |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        Exit Function
      End If
    End If
  Next i
  
  MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| '" & name & "' |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
End Function



Attribute VB_Name = "ModuleImp"
Sub ImpOldActiveList()
  MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" + _
         Chr(13) + "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
End Sub

Sub ImpOldAllLists()
  MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" + _
         Chr(13) + "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
End Sub



Attribute VB_Name = "ModuleServ"
Public DoSelection As Boolean
Public SignType As Integer
Public Listname As String
Public EditRangeRow As Long
Public EditRangeCol As Long
Public EthernetIP As Long
Public EthernetSlot As Integer

Public Const snDI = 1
Public Const snDO = 2
Public Const snAI = 3
Public Const snAIm = 4
Public Const snAO = 5
Public Const snGrp = 6

Public Const ltMinAvar = 1
Public Const ltMin = 2
Public Const ltMax = 3
Public Const ltMaxAvar = 4
 
Sub Lists()
  Set myBar = CommandBars.ActionControl
  For i = 1 To myBar.Controls.Count
    myBar.Controls.Item(1).Delete
  Next
  For i = 1 To Sheets.Count
    Set myControl = myBar.Controls.Add(Type:=msoControlButton)
    With myControl
      .Caption = Sheets.Item(i).name
      .OnAction = "CBarButton_Click"
    End With
  Next
  myBar.Visible = True
End Sub

Sub CBarButton_Click()
    Set myControl = CommandBars.ActionControl
    Sheets(myControl.Caption).Select
End Sub

Sub OnHelpRequest()
  MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd|:" + Chr(13) + _
         "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| 25% - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|)" + Chr(13) + _
         "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd| ""|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" + Chr(13) + _
         "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd| ""|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" + Chr(13) + _
         "|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.", vbOKOnly Or vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd|"
End Sub

Sub RefreshAll()
  Worksheets("LIST1").RefreshCBtn8_Click
  Worksheets("LIST2").RefreshCBtn9_Click
  Worksheets("LIST3").RefreshCBtn10_Click
  Worksheets("LIST4").RefreshCBtn11_Click
  Worksheets("LIST5").RefreshCBtn12_Click
  Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn14_Click
  Worksheets("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|").Worksheet_Activate
  Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn19_Click
  Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn20_Click
  Worksheets("|fffd||fffd||fffd|. |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Refresh|fffd|Btn23_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn24_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn29_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn31_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn32_Click
  Worksheets("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn33_Click
  Worksheets("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn37_Click
  Worksheets("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn38_Click
  Worksheets("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn39_Click
  Worksheets("DI |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn40_Click
  Worksheets("DO |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn41_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn43_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|").RefreshCBtn44_Click
  Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").RefreshCBtn45_Click
End Sub
Function ExtractProjName(FName As String) As String
  Dim PosSl As Integer
  Dim PosP As Integer
  Dim LenStr As Integer
  LenStr = Len(FName)
  For i = LenStr To 1 Step -1
    If Mid(FName, i - 1, 1) = "\" Then
      PosSl = i
      Exit For
    End If
    If Mid(FName, i - 1, 1) = "." Then
      PosP = i
    End If
  Next i
  ExtractProjName = Mid(FName, PosSl, LenStr - PosSl - (LenStr - PosP) - 1)
End Function

Function GetIPCode(IPStr As String) As Long
  Dim N4 As Integer
  Dim N3 As Integer
  Dim N2 As Integer
  Dim N1 As Integer
  Dim n As Integer
  Dim LenStr As Integer
  GetIPCode = 16843009
  LenStr = Len(IPStr)
  n = 0
  For i = LenStr To 1 Step -1
    If Mid(IPStr, i - 1, 1) = "." Or Mid(IPStr, i - 1, 1) = "," Then
      n = n + 1
      Select Case n
        Case 1
          GetIPCode = 65536 * CInt(Right(IPStr, Len(IPStr) - i + 1))
          IPStr = Left(IPStr, i - 2)
        Case 2
          GetIPCode = GetIPCode + 16777216 * CInt(Right(IPStr, Len(IPStr) - i + 1))
          IPStr = Left(IPStr, i - 2)
        Case 3
          GetIPCode = GetIPCode + CInt(Right(IPStr, Len(IPStr) - i + 1))
          IPStr = Left(IPStr, i - 2)
          GetIPCode = GetIPCode + 256 * CLng(IPStr)
          Exit For
      End Select
    End If
  Next i
End Function

Sub WriteModule(fNum As Long, ModuleName As String, i As Variant, j As Variant)
  If ModuleName = "140 CRA 932 00" Or ModuleName = "140 CRA 931 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 2"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 267"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-CRA-93x-00"""
    Print #fNum, String(4, Chr(9)); "END"
  
  ElseIf ModuleName = "140 ACI 040 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 2"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 294"
    Print #fNum, String(5, Chr(9)); "inputBytes = 34"
    Print #fNum, String(5, Chr(9)); "inputIsRegister = 1"
    If Cells(6 + 6 * (i - 1), 5 + j - 1).Value < 400000 Then
      Print #fNum, String(5, Chr(9)); "inputReference = 3:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 300000)
    Else
      Print #fNum, String(5, Chr(9)); "inputReference = 4:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 400000)
    End If
    Print #fNum, String(5, Chr(9)); "outputIsSwapped = 1"
    Print #fNum, String(5, Chr(9)); "dataLength = 5"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-ACI-040-00"""
    Print #fNum, String(5, Chr(9)); "modData = 10: 33 33 33 33 33 33 33 33 33 33 "
    Print #fNum, String(4, Chr(9)); "END"
   
  ElseIf ModuleName = "140 ACO 020 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 2"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 259"
    Print #fNum, String(5, Chr(9)); "outputBytes = 8"
    Print #fNum, String(5, Chr(9)); "outputIsRegister = 1"
    Print #fNum, String(5, Chr(9)); "outputIsSwapped = 1"
    Print #fNum, String(5, Chr(9)); "outputReference = 4:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 400000)
    Print #fNum, String(5, Chr(9)); "dataLength = 2"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-ACO-020-00"""
    Print #fNum, String(5, Chr(9)); "modData = 4: 01 80 55 55 "
    Print #fNum, String(4, Chr(9)); "END"
   
  ElseIf ModuleName = "140 DDI 353 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 6"
    Print #fNum, String(5, Chr(9)); "inputBytes = 4"
    Print #fNum, String(5, Chr(9)); "inputIsRegister = 1"
    Print #fNum, String(5, Chr(9)); "inputIsSwapped = 1"
    If Cells(6 + 6 * (i - 1), 5 + j - 1).Value < 400000 Then
      Print #fNum, String(5, Chr(9)); "inputReference = 3:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 300000)
    Else
      Print #fNum, String(5, Chr(9)); "inputReference = 4:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 400000)
    End If
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-DDI-353-00"""
    Print #fNum, String(4, Chr(9)); "END"
  
  ElseIf ModuleName = "140 DDO 353 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 4"
    Print #fNum, String(5, Chr(9)); "outputBytes = 4"
    Print #fNum, String(5, Chr(9)); "outputIsRegister = 1"
    Print #fNum, String(5, Chr(9)); "outputIsSwapped = 1"
    If Cells(6 + 6 * (i - 1), 5 + j - 1).Value < 400000 Then
      Print #fNum, String(5, Chr(9)); "outputReference = 3:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 300000)
    Else
      Print #fNum, String(5, Chr(9)); "outputReference = 4:"; CStr(Cells(6 + 6 * (i - 1), 5 + j - 1).Value - 400000)
    End If
    Print #fNum, String(5, Chr(9)); "dataLength = 2"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-DDO-353-00"""
    Print #fNum, String(5, Chr(9)); "fHoldLast = 1"
    Print #fNum, String(5, Chr(9)); "modData = 4: 00 00 00 00 "
    Print #fNum, String(4, Chr(9)); "END"
  
  ElseIf ModuleName = "140 CPS 114 20" Or ModuleName = "140 CPS 114 10" Or ModuleName = "140 CPS 114 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 6"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 9"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-CPS-114-x0"""
    Print #fNum, String(4, Chr(9)); "END"

  ElseIf ModuleName = "140 CPU 434 12" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 5"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 283"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-CPU-434-12"""
    Print #fNum, String(4, Chr(9)); "END"

  ElseIf ModuleName = "140 CHS 210 00" Or ModuleName = "140 CHS 110 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 278"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-CHS-110-00"""
    Print #fNum, String(4, Chr(9)); "END"
  
  ElseIf ModuleName = "140 NOM 2xx 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 4"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 268"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-NOM-2xx-00"""
    Print #fNum, String(4, Chr(9)); "END"
    HeadSlot = j
    
  ElseIf ModuleName = "140 CRP 932 00" Or ModuleName = "140 CRP 931 00" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 4"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 257"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-CRP-93x-00"""
    Print #fNum, String(4, Chr(9)); "END"
  
  ElseIf ModuleName = "140 NOE 771 00" Then
    EthernetSlot = j
    EthernetIP = GetIPCode(Cells(6 + 6 * (i - 1), 5 + j - 1).Text)
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "moduleClass = 4"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 1037"
    Print #fNum, String(5, Chr(9)); "dataLength = 7"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-NOE-771-00"""
    Print #fNum, String(5, Chr(9)); "modData = 14: 00 00 00 00 00 00 00 FF FF FF 00 00 00 00 "
    Print #fNum, String(4, Chr(9)); "END"
  
  ElseIf ModuleName = "140 CRA 21x x0" Then
    Print #fNum, String(4, Chr(9)); "BEGIN IOModule"
    Print #fNum, String(5, Chr(9)); "rack = 1"
    Print #fNum, String(5, Chr(9)); "slot = "; CStr(j)
    Print #fNum, String(5, Chr(9)); "family = 2"
    Print #fNum, String(5, Chr(9)); "personality = 265"
    Print #fNum, String(5, Chr(9)); "moduleName = ""140-CRA-21x-x0"""
    Print #fNum, String(4, Chr(9)); "END"
    HeadSlot = j
  End If
End Sub

Sub DoCfgFile()
  Load PathForm
  PathForm.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| Concept"
  PathForm.CmnDlg.Filter = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (*.ccf)|*.ccf"
  PathForm.Show vbModal
  If FileNameStr <> "" Then
    Dim IsEthernet As Boolean
    IsEthernet = False
    EthernetSlot = 0
    EthernetIP = 16843009
    Open FileNameStr For Output As #1    ' Open file for output.
    Print #1, "; |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| Excel: """; ThisWorkbook.name; """ "; CStr(FormatDateTime(Now, vbLongDate)); " "; FormatDateTime(Now, vbLongTime)
    Print #1, ";"
    Print #1, "BEGIN PlcCnfDb"
    Print #1, String(1, Chr(9)); "Version = 2.16"
    Print #1,
    Print #1, String(1, Chr(9)); "BEGIN PLCConfig"
    Print #1, String(2, Chr(9)); "plcName = """; UCase(ExtractProjName(FileNameStr)); """"
    Print #1, String(2, Chr(9)); "modelName = ""QUANTUM-434 12"""
    Print #1, String(2, Chr(9)); "configTable = 0883 0000 0000 0000 0000 0600 0000 0000 0000 0001 0200 0000 0000 0000 A488 0000 "
    Print #1, String(3, Chr(9)); "4E20 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 "
    Print #1, String(3, Chr(9)); "0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 "
    Print #1, String(3, Chr(9)); "0000 0000 0000 0010 0040 0000 0000 0000 0000 0000 0020 0000 0000 0000 0000 0000 "
    Print #1, String(3, Chr(9)); "0000 0000 0000 7FEE 0002 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 "
    Print #1, String(3, Chr(9)); "0100 0001 6FEE 0000 0001 0001 6FEE 0000 0001 0001 6FEE 0000 0001 0000 0000 0000 "
    Print #1, String(3, Chr(9)); "0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 001E 0000 0001 0000 0000 "
    Print #1, String(3, Chr(9)); "0000 0000 0000 0000 0000 0000 0000 00DF 0000 0000 0000 000A 206F 0000 0001 0000 "
    Print #1, String(3, Chr(9))
    Set NOE = Range("A1:T193").Find("140 NOE 771 00", LookIn:=xlValues)
    Set CHS = Range("A1:T193").Find("140 CHS 210 00", LookIn:=xlValues)
    Set NOM = Range("A1:T193").Find("140 NOM 2xx 00", LookIn:=xlValues)
    If Not NOE Is Nothing And Not CHS Is Nothing Then
      Print #1, String(2, Chr(9)); "extCount = 2"
      Print #1, String(2, Chr(9)); "extType = 00 00 01 01 00 00 00 00 00 01 00 00 00 00 00 00 "
    ElseIf NOE Is Nothing Then
      Print #1, String(2, Chr(9)); "extCount = 1"
      Print #1, String(2, Chr(9)); "extType = 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 "
    ElseIf CHS Is Nothing Then
      Print #1, String(2, Chr(9)); "extCount = 1"
      Print #1, String(2, Chr(9)); "extType = 00 00 00 01 00 00 00 00 00 01 00 00 00 00 00 00 "
    End If

    Print #1, String(2, Chr(9)); "ioMapExpandSize = 144"
    Print #1, String(2, Chr(9)); "pcExpandSize = 100"
    Print #1, String(2, Chr(9)); "pcHealthTimeout = 01F4 01F4 01F4"
    Print #1, String(2, Chr(9)); "pcHoldLastValue = 0001 0001 0000"
    Print #1, String(2, Chr(9)); "commandReg = 10"
    Print #1, String(2, Chr(9)); "initCmdRegValue = 6"
    Print #1, String(2, Chr(9)); "nonXferAreaStart = 19900"
    Print #1, String(2, Chr(9)); "nonXferAreaLen = 100"
    Print #1, String(2, Chr(9)); "stateRAMXferCtrl = 244"
    Print #1, String(2, Chr(9)); "iecHsbFrstReg = 961"
    Print #1, String(2, Chr(9)); "iecHsbNumReg = 41160"
    If Not CHS Is Nothing Then
      Print #1, String(2, Chr(9)); "hotStdBy = 2"
    End If
    Print #1, String(2, Chr(9)); "totalExeLoadSize = 916032"
    If Not CHS Is Nothing Then
      Print #1, String(2, Chr(9)); "pcLinkSlot1 = "; CStr(CHS.Column - 4)
    ElseIf Not NOE Is Nothing Then
      Print #1, String(2, Chr(9)); "pcLinkSlot1 = "; CStr(NOE.Column - 4)
    End If
    
    Dim HeadSlot As Integer
    HeadSlot = 0
    Print #1, String(2, Chr(9)); "BEGIN DropHead"
    Print #1, String(3, Chr(9)); "headIndex = 1"
    Print #1, String(3, Chr(9)); "headType = 1"
    Set f = Range("A1:T193").Find("140 CRP 932 00", LookIn:=xlValues)
    If Not f Is Nothing Then
      Print #1, String(3, Chr(9)); "headSlot = "; CStr(f.Column - 4)
    End If
    Dim DropCount As Long
    DropCount = 0
    For i = 1 To 32
      Set DIO = Range("A" + CStr(5 + 6 * (i - 1)) + ":T" + CStr(5 + 6 * (i - 1))).Find("140 CRA 21x x0", LookIn:=xlValues)
      If Cells(4 + 6 * (i - 1), 2).Font.ColorIndex <> 15 And DIO Is Nothing Then
        DropCount = DropCount + 1
        Print #1, String(3, Chr(9)); "BEGIN IODrop"
        Print #1, String(4, Chr(9)); "dropNumber = "; CStr(DropCount)
        Print #1, String(4, Chr(9)); "dropType = 1"
        Print #1, String(4, Chr(9)); "holdUp = 4"
       
        For j = 1 To 16
          Set WorkCellMod = Cells(5 + 6 * (i - 1), 5 + j - 1)
          If Cells(4 + 6 * (i - 1), 5 + j - 1).Interior.ColorIndex <> 1 Then
            WriteModule 1, WorkCellMod.Text, i, j
          End If
        Next j
        Print #1, String(3, Chr(9)); "END"
      End If
    Next i
    Print #1, String(2, Chr(9)); "END"
    Print #1, String(2, Chr(9)); "BEGIN DropHead"
    Print #1, String(3, Chr(9)); "headIndex = 2"
    Print #1, String(3, Chr(9)); "headType = 2"
    DropCount = 0
    For i = 1 To 32
      Set DIO = Range("A" + CStr(5 + 6 * (i - 1)) + ":T" + CStr(5 + 6 * (i - 1))).Find("140 CRA 21x x0", LookIn:=xlValues)
      If Cells(4 + 6 * (i - 1), 2).Font.ColorIndex <> 15 And Not DIO Is Nothing Then
        DropCount = DropCount + 1
        Print #1, String(3, Chr(9)); "BEGIN IODrop"
        Print #1, String(4, Chr(9)); "dropNumber = "; CStr(DropCount)
        Print #1, String(4, Chr(9)); "dropType = 3"
        Print #1, String(4, Chr(9)); "holdUp = 3"
        For j = 1 To 16
          Set WorkCellMod = Cells(5 + 6 * (i - 1), 5 + j - 1)
          If Cells(4 + 6 * (i - 1), 5 + j - 1).Interior.ColorIndex <> 1 Then
            WriteModule 1, WorkCellMod.Text, i, j
          End If
        Next j
        Print #1, String(3, Chr(9)); "END"
      End If
    Next i
    Print #1, String(2, Chr(9)); "END"
    Print #1, String(2, Chr(9)); "BEGIN DropHead"
    Print #1, String(3, Chr(9)); "headIndex = 3"
    Print #1, String(3, Chr(9)); "headType = 2"
    If Not NOM Is Nothing Then
      Print #1, String(3, Chr(9)); "headSlot = "; (NOM.Column - 4)
    End If
    Print #1, String(2, Chr(9)); "END"
    Print #1, String(2, Chr(9)); "BEGIN DropHead"
    Print #1, String(3, Chr(9)); "headIndex = 4"
    Print #1, String(3, Chr(9)); "headType = 2"
    Print #1, String(2, Chr(9)); "END"
    For k = 5 To 9
      Print #1, String(2, Chr(9)); "BEGIN DropHead"
      Print #1, String(3, Chr(9)); "headIndex = "; CStr(k)
      Print #1, String(3, Chr(9)); "headType = 3"
      Print #1, String(2, Chr(9)); "END"
    Next k
    For k = 1 To 32
      If Cells(4 + 6 * (k - 1), 2).Font.ColorIndex <> 15 Then
        Print #1, String(2, Chr(9)); "BEGIN SegmSched"
        Print #1, String(3, Chr(9)); "schedIndex = "; CStr(k)
        Print #1, String(3, Chr(9)); "programSegment = "; CStr(k)
        Print #1, String(3, Chr(9)); "dropInput = "; CStr(k)
        Print #1, String(3, Chr(9)); "dropOutput = "; CStr(k)
        Print #1, String(2, Chr(9)); "END"
      Else
        Print #1, String(2, Chr(9)); "BEGIN SegmSched"
        Print #1, String(3, Chr(9)); "schedIndex = "; CStr(k)
        Print #1, String(3, Chr(9)); "typeOfSolve = 3"
        Print #1, String(3, Chr(9)); "programSegment = "; CStr(k)
        Print #1, String(2, Chr(9)); "END"
      End If
    Next k

    Print #1, String(2, Chr(9)); "BEGIN LoadedInstr"
    Print #1, String(3, Chr(9)); "fileName = ""CHS_208.DAT"""
    Print #1, String(3, Chr(9)); "majorVersion = 208"
    Print #1, String(3, Chr(9)); "minorVersion = 21526"
    Print #1, String(3, Chr(9)); "instrFamily = 1"
    Print #1, String(3, Chr(9)); "instrName = ""CHS """
    Print #1, String(3, Chr(9)); "opcode = 255"
    Print #1, String(3, Chr(9)); "groupMembership = 30"
    Print #1, String(3, Chr(9)); "placementRules = 2"
    Print #1, String(3, Chr(9)); "nodesPerElement = 3"
    Print #1, String(3, Chr(9)); "nodeParam = 0008 C008 0010"
    Print #1, String(3, Chr(9)); "maxConstant = 1FFF 1FFF 1FFF"
    Print #1, String(3, Chr(9)); "geeID = 4602"
    Print #1, String(3, Chr(9)); "menuHelpID = 518"
    Print #1, String(3, Chr(9)); "heapSize = 832"
    Print #1, String(2, Chr(9)); "END"
    Print #1, String(2, Chr(9)); "BEGIN LoadedInstr"
    Print #1, String(3, Chr(9)); "fileName = ""IHSB196.exe"""
    Print #1, String(3, Chr(9)); "majorVersion = 196"
    Print #1, String(3, Chr(9)); "instrFamily = 3"
    Print #1, String(3, Chr(9)); "instrName = ""IHSB"""
    Print #1, String(3, Chr(9)); "opcode = 251"
    Print #1, String(3, Chr(9)); "groupMembership = 30"
    Print #1, String(3, Chr(9)); "placementRules = 2"
    Print #1, String(3, Chr(9)); "nodesPerElement = 3"
    Print #1, String(3, Chr(9)); "nodeParam = 0018 C008 0010 "
    Print #1, String(3, Chr(9)); "maxConstant = FFFF FFFF 270F "
    Print #1, String(3, Chr(9)); "geeID = 4602"
    Print #1, String(3, Chr(9)); "menuHelpID = 518"
    Print #1, String(3, Chr(9)); "heapSize = 57152"
    Print #1, String(2, Chr(9)); "END"
    If Not NOE Is Nothing Then
      Print #1, String(2, Chr(9)); "BEGIN EthernetCTE"
      Print #1, String(3, Chr(9)); "index = 1"
      Print #1, String(3, Chr(9)); "ipAddress = "; CStr(EthernetIP)
      Print #1, String(3, Chr(9)); "subntMsk = -256"
      Print #1, String(3, Chr(9)); "slot = "; CStr(EthernetSlot)
      Print #1, String(3, Chr(9)); "personality = 1037"
      Print #1, String(2, Chr(9)); "END"
      EthernetSlot = 0
    End If
    Print #1, String(1, Chr(9)); "END"
    Print #1, "END"

    Close #1
  End If
End Sub

Sub ColorsActive()
 Dim S As String
 Set WorkItem = ThisWorkbook.ActiveSheet
 S = WorkItem.name
 If Not (S = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "LIST2" Or _
    S = "LIST3" Or S = "LIST4" Or S = "LIST5" Or _
    S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or _
    S = "DI |fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or _
    S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Or S = "DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|") Then Exit Sub
  
  Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("E6:F5000").Interior.ColorIndex = 0
  Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("E6:F2000").Interior.ColorIndex = 0
  Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("B6:C505").Interior.ColorIndex = 0
  If S = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
    For i = 1 To 128
      If Cells(6 + i - 1, 11).Value <> 0 Then
        Select Case Cells(6 + i - 1, 8).Value
          Case 0
              Set c = Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("I6:I5000").Find((Cells(6 + i - 1, 11).Value + 1000), LookIn:=xlValues)
              If Not c Is Nothing Then
                Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Cells(c.Row, 5).Interior.ColorIndex = 38
                Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Cells(c.Row, 6).Interior.ColorIndex = 38
              End If
          Case 1
              Set c = Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("I6:I2000").Find((Cells(6 + i - 1, 11).Value + 3000), LookIn:=xlValues)
              If Not c Is Nothing Then
                Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Cells(c.Row, 5).Interior.ColorIndex = 38
                Worksheets("DI |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Cells(c.Row, 6).Interior.ColorIndex = 38
              End If
          Case 2, 3, 6, 7
              Set c = Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("A6:A600").Find((Cells(6 + i - 1, 11).Value), LookIn:=xlValues)
              If Not c Is Nothing Then
                Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Cells(c.Row, 2).Interior.ColorIndex = 38
                Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Cells(c.Row, 3).Interior.ColorIndex = 38
              End If
        End Select
      End If
    Next i
  End If
End Sub

Sub ColorsAll()
  MsgBox "dsf2"
End Sub

Function FileUtils_IsFolderPresent(ByVal strFileName As String) As Boolean
    Dim strTmp As String '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    FileUtils_IsFolderPresent = False
    '|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    On Error Resume Next
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Dir |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| vbDirectory
    strTmp = Dir(strFileName, vbDirectory)
    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| (|fffd|.|fffd|. |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|) - |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    If Err <> 0 Then Exit Function
    '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| TRUE
    If strTmp <> Empty Then FileUtils_IsFolderPresent = True
End Function

Sub MakeDir(dirname As String)
Dim i As Long, path As String
Do
i = InStr(i + 1, dirname & "\", "\")
path = Left$(dirname, i - 1)
If Right$(path, 1) <> ":" And Dir$(path, vbDirectory) = "" Then
MkDir path
End If
Loop Until i >= Len(dirname)
End Sub

Public Function PrintFixTrendHead(fpath As String) As String
  PrintFixTrendHead = "[|fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| FIX32]" & vbCrLf & _
    "[|fffd||fffd||fffd||fffd|:" & fpath & "]" & vbCrLf & _
    "[01.01.100  00:00:00]" & vbCrLf
End Function

Public Function PrintFixTrendSets(Optional fhour As Long = 4, Optional lday As Long = 200) As String
  PrintFixTrendSets = vbCrLf & _
    "!|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & vbCrLf & _
    Qu & CStr(fhour) & Qu & ";" & Qu & "YES" & Qu & ";" & Qu & CStr(lday) & Qu & vbCrLf
End Function

Public Function PrintFixTrendGroupHead() As String
  PrintFixTrendGroupHead = vbCrLf & _
    "!|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
End Function

Public Function PrintFixTrendGroupVar(nGrp As Long, sec As Long, size As Long) As String
  PrintFixTrendGroupVar = _
    Qu & CStr(nGrp) & Qu & ";" & Qu & "THISNODE" & Qu & ";" & Qu & CStr(sec) & "s" & Qu & ";" & Qu & "0s" & Qu & ";" & Qu & Qu & ";" & Qu & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & Qu & ";" & Qu & CStr(size) & Qu
End Function

Public Function PrintFixTrendVarHead() As String
  PrintFixTrendVarHead = vbCrLf & _
    "!|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|;|fffd||fffd||fffd| |fffd||fffd||fffd||fffd|;|fffd||fffd||fffd||fffd||fffd||fffd|"
End Function

Public Function PrintFixTrendVarVar(gr As Long, nm1 As String, nm2 As String, nm3 As String, nm4 As String, nm5 As String, _
                                    Optional sn1 As String = "0,100000", Optional sn2 As String = "0,100000", _
                                    Optional sn3 As String = "0,100000", Optional sn4 As String = "0,100000", _
                                    Optional sn5 As String = "0,100000") As String
  PrintFixTrendVarVar = Qu & CStr(gr) & Qu & ";" & Qu & _
    IIf(nm1 <> "", nm1 & Qu & ";" & Qu & sn1 & Qu & ";" & Qu, "") & _
    IIf(nm2 <> "", nm2 & Qu & ";" & Qu & sn2 & Qu & ";" & Qu, "") & _
    IIf(nm3 <> "", nm3 & Qu & ";" & Qu & sn3 & Qu & ";" & Qu, "") & _
    IIf(nm4 <> "", nm4 & Qu & ";" & Qu & sn4 & Qu & ";" & Qu, "") & _
    IIf(nm5 <> "", nm5 & Qu & ";" & Qu & sn5 & Qu, "")
End Function
Attribute VB_Name = "ModuleUtil"
Option Explicit

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| \ |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
Public Function GetPath(pth As String) As String
  Dim t As String
  
  GetPath = Trim$(pth)
  If Right$(GetPath, 1) <> "\" Then
    GetPath = GetPath & "\"
  End If
End Function

Public Function Addr4x(adr As Long) As String
  Addr4x = Left$("400000", 6 - Len(CStr(adr))) & CStr(adr)
End Function

Public Function Addr3x(adr As Long) As String
  Addr3x = Left$("300000", 6 - Len(CStr(adr))) & CStr(adr)
End Function

Public Function SetEndDot(msg As String) As String
  SetEndDot = Trim$(msg)
  
  If Right$(SetEndDot, 1) <> "." Then
    SetEndDot = SetEndDot & "."
  End If
End Function

Public Function IsListExist(lst As String) As Boolean
  Dim i As Long
  
  For i = 1 To Sheets.Count
    If Sheets(i).name = lst Then
      IsListExist = True
      Exit Function
    End If
  Next i
End Function

Public Function Rus2Eng(rus As String, Optional IsMute As Boolean = False, Optional ReplaceSymbol) As String
  Dim RusA, EngA, i

  RusA = Array("|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|", "|fffd|")
  EngA = Array("Y", "K", "E", "H", "X", "B", "A", "P", "P", "O", "C", "M", "T", "D")
  
  Rus2Eng = rus
  
  For i = LBound(RusA) To UBound(RusA)
    Rus2Eng = Replace$(Rus2Eng, LCase$(RusA(i)), LCase$(EngA(i)), , , vbBinaryCompare)
    Rus2Eng = Replace$(Rus2Eng, RusA(i), EngA(i), , , vbBinaryCompare)
  Next
  
  For i = 1 To Len(Rus2Eng)
    If Asc(Mid$(Rus2Eng, i, 1)) > 127 Then
      If Not IsMute Then
        MsgBox "|fffd||fffd||fffd||fffd||fffd| ''" & Mid$(Rus2Eng, i, 1) & "'' |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      End If
      
      If Not IsMissing(ReplaceSymbol) Then
        Rus2Eng = Left$(Rus2Eng, i - 1) & Left$(CStr(ReplaceSymbol), 1) & Mid$(Rus2Eng, i + 1)
      End If
    End If
  Next i
End Function

' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public Function GetNextCSV(csv As String) As String
  Dim i As Long
  
  Do
    i = InStr(1, csv, ",")
    
    If i > 0 Then
      GetNextCSV = Trim(Left(csv, i - 1))
      csv = Mid(csv, i + 1)
    Else
      GetNextCSV = Trim(csv)
      csv = ""
    End If
  Loop While GetNextCSV = "" And csv <> ""
End Function

Function Qu() As String
  Qu = Chr(34)
End Function

Attribute VB_Name = "PForm"
Attribute VB_Base = "0{80C3D095-059F-4C16-8F8F-D336FAC85A86}{3CAE3678-5A92-4DD9-8695-7A85987474A6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Attribute VB_Name = "PathForm"
Attribute VB_Base = "0{9EAF840D-1F33-4B0F-B042-8F3EE52FC8E7}{75C3191B-28BF-477C-8123-1A41B823BF41}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CmdBtnCancel_Click()
  Unload PathForm
End Sub

Private Sub CmdBtnGetPath_Click()
  CmnDlg.ShowOpen
  TextBoxPath = CmnDlg.FileName
End Sub

Private Sub CmdBtnOk_Click()
  ModuleExp.FileNameStr = TextBoxPath.Text
  Unload PathForm
End Sub

Private Sub ComboBox1_Change()

End Sub

Private Sub UserForm_Initialize()
  ModuleExp.FileNameStr = ""
End Sub
Attribute VB_Name = "frmDataCsv"
Attribute VB_Base = "0{58A459F2-5512-4139-8CE8-2ECBD11E8ADB}{E4E61866-6831-4CF8-9171-C2084BA6A5FC}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


'-----------------------------------------------------------------------------------------------
'--------------------|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| iFix--------------------------------------------
'------------------------------------------------------------------------------------------------
Private Sub CmdAICsv_Click()
 
  On Error GoTo ErrorHandler
 
  Dim pth As String, nm As String
  Dim ExpCSV As Boolean
  Dim WorkItem As Object, WorkItemM As Object, WorkItemT As Object
  Dim i As Long
  Dim CSVfn As String, fh As Integer
  Dim TAG As CSVTagInfo, csvAI As String, csvDI As String, csvMDI As String, csvETR As String, csvDR As String, csvAR As String
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemT = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  ExpCSV = True
  pth = WorkItemM.Cells(10, 11).Text
  
  If Not FileUtils_IsFolderPresent(pth) Then
    Call MakeDir(pth)
  End If
  
  CSVfn = pth & "\" & WorkItemM.Cells(11, 13).Text & "_AI.csv"

  If ExpCSV Then
    fh = FreeFile
    Open CSVfn For Output As fh
    CSV_MainHdr ExpCSV, fh
    CSV_Empty ExpCSV, fh
  End If
  
  csvAI = ""
  csvDI = ""
  csvMDI = ""
  csvETR = ""
  csvDR = ""
  csvAR = ""
  
  ProgressBar.Min = 0
  ProgressBar.Max = 1000
  ProgressBar.Value = 0
 '-------------------------------------------------------------------------------------------------------------------------
  
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.ScanTime = "1"
  TAG.Signal_Conditioning = "LIN"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.Enable_Output = "YES"
  TAG.EGUDESC = ""
  
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  
  For i = 1 To 1000
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 2).Text <> "" Then
      
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(68, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1)
      TAG.TAG = "AN_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = "T_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvAI = CSV_AI(ExpCSV, fh, csvAI, TAG)
      
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(70, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":10"
      TAG.TAG = "AN_SIM_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = ""
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvDI = CSV_DI(ExpCSV, fh, csvDI, TAG)
     
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(70, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":0"
      TAG.IOAddress2 = Addr4x(CLng(WorkItemM.Cells(70, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":1"
      TAG.IOAddress3 = Addr4x(CLng(WorkItemM.Cells(70, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":2"
      TAG.TAG = "AN_ANIM_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = ""
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvMDI = CSV_MDI(ExpCSV, fh, csvMDI, TAG)
     
      TAG.TAG = "T_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = ""
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvETR = CSV_ETR(ExpCSV, fh, csvETR, TAG)
      
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.Enable_Output = "YES"
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(70, 7).Text) + i - 1)
      TAG.IOAddress2 = "0"
      TAG.TAG = "AN_A_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & WorkItem.Cells(6 + i - 1, 2).Text
      csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
    End If
  
    ProgressBar.Value = ProgressBar.Value + 1
  Next i

  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| CSV-|fffd||fffd||fffd||fffd|
  If ExpCSV Then
    If csvAI <> "" Then
      CSV_AIHdr ExpCSV, fh
      Print #fh, csvAI
    End If
    
    If csvDI <> "" Then
      CSV_DIHdr ExpCSV, fh
      Print #fh, csvDI
    End If
    
    If csvAR <> "" Then
      CSV_ARHdr ExpCSV, fh
      Print #fh, csvAR
    End If
    
    If csvDR <> "" Then
      CSV_DRHdr ExpCSV, fh
      Print #fh, csvDR
    End If
    
    If csvMDI <> "" Then
      CSV_MDIHdr ExpCSV, fh
      Print #fh, csvMDI
    End If
    
    If csvETR <> "" Then
      CSV_ETRHdr ExpCSV, fh
      Print #fh, csvETR
    End If
    
    Close fh
  End If
  
  If ProgressBar.Value > 0 And ProgressBar.Value < 1000 Then
     ProgressBar.Value = 1000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
   
  Set WorkItem = Nothing
  Set WorkItemM = Nothing
  Set WorkItemT = Nothing
  
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub
'-----------------------------------------------------------------------------------------------
'--------------------|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| iFix--------------------------------------------
'------------------------------------------------------------------------------------------------
Private Sub CmdDiagnCsv_Click()
  
  'On Error GoTo ErrorHandler

  Dim pth As String
  Dim ExpCSV As Boolean
  Dim WorkItem As Object, WorkItemM As Object, WorkItemT As Object
  Dim i As Long
  Dim CSVfn As String, fh As Integer
  Dim PrevUSOName As String, USOName As String, ts As String, tb As Boolean, nm As String
  Dim D_YCO As String, YCO As Long, prevYCO As Long, Rack As Long, OP_Base As Long, PLCShortName As String
  Dim TAG As CSVTagInfo, csvAI As String, csvDI As String, csvMDI As String, csvETR As String, csvDR As String, csvAR As String
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemT = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  ExpCSV = True
  pth = WorkItemM.Cells(10, 11).Text
  
  If Not FileUtils_IsFolderPresent(pth) Then
    Call MakeDir(pth)
  End If
  
  CSVfn = pth & "\" & WorkItemM.Cells(11, 13).Text & "_DIAGN.csv"

  If ExpCSV Then
    fh = FreeFile
    Open CSVfn For Output As fh
    CSV_MainHdr ExpCSV, fh
    CSV_Empty ExpCSV, fh
  End If
  
  csvAI = ""
  csvDI = ""
  csvMDI = ""
  csvETR = ""
  csvDR = ""
  csvAR = ""
  
  ProgressBar.Min = 0
  ProgressBar.Max = 1000
  ProgressBar.Value = 0

 '--------------------------------------------------------------------------------------------------
  
    ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| D_Tags, D_Modul, D_YCO  + csv + |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| !!!
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!!!
  'BegRowCnt = 6
  YCO = -1
  D_YCO = 1
  'prevYCO = -100
  USOName = ""
  PrevUSOName = ""
  
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.ScanTime = "1"
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.EGUDESC = ""
  TAG.NextTAG = ""
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
 '--------------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| PLC
  TAG.Enable_Output = "NO"
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| PLC"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(56, 1).Text))
  TAG.IOAddress2 = "0"
  TAG.TAG = "D_PLC_STATE"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
 
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| RIO. |fffd||fffd||fffd||fffd||fffd| |fffd|. |fffd||fffd||fffd| 16 |fffd||fffd||fffd||fffd||fffd||fffd|!!!
  TAG.Enable_Output = "NO"
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| RIO. |fffd||fffd||fffd||fffd||fffd| |fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(56, 1).Text) + 5)
  TAG.IOAddress2 = "0"
  TAG.TAG = "D_RIO_A"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
 
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| RIO. |fffd||fffd||fffd||fffd||fffd| B. |fffd||fffd||fffd| 16 |fffd||fffd||fffd||fffd||fffd||fffd|!!!
  TAG.Enable_Output = "NO"
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| RIO. |fffd||fffd||fffd||fffd||fffd| B"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(56, 1).Text) + 7)
  TAG.IOAddress2 = "0"
  TAG.TAG = "D_RIO_B"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
 '--------------------------------------------------------------------------------------------------
 
  For i = 1 To 32               ' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 32 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| !!!! |fffd||fffd||fffd| 16????
    
    If WorkItem.Cells(4 + 6 * (i - 1), 2).Font.ColorIndex <> 15 Then
      
      ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| => |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| => |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
      If WorkItem.Cells(4 + 6 * (i - 1), 2).Text <> PrevUSOName Then
        Do
          ts = GetNextCSV(D_YCO)
        Loop While Not IsNumeric(ts) And D_YCO <> ""
  
        If IsNumeric(ts) Then
          YCO = CLng(ts)
        End If
      
        If YCO < 0 Then         ' |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          YCO = 1               ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| 1
        End If
      
        If prevYCO = YCO Then
          YCO = YCO + 1         ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
        End If
        
        prevYCO = YCO
        Rack = 1                ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| 1
        PrevUSOName = WorkItem.Cells(4 + 6 * (i - 1), 2).Text
      End If
DoAgain:
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      ' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HotStandBy |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
      TAG.Enable_Output = "NO"
      TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(56, 1).Text) + 10 + i - 1)
      TAG.IOAddress2 = "0"
      TAG.TAG = "D_DROP" & CLng(YCO) & CLng(Rack)
      csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)

      For j = 1 To 16       ' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        If WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Font.ColorIndex <> 15 And _
           WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Font.ColorIndex <> 2 And _
           WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Interior.ColorIndex <> 1 Then
 
         Select Case WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text
         
          Case "140 AVI 030 00"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.TAG = "DA_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text) + 8)
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
          
          Case "140 ARI 030 10"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.TAG = "DA_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text) + 8)
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
          
          Case "140 ACI 030 00"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.TAG = "DA_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text) + 8)
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
          
          Case "140 ACI 040 00"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.TAG = "DA_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text) + 16)
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)

          Case "140 AII 330 00"
            
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.TAG = "DA_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text) + 8)
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
          
          Case "140 ACO 020 00"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!!!!!
            TAG.Enable_Output = "YES"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr4x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.TAG = "DA_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
          
          Case "140 DDI 353 00"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
          
          Case "140 DII 330 00"
            
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
            
          Case "140 DAI 740 00"
            
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "NO"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr3x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
            
          Case "140 DDO 353 00"
          
            ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| csv - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
            TAG.Enable_Output = "YES"
            TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
            TAG.IOAddress = Addr4x(CLng(WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text))
            TAG.IOAddress2 = "0"
            TAG.TAG = "D_" & CLng(YCO) & "_" & CLng(Rack) & "_" & CLng(j)
            csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
          
          Case "140 CPS x14 x0"
          Case "140 CPS 114 10"
          Case "140 CPS 114 20"
          Case "140 CPS 124 10"
          Case "140 CPS 214 00"
          Case "140 CPU 113 02"
          Case "140 CPU 113 03"
          Case "140 CPU 311 10"
          Case "140 CPU 434 12"
          Case "140 CPU 534 14"
          Case "140 CPU 651 50"
          Case "140 CPU 651 60"
          Case "140 CPU 652 60"
          Case "140 CPU 671 60"

          
          Case "140 CHS 210 00"
            isCHS = True
      
          Case "140 NOM 2xx 00"
          Case "140 CRP 932 00"
          Case "140 CRA 932 00"
          Case "140 CRA 21x x0"
          Case "140 NOE 771 00"
          Case "140 XCP 510 00"
          
          Case Else
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|: " & WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text, vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!"
          End Select
        
        
        End If
      Next j
      
      If isCHS And Not isMirrorRack Then    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| CHS => |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| D_Modul
        Rack = Rack + 1                     ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd|
        isMirrorRack = True                 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HotStandby
        GoTo DoAgain                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HotStandby
      End If
    End If
      
    Rack = Rack + 1                         ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd|
  
    ProgressBar.Value = ProgressBar.Value + 1
  Next i

  ' -------------------------------------------------------------------------------------------
  
  

  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| CSV-|fffd||fffd||fffd||fffd|
  If ExpCSV Then
    If csvAI <> "" Then
      CSV_AIHdr ExpCSV, fh
      Print #fh, csvAI
    End If
    
    If csvDI <> "" Then
      CSV_DIHdr ExpCSV, fh
      Print #fh, csvDI
    End If
    
    If csvAR <> "" Then
      CSV_ARHdr ExpCSV, fh
      Print #fh, csvAR
    End If
    
    If csvDR <> "" Then
      CSV_DRHdr ExpCSV, fh
      Print #fh, csvDR
    End If
    
    If csvMDI <> "" Then
      CSV_MDIHdr ExpCSV, fh
      Print #fh, csvMDI
    End If
    
    If csvETR <> "" Then
      CSV_ETRHdr ExpCSV, fh
      Print #fh, csvETR
    End If
    
    Close fh
  End If
  
  If ProgressBar.Value > 0 And ProgressBar.Value < 1000 Then
     ProgressBar.Value = 1000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
   
  Set WorkItem = Nothing
  Set WorkItemM = Nothing
  Set WorkItemT = Nothing
  
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub



'-----------------------------------------------------------------------------------------------
'--------------------|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| iFix--------------------------------------------
'------------------------------------------------------------------------------------------------
Private Sub CmdVSCsv_Click()

  On Error GoTo ErrorHandler
  
  Dim pth As String, nm As String
  Dim ExpCSV As Boolean
  Dim WorkItem As Object, WorkItemM As Object, WorkItemT As Object
  Dim i As Long
  Dim CSVfn As String, fh As Integer
  Dim TAG As CSVTagInfo, csvAI As String, csvDI As String, csvMDI As String, csvETR As String, csvDR As String, csvAR As String
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemT = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  ExpCSV = True
  
  pth = WorkItemM.Cells(10, 11).Text
  
  If Not FileUtils_IsFolderPresent(pth) Then
    Call MakeDir(pth)
  End If
  
  CSVfn = pth & "\" & WorkItemM.Cells(11, 13).Text & "_VS.csv"

  If ExpCSV Then
    fh = FreeFile
    Open CSVfn For Output As fh
    CSV_MainHdr ExpCSV, fh
    CSV_Empty ExpCSV, fh
  End If
  
  csvAI = ""
  csvDI = ""
  csvMDI = ""
  csvETR = ""
  csvDR = ""
  csvAR = ""
  
  ProgressBar.Min = 0
  ProgressBar.Max = 1000
  ProgressBar.Value = 0

 '-------------------------------------------------------------------------------------------------------------------------
  
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.Enable_Output = "YES"
  TAG.NextTAG = ""
  
  For i = 1 To 128
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      
      nm = WorkItem.Cells(6 + i - 1, 1).Text
          
      TAG.ScanTime = "1"
      
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1)
      TAG.IOAddress2 = "0"
      TAG.TAG = "VS_STATE" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
         
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1) & ":7"
      TAG.IOAddress2 = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1) & ":8"
      TAG.IOAddress3 = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1) & ":9"
      TAG.TAG = "VS_ANIM" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      csvMDI = CSV_MDI(ExpCSV, fh, csvMDI, TAG)
      
      ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1) & ":3"
      TAG.IOAddress2 = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1) & ":4"
      TAG.IOAddress3 = Addr4x(CLng(WorkItemM.Cells(20, 7).Text) + i - 1) & ":5"
      TAG.TAG = "VS_MODE" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd|"
      csvMDI = CSV_MDI(ExpCSV, fh, csvMDI, TAG)
      
    End If
        
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  
    
  ' -------------------------------------------------------------------------------------------
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.Enable_Output = "YES"
  TAG.NextTAG = ""
  
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  For i = 1 To 256
    If WorkItem.Cells(7 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(7 + i - 1, 3).Text <> "" Then
    
      TAG.ScanTime = "4"
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(31, 7).Text) + i - 1)
      TAG.TAG = WorkItem.Cells(7 + i - 1, 2).Text
      TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      csvAI = CSV_AI(ExpCSV, fh, csvAI, TAG)
    End If
    ProgressBar.Value = ProgressBar.Value + 1
   Next i


'--------------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| CSV-|fffd||fffd||fffd||fffd|
  If ExpCSV Then
    If csvAI <> "" Then
      CSV_AIHdr ExpCSV, fh
      Print #fh, csvAI
    End If
    
    If csvDI <> "" Then
      CSV_DIHdr ExpCSV, fh
      Print #fh, csvDI
    End If
    
    If csvAR <> "" Then
      CSV_ARHdr ExpCSV, fh
      Print #fh, csvAR
    End If
    
    If csvDR <> "" Then
      CSV_DRHdr ExpCSV, fh
      Print #fh, csvDR
    End If
    
    If csvMDI <> "" Then
      CSV_MDIHdr ExpCSV, fh
      Print #fh, csvMDI
    End If
    
    If csvETR <> "" Then
      CSV_ETRHdr ExpCSV, fh
      Print #fh, csvETR
    End If
    
    Close fh
  End If
  
   If ProgressBar.Value > 0 And ProgressBar.Value < 1000 Then
     ProgressBar.Value = 1000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
   
  Set WorkItem = Nothing
  Set WorkItemM = Nothing
  Set WorkItemT = Nothing
  
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub

'-----------------------------------------------------------------------------------------------
'--------------------|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| iFix--------------------------------------------
'------------------------------------------------------------------------------------------------
Private Sub CmdZDCsv_Click()

  On Error GoTo ErrorHandler
  
  Dim pth As String, nm As String
  Dim ExpCSV As Boolean
  Dim WorkItem As Object, WorkItemM As Object, WorkItemT As Object
  Dim i As Long
  Dim CSVfn As String, fh As Integer
  Dim TAG As CSVTagInfo, csvAI As String, csvDI As String, csvMDI As String, csvETR As String, csvDR As String, csvAR As String
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemT = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  ExpCSV = True
  pth = WorkItemM.Cells(10, 11).Text
  
  If Not FileUtils_IsFolderPresent(pth) Then
    Call MakeDir(pth)
  End If
  
  
  CSVfn = pth & "\" & WorkItemM.Cells(11, 13).Text & "_ZD.csv"

  If ExpCSV Then
    fh = FreeFile
    Open CSVfn For Output As fh
    CSV_MainHdr ExpCSV, fh
    CSV_Empty ExpCSV, fh
  End If
  
  csvAI = ""
  csvDI = ""
  csvMDI = ""
  csvETR = ""
  csvDR = ""
  csvAR = ""
  
 
  ProgressBar.Min = 0
  ProgressBar.Max = 1000
  ProgressBar.Value = 0
 '-------------------------------------------------------------------------------------------------------------------------
  
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.Enable_Output = "YES"
  TAG.NextTAG = ""
  
  TAG.ScanTime = "4"
    
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(54, 7).Text))
  TAG.TAG = "ZD_PROC"
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(56, 7).Text))
  TAG.TAG = "ZD_REAL"
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)

  For i = 1 To 200
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      
      nm = WorkItem.Cells(6 + i - 1, 1).Text
    
      TAG.ScanTime = "4"
      
      ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| 52
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(50, 7).Text) + i - 1)
      TAG.TAG = "ZD_TM" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
      csvAI = CSV_AI(ExpCSV, fh, csvAI, TAG)
      
      ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(52, 7).Text) + i - 1)
      TAG.TAG = "ZD_CK" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      csvAI = CSV_AI(ExpCSV, fh, csvAI, TAG)
            
      TAG.ScanTime = "1"
      
      '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(46, 7).Text) + i - 1)
      TAG.IOAddress2 = "0"
      TAG.TAG = "ZD_STATE" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
      
      
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(46, 7).Text) + i - 1) & ":0"
      TAG.IOAddress2 = Addr4x(CLng(WorkItemM.Cells(46, 7).Text) + i - 1) & ":1"
      TAG.IOAddress3 = Addr4x(CLng(WorkItemM.Cells(46, 7).Text) + i - 1) & ":2"
      TAG.TAG = "ZD_ANIM" & i
      TAG.DESC = SetEndDot(nm) & " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      csvMDI = CSV_MDI(ExpCSV, fh, csvMDI, TAG)
      
    End If
    
        
    ProgressBar.Value = ProgressBar.Value + 1
  Next i


  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| CSV-|fffd||fffd||fffd||fffd|
  If ExpCSV Then
    If csvAI <> "" Then
      CSV_AIHdr ExpCSV, fh
      Print #fh, csvAI
    End If
    
    If csvDI <> "" Then
      CSV_DIHdr ExpCSV, fh
      Print #fh, csvDI
    End If
    
    If csvAR <> "" Then
      CSV_ARHdr ExpCSV, fh
      Print #fh, csvAR
    End If
    
    If csvDR <> "" Then
      CSV_DRHdr ExpCSV, fh
      Print #fh, csvDR
    End If
    
    If csvMDI <> "" Then
      CSV_MDIHdr ExpCSV, fh
      Print #fh, csvMDI
    End If
    
    If csvETR <> "" Then
      CSV_ETRHdr ExpCSV, fh
      Print #fh, csvETR
    End If
    
    Close fh
  End If
  
   If ProgressBar.Value > 0 And ProgressBar.Value < 1000 Then
     ProgressBar.Value = 1000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
   
  Set WorkItem = Nothing
  Set WorkItemM = Nothing
  Set WorkItemT = Nothing
  
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If

End Sub

Private Sub Cmd_ZD_csv_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal y As Single)
    LblDsc.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| csv-|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| iFix |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
End Sub

'-----------------------------------------------------------------------------------------------
'--------------------|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| iFix--------------------------------------------
'------------------------------------------------------------------------------------------------
Private Sub CmdListCsv_Click()
  
  On Error GoTo ErrorHandler
  
  Dim pth As String, nm As String
  Dim ExpCSV As Boolean, bclr As Boolean
  Dim WorkItem As Object, WorkItemM As Object, WorkItemT As Object
  Dim i As Long, j As Long, cntAgr As Long
  Dim CSVfn As String, fh As Integer
  Dim TAG As CSVTagInfo, csvAI As String, csvDI As String, csvMDI As String, csvETR As String, csvDR As String, csvAR As String

  Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
 
  ExpCSV = True
  pth = WorkItemM.Cells(10, 11).Text
  
  If Not FileUtils_IsFolderPresent(pth) Then
    Call MakeDir(pth)
  End If
  
  CSVfn = pth & "\" & WorkItemM.Cells(11, 13).Text & "_LISTS.csv"

  If ExpCSV Then
    fh = FreeFile
    Open CSVfn For Output As fh
    CSV_MainHdr ExpCSV, fh
    CSV_Empty ExpCSV, fh
  End If
  
  csvAI = ""
  csvDI = ""
  csvMDI = ""
  csvETR = ""
  csvDR = ""
  csvAR = ""
  
  ProgressBar.Min = 0
  ProgressBar.Max = 1000
  ProgressBar.Value = 0
  
  ' --------------------------------------------------------------------------------------------
  ' --------------------------------------------------------------------------------------------
  ' --------------------------------------------------------------------------------------------
  ' List1
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.NextTAG = ""
  TAG.ScanTime = "1"
 
 cntAgr = CLng(WorkItemM.Cells(20, 14).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
 For i = 1 To cntAgr
 
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(4, 7).Text) + i - 1)
  TAG.TAG = "L1_" & CStr(i)
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(4, 7).Text) + 16 + i - 1)
  TAG.TAG = "L1_" & CStr(i) & "_M"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
      
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(4, 7).Text) + 16 + i - 1)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L1_" & CStr(i) & "_DR_M"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
 
  ProgressBar.Value = ProgressBar.Value + 1
 Next i
 
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' List2
  
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.NextTAG = ""
  TAG.ScanTime = "1"
  TAG.Enable_Output = "YES"
  
  j = CLng(WorkItemM.Cells(19, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (4)
  plcn = 0
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
 ' TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text))
  TAG.TAG = "L3_" & CStr(plcn)
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
   TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + j)
  TAG.TAG = "L3_" & CStr(plcn) & "_D"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
    
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  'TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 2 * j)
  TAG.TAG = "L3_" & CStr(plcn) & "_M"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 3 * j)
  TAG.TAG = "L3_" & CStr(plcn) & "_S"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
  
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 4 * j)
  TAG.TAG = "L3_" & CStr(plcn) & "_T"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 5 * j)
  TAG.TAG = "L3_" & CStr(plcn) & "_R"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 6 * j)
  TAG.TAG = "L3_" & CStr(plcn) & "_E"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
  
  TAG.Enable_Output = "YES"
'------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR_D"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 2 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR_M"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 3 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR_S"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 4 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR_T"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)

  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 5 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR_R"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(6, 7).Text) + 6 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(plcn) & "_DR_E"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ProgressBar.Value = ProgressBar.Value + 1
  
  ' --------------------------------------------------------------------------------------------
  ' --------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|
  ' --------------------------------------------------------------------------------------------
  ' List3
  
 cntAgr = CLng(WorkItemM.Cells(20, 14).Text)                                  ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(20, 13).Text)                                       ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (4)
  
 For i = 1 To cntAgr
 
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i)
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 64 + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i) & "_D"
    csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
    
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 128 + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i) & "_M"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 192 + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i) & "_S"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 256 + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i) & "_T"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 320 + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i) & "_R"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 384 + j * (i - 1))
  TAG.TAG = "L3_" & CStr(i) & "_E"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 64 + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR_D"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 128 + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR_M"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 192 + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR_S"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 256 + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR_T"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 320 + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR_R"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
 
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & CStr(i)
  TAG.DESC = ""
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(8, 7).Text) + 384 + j * (i - 1))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L3_" & CStr(i) & "_DR_E"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
 
  ProgressBar.Value = ProgressBar.Value + 1
 Next i
 
  ' --------------------------------------------------------------------------------------------
  ' --------------------------------------------------------------------------------------------
  ' --------------------------------------------------------------------------------------------
  ' List4
  
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.NextTAG = ""
  TAG.ScanTime = "1"
  
  j = CLng(WorkItemM.Cells(21, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text))
  TAG.TAG = "L4"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + j)
  TAG.TAG = "L4_M"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 2 * j)
  TAG.TAG = "L4_S"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 3 * j)
  TAG.TAG = "L4_T"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 4 * j)
  TAG.TAG = "L4_R"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 5 * j)
  TAG.TAG = "L4_E"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L4_" & "DR"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L4_" & "DR_M"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 2 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L4_" & "DR_S"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 3 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L4_" & "DR_T"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 4 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L4_" & "DR_R"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(10, 7).Text) + 5 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L4_" & "DR_E"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ProgressBar.Value = ProgressBar.Value + 1
  
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' List5
  
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.NextTAG = ""
  TAG.ScanTime = "1"
  
  j = CLng(WorkItemM.Cells(22, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text))
  TAG.TAG = "L5"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + j)
  TAG.TAG = "L5_M"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + 2 * j)
  TAG.TAG = "L5_S"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + 3 * j)
  TAG.TAG = "L5_R"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + 4 * j)
  TAG.TAG = "L5_E"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L5_" & "DR"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L5_" & "DR_M"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + 2 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L5_" & "DR_S"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + 3 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L5_" & "DR_R"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(12, 7).Text) + 4 * j)
  TAG.IOAddress2 = "0"
  TAG.TAG = "L5_" & "DR_E"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ProgressBar.Value = ProgressBar.Value + 1
  
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
  
  j = CLng(WorkItemM.Cells(23, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.NextTAG = ""
  TAG.ScanTime = "1"
  
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(14, 7).Text))
  TAG.TAG = "L6"
  csvAR = CSV_AR(ExpCSV, fh, csvAR, TAG)
      
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(14, 7).Text))
  TAG.IOAddress2 = "0"
  TAG.TAG = "L6_" & "DR"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
    
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| DO
  
  j = CLng(WorkItemM.Cells(17, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  TAG.Signal_Conditioning = "NONE"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.NextTAG = ""
  TAG.ScanTime = "1"
    
  TAG.Enable_Output = "YES"
  
  ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd|
  TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd|"
  TAG.IOAddress = WorkItem.Cells(6, 4).Text
  TAG.IOAddress2 = "0"
  TAG.TAG = "BEEPER_STATE"
  csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
  
  ProgressBar.Value = ProgressBar.Value + 1
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| CSV-|fffd||fffd||fffd||fffd|
  If ExpCSV Then
    If csvAI <> "" Then
      CSV_AIHdr ExpCSV, fh
      Print #fh, csvAI
    End If
    
    If csvDI <> "" Then
      CSV_DIHdr ExpCSV, fh
      Print #fh, csvDI
    End If
    
    If csvAR <> "" Then
      CSV_ARHdr ExpCSV, fh
      Print #fh, csvAR
    End If
    
    If csvDR <> "" Then
      CSV_DRHdr ExpCSV, fh
      Print #fh, csvDR
    End If
    
    If csvMDI <> "" Then
      CSV_MDIHdr ExpCSV, fh
      Print #fh, csvMDI
    End If
    
    If csvETR <> "" Then
      CSV_ETRHdr ExpCSV, fh
      Print #fh, csvETR
    End If
    
    Close fh
  End If
  
  If ProgressBar.Value > 0 And ProgressBar.Value < 1000 Then
     ProgressBar.Value = 1000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
   
  Set WorkItemM = Nothing
   
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If

End Sub

Private Sub CmdTrendCsv_Click()
 On Error GoTo ErrorHandler
 
  Dim pth As String, nm As String
  Dim ExpCSV As Boolean
  Dim WorkItem As Object, WorkItemM As Object, WorkItemT As Object
  Dim i As Long
  Dim CSVfn As String, fh As Integer
  Dim TAG As CSVTagInfo, csvAI As String, csvDI As String, csvMDI As String, csvETR As String, csvDR As String, csvAR As String
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemT = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  ExpCSV = True
  pth = WorkItemM.Cells(10, 11).Text
  
  If Not FileUtils_IsFolderPresent(pth) Then
    Call MakeDir(pth)
  End If
  
  CSVfn = pth & "\" & WorkItemM.Cells(11, 13).Text & "_TRENDS.csv"

  If ExpCSV Then
    fh = FreeFile
    Open CSVfn For Output As fh
    CSV_MainHdr ExpCSV, fh
    CSV_Empty ExpCSV, fh
  End If
  
  csvAI = ""
  csvDI = ""
  csvMDI = ""
  csvETR = ""
  csvDR = ""
  csvAR = ""
  
  ProgressBar.Min = 0
  ProgressBar.Max = 1000
  ProgressBar.Value = 0
 '-------------------------------------------------------------------------------------------------------------------------
  
  TAG.IODRV = WorkItemM.Cells(12, 13).Text
  TAG.IODRVName = WorkItemM.Cells(13, 13).Text
  TAG.ScanTime = "1"
  TAG.Signal_Conditioning = "LIN"
  TAG.Low_EGU = "0"
  TAG.High_EGU = "65535"
  TAG.Enable_Output = "YES"
  TAG.EGUDESC = ""
  
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  
  For i = 1 To 500
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" Then
      
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(83, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1)
      TAG.TAG = "AN_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = "T_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvAI = CSV_AI(ExpCSV, fh, csvAI, TAG)
      
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(87, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":10"
      TAG.TAG = "AN_SIM_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = ""
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvDI = CSV_DI(ExpCSV, fh, csvDI, TAG)
     
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(87, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":0"
      TAG.IOAddress2 = Addr4x(CLng(WorkItemM.Cells(87, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":1"
      TAG.IOAddress3 = Addr4x(CLng(WorkItemM.Cells(87, 7).Text) + CLng(WorkItem.Cells(6 + i - 1, 1).Text) - 1) & ":2"
      TAG.TAG = "AN_ANIM_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = ""
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvMDI = CSV_MDI(ExpCSV, fh, csvMDI, TAG)
     
      TAG.TAG = "T_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.NextTAG = ""
      TAG.DESC = WorkItem.Cells(6 + i - 1, 3).Text
      csvETR = CSV_ETR(ExpCSV, fh, csvETR, TAG)
      
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      TAG.Enable_Output = "YES"
      TAG.IOAddress = Addr4x(CLng(WorkItemM.Cells(87, 7).Text) + i - 1)
      TAG.IOAddress2 = "0"
      TAG.TAG = "AN_A_" & WorkItem.Cells(6 + i - 1, 2).Text
      TAG.DESC = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & WorkItem.Cells(6 + i - 1, 2).Text
      csvDR = CSV_DR(ExpCSV, fh, csvDR, TAG)
    End If
  
    ProgressBar.Value = ProgressBar.Value + 1
  Next i

  ' -------------------------------------------------------------------------------------------
  ' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| CSV-|fffd||fffd||fffd||fffd|
  If ExpCSV Then
    If csvAI <> "" Then
      CSV_AIHdr ExpCSV, fh
      Print #fh, csvAI
    End If
    
    If csvDI <> "" Then
      CSV_DIHdr ExpCSV, fh
      Print #fh, csvDI
    End If
    
    If csvAR <> "" Then
      CSV_ARHdr ExpCSV, fh
      Print #fh, csvAR
    End If
    
    If csvDR <> "" Then
      CSV_DRHdr ExpCSV, fh
      Print #fh, csvDR
    End If
    
    If csvMDI <> "" Then
      CSV_MDIHdr ExpCSV, fh
      Print #fh, csvMDI
    End If
    
    If csvETR <> "" Then
      CSV_ETRHdr ExpCSV, fh
      Print #fh, csvETR
    End If
    
    Close fh
  End If
  
  If ProgressBar.Value > 0 And ProgressBar.Value < 1000 Then
     ProgressBar.Value = 1000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
   
  Set WorkItem = Nothing
  Set WorkItemM = Nothing
  Set WorkItemT = Nothing
  
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub


Private Sub UserForm_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal y As Single)
LblDsc.Caption = ""
End Sub
Attribute VB_Name = "frmDataObjects"
Attribute VB_Base = "0{4898034A-4B30-458C-AE99-CBD06E58925B}{7B388A3D-88FF-4E6D-9F96-CF4954207536}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub ChBox15_Click()

End Sub

Private Sub CmdBtnOk_Click()
  
 On Error GoTo ErrorHandler
 
 Dim nm As String, ts As String
 Dim i As Long, j As Long, y As Long, cntAgr As Long, vl As Long
 Dim cn As ADODB.Connection
 Dim rs As ADODB.Recordset, rsd As ADODB.Recordset
 Dim WorkItem As Object, WorkItemM As Object

 Set cn = New ADODB.Connection
 Set rs = New ADODB.Recordset
 cn.Open "Provider= Microsoft.Jet.OLEDB.4.0;Data Source= C:\Base\object.mdb" '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
 Set WorkItemM = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
 
 ProgressBar.Value = 0
 ProgressBar.Min = 0
 ProgressBar.Max = 5000
 
 '----------- |fffd||fffd||fffd||fffd|."LIST1"---------------------------------------------------------------------------
 If ChBox1.Value Then
 
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
 Set WorkItemSelf = Application.ActiveWorkbook.Sheets.Item("LIST1")
 cn.Execute ("DELETE * FROM LIST1") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 cntAgr = CLng(WorkItemM.Cells(20, 14).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  For j = 1 To cntAgr
  For i = 1 To 16
      nm = WorkItemSelf.Cells(7 + (j - 1) + (i - 1) + 16 * (j - 1), 3).Text
      bclr = WorkItemSelf.Cells(7 + (j - 1) + (i - 1) + 16 * (j - 1), 3).Font.ColorIndex <> 15
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List1
      UpdateList True, cn, rs, 1, i + (j - 1) * 16, Int((i - 1) / 16) + 1, (i - 1) Mod 16, nm, WorkItemSelf.Cells(7 + (j - 1) + (i - 1) + 16 * (j - 1), 2).Text, IIf(nm = "" Or bclr = False, 0, 1)
      ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Next j
 Set WorkItem = Nothing
 Set WorkItemSelf = Nothing
End If
  
'----------- |fffd||fffd||fffd||fffd|."OP_GPList"-----------------------------------------------------------------------
If ChBox2.Value Then

 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
 Set WorkItemSelf = Application.ActiveWorkbook.Sheets.Item("LIST1")
 
  For i = 1 To 16
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_GPList", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  
  For i = 1 To 16
    If WorkItemSelf.Cells(7 + i - 1, 3).Font.ColorIndex <> 15 And WorkItemSelf.Cells(7 + i - 1, 3).Text <> "" Then
      nm = WorkItemSelf.Cells(7 + i - 1, 3).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_GPList1", "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd|. " & SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
  Set WorkItemSelf = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|.----"LIST2"------------------------------------------------------------------
If ChBox3.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST2")
 cn.Execute ("DELETE * FROM LIST2") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 For i = 1 To 64
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      bclr = WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List2
      UpdateList True, cn, rs, 2, i, Int((i - 1) / 16) + 1, (i - 1) Mod 16, nm, WorkItem.Cells(6 + i - 1, 2).Text, IIf(nm = "" Or bclr = False, 0, 1)
      ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|.-----"OP_OProtect"----------------------------------------------------------------
If ChBox4.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST2")
 cn.Execute ("DELETE * FROM OP_OProtect") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 For i = 1 To 64
    If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 Then
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_OProtect", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
 Next i
 Set WorkItem = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|."LIST3"---------------------------------------------------------------------------
If ChBox5.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
 Set WorkItemSelf = Application.ActiveWorkbook.Sheets.Item("LIST3")
 cn.Execute ("DELETE * FROM LIST3") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 cntAgr = CLng(WorkItemM.Cells(20, 14).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For j = 1 To cntAgr
  For i = 1 To 64
      nm = WorkItemSelf.Cells(7 + (j - 1) + (i - 1) + 64 * (j - 1), 3).Text
      bclr = WorkItemSelf.Cells(7 + (j - 1) + (i - 1) + 64 * (j - 1), 3).Font.ColorIndex <> 15
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List3
      UpdateList True, cn, rs, 3, i + (j - 1) * 64, Int((i - 1) / 16) + 1, (i - 1) Mod 16, nm, WorkItemSelf.Cells(7 + (j - 1) + (i - 1) + 64 * (j - 1), 2).Text, IIf(nm = "" Or bclr = False, 0, 1)
      ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Next j
  Set WorkItem = Nothing
  Set WorkItemSelf = Nothing
End If
  
 '----------- |fffd||fffd||fffd||fffd|."OP_AProtect"--------------------------------------------------------------------
If ChBox6.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
 Set WorkItemSelf = Application.ActiveWorkbook.Sheets.Item("LIST3")
 cn.Execute ("DELETE * FROM OP_AProtect") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
 For i = 1 To 16
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_AProtect", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  
  For i = 1 To 64
    If WorkItemSelf.Cells(7 + i - 1, 3).Font.ColorIndex <> 15 Then 'And WorkItemSelf.Cells(7 + i - 1, 3).Text <> "" Then
      nm = WorkItemSelf.Cells(7 + i - 1, 3).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_AProtect1", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
  Set WorkItemSelf = Nothing
End If
'------------------------------------------------------------------------------------------------------------
'----------- |fffd||fffd||fffd||fffd|."LIST4"--------------------------------------------------------------------
If ChBox7.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST4")
 cn.Execute ("DELETE * FROM LIST4") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(21, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
    For i = 1 To j * 16
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      bclr = WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List4
      UpdateList True, cn, rs, 4, i, Int((i - 1) / 16) + 1, (i - 1) Mod 16, nm, WorkItem.Cells(6 + i - 1, 2).Text, IIf(nm = "" Or bclr = False, 0, 1)
      ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
 '----------- |fffd||fffd||fffd||fffd|."OP_OLim"---------------------------------------------------------------------------
If ChBox8.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST4")
 cn.Execute ("DELETE * FROM OP_OLim") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(21, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  For i = 1 To j * 16
    If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 Then
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_OLim", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
 
'------------------------------------------------------------------------------------------------------------
'----------- |fffd||fffd||fffd||fffd|."LIST5"--------------------------------------------------------------------
If ChBox9.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST5")
 cn.Execute ("DELETE * FROM LIST5") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(22, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
   For i = 1 To j * 16
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      bclr = WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List5
      UpdateList True, cn, rs, 5, i, Int((i - 1) / 16) + 1, (i - 1) Mod 16, nm, WorkItem.Cells(6 + i - 1, 2).Text, IIf(nm = "" Or bclr = False, 0, 1)
      ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|."OP_ALim"---------------------------------------------------------------------------
If ChBox10.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("LIST5")
 cn.Execute ("DELETE * FROM OP_ALim") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(22, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
  For i = 1 To j * 16
    If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 Then
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_ALim", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
   
 '----------- |fffd||fffd||fffd||fffd|."LIST6"---------------------------------------------------------------------------
If ChBox11.Value Then
 
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|")
 cn.Execute ("DELETE * FROM LIST6") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(23, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 ProgressBar.Max = ProgressBar.Max + j * 16
 
 For i = 1 To j * 16
   nm = WorkItem.Cells(6 + i - 1, 1).Text
   bclr = WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15
   ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List6
   UpdateList True, cn, rs, 6, i, Int((i - 1) / 16) + 1, (i - 1) Mod 16, nm, "", IIf(nm = "" Or bclr = False, 0, 1)
   ProgressBar.Value = ProgressBar.Value + 1
  Next i
 
 Set WorkItem = Nothing
End If
  
'----------- |fffd||fffd||fffd||fffd|."OP_HandMap"---------------------------------------------------------------------------
If ChBox12.Value Then

 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|")
 cn.Execute ("DELETE * FROM OP_HandMap") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(23, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  For i = 1 To j * 16
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_HandMap", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  
  Set WorkItem = Nothing
End If

'----------- |fffd||fffd||fffd||fffd|."LIST_DO"--------------------------------------------------------------------
If ChBox13.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
 cn.Execute ("DELETE * FROM LIST_DO") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(17, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  For i = 1 To j
    nm = WorkItem.Cells(6 + i - 1, 1).Text
    bclr = WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| List_DO
    UpdateList True, cn, rs, 7, i, i, i * 16 - 1, nm, WorkItem.Cells(6 + i - 1, 3).Text, IIf(nm = "" Or bclr = False, 0, 1)
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
 '----------- |fffd||fffd||fffd||fffd|."OP_Alarms"---------------------------------------------------------------------------
 If ChBox14.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("DO |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
 cn.Execute ("DELETE * FROM OP_Alarms") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 j = CLng(WorkItemM.Cells(17, 13).Text) ' |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  For i = 1 To j
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_Alarms", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
  
 '----------- |fffd||fffd||fffd||fffd|."Ustavki"-|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|--------------------------------------------------------------------------
 If ChBox15.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
  For i = 1 To 1000
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" Then
      
      UpdateUstavkiAI True, cn, rs, WorkItem.Cells(6 + i - 1, 2).Text, UCase$(WorkItem.Cells(6 + i - 1, 3).Text), _
                      WorkItem.Cells(6 + i - 1, 1).Text, WorkItem.Cells(6 + i - 1, 8).Text
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|."OP_Analog"---------------------------------------------------------------------------
If ChBox16.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM OP_Analog") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
  For i = 1 To 1000
    If WorkItem.Cells(6 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 3).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 3).Text
      UpdateMsg cn, rs, "OP_Analog", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

'----------- |fffd||fffd||fffd||fffd|."MA"---------------------------------------------------------------------------
 If ChBox17.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM MA")               ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
  
  For i = 1 To 16
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      UpdateListFe cn, rs, "MA", UCase$(nm), i
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

'----------- |fffd||fffd||fffd||fffd|."OP_Aggregates"---------------------------------------------------------------------------
 If ChBox18.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM OP_Aggregates")    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 16
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_Aggregates", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|.--"ZD"------------------------------------------------------------------------
  If ChBox19.Value Then
    Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
    cn.Execute ("DELETE * FROM ZD")         ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 200
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      UpdateListFe cn, rs, "ZD", UCase$(nm), i - 1 + 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
  
 '----------- |fffd||fffd||fffd||fffd|.---"OP_Valves"-----------------------------------------------------------------------
  If ChBox20.Value Then
    Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
    cn.Execute ("DELETE * FROM OP_Valves")  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 200
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_Valves", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

'----------- |fffd||fffd||fffd||fffd|.---"Ustavki-|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"------------------------------------------------------------------------------
If ChBox21.Value Then
 Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
 Set WorkItemSelf = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  
'-----------------------------------ZD_TM---------------------------------------------------------------------------
  For i = 1 To 200
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
     
      On Error Resume Next
      Err.Clear
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      vl = CLng(WorkItemSelf.Cells(7 + i - 1, 6).Text)
      
      If Err.Number <> 0 Then
        vl = 600
        MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & "ZD_TM" & i & " = " & vl & " |fffd||fffd||fffd|.", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        Err.Clear
      End If
      On Error GoTo 0
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ustavki
      UpdateUstavkiZD True, cn, rs, "ZD_TM" & i, UCase$(nm) & ". |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|", i, vl, 11
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i

  For i = 1 To 200 '-----ZD_CK--
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      On Error Resume Next
      Err.Clear
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      vl = CLng(WorkItemSelf.Cells(208 + i - 1, 6).Text)
      If Err.Number <> 0 Then
        vl = 20
        MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & "ZD_CK" & i & " = " & vl & " |fffd||fffd||fffd|.", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        Err.Clear
      End If
      On Error GoTo 0
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ustavki
      UpdateUstavkiZD True, cn, rs, "ZD_CK" & i, UCase$(nm) & ". |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", i, vl, 12
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
  Set WorkItemSelf = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|.------"VS--------------------------------------------------------------------
If ChBox23.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM VS")         ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|

  For i = 1 To 128
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      k = i
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      UpdateListFe cn, rs, "VS", UCase$(nm), i - 1 + 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If
 '----------- |fffd||fffd||fffd||fffd|.----"OP_Vspom"----------------------------------------------------------
If ChBox24.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM OP_Vspom")   ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 128
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      k = i
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_Vspom", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

'----------- |fffd||fffd||fffd||fffd|.---"Ustavki-|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"-----------------------------------------------
If ChBox25.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  On Error Resume Next
  Err.Clear
  For i = 1 To 256
    If WorkItem.Cells(7 + i - 1, 3).Font.ColorIndex <> 15 And WorkItem.Cells(7 + i - 1, 3).Text <> "" Then
      nm = WorkItem.Cells(7 + i - 1, 3).Text
      vl = CLng(WorkItem.Cells(7 + i - 1, 6).Text)
      
      If Err.Number <> 0 Then
        vl = IIf(CLng(WorkItem.Cells(7 + i - 1, 1).Text) Mod 2, 20, 10)
        MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & WorkItem.Cells(7 + i - 1, 2).Text & "=" & vl & " |fffd||fffd||fffd|.", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        Err.Clear
      End If
      UpdateUstavkiVS True, cn, rs, WorkItem.Cells(7 + i - 1, 2).Text, UCase$(nm), i, vl

    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  On Error GoTo 0
  Set WorkItem = Nothing
End If

'----------- |fffd||fffd||fffd||fffd|."OP_VSGroup"---------------------------------------------------------------------------
If ChBox26.Value Then
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd|. |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM OP_VSGroup")  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 128
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_VSGroup", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

' -------------------------------------------------------------------------------------------
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| D_Tags, D_Modul, D_YCO  + csv !!!
  ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!!!
 '-----------------------------------------------------------------------------------------
 If ChBox27.Value Then
 
  'Dim k As Long, SignCnt As Long
  Dim SignCnt As Long
  Dim BegRowCnt As Integer
  Dim PrevUSOName As String, tb As Boolean
  Dim D_YCO As String, YCO As Long, prevYCO As Long, Rack As Long, OP_Base As Long, PLCShortName As String
  Dim isAnalog As Boolean, Start_Addres As Long, tip As String, kod As String
  Dim isCHS As Boolean, isMirrorRack As Boolean
  Dim isFnd As Boolean


  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
  Set WorkItemSelf = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  D_YCO = 1
  cn.Execute ("DELETE * FROM D_Modul") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 32               ' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 32 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| !!!!
    If WorkItem.Cells(4 + 6 * (i - 1), 2).Font.ColorIndex <> 15 Then
      ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| => |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| => |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
      If WorkItem.Cells(4 + 6 * (i - 1), 2).Text <> PrevUSOName Then
        Do
          ts = GetNextCSV(D_YCO)
        Loop While Not IsNumeric(ts) And D_YCO <> ""
  
        If IsNumeric(ts) Then
          YCO = CLng(ts)
        End If
      
        If YCO < 0 Then         ' |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          YCO = 1               ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| 1
        End If
      
        If prevYCO = YCO Then
          YCO = YCO + 1         ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
        End If
        
        prevYCO = YCO
        Rack = 1                ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| 1
        PrevUSOName = WorkItem.Cells(4 + 6 * (i - 1), 2).Text
        
        UpdateD_YCO cn, rs, YCO, PrevUSOName ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Rack1, Rack2, ... ????
      End If
    End If
    
 '-----------------------------------------------------------------------------------
DoAgain:
      For j = 1 To 16       ' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        If WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Font.ColorIndex <> 15 And _
           WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Font.ColorIndex <> 2 And _
           WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Interior.ColorIndex <> 1 Then
          
          isAnalog = False
          SignCnt = 0
          tip = ""
          kod = ""

        Select Case WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text
          Case "140 AVI 030 00"
            SignCnt = 8
            isAnalog = True
            
          Case "140 ARI 030 10"
            SignCnt = 8
            isAnalog = True
          
          Case "140 ACI 030 00"
            SignCnt = 8
            isAnalog = True
          
          Case "140 ACI 040 00"
            SignCnt = 16
            isAnalog = True
          
          Case "140 AII 330 00"
            SignCnt = 8
            isAnalog = True
                      
          Case "140 ACO 020 00"
            SignCnt = 4
            isAnalog = True
          
          Case "140 DDI 353 00"
            SignCnt = 32
          
          Case "140 DII 330 00"
            SignCnt = 8
            
          Case "140 DAI 740 00"
            SignCnt = 16
            
          Case "140 DDO 353 00"
            SignCnt = 32
                    
          Case "140 CPS x14 x0"
          Case "140 CPS 114 10"
          Case "140 CPS 114 20"
          Case "140 CPS 124 10"
          Case "140 CPS 214 00"
          Case "140 CPU 113 02"
          Case "140 CPU 113 03"
          Case "140 CPU 311 10"
          Case "140 CPU 434 12"
          Case "140 CPU 534 14"
          Case "140 CPU 651 50"
          Case "140 CPU 651 60"
          Case "140 CPU 652 60"
          Case "140 CPU 671 60"
          
          Case "140 CHS 210 00"
            isCHS = True
      
          Case "140 NOM 2xx 00"
            tip = "NOM"
            kod = "212 00"
          
          Case "140 CRP 932 00"
          Case "140 CRA 932 00"
          Case "140 CRA 21x x0"
          Case "140 NOE 771 00"
          Case "140 NOE 771 01"
          Case "140 NOE 771 11"
          Case "140 XCP 510 00"
          
          Case ""
            tip = "XCP"
            kod = "510 00"
            
          Case Else
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|! |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|: " & WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text, vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!"
          End Select
          
          If tip = "" And kod = "" Then
            tip = Mid$(WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text, 5, 3)
            kod = Mid$(WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text, 9)
          End If
         
          ts = WorkItem.Cells(5 + 6 * (i - 1) + 1, 5 + j - 1).Text ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
          
          If IsNumeric(ts) Then
            Start_Addres = CLng(ts)
          Else
            Start_Addres = 0
          End If
          
          ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| D_Modul
          If tip <> "" Then
            UpdateD_Modul cn, rs, tip, kod, Start_Addres, SignCnt, isAnalog, YCO, Rack, j
          Else
            MsgBox tip
          End If
          
          If SignCnt <> 0 Then
            For y = 1 To SignCnt    ' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| D_Tags
                UpdateD_Tags cn, rs, WorkItemSelf.Cells(6 + BegRowCnt + y - 1, 5).Text, _
                             WorkItemSelf.Cells(6 + BegRowCnt + y - 1, 6).Text, YCO, Rack, j, y
            Next y
          
            BegRowCnt = BegRowCnt + SignCnt
          End If
        End If
      Next j
      
      If isCHS And Not isMirrorRack Then    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| CHS => |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| D_Modul
        Rack = Rack + 1                     ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd|
        isMirrorRack = True                 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HotStandby
        GoTo DoAgain                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| HotStandby
      End If

    Rack = Rack + 1                         ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd|
    
    ProgressBar.Value = ProgressBar.Value + 1
   Next i
   
  Set WorkItem = Nothing
  Set WorkItemSelf = Nothing
End If
'--------------------------------------------------------------------------
' --------------|fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd|.OP_PLCDiag |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| ----------------------
'--------------------------------------------------------------------------
If ChBox28.Value Then
  
  Dim rmax As Long, RowID As Long, fCount As Long
  Dim strn As String, MsgStr As String
  
    Set rsd = New ADODB.Recordset
    Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
    cn.Execute ("DELETE * FROM OP_PLCDiag") ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    strn = "SELECT * FROM OP_PLCDiag ORDER BY index"
    
    
    rsd.Open strn, cn, adOpenStatic, adLockOptimistic
    For i = 32 To 1 Step -1
      If WorkItem.Cells(4 + 6 * (i - 1), 2).Font.ColorIndex <> 15 Then
        fCount = i
        Exit For
      End If
    Next i
   
    For i = 1 To fCount
      If Cells(4 + 6 * (i - 1), 2).Font.ColorIndex <> 15 Then
        For j = 1 To 16
          rsd.AddNew
          ' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
          rsd!Index = 16 * (i - 1) + j - 1
          ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
         
           rsd!DESC = Replace(WorkItem.Cells(4 + 6 * (i - 1), 2).Text, "|fffd||fffd||fffd| ", "|fffd||fffd||fffd| |fffd|") + _
                    " " + "|fffd||fffd||fffd||fffd||fffd||fffd| " + Replace(WorkItem.Cells(4 + 6 * (i - 1), 5 + j - 1).Text, "|fffd|", "|fffd| ") + _
                    " """ + WorkItem.Cells(5 + 6 * (i - 1), 5 + j - 1).Text + """. " + " $"
                    
          rsd.Update
          ProgressBar.Value = ProgressBar.Value + 1
        Next j
      End If
    Next i
    rsd.Close
  
  For i = 1 To 32               ' |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| 32 |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      k = (i - 1) \ 16          ' |fffd||fffd||fffd| 32 |fffd||fffd||fffd||fffd||fffd||fffd|!!!!
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      ts = Trim$(Mid$(WorkItem.Cells(5 + 6 * (i - 1) - 1, 4).Text, 6))
      UpdateMsg cn, rs, "OP_PLCDiag", _
                SetEndDot(UCase$(WorkItem.Cells(5 + 6 * (i - 1) - 1, 2).Text & _
                  ". |fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & ts & ". |fffd||fffd||fffd||fffd| RIO |fffd||fffd||fffd||fffd||fffd| |fffd|")) & _
                  " $", 512 + (i - 1) + 16 * k

      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_PLCDiag", _
                SetEndDot(UCase$(WorkItem.Cells(5 + 6 * (i - 1) - 1, 2).Text & _
                  ". |fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & ts & ". |fffd||fffd||fffd||fffd| RIO |fffd||fffd||fffd||fffd||fffd| B")) & _
                  " $", 528 + (i - 1) + 16 * k
  ProgressBar.Value = ProgressBar.Value + 1
  Next i
  
  Set WorkItem = Nothing
  Set rsd = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|."BB"---------------------------------------------------------------------------
If ChBox29.Value Then
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM BB")        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 
  For i = 1 To 64
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      UpdateListFe cn, rs, "BB", UCase$(nm), i
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
 Set WorkItem = Nothing
End If


 '----------- |fffd||fffd||fffd||fffd|."OP_MVV"---------------------------------------------------------------------------
 If ChBox30.Value Then
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd|. |fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM OP_MVV")    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 64
    If WorkItem.Cells(6 + i - 1, 1).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 1).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 1).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_MVV", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

 '----------- |fffd||fffd||fffd||fffd|."OP_Group"---------------------------------------------------------------------------
 If ChBox32.Value Then
 
  Set WorkItem = Application.ActiveWorkbook.Sheets.Item("|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
  cn.Execute ("DELETE * FROM OP_Group")    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
  For i = 1 To 160
    If WorkItem.Cells(6 + i - 1, 4).Font.ColorIndex <> 15 And WorkItem.Cells(6 + i - 1, 4).Text <> "" Then
      nm = WorkItem.Cells(6 + i - 1, 4).Text
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| - |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd| index) |fffd| 0!!!
      UpdateMsg cn, rs, "OP_Group", SetEndDot(UCase$(nm)) & " $", i - 1
    End If
    ProgressBar.Value = ProgressBar.Value + 1
  Next i
  Set WorkItem = Nothing
End If

'------------------------------------------------------------------------------------------------------------
  Set WorkItemM = Nothing
  Set rs = Nothing
  Set cn = Nothing
  
  If ProgressBar.Value > 0 And ProgressBar.Value < 5000 Then
     ProgressBar.Value = 5000
     MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbInformation, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  End If
  
ErrorHandler:
    If Str(Err.Number) <> " 0" Then
       MsgBox "Error detected - " & Err.Source & ": |fffd|" & Str(Err.Number) & " - " & Err.Description, vbCritical
    End If
End Sub

Private Sub ChBoxAll_Click()
  If ChBoxAll.Value Then
    ChBox1.Value = True
    ChBox2.Value = True
    ChBox3.Value = True
    ChBox4.Value = True
    ChBox5.Value = True
    ChBox6.Value = True
    ChBox7.Value = True
    ChBox8.Value = True
    ChBox9.Value = True
    ChBox10.Value = True
    ChBox11.Value = True
    ChBox12.Value = True
    ChBox13.Value = True
    ChBox14.Value = True
    ChBox15.Value = True
    ChBox16.Value = True
    ChBox17.Value = True
    ChBox18.Value = True
    ChBox19.Value = True
    ChBox20.Value = True
    ChBox21.Value = True
    'ChBox22.Value = True
    ChBox23.Value = True
    ChBox24.Value = True
    ChBox25.Value = True
    ChBox26.Value = True
    ChBox27.Value = True
    ChBox28.Value = True
    ChBox29.Value = True
    ChBox30.Value = True
    'ChBox31.Value = True
    ChBox32.Value = True
  Else
    ChBox1.Value = False
    ChBox2.Value = False
    ChBox3.Value = False
    ChBox4.Value = False
    ChBox5.Value = False
    ChBox6.Value = False
    ChBox7.Value = False
    ChBox8.Value = False
    ChBox9.Value = False
    ChBox10.Value = False
    ChBox11.Value = False
    ChBox12.Value = False
    ChBox13.Value = False
    ChBox14.Value = False
    ChBox15.Value = False
    ChBox16.Value = False
    ChBox17.Value = False
    ChBox18.Value = False
    ChBox19.Value = False
    ChBox20.Value = False
    ChBox21.Value = False
    ChBox22.Value = False
    ChBox23.Value = False
    ChBox24.Value = False
    ChBox25.Value = False
    ChBox26.Value = False
    ChBox27.Value = False
    ChBox28.Value = False
    ChBox29.Value = False
    ChBox30.Value = False
    ChBox31.Value = False
    ChBox32.Value = False
  End If
End Sub

Private Sub UserForm_Click()

End Sub
Attribute VB_Name = "|fffd||fffd||fffd||fffd|1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private Sub Workbook_AddinInstall()
    On Error Resume Next
    
    
  Dim MsgStr As String, i As Integer
  Dim ListsBar As CommandBarPopup
  Dim DBPopup As CommandBarPopup
  Dim DBPopup1 As CommandBarPopup
  Dim DBActiveList As CommandBarButton
  Dim DBAllLists As CommandBarButton
  Dim DBBtn As CommandBarButton
  Dim picPicture As IPictureDisp

  
  MsgStr = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!" + Chr(13) + _
           "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| " + Chr(13) + _
           "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| 4.0"
  MsgBox MsgStr, vbOKOnly Or vbInformation, "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
  
  Dim BarPresent As Boolean
  BarPresent = False
  For i = 1 To Application.CommandBars.Count
    If Application.CommandBars.Item(i).name = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|" Then
      BarPresent = True
      Exit For
    End If
  Next i
  If Not BarPresent Then
    Application.CommandBars.Add(name:="|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Visible = True
    Set ListsBar = Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls.Add(Type:=msoControlPopup, _
      Before:=1)
    With ListsBar
      .Caption = "|fffd||fffd||fffd||fffd||fffd|"
      .OnAction = "ModuleServ.Lists"
    End With
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    Set DBPopup = Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls.Add(Type:=msoControlPopup)
      DBPopup.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      
      Set DBPopup1 = DBPopup.Controls.Add(Type:=msoControlPopup)
      DBPopup1.Caption = "|fffd| Concept"
        Set DBActiveList = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBActiveList.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
        DBActiveList.OnAction = "ExpActiveList"
        Set DBAllLists = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBAllLists.Caption = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
        DBAllLists.OnAction = "ExpAllLists"
        
      Set DBPopup1 = DBPopup.Controls.Add(Type:=msoControlPopup)
      DBPopup1.Caption = "|fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
        Set DBActiveList = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBActiveList.Caption = "iFix csv-|fffd||fffd||fffd||fffd|"
        DBActiveList.OnAction = "WriteDBActiveList"
        Set DBAllLists = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBAllLists.Caption = "Object.mdb"
        DBAllLists.OnAction = "WriteDBAllLists"
  
' |fffd||fffd||fffd||fffd||fffd||fffd|
    Set DBPopup = Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls.Add(Type:=msoControlPopup)
      DBPopup.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd|"
      Set DBPopup1 = DBPopup.Controls.Add(Type:=msoControlPopup)
      DBPopup1.Caption = "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
        Set DBActiveList = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBActiveList.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
        DBActiveList.OnAction = "ImpOldActiveList"
        Set DBAllLists = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBAllLists.Caption = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
        DBAllLists.OnAction = "ImpOldAllLists"
      Set DBPopup1 = DBPopup.Controls.Add(Type:=msoControlPopup)
      DBPopup1.Caption = "|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
        Set DBActiveList = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBActiveList.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
        DBActiveList.OnAction = "ReadDBActiveList"
        Set DBAllLists = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBAllLists.Caption = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
        DBAllLists.OnAction = "ReadDBAllLists"
  
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    Set DBPopup = Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls.Add(Type:=msoControlPopup)
      DBPopup.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      Set DBPopup1 = DBPopup.Controls.Add(Type:=msoControlPopup)
      DBPopup1.Caption = "|fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
        Set DBActiveList = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBActiveList.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|"
        DBActiveList.OnAction = "ColorsActive"
        Set DBAllLists = DBPopup1.Controls.Add(Type:=msoControlButton)
        DBAllLists.Caption = "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
        DBAllLists.OnAction = "ColorsAll"
      Set DBBtn = DBPopup.Controls.Add(Type:=msoControlButton)
      DBBtn.Style = msoButtonCaption
      DBBtn.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
      DBBtn.OnAction = "ShowOptions"
      Set DBBtn = DBPopup.Controls.Add(Type:=msoControlButton)
      DBBtn.Style = msoButtonCaption
      DBBtn.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|"
      DBBtn.OnAction = "RefreshAll"
      Set DBBtn = DBPopup.Controls.Add(Type:=msoControlButton)
      DBBtn.Style = msoButtonCaption
      DBBtn.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd|"
      DBBtn.OnAction = "OnHelpRequest"
  Else
    Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd|").OnAction = "ModuleServ.Lists"
    With Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      .Controls("|fffd| Concept").Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|").OnAction = "ExpActiveList"
      .Controls("|fffd| Concept").Controls("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|").OnAction = "ExpAllLists"
      .Controls("|fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").Controls("iFix csv-|fffd||fffd||fffd||fffd|").OnAction = "WriteDBActiveList"
      .Controls("|fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").Controls("Object.mdb").OnAction = "WriteDBAllLists"
    End With
    With Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd||fffd|")
      .Controls("|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|").OnAction = "ImpOldActiveList"
      .Controls("|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|").OnAction = "ImpOldAllLists"
      .Controls("|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|").OnAction = "ReadDBActiveList"
      .Controls("|fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|").OnAction = "ReadDBAllLists"
    End With
    With Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|")
      .Controls("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|").OnAction = "ColorsActive"
      .Controls("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Controls("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|").OnAction = "ColorsAll"
      .Controls("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|").OnAction = "RefreshAll"
      .Controls("|fffd||fffd||fffd||fffd||fffd||fffd|").OnAction = "OnHelpRequest"
    End With
  End If

End Sub

Private Sub Workbook_AddinUninstall()
    On Error Resume Next
    
    Application.CommandBars("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Delete
End Sub


INQUEST-PP=macro
