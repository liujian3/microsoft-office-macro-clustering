Attribute VB_Name = "Feuil1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Feuil2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Feuil3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private Sub Worksheet_Change(ByVal Target As Range)
    If ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 1 Then
        Call Module4.DeleteCols(Target)
    ElseIf ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 2 Then
        Call Module4.DeleteRows(Target)
    ElseIf ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 3 Then
        Call Module4.DeleteCellsLeftOrUp(Target)
        Call Module4.Mass_Copy(Target)
    ElseIf ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 4 Then
        Call Module4.DeleteCellsLeft(Target)
        Call Module4.Mass_Copy(Target)
    Else
        Call Module4.Mass_Copy(Target)
    End If
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    Cells.Validation.Delete
    Dim i As Long
    Dim j As Long
    Dim r As Long
    Dim c As Long
    Dim rc As Long
    Dim cc As Long
    If Target.Row > 2 Then
        Call Module1.Automatic(Target)
    End If
End Sub
Attribute VB_Name = "Feuil4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Feuil5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Feuil6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Feuil7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Feuil8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Calculate()
    If ThisWorkbook.etat = 0 Then
        ThisWorkbook.etat = 1
    Else
        If ThisWorkbook.Worksheets("Temp").Cells(1, 3).Value < 157 Then
            ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 1
        ElseIf ThisWorkbook.Worksheets("Temp").Cells(2, 3).Value < 40000 Then
            ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 2
        ElseIf ThisWorkbook.Worksheets("Temp").Cells(1, 3).Value > 157 Then
            ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
            Module4.InsertCols
            Module1.repere
            Module3.Majr
    
        ElseIf ThisWorkbook.Worksheets("Temp").Cells(2, 3).Value > 40000 Then
            ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
            Module4.InsertRows
        Else
            If ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 5 Then
                ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
            Else
                ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
                Dim test As Boolean
                Dim i As Long
                Dim i2 As Long
                Dim j As Long
                Dim j2 As Long
                Dim ys As Long
                Dim yc As Long
                Dim ms As Long
                Dim mc As Long
                Dim borne As Long
                test = True
                borne = ThisWorkbook.Worksheets("UW Capacity").Cells(2, 157).End(xlToLeft).Column
                i = 1
                            
                ys = ThisWorkbook.Worksheets("UW Capacity").Cells(40000, i).End(xlUp).Row
                yc = ThisWorkbook.Worksheets("Data Capa").Cells(40000, i).End(xlUp).Row
                If ys <> 1 Then
                    ms = ys
                    If ThisWorkbook.Worksheets("UW Capacity").Cells(ys, i).End(xlUp).Row <> 1 Then
                        ms = ms - Module2.CountBlanks("UW Capacity", i, ys)
                    End If
                End If
                If yc <> 1 Then
                    mc = yc
                    If ThisWorkbook.Worksheets("Data Capa").Cells(yc, i).End(xlUp).Row <> 1 Then
                        mc = mc - Module2.CountBlanks("Data Capa", i, yc)
                    End If
                End If
                If ms <> mc Then test = False
                
                Do While ys <= yc
                    i = i + 1
                   
                    If i > borne Then Exit Do
                    ys = ThisWorkbook.Worksheets("UW Capacity").Cells(40000, i).End(xlUp).Row
                    yc = ThisWorkbook.Worksheets("Data Capa").Cells(40000, i).End(xlUp).Row
                    If ys <> 1 Then
                        ms = ys
                        If ThisWorkbook.Worksheets("UW Capacity").Cells(ys, i).End(xlUp).Row <> 1 Then
                            ms = ms - Module2.CountBlanks("UW Capacity", i, ys)
                        End If
                    End If
                    If yc <> 1 Then
                        mc = yc
                        If ThisWorkbook.Worksheets("Data Capa").Cells(yc, i).End(xlUp).Row <> 1 Then
                            mc = mc - Module2.CountBlanks("Data Capa", i, yc)
                        End If
                    End If
                    If ms <> mc Then test = False
                Loop
                i2 = i
                If i <> borne + 1 Then
                    Do While test
                        i2 = i2 + 1
                        
                        If i2 > borne Then Exit Do
                        ys = ThisWorkbook.Worksheets("UW Capacity").Cells(40000, i2).End(xlUp).Row
                        yc = ThisWorkbook.Worksheets("Data Capa").Cells(40000, i2).End(xlUp).Row
                        If ys <> 1 Then
                            ms = ys
                            If ThisWorkbook.Worksheets("UW Capacity").Cells(ys, i2).End(xlUp).Row <> 1 Then
                                ms = ms - Module2.CountBlanks("UW Capacity", i2, ys)
                            End If
                        End If
                        If yc <> 1 Then
                            mc = yc
                            If ThisWorkbook.Worksheets("Data Capa").Cells(yc, i2).End(xlUp).Row <> 1 Then
                                mc = mc - Module2.CountBlanks("Data Capa", i2, yc)
                            End If
                        End If
                        If ms <> mc Then test = False
                    Loop
                    If i2 <> borne + 1 Then
                        i = 1
                        Do While ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column = ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column And i <= 40000
                            i = i + 1
                        Loop
                        If i <> 40001 Then
                            If ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column > ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column Then
                                'insertion de cellules avec d|fffd|calage vers la droite
                                Call Module4.InsertCellsRight(i)
                            ElseIf ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column < ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column Then
                                'suppression de cellules avec d|fffd|calage vers la gauche
                                ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 4
                            End If
                        End If
                    Else
                        'insertion de cellules avec d|fffd|calage vers le bas
                        Call Module4.InsertCellsDown(i, borne)
                    End If
                Else
                    i = 1
                    Do While ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column >= ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column And i <= 40000
                        i = i + 1
                    Loop
                    If i <> 40001 Then
                        'suppression de cellules avec d|fffd|calage vers la gauche ou vers le haut
                        ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 3
                    Else
                        'insertion de cellules avec d|fffd|calage vers la droite
                        ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
                        i = 1
                        Do While ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column = ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column And i <= 40000
                            i = i + 1
                        Loop
                        Call Module4.InsertCellsRight(i)
                    End If
                End If
            End If
        End If
    End If
End Sub


Attribute VB_Name = "Feuil9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Module1"
Option Explicit

Sub GroupCreate(feuille As String, ParamArray colonnes() As Variant)
    Dim i As Long
    Dim l As Long
    l = UBound(colonnes())
    If l > 0 Then
        i = 0
        Do While (i < l) 'teste si les colonnes sont bien cons|fffd|cutives
            If (ThisWorkbook.Worksheets("UW Capacity").Cells(2, (Module2.FindCol2(feuille, colonnes(i)) + 1)).Value = colonnes(i + 1)) Then
                i = i + 1
            Else
                Exit Do
            End If
        Loop
        If i = l Then
            Range(ThisWorkbook.Worksheets(feuille).Cells(1, Module2.FindCol2(feuille, colonnes(0))), ThisWorkbook.Worksheets(feuille).Cells(1, Module2.FindCol2(feuille, colonnes(l)))).EntireColumn.Group
        End If
    End If
    ExecuteExcel4Macro ("SHOW.DETAIL(2," & Module2.FindCol2(feuille, colonnes(l)) & ",FALSE,)")
End Sub

Sub Degroupe(feuille As String)
    Dim j As Long
    Dim max As Long
    Dim l As Long
    Dim i As Long
    Dim borne As Long
    j = 1
    max = 1
    borne = ThisWorkbook.Worksheets("UW Capacity").Cells(1, 157).End(xlToLeft).Column
    Do While j <= borne
        If ThisWorkbook.Worksheets(feuille).Cells(1, j).EntireColumn.OutlineLevel > max Then
            max = ThisWorkbook.Worksheets(feuille).Cells(1, j).EntireColumn.OutlineLevel
            i = j
        End If
        j = j + 1
    Loop
    l = j
    Do While max > 1
        Range(ThisWorkbook.Worksheets(feuille).Cells(1, 1), ThisWorkbook.Worksheets(feuille).Cells(1, l)).EntireColumn.Ungroup
        max = max - 1
    Loop
End Sub

Sub ListeCreateC(nom As String, feuille As String, col As Long, rs As Long, re As Long)
'd|fffd|finition d'un nom pour une liste des cellules de reference
    ActiveWorkbook.Names.Add Name:=nom, RefersTo:=Range(ThisWorkbook.Worksheets(feuille).Cells(rs, col), ThisWorkbook.Worksheets(feuille).Cells(re, col))
End Sub

Sub CreateMenu(nom As String, cellule As String)

'Creation de la validation sur la cellule choisie avec pour liste nom
    With Range(cellule).Validation
        .Delete
        .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:= _
        xlBetween, Formula1:="=" & nom
        .IgnoreBlank = True
        .InCellDropdown = True
        .InputTitle = ""
        .ErrorTitle = ""
        .InputMessage = ""
        .ErrorMessage = "Veuillez entr|fffd|e une valeur figurant dans le menu d|fffd|roulant svp."
        .ShowInput = True
        .ShowError = True
    End With
End Sub

Sub DynamicMenu(valuelabel As Variant, valeur As Variant, cellule As String)
    Dim re As Long
    If valeur <> "" Then
        re = Module3.BuildListe(valuelabel, valeur)
        If (re = 0) Then
            re = 1
            ThisWorkbook.Worksheets("Temp").Cells(1, 1).ClearContents
        End If
    Else 'liste vide pour emp|fffd|cher l'utilisateur de rentre n'importe quoi
        re = 1
        ThisWorkbook.Worksheets("Temp").Cells(1, 1).ClearContents
    End If
    Call ListeCreateC("listeDyna", "Temp", 1, 1, re)
    Call CreateMenu("listeDyna", cellule)
End Sub

Sub DynamicMenu2(valuelabel As Variant, v1 As Variant, v2 As Variant, cellule As String)
    Dim re As Long
    If v1 <> "" And v2 <> "" Then
        re = Module3.BuildListe2(valuelabel, v1, v2)
        If (re = 0) Then
            re = 1
            ThisWorkbook.Worksheets("Temp").Cells(1, 1).ClearContents
        End If
    Else 'liste vide pour emp|fffd|cher l'utilisateur de rentre n'importe quoi
        re = 1
        ThisWorkbook.Worksheets("Temp").Cells(1, 1).ClearContents
    End If
    Call ListeCreateC("listeDyna", "Temp", 1, 1, re)
    Call CreateMenu("listeDyna", cellule)
End Sub

Sub Automatic(ByRef Target As Range)
    Dim valuelabel As Variant
    Dim c As Long
    Dim borne As Long
    valuelabel = Cells(1, Target.Column).Value
    If Not IsEmpty(valuelabel) Then
        valuelabel = Trim(valuelabel)
        c = Module2.FindCol("Relations", valuelabel)
        If c = 0 Then
            valuelabel = right(valuelabel, Len(valuelabel) - InStr(valuelabel, "_"))
            c = Module2.FindCol("Codes Omega", valuelabel)
            If c = 0 Then
                Target.Validation.Delete
            Else
                Dim i As Long
                i = 2
                ThisWorkbook.Worksheets("Temp").Columns(1).ClearContents
                borne = ThisWorkbook.Worksheets("Codes Omega").Cells(1, c).End(xlDown).Row
                Do While i <= borne
                    ThisWorkbook.Worksheets("Temp").Cells(i - 1, 1).Value = Trim(ThisWorkbook.Worksheets("Codes Omega").Cells(i, c).Value)
                    i = i + 1
                Loop
                ThisWorkbook.Worksheets("Temp").Columns(1).Sort Key1:=ThisWorkbook.Worksheets("Temp").Columns(1), Order1:=xlAscending, Header:=xlGuess, _
                OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
                Call ListeCreateC("listeDyna", "Temp", 1, 1, i - 2)
                Call CreateMenu("listeDyna", ThisWorkbook.Worksheets("UW Capacity").Cells(Target.Row, Target.Column).Address)
            End If
        Else
            Dim title2 As Variant
            title2 = ThisWorkbook.Worksheets("Relations").Cells(1, c - 1).Value
            If c > 2 Then
                Dim title1 As Variant
                title1 = ThisWorkbook.Worksheets("Relations").Cells(1, c - 2).Value
                If right(title1, 4) = "Code" Then
                    Call DynamicMenu2(valuelabel, ThisWorkbook.Worksheets("Data Capa").Cells(Target.Row, Module2.FindCol("Data Capa", title1)), ThisWorkbook.Worksheets("Data Capa").Cells(Target.Row, Module2.FindCol("Data Capa", title2)), ThisWorkbook.Worksheets("UW Capacity").Cells(Target.Row, Target.Column).Address)
                Else
                    Call DynamicMenu(valuelabel, ThisWorkbook.Worksheets("Data Capa").Cells(Target.Row, Module2.FindCol("Data Capa", title2)), ThisWorkbook.Worksheets("UW Capacity").Cells(Target.Row, Target.Column).Address)
                End If
            Else
                Call DynamicMenu(valuelabel, ThisWorkbook.Worksheets("Data Capa").Cells(Target.Row, Module2.FindCol("Data Capa", title2)), ThisWorkbook.Worksheets("UW Capacity").Cells(Target.Row, Target.Column).Address)
            End If
        End If
    Else
        Target.Validation.Delete
    End If
End Sub

Sub repere()
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 5
    ThisWorkbook.Names.Add Name:="yListen", RefersToR1C1:="='UW Capacity'!R40000"
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 5
    ThisWorkbook.Names.Add Name:="xListen", RefersToR1C1:="='UW Capacity'!C157"
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 5
    ThisWorkbook.Worksheets("Temp").Cells(1, 3).Formula = "=column(xListen)"
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 5
    ThisWorkbook.Worksheets("Temp").Cells(2, 3).Formula = "=row(yListen)"
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
End Sub

Attribute VB_Name = "Module2"
Option Explicit

Function FindCol(feuille As String, nom As Variant) As Long
    'retourne la colonne de la feuille feuille qui a pour etiquette nom
    Dim i As Long
    Dim v As Variant
    Dim borne As Long

    i = 1
    borne = ThisWorkbook.Worksheets(feuille).Cells(1, 157).End(xlToLeft).Column
    v = ThisWorkbook.Worksheets(feuille).Cells(1, i).Value
    Do While (i <= borne And (v <> nom))
    i = i + 1
    v = ThisWorkbook.Worksheets(feuille).Cells(1, i).Value
    Loop
    If v = "" Then
        FindCol = 0
    Else
        FindCol = i
    End If
End Function

Function FindCol2(feuille As String, nom As Variant) As Long
    Dim i As Long
    Dim v As Variant
    Dim borne As Long
    
    i = 1
    borne = ThisWorkbook.Worksheets(feuille).Cells(2, 157).End(xlToLeft).Column
    v = ThisWorkbook.Worksheets(feuille).Cells(2, i).Value
    Do While (i <= borne And v <> nom)
    i = i + 1
    v = ThisWorkbook.Worksheets(feuille).Cells(2, i).Value
    Loop
    If v = "" Then
        FindCol2 = 0
    Else
        FindCol2 = i
    End If
End Function


Function LabelToCode(codeLabel As Variant, valeur As Variant) As Variant
    'retourne un code correspondant |fffd| un libell|fffd|
    'dans la feuille Codes Omega
    Dim i, c1, c2 As Long
    Dim valuelabel As Variant
    
    valuelabel = codeLabel
    If Not IsEmpty(valuelabel) Then
        valuelabel = Trim(valuelabel)
        valuelabel = right(valuelabel, Len(valuelabel) - InStr(valuelabel, "_"))

        c2 = FindCol("Codes Omega", valuelabel) 'colonne o|fffd| on trouve le code
        If c2 = 0 Then
            LabelToCode = ""
        Else
            c1 = c2 + 1 'colonne o|fffd| on teste le libell|fffd|
            
            'parcours de la colonne c1 de la feuille Codes Omega pour trouver valeur
            i = Verify(valeur, c1)
            
            'on retourne le contenu de la case de la colonne c2 en regard
            If i <> 0 Then
                LabelToCode = ThisWorkbook.Worksheets("Codes Omega").Cells(i, c2).Value
            Else
                LabelToCode = ""
            End If
        End If
    End If
End Function

Function Verify(valeur As Variant, ByVal c As Long) As Long
    'v|fffd|rifie que valeur se trouve bien dans la colonne c de "Codes Omega"
    Dim i As Long
    Dim l As Variant
    i = 2
    l = ThisWorkbook.Worksheets("Codes Omega").Cells(i, c).Value
    Do While l <> valeur And l <> ""
        i = i + 1
        l = ThisWorkbook.Worksheets("Codes Omega").Cells(i, c).Value
    Loop
    If l = "" Then
        Verify = 0
    Else
        Verify = i
    End If
End Function

Function Controle(ByVal cr As Long, valeur As Variant, r As Long) As Long
    'v|fffd|rifie que la relation existe dans "Relations" cr = colonne de "Relations", valeur = la valeur cherch|fffd|e, r = ligne dans "UW Capacity"
    Dim i As Long
    Dim c1 As Long
    Dim c2 As Long
    Dim l2 As Variant
    Dim v2 As Variant
    Dim x2 As Variant
    Dim x3 As Variant
    
    i = 2
    c2 = cr - 1
    l2 = ThisWorkbook.Worksheets("Relations").Cells(1, c2).Value
    v2 = ThisWorkbook.Worksheets("Data Capa").Cells(r, FindCol("Data Capa", l2)).Value
    
    If cr > 2 Then
        Dim l1 As Variant
        Dim v1 As Variant
        c1 = cr - 2
        l1 = ThisWorkbook.Worksheets("Relations").Cells(1, c1).Value
        If right(l1, 4) = "Code" Then
            v1 = ThisWorkbook.Worksheets("Data Capa").Cells(r, FindCol("Data Capa", l1)).Value
            Dim x1 As Variant
            x1 = ThisWorkbook.Worksheets("Relations").Cells(i, c1).Value
            x2 = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
            x3 = ThisWorkbook.Worksheets("Relations").Cells(i, cr).Value
            Do While ((x1 <> v1 Or x2 <> v2 Or x3 <> valeur) And x1 <> "")
                i = i + 1
                x1 = ThisWorkbook.Worksheets("Relations").Cells(i, c1).Value
                x2 = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
                x3 = ThisWorkbook.Worksheets("Relations").Cells(i, cr).Value
            Loop
            If x1 = "" Then
                Controle = 0
            Else
                Controle = i
            End If
        Else
            x2 = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
            x3 = ThisWorkbook.Worksheets("Relations").Cells(i, cr).Value
            Do While ((x2 <> v2 Or x3 <> valeur) And x2 <> "")
                i = i + 1
                x2 = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
                x3 = ThisWorkbook.Worksheets("Relations").Cells(i, cr).Value
            Loop
            If x2 = "" Then
                Controle = 0
            Else
                Controle = i
            End If
        End If
    Else
        x2 = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
        x3 = ThisWorkbook.Worksheets("Relations").Cells(i, cr).Value
        Do While ((x2 <> v2 Or x3 <> valeur) And x2 <> "")
            i = i + 1
            x2 = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
            x3 = ThisWorkbook.Worksheets("Relations").Cells(i, cr).Value
        Loop
        If x2 = "" Then
            Controle = 0
        Else
            Controle = i
        End If
    End If
End Function

Function getBottom(feuille As String, ByVal i As Long, ByVal r As Long, ByVal c As Integer) As Long
    If ThisWorkbook.Worksheets(feuille).Cells(r, c).Value = "" Then
        getBottom = Application.WorksheetFunction.max(ThisWorkbook.Worksheets(feuille).Cells(r, c).End(xlUp).Row, i)
    Else
        getBottom = r
    End If
End Function

Function CountBlanks(feuille As String, i As Long, r As Long) As Long
    On Error GoTo ErrorHandler
    CountBlanks = Range(ThisWorkbook.Worksheets(feuille).Cells(1, i), ThisWorkbook.Worksheets(feuille).Cells(r, i)).SpecialCells(xlCellTypeBlanks).Count
    Exit Function
ErrorHandler:
    CountBlanks = 0
End Function
Attribute VB_Name = "Module3"
Option Explicit

Function BuildListe(valuelabel As Variant, valeur As Variant) As Long
    '|fffd|crit dans temp les labels d'un futur menu d|fffd|pendant d'un choix
    Dim i, j, c1, c2 As Long
    Dim v As Variant
    c2 = FindCol("Relations", valuelabel)
    c1 = c2 - 1
    
    
    j = 1
    i = 2
    
    ThisWorkbook.Worksheets("Temp").Columns(1).ClearContents
    
    'parcours de la colonne c1 de la feuille relations
    v = ThisWorkbook.Worksheets("Relations").Cells(i, c1).Value
    Do While (Trim(v) <> "")
        If (v = valeur) Then
            'on |fffd|crit dans la feuille Temp le label <=> code dans c2
            ThisWorkbook.Worksheets("Temp").Cells(j, 1).Value = ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value
            j = j + 1
        End If
    i = i + 1
    v = ThisWorkbook.Worksheets("Relations").Cells(i, c1).Value
    Loop
    
    ThisWorkbook.Worksheets("Temp").Columns(1).Sort Key1:=ThisWorkbook.Worksheets("Temp").Columns(1), Order1:=xlAscending, Header:=xlGuess, _
    OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    
    BuildListe = j - 1

End Function

Function BuildListe2(valuelabel As Variant, v1 As Variant, v2 As Variant) As Long
    '|fffd|crit dans temp les labels d'un futur menu d|fffd|pendant de deux choix
    Dim i, j, c1, c2, c3 As Long
    Dim v As Variant
    c3 = FindCol("Relations", valuelabel)
    c2 = c3 - 1
    c1 = c3 - 2
    
    i = 2
    j = 1
    
    ThisWorkbook.Worksheets("Temp").Columns(1).ClearContents
    
    'parcours de la colonne c1 de la feuille relations
    v = ThisWorkbook.Worksheets("Relations").Cells(i, c1).Value
    Do While (Trim(v) <> "")
        If ((v = v1) And (ThisWorkbook.Worksheets("Relations").Cells(i, c2).Value = v2)) Then
            'on |fffd|crit dans la feuille Temp le label <=> code dans c3
            ThisWorkbook.Worksheets("Temp").Cells(j, 1).Value = ThisWorkbook.Worksheets("Relations").Cells(i, c3).Value
            j = j + 1
        End If
    i = i + 1
    v = ThisWorkbook.Worksheets("Relations").Cells(i, c1).Value
    Loop
    
    ThisWorkbook.Worksheets("Temp").Columns(1).Sort Key1:=ThisWorkbook.Worksheets("Temp").Columns(1), Order1:=xlAscending, Header:=xlGuess, _
    OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    
    BuildListe2 = j - 1

End Function

Sub Majr()
    ThisWorkbook.Worksheets("Temp").Columns(4).ClearContents
    Dim i As Integer
    Dim j As Integer
    Dim k As Integer
    Dim v1 As Variant
    Dim v2 As Variant
    
    j = 1
    
    v1 = ThisWorkbook.Worksheets("Relations").Cells(1, j).Value
    
    Do While v1 <> ""
        i = Module2.FindCol("Data Capa", v1)
        k = 4
        If i <> 0 Then
            Do While ThisWorkbook.Worksheets("Temp").Cells(i, k).Value <> ""
                k = k + 1
            Loop
        End If
        v2 = ThisWorkbook.Worksheets("Relations").Cells(1, j + 1).Value
        If right(v2, 5) = "Label" Then
            If i <> 0 Then
                ThisWorkbook.Worksheets("Temp").Cells(i, k) = Module2.FindCol("UW Capacity", v2)
            End If
            j = j + 2
        Else
            If i <> 0 Then
                v2 = ThisWorkbook.Worksheets("Relations").Cells(1, j + 2).Value
                ThisWorkbook.Worksheets("Temp").Cells(i, k) = Module2.FindCol("UW Capacity", v2)
            End If
            j = j + 1
        End If
        ThisWorkbook.Worksheets("Temp").Cells(i, k + 1).ClearContents
        v1 = ThisWorkbook.Worksheets("Relations").Cells(1, j).Value
    Loop
End Sub



Attribute VB_Name = "Module4"
Option Explicit

Sub Mass_Copy(ByVal Target As Range)
    Dim i As Long
    Dim j As Integer
    Dim j2 As Integer
    Dim k As Integer
    Dim l As Integer
    Dim m As Integer
    Dim r As Long
    Dim c As Integer
    Dim temp As Variant
    
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
    l = Target.Areas.Count
    m = 1
    Do While m <= l
        i = Target.Areas(m).Row
        r = Target.Areas(m).Rows.Count - 1 + i
        j = Target.Areas(m).Column
        j2 = j
        c = Target.Areas(m).Columns.Count - 1 + j
         
        Do While j <= c
            k = 4
            temp = ThisWorkbook.Worksheets("Temp").Cells(j, k).Value
            Do While temp <> ""
                If j2 > temp Or c < temp Then
                    If i > 2 Then ThisWorkbook.Worksheets("UW Capacity").Range(Cells(i, temp), Cells(r, temp)).ClearContents
                End If
                k = k + 1
                temp = ThisWorkbook.Worksheets("Temp").Cells(j, k).Value
            Loop
            Call Module4.Copy(Range(Cells(i, j), Cells(r, j)))
            j = j + 1
        Loop
        m = m + 1
    Loop
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0

End Sub

Sub Copy(ByVal Target As Range)
    Dim c As Long
    Dim colr As Long
    Dim cold As Long
    Dim i As Long
    Dim r As Long
    Dim j As Long
    Dim t As Long
    Dim v1 As Variant
    Dim v2 As Variant
    Dim infs As Long
    Dim infc As Long
    
    j = 1
    i = Target.Row
    c = Target.Column
    r = Target.Rows.Count - 1 + i
    Dim valueLabel1 As Variant
    valueLabel1 = ThisWorkbook.Worksheets("UW Capacity").Cells(1, c).Value
    
    Dim valuelabel2 As Variant
    valuelabel2 = ThisWorkbook.Worksheets("Data Capa").Cells(1, c).Value
    colr = Module2.FindCol("Relations", valueLabel1)
    If Not IsEmpty(valueLabel1) Then
        valueLabel1 = Trim(valueLabel1)
        valueLabel1 = right(valueLabel1, Len(valueLabel1) - InStr(valueLabel1, "_"))
        cold = Module2.FindCol("Codes Omega", valueLabel1)
    Else
        cold = 0
    End If
    
    'modif NDA - 28/10/05 - g|fffd|n|fffd|re une erreur dans le changement de valeurs
    'infs = getBottom("UW Capacity", i, r, c)
    'infc = getBottom("Data Capa", i, r, c)
    'r = Application.WorksheetFunction.max(infs, infc)
    
    If colr <> 0 Then 'si d|fffd|pend d'un autre champs
        Do While i <= r
            v1 = Target.Rows(j).Value
            v2 = Trim(v1)
            If i <= 2 Then
                ThisWorkbook.Worksheets("Data Capa").Cells(i, c).Value = v1
            Else
                If v1 = "" Then
                    ThisWorkbook.Worksheets("Data Capa").Cells(i, c).ClearContents
                ElseIf v2 = "" Then
                    ThisWorkbook.Worksheets("UW Capacity").Cells(i, c).ClearContents
                Else
                    t = Module2.Controle(colr, v2, i)
                    If t = 0 Then
                        ThisWorkbook.Worksheets("UW Capacity").Cells(i, c).ClearContents
                    Else
                        ThisWorkbook.Worksheets("Data Capa").Cells(i, c).Value = Module2.LabelToCode(valuelabel2, v1)
                    End If
                End If
            End If
            i = i + 1
            j = j + 1
        Loop
    ElseIf cold <> 0 Then 'si est dans "Codes Omega"
        Do While i <= r
            v1 = Target.Rows(j).Value
            v2 = Trim(v1)
            If i <= 2 Then
                ThisWorkbook.Worksheets("Data Capa").Cells(i, c).Value = v1
            Else
                If v1 = "" Then
                    ThisWorkbook.Worksheets("Data Capa").Cells(i, c).ClearContents
                ElseIf v2 = "" Then
                    ThisWorkbook.Worksheets("UW Capacity").Cells(i, c).ClearContents
                Else
                    If valueLabel1 <> valuelabel2 Then
                        valueLabel1 = Module2.LabelToCode(valuelabel2, v2)
                        If valueLabel1 = "" Then
                            ThisWorkbook.Worksheets("UW Capacity").Cells(i, c).ClearContents
                        Else
                            ThisWorkbook.Worksheets("Data Capa").Cells(i, c).Value = valueLabel1
                        End If
                        
                    Else
                        t = Module2.Verify(v2, cold)
                        If t = 0 Then
                            ThisWorkbook.Worksheets("UW Capacity").Cells(i, c).ClearContents
                        Else
                            ThisWorkbook.Worksheets("Data Capa").Cells(i, c).Value = v1
                        End If
                    End If
                End If
            End If
            i = i + 1
            j = j + 1
        Loop
    Else
        Do While i <= r
            v1 = Target.Rows(j).Value
            If VarType(v1) = vbDouble Or VarType(v1) = vbDate Then
                v2 = v1
            Else
                v2 = Trim(v1)
            End If
            If v1 = "" Then
                ThisWorkbook.Worksheets("Data Capa").Cells(i, c).ClearContents
                If i = 2 Then ThisWorkbook.Worksheets("UW Capacity").Cells(1, c).ClearContents
            ElseIf v2 = "" Then
                ThisWorkbook.Worksheets("UW Capacity").Cells(i, c).ClearContents
                If i = 2 Then ThisWorkbook.Worksheets("UW Capacity").Cells(1, c).ClearContents
            Else
                ThisWorkbook.Worksheets("Data Capa").Cells(i, c).Value = v2
                If i = 2 And VarType(v1) = vbDouble Then ThisWorkbook.Worksheets("UW Capacity").Cells(1, c).Value = v2
            End If
            i = i + 1
            j = j + 1
        Loop
    End If
    i = Target.Row
    If i <= 2 And Target.Rows.Count - 1 + i >= 2 Then
        Module3.Majr
    End If
End Sub

Sub InsertRows()
    Dim k As Long
    Dim nrow As Long
    Dim temp As Long
    k = ThisWorkbook.Worksheets("Temp").Cells(2, 3).Value
    nrow = k - 40000
    temp = 0
    Dim i As Long
    Dim j As Long
    i = 3
    j = 3
    Do While i <= k And temp < nrow
        Do While i <= k And ThisWorkbook.Worksheets("UW Capacity").Cells(i, 1).End(xlToRight).Column = 256 And Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(i, 1).Value) = "" And Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(i, 256).Value) = ""
            i = i + 1
        Loop
        Do While j <= k And ThisWorkbook.Worksheets("Data Capa").Cells(j, 1).End(xlToRight).Column = 256 And Trim(ThisWorkbook.Worksheets("Data Capa").Cells(j, 1).Value) = "" And Trim(ThisWorkbook.Worksheets("Data Capa").Cells(j, 256).Value) = ""
            j = j + 1
        Loop
        If i = j Then
            i = i + 1
            j = j + 1
        ElseIf i > j Then
            ThisWorkbook.Worksheets("Data Capa").Range(Cells(j, 1).Address & ":" & Cells(i - 1, 1).Address).EntireRow.Insert
            temp = temp + i - j
            i = i + 1
            j = i
        Else
            MsgBox "Erreur !!! Veuillez r|fffd|importer les donn|fffd|es"
            Exit Do
        End If
    Loop
    Module1.repere
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
End Sub

Sub InsertCols()
    Dim k As Integer
    Dim ncol As Integer
    Dim temp As Integer
    k = ThisWorkbook.Worksheets("Temp").Cells(1, 3).Value
    ncol = k - 157
    temp = 0
    Dim i As Long
    Dim j As Long
    i = 3
    j = 3
    Do While i <= k And temp < ncol
        Do While i <= k And ThisWorkbook.Worksheets("UW Capacity").Cells(1, i).End(xlDown).Row = 65536 And Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(i, 1).Value) = "" And Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(65536, i).Value) = ""
            i = i + 1
        Loop
        Do While j <= k And ThisWorkbook.Worksheets("Data Capa").Cells(1, j).End(xlDown).Column = 256 And Trim(ThisWorkbook.Worksheets("Data Capa").Cells(j, 1).Value) = "" And Trim(ThisWorkbook.Worksheets("Data Capa").Cells(65536, j).Value) = ""
            j = j + 1
        Loop
        If i = j Then
            i = i + 1
            j = j + 1
        ElseIf i > j Then
            ThisWorkbook.Worksheets("Data Capa").Range(Cells(1, j).Address & ":" & Cells(1, i - 1).Address).EntireColumn.Insert
            temp = temp + i - j
            i = i + 1
            j = i
        Else
            MsgBox "Erreur !!! Veuillez r|fffd|importer les donn|fffd|es"
            Exit Do
        End If
    Loop
    Module1.repere
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
End Sub


Sub InsertCellsDown(i As Long, borne As Long)
    Dim y1 As Long
    Dim y2 As Long
    Dim k As Long
    Dim l As Long
    Dim first As Integer
    Dim colr As Long
    Dim valueLabel1 As Variant
    Dim v As Variant
    Dim temp As Variant
    Dim t As Integer
    
    Do While i <= borne
        first = 0
        k = ThisWorkbook.Worksheets("UW Capacity").Cells(40000, i).End(xlUp).Row
        l = ThisWorkbook.Worksheets("Data Capa").Cells(40000, i).End(xlUp).Row
        If k <> l Then
            y1 = 3
            y2 = 3
            Do While y1 <= k
                Do While y1 <= k And Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(y1, i).Value) = ""
                    y1 = y1 + 1
                Loop
                Do While y2 <= l And Trim(ThisWorkbook.Worksheets("Data Capa").Cells(y2, i).Value) = ""
                    y2 = y2 + 1
                Loop
                If y1 = y2 Then
                    y1 = y1 + 1
                    y2 = y2 + 1
                ElseIf y1 > y2 Then
                    ThisWorkbook.Worksheets("Data Capa").Range(Cells(y2, i).Address & ":" & Cells(y1 - 1, i).Address).Insert shift:=xlDown
                    l = l + y1 - y2
                    If first = 0 Then first = y2
                    y1 = y1 + 1
                    y2 = y1
                Else
                    MsgBox "Erreur !!! Veuillez r|fffd|importer les donn|fffd|es"
                    Exit Sub
                End If
            Loop
        End If
        If first > 2 Then
            k = 4
            temp = ThisWorkbook.Worksheets("Temp").Cells(i, k).Value
            Do While temp <> ""
                ThisWorkbook.Worksheets("UW Capacity").Range(Cells(first, temp), Cells(l, temp)).ClearContents
                k = k + 1
                temp = ThisWorkbook.Worksheets("Temp").Cells(i, k).Value
            Loop
            valueLabel1 = ThisWorkbook.Worksheets("UW Capacity").Cells(1, i).Value
            colr = Module2.FindCol("Relations", valueLabel1)
            y1 = first
            If colr <> 0 Then 'si d|fffd|pend d'un autre champs
                Do While y1 <= l
                    If y1 > 2 Then
                        v = Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(y1, i).Value)
                        If v <> "" Then
                            t = Module2.Controle(colr, v, y2)
                            If t = 0 Then
                                ThisWorkbook.Worksheets("UW Capacity").Cells(y1, i).ClearContents
                            End If
                        End If
                    End If
                    y1 = y1 + 1
                Loop
            End If
        End If
        i = i + 1
    Loop
End Sub

Sub InsertCellsRight(i As Long)
    Dim x1 As Integer
    Dim x2 As Integer
    Dim k As Integer
    Dim l As Integer
    Dim borne As Integer
    Dim first As Integer
    Dim v As Variant
    Dim colr As Integer
    Dim cold As Integer
    Dim valueLabel1 As Variant
    Dim valuelabel2 As Variant
    Dim temp As Variant
    Dim t As Integer
    borne = ThisWorkbook.Worksheets("UW Capacity").Cells(2, 157).End(xlToLeft).Column
    Do While i <= 40000
        first = 0
        k = ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column
        l = ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column
        If k <> l Then
            x1 = 1
            x2 = 1
            Do While x1 <= k
                Do While x1 <= k And Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(i, x1).Value) = ""
                    x1 = x1 + 1
                Loop
                Do While x2 <= l And Trim(ThisWorkbook.Worksheets("Data Capa").Cells(i, x2).Value) = ""
                    x2 = x2 + 1
                Loop
                If x1 = x2 Then
                    x1 = x1 + 1
                    x2 = x2 + 1
                ElseIf x1 > x2 Then
                    ThisWorkbook.Worksheets("Data Capa").Range(Cells(i, x2).Address & ":" & Cells(i, x1 - 1).Address).Insert shift:=xlToRight
                    l = l + x1 - x2
                    If first = 0 Then first = x2
                    x1 = x1 + 1
                    x2 = x1
                Else
                    MsgBox "Erreur !!! Veuillez r|fffd|importer les donn|fffd|es"
                    Exit Sub
                End If
            Loop
        End If
        If i = 2 Then
            Module3.Majr
        End If
        If k > borne Then
            Range(ThisWorkbook.Worksheets("UW Capacity").Cells(i, borne + 1), ThisWorkbook.Worksheets("UW Capacity").Cells(i, k)).ClearContents
        End If
        If first <> 0 And i > 2 Then
            x1 = first
            Do While x1 <= ThisWorkbook.Worksheets("UW Capacity").Cells(i, 157).End(xlToLeft).Column
                k = 4
                temp = ThisWorkbook.Worksheets("Temp").Cells(x1, k).Value
                Do While temp <> ""
                    ThisWorkbook.Worksheets("UW Capacity").Cells(i, temp).ClearContents
                    k = k + 1
                    temp = ThisWorkbook.Worksheets("Temp").Cells(x1, k).Value
                Loop
                valueLabel1 = ThisWorkbook.Worksheets("UW Capacity").Cells(1, x1).Value
                valuelabel2 = ThisWorkbook.Worksheets("Data Capa").Cells(1, x1).Value
                colr = Module2.FindCol("Relations", valueLabel1)
                If Not IsEmpty(valueLabel1) Then
                    valueLabel1 = Trim(valueLabel1)
                    valueLabel1 = right(valueLabel1, Len(valueLabel1) - InStr(valueLabel1, "_"))
                    cold = Module2.FindCol("Codes Omega", valueLabel1)
                Else
                    cold = 0
                End If
                If colr <> 0 Then 'si d|fffd|pend d'un autre champs
                    v = Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(i, x1).Value)
                    If v <> "" Then
                        t = Module2.Controle(colr, v, i)
                        If t = 0 Then
                            ThisWorkbook.Worksheets("UW Capacity").Cells(i, x1).ClearContents
                        Else
                            ThisWorkbook.Worksheets("Data Capa").Cells(i, x1).Value = Module2.LabelToCode(valuelabel2, v)
                        End If
                    End If
                ElseIf cold <> 0 Then 'si dans une table de Codes Omega
                    v = Trim(ThisWorkbook.Worksheets("UW Capacity").Cells(i, x1).Value)
                    If v <> "" Then
                        valuelabel2 = Trim(valuelabel2)
                        valuelabel2 = right(valuelabel2, Len(valuelabel2) - InStr(valuelabel2, "_"))
                        If valueLabel1 <> valuelabel2 Then
                            valueLabel1 = Module2.LabelToCode(valuelabel2, v)
                            If valueLabel1 = "" Then
                                ThisWorkbook.Worksheets("UW Capacity").Cells(i, x1).ClearContents
                            Else
                                ThisWorkbook.Worksheets("Data Capa").Cells(i, x1).Value = valueLabel1
                            End If
                        Else
                            t = Module2.Verify(v, cold)
                            If t = 0 Then
                                ThisWorkbook.Worksheets("UW Capacity").Cells(i, x1).ClearContents
                            Else
                                ThisWorkbook.Worksheets("Data Capa").Cells(i, x1).Value = v
                            End If
                        End If
                    End If
                End If
                x1 = x1 + 1
            Loop
        End If
        i = i + 1
    Loop
End Sub


Sub DeleteRows(ByRef Target As Range)
    ThisWorkbook.Worksheets("Data Capa").Range(Target.Address).Delete shift:=xlShiftUp
    Call Module1.repere
    Call Module3.Majr
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
End Sub

Sub DeleteCols(ByRef Target As Range)
    Dim l As Integer
    Dim m As Integer
    Dim temp As Variant
    
    l = Target.Areas.Count
    temp = ""
    m = 1
    Do While m <= l
        temp = temp & Target.Areas(m).Columns.Address & ","
        m = m + 1
    Loop
    temp = left(temp, Len(temp) - 1)
    ThisWorkbook.Worksheets("Data Capa").Range(temp).Delete shift:=xlShiftToLeft
    Call Module3.Majr
    Call Module1.repere
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
End Sub

Sub DeleteCellsup(Target As Range)
    Dim i As Long
    Dim j As Integer
    Dim l As Integer
    Dim m As Integer
    Dim r As Long
    Dim c As Integer
    
    Dim top As Long
    Dim left As Integer
    Dim right As Integer
    Dim bottom As Long
    
    i = 1
    bottom = 1
    Do While i <= 157
        bottom = Application.WorksheetFunction.max(ThisWorkbook.Worksheets("Data Capa").Cells(40000, i).End(xlUp).Row, bottom)
        i = i + 1
    Loop
    top = bottom
    i = 1
    right = 1
    left = 157
    
    l = Target.Areas.Count
    m = 1
    i = Target.Areas(m).Row
    j = Target.Areas(m).Column
    c = Target.Areas(m).Columns.Count - 1 + j
    Do While (m <= l)
        left = Application.WorksheetFunction.Min(j, left)
        top = Application.WorksheetFunction.Min(i, top)
        right = Application.WorksheetFunction.max(c, right)
        If j = c Then
            m = m + 1
            If m > l Then Exit Do
            i = Target.Areas(m).Row
            j = Target.Areas(m).Column
            c = Target.Areas(m).Columns.Count - 1 + j
        Else
            j = j + 1
        End If
    Loop
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
    Call Module4.Mass_Copy(Range(Cells(top, left), Cells(bottom, right)))
End Sub

Sub DeleteCellsLeftOrUp(ByRef Target As Range)
    Dim i As Long
    Dim j As Integer
    Dim l As Integer
    Dim m As Integer
    Dim r As Long
    Dim c As Integer
    
    Dim top As Long
    Dim left As Integer
    Dim right As Integer
    Dim bottom As Long
    
    i = 1
    bottom = 1
    Do While i <= 157
        bottom = Application.WorksheetFunction.max(ThisWorkbook.Worksheets("Data Capa").Cells(40000, i).End(xlUp).Row, bottom)
        i = i + 1
    Loop
    top = bottom
    i = 1
    right = 1
    Do While i <= bottom
        right = Application.WorksheetFunction.max(ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column, right)
        i = i + 1
    Loop
    left = right
    
    l = Target.Areas.Count
    m = 1
    i = Target.Areas(m).Row
    j = Target.Areas(m).Column
    c = Target.Areas(m).Columns.Count - 1 + j
    Do While (m <= l)
        left = Application.WorksheetFunction.Min(j, left)
        top = Application.WorksheetFunction.Min(i, top)
        If j = c Then
            m = m + 1
            If m > l Then Exit Do
            i = Target.Areas(m).Row
            j = Target.Areas(m).Column
            c = Target.Areas(m).Columns.Count - 1 + j
        Else
            j = j + 1
        End If
    Loop
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
    Call Module4.Mass_Copy(Range(Cells(top, left), Cells(bottom, right)))
End Sub

Sub DeleteCellsLeft(ByRef Target As Range)
    Dim i As Long
    Dim j As Integer
    Dim l As Integer
    Dim m As Integer
    Dim r As Long
    Dim c As Integer
    
    Dim top As Long
    Dim left As Integer
    Dim right As Integer
    Dim bottom As Long
    
    bottom = 1
    top = 40000
    i = 1
    right = 1
    Do While i <= bottom
        right = Application.WorksheetFunction.max(ThisWorkbook.Worksheets("Data Capa").Cells(i, 157).End(xlToLeft).Column, right)
        i = i + 1
    Loop
    left = right
    
    l = Target.Areas.Count
    m = 1
    i = Target.Areas(m).Row
    j = Target.Areas(m).Column
    c = Target.Areas(m).Columns.Count - 1 + j
    r = Target.Areas(m).Rows.Count - 1 + i
    Do While (m <= l)
        left = Application.WorksheetFunction.Min(j, left)
        top = Application.WorksheetFunction.Min(i, top)
        bottom = Application.WorksheetFunction.max(r, bottom)
        If j = c Then
            m = m + 1
            If m > l Then Exit Do
            i = Target.Areas(m).Row
            j = Target.Areas(m).Column
            c = Target.Areas(m).Columns.Count - 1 + j
            r = Target.Areas(m).Column
        Else
            j = j + 1
        End If
    Loop
    ThisWorkbook.Worksheets("Temp").Cells(3, 3).Value = 0
    Call Module4.Mass_Copy(Range(Cells(top, left), Cells(bottom, right)))
End Sub


Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Public etat As Integer

Private Sub Workbook_Open()
    ThisWorkbook.etat = 0
    Application.EnableEvents = False
    ThisWorkbook.Worksheets("Data Capa").Unprotect
    ThisWorkbook.Worksheets("Temp").Unprotect
    Call Module1.repere
    Call Module3.Majr
    ThisWorkbook.Worksheets("Data Capa").Protect Contents:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("Codes Omega").Protect Contents:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("Relations").Protect Contents:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("Temp").Protect Contents:=True, UserInterfaceOnly:=True
    ThisWorkbook.Worksheets("Read Me").Protect Contents:=True, UserInterfaceOnly:=True
    If ThisWorkbook.Worksheets("Data Capa").Visible = True Then ThisWorkbook.Worksheets("Data Capa").Visible = False
    If ThisWorkbook.Worksheets("Relations").Visible = True Then ThisWorkbook.Worksheets("Relations").Visible = False
    If ThisWorkbook.Worksheets("Temp").Visible = True Then ThisWorkbook.Worksheets("Temp").Visible = False
    ActiveWorkbook.Protect Structure:=True, Windows:=False
    Application.EnableEvents = True
    ThisWorkbook.Worksheets("Temp").Calculate
End Sub


INQUEST-PP=macro
