Attribute VB_Name = "DieseArbeitsmappe"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Activate()
'Application.CommandBars("Abrechnung_|fffd|berstunden").Enabled = True
'Application.CommandBars("Abrechnung_|fffd|berstunden").Visible = True
Sheets("Daten").Activate
'Application.Calculate Entfernt weil das kopieren/einf|fffd|gen der alten Daten nicht gegangen ist
End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
On Error GoTo ende
Application.CommandBars("Abrechnung_|fffd|berstunden").Delete
With Application
        .Calculation = xlAutomatic
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False
ende:
End Sub



Private Sub Workbook_Open()
On Error Resume Next
Sheets("Benutzer").Select
ActiveSheet.Unprotect ("copy")
Range("A:A").Find(what:=Application.UserName, LookAt:=xlWhole, MatchCase:=False).Select
If UCase(ActiveCell) = UCase(Application.UserName) Then GoTo termin
Range("A65536").End(xlUp).Offset(1, 0).Select
ActiveCell = Application.UserName
UserForm1.Show
ActiveSheet.Protect ("copy")

termin:

'Termine suchen
Dim such As Range
Dim b As Integer

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 1, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 2, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 4, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 6, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen

GoTo ende


anzeigen:

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 1, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 2, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 3, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 4, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 5, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

Set such = Sheets("Termine").Range("A2:A65000").Find(what:=Date + 6, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)

If Not such Is Nothing Then GoTo anzeigen2

anzeigen2:
'N|fffd|chsten 10 Termine in Variable schreiben
Dim datum(10) As Date
Dim text(10) As String
Dim a As Integer

For a = 0 To 9
datum(a) = such.Offset(a, 0)
text(a) = such.Offset(a, 1)
Next

UserForm7.TextBox1 = datum(0)
UserForm7.TextBox2 = text(0)

UserForm7.TextBox3 = datum(1)
UserForm7.TextBox4 = text(1)

UserForm7.TextBox5 = datum(2)
UserForm7.TextBox6 = text(2)

UserForm7.TextBox7 = datum(3)
UserForm7.TextBox8 = text(3)

UserForm7.TextBox9 = datum(4)
UserForm7.TextBox10 = text(4)

UserForm7.TextBox11 = datum(5)
UserForm7.TextBox12 = text(5)

UserForm7.TextBox13 = datum(6)
UserForm7.TextBox14 = text(6)

UserForm7.TextBox15 = datum(7)
UserForm7.TextBox16 = text(7)

UserForm7.TextBox17 = datum(8)
UserForm7.TextBox18 = text(8)

UserForm7.TextBox19 = datum(9)
UserForm7.TextBox20 = text(9)
UserForm7.Show
Unload UserForm7

ende:

Sheets("Daten").Select

End Sub
Attribute VB_Name = "Modul1"
Option Explicit

Public Sub Abrechnungr|fffd|ckseite()

Dim anfdatum As Date ' Anfangssuchdatum
Dim enddatum As Date ' Endsuchdatum
Dim zeilen As Long 'Anzahl der belegten Zeilen
Dim zaehlen As Integer 'For-Schleife fuer das suchen
Dim anfreihe As Integer, endreihe As Integer 'Reihe des Anfangs- bzw. Enddatum
Dim suchen As Integer   'sucheenddatum: zum suchen des Enddatums wenn vorne kein Datum eingetragen ist

'Datum abfragen
    On Error GoTo Fehler:

'************************************************
'Ermitteln des Datumbereichs wenn er |fffd|ber markierte Zellen angegeben wird
Dim bereich As Range
Worksheets("Daten").Activate
Dim anfdatum1, enddatum1 As Date

For Each bereich In Selection
    If bereich.Column > 1 Then GoTo markiert1 'falls markierte Zelle nicht in Datumsspalte
    If Not anfdatum1 > "" Then anfdatum1 = bereich.Value
    If anfdatum1 > "" Then enddatum1 = bereich.Value
Next
If Not anfdatum1 = enddatum1 Then anfdatum = anfdatum1: enddatum = enddatum1: GoTo makiert
'anfdatum = anfdatum1: enddatum = enddatum1: weil bei verwenden der richtigen Variaben
'anfdatum bzw. enddatum fehler kamm
'*************************************************

markiert1:
    anfdatum = InputBox("Bitte geben Sie das Anfangsdatum ein:", _
            "Bitte Anfangsdatum eingeben")
    
    enddatum = InputBox("Bitte geben Sie das Enddatum ein:", _
            "Bitte Enddatum eingeben")
            
makiert:


'Datum f|fffd|r die aktualiesierungs Funktion in O2 bzw. O3 schreiben
Cells(2, 15).Value = anfdatum
Cells(3, 15).Value = enddatum
           
'Automatische Berechnung aus
With Application
        .Calculation = xlManual
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False


'Anzahl der Vorgaenge ermitteln
Sheets("Daten").Activate
zeilen = ActiveSheet.UsedRange.Rows.Count

'Datum suchen
    For zaehlen = 1 To zeilen
        ActiveWorkbook.Worksheets("Daten").Select
        Range("A1").Select
        
        If anfreihe > 0 Then GoTo anfgefunden 'damit bei gleichen Datum hintereinander nicht weiter gez|fffd|hlt wird
            If anfdatum = ActiveCell.Offset(zaehlen, 0) Then _
            anfreihe = zaehlen
anfgefunden:

     'Enddatum suchen, wird dann nach sucheenddatum: wietergeleitet
        If ActiveCell.Offset(zaehlen, 0) = enddatum Then GoTo sucheenddatum
    Next

endgefunden:


'Meldung wenn Datum nicht gefunden werden konnte
If anfreihe = 0 Then GoTo datumnichtgefunden
If endreihe = 0 Then GoTo datumnichtgefunden
    
'Abfrage ob es mehr wie zwei R|fffd|ckseiten sind (mehr als 64 Eintr|fffd|ge)
If endreihe - anfreihe > 64 Then GoTo zuviel
    
'Daten ins Abrechnungsformular |fffd|bertragen
Dim rueck1() As Variant 'zum eintragen der Daten in R|fffd|ckseite
Dim zeilrueck As Integer 'Zahler f|fffd|r die Zuweisung der zeilen
Dim spalrueck As Integer 'Z|fffd|hler f|fffd|r die Zuweisung der spalten
Dim zeile As Integer, spalte As Integer 'zum Z|fffd|hlen beim Schreiben in das R|fffd|ckseiten-Formular
Dim Blatt As String     'f|fffd|r die Auswahl ob R|fffd|ckseite 1 od 2

'Daten der Variablen zuweisen
ReDim rueck1(0 To endreihe + 1, 10) As Variant
Range("A" & anfreihe + 1).Select    'ActiveCelle auf das Anfangsdatum setzten
For zeilrueck = anfreihe + 1 To endreihe + 1
    For spalrueck = 1 To 11
               rueck1(zeilrueck, spalrueck - 1) = Worksheets("Daten").Cells(zeilrueck, spalrueck).Value
    Next
Next

'Daten in R|fffd|ckseite schreiben
'*********************************************

'R|fffd|ckseiten l|fffd|schen
ActiveWorkbook.Worksheets("R|fffd|ckseite 1").Select
Range("A3:I35").ClearContents   'R|fffd|ckseite 1 l|fffd|schen
Range("L3:L35").ClearContents 'Spalte Landerk|fffd|rzel l|fffd|schen
ActiveWorkbook.Worksheets("R|fffd|ckseite 2").Select
Range("A3:I35").ClearContents
Range("L3:L35").ClearContents 'Spalte Landerk|fffd|rzel l|fffd|schen
'Vorderseite l|fffd|schen
'Abfrage ob die Vorderseite gel|fffd|scht werden soll
Dim loeschen As Integer
loeschen = MsgBox("Sollen die Eintr|fffd|ge der Vorderseite gel|fffd|scht und das Datum neu gesetzt werden?", vbYesNo, "L|fffd|schen der Vorderseite?")
If loeschen = 6 Then GoTo weiter Else: GoTo nicht2

weiter:
ActiveWorkbook.Worksheets("Vorderseite").Select

'Reiseziehl
Range("K7").Select
ActiveCell = ""
'Kunde/Firma
Range("K8").Select
ActiveCell = ""
'Reisezweck
Range("K9").Select
ActiveCell = ""

'Maschinentyp / Ma-Nr / Auftragsnr
'entf|fffd|llt seit neuem Formular Jan. 2016
'Range("H10").Select
'ActiveCell = ""
'Range("W10").Select
'ActiveCell = ""
'Range("AK10").Select
'ActiveCell = ""

'Reisekostenvorschus / W|fffd|hrung / Kurs
Range("D11").Select
ActiveCell = ""
Range("K11").Select
ActiveCell = ""
Range("P11").Select
ActiveCell = 1

'Abfahrt in / am / Zeit
'Range("B18").Select
'ActiveCell = ""
Range("H18").Select
ActiveCell = ""
Range("O18").Select
ActiveCell = ""

'R|fffd|ckkehr in / am / Zeit
'Range("B19").Select
'ActiveCell = ""
Range("H19").Select
ActiveCell = ""
Range("O19").Select
ActiveCell = ""

'Fahrtausweis Bahn/Schiff Inland
Range("H22").Select
ActiveCell = ""

'Fahrtausweis Bahn/Schiff Ausland / Kurs
Range("H23").Select
ActiveCell = ""
Range("K23").Select
ActiveCell = 1
'Range("AI20").Select  /// W|fffd|hrung
'ActiveCell = ""

'Eigener PKW / |fffd|/KM /
Range("B25").Select
ActiveCell = ""
Range("D25").Select
ActiveCell = 0.3


'Eigener PKW ausland
'entf|fffd|llt seit neuem Formular Jan. 2016
'Range("H22").Select
'ActiveCell = ""
'Range("O22").Select
'ActiveCell = ""
'Range("AC22").Select
'ActiveCell = ""
'Range("AI22").Select
'ActiveCell = ""

'Verpflegungsaufwendung Deutschland
Range("F30").Select
ActiveCell = ""

Range("F31").Select
ActiveCell = ""

'Deutschland Fr|fffd|hst|fffd|ck / Mittag-Abendessen
Range("I30").Select
ActiveCell = ""

Range("I31").Select
ActiveCell = ""

Range("L30").Select
ActiveCell = ""

Range("L31").Select
ActiveCell = ""

'Christa Zeile wird nicht gebraucht
'Range("F32").Select
'ActiveCell = ""

'Verpflegungsaufwendung Ausland
Range("F34").Select
ActiveCell = ""

Range("F35").Select
ActiveCell = ""

Range("F36").Select
ActiveCell = ""

Range("F37").Select
ActiveCell = ""

'Ausland Fr|fffd|hst|fffd|ck / Mittag-Abendessen
Range("I34").Select
ActiveCell = ""

Range("I35").Select
ActiveCell = ""

Range("I36").Select
ActiveCell = ""

Range("I37").Select
ActiveCell = ""

Range("L34").Select
ActiveCell = ""

Range("L35").Select
ActiveCell = ""

Range("L36").Select
ActiveCell = ""

Range("L37").Select
ActiveCell = ""


'|fffd|bernachtungskosten/-pauschale Inland
'Betrag
Range("D43").Select
ActiveCell = ""
Range("D44").Select
ActiveCell = ""
Range("D45").Select
ActiveCell = ""
'Tage
Range("F43").Select
ActiveCell = ""
Range("F44").Select
ActiveCell = ""
Range("F45").Select
ActiveCell = ""

'|fffd|bernachtungskosten/-pauschale Inland
'Betrag
Range("D47").Select
ActiveCell = ""
Range("D48").Select
ActiveCell = ""
Range("D49").Select
ActiveCell = ""
'Tage
Range("F47").Select
ActiveCell = ""
Range("F48").Select
ActiveCell = ""
Range("F49").Select
ActiveCell = ""
'Kurs
Range("K47").Select
ActiveCell = 1
Range("K48").Select
ActiveCell = 1
Range("K49").Select
ActiveCell = 1

'Sonstige Aufwendungen
'Text
Range("B53").Select
ActiveCell = ""
Range("B54").Select
ActiveCell = ""
Range("B55").Select
ActiveCell = ""
Range("B56").Select
ActiveCell = ""
Range("B57").Select
ActiveCell = ""
Range("B58").Select
ActiveCell = ""
Range("B59").Select
ActiveCell = ""
Range("B60").Select
ActiveCell = ""
Range("B61").Select
ActiveCell = ""
Range("B62").Select
ActiveCell = ""
'Betrag
Range("H53").Select
ActiveCell = ""
Range("H54").Select
ActiveCell = ""
Range("H55").Select
ActiveCell = ""
Range("H56").Select
ActiveCell = ""
Range("H57").Select
ActiveCell = ""
Range("H58").Select
ActiveCell = ""
Range("H59").Select
ActiveCell = ""
Range("H60").Select
ActiveCell = ""
Range("H61").Select
ActiveCell = ""
Range("H62").Select
ActiveCell = ""
'Kurs
Range("K53").Select
ActiveCell = 1
Range("K54").Select
ActiveCell = 1
Range("K55").Select
ActiveCell = 1
Range("K56").Select
ActiveCell = 1
Range("K57").Select
ActiveCell = 1
Range("K58").Select
ActiveCell = 1
Range("K59").Select
ActiveCell = 1
Range("K60").Select
ActiveCell = 1
Range("K61").Select
ActiveCell = 1
Range("K62").Select
ActiveCell = 1

'Datum setzen
Range("A65").Select
ActiveCell = Date
GoTo nicht 'damit die nachfolgende Abfrage nicht ausgef|fffd|hrt wird

nicht2:
'Abfrage ob die Vorderseite nicht ganz gel|fffd|scht werden soll
Dim loeschen1 As Integer
loeschen1 = MsgBox("Sollen die Vorderseite bis auf 'Sonstige Aufwendungen' gel|fffd|scht und das Datum neu gesetzt werden?", vbYesNo, "L|fffd|schen der Vorderseite?")
If loeschen1 = 6 Then GoTo weiter1 Else: GoTo nicht1

weiter1:
ActiveWorkbook.Worksheets("Vorderseite").Select

'Reiseziehl
Range("K7").Select
ActiveCell = ""
'Kunde/Firma
Range("K8").Select
ActiveCell = ""
'Reisezweck
Range("K9").Select
ActiveCell = ""

'Maschinentyp / Ma-Nr / Auftragsnr
'entf|fffd|llt seit neuem Formular Jan. 2016
'Range("H10").Select
'ActiveCell = ""
'Range("W10").Select
'ActiveCell = ""
'Range("AK10").Select
'ActiveCell = ""

'Reisekostenvorschus / W|fffd|hrung / Kurs
Range("D11").Select
ActiveCell = ""
Range("K11").Select
ActiveCell = ""
Range("P11").Select
ActiveCell = 1

'Abfahrt in / am / Zeit
'Range("B18").Select
'ActiveCell = ""
Range("H18").Select
ActiveCell = ""
Range("O18").Select
ActiveCell = ""

'R|fffd|ckkehr in / am / Zeit
'Range("B19").Select
'ActiveCell = ""
Range("H19").Select
ActiveCell = ""
Range("O19").Select
ActiveCell = ""

'Fahrtausweis Bahn/Schiff Inland
Range("H22").Select
ActiveCell = ""

'Fahrtausweis Bahn/Schiff Ausland / Kurs
Range("H23").Select
ActiveCell = ""
Range("K23").Select
ActiveCell = 1
'Range("AI20").Select  /// W|fffd|hrung
'ActiveCell = ""

'Eigener PKW / |fffd|/KM /
Range("B25").Select
ActiveCell = ""
Range("D25").Select
ActiveCell = 0.3

'Eigener PKW ausland
'entf|fffd|llt seit neuem Formular Jan. 2016
'Range("H22").Select
'ActiveCell = ""
'Range("O22").Select
'ActiveCell = ""
'Range("AC22").Select
'ActiveCell = ""
'Range("AI22").Select
'ActiveCell = ""

'Verpflegungsaufwendung Deutschland
Range("F30").Select
ActiveCell = ""

Range("F31").Select
ActiveCell = ""

'Deutschland Fr|fffd|hst|fffd|ck / Mittag-Abendessen
Range("I30").Select
ActiveCell = ""

Range("I31").Select
ActiveCell = ""

Range("L30").Select
ActiveCell = ""

Range("L31").Select
ActiveCell = ""

'Christa Zeile wird nicht gebraucht
'Range("F32").Select
'ActiveCell = ""

'Verpflegungsaufwendung Ausland
Range("F34").Select
ActiveCell = ""

Range("F35").Select
ActiveCell = ""

Range("F36").Select
ActiveCell = ""

Range("F37").Select
ActiveCell = ""

'Ausland Fr|fffd|hst|fffd|ck / Mittag-Abendessen
Range("I34").Select
ActiveCell = ""

Range("I35").Select
ActiveCell = ""

Range("I36").Select
ActiveCell = ""

Range("I37").Select
ActiveCell = ""

Range("L34").Select
ActiveCell = ""

Range("L35").Select
ActiveCell = ""

Range("L36").Select
ActiveCell = ""

Range("L37").Select
ActiveCell = ""


'|fffd|bernachtungskosten/-pauschale Inland
'Betrag
Range("D43").Select
ActiveCell = ""
Range("D44").Select
ActiveCell = ""
Range("D45").Select
ActiveCell = ""
'Tage
Range("F43").Select
ActiveCell = ""
Range("F44").Select
ActiveCell = ""
Range("F45").Select
ActiveCell = ""

'|fffd|bernachtungskosten/-pauschale Inland
'Betrag
Range("D47").Select
ActiveCell = ""
Range("D48").Select
ActiveCell = ""
Range("D49").Select
ActiveCell = ""
'Tage
Range("F47").Select
ActiveCell = ""
Range("F48").Select
ActiveCell = ""
Range("F49").Select
ActiveCell = ""
'Kurs
Range("K47").Select
ActiveCell = 1
Range("K48").Select
ActiveCell = 1
Range("K49").Select
ActiveCell = 1

'Datum setzen
Range("A65").Select
ActiveCell = Date

nicht:
nicht1:
Blatt = "R|fffd|ckseite 1"   'f|fffd|r die unterschiedlichen R|fffd|ckseiten
zeile = 3   'Schreibzeile auf die dritte setzten
For zeilrueck = anfreihe + 1 To endreihe + 1
    spalte = 1      'Schreibspalte auf die erste setzten
    For spalrueck = 1 To 9
               Worksheets(Blatt).Cells(zeile, spalte).Value = rueck1(zeilrueck, spalrueck - 1)
               spalte = spalte + 1 'Schreibspalte um eins erh|fffd|hen
        Next
    Worksheets(Blatt).Cells(zeile, 12).Value = rueck1(zeilrueck, 10)
    zeile = zeile + 1   'Schreibzeile um eins erh|fffd|hen
    If zeile = 36 Then Blatt = "R|fffd|ckseite 2": zeile = 3
Next
ActiveWorkbook.Worksheets("Daten").Select
    

GoTo ende:
'ab hier nur noch Unterrotienen
'***************************************************

datumnichtgefunden: 'Meldung wenn ein Datum nicht gefunden werden konnte
MsgBox ("Bitte nochmal probieren, Datum konnte nicht gefunden werden!")
GoTo ende

datumfalsch:    'Fehler abfangen wenn keine Zahlen eingegeben wurden
    anfdatum = InputBox("Bitte Anfangsdatum nochmal eingeben, etwas war falsch:", _
            "Bitte Anfangsdatum eingeben")
    
    enddatum = InputBox("Bitte Enddatum nochmal eingeben, etwas war falsch:", _
            "Bitte Enddatum eingeben")

sucheenddatum:  'Enddatum suchen wenn mehrere Eintr|fffd|ge aber das Datum nicht dabei steht
    endreihe = zaehlen + suchen
    For suchen = 1 To 20 'die n|fffd|chsten 20 Zeilen nach gefundenem Enddatum werden untersucht
        'erstes if beenden wenn n|fffd|chstes Enddatum gr|fffd||fffd|er als das Suchdatum
        'zweites if beenden wenn keine weiteren Eintr|fffd|ge mehr vorhanden
        'drittes if weiter z|fffd|hlen wenn das Suchdatum mehrmals hintereinander kommt
        'viertes if weiter z|fffd|hlen wenn die n|fffd|chsten Eintr|fffd|ge noch zum Suchdatum geh|fffd|ren aber das Datum nicht eingetragen ist
        If ActiveCell.Offset(zaehlen + suchen, 0) > enddatum Then _
            GoTo endgefunden _
            Else: If ActiveCell.Offset(zaehlen + suchen, 0) = 0 & ActiveCell.Offset _
            (zaehlen + suchen, 1) = "" Then GoTo endgefunden _
            Else: If ActiveCell.Offset(zaehlen + suchen, 0) = enddatum Then endreihe _
            = zaehlen + suchen _
            Else: If ActiveCell.Offset(zaehlen + suchen, 0) = "" Then _
               If ActiveCell.Offset(zaehlen + suchen, 1) > 0 Then endreihe = zaehlen + suchen
    Next
    GoTo endgefunden
    
zuviel: 'Meldung das zu viele Eintr|fffd|ge ausgew|fffd|hlt wurden
MsgBox ("Bei Ihrer Auswahl w|fffd|rden mehr als zwei Seiten ben|fffd|tigt!!") & Chr(13) & _
("Bitte versuchen sie es nochmal!")
GoTo ende:


Fehler: 'Programmfehler
'MsgBox ("Es ist ein Programmfehler aufgetreten!")
MsgBox (Error(Err))

ende:
Sheets("R|fffd|ckseite 1").Activate
'Automatische Berechnung ein
With Application
        .Calculation = xlAutomatic
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False
Application.Calculate
End Sub

Public Sub Speichern_Abrechnungen()
Dim lw As String, pfad As String, datei As String
Dim jahr As Integer
Dim lw_pfad As String
Dim tabname As String
Dim blattname As String 'f|fffd|r das kontrollieren ob das Tabellenblatt
                        'schon in der Speicherdatei vorhanden ist
'pr|fffd|fen ob Datei schon vorhanden ansonsten neue |fffd|ffnen
        
Application.Calculate

'Name des Tabellenblattes definieren, zur Pr|fffd|fung ob es vorhanden ist
blattname = "KW_" & Worksheets("R|fffd|ckseite 1").Cells(1, 7).Value & "_" & Worksheets("R|fffd|ckseite 2").Cells(1, 7).Value

'Laufwerk und Pfad ermitteln
lw = Left(ActiveWorkbook.Path, 1)
pfad = ActiveWorkbook.Path

'wechselt auf das Ursprungslaufwerk
ChDrive lw
'wechselt in das Ursprungsverzeichnis
ChDir pfad
'Dateinamen zuweisen
datei = "Abrechnungen_" & Worksheets("Einstellungen").Cells(4, 1).Value

        'pr|fffd|fen ob Datei schon offen
Dim x As Object
For Each x In Workbooks
If x.name = datei & ".xls" Then GoTo offen
Next
'Datei |fffd|ffnen oder Sprung zum erstellen der neuen Datei
        If Dir(pfad & "\" & datei & ".xls") = "" Then GoTo neuedatei1
        Workbooks.Open Filename:=datei
offen:

'Blatt schon vorhanden
Dim ws As Object
For Each ws In Worksheets
If ws.name = blattname Then GoTo vorhanden
Next

kopieren:
'Daten kopieren und einf|fffd|gen
        'Vorderseite kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Vorderseite").Activate
        Range("A1:Q72").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets.Add after:=Sheets(1)
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        'Spaltenbreite festlegen
        tabname = ActiveSheet.name
        Worksheets(tabname).Columns("A").ColumnWidth = 11.9
        Worksheets(tabname).Columns("B").ColumnWidth = 8.56
        Worksheets(tabname).Columns("C").ColumnWidth = 9.67
        Worksheets(tabname).Columns("D").ColumnWidth = 12.9
        Worksheets(tabname).Columns("E").ColumnWidth = 4.78
        Worksheets(tabname).Columns("F").ColumnWidth = 4.89
        Worksheets(tabname).Columns("G").ColumnWidth = 9.67
        Worksheets(tabname).Columns("H").ColumnWidth = 7.11
        Worksheets(tabname).Columns("I").ColumnWidth = 5.89
        Worksheets(tabname).Columns("J").ColumnWidth = 1.11
        Worksheets(tabname).Columns("K").ColumnWidth = 7.11
        Worksheets(tabname).Columns("L").ColumnWidth = 5.78
        Worksheets(tabname).Columns("M").ColumnWidth = 1.67
        Worksheets(tabname).Columns("N").ColumnWidth = 13.8
        Worksheets(tabname).Columns("O").ColumnWidth = 3.33
        Worksheets(tabname).Columns("P").ColumnWidth = 9.89
        Worksheets(tabname).Columns("Q").ColumnWidth = 1.89
        Worksheets(tabname).Columns("S:AZ").ColumnWidth = 0.5
        
        
        'R|fffd|ckseite 1 kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("R|fffd|ckseite 1").Activate
        Range("A1:I39").Copy
        Workbooks(datei & ".xls").Activate
'Worksheets.Add after:=Sheets(1)
        Range("BB1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        'Spaltenbreite anpassen
        tabname = ActiveSheet.name
        With Worksheets(tabname)
            .Columns("BB").ColumnWidth = 8.11
            .Columns("BC").ColumnWidth = 5.89
            .Columns("BD").ColumnWidth = 5.89
            .Columns("BE").ColumnWidth = 26.7
            .Columns("BF").ColumnWidth = 14.8
            .Columns("BG").ColumnWidth = 12.7
            .Columns("BH").ColumnWidth = 5.89
            .Columns("BI").ColumnWidth = 6.56
            .Columns("BJ").ColumnWidth = 6.78
        End With
        
        'R|fffd|ckseite 2 kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("R|fffd|ckseite 2").Activate
        Range("A1:I39").Copy
        Workbooks(datei & ".xls").Activate
'Worksheets.Add after:=Sheets(1)
        Range("BL1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        'Spaltenbreite anpassen
        tabname = ActiveSheet.name
        With Worksheets(tabname)
            .Columns("BL").ColumnWidth = 8.11
            .Columns("BM").ColumnWidth = 5.89
            .Columns("BN").ColumnWidth = 5.89
            .Columns("BO").ColumnWidth = 26.7
            .Columns("BP").ColumnWidth = 14.8
            .Columns("BQ").ColumnWidth = 12.7
            .Columns("BR").ColumnWidth = 5.89
            .Columns("BS").ColumnWidth = 6.56
            .Columns("BT").ColumnWidth = 6.78
        End With
'Tabellenblatt umbenennen in Kalenderwoche
Dim name As String
    name = "KW_" & ActiveSheet.Cells(1, 60).Value
    name = name & "_" & ActiveSheet.Cells(1, 70).Value
    ActiveWorkbook.Sheets(2).name = name
    
schliessen:
'Datei speichern und schlie|fffd|en
    Application.DisplayAlerts = False
    ActiveWorkbook.Close savechanges:=True
    Application.DisplayAlerts = True
GoTo ende
    
'ab hier Unterrotinen
'**************************************************************************
neuedatei1:
Workbooks.Add (xlWBATWorksheet)
ChDrive lw
ChDir pfad
ActiveWorkbook.SaveAs Filename:=datei & ".xls"
GoTo kopieren

vorhanden:
MsgBox ("Abrechnungsblatt  " & blattname & "  schon vorhanden!!" & Chr(13) & Chr(10) & Chr(13) _
        & Chr(10) & "Bitte Datei " & datei & ".xls |fffd|ffnen und das Tabellenblatt l|fffd|schen " _
        & "oder umbenennen.")
GoTo schliessen

ende:
Sheets("R|fffd|ckseite 1").Activate
End Sub

Public Sub Drucken()


'Abrechnungsbetrag und Kalenderwoche nach "|fffd|berweisung" kopieren
'Anzahl der Eintr|fffd|ge ermitteln
Dim zeilen As Long
zeilen = Worksheets("|fffd|berweisungen").Cells(Rows.Count, 1).End(xlUp).Row
If zeilen = 100 Then MsgBox ("|fffd|berweisungsliste ist voll!" & Chr(13) & _
                            "Bitte im Tabellenblatt '|fffd|berweisung' zuerst die Eintr|fffd|ge l|fffd|schen!"): Exit Sub
'eine zeile dazuz|fffd|hlen
zeilen = zeilen + 1

'Werte aus Abrechnung hollen
Dim betrag As Double
Dim kalenderwo As String
    'if deshalb weil wenn Betragszelle leer ist ein fehler gekommen ist
    If Worksheets("Vorderseite").Cells(66, 14).Value = "" Then
    betrag = 0
    Else
    betrag = Worksheets("Vorderseite").Cells(66, 14).Value
    End If
kalenderwo = Worksheets("R|fffd|ckseite 1").Cells(1, 7).Value

'schreiben in |fffd|berweisungen
Worksheets("|fffd|berweisungen").Cells(zeilen, 1).Value = "KW " & kalenderwo
Worksheets("|fffd|berweisungen").Cells(zeilen, 2).Value = betrag
'****************************************************************************

Dim vorder As Integer, r1 As Integer, r2 As Integer, r3 As Integer

Application.Calculate

r3 = Application.Dialogs(xlDialogPrinterSetup).Show
If r3 = 0 Then GoTo ende
vorder = MsgBox("Soll die Vorderseite gedruckt werden?", vbYesNo, "Drucken der Abrechnung")
If vorder = 6 Then ActiveWorkbook.Worksheets("Vorderseite").PrintOut

r1 = MsgBox("Soll die R|fffd|ckseite 1 gedruckt werden?", vbYesNo, "Drucken der Abrechnung")
If r1 = 6 Then ActiveWorkbook.Worksheets("R|fffd|ckseite 1").PrintOut

If Not Worksheets("R|fffd|ckseite 2").Cells(3, 2).Value > "" Then GoTo ende

r2 = MsgBox("Soll die R|fffd|ckseite 2 gedruckt werden?", vbYesNo, "Drucken der Abrechnung")
If r2 = 6 Then ActiveWorkbook.Worksheets("R|fffd|ckseite 2").PrintOut

ende:
'Wenn gew|fffd|nscht gleich Abrechnung speichern
If Worksheets("Einstellungen").Cells(12, 7).Value = 1 Then Call Speichern_Abrechnungen
End Sub


Public Sub Monat_speichern()

'Daten kopieren und einf|fffd|gen
        'Vorderseite kopieren
        ActiveWorkbook.Worksheets("|fffd|berstd.").Activate
        Range("A8:J50").Copy
        Select Case Month(Worksheets("|fffd|berstd.").Cells(5, 3).Value)
            Case "1"
            ActiveWorkbook.Worksheets("Jan.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "2"
            ActiveWorkbook.Worksheets("Feb.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "3"
            ActiveWorkbook.Worksheets("M|fffd|rz").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "4"
            ActiveWorkbook.Worksheets("April").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "5"
            ActiveWorkbook.Worksheets("Mai").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "6"
            ActiveWorkbook.Worksheets("Juni").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "7"
            ActiveWorkbook.Worksheets("Juli").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "8"
            ActiveWorkbook.Worksheets("Aug.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "9"
            ActiveWorkbook.Worksheets("Sept.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "10"
            ActiveWorkbook.Worksheets("Okt.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "11"
            ActiveWorkbook.Worksheets("Nov.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "12"
            ActiveWorkbook.Worksheets("Dez.").Activate: Range("A11").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
        End Select
        
        'vom Konto kopieren
        ActiveWorkbook.Worksheets("|fffd|berstd.").Activate
        Range("S9:S50").Copy
        Select Case Month(Worksheets("|fffd|berstd.").Cells(5, 3).Value)
            Case "1"
            ActiveWorkbook.Worksheets("Jan.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "2"
            ActiveWorkbook.Worksheets("Feb.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "3"
            ActiveWorkbook.Worksheets("M|fffd|rz").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "4"
            ActiveWorkbook.Worksheets("April").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "5"
            ActiveWorkbook.Worksheets("Mai").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "6"
            ActiveWorkbook.Worksheets("Juni").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "7"
            ActiveWorkbook.Worksheets("Juli").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "8"
            ActiveWorkbook.Worksheets("Aug.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "9"
            ActiveWorkbook.Worksheets("Sept.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "10"
            ActiveWorkbook.Worksheets("Okt.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "11"
            ActiveWorkbook.Worksheets("Nov.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
            Case "12"
            ActiveWorkbook.Worksheets("Dez.").Activate: Range("S12").Select: Selection.PasteSpecial Paste:=xlValues: Selection.PasteSpecial Paste:=xlPasteFormats: Application.CutCopyMode = False
        End Select
        
        
        
Range("A1").Select

End Sub

Public Sub Monat_berechnen()
Application.ScreenUpdating = False
ActiveWorkbook.Worksheets("Daten").Activate
Worksheets("|fffd|berstd.").EnableCalculation = True
Application.Calculate
ActiveWorkbook.Worksheets("|fffd|berstd.").Activate
Application.ScreenUpdating = True
End Sub


Public Sub EingebeFormular()
Dim form As Variant
Dim letzte As Object
form = UserForm2
Range("B65536").End(xlUp).Offset(1, -1).Select 'sucht letzte freie Zeile in Spalte B
With UserForm2
    .TextBox1.Value = ActiveCell.Offset(-1, 0).Value 'Datum
    .TextBox2.Value = Format(ActiveCell.Offset(-1, 1).Value, "hh:mm") 'Zeit von
    .TextBox3.Value = Format(ActiveCell.Offset(-1, 2).Value, "hh:mm") 'Zeit bis
    .TextBox4.Value = ActiveCell.Offset(-1, 3).Value 'Kunde
    .TextBox5.Value = ActiveCell.Offset(-1, 4).Value 'Ort / Land
    .TextBox8.Value = ActiveCell.Offset(-1, 5).Value 'Maschinennummer
    .TextBox9.Value = ActiveCell.Offset(-1, 6).Value 'PKW KM
    .TextBox6.Value = ActiveCell.Offset(-1, 7).Value 'Pause
    .TextBox7.Value = ActiveCell.Offset(-1, 8).Value 'Spesen
    .TextBox12.Value = ActiveCell.Offset(-1, 10).Value 'L|fffd|nderk|fffd|rzel
End With
UserForm2.TextBox1.SetFocus
UserForm2.TextBox1.SelStart = 2
UserForm2.Show
End Sub

Public Sub Spesen_in_Vorderseite()

'********************Abfahrts u. R|fffd|ckkunftsdatum und Zeit in Vorderseite schreiben***************

Dim g As Integer                                    'Z|fffd|hler f|fffd|r Schleife Zeit u. Datumeintrag Vorderseite

For g = 3 To 35
    If Sheets("R|fffd|ckseite 1").Cells(g, 9).Value = "" Then GoTo weiter3333   'wenn keine Spesen eingetragen
    If Sheets("R|fffd|ckseite 1").Cells(g, 6).Value = "" Then GoTo weiter3333   'wenn keine Ma-Nr eingetragen
    If Sheets("R|fffd|ckseite 1").Cells(g, 2).Value = "" Then GoTo weiter3333   'wenn keine Zeit von eingetragen
    
    'Datum u. Zeit in Vorderseite
    Sheets("Vorderseite").Cells(18, 8).Value = Sheets("R|fffd|ckseite 1").Cells(g, 1).Value 'Datum
    Sheets("Vorderseite").Cells(18, 15).Value = Sheets("R|fffd|ckseite 1").Cells(g, 2).Value 'Zeit
    GoTo datumende
    
weiter3333:
Next

datumende:
'R|fffd|ckseite2 zuerst abfragen
For g = 35 To 3 Step -1
    If Sheets("R|fffd|ckseite 2").Cells(g, 9).Value = "" Then GoTo weiter3335   'wenn keine Spesen eingetragen
    If Sheets("R|fffd|ckseite 2").Cells(g, 6).Value = "" Then GoTo weiter3335   'wenn keine Ma-Nr eingetragen
    If Sheets("R|fffd|ckseite 2").Cells(g, 3).Value = "" Then GoTo weiter3335   'wenn keine Zeit von eingetragen
    
    'Datum u. Zeit in Vorderseite
    Sheets("Vorderseite").Cells(19, 8).Value = Sheets("R|fffd|ckseite 2").Cells(g, 1).Value 'Datum
    Sheets("Vorderseite").Cells(19, 15).Value = Sheets("R|fffd|ckseite 2").Cells(g, 3).Value 'Zeit
    GoTo ende3336
    
weiter3335:
Next

'R|fffd|ckseite1
For g = 35 To 3 Step -1
    If Sheets("R|fffd|ckseite 1").Cells(g, 9).Value = "" Then GoTo weiter3334   'wenn keine Spesen eingetragen
    If Sheets("R|fffd|ckseite 1").Cells(g, 6).Value = "" Then GoTo weiter3334   'wenn keine Ma-Nr eingetragen
    If Sheets("R|fffd|ckseite 1").Cells(g, 3).Value = "" Then GoTo weiter3334   'wenn keine Zeit von eingetragen
    
    'Datum u. Zeit in Vorderseite
    Sheets("Vorderseite").Cells(19, 8).Value = Sheets("R|fffd|ckseite 1").Cells(g, 1).Value 'Datum
    Sheets("Vorderseite").Cells(19, 15).Value = Sheets("R|fffd|ckseite 1").Cells(g, 3).Value 'Zeit
    GoTo ende3336
    
weiter3334:
Next

ende3336:



'**************Ende Abfahrts u. R|fffd|ckkunftsdatum in Vorderseite***************

'**************|fffd|berpr|fffd|fen ob Spesen zu L|fffd|nderkennung passen

'zum |fffd|berpr|fffd|fen ob die L|fffd|nderkennung mit dem Spesensatz |fffd|bereinstimmt


'R|fffd|ckseite1 |fffd|berpr|fffd|fen
Dim k As Integer                                    'Z|fffd|hler f|fffd|r Schleife
Dim such1 As Range                                   'Variable zum suchen der Spesen in Spesen_Pauschalen
Dim spes, spes1, spes2, spes3 As Integer            'f|fffd|r speichern der Spesen
Dim laenderken As String                            'speichern der L|fffd|nderkennung
Dim meldung, meldetxt As String                     'f|fffd|r Fehlermeldung

For k = 3 To 35
    If Sheets("R|fffd|ckseite 1").Cells(k, 9).Value = "" Then GoTo weiter1111   'wenn keine Spesen eingetragen
    'L|fffd|nderkennung und Spesen hollen
    laenderken = Sheets("R|fffd|ckseite 1").Cells(k, 12).Value
    spes = Sheets("R|fffd|ckseite 1").Cells(k, 9).Value
    'suchen der Spesens|fffd|tze
   
'Meldung ausgeben wenn zwar Spesen eingetragen aber keine L|fffd|nderkennung
If laenderken = "" Then
        meldetxt = "Achtung:" & Chr(13) & "Auf R|fffd|ckseite 1 sind in" & Chr(13) & "Zeile " & k & Chr(13) _
        & "zwar Spesen von " & spes & "|fffd|" & Chr(13) & "eingetragen, aber keine L|fffd|nderkennung eingetragen!!"
        meldung = MsgBox(meldetxt, vbOKOnly, "KEIN L|fffd|NDERK|fffd|RZEL od. Spesen")
        GoTo ende
End If
    
Set such1 = Sheets("Spesen_Pauschalen").Range("F3:F" & Sheets("Einstellungen").Cells(36, 5).Value).Find(what:=laenderken, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
spes1 = such1.Offset(0, -2)
spes2 = such1.Offset(0, -3)
spes3 = such1.Offset(0, -4)
    
    
    
    
    
    
    
    'vergleich eingetragene Spesen zu L|fffd|nderkennung
    If spes1 = spes Then GoTo weiter1111
    If spes2 = spes Then GoTo weiter1111
    If spes3 = spes Then
        GoTo weiter1111
        Else
        meldetxt = "Achtung:" & Chr(13) & "Auf R|fffd|ckseite 1 stimmt" & Chr(13) & "in Zeile " & k & Chr(13) _
        & "der Spesensatz " & spes & Chr(13) & "nich mit der L|fffd|nderkennung " & laenderken & Chr(13) & "|fffd|berein!!"
        meldung = MsgBox(meldetxt, vbOKOnly, "FALSCHES L|fffd|NDERK|fffd|RZEL od. Spesen")
        GoTo ende
    End If
weiter1111:
Next


For k = 3 To 35
    If Sheets("R|fffd|ckseite 2").Cells(k, 9).Value = "" Then GoTo weiter1112   'wenn keine Spesen eingetragen
    'L|fffd|nderkennung und Spesen hollen
    laenderken = Sheets("R|fffd|ckseite 2").Cells(k, 12).Value
    spes = Sheets("R|fffd|ckseite 2").Cells(k, 9).Value
    'suchen der Spesens|fffd|tze
   
'Meldung ausgeben wenn zwar Spesen eingetragen aber keine L|fffd|nderkennung
If laenderken = "" Then
        meldetxt = "Achtung:" & Chr(13) & "Auf R|fffd|ckseite 2 sind in" & Chr(13) & "Zeile " & k & Chr(13) _
        & "zwar Spesen von " & spes & "|fffd|" & Chr(13) & "eingetragen, aber keine L|fffd|nderkennung eingetragen !!"
        meldung = MsgBox(meldetxt, vbOKOnly, "KEIN L|fffd|NDERK|fffd|RZEL od. Spesen")
        GoTo ende
End If
    
    
Set such1 = Sheets("Spesen_Pauschalen").Range("F3:F" & Sheets("Einstellungen").Cells(36, 5).Value).Find(what:=laenderken, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
spes1 = such1.Offset(0, -2)
spes2 = such1.Offset(0, -3)
spes3 = such1.Offset(0, -4)
    
    
    
    
    
    
    
    'vergleich eingetragene Spesen zu L|fffd|nderkennung
    If spes1 = spes Then GoTo weiter1112
    If spes2 = spes Then GoTo weiter1112
    If spes3 = spes Then
        GoTo weiter1112
        Else
        meldetxt = "Achtung:" & Chr(13) & "Auf R|fffd|ckseite 2 stimmt" & Chr(13) & "in Zeile " & k & Chr(13) _
        & "der Spesensatz " & spes & Chr(13) & "nich mit der L|fffd|nderkennung " & laenderken & Chr(13) & "|fffd|berein!!"
        meldung = MsgBox(meldetxt, vbOKOnly, "FALSCHES L|fffd|NDERK|fffd|RZEL od. Spesen")
        GoTo ende
    End If
weiter1112:
Next




'*************Ende |fffd|berpr|fffd|fung Spesen L|fffd|nderkennung


'Makro zum |fffd|bertragen der Spesens|fffd|tze von der R|fffd|ckseite in die Vorderseite
Dim seite1(32), seite2(32) As Variant 'f|fffd|r die L|fffd|nderk|fffd|rzel f|fffd|r Seite 1 bzw. Seite 2
Dim spesen1(32), spesen2(32) As Integer 'f|fffd|r die Spesen f|fffd|r Seite 1 bzw. Seite 2
Dim z As Variant 'f|fffd|r Zuweisung der Landerk|fffd|rzel und Spesen in die Variable seite1 bzw. seite2
Dim y As Integer 'zum z|fffd|hlen f|fffd|r die Zuweisung der Landerk|fffd|rzel und Spesen
Dim de1, de2, de3 As Integer 'Spesen f|fffd|r Deutschlnad
Dim ausland1, ausland2 As String 'f|fffd|r L|fffd|nderk|fffd|rzel
Dim auslandlang1, auslandlang2 As String 'f|fffd|r Lang ausgeschrieben
Dim such As Range 'Variable f|fffd|r das suchen der Spesen
Dim aus1sp1, aus1sp2, aus1sp3, aus2sp1, aus2sp2, aus2sp3 As Integer 'Variablen f|fffd|r die Auslandspesen
Dim de1za, de2za, de3za, aus1za1, aus1za2, aus1za3, aus2za1, aus2za2, aus2za3 As Integer 'Z|fffd|hler wie oft die Spesen vorkommen
Dim x As Integer ' Z|fffd|hler f|fffd|r die Zuweisung wie oft welche Spesen vorkommen

'Fehler abfangen
On Error GoTo Fehler

'L|fffd|nderk|fffd|rzel der Variablen zuweisen
'R|fffd|ckseite 1
y = 0
For Each z In Sheets("R|fffd|ckseite 1").Range("L3:L35")
        seite1(y) = z.Value 'L|fffd|nderk|fffd|rzel zuweisen
        spesen1(y) = z.Offset(0, -3).Value 'Spesen zuweisen
        y = y + 1
Next z
'R|fffd|ckseite 2
y = 0
For Each z In Sheets("R|fffd|ckseite 2").Range("L3:L35")
        seite2(y) = z.Value 'L|fffd|nderk|fffd|rzel zuweisen
        spesen2(y) = z.Offset(0, -3).Value 'Spesen zuweisen
        y = y + 1
Next z

'L|fffd|nder ermitteln und Spesen zu weisen

'R|fffd|ckseite 1
For y = 0 To 32
If de1 > 0 Then GoTo weiter1 'wenn schon DE gefunden nicht mehr weitersuchen
    If seite1(y) = "DE" Then de1 = Sheets("Einstellungen").Cells(35, 1).Value: _
        de2 = Sheets("Einstellungen").Cells(35, 2).Value: _
        de3 = Sheets("Einstellungen").Cells(35, 3).Value
weiter1:
    If Not (ausland1 = "") Then GoTo weiter2 'weiter machen wenn Ausland1 schon gefunden
    If Not (seite1(y) = "DE" Or seite1(y) = "") Then ausland1 = seite1(y)
weiter2:
    If Not (seite1(y) = "DE" Or seite1(y) = "" Or seite1(y) = ausland1) Then ausland2 = seite1(y)
If ausland1 > "" And ausland2 > "" Then de1 = Sheets("Einstellungen").Cells(35, 1).Value: _
        de2 = Sheets("Einstellungen").Cells(35, 2).Value: _
        de3 = Sheets("Einstellungen").Cells(35, 3).Value: _
        GoTo weiter3 'weiter machen wenn ausland1 und ausland2 schon gefunden, Deutschlandspesen mit dazu, wenn erste Seite keine DE vorhanden aber auf zweiter wurde je Spesensatz ein Wert gesetzt
Next

'R|fffd|ckseite 2
For y = 0 To 32
If de1 > 0 Then GoTo weiter111 'wenn schon DE gefunden nicht mehr weitersuchen
    If seite2(y) = "DE" Then de1 = Sheets("Einstellungen").Cells(35, 1).Value: _
        de2 = Sheets("Einstellungen").Cells(35, 2).Value: _
        de3 = Sheets("Einstellungen").Cells(35, 3).Value
weiter111:
    If Not (ausland1 = "") Then GoTo weiter112 'weiter machen wenn Ausland1 schon gefunden
    If Not (seite2(y) = "DE" Or seite2(y) = "") Then ausland1 = seite2(y)
weiter112:
    If Not (seite2(y) = "DE" Or seite2(y) = "" Or seite2(y) = ausland1) Then ausland2 = seite2(y)
If ausland1 > "" And ausland2 > "" Then GoTo weiter3 'weiter machen wenn ausland1 und ausland2 schon gefunden

Next
        
weiter3:

'GrundSpesen f|fffd|r ausland1 und Landesname zuweisen
If ausland1 = "" Then GoTo keins1 'abfangen wenn es kein Ausland1 gibt
Set such = Sheets("Spesen_Pauschalen").Range("F3:F" & Sheets("Einstellungen").Cells(36, 5).Value).Find(what:=ausland1, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
aus1sp1 = such.Offset(0, -2)
aus1sp2 = such.Offset(0, -3)
aus1sp3 = such.Offset(0, -4)
auslandlang1 = such.Offset(0, -5)
keins1:

'GrundSpesen f|fffd|r ausland2 zuweisen
If ausland2 = "" Then GoTo keins2 'abfangen wenn es kein Ausland2 gibt
Set such = Sheets("Spesen_Pauschalen").Range("F3:F" & Sheets("Einstellungen").Cells(36, 5).Value).Find(what:=ausland2, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
aus2sp1 = such.Offset(0, -2)
aus2sp2 = such.Offset(0, -3)
aus2sp3 = such.Offset(0, -4)
auslandlang2 = such.Offset(0, -5)

keins2:
'feststellen wie oft die jeweiligen Spesen vorkommen

Dim spesende1, spesende2, spesende3, spesen1aus1, spesen2aus1, spesen3aus1 As Integer
Dim spesen1aus2, spesen2aus2, spesen3aus2 As Integer

'oben Variablen f|fffd|r das zusammen z|fffd|hlen wie oft die Spesen vorkommen
For x = 0 To 32
    'z|fffd|hlen Deutschespesen R|fffd|ckseite 1
    If seite1(x) = "DE" And spesen1(x) = de1 Then spesende1 = spesende1 + 1
    If seite1(x) = "DE" And spesen1(x) = de2 Then spesende2 = spesende2 + 1
    If seite1(x) = "DE" And spesen1(x) = de3 Then spesende3 = spesende3 + 1
    'z|fffd|hlen Deutschespesen R|fffd|ckseite 2
    If seite2(x) = "DE" And spesen2(x) = de1 Then spesende1 = spesende1 + 1
    If seite2(x) = "DE" And spesen2(x) = de2 Then spesende2 = spesende2 + 1
    If seite2(x) = "DE" And spesen2(x) = de3 Then spesende3 = spesende3 + 1
    'z|fffd|hlen Auslandspesen1 R|fffd|ckseite 1
    If ausland1 = "" Then GoTo weiter10 'abfangen wenn es kein Ausland1 gibt
    If seite1(x) = ausland1 And spesen1(x) = aus1sp1 Then spesen1aus1 = spesen1aus1 + 1
    If seite1(x) = ausland1 And spesen1(x) = aus1sp2 Then spesen2aus1 = spesen2aus1 + 1
    If seite1(x) = ausland1 And spesen1(x) = aus1sp3 Then spesen3aus1 = spesen3aus1 + 1
    'z|fffd|hlen Auslandspesen1 R|fffd|ckseite 2
    If seite2(x) = ausland1 And spesen2(x) = aus1sp1 Then spesen1aus1 = spesen1aus1 + 1
    If seite2(x) = ausland1 And spesen2(x) = aus1sp2 Then spesen2aus1 = spesen2aus1 + 1
    If seite2(x) = ausland1 And spesen2(x) = aus1sp3 Then spesen3aus1 = spesen3aus1 + 1
weiter10:
    'z|fffd|hlen Auslandspesen2 R|fffd|ckseite 1
    If ausland2 = "" Then GoTo weiter11 'abfangen wenn es kein Ausland2 gibt
    If seite1(x) = ausland2 And spesen1(x) = aus2sp1 Then spesen1aus2 = spesen1aus2 + 1
    If seite1(x) = ausland2 And spesen1(x) = aus2sp2 Then spesen2aus2 = spesen2aus2 + 1
    If seite1(x) = ausland2 And spesen1(x) = aus2sp3 Then spesen3aus2 = spesen3aus2 + 1
    'z|fffd|hlen Auslandspesen2 R|fffd|ckseite 2
    If seite2(x) = ausland2 And spesen2(x) = aus2sp1 Then spesen1aus2 = spesen1aus2 + 1
    If seite2(x) = ausland2 And spesen2(x) = aus2sp2 Then spesen2aus2 = spesen2aus2 + 1
    If seite2(x) = ausland2 And spesen2(x) = aus2sp3 Then spesen3aus2 = spesen3aus2 + 1
    
weiter11:
Next x

'Spesen in die Vorderseite eintragen
'Deutschland
'Sheets("Vorderseite").Cells(24, 21).Value = spesende1  'diesen Satz gibt es nicht mehr
Sheets("Vorderseite").Cells(30, 6).Value = spesende2
Sheets("Vorderseite").Cells(31, 6).Value = spesende3
'Ausland1 (if gebraucht weil sonst die 3ten Spesen 0 eingetragen wird????
'If spesen1aus1 > 0 Then Sheets("Vorderseite").Cells(27, 21).Value = spesen1aus1
If spesen2aus1 > 0 Then Sheets("Vorderseite").Cells(34, 6).Value = spesen2aus1
If spesen3aus1 > 0 Then Sheets("Vorderseite").Cells(35, 6).Value = spesen3aus1
'Ausland1
'If spesen1aus2 > 0 Then Sheets("Vorderseite").Cells(27, 24).Value = spesen1aus2
If spesen2aus2 > 0 Then Sheets("Vorderseite").Cells(36, 6).Value = spesen2aus2
If spesen3aus2 > 0 Then Sheets("Vorderseite").Cells(37, 6).Value = spesen3aus2

'L|fffd|ndername in Vorderseite eintragen
Sheets("Vorderseite").Cells(35, 18).Value = auslandlang1
Sheets("Vorderseite").Cells(37, 18).Value = auslandlang2
'Christa |fffd|nderungen
'###############################################################################
GoTo ende

Fehler:
Dim fehl As String
fehl = MsgBox("Achtung: Vermutlich ist ein L|fffd|nderk|fffd|rzel ist falsch!!", vbOKOnly, "FALSCHES L|fffd|NDERK|fffd|RZEL")

ende:

End Sub


Public Sub Datensichern()

      
Dim lw As String, pfad As String, datei As String
Dim jahr As Integer
Dim lw_pfad As String
Dim tabname As String 'Variable zum erstellen der n|fffd|tigen Tabellenbl|fffd|tter
'Bitte warten anzeigen
UserForm4.Show vbModeless 'vbModeless bewirkt das das Makro im Hintergrund weiter l|fffd|uft
DoEvents 'bewirkt das nicht nur die Kopfzeile angezeigt wird
Application.ScreenUpdating = False
'pr|fffd|fen ob Datei schon vorhanden ansonsten neue |fffd|ffnen


'Laufwerk und Pfad ermitteln
lw = Left(ActiveWorkbook.Path, 1)
pfad = ActiveWorkbook.Path

'wechselt auf das Ursprungslaufwerk
ChDrive lw
'wechselt in das Ursprungsverzeichnis
ChDir pfad

'pr|fffd|fen ob Abrechnung_|fffd|berstunden schon offen
Dim x As Object
For Each x In Workbooks
If x.name = "Abrechnung_|fffd|berstunden.xls" Then GoTo geoeffnet
Next
Workbooks.Open Filename:="Abrechnung_|fffd|berstunden.xls"

geoeffnet:

'Dateinamen zuweisen
Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
datei = "Datensicherung_" & Worksheets("Einstellungen").Cells(4, 1).Value

        'pr|fffd|fen ob Datei schon offen
Dim y As Object
For Each y In Workbooks
If y.name = datei & ".xls" Then GoTo offen
Next
'Datei |fffd|ffnen oder Sprung zum erstellen der neuen Datei
        If Dir(pfad & "\" & datei & ".xls") = "" Then GoTo neuedatei1
        Workbooks.Open Filename:=datei
offen:
'************************************************************************************
'************************************************************************************
kopieren:
'pr|fffd|fen ob das Tabellenblatt schon gibt, wenn nicht dann erstellen
Dim u As Object
For Each u In Sheets
If u.name = "Termine" Then GoTo terminda
Next
Worksheets.Add after:=Sheets(1)
tabname = "Termine"
ActiveSheet.name = tabname

terminda:
'Daten kopieren und einf|fffd|gen
        'Vorderseite Namen u. Personalnr. kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Vorderseite").Select
        Range("C7:C8").Copy
        Workbooks(datei & ".xls").Activate
'Pr|fffd|fen ob Vorderseite schon existiert
    Dim Blatt As Object
    For Each Blatt In ActiveWorkbook.Sheets ' Namen aller Tabellen pr|fffd|fen
        If Blatt.name = "Vorderseite" Then GoTo weiter4
    Next Blatt
    'Vorderseite neu anlegen
    Worksheets.Add after:=Sheets(1)
    tabname = "Vorderseite"
    ActiveSheet.name = tabname

        
weiter4:
        
  'Pr|fffd|fen ob |fffd|berweisung schon existiert
    Dim ueberweisung As Object
    For Each ueberweisung In ActiveWorkbook.Sheets ' Namen aller Tabellen pr|fffd|fen
        If ueberweisung.name = "|fffd|berweisungen" Then GoTo weiter5
    Next ueberweisung
    'Vorderseite neu anlegen
    Worksheets.Add after:=Sheets(1)
    tabname = "|fffd|berweisungen"
    ActiveSheet.name = tabname
        
weiter5:

        Worksheets("Vorderseite").Select
        Range("C7").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Selection.PasteSpecial Paste:=xlComments
        Application.CutCopyMode = False
        
        'Daten kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Daten").Select
        Range("A1:AA5000").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Daten").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Selection.PasteSpecial Paste:=xlComments
        Application.CutCopyMode = False
        
        'raus genommen da nicht mehr ben|fffd|tigt, Einf|fffd|hrng Gleitzeitkonto
        '|fffd|berstd. kopieren
        'Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        'ActiveWorkbook.Worksheets("|fffd|berstd.").Select
        'Range("S8").Copy
        'Workbooks(datei & ".xls").Activate
        'Worksheets("|fffd|berstd.").Select
        'Range("S8").Select
        'Selection.PasteSpecial Paste:=xlValues
        'Selection.PasteSpecial Paste:=xlPasteFormats
        'Selection.PasteSpecial Paste:=xlFormulas
        'Application.CutCopyMode = False
        
        
        'Einstellungen kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Einstellungen").Select
        Range("A1:I50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Einstellungen").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
                
               
        'Januar kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Jan.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Jan.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Jan.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
    
        
        'Februar kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Feb.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Feb.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Feb.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'M|fffd|rz kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("M|fffd|rz").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("M|fffd|rz").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("M|fffd|rz").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'April kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("April").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("April").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("April").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'Mai kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Mai").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Mai").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Mai").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'Juni kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Juni").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Juni").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Juni").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'Juli kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Juli").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Juli").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Juli").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'August kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Aug.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Aug.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Aug.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'September kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Sept.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Sept.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Sept.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'Oktober kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Okt.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Okt.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Okt.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'November kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Nov.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Nov.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Nov.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'Dezember kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("A12:Q53").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Dez.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("C10").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Dez.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("S9:S50").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Dez.").Select
        Range("S9").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        'Termine kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Termine").Select
        Range("A1:B1000").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("Termine").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        
        '|fffd|berweisungen kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("|fffd|berweisungen").Select
        Range("A2:C100").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets("|fffd|berweisungen").Select
        Range("A2").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False

schliessen:
'Datei speichern und schlie|fffd|en
    Application.DisplayAlerts = False
    ActiveWorkbook.Close savechanges:=True
    Application.DisplayAlerts = True
GoTo ende
    
'ab hier Unterrotinen
'**************************************************************************
neuedatei1:
Workbooks.Add (xlWBATWorksheet)
ChDrive lw
ChDir pfad
ActiveWorkbook.SaveAs Filename:=datei & ".xls"
Worksheets.Add after:=Sheets(1)
tabname = "Dez."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Nov."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Okt."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Sept."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Aug."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Juli"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Juni"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Mai"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "April"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "M|fffd|rz"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Feb."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Jan."
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Daten"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Einstellungen"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Vorderseite"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "Termine"
ActiveSheet.name = tabname
Worksheets.Add after:=Sheets(1)
tabname = "|fffd|berstd."
ActiveSheet.name = tabname
GoTo kopieren

abrechoeffnen:
Workbooks.Open "Abrechnung_|fffd|berstunden"
GoTo geoeffnet

ende:
Application.ScreenUpdating = True
Unload UserForm4
End Sub

Public Sub Datenrestore()
Dim lw As String, pfad As String, datei As String
Dim jahr As Integer
Dim lw_pfad As String
Dim tabname As String 'Variable zum erstellen der n|fffd|tigen Tabellenbl|fffd|tter
Dim restore As Integer


'Abfrage ob Datenrestore ausgef|fffd|hrt werden soll
restore = MsgBox("Soll Datenrestore ausgef|fffd|hrt werden?   Vorhandene Daten werden |fffd|berschrieben!", vbYesNo, "Datenrestore ausf|fffd|hren?")
If restore = 7 Then Exit Sub

'Bitte warten anzeigen
UserForm5.Show vbModeless 'vbModeless bewirkt das das Makro im Hintergrund weiter l|fffd|uft
DoEvents 'bewirkt das nicht nur die Kopfzeile angezeigt wird
Application.ScreenUpdating = False

'pr|fffd|fen ob Datei schon vorhanden ansonsten neue |fffd|ffnen
        
'Laufwerk und Pfad ermitteln
lw = Left(ActiveWorkbook.Path, 1)
pfad = ActiveWorkbook.Path

'wechselt auf das Ursprungslaufwerk
ChDrive lw
'wechselt in das Ursprungsverzeichnis
ChDir pfad

'On Error GoTo fehler
'pr|fffd|fen ob Abrechnung_|fffd|berstunden schon offen
Dim x As Object
For Each x In Workbooks
If x.name = "Abrechnung_|fffd|berstunden.xls" Then GoTo geoeffnet
Next
Workbooks.Open Filename:="Abrechnung_|fffd|berstunden.xls"

geoeffnet:

'Dateinamen zuweisen
Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
datei = "Datensicherung_" & Worksheets("Einstellungen").Cells(4, 1).Value

        'pr|fffd|fen ob Datei schon offen
Dim y As Object
For Each y In Workbooks
If y.name = datei & ".xls" Then GoTo offen
Next
'Datei |fffd|ffnen oder Sprung zum erstellen der neuen Datei
        
        Workbooks.Open Filename:=datei
offen:

'************************************************************************************
'************************************************************************************
kopieren:
'Daten kopieren und einf|fffd|gen
        'Vorderseite Namen u. Personalnr.
        Workbooks(datei & ".xls").Activate
' pr|fffd|fen ob Vorderseite schon vorhanden ist
    Dim Blatt As Object
    For Each Blatt In ActiveWorkbook.Sheets ' Namen aller Tabellen pr|fffd|fen
        If Blatt.name = "Vorderseite" Then GoTo weiter4
    Next Blatt
    GoTo weiter3

weiter4:
        ActiveWorkbook.Worksheets("Vorderseite").Select
        Dim i7, i8 As String                                   'i9 rausgenommen da |fffd|ber Tabellenblatt bzw. SVERW ermittelt (Kostenstelle)
        i7 = Sheets("Vorderseite").Cells(7, 3).Value
        i8 = Sheets("Vorderseite").Cells(8, 3).Value       'i9 rausgenommen da |fffd|ber Tabellenblatt bzw. SVERW ermittelt (Kostenstelle)
        'i9 = Sheets("Vorderseite").Cells(9, 9).Value
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Vorderseite").Select
        Sheets("Vorderseite").Cells(7, 3).Value = i7
        Sheets("Vorderseite").Cells(8, 3).Value = i8
        'Sheets("Vorderseite").Cells(9, 9).Value = i9
        Range("A1").Select
weiter3:
        
        'Daten kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Daten").Select
        Range("A2:AA5000").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Daten").Select
        Range("A2").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Selection.PasteSpecial Paste:=xlComments
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Einstellungen kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Einstellungen").Select
        Range("A1:I50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Einstellungen").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        'Erg|fffd|nzung wegen Kalenderwoche
        If Worksheets("Einstellungen").Cells(6, 1).Value = 1 Then GoTo drin
        Worksheets("Einstellungen").Cells(12, 7).Value = 0
        Worksheets("Einstellungen").Cells(5, 1).Value = "Kalenderwoche (0 od. 1)"
drin:
        'Erg|fffd|nzung wegen neuer Option nach drucken gleich Speichern
        If Worksheets("Einstellungen").Cells(12, 7).Value = 1 Then GoTo drin1
        Worksheets("Einstellungen").Cells(12, 7).Value = 0
        Worksheets("Einstellungen").Cells(12, 4).Value = "Abrechnung nach Drucken speichern"
drin1:
        
        'Erg|fffd|nzung wegen unterscheidlichen Monatsanfang bei |fffd|berstd. Innen- Au|fffd|endienst
        If Worksheets("Einstellungen").Cells(14, 4).Value = "" Then
            Worksheets("Einstellungen").Cells(14, 7).Value = 0
            Worksheets("Einstellungen").Cells(14, 4).Value = "|fffd|berstd. M-Beginn am 1.=1/Montag=0"
            Else: GoTo drin4
        End If
drin4:
        
        'Erg|fffd|nzung wegen Einf|fffd|hrung Gleitzeitkonto
        If Worksheets("Einstellungen").Cells(13, 4).Value = "" Then
            Worksheets("Einstellungen").Cells(13, 4).Value = "Stand Gleitzeitkonto Jahresanfang"
            Range("G12:G13").Select
                 With Selection.Interior
                    .Pattern = xlSolid
                    .PatternColorIndex = xlAutomatic
                    '.ThemeColor = xlThemeColorDark1
                    '.TintAndShade = -0.349986266670736
                    '.PatternTintAndShade = 0
                End With
            Else: GoTo drin2
        End If
drin2:



        'raus genommen, wegen Einf|fffd|hrung von Gleitzeitkonto
        '|fffd|berstd. kopieren
        Workbooks(datei & ".xls").Activate
        '|fffd|berpr|fffd|gen ob |fffd|berstd. existiert
        'Dim ws As Worksheet
        'For Each ws In ActiveWorkbook.Sheets
        '    If ws.name = "|fffd|berstd." Then
         ' |fffd|berstd. existiert, dann kopieren
        '        ActiveWorkbook.Worksheets("|fffd|berstd.").Select
        '        Range("S8").Copy
        '        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        '        Worksheets("|fffd|berstd.").Select
        '        Range("S8").Select
        '        Selection.PasteSpecial Paste:=xlValues
        '        Selection.PasteSpecial Paste:=xlPasteFormats
        '        Selection.PasteSpecial Paste:=xlFormulas
        '        Application.CutCopyMode = False
        '        Range("A1").Select
        '    End If
        'Next ws

        
        
        'Januar kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Jan.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Jan.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Jan.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Februar kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Feb.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Feb.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Feb.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'M|fffd|rz kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("M|fffd|rz").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("M|fffd|rz").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("M|fffd|rz").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'April kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("April").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("April").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("April").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Mai kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Mai").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Mai").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Mai").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Juni kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Juni").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Juni").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Juni").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Juli kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Juli").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Juli").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Juli").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'August kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Aug.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Aug.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Aug.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'September kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Sept.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Sept.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Sept.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Oktober kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Okt.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Okt.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Okt.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'November kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Nov.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Nov.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Nov.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Dezember kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("A12:Q53").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Dez.").Select
        Range("A12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("C10").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Dez.").Select
        Range("C10").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("S12:S50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Dez.").Select
        Range("S12").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Termine kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Termine").Select
        Range("A1:B1000").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Termine").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select

        '|fffd|berweisungen kopieren
        ' pr|fffd|fen ob |fffd|berweisung schon vorhanden ist
  
    For Each Blatt In ActiveWorkbook.Sheets ' Namen aller Tabellen pr|fffd|fen
        If Blatt.name = "|fffd|berweisungen" Then
            Workbooks(datei & ".xls").Activate
            ActiveWorkbook.Worksheets("|fffd|berweisungen").Select
            Range("A2:C2").Copy
            Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
            Worksheets("|fffd|berweisungen").Select
            Range("A2").Select
            Selection.PasteSpecial Paste:=xlValues
            Selection.PasteSpecial Paste:=xlPasteFormats
            Selection.PasteSpecial Paste:=xlFormulas
            Application.CutCopyMode = False
            Range("A1").Select
        End If
    Next


schliessen:
'Datei speichern und schlie|fffd|en
Workbooks(datei & ".xls").Activate 'damit nicht Abrechnung_|fffd|berstd. geschlossen wird sondern die Datensicherung
    Application.DisplayAlerts = False
    ActiveWorkbook.Close savechanges:=True
    Application.DisplayAlerts = True
GoTo ende
    
'ab hier Unterrotinen
'**************************************************************************
abrechoeffnen:
Workbooks.Open "Abrechnung_|fffd|berstunden"
GoTo geoeffnet

Fehler:
MsgBox ("Eine der ben|fffd|tigte Dateien (Abrechnung_|fffd|berstunden oder Datensicherung_xxxx) wurde nicht gefunden")

ende:
Application.ScreenUpdating = True
Unload UserForm5
End Sub

Public Sub Doppelseitig_alt()
'Abrechnungsbetrag und Kalenderwoche nach "|fffd|berweisung" kopieren
'Anzahl der Eintr|fffd|ge ermitteln
Dim zeilen As Long
zeilen = Worksheets("|fffd|berweisungen").Cells(Rows.Count, 1).End(xlUp).Row
If zeilen = 100 Then MsgBox ("|fffd|berweisungsliste ist voll!" & Chr(13) & _
                            "Bitte im Tabellenblatt '|fffd|berweisung' zuerst die Eintr|fffd|ge l|fffd|schen!"): Exit Sub
'eine zeile dazuz|fffd|hlen
zeilen = zeilen + 1

'Werte aus Abrechnung hollen
Dim betrag As Double
Dim kalenderwo As String
    'if deshalb weil wenn Betragszelle leer ist ein fehler gekommen ist
    If Worksheets("Vorderseite").Cells(46, 39).Value = "" Then
    betrag = 0
    Else
    betrag = Worksheets("Vorderseite").Cells(46, 39).Value
    End If
kalenderwo = Worksheets("R|fffd|ckseite 1").Cells(1, 6).Value

'schreiben in |fffd|berweisungen
Worksheets("|fffd|berweisungen").Cells(zeilen, 1).Value = "KW " & kalenderwo
Worksheets("|fffd|berweisungen").Cells(zeilen, 2).Value = betrag
'****************************************************************************


'Bitte warten anzeigen
UserForm6.Show vbModeless 'vbModeless bewirkt das das Makro im Hintergrund weiter l|fffd|uft
DoEvents 'bewirkt das nicht nur die Kopfzeile angezeigt wird
Application.ScreenUpdating = False

'Abfrage ob Beidseitig schon vorhanden, wenn ja dann l|fffd|schen
Dim ws As Object
For Each ws In Worksheets
If ws.name = "Beidseitig" Then GoTo loeschen
Next

Dim tabname As String
'extra Tabellenblatt einf|fffd|gen
Worksheets.Add after:=Sheets("Benutzer")
tabname = "Beidseitig"
ActiveSheet.name = tabname
'Seitenr|fffd|nder setzen
With Worksheets("Beidseitig").PageSetup
    .LeftMargin = Application.InchesToPoints(0.1)
    .RightMargin = Application.InchesToPoints(0.1)
    .TopMargin = Application.InchesToPoints(0.1)
    .BottomMargin = Application.InchesToPoints(0.5)
    .HeaderMargin = Application.InchesToPoints(0)
    .FooterMargin = Application.InchesToPoints(0)
End With

'Daten kopieren und einf|fffd|gen
        'Vorderseite kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Vorderseite").Activate
        Range("A1:AZ50").Copy
        
'Spaltenbreite / Zeilenh|fffd|he ermitteln
        Dim x As Integer, z As Integer
        Dim y(54) As Single 'bis 48 Vorderseite, dann R|fffd|ckseite
        Dim w(50) As Single 'bis 50 Vorderseite, dann R|fffd|ckseite
        'Spalten
        For z = 1 To 54
            y(z) = Worksheets("Vorderseite").Columns(z).ColumnWidth
        Next z
        'Zeilen
        For x = 1 To 50
            w(x) = Worksheets("Vorderseite").Rows(x).RowHeight
        Next x
        
        'Spaltenbreite / Zeilenh|fffd|he zuweisen
        'Spalten
        For z = 1 To 54
            Worksheets("Beidseitig").Columns(z).ColumnWidth = y(z)
        Next z
        
        'Zeilen
        For x = 1 To 50
            Worksheets("Beidseitig").Rows(x).RowHeight = w(x)
        Next x
    'Vorderseite einf|fffd|gen
        ActiveWorkbook.Worksheets("Beidseitig").Activate
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        'Selection.PasteSpecial Paste:=xlPasteColumnWidths
        Application.CutCopyMode = False

        
'R|fffd|ckseite 1 kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("R|fffd|ckseite 1").Activate
        Range("A1:I39").Copy
        'R|fffd|ckseite einf|fffd|gen
        ActiveWorkbook.Worksheets("Beidseitig").Activate
        Range("BC55").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False

    'Spaltenbreite / Zeilenh|fffd|he ermitteln
        Dim a As Integer
        Dim b As Integer
        Dim c(9) As Single
        Dim d(39) As Single
        'Spalten
        For a = 1 To 9
            c(a) = Worksheets("R|fffd|ckseite 1").Columns(a).ColumnWidth
        Next a
        'Zeilen
        For b = 1 To 39
            d(b) = Worksheets("R|fffd|ckseite 1").Rows(b).RowHeight
        Next b
        
'Spaltenbreite / Zeilenh|fffd|he zuweisen
        '9 Spalten aber erst ab Spalte 55
        For a = 55 To 63
            Worksheets("Beidseitig").Columns(a).ColumnWidth = c(a - 54)
        Next a
        '39 Zeilen aber erst ab Zeile 55
        For b = 55 To 93
            Worksheets("Beidseitig").Rows(b).RowHeight = d(b - 54)
        Next b
        
'Druckbereich festlegen
Worksheets("Beidseitig").PageSetup.PrintArea = "$A$1:$AZ$50,$BC$55:$BK$93"
'Druckerauswahlfenster anzeigen und abfangen wenn Abrechen angeklickt wird
Dim r1 As Integer
r1 = Application.Dialogs(xlDialogPrinterSetup).Show
If r1 = 0 Then GoTo ende
'Ausdrucken
ActiveWorkbook.Worksheets("Beidseitig").PrintOut

'Abfrage ob R|fffd|ckseite2 beschrieben
Dim r2 As Integer
If Not Worksheets("R|fffd|ckseite 2").Cells(3, 2).Value > "" Then GoTo ende
'R|fffd|ckseite2 drucken
r2 = MsgBox("Soll die R|fffd|ckseite 2 gedruckt werden?", vbYesNo, "Drucken der Abrechnung")
If r2 = 6 Then ActiveWorkbook.Worksheets("R|fffd|ckseite 2").PrintOut


ende:
loeschen:
'Abfrage ob es Beidseitig gibt
For Each ws In Worksheets
If (ws.name = "Beidseitig") Then GoTo loeschen2
Next
GoTo ende2
loeschen2:
Application.DisplayAlerts = False
ActiveWorkbook.Worksheets("Beidseitig").Delete
Application.DisplayAlerts = True
ende2:
'Wenn gew|fffd|nscht gleich Abrechnung speichern
If Worksheets("Einstellungen").Cells(12, 7).Value = 1 Then Call Speichern_Abrechnungen


ActiveWorkbook.Worksheets("Daten").Activate
Application.ScreenUpdating = True
Unload UserForm6
End Sub

Public Sub aktualisieren()
'R|fffd|ckseiten Aktuallisieren
Dim anfdatum As Date ' Anfangssuchdatum
Dim enddatum As Date ' Endsuchdatum
Dim zeilen As Long 'Anzahl der belegten Zeilen
Dim zaehlen As Integer 'For-Schleife fuer das suchen
Dim anfreihe As Integer, endreihe As Integer 'Reihe des Anfangs- bzw. Enddatum
Dim suchen As Integer   'sucheenddatum: zum suchen des Enddatums wenn vorne kein Datum eingetragen ist

'Datum abfragen
    On Error GoTo Fehler:
    
    anfdatum = Worksheets("Daten").Cells(2, 15).Value
    
    enddatum = Worksheets("Daten").Cells(3, 15).Value

           
'Automatische Berechnung aus
With Application
        .Calculation = xlManual
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False


'Anzahl der Vorgaenge ermitteln
Sheets("Daten").Activate
zeilen = ActiveSheet.UsedRange.Rows.Count

'Datum suchen
    For zaehlen = 1 To zeilen
        ActiveWorkbook.Worksheets("Daten").Select
        Range("A1").Select
        
        If anfreihe > 0 Then GoTo anfgefunden 'damit bei gleichen Datum hintereinander nicht weiter gez|fffd|hlt wird
            If anfdatum = ActiveCell.Offset(zaehlen, 0) Then _
            anfreihe = zaehlen
anfgefunden:

     'Enddatum suchen, wird dann nach sucheenddatum: wietergeleitet
        If ActiveCell.Offset(zaehlen, 0) = enddatum Then GoTo sucheenddatum
    Next

endgefunden:


'Meldung wenn Datum nicht gefunden werden konnte
If anfreihe = 0 Then GoTo datumnichtgefunden
If endreihe = 0 Then GoTo datumnichtgefunden
    
'Abfrage ob es mehr wie zwei R|fffd|ckseiten sind (mehr als 64 Eintr|fffd|ge)
If endreihe - anfreihe > 64 Then GoTo zuviel
    
'Daten ins Abrechnungsformular |fffd|bertragen
Dim rueck1() As Variant 'zum eintragen der Daten in R|fffd|ckseite
Dim zeilrueck As Integer 'Zahler f|fffd|r die Zuweisung der zeilen
Dim spalrueck As Integer 'Z|fffd|hler f|fffd|r die Zuweisung der spalten
Dim zeile As Integer, spalte As Integer 'zum Z|fffd|hlen beim Schreiben in das R|fffd|ckseiten-Formular
Dim Blatt As String     'f|fffd|r die Auswahl ob R|fffd|ckseite 1 od 2

'Daten der Variablen zuweisen
ReDim rueck1(0 To endreihe + 1, 10) As Variant
Range("A" & anfreihe + 1).Select    'ActiveCelle auf das Anfangsdatum setzten
For zeilrueck = anfreihe + 1 To endreihe + 1
    For spalrueck = 1 To 11
               rueck1(zeilrueck, spalrueck - 1) = Worksheets("Daten").Cells(zeilrueck, spalrueck).Value
    Next
Next

'Daten in R|fffd|ckseite schreiben
'*********************************************

'R|fffd|ckseiten l|fffd|schen
ActiveWorkbook.Worksheets("R|fffd|ckseite 1").Select
Range("A3:I35").ClearContents   'R|fffd|ckseite 1 l|fffd|schen
Range("L3:L35").ClearContents 'Spalte Landerk|fffd|rzel l|fffd|schen
ActiveWorkbook.Worksheets("R|fffd|ckseite 2").Select
Range("A3:I35").ClearContents
Range("L3:L35").ClearContents 'Spalte Landerk|fffd|rzel l|fffd|schen
'Vorderseite l|fffd|schen
'Abfrage ob die Vorderseite gel|fffd|scht werden soll
Dim loeschen As Integer
loeschen = MsgBox("Sollen die Eintr|fffd|ge der Vorderseite gel|fffd|scht und das Datum neu gesetzt werden?", vbYesNo, "L|fffd|schen der Vorderseite?")
If loeschen = 6 Then GoTo weiter Else: GoTo nicht

weiter:
ActiveWorkbook.Worksheets("Vorderseite").Select

'Reiseziehl
Range("K7").Select
ActiveCell = ""
'Kunde/Firma
Range("K8").Select
ActiveCell = ""
'Reisezweck
Range("K9").Select
ActiveCell = ""

'Maschinentyp / Ma-Nr / Auftragsnr
'entf|fffd|llt seit neuem Formular Jan. 2016
'Range("H10").Select
'ActiveCell = ""
'Range("W10").Select
'ActiveCell = ""
'Range("AK10").Select
'ActiveCell = ""

'Reisekostenvorschus / W|fffd|hrung / Kurs
Range("D11").Select
ActiveCell = ""
Range("K11").Select
ActiveCell = ""
Range("P11").Select
ActiveCell = 1

'Abfahrt in / am / Zeit
'Range("B18").Select
'ActiveCell = ""
Range("H18").Select
ActiveCell = ""
Range("O18").Select
ActiveCell = ""

'R|fffd|ckkehr in / am / Zeit
'Range("B19").Select
'ActiveCell = ""
Range("H19").Select
ActiveCell = ""
Range("O19").Select
ActiveCell = ""

'Fahrtausweis Bahn/Schiff Inland
Range("H22").Select
ActiveCell = ""

'Fahrtausweis Bahn/Schiff Ausland / Kurs
Range("H23").Select
ActiveCell = ""
Range("K23").Select
ActiveCell = 1
'Range("AI20").Select  /// W|fffd|hrung
'ActiveCell = ""

'Eigener PKW / |fffd|/KM /
Range("B25").Select
ActiveCell = ""
Range("D25").Select
ActiveCell = 0.3


'Eigener PKW ausland
'entf|fffd|llt seit neuem Formular Jan. 2016
'Range("H22").Select
'ActiveCell = ""
'Range("O22").Select
'ActiveCell = ""
'Range("AC22").Select
'ActiveCell = ""
'Range("AI22").Select
'ActiveCell = ""

'Verpflegungsaufwendung Deutschland
Range("F30").Select
ActiveCell = ""

Range("F31").Select
ActiveCell = ""

'Deutschland Fr|fffd|hst|fffd|ck / Mittag-Abendessen
Range("I30").Select
ActiveCell = ""

Range("I31").Select
ActiveCell = ""

Range("L30").Select
ActiveCell = ""

Range("L31").Select
ActiveCell = ""

'Christa Zeile wird nicht gebraucht
'Range("F32").Select
'ActiveCell = ""

'Verpflegungsaufwendung Ausland
Range("F34").Select
ActiveCell = ""

Range("F35").Select
ActiveCell = ""

Range("F36").Select
ActiveCell = ""

Range("F37").Select
ActiveCell = ""

'Ausland Fr|fffd|hst|fffd|ck / Mittag-Abendessen
Range("I34").Select
ActiveCell = ""

Range("I35").Select
ActiveCell = ""

Range("I36").Select
ActiveCell = ""

Range("I37").Select
ActiveCell = ""

Range("L34").Select
ActiveCell = ""

Range("L35").Select
ActiveCell = ""

Range("L36").Select
ActiveCell = ""

Range("L37").Select
ActiveCell = ""


'|fffd|bernachtungskosten/-pauschale Inland
'Betrag
Range("D43").Select
ActiveCell = ""
Range("D44").Select
ActiveCell = ""
Range("D45").Select
ActiveCell = ""
'Tage
Range("F43").Select
ActiveCell = ""
Range("F44").Select
ActiveCell = ""
Range("F45").Select
ActiveCell = ""

'|fffd|bernachtungskosten/-pauschale Inland
'Betrag
Range("D47").Select
ActiveCell = ""
Range("D48").Select
ActiveCell = ""
Range("D49").Select
ActiveCell = ""
'Tage
Range("F47").Select
ActiveCell = ""
Range("F48").Select
ActiveCell = ""
Range("F49").Select
ActiveCell = ""
'Kurs
Range("K47").Select
ActiveCell = 1
Range("K48").Select
ActiveCell = 1
Range("K49").Select
ActiveCell = 1

'Sonstige Aufwendungen
'Text
Range("B53").Select
ActiveCell = ""
Range("B54").Select
ActiveCell = ""
Range("B55").Select
ActiveCell = ""
Range("B56").Select
ActiveCell = ""
Range("B57").Select
ActiveCell = ""
Range("B58").Select
ActiveCell = ""
Range("B59").Select
ActiveCell = ""
Range("B60").Select
ActiveCell = ""
Range("B61").Select
ActiveCell = ""
Range("B62").Select
ActiveCell = ""
'Betrag
Range("H53").Select
ActiveCell = ""
Range("H54").Select
ActiveCell = ""
Range("H55").Select
ActiveCell = ""
Range("H56").Select
ActiveCell = ""
Range("H57").Select
ActiveCell = ""
Range("H58").Select
ActiveCell = ""
Range("H59").Select
ActiveCell = ""
Range("H60").Select
ActiveCell = ""
Range("H61").Select
ActiveCell = ""
Range("H62").Select
ActiveCell = ""
'Kurs
Range("K53").Select
ActiveCell = 1
Range("K54").Select
ActiveCell = 1
Range("K55").Select
ActiveCell = 1
Range("K56").Select
ActiveCell = 1
Range("K57").Select
ActiveCell = 1
Range("K58").Select
ActiveCell = 1
Range("K59").Select
ActiveCell = 1
Range("K60").Select
ActiveCell = 1
Range("K61").Select
ActiveCell = 1
Range("K62").Select
ActiveCell = 1

'Datum setzen
Range("A65").Select
ActiveCell = Date

nicht:
Blatt = "R|fffd|ckseite 1"   'f|fffd|r die unterschiedlichen R|fffd|ckseiten
zeile = 3   'Schreibzeile auf die dritte setzten
For zeilrueck = anfreihe + 1 To endreihe + 1
    spalte = 1      'Schreibspalte auf die erste setzten
    For spalrueck = 1 To 9
               Worksheets(Blatt).Cells(zeile, spalte).Value = rueck1(zeilrueck, spalrueck - 1)
               spalte = spalte + 1 'Schreibspalte um eins erh|fffd|hen
        Next
    Worksheets(Blatt).Cells(zeile, 12).Value = rueck1(zeilrueck, 10)
    zeile = zeile + 1   'Schreibzeile um eins erh|fffd|hen
    If zeile = 36 Then Blatt = "R|fffd|ckseite 2": zeile = 3
Next
ActiveWorkbook.Worksheets("Daten").Select
    

GoTo ende:
'ab hier nur noch Unterrotienen
'***************************************************

datumnichtgefunden: 'Meldung wenn ein Datum nicht gefunden werden konnte
MsgBox ("Bitte nochmal probieren, Datum konnte nicht gefunden werden!")
GoTo ende

datumfalsch:    'Fehler abfangen wenn keine Zahlen eingegeben wurden
    anfdatum = InputBox("Bitte Anfangsdatum nochmal eingeben, etwas war falsch:", _
            "Bitte Anfangsdatum eingeben")
    
    enddatum = InputBox("Bitte Enddatum nochmal eingeben, etwas war falsch:", _
            "Bitte Enddatum eingeben")

sucheenddatum:  'Enddatum suchen wenn mehrere Eintr|fffd|ge aber das Datum nicht dabei steht
    endreihe = zaehlen + suchen
    For suchen = 1 To 20 'die n|fffd|chsten 20 Zeilen nach gefundenem Enddatum werden untersucht
        'erstes if beenden wenn n|fffd|chstes Enddatum gr|fffd||fffd|er als das Suchdatum
        'zweites if beenden wenn keine weiteren Eintr|fffd|ge mehr vorhanden
        'drittes if weiter z|fffd|hlen wenn das Suchdatum mehrmals hintereinander kommt
        'viertes if weiter z|fffd|hlen wenn die n|fffd|chsten Eintr|fffd|ge noch zum Suchdatum geh|fffd|ren aber das Datum nicht eingetragen ist
        If ActiveCell.Offset(zaehlen + suchen, 0) > enddatum Then _
            GoTo endgefunden _
            Else: If ActiveCell.Offset(zaehlen + suchen, 0) = 0 & ActiveCell.Offset _
            (zaehlen + suchen, 1) = "" Then GoTo endgefunden _
            Else: If ActiveCell.Offset(zaehlen + suchen, 0) = enddatum Then endreihe _
            = zaehlen + suchen _
            Else: If ActiveCell.Offset(zaehlen + suchen, 0) = "" Then _
               If ActiveCell.Offset(zaehlen + suchen, 1) > 0 Then endreihe = zaehlen + suchen
    Next
    GoTo endgefunden
    
zuviel: 'Meldung das zu viele Eintr|fffd|ge ausgew|fffd|hlt wurden
MsgBox ("Bei Ihrer Auswahl w|fffd|rden mehr als zwei Seiten ben|fffd|tigt!!") & Chr(13) & _
("Bitte versuchen sie es nochmal!")
GoTo ende:


Fehler: 'Programmfehler
MsgBox ("Es ist ein Programmfehler aufgetreten!")

ende:
Sheets("R|fffd|ckseite 1").Activate
'Automatische Berechnung ein
With Application
        .Calculation = xlAutomatic
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False
Application.Calculate
End Sub

Public Sub NeuesJahr()

Dim lw As String, pfad As String, datei As String
Dim jahr As Integer
Dim lw_pfad As String
Dim tabname As String 'Variable zum erstellen der n|fffd|tigen Tabellenbl|fffd|tter
Dim restore As Integer


'Abfrage ob Datenrestore ausgef|fffd|hrt werden soll
restore = MsgBox("Soll Datenrestore ausgef|fffd|hrt werden?   Vorhandene Daten werden |fffd|berschrieben!", vbYesNo, "Datenrestore ausf|fffd|hren?")
If restore = 7 Then Exit Sub

'Bitte warten anzeigen
UserForm5.Show vbModeless 'vbModeless bewirkt das das Makro im Hintergrund weiter l|fffd|uft
DoEvents 'bewirkt das nicht nur die Kopfzeile angezeigt wird
Application.ScreenUpdating = False

'pr|fffd|fen ob Datei schon vorhanden ansonsten neue |fffd|ffnen
        
'Laufwerk und Pfad ermitteln
lw = Left(ActiveWorkbook.Path, 1)
pfad = ActiveWorkbook.Path

'wechselt auf das Ursprungslaufwerk
ChDrive lw
'wechselt in das Ursprungsverzeichnis
ChDir pfad

'On Error GoTo fehler
'pr|fffd|fen ob Abrechnung_|fffd|berstunden schon offen
Dim x As Object
For Each x In Workbooks
If x.name = "Abrechnung_|fffd|berstunden.xls" Then GoTo geoeffnet
Next
Workbooks.Open Filename:="Abrechnung_|fffd|berstunden.xls"

geoeffnet:

'Dateinamen zuweisen
Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
datei = "Datensicherung_" & Worksheets("Einstellungen").Cells(4, 1).Value

        'pr|fffd|fen ob Datei schon offen
Dim y As Object
For Each y In Workbooks
If y.name = datei & ".xls" Then GoTo offen
Next
'Datei |fffd|ffnen oder Sprung zum erstellen der neuen Datei
        
        Workbooks.Open Filename:=datei
offen:

'************************************************************************************
'************************************************************************************
kopieren:
'Daten kopieren und einf|fffd|gen
        'Daten kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Daten").Select
        Range("A1:L1200").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Daten").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
        
        'Einstellungen kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Einstellungen").Select
        Range("A1:I50").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Einstellungen").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select
                
        'Termine kopieren
        Workbooks(datei & ".xls").Activate
        ActiveWorkbook.Worksheets("Termine").Select
        Range("A1:B1000").Copy
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        Worksheets("Termine").Select
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Selection.PasteSpecial Paste:=xlFormulas
        Application.CutCopyMode = False
        Range("A1").Select

schliessen:
'Datei speichern und schlie|fffd|en
    Application.DisplayAlerts = False
    ActiveWorkbook.Close savechanges:=True
    Application.DisplayAlerts = True
GoTo ende
    
'ab hier Unterrotinen
'**************************************************************************
abrechoeffnen:
Workbooks.Open "Abrechnung_|fffd|berstunden"
GoTo geoeffnet

Fehler:
MsgBox ("Eine der ben|fffd|tigte Dateien (Abrechnung_|fffd|berstunden oder Datensicherung_xxxx) wurde nicht gefunden")

ende:
Application.ScreenUpdating = True
Unload UserForm5


End Sub

Public Sub AlteUeberstdloeschen()
Dim restore As Integer
restore = MsgBox("Sollen die |fffd|berstundentabellen gel|fffd|schen werden?", vbYesNo, "|fffd|berstundentabellen l|fffd|schen?")
If restore = 7 Then Exit Sub
'Alte |fffd|berstundentabellen leeren
'|fffd|berstd. |fffd|bertrag aus Vorjahr l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("|fffd|berstd.").Select
        Range("S8").ClearContents
        
'Januar l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Jan.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Februar l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Feb.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'M|fffd|rz l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("M|fffd|rz").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'April l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("April").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Mai l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Mai").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Juni l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juni").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Juli l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Juli").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'August l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Aug.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Sept. l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Sept.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Okt. l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Okt.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Nov l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Nov.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'Dez. l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Dez.").Select
        Range("A12:K53").ClearContents
        Range("G6:J6").ClearContents
        Range("Q12:Q53").ClearContents
        Range("C10").ClearContents
        Range("S12:S50").ClearContents
        
'|fffd|berweisung l|fffd|schen
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("|fffd|berweisungen").Select
        Range("A2:C100").ClearContents
        
Worksheets("|fffd|berstd.").Activate
        
        
End Sub

Public Sub ueberweisung()

'Anzahl der Eintr|fffd|ge ermitteln
Dim zeilen As Long
zeilen = Worksheets("|fffd|berweisungen").UsedRange.Rows.Count           'Worksheets("|fffd|berweisungen").Range("A1:A100").Rows.Count
'eine zeile dazuz|fffd|hlen
zeilen = zeilen + 1

'Werte aus Abrechnung hollen
Dim betrag As Long
Dim kalenderwo As String
betrag = Worksheets("Vorderseite").Cells(66, 14).Value
kalenderwo = Worksheets("R|fffd|ckseite 1").Cells(1, 7).Value

'schreiben in |fffd|berweisungen
Worksheets("|fffd|berweisungen").Cells(zeilen, 1).Value = "KW " & kalenderwo
Worksheets("|fffd|berweisungen").Cells(zeilen, 2).Value = betrag

End Sub
Attribute VB_Name = "Modul2"
Option Explicit


Public Function Stundenberechnen(ByVal adatum As Date) As Variant '

Application.Volatile
Dim anfdatum As Date ' Anfangssuchdatum
Dim enddatum As Date ' Endsuchdatum
Dim zeilen As Long 'Anzahl der belegten Zeilen
Dim zaehlen As Integer 'For-Schleife fuer das suchen
Dim anfreihe As Integer, endreihe As Integer 'Reihe des Anfangs- bzw. Enddatum
Dim suchen As Integer   'sucheenddatum: zum suchen des Enddatums wenn vorne kein Datum eingetragen ist
'Dim stunden As Integer, minuten As Integer, pause As Integer
Dim vonzeit As Variant, biszeit As Variant, pause As Variant
Dim edatum As Date

anfdatum = adatum
edatum = adatum
enddatum = adatum

'Anzahl der Vorgaenge ermitteln
Sheets("Daten").Activate
zeilen = Sheets("Daten").Cells(Rows.Count, 1).End(xlUp).Row  'neu weil in der anderen Methode nur 1200 gefunden werden

'zeilen = ActiveSheet.UsedRange.Rows.Count   'raus genommen weil beim Umschalten auf die Tabell nur 1200 Zeilen gez|fffd|hlt werden



'Datum suchen
    For zaehlen = 1 To zeilen
         If anfreihe > 0 Then GoTo anfgefunden 'damit bei gleichen Datum hintereinander nicht weiter gez|fffd|hlt wird
            If anfdatum = Worksheets("Daten").Cells(zaehlen, 1).Value Then _
            anfreihe = zaehlen
anfgefunden:

     'Enddatum suchen, wird dann nach sucheenddatum: wietergeleitet
        If Worksheets("Daten").Cells(zaehlen, 1).Value = enddatum Then GoTo sucheenddatum

    Next
endgefunden:


'Wenn Datum nicht gefunden werden konnte, einfach beenden
If anfreihe = 0 Then Stundenberechnen = "": GoTo datumnichtgefunden
If endreihe = 0 Then Stundenberechnen = "": GoTo datumnichtgefunden

'Sonntag u. Sammstag
Select Case Left(LCase(Worksheets("Daten").Cells(anfreihe, 2).Value), 7)
                Case "sonntag"
                Stundenberechnen = "": GoTo ende
                Case "samstag"
                Stundenberechnen = "": GoTo ende
                Case "sonderu"
                Stundenberechnen = "Sonderurl.": GoTo ende
End Select



'Krank, Urlaub und Eingearbeitet
Select Case Left(LCase(Worksheets("Daten").Cells(anfreihe, 2).Value), 1)
                Case "k"
                Stundenberechnen = "Krank": GoTo ende
                Case "u"
                Stundenberechnen = "Urlaub": GoTo ende
                Case "h"
                Stundenberechnen = Worksheets("Daten").Cells(anfreihe, 2).Value: GoTo ende
                Case "sonder"
                Stundenberechnen = "Sonderurl.": GoTo ende
                Case "Sonntag"
                Stundenberechnen = Nothing: GoTo ende
                'Case "samstag"
                'Stundenberechnen = 0: GoTo ende
                Case "f"
                Stundenberechnen = "Feiertag": GoTo ende
                Case "e"
                Select Case Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 10)
                    Case "Du hast an"
                        Stundenberechnen = 0: GoTo ende
                End Select
                Select Case Weekday(Worksheets("Daten").Cells(anfreihe, 1).Value)
                    Case 1
                        Stundenberechnen = Worksheets("Einstellungen").Cells(14, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Sonntag
                    Case 2
                        Stundenberechnen = Worksheets("Einstellungen").Cells(8, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Montag
                    Case 3
                        Stundenberechnen = Worksheets("Einstellungen").Cells(9, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Dienstag
                    Case 4
                        Stundenberechnen = Worksheets("Einstellungen").Cells(10, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Mittwoch
                    Case 5
                        Stundenberechnen = Worksheets("Einstellungen").Cells(11, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Donnerstag
                    Case 6
                        Stundenberechnen = Worksheets("Einstellungen").Cells(12, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Freitag
                    Case 7
                        Stundenberechnen = Worksheets("Einstellungen").Cells(13, 2).Value * (-1): _
                        If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Or _
                        Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 9) = "Silvester" Then _
                        Stundenberechnen = Stundenberechnen / 2: GoTo ende Else GoTo ende 'Samstag
                End Select
                
            'Am Heilig Abend oder Silvester eingearbeitet
            If Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 6) = "Heilig" Then _
            Stundenberechnen = Stundenberechnen / 2
End Select

'Abfangen wenn keine "Zeit von" und "Zeit bis" eingetragen sind
If Worksheets("Daten").Cells(anfreihe, 2).Value = 0 And _
    Worksheets("Daten").Cells(anfreihe, 3).Value = 0 Then Stundenberechnen = "": GoTo ende

'Zeit berechnen
Dim rueck1() As Variant 'zum eintragen der Daten in R|fffd|ckseite
Dim zeilrueck As Integer 'Zahler f|fffd|r die Zuweisung der zeilen
Dim spalrueck As Integer 'Z|fffd|hler f|fffd|r die Zuweisung der spalten
Dim zeile As Integer, spalte As Integer 'zum Z|fffd|hlen beim Schreiben in das R|fffd|ckseiten-Formular

'Zeit berechnen
For zeilrueck = anfreihe To endreihe
'AUSGEBLENDETER CODE IST ALTER (KONNTE KEINE STUNDEN |fffd|BER 0 UHR BERECHNEN)
            'Stundenberechnen = Stundenberechnen + Worksheets("Daten").Cells(zeilrueck, 3).Value - Worksheets("Daten").Cells(zeilrueck, 2).Value - Worksheets("Daten").Cells(zeilrueck, 8).Value
            'If Hour(Worksheets("Daten").cells(zeilrueck, 3).Value) = 0 _
            Then biszeit = 24 + Minute(Worksheets("Daten").cells(zeilrueck, 3).Value) / 60 _
            Else: biszeit = Hour(Worksheets("Daten").cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").cells(zeilrueck, 3).Value) / 60
            'vonzeit = Hour(Worksheets("Daten").cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").cells(zeilrueck, 2).Value) / 60
            
 If Left(LCase(Worksheets("Daten").Cells(zeilrueck, 2).Value), 1) = "h" Then Stundenberechnen = Worksheets("Daten").Cells(zeilrueck, 2).Value: GoTo ende
            
            If CDate(Worksheets("Daten").Cells(zeilrueck, 3).Value) < CDate(Worksheets("Daten").Cells(zeilrueck, 2).Value) _
            Then biszeit = Hour(Worksheets("Daten").Cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 3).Value) / 60: vonzeit = Hour(Worksheets("Daten").Cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 2).Value) / 60: pause = Worksheets("Daten").Cells(zeilrueck, 8).Value _
            : Stundenberechnen = Stundenberechnen + ((biszeit - vonzeit) + 24) - pause: GoTo uhr
            
            biszeit = Hour(Worksheets("Daten").Cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 3).Value) / 60
            vonzeit = Hour(Worksheets("Daten").Cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 2).Value) / 60
            If biszeit = 0 Then Stundenberechnen = Stundenberechnen + ((biszeit - vonzeit) + 24) - pause: GoTo uhr
            
            biszeit = Hour(Worksheets("Daten").Cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 3).Value) / 60: vonzeit = Hour(Worksheets("Daten").Cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 2).Value) / 60
            pause = Worksheets("Daten").Cells(zeilrueck, 8).Value
            Stundenberechnen = Stundenberechnen + biszeit - vonzeit - pause
uhr:
    Next


'Feiertage ber|fffd|cksichtigen
Select Case Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 13)
    Case "Du hast an He" 'Heilig Abend
        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(8, 5).Value: GoTo ende
    Case "Du hast an Si" 'Silvester
        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(9, 5).Value: GoTo ende
End Select

Select Case Left(Worksheets("Daten").Cells(anfreihe, 10).Value, 10)
    Case "Du hast an" 'Normaler Feiertag
        GoTo ende
End Select


'normale Arbeitszeit abziehen
Select Case Weekday(Worksheets("Daten").Cells(anfreihe, 1).Value)
                    Case 1
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(14, 2).Value 'Sonntag
                    Case 2
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(8, 2).Value 'Montag
                    Case 3
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(9, 2).Value 'Dienstag
                    Case 4
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(10, 2).Value 'Mittwoch
                    Case 5
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(11, 2).Value 'Donerstag
                    Case 6
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(12, 2).Value 'Freitag
                    Case 7
                        Stundenberechnen = Stundenberechnen - Worksheets("Einstellungen").Cells(13, 2).Value 'Samstag
                End Select

GoTo ende

'Ab hier Unterrotinen
'****************************************************************************
sucheenddatum:  'Enddatum suchen wenn mehrere Eintr|fffd|ge aber das Datum nicht dabei steht
    endreihe = zaehlen + suchen
    For suchen = 1 To 20 'die n|fffd|chsten 20 Zeilen nach gefundenem Enddatum werden untersucht
        'erstes if beenden wenn n|fffd|chstes Enddatum gr|fffd||fffd|er als das Suchdatum
        'zweites if beenden wenn keine weiteren Eintr|fffd|ge mehr vorhanden
        'drittes if weiter z|fffd|hlen wenn das Suchdatum mehrmals hintereinander kommt
        'viertes if weiter z|fffd|hlen wenn die n|fffd|chsten Eintr|fffd|ge noch zum Suchdatum geh|fffd|ren aber das Datum nicht eingetragen ist
        If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value > enddatum Then _
            GoTo endgefunden _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = 0 & Worksheets("Daten").Cells _
            (zaehlen + suchen, 2) = "" Then GoTo endgefunden _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = edatum Then endreihe _
            = zaehlen + suchen _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = "" Then _
               If Worksheets("Daten").Cells(zaehlen + suchen, 2).Value > 0 Then endreihe = zaehlen + suchen
    Next
    GoTo endgefunden
    

datumnichtgefunden: 'Wenn Datum nicht gefunden wird, einfach beenden
GoTo ende
    
    
ende:
Application.Volatile
End Function


Public Function Nachtstunden(ByVal adatum As Date) As Variant

Application.Volatile
Dim anfdatum As Date ' Anfangssuchdatum
Dim enddatum As Date ' Endsuchdatum
Dim zeilen As Long 'Anzahl der belegten Zeilen
Dim zaehlen As Integer 'For-Schleife fuer das suchen
Dim anfreihe As Integer, endreihe As Integer 'Reihe des Anfangs- bzw. Enddatum
Dim suchen As Integer   'sucheenddatum: zum suchen des Enddatums wenn vorne kein Datum eingetragen ist
'Dim stunden As Integer, minuten As Integer, pause As Integer
Dim vonzeit As Variant, biszeit As Variant, pause As Variant
Dim edatum As Date
Dim nachtstd As Variant
Dim nachtname As String, nachtreihe As Integer, nachtspalte As Integer
Dim Stundenberechnen As Variant

anfdatum = adatum
edatum = adatum
enddatum = adatum


'Wenn die Funktion auf eine leere Zelle zugreifen w|fffd|rde Nachtstunden auf 0 setzten
On Error GoTo nullsetzen

'Anzahl der Vorgaenge ermitteln
Sheets("Daten").Activate
zeilen = Sheets("Daten").Cells(Rows.Count, 1).End(xlUp).Row  'neu weil in der anderen Methode nur 1200 gefunden werden

'zeilen = ActiveSheet.UsedRange.Rows.Count   'raus genommen weil beim Umschalten auf die Tabell nur 1200 Zeilen gez|fffd|hlt werden


'Datum suchen
    For zaehlen = 1 To zeilen
         If anfreihe > 0 Then GoTo anfgefunden 'damit bei gleichen Datum hintereinander nicht weiter gez|fffd|hlt wird
            If anfdatum = Worksheets("Daten").Cells(zaehlen, 1).Value Then _
            anfreihe = zaehlen
anfgefunden:

     'Enddatum suchen, wird dann nach sucheenddatum: wietergeleitet
        If Worksheets("Daten").Cells(zaehlen, 1).Value = enddatum Then GoTo sucheenddatum

    Next
endgefunden:


'Wenn Datum nicht gefunden werden konnte, einfach beenden
If anfreihe = 0 Then GoTo datumnichtgefunden
If endreihe = 0 Then GoTo datumnichtgefunden


'Zeit berechnen
Dim rueck1() As Variant 'zum eintragen der Daten in R|fffd|ckseite
Dim zeilrueck As Integer 'Zahler f|fffd|r die Zuweisung der zeilen
Dim spalrueck As Integer 'Z|fffd|hler f|fffd|r die Zuweisung der spalten
Dim zeile As Integer, spalte As Integer 'zum Z|fffd|hlen beim Schreiben in das R|fffd|ckseiten-Formular

'Abfangen wenn keine "Zeit von" und "Zeit bis" eingetragen sind
If Worksheets("Daten").Cells(anfreihe, 2).Value = 0 And _
    Worksheets("Daten").Cells(anfreihe, 3).Value = 0 Then Stundenberechnen = 0: GoTo ende

'Zeit berechnen
For zeilrueck = anfreihe To endreihe
 'AUSBEBLENDETER CODE IST ALTER (KONNTE KEINE STUNDEN |fffd|BER 0 UHR BERECHNEN)
            'Stundenberechnen = Stundenberechnen + Worksheets("Daten").Cells(zeilrueck, 3).Value - Worksheets("Daten").Cells(zeilrueck, 2).Value - Worksheets("Daten").Cells(zeilrueck, 8).Value
           ' If Hour(Worksheets("Daten").cells(zeilrueck, 3).Value) = 0 _
            Then biszeit = 24 + Minute(Worksheets("Daten").cells(zeilrueck, 3).Value) / 60 _
            Else biszeit = Hour(Worksheets("Daten").cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").cells(zeilrueck, 3).Value) / 60
            'vonzeit = Hour(Worksheets("Daten").cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").cells(zeilrueck, 2).Value) / 60
            If CDate(Worksheets("Daten").Cells(zeilrueck, 3).Value) < CDate(Worksheets("Daten").Cells(zeilrueck, 2).Value) _
            Then biszeit = Hour(Worksheets("Daten").Cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 3).Value) / 60: vonzeit = Hour(Worksheets("Daten").Cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 2).Value) / 60: pause = Worksheets("Daten").Cells(zeilrueck, 8).Value _
            : Stundenberechnen = Stundenberechnen + ((biszeit - vonzeit) + 24) - pause: GoTo uhr
            
            biszeit = Hour(Worksheets("Daten").Cells(zeilrueck, 3).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 3).Value) / 60
            vonzeit = Hour(Worksheets("Daten").Cells(zeilrueck, 2).Value) + Minute(Worksheets("Daten").Cells(zeilrueck, 2).Value) / 60
            pause = Worksheets("Daten").Cells(zeilrueck, 8).Value
            Stundenberechnen = Stundenberechnen + biszeit - vonzeit - pause
uhr:
 'Nachtstd. berechnen
 
 'Nachtstd. von 0-6 Uhr
 If vonzeit <= Worksheets("Einstellungen").Cells(19, 1).Value And vonzeit < biszeit Then _
    nachtstd = nachtstd + Worksheets("Einstellungen").Cells(19, 1).Value - vonzeit
 If biszeit <= Worksheets("Einstellungen").Cells(19, 1).Value And vonzeit < biszeit Then _
    nachtstd = nachtstd - (Worksheets("Einstellungen").Cells(19, 1).Value - biszeit): GoTo 1234   'Sprung eingef|fffd|gt sonst stimmt die Berichnung nicht wenn ein Eintrag von 4 bis 5 geht und der N|fffd|chste von 5:30 bis ...
 'Nachtstd. von 20-0 Uhr
 If biszeit = 0 And Not vonzeit = 0 Then biszeit = 24
 If biszeit >= Worksheets("Einstellungen").Cells(17, 1).Value And _
    biszeit > vonzeit Then _
    nachtstd = nachtstd + (biszeit - Worksheets("Einstellungen").Cells(17, 1).Value)
 If vonzeit >= Worksheets("Einstellungen").Cells(17, 1).Value And biszeit > vonzeit Then _
    nachtstd = nachtstd - (vonzeit - Worksheets("Einstellungen").Cells(17, 1).Value)
 'Nachstd. wenn vonzeit vor 20 Uhr und biszeit vor 6 Uhr liegt
 If vonzeit <= Worksheets("Einstellungen").Cells(17, 1).Value And _
    biszeit <= Worksheets("Einstellungen").Cells(19, 1).Value And Not _
    biszeit = 0 And Not vonzeit = 0 Then _
    nachtstd = nachtstd + 4 + biszeit
 'Nachstd. wenn vonzeit nach 20 Uhr und biszeit vor 6 Uhr liegt
 If vonzeit > Worksheets("Einstellungen").Cells(17, 1).Value And _
    biszeit <= Worksheets("Einstellungen").Cells(19, 1).Value Then _
    nachtstd = nachtstd + (24 - vonzeit) + biszeit
'Nachtstd. wenn vonzeit nach 20 Uhr und biszeit nach 6 Uhr liegt
 If vonzeit > Worksheets("Einstellungen").Cells(17, 1).Value And _
    biszeit > Worksheets("Einstellungen").Cells(19, 1).Value And biszeit < vonzeit Then _
    nachtstd = nachtstd + (24 - vonzeit) + Worksheets("Einstellungen").Cells(19, 1).Value
'Nachtstd. wenn vonzeit vor 20 Uhr und biszeit nach 6 Uhr
 If vonzeit < Worksheets("Einstellungen").Cells(17, 1).Value And _
    vonzeit > Worksheets("Einstellungen").Cells(19, 1).Value And _
    biszeit > Worksheets("Einstellungen").Cells(19, 1).Value And _
    biszeit < Worksheets("Einstellungen").Cells(17, 1).Value And _
    vonzeit > biszeit Then _
    nachtstd = Worksheets("Einstellungen").Cells(19, 1).Value + 24 - Worksheets("Einstellungen").Cells(17, 1).Value
1234:
    Next

Nachtstunden = nachtstd

GoTo ende

'Ab hier Unterrotinen
'****************************************************************************
sucheenddatum:  'Enddatum suchen wenn mehrere Eintr|fffd|ge aber das Datum nicht dabei steht
    endreihe = zaehlen + suchen
    For suchen = 1 To 20 'die n|fffd|chsten 20 Zeilen nach gefundenem Enddatum werden untersucht
        'erstes if beenden wenn n|fffd|chstes Enddatum gr|fffd||fffd|er als das Suchdatum
        'zweites if beenden wenn keine weiteren Eintr|fffd|ge mehr vorhanden
        'drittes if weiter z|fffd|hlen wenn das Suchdatum mehrmals hintereinander kommt
        'viertes if weiter z|fffd|hlen wenn die n|fffd|chsten Eintr|fffd|ge noch zum Suchdatum geh|fffd|ren aber das Datum nicht eingetragen ist
        If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value > enddatum Then _
            GoTo endgefunden _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = 0 & Worksheets("Daten").Cells _
            (zaehlen + suchen, 2) = "" Then GoTo endgefunden _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = edatum Then endreihe _
            = zaehlen + suchen _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = "" Then _
               If Worksheets("Daten").Cells(zaehlen + suchen, 2).Value > 0 Then endreihe = zaehlen + suchen
    Next
    GoTo endgefunden
    

datumnichtgefunden: 'Wenn Datum nicht gefunden wird, einfach beenden
GoTo ende
   
'Wenn die Funktion einen Fehler ausgeben w|fffd|rde Nachtstunden auf 0 setzten
nullsetzen:
Nachtstunden = 0
GoTo ende
    
ende:
End Function
Function Feiertag(datum As Date) As String

Dim J%, d%
Dim O As Date
J = Year(datum)
'Osterberechnung
d = (((255 - 11 * (J Mod 19)) - 21) Mod 30) + 21
O = DateSerial(J, 3, 1) + d + (d > 48) + 6 - _
((J + J \ 4 + d + (d > 48) + 1) Mod 7)
'Feiertage berechnen
Select Case datum
Case Is = DateSerial(J, 1, 1)
Feiertag = "Neujahr"
Case Is = DateSerial(J, 1, 6)
Feiertag = "Dreik|fffd|nig"
Case Is = DateAdd("D", -2, O)
Feiertag = "Karfreitag"
Case Is = O
Feiertag = "Ostersonntag"
Case Is = DateAdd("D", 1, O)
Feiertag = "Ostermontag"
Case Is = DateSerial(J, 5, 1)
Feiertag = "Erster Mai"
Case Is = DateAdd("D", 39, O)
Feiertag = "Christi Himmelfahrt"
Case Is = DateAdd("D", 49, O)
Feiertag = "Pfingstsonntag"
Case Is = DateAdd("D", 50, O)
Feiertag = "Pfingstmontag"
Case Is = DateAdd("D", 60, O)
Feiertag = "Fronleichnam*"
Case Is = DateSerial(J, 8, 15)
Feiertag = "Maria Himmelfahrt*"
Case Is = DateSerial(J, 10, 3)
Feiertag = "Deutsche Einheit"
Case Is = DateSerial(J, 11, 1)
Feiertag = "Allerheiligen*"
Case Is = DateSerial(J, 12, 24)
Feiertag = "Heilig Abend*"
Case Is = DateSerial(J, 12, 25)
Feiertag = "EWeihnacht"
Case Is = DateSerial(J, 12, 26)
Feiertag = "ZWeihnacht"
Case Is = DateSerial(J, 12, 31)
Feiertag = "Silvester*"
Case Else
Feiertag = ""
End Select
End Function




Public Function Konto_von(ByVal adatum As Date) As Variant

Application.Volatile
Dim anfdatum As Date ' Anfangssuchdatum
Dim enddatum As Date ' Endsuchdatum
Dim zeilen As Long 'Anzahl der belegten Zeilen
Dim zaehlen As Integer 'For-Schleife fuer das suchen
Dim anfreihe As Integer, endreihe As Integer 'Reihe des Anfangs- bzw. Enddatum
Dim suchen As Integer   'sucheenddatum: zum suchen des Enddatums wenn vorne kein Datum eingetragen ist
'Dim stunden As Integer, minuten As Integer, pause As Integer
Dim vonzeit As Variant, biszeit As Variant, pause As Variant
Dim edatum As Date

anfdatum = adatum
edatum = adatum
enddatum = adatum

'Anzahl der Vorgaenge ermitteln
Sheets("Daten").Activate
zeilen = Sheets("Daten").Cells(Rows.Count, 1).End(xlUp).Row  'neu weil in der anderen Methode nur 1200 gefunden werden

'zeilen = ActiveSheet.UsedRange.Rows.Count   'raus genommen weil beim Umschalten auf die Tabell nur 1200 Zeilen gez|fffd|hlt werden



'Datum suchen
    For zaehlen = 1 To zeilen
         If anfreihe > 0 Then GoTo anfgefunden 'damit bei gleichen Datum hintereinander nicht weiter gez|fffd|hlt wird
            If anfdatum = Worksheets("Daten").Cells(zaehlen, 1).Value Then _
            anfreihe = zaehlen
anfgefunden:

     'Enddatum suchen, wird dann nach sucheenddatum: wietergeleitet
        If Worksheets("Daten").Cells(zaehlen, 1).Value = enddatum Then GoTo sucheenddatum

    Next
endgefunden:


'Wenn Datum nicht gefunden werden konnte, einfach beenden
If anfreihe = 0 Then Konto_von = "": GoTo datumnichtgefunden
If endreihe = 0 Then Konto_von = "": GoTo datumnichtgefunden

'Abfragen ob von eingetragen ist
If Worksheets("Daten").Cells(anfreihe, 12).Value = "GK" Then
    Konto_von = "vom"
    Else: Konto_von = ""
End If

'Abfangen wenn keine "Zeit von" und "Zeit bis" eingetragen sind
If Worksheets("Daten").Cells(anfreihe, 2).Value = 0 And _
    Worksheets("Daten").Cells(anfreihe, 3).Value = 0 Then Konto_von = "": GoTo ende

GoTo ende

'Ab hier Unterrotinen
'****************************************************************************
sucheenddatum:  'Enddatum suchen wenn mehrere Eintr|fffd|ge aber das Datum nicht dabei steht
    endreihe = zaehlen + suchen
    For suchen = 1 To 20 'die n|fffd|chsten 20 Zeilen nach gefundenem Enddatum werden untersucht
        'erstes if beenden wenn n|fffd|chstes Enddatum gr|fffd||fffd|er als das Suchdatum
        'zweites if beenden wenn keine weiteren Eintr|fffd|ge mehr vorhanden
        'drittes if weiter z|fffd|hlen wenn das Suchdatum mehrmals hintereinander kommt
        'viertes if weiter z|fffd|hlen wenn die n|fffd|chsten Eintr|fffd|ge noch zum Suchdatum geh|fffd|ren aber das Datum nicht eingetragen ist
        If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value > enddatum Then _
            GoTo endgefunden _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = 0 & Worksheets("Daten").Cells _
            (zaehlen + suchen, 2) = "" Then GoTo endgefunden _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = edatum Then endreihe _
            = zaehlen + suchen _
            Else: If Worksheets("Daten").Cells(zaehlen + suchen, 1).Value = "" Then _
               If Worksheets("Daten").Cells(zaehlen + suchen, 2).Value > 0 Then endreihe = zaehlen + suchen
    Next
    GoTo endgefunden
    

datumnichtgefunden: 'Wenn Datum nicht gefunden wird, einfach beenden
GoTo ende
    
    
ende:
Application.Volatile
End Function

Public Function minInDez(ByVal minDez As Double) As Double
Dim std As Double
Dim min As Double
Dim laenge As Integer
Dim minus As Boolean
Dim komma As Double
Dim ergebniss As Double

'L|fffd|nge ermitteln
laenge = Len(minDez)


'schauen ob es ein Minuswert ist
If Left(minDez, 1) = "-" Then minus = True

'Kommaposition finden, gesucht von rechts
komma = InStr(minDez, ",")

'Min. ermitteln
If komma = 0 Then
        min = 0
    Else
        min = Mid(minDez, komma)
End If
        
'Std. ermitteln
If minus Then
        std = minDez * (-1) - min
    Else
        std = minDez - min
End If

'Stunden und Min als Dezimal zusammen f|fffd|hren
If minus Then
        ergebniss = (std + min / 60 * 100) * (-1)
    Else
        ergebniss = std + min / 60 * 100
End If



minInDez = ergebniss




End Function
Attribute VB_Name = "Modul3"
Option Explicit

Sub Dateneingabe()
Attribute Dateneingabe.VB_Description = "Starten des Dateineingabemaske f|fffd|r die Abrech.-|fffd|berstunden-Datei"
Attribute Dateneingabe.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Dateneingabe Makro
' Starten des Dateineingabemaske f|fffd|r die Abrech.-|fffd|berstunden-Datei
'

'
    Sheets("Daten").Select
    ActiveSheet.ShowDataForm
End Sub
Attribute VB_Name = "Modul4"
Option Explicit

Sub Berechnen_aus()
Attribute Berechnen_aus.VB_Description = "Makro am 26.03.2004 von Oswald Strodl aufgezeichnet"
Attribute Berechnen_aus.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Berechnen_aus Makro
' Makro am 26.03.2004 von Oswald Strodl aufgezeichnet
'

'
    With Application
        .Calculation = xlManual
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False
End Sub
Sub Berechnen_ein()
Attribute Berechnen_ein.VB_Description = "Makro am 26.03.2004 von Oswald Strodl aufgezeichnet"
Attribute Berechnen_ein.VB_ProcData.VB_Invoke_Func = " \n14"
'
' Berechnen_ein Makro
' Makro am 26.03.2004 von Oswald Strodl aufgezeichnet
'
Dim i As Integer
'
    With Application
        .Calculation = xlAutomatic
        .MaxChange = 0.001
    End With
    ActiveWorkbook.PrecisionAsDisplayed = False

End Sub
Public Function Pollux(ByVal tsuch As String, bl_wo As String, z_wo As String, w_oft As Integer) As Variant

On Error GoTo Fehler
    
'Suche
Dim rngZelle As Range
Dim intCount As Integer

For Each rngZelle In Worksheets(bl_wo).Range(z_wo)
    If rngZelle.Value = tsuch Then
        intCount = intCount + 1
        If intCount = w_oft Then
            Pollux = rngZelle.Offset(0, 1).Value
            Exit For
        End If
    End If
Next

GoTo ende1
          
Fehler:
MsgBox (Error)

ende1:

End Function

Public Function Pollux_Wo(ByVal tsuch As String, bl_wo As String, z_wo As String, w_oft As Integer) As Variant

On Error GoTo Fehler
    
'Suche
Dim rngZelle As Range
Dim intCount As Integer

For Each rngZelle In Worksheets(bl_wo).Range(z_wo)
    If rngZelle.Value = tsuch Then
        intCount = intCount + 1
        If intCount = w_oft Then
            Pollux = rngZelle.Offset(0, 16).Value
            Exit For
        End If
    End If
Next

GoTo ende1
          
Fehler:
MsgBox (Error)

ende1:

End Function
Attribute VB_Name = "Modul5"
Option Explicit


Public Sub Dateierstellen()
Dim lw As String, pfad As String, datei As String
Dim jahr As Integer
Dim lw_pfad As String

On Error GoTo ende
Application.ScreenUpdating = False
'Laufwerk und Pfad ermitteln
lw = Left(ActiveWorkbook.Path, 1)
pfad = ActiveWorkbook.Path

'Dateinamen zuweisen
datei = InputBox("Bitte den Namen der Datei eingeben", "Name f|fffd|r die Datei eingeben", "Zeiten")
'pr|fffd|fen ob Datei schon vorhanden ansonsten neue |fffd|ffnen
        
Workbooks.Add (xlWBATWorksheet)
ChDrive lw
ChDir pfad
ActiveWorkbook.SaveAs Filename:=datei & ".xls"
        
        

Dim tabname As String
'Daten kopieren und einf|fffd|gen
        'Vorderseite kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("Vorderseite").Activate
        Range("A1:Q72").Copy
        Workbooks(datei & ".xls").Activate
        Worksheets.Add after:=Sheets(1)
        ActiveSheet.name = "Abrechnung"
        Range("A1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        'Spaltenbreite festlegen
        tabname = ActiveSheet.name
        Worksheets(tabname).Columns("R:AZ").ColumnWidth = 0.5
        Worksheets(tabname).Columns("A:A").ColumnWidth = 11.89
        Worksheets(tabname).Columns("B:B").ColumnWidth = 8.58
        Worksheets(tabname).Columns("C:C").ColumnWidth = 9.67
        Worksheets(tabname).Columns("D:D").ColumnWidth = 12.89
        Worksheets(tabname).Columns("E:E").ColumnWidth = 4.78
        Worksheets(tabname).Columns("F:F").ColumnWidth = 4.89
        Worksheets(tabname).Columns("G:G").ColumnWidth = 9.67
        Worksheets(tabname).Columns("H:H").ColumnWidth = 7.11
        Worksheets(tabname).Columns("I:I").ColumnWidth = 5.89
        Worksheets(tabname).Columns("J:J").ColumnWidth = 1.11
        Worksheets(tabname).Columns("K:K").ColumnWidth = 7.11
        Worksheets(tabname).Columns("L:L").ColumnWidth = 5.78
        Worksheets(tabname).Columns("M:M").ColumnWidth = 1.67
        Worksheets(tabname).Columns("N:N").ColumnWidth = 13.78
        Worksheets(tabname).Columns("o:O").ColumnWidth = 3.33
        Worksheets(tabname).Columns("P:P").ColumnWidth = 9.89
        Worksheets(tabname).Columns("Q:Q").ColumnWidth = 1.89
        
        
        
        'R|fffd|ckseite 1 kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("R|fffd|ckseite 1").Activate
        Range("A1:I39").Copy
        Workbooks(datei & ".xls").Activate
'Worksheets.Add after:=Sheets(1)
        Range("BB1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        'Spaltenbreite anpassen
        tabname = ActiveSheet.name
        With Worksheets(tabname)
            .Columns("BB").ColumnWidth = 8.11
            .Columns("BC").ColumnWidth = 5.89
            .Columns("BD").ColumnWidth = 5.89
            .Columns("BE").ColumnWidth = 26.7
            .Columns("BF").ColumnWidth = 14.8
            .Columns("BG").ColumnWidth = 12.7
            .Columns("BH").ColumnWidth = 5.89
            .Columns("BI").ColumnWidth = 6.56
            .Columns("BJ").ColumnWidth = 6.78
        End With
        
        'R|fffd|ckseite 2 kopieren
        Workbooks("Abrechnung_|fffd|berstunden.xls").Activate
        ActiveWorkbook.Worksheets("R|fffd|ckseite 2").Activate
        Range("A1:I39").Copy
        Workbooks(datei & ".xls").Activate
'Worksheets.Add after:=Sheets(1)
        Range("BL1").Select
        Selection.PasteSpecial Paste:=xlValues
        Selection.PasteSpecial Paste:=xlPasteFormats
        Application.CutCopyMode = False
        'Spaltenbreite anpassen
        tabname = ActiveSheet.name
        With Worksheets(tabname)
            .Columns("BL").ColumnWidth = 8.11
            .Columns("BM").ColumnWidth = 5.89
            .Columns("BN").ColumnWidth = 5.89
            .Columns("BO").ColumnWidth = 26.7
            .Columns("BP").ColumnWidth = 14.8
            .Columns("BQ").ColumnWidth = 12.7
            .Columns("BR").ColumnWidth = 5.89
            .Columns("BS").ColumnWidth = 6.56
            .Columns("BT").ColumnWidth = 6.78
        End With


Range("A1").Select



'wechselt auf das Ursprungslaufwerk
ChDrive lw
'wechselt in das Ursprungsverzeichnis
ChDir pfad





'****************************************




'Datei speichern und schlie|fffd|en
    Application.DisplayAlerts = False
    ActiveWorkbook.Close savechanges:=True
    Application.DisplayAlerts = True
ende:
Application.ScreenUpdating = True
End Sub

Public Sub markierung()
Dim bereich1 As Range
Dim anfdatum1, enddatum1 As Date
'Dim enddatum1 As Date


For Each bereich1 In Selection
    If Not anfdatum1 > "" Then anfdatum1 = bereich1.Value
    If anfdatum1 > "" Then enddatum1 = bereich1.Value
Next
 Debug.Print anfdatum1
 Debug.Print enddatum1
 
Fehler:
 MsgBox (Error(Err))
End Sub

Public Sub inpfronten()

On Error GoTo Fehler
Dim anfang, enddatum As Date
Dim dmg, ort As String
Dim ldmg, lort As Integer 'wie lange sind die Eintr|fffd|ge

Worksheets("Daten").Activate


UserForm8.Show

If UserForm8.ComboBox1.Value = "schluss" Then GoTo schluss
'Falsche eingabe abfangen
anfang = UserForm8.TextBox1.Value
enddatum = UserForm8.TextBox2.Value
dmg = UserForm8.ComboBox1.Value
ort = UserForm8.ComboBox2.Value
Unload UserForm8

'L|fffd|nge der Eintr|fffd|ge ermitteln
ldmg = Len(dmg)
lort = Len(ort)

                'anfang = InputBox("Bitte Anfangsdatum eingaben!", "Anfangsdatum")
                'enddatum = InputBox("Bitte Enddatum eingeben!", "Enddatum")

'Anzahl der Zeilen ermitteln
Dim zeilen As Integer
zeilen = ActiveSheet.UsedRange.Rows.Count

'In Variable schreiben
Dim z|fffd|hler As Integer
Dim reiheanf, reiheend As Integer
Dim eintrag() As String

reiheanf = 0: reiheend = 0 'vordefinieren wegen abfrage
                'dmg = Worksheets("Einstellungen").Cells(10, 8).Value
                'ort = Worksheets("Einstellungen").Cells(10, 9).Value


Dim dd, de As Date 'Hilfsvariable f|fffd|r das Datum finden

For z|fffd|hler = 2 To zeilen
    dd = Worksheets("Daten").Cells(z|fffd|hler, 1).Value
    de = Worksheets("Daten").Cells(z|fffd|hler, 1).Value
    If CDate(dd) >= CDate(anfang) And reiheanf = 0 Then reiheanf = z|fffd|hler
    If CDate(enddatum) <= CDate(de) And reiheend = 0 Then reiheend = z|fffd|hler: GoTo weiter
    If Worksheets("Daten").Cells(z|fffd|hler + 1, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 2, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 3, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 4, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 5, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 6, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 7, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 8, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 9, 1).Value = CDate("00:00:00") And _
        Worksheets("Daten").Cells(z|fffd|hler + 10, 1).Value = CDate("00:00:00") Then reiheend = z|fffd|hler: GoTo weiter

Next


weiter:

'Tage in Pfronten finden
ReDim eintrag(reiheend - reiheanf, 2) As String 'Variable zum speichern der Tage in Pfronten
Dim reiheendz|fffd|hler, reiheanfz|fffd|hler, variablenz|fffd|hler As Integer
reiheendz|fffd|hler = reiheend
reiheanfz|fffd|hler = reiheanf
variablenz|fffd|hler = 0

Do While reiheanfz|fffd|hler < reiheendz|fffd|hler + 1

       
        If LCase(Left(Worksheets("Daten").Cells(reiheanfz|fffd|hler, 4).Value, ldmg)) = LCase(dmg) _
        And LCase(Left(Worksheets("Daten").Cells(reiheanfz|fffd|hler, 5).Value, lort)) = LCase(ort) _
        And Not Worksheets("Daten").Cells(reiheanfz|fffd|hler - 1, 1).Value = Worksheets("Daten").Cells(reiheanfz|fffd|hler, 1).Value Then _
            eintrag(variablenz|fffd|hler, 0) = Worksheets("Daten").Cells(reiheanfz|fffd|hler, 1).Value: _
            eintrag(variablenz|fffd|hler, 1) = Worksheets("Daten").Cells(reiheanfz|fffd|hler, 4).Value: _
            eintrag(variablenz|fffd|hler, 2) = Worksheets("Daten").Cells(reiheanfz|fffd|hler, 5).Value: _
            variablenz|fffd|hler = variablenz|fffd|hler + 1
            reiheanfz|fffd|hler = reiheanfz|fffd|hler + 1
            'Debug.Print Worksheets("Daten").Cells(reiheanfz|fffd|hler, 4).Value
            'Debug.Print Worksheets("Daten").Cells(reiheanfz|fffd|hler, 5).Value
Loop
'Anzahl der Tage festhalten
Dim tage As Integer
tage = variablenz|fffd|hler
    
'Tage in Pfronten in Tabellenblatt schreiben
Worksheets("46 Tage").Range("A1:F1000").Delete
Worksheets("46 Tage").Cells(2, 2).Value = Worksheets("Vorderseite").Cells(7, 9).Value
Worksheets("46 Tage").Cells(3, 2).Value = Worksheets("Vorderseite").Cells(8, 9).Value
Worksheets("46 Tage").Cells(5, 2).Value = "Anwesendheit in Pfronten"
Worksheets("46 Tage").Cells(6, 2).Value = "Von " & anfang & "bis " & enddatum
Worksheets("46 Tage").Cells(5, 4).Value = "Anzahl der Tage"
Worksheets("46 Tage").Cells(6, 4).Value = tage

'|fffd|berschrift formatieren
Worksheets("46 Tage").Cells(2, 2).Font.Bold = True
Worksheets("46 Tage").Cells(3, 2).Font.Bold = True
Worksheets("46 Tage").Cells(5, 2).Font.Bold = True
Worksheets("46 Tage").Cells(6, 2).Font.Bold = True
Worksheets("46 Tage").Cells(5, 4).Font.Bold = True
Worksheets("46 Tage").Cells(6, 4).Font.Bold = True

reiheendz|fffd|hler = reiheend + 1 - reiheanf
'If reiheendz|fffd|hler = 1 Then reiheanfz|fffd|hler = 0 Else reiheanfz|fffd|hler = 1
reiheanfz|fffd|hler = 1
variablenz|fffd|hler = 0
Do While reiheanfz|fffd|hler < reiheendz|fffd|hler + 1
    Worksheets("46 Tage").Cells(reiheanfz|fffd|hler + 7, 1).Value = eintrag(variablenz|fffd|hler, 0)
    Worksheets("46 Tage").Cells(reiheanfz|fffd|hler + 7, 2).Value = eintrag(variablenz|fffd|hler, 1)
    Worksheets("46 Tage").Cells(reiheanfz|fffd|hler + 7, 3).Value = eintrag(variablenz|fffd|hler, 2)
    variablenz|fffd|hler = variablenz|fffd|hler + 1
    reiheanfz|fffd|hler = reiheanfz|fffd|hler + 1
Loop

GoTo schluss
Fehler:
MsgBox ("Bitte richtige Daten eingeben!!")
Unload UserForm8


schluss:
Worksheets("46 Tage").Activate
End Sub


Public Sub Doppelseitig()

'Abrechnungsbetrag und Kalenderwoche nach "|fffd|berweisung" kopieren
'Anzahl der Eintr|fffd|ge ermitteln
Dim zeilen As Long
zeilen = Worksheets("|fffd|berweisungen").Cells(Rows.Count, 1).End(xlUp).Row
If zeilen = 100 Then MsgBox ("|fffd|berweisungsliste ist voll!" & Chr(13) & _
                            "Bitte im Tabellenblatt '|fffd|berweisung' zuerst die Eintr|fffd|ge l|fffd|schen!"): Exit Sub
'eine zeile dazuz|fffd|hlen
zeilen = zeilen + 1

'Werte aus Abrechnung hollen
Dim betrag As Double
Dim kalenderwo As String
    'if deshalb weil wenn Betragszelle leer ist ein fehler gekommen ist
    If Worksheets("Vorderseite").Cells(66, 14).Value = "" Then
    betrag = 0
    Else
    betrag = Worksheets("Vorderseite").Cells(66, 14).Value
    End If
kalenderwo = Worksheets("R|fffd|ckseite 1").Cells(1, 7).Value

'schreiben in |fffd|berweisungen
Worksheets("|fffd|berweisungen").Cells(zeilen, 1).Value = "KW " & kalenderwo
Worksheets("|fffd|berweisungen").Cells(zeilen, 2).Value = betrag
'****************************************************************************


'Bitte warten anzeigen
UserForm6.Show vbModeless 'vbModeless bewirkt das das Makro im Hintergrund weiter l|fffd|uft
DoEvents 'bewirkt das nicht nur die Kopfzeile angezeigt wird
Application.ScreenUpdating = False



'Tabellenbl|fffd|tter markieren und ausdrucken.
'dazu muss muss vorher, manuel, bei jedem Tabellenblatt einmal in den Druckeinstellungen auf Doppelseitig drucken gestellt werden
Sheets(Array("Vorderseite", "R|fffd|ckseite 1")).Select

 Application.Dialogs(xlDialogPrint).Show
 
 'Abfrage ob R|fffd|ckseite2 beschrieben
Dim r2 As Integer
If Not Worksheets("R|fffd|ckseite 2").Cells(3, 2).Value > "" Then GoTo ende
'R|fffd|ckseite2 drucken
r2 = MsgBox("Soll die R|fffd|ckseite 2 gedruckt werden?", vbYesNo, "Drucken der Abrechnung")
If r2 = 6 Then ActiveWorkbook.Worksheets("R|fffd|ckseite 2").PrintOut
ende:

'Wenn gew|fffd|nscht gleich Abrechnung speichern
If Worksheets("Einstellungen").Cells(12, 7).Value = 1 Then Call Speichern_Abrechnungen


ActiveWorkbook.Worksheets("Daten").Activate
Application.ScreenUpdating = True
Unload UserForm6
 
End Sub
Attribute VB_Name = "Tabelle1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle26"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle27"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle28"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private Sub Worksheet_Activate()
Worksheets("|fffd|berstd.").EnableCalculation = False

End Sub

Private Sub Worksheet_Deactivate()
Worksheets("|fffd|berstd.").EnableCalculation = True

End Sub


Attribute VB_Name = "Tabelle5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit


Attribute VB_Name = "Tabelle6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle67"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit



Attribute VB_Name = "Tabelle8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Tabelle9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "UserForm1"
Attribute VB_Base = "0{7E11D6D0-7533-415C-9296-DC7BC71199A8}{8074D9E8-FD9B-4331-BB88-5E6D4CD3DDF8}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub CommandButton1_Click()
UserForm1.Hide
End Sub

Attribute VB_Name = "UserForm2"
Attribute VB_Base = "0{72D12D95-8EFE-4C98-A1B6-EBFA2DA77640}{FA43D5E1-350A-48B7-A573-32023063D5BB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Dim rng As Range 'f|fffd|r Maschinennr. suchen
Dim rngd As Range 'f|fffd|r Datum suchen
Dim rngk As Range 'f|fffd|r Kunden suchen



Private Sub CommandButton1_Click() '|fffd|bernehmen
Dim frm As Variant
Dim datum As Date
Set frm = UserForm2
    Sheets("Daten").Activate
    Range("B65536").End(xlUp).Offset(1, -1).Select 'sucht letzte freie Zeile in Spalte B
    'Werte werden aus dem Formular in die Tablle |fffd|bertragen
    With frm
        If Not frm.TextBox1.Value = "" Then datum = .TextBox1.Value: ActiveCell.Value = datum
        ActiveCell.Offset(0, 1).Value = .TextBox2.Value
        ActiveCell.Offset(0, 2).Value = .TextBox3.Value
        ActiveCell.Offset(0, 3).Value = .TextBox4.Value
        ActiveCell.Offset(0, 4).Value = .TextBox5.Value
        ActiveCell.Offset(0, 5).Value = .TextBox8.Value
        ActiveCell.Offset(0, 6).Value = .TextBox9.Value
        ActiveCell.Offset(0, 7).Value = .TextBox6.Value
        ActiveCell.Offset(0, 8).Value = .TextBox7.Value
        If .TextBox12.Value = "" Then .TextBox12.Value = "DE"
        ActiveCell.Offset(0, 10).Value = .TextBox12.Value 'L|fffd|nderk|fffd|rzel
    End With
    'Formel f|fffd|r Feiertag wird eins nach unten kopiert
    ActiveCell.Offset(-1, 9).Copy
    ActiveCell.Offset(0, 9).PasteSpecial
    ActiveCell.Offset(0, -9).Select
    
'Felder l|fffd|schen rausgenommen ist bequemer so
'Dim tb As Object
'For Each tb In UserForm2.Controls
'    If TypeName(tb) = "TextBox" Then tb.Text = ""
'Next tb

'Focus auf Datumsfeld setzten und Courser hinter den Tag
UserForm2.TextBox1.SetFocus
UserForm2.TextBox1.SelStart = 2
End Sub

Private Sub CommandButton10_Click() 'Eingabefelder l|fffd|schen
Dim tb As Object
For Each tb In UserForm2.Controls
    If TypeName(tb) = "TextBox" Then tb.text = ""
Next tb
End Sub

Private Sub CommandButton11_Click() 'Zeile l|fffd|schen
Dim spalte As Integer
spalte = ActiveCell.Column 'feststellen in welcher Spalte die ActiveCelle ist
If spalte > 1 Then spalte = (spalte - 1) * (-1) Else spalte = 0 'Spalte auf die erste Spalte setzten
ActiveCell.Offset(-1, spalte).Select
Worksheets("Daten").Rows(ActiveCell.Row + 1).Delete
End Sub

Private Sub CommandButton12_Click()
If UserForm2.TextBox2.Value = "" Or UserForm2.TextBox3.Value = "" Then GoTo weiter
UserForm3.TextBox5 = (CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24
weiter:
UserForm3.Show
End Sub

Private Sub CommandButton13_Click()
UserForm2.TextBox4 = "DMG Service Fr|fffd|sen Pfronten"
UserForm2.TextBox5 = "87459 Pfronten"
End Sub

Private Sub CommandButton2_Click() 'Abbrechen
'Formular wir ausgeblendet (mit unload me w|fffd|rde es aus dem Speicher gel|fffd|scht)
UserForm2.Hide
End Sub

Private Sub CommandButton3_Click() 'Datum suchen
Dim frm As Variant
Dim suchen As Date
Dim rngA As Range
Set frm = UserForm2
On Error GoTo Fehler
If rngd Is Nothing Then
Set rngA = Sheets("Daten").Range("A65536")
Else
Set rngA = rngd
End If
suchen = UserForm2.TextBox10.Value
Set rngd = Sheets("Daten").Range("A:A").Find(what:=suchen, _
after:=rngA, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
With frm
    .TextBox1.Value = rngd.Value  'Datum
    .TextBox2.Value = Format(rngd.Offset(0, 1).Value, "hh:mm") 'Zeit von
    .TextBox3.Value = Format(rngd.Offset(0, 2).Value, "hh:mm") 'Zeit bis
    .TextBox4.Value = rngd.Offset(0, 3).Value 'Kunde
    .TextBox5.Value = rngd.Offset(0, 4).Value 'Ort / Land
    .TextBox8.Value = rngd.Offset(0, 5).Value 'Maschinennummer
    .TextBox9.Value = rngd.Offset(0, 6).Value 'PKW KM
    .TextBox6.Value = rngd.Offset(0, 7).Value 'Pause
    .TextBox7.Value = rngd.Offset(0, 8).Value 'Spesen
    .TextBox12.Value = rngd.Offset(0, 10).Value 'L|fffd|nderk|fffd|rzel
End With
rngd.Select 'markiert die gefundene Zeiele in dem die aktive Zelle daruf gesetzt wird
Exit Sub
Fehler:
MsgBox ("Das Datum " & frm.TextBox1.Value & " konnte nicht gefunden werden!")

End Sub

Private Sub CommandButton4_Click() 'Maschinennr. suchen
Dim frm As Variant
Dim suchen As String
Dim rngA As Range
Set frm = UserForm2
On Error GoTo Fehler
If rng Is Nothing Then
Set rngA = Sheets("Daten").Range("F65536")
Else
Set rngA = rng
End If
suchen = UserForm2.TextBox10.Value 'Maschinennr. zuweisen
Set rng = Sheets("Daten").Range("F:F").Find(what:=suchen, _
after:=rngA, _
LookAt:=xlPart, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
With frm
.TextBox1.Value = rng.Offset(0, -5).Value 'Datum
.TextBox2.Value = Format(rng.Offset(0, -4).Value, "hh:mm") 'Zeit von
.TextBox3.Value = Format(rng.Offset(0, -3).Value, "hh:mm") 'Zeit bis
.TextBox4.Value = rng.Offset(0, -2).Value 'Kunde
.TextBox5.Value = rng.Offset(0, -1).Value 'Ort / Land
.TextBox8.Value = rng.Value 'Maschinennummer
.TextBox9.Value = rng.Offset(0, 1).Value 'PKW KM
.TextBox6.Value = rng.Offset(0, 2).Value 'Pause
.TextBox7.Value = rng.Offset(0, 3).Value 'Spesen
.TextBox12.Value = rng.Offset(0, 5).Value 'L|fffd|nderk|fffd|rzel
End With
rng.Offset(0, -5).Select 'markiert die gefundene Zeile indem die aktive Zelle auf die erste Spalte gesetzt wird
Exit Sub
Fehler:
MsgBox ("Die Maschinennr. " & frm.TextBox1.Value & " konnte nicht gefunden werden!")

End Sub


Private Sub CommandButton5_Click() 'Kunde suchen
Dim frm As Variant
Dim suchen As String
Dim rngA As Range
Set frm = UserForm2
On Error GoTo Fehler
If rngk Is Nothing Then
Set rngA = Sheets("Daten").Range("D65536")
Else
Set rngA = rngk
End If
suchen = UserForm2.TextBox10.Value 'Kunde zuweisen
Set rngk = Sheets("Daten").Range("D:D").Find(what:=suchen, _
after:=rngA, _
LookAt:=xlPart, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
With frm
.TextBox1.Value = rngk.Offset(0, -3).Value  'Datum
    .TextBox2.Value = Format(rngk.Offset(0, -2).Value, "hh:mm") 'Zeit von
    .TextBox3.Value = Format(rngk.Offset(0, -1).Value, "hh:mm") 'Zeit bis
    .TextBox4.Value = rngk.Value 'Kunde
    .TextBox5.Value = rngk.Offset(0, 1).Value 'Ort / Land
    .TextBox8.Value = rngk.Offset(0, 2).Value 'Maschinennummer
    .TextBox9.Value = rngk.Offset(0, 3).Value 'PKW KM
    .TextBox6.Value = rngk.Offset(0, 4).Value 'Pause
    .TextBox7.Value = rngk.Offset(0, 5).Value 'Spesen
    .TextBox12.Value = rngk.Offset(0, 7).Value 'L|fffd|nderk|fffd|rzel

End With
rngk.Offset(0, -3).Select 'markiert die gefundene Zeile indem die aktive Zelle auf die erste Spalte gesetzt wird
Exit Sub
Fehler:
MsgBox ("Der Kunde " & frm.TextBox1.Value & " konnte nicht gefunden werden!")

End Sub


Private Sub CommandButton6_Click() 'R|fffd|ckw|fffd|rtsbl|fffd|ttern
Dim spalte As Integer
Dim frm As Variant
Set frm = UserForm2
spalte = ActiveCell.Column 'feststellen in welcher Spalte die ActiveCelle ist
If spalte > 1 Then spalte = (spalte - 1) * (-1) Else spalte = 0 'Spalte auf die erste Spalte setzten
ActiveCell.Offset(-1, spalte).Select
With frm
    .TextBox1.Value = ActiveCell.Value  'Datum
    .TextBox2.Value = Format(ActiveCell.Offset(0, 1).Value, "hh:mm") 'Zeit von
    .TextBox3.Value = Format(ActiveCell.Offset(0, 2).Value, "hh:mm") 'Zeit bis
    .TextBox4.Value = ActiveCell.Offset(0, 3).Value 'Kunde
    .TextBox5.Value = ActiveCell.Offset(0, 4).Value 'Ort / Land
    .TextBox8.Value = ActiveCell.Offset(0, 5).Value 'Maschinennummer
    .TextBox9.Value = ActiveCell.Offset(0, 6).Value 'PKW KM
    .TextBox6.Value = ActiveCell.Offset(0, 7).Value 'Pause
    .TextBox7.Value = ActiveCell.Offset(0, 8).Value 'Spesen
    .TextBox12.Value = ActiveCell.Offset(0, 10).Value 'L|fffd|nderk|fffd|rzel
End With

End Sub

Private Sub CommandButton7_Click() 'Vorw|fffd|rtsbl|fffd|ttern
Dim spalte As Integer
Dim frm As Variant
Set frm = UserForm2
spalte = ActiveCell.Column 'feststellen in welcher Spalte die ActiveCelle ist
If spalte > 1 Then spalte = (spalte - 1) * (-1) Else spalte = 0 'Spalte auf die erste Spalte setzten
ActiveCell.Offset(1, spalte).Select
With frm
    .TextBox1.Value = ActiveCell.Value  'Datum
    .TextBox2.Value = Format(ActiveCell.Offset(0, 1).Value, "hh:mm") 'Zeit von
    .TextBox3.Value = Format(ActiveCell.Offset(0, 2).Value, "hh:mm") 'Zeit bis
    .TextBox4.Value = ActiveCell.Offset(0, 3).Value 'Kunde
    .TextBox5.Value = ActiveCell.Offset(0, 4).Value 'Ort / Land
    .TextBox8.Value = ActiveCell.Offset(0, 5).Value 'Maschinennummer
    .TextBox9.Value = ActiveCell.Offset(0, 6).Value 'PKW KM
    .TextBox6.Value = ActiveCell.Offset(0, 7).Value 'Pause
    .TextBox7.Value = ActiveCell.Offset(0, 8).Value 'Spesen
    .TextBox12.Value = ActiveCell.Offset(0, 10).Value 'L|fffd|nderk|fffd|rzel
    
    
End With


End Sub

Private Sub CommandButton8_Click() '|fffd|nderung speichern
Dim spalte As Integer
Dim frm As Variant
Dim datum As Date
Set frm = UserForm2
spalte = ActiveCell.Column 'feststellen in welcher Spalte die ActiveCelle ist
If spalte > 1 Then spalte = (spalte - 1) * (-1) Else spalte = 0 'Spalte auf die erste Spalte setzten
ActiveCell.Offset(0, spalte).Select
With frm
    If Not frm.TextBox1.Value = "" Then datum = .TextBox1.Value: ActiveCell.Value = datum
     ActiveCell.Offset(0, 1).Value = .TextBox2.Value 'Zeit von
     ActiveCell.Offset(0, 2).Value = .TextBox3.Value 'Zeit bis
     ActiveCell.Offset(0, 3).Value = .TextBox4.Value 'Kunde
     ActiveCell.Offset(0, 4).Value = .TextBox5.Value 'Ort / Land
     ActiveCell.Offset(0, 5).Value = .TextBox8.Value 'Maschinennummer
     ActiveCell.Offset(0, 6).Value = .TextBox9.Value 'PKW KM
     ActiveCell.Offset(0, 7).Value = .TextBox6.Value 'Pause
     ActiveCell.Offset(0, 8).Value = .TextBox7.Value 'Spesen
     ActiveCell.Offset(0, 10).Value = .TextBox12.Value 'L|fffd|nderk|fffd|rzel
End With
End Sub

Private Sub CommandButton9_Click() 'Zeile nach der aktuellen Zeile einf|fffd|gen
Dim reihe As Integer
reihe = ActiveCell.Row
Worksheets("Daten").Rows(reihe + 1).Insert
ActiveCell.Offset(1, 0).Select
'Formel f|fffd|r Feiertag wird eins nach unten kopiert
    ActiveCell.Offset(-1, 9).Copy
    ActiveCell.Offset(0, 9).PasteSpecial
    ActiveCell.Offset(0, -9).Select
End Sub


Private Sub Label14_Click()

End Sub

Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)

On Error GoTo weiter
'Beim verlassen wird die ges. Zeit berechnent
If UserForm2.TextBox2.Value = "" Or UserForm2.TextBox3.Value = "" Then UserForm2.TextBox11 = "": GoTo weiter

'Abfangen wenn 0 Uhr eingetragen ist
If CDate(UserForm2.TextBox3) < CDate(UserForm2.TextBox2) Then UserForm2.TextBox11 = _
Round((((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24) + 24), 2): GoTo weiter
Dim test As Integer
UserForm2.TextBox11 = Round(((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24), 2)

weiter:
End Sub


Private Sub TextBox2_Change()
'Beim |fffd|nderung der Zeit bis wird die ges. Zeit neu berechnet (beim duchbl|fffd|ttern)
On Error GoTo weiter
If UserForm2.TextBox2.Value = "" Or UserForm2.TextBox3.Value = "" Then GoTo weiter

'Abfangen wenn 0 Uhr eingetragen ist
If CDate(UserForm2.TextBox3) < CDate(UserForm2.TextBox2) Then UserForm2.TextBox11 = _
Round((((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24) + 24), 2): GoTo weiter

UserForm2.TextBox11 = Round(((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24), 2)
weiter:
End Sub
Private Sub TextBox3_Change()
'Beim |fffd|nderung der Zeit bis wird die ges. Zeit neu berechnet (beim duchbl|fffd|ttern)
On Error GoTo weiter
If UserForm2.TextBox2.Value = "" Or UserForm2.TextBox3.Value = "" Then UserForm2.TextBox11 = "": GoTo weiter

'Abfangen wenn 0 Uhr eingetragen ist
If CDate(UserForm2.TextBox3) < CDate(UserForm2.TextBox2) Then UserForm2.TextBox11 = _
Round((((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24) + 24), 2): GoTo weiter

UserForm2.TextBox11 = Round(((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24), 2)
weiter:
End Sub

Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)

On Error GoTo weiter
'Beim verlassen wird die ges. Zeit berechnent
If UserForm2.TextBox2.Value = "" Or UserForm2.TextBox3.Value = "" Then GoTo weiter

'Abfangen wenn 0 Uhr eingetragen ist
If CDate(UserForm2.TextBox3) < CDate(UserForm2.TextBox2) Then UserForm2.TextBox11 = _
Round((((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24) + 24), 2): GoTo weiter

'If UserForm2.TextBox3 = CDate(0) Then UserForm2.TextBox11 = _
((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24) + 24: GoTo weiter

UserForm2.TextBox11 = Round(((CDate(UserForm2.TextBox3) - CDate(UserForm2.TextBox2)) * 24), 2)
weiter:
End Sub

Private Sub TextBox4_Change()

End Sub
Attribute VB_Name = "UserForm3"
Attribute VB_Base = "0{F1E36AD7-92D1-4B7A-B9C0-8BC6C1FC289B}{E0DC4A4B-30C5-49FC-9715-8740D9A65E95}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub CommandButton1_Click()
UserForm3.Hide
End Sub

Private Sub ListBox1_AfterUpdate()
Dim such As Range
Dim liste As String
'suchen der Spesen f|fffd|r das Land aus ListBox1, 8 bis 14 Std.
liste = UserForm3.ListBox1.Value
Set such = Sheets("Spesen_Pauschalen").Range("A3:A239").Find(what:=liste, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
UserForm3.TextBox1.Value = such.Offset(0, 3)

'suchen der Spesen f|fffd|r das Land aus ListBox1, |fffd|ber 14 Std.
liste = UserForm3.ListBox1.Value
Set such = Sheets("Spesen_Pauschalen").Range("A3:A239").Find(what:=liste, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
UserForm3.TextBox2.Value = such.Offset(0, 2)

'suchen der Spesen f|fffd|r das Land aus ListBox1, |fffd|ber 24 Std.
liste = UserForm3.ListBox1.Value
Set such = Sheets("Spesen_Pauschalen").Range("A3:A239").Find(what:=liste, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
UserForm3.TextBox3.Value = such.Offset(0, 1)

'Suchen der Pauschale f|fffd|r das Land aus ListBox1
liste = UserForm3.ListBox1.Value
Set such = Sheets("Spesen_Pauschalen").Range("A3:A239").Find(what:=liste, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
UserForm3.TextBox4.Value = such.Offset(0, 4)

'Suche des Landeskurzzeichen f|fffd|r das Land aus Listbox1
liste = UserForm3.ListBox1.Value
Set such = Sheets("Spesen_Pauschalen").Range("A3:A239").Find(what:=liste, _
LookAt:=xlWhole, SearchOrder:=xlByRows, _
SearchDirection:=xlNext, MatchCase:=False)
UserForm3.TextBox6.Value = such.Offset(0, 5)

End Sub



Private Sub OptionButton1_Click()
UserForm2.TextBox7.Value = UserForm3.TextBox1
UserForm2.TextBox12.Value = UserForm3.TextBox6
End Sub

Private Sub OptionButton2_Click()
UserForm2.TextBox7.Value = UserForm3.TextBox2
UserForm2.TextBox12.Value = UserForm3.TextBox6
End Sub

Private Sub OptionButton3_Click()
UserForm2.TextBox7.Value = UserForm3.TextBox3
UserForm2.TextBox12.Value = UserForm3.TextBox6
End Sub

Private Sub UserForm_Initialize()
'hollt die Eintr|fffd|ge aus dem Tabellenblatt "Spesen_Pauschalen" und tr|fffd|gt sie in die Listbox ein
Dim i As Integer

   i = ActiveSheet.UsedRange.Rows.Count
   With UserForm3.ListBox1
       .RowSource = "Spesen_Pauschalen!A3:A" & i
   End With
   

End Sub
Attribute VB_Name = "UserForm4"
Attribute VB_Base = "0{AE114DA4-C9EA-4239-BDD8-A97E0907ED86}{EB5C8EC8-8359-4793-B525-57A34876CBE5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Attribute VB_Name = "UserForm5"
Attribute VB_Base = "0{DC5D0000-8DC7-4DEB-A7BE-22A7EE20D1DF}{72C432B8-E09F-45A1-95E2-6706443E31B3}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Attribute VB_Name = "UserForm6"
Attribute VB_Base = "0{D62099DB-533A-444D-8565-27CB32ED5118}{8D635082-9552-45B2-B15A-6E5FF43EB47F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Attribute VB_Name = "UserForm7"
Attribute VB_Base = "0{8D0BBC64-235D-4E86-BDBB-99448BF4C2B4}{64EF3556-4845-4592-A945-C53635C15BC6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Private Sub CommandButton1_Click()
Unload UserForm7
End Sub
Attribute VB_Name = "UserForm8"
Attribute VB_Base = "0{07C878C7-E09B-413A-8283-04067F64DCE8}{E00C3A37-17E8-41BB-8CD0-C22B54F78419}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Sub CommandButton1_Click()
UserForm8.Hide
End Sub

Private Sub CommandButton2_Click()
UserForm8.Hide
UserForm8.ComboBox1.Value = "schluss"
End Sub

Private Sub UserForm_Activate()
UserForm8.ComboBox1.Value = ""
UserForm8.ComboBox1.AddItem "DMG Service Fr|fffd|sen Pfronten"
UserForm8.ComboBox2.AddItem "87459 Pfronten"
End Sub


INQUEST-PP=macro
