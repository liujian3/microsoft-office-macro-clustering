Attribute VB_Name = "Module1"
Public Const Blue = 5
Public Const Red = 4
Public upliftRow As Range

'Region Definition

Public Const APAC_DIRECT As String = "AsiaPac Direct"
Public Const APAC_INDIRECT As String = "AP Indirect"
Public Const EMEA_DIRECT As String = "EMEA Direct"
Public Const EMEA_INDIRECT As String = "EMEA INDIRECT"
Public Const MALAYSIA As String = "Malaysia"
Public Const LATIN_AMERICA As String = "Latin America"
Public Const CANADA As String = "Canada"
Public Const US As String = "US"
Public Const INDONESIA  As String = "Indonesia"
Public Const JAPAN  As String = "Japan"
Public Const BRAZIL  As String = "Brazil"
'Govind- Added this public field for APJ 3.1 Rel for BR 5.11 (CR 40736)
Public Const INDIA  As String = "India"

Public isUpliftCalculated As Boolean
'JP:158210:CR 157622: CM export- give user the possibility of hiding or unhiding the rows for freights and taxes
Public isHiddenTax As Boolean

Public ColNames As Variant
Public currentQuarterRowNum As Integer
Public hedgeRateProcessRowNum As Integer

'JP: Brazil Uplift
Dim brazilRownum As Integer
Public noOfAmerCosts As Integer

Public regionalPricingStartCol As Integer
Public noOfRegions As Integer
Public noOfEmeaCosts As Integer
'Govind Added this 2 fields for APJ 3.1 Rel
Public noOfAPJPricing As Integer
Public noOfNAPricing As Integer
Public startingRow As Integer
Public startingRowOffset As Integer
Public isInternalReport As Boolean
'Govind-Added this public field for APJ 3.1 Rel for BR 5.21 (CR 40736)

Public APFreightTaxesStartCol As Integer

Public Header_Loaded, Uplift_Loaded, ConfigLines_Loaded, SKUList_Loaded, HedgeRate_Loaded, HedgeRate_Populated, ConfigLabelList_Loaded As Boolean
Public s As Integer
Public pricingCurrency As String
Public multiplyFactor As Double
Public hedgeRateRowNum As Integer
Public isReportProcessed As String
Public noOfTimes As Integer
'Govind - Added below as part of APJ 3.1 changes done
Public noOfAPJCosts As Integer
Public ChasisSelection As String
'Govind - Added below as part of APJ 3.1 changes done
Public Const YES As String = "Yes"
Public Const NO As String = "No"
'Govind - Addition for APJ 3.1 ends here


Public Sub processReport()
    
    If isReportProcessed = vbNullString Then
        'MsgBox " Starting processReport isReportProcessed is null "
        isReportProcessed = "False"
    End If

If Header_Loaded = True And ConfigLines_Loaded = True And SKUList_Loaded = True And Uplift_Loaded = True And HedgeRate_Loaded = True And isReportProcessed = "False" And ConfigLabelList_Loaded = True Then
        Dim sngStart As Single, sngEnd As Single
        Dim sngElapsed As Single
        sngStart = Timer
        noOfTimes = noOfTimes + 1
        isReportProcessed = "True"
        If SKUList_Loaded = True Then
            SortSKUList
            updateSkuLabels
        End If
        isInternalReport = False
        regionalPricingStartCol = 6
        'Author Govind
        'Increased noOfRegions value from 14 to 15 For APJ 3.1 Rel to include the APJ pricing columns
        noOfRegions = 15
        'End
        'BR 9.15 Add RUB to CP and CM exports
        'Modified  noOfEmeaCosts value from 9 to 10
        noOfEmeaCosts = 10
        'End of BR 9.15 Changes
        
        'Author Govind
        'Assigned value 24 to include the APJ Pricing in local Curr(12)+ APJ Pricing USD(12)
        noOfAPJPricing = 24
        'Assigned value 2 to include the NA Pricing(2)
        noOfNAPricing = 2
        'JP 7 currencies added and number of currencies
        noOfAmerCosts = 7
        'Assigned Freight value to include the freights for APJ 3.1 Rel
        APFreightTaxesStartCol = 30
        startingRow = 19
        startingRowOffset = startingRow - 1
        'APJ 3.1 Rel increased the below ColNames from 'az' to 'bm' to include APJ sections
        'Author Govind
        'ColNames = Array("a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "aa", "ab", "ac", "ad", "ae", "af", "ag", "ah", "ai", "aj", "ak", "al", "am", "an", "ao", "ap", "aq", "ar", "as", "at", "au", "av", "aw", "ax", "ay", "az", "ba", "bb", "bc", "bd", "be", "bf", "bg", "bh", "bi", "bj", "bk", "bl", "bm")
        'JP: Brazil uplift Added 7 Currencies
        ColNames = Array("a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "aa", "ab", "ac", "ad", "ae", "af", "ag", "ah", "ai", "aj", "ak", "al", "am", "an", "ao", "ap", "aq", "ar", "as", "at", "au", "av", "aw", "ax", "ay", "az", "ba", "bb", "bc", "bd", "be", "bf", "bg", "bh", "bi")
        
        'APJ 3.1 Rel added below 12 vlaue to add the duties to options and upgrades
        noOfAPJCosts = 12
        calculateUplift
        createHeader
        processHedgeRate
        hedgeRateRowNum = HedgeRateRow(pricingCurrency)
        clearReportCells
        If (currentQuarterRowNum > 0 And HedgeRate_Populated = True) Then
            ProcessCells
        End If
        hideWorksheets
        Worksheets("Global Price").Activate
        ActiveWindow.DisplayGridlines = False
        hideGridLine
        formatQuarter
        Range("A3").Select
        clearListPrice
        sngEnd = Timer
        sngElapsed = Format(sngEnd - sngStart, "Fixed")
        'MsgBox " Time taken for Macro : " & sngElapsed
        'MsgBox "No of times Executed: " & noOfTimes & ""
        
        'JP: Task 3068027:Dev->> Deal Currency Matrix - Zero is showing from AE to AP Column
        Application.Calculation = xlCalculationAutomatic
  End If
End Sub

Public Sub hideGridLine()
 ActiveWindow.DisplayGridlines = False
End Sub

Public Sub formatQuarter()
    Dim formatRange As Range
    Set formatRange = Worksheets("Global Price").Range("E5:I5")
    formatRange.Font.Name = "Arial"
    formatRange.Font.Bold = True
    formatRange.Font.Size = 11
    formatPricingEffective
End Sub

Public Sub ProcessCells()

Dim LIGroup As Range
Dim currGroup As String
Dim lastGroup As String
Dim isFirstConfig As Boolean
Dim currConfig As String
Dim currConfigVID As String
Dim lastConfig As String
Dim currQuoteNumber As String
Dim lastQuoteNumber As String

'Config Variables
Dim configRow As Integer
Dim configCol As Integer
Dim ConfigSheet As Worksheet
Dim BaseSellingPrice As Currency
Dim ConfigListPrice As Currency

'SKU Variables
Dim skuLists As Range
Dim srcRange As Range
Dim isFirstSKUList As Boolean
Dim rownum As Integer
Dim colnum As Integer
Dim currSKUType As String
Dim lastSKUType As String
Dim tempRange As Range
Dim HedgeRateCell As Range
Dim HedgeRateCell1 As Range
Dim currLineId As String
Dim prevLineId As String
Dim BRLQuery As String
'JP: 2105656:To add formula to auto select the |fffd|Chassis Code|fffd| in currency matrix file - APJ
Dim ChassisCode As Range
Dim ConfigDescStr As String
Dim CountRownum As Integer
Dim resultStr As String
Dim APJFrieghtDutiesTotalRows As Integer

'JP: Change Request 3097039:Currency matrix& cost package macro code update
Dim BrazilUpliftTotalRows As Integer
Dim BrazilUpliftColumn As Range

'Govind - APJ 3.1: Variable added to maintain the chasisRow & GCPRow info for each config in the Deal
Dim chasisRownum As Integer
Dim gcpRownum As Integer
Dim taxesRowNum As Integer
'Maintaining flag to identify if GCPSKU already found for a config
Dim isGCPSKUFound As String
'Variable to create Match formula for GCP Flag, added to avoid clutering and unreadable code.
Dim gcpMatchFormula As String
'End of varaiable addition for APJ 3.1

'Set row height and column widths
formatReport
regionalPricingStartCol = 6

Set HedgeRateCell = Worksheets("Global Price").Range("u4")
If HedgeRateCell.Value = "Current" Then
    hedgeRateProcessRowNum = currentQuarterRowNum
    Else
    hedgeRateProcessRowNum = currentQuarterRowNum + 1
End If

upliftRange = Worksheets("TempSheet").Range("2:2")
skuListRow = 0
Set startCell = Worksheets("Global Price").Range("a19")
row = 0
col = 0

'Set HedgeRateCell1 = Worksheets("Global Price").Range("B10")

' MsgBox HedgeRateCell1.Value


'Initialize Ranges for various Sheets
Set ConfigSheet = Worksheets("ConfigLines")
ConfigSheet.Activate
 
Set skuLists = Worksheets("SKUList").Range("a2")

'JP: 2105656:To add formula to auto select the |fffd|Chassis Code|fffd| in currency matrix file - APJ
Set ChassisCode = Worksheets("APJ freights and duties").Range("c15")
APJFrieghtDutiesTotalRows = 500

'JP: Change Request 3097039:Currency matrix& cost package macro code update
Set BrazilUpliftColumn = Worksheets("Brazil uplift").Range("A1")
BrazilUpliftTotalRows = 500


Set LIGroup = Columns("A:A")
LIGroup.Select
 
configRow = 0
configCol = 0

Dim currLIGroup As String
Dim prevLIGroup As String
Dim isFirstLIGroup As Boolean

isFirstLIGroup = True

Dim groupReset As Boolean
groupReset = True

For Each LIGroup In Selection

If isFirstLIGroup Then
    prevLIGroup = ""
    isFirstLIGroup = False
End If

'Non Primary quotes were not being exported.
'This makes sure reseting of the quote will export the quote


lastSKUType = ""
If LIGroup.Value > 0 And LIGroup.Value <> "GroupName" And Not IsEmpty(LIGroup.Offset(0, 2)) Then

    currLIGroup = LIGroup.Value
    currLineId = LIGroup.Offset(0, 12).Value
    
    'Multiple configs reported due to this
    ' - in production - BJRT
    
    If (currLIGroup <> prevLIGroup Or groupReset = True) And currLineId <> prevLineId Then
        groupReset = False
     
        'set value for
        '1. Group Name
        '2. Config
        '3. Config Description
        '#Total Rows added = 3
        
        startCell.Offset(row, col).Value = "Group"
        startCell.Offset(row, col).EntireRow.Font.Name = "Arial"
        startCell.Offset(row, col).EntireRow.Font.Bold = True
        startCell.Offset(row, col).EntireRow.Font.Size = 10
        currGroup = LIGroup.Value
        startCell.Offset(row, col + 1).Value = currGroup
        
        row = row + 1
        startCell.Offset(row, col).Value = "Quote"
        startCell.Offset(row, col).EntireRow.Font.Name = "Arial"
        startCell.Offset(row, col).EntireRow.Font.Bold = True
        startCell.Offset(row, col).EntireRow.Font.Size = 10
        currQuoteNumber = LIGroup.Offset(configRow, configCol + 1).Value
        startCell.Offset(row, col + 1).Value = currQuoteNumber
        
        'Loop through config SKUs
        configCol = configCol + 2
        
        isFirstConfig = True
        
        'TD#66098 - FSP not calculated properly
        'For the freight, get the Freight value from GOAL.
        Dim FSP As Double
        FSP = 0

        Do While (LIGroup.Offset(configRow, configCol).Value > 0)
            currConfig = LIGroup.Offset(configRow, configCol).Value
            currConfigVID = LIGroup.Offset(configRow, 12).Value
            currLineId = LIGroup.Offset(configRow, 12).Value
            'TD#66098 - FSP not calculated properly
            FSP = LIGroup.Offset(configRow, 13).Value
            
            If isFirstConfig = True Then
                lastConfig = currConfig
            Else
                row = row + 2
                startCell.Offset(row, col).Value = "Group"
                startCell.Offset(row, col).EntireRow.Font.Name = "Arial"
                startCell.Offset(row, col).EntireRow.Font.Bold = True
                startCell.Offset(row, col).EntireRow.Font.Size = 10
    
                currGroup = LIGroup.Value
                startCell.Offset(row, col + 1).Value = currGroup
                
                row = row + 1
                startCell.Offset(row, col).Value = "Quote"
                startCell.Offset(row, col).EntireRow.Font.Name = "Arial"
                startCell.Offset(row, col).EntireRow.Font.Bold = True
                startCell.Offset(row, col).EntireRow.Font.Size = 10
    
                startCell.Offset(row, col + 1).Value = currQuoteNumber
            End If
            row = row + 1
            With startCell.Offset(row, col)
                .Value = "Config Description"
                .EntireRow.Font.Name = "Arial"
                .EntireRow.Font.Bold = True
                .EntireRow.Font.Size = 10
            End With
            'Adding Config Desc
            startCell.Offset(row, col + 1).Value = LIGroup.Offset(configRow, configCol + 1).Value
            'JP: 2105656:To add formula to auto select the |fffd|Chassis Code|fffd| in currency matrix file - APJ
            ConfigDescStr = LIGroup.Offset(configRow, configCol + 1).Value
            row = row + 1
                        
            'With startCell.Offset(row, col)
                '.Value = "Discount %"
                '.EntireRow.Font.Name = "Arial"
                '.EntireRow.Font.Bold = True
                '.EntireRow.Font.Size = 10
                
            'End With
            'Adding Config Desc
            'startCell.Offset(row, col + 1).Value = LIGroup.Offset(configRow, configCol + 13).Value / 100
            'startCell.Offset(row, col + 1).NumberFormat = "0.00%"
            'startCell.Offset(row, col + 1).HorizontalAlignment = xlLeft
            'row = row + 1
            
            BaseSellingPrice = (LIGroup.Offset(configRow, configCol + 3).Value) 'BaseSellngPrice from  Config Lines
            ConfigListPrice = LIGroup.Offset(configRow, configCol + 4).Value    'Config List Price from  Config Lines
                
            'Now Add the SKU List
            '----------------------------------------------------------------
        
            'Govind - APJ 3.1 : Addition of GCP Flag
            With startCell.Offset(row, col)
                .Value = "GCP Config"
                .EntireRow.Font.Name = "Arial"
                .EntireRow.Font.Bold = True
                .EntireRow.Font.Size = 10
                
            End With
                        
            'Tracking GCP row for each config. current row is Offset to GCP display position
            
            gcpRownum = row
            row = row + 1
            'initialize GCPSKUFound varaiable to No.
            isGCPSKUFound = "No"
            'Govind - APJ 3.1 : End of addition of GCP Flag
            
            'Govind - APJ 3.1 : Addition of Chasis Selection
            
            With startCell.Offset(row, col)
                .Value = "Chassis Code"
                .EntireRow.Font.Name = "Arial"
                .EntireRow.Font.Bold = True
                .EntireRow.Font.Size = 10
                
            End With
            
             'Tracking Chasis Code row for each config. row is Offset of SKU display start position
            ' and based on Global Price tab sheet, it is at 19th row hence 19 need to be added to ofset row because the called function uses the sheet and start ramge of the current function
            chasisRownum = 19 + row
            
            'JP: 2105656:To add formula to auto select the |fffd|Chassis Code|fffd| in currency matrix file - APJ
            'startCell.Offset(row, col + 1).Validation.Add xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=ChasisCodes"
            'startCell.Offset(row, col + 1).Validation.IgnoreBlank = True
            'startCell.Offset(row, col + 1).Validation.InCellDropdown = True
            
            ' JP: Brazil uplift
            row = row + 1
            ' JP: Brazil uplift
            With startCell.Offset(row, col)
                .Value = "Brazil Uplift"
                .EntireRow.Font.Name = "Arial"
                .EntireRow.Font.Bold = True
                .EntireRow.Font.Size = 10
                
            End With

            ' JP: Brazil uplift create a Name Manager
            'JP:1161061:Currency matrix - automate the Brazil uplift selection
            'startCell.Offset(row, col + 1).Validation.Add xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=BrazilUplift"
            'startCell.Offset(row, col + 1).Validation.IgnoreBlank = True
            'startCell.Offset(row, col + 1).Validation.InCellDropdown = True
            
            'JP: Brazil Uplift- Automation the brazil uplift, 1161061:Currency matrix - automate the Brazil uplift selection
            brazilRownum = 19 + row

'JP: 1161061:Currency matrix - automate the Brazil uplift selection

'BRLQuery = "=" & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$1,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$1,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$2,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$2,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$3,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$3,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$4,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$4,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$5,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$5,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$6,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$6,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$7,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$7,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$8,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$8,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$9,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$9,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$10,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$10,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$11,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$11,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$12,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$12,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$13,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$13,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$14,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$14,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$15,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$15,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$16,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$16,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$17,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$17,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$18,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$18,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$19,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$19,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$20,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$20,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$21,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$21,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$22,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$22,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$23,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$23,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$24,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$24,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$25,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$25,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$26,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$26,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$27,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$27,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$28,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$28,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$29,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$29,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$30,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$30,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$31,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$31,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$32,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$32,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$33,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$33,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$34,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$34,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$35,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$35,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$36,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$36,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$37,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$37,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$38,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$38,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$39,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$39,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$40,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$40,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$41,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$41,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$42,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$42,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$43,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$43,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$44,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$44,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$45,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$45,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$46,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$46,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$47,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$47,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$48,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$48,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$49,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$49,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$50,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$50,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$51,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$51,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$52,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$52,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$53,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$53,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$54,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$54,"
'
''JP: Brazil Uplift rows are increased till 62.
'
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$55,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$55,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$56,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$56,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$57,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$57,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$58,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$58,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$59,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$59,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$60,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$60,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$61,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$61,"
'BRLQuery = BRLQuery & "IF(ISNUMBER(SEARCH('Brazil uplift'!$A$62,VLOOKUP(" & Chr(34) & "Config Description" & Chr(34) & ",A" & brazilRownum - 4 & ":B" & (brazilRownum + 1) & ",2,FALSE))),'Brazil uplift'!$A$62,"
'
'BRLQuery = BRLQuery & Chr(34) & "N/A" & Chr(34) & "))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))"
'
'startCell.Offset(row, col + 1).Formula = BRLQuery
'JP: Ends 1161061:Currency matrix - automate the Brazil uplift selection
            
            
'JP: Start of Change Request 3097039:Currency matrix& cost package macro code update

            CountRownum = 0
  
            Do While (CountRownum < BrazilUpliftTotalRows)
                 resultStr = ""
                 
                 
                 If InStr(UCase(ConfigDescStr), UCase(BrazilUpliftColumn.Offset(CountRownum, 0).Value)) <> 0 Then
                     
                    If BrazilUpliftColumn.Offset(CountRownum, 0).Value <> "" Then
                         resultStr = BrazilUpliftColumn.Offset(CountRownum, 0).Value
                         Exit Do
                     End If
                     
                 End If
                 
                 
                CountRownum = CountRownum + 1
            Loop
            
            If Len(resultStr) = 0 Then
                startCell.Offset(row, col + 1).Value = "N/A"
            Else
                startCell.Offset(row, col + 1).Value = resultStr
            End If

'JP: End of Change Request 3097039:Currency matrix& cost package macro code update
            
            
            
'JP: Starts 2105656:To add formula to auto select the |fffd|Chassis Code|fffd| in currency matrix file - APJ

            CountRownum = 0
  
            Do While (CountRownum < APJFrieghtDutiesTotalRows)
                 resultStr = ""
                 
                 
                 If InStr(UCase(ConfigDescStr), UCase(ChassisCode.Offset(CountRownum, 0).Value)) <> 0 Then
                     
                    If ChassisCode.Offset(CountRownum, 0).Value <> "" Then
                         resultStr = ChassisCode.Offset(CountRownum, 0).Value
                         Exit Do
                     End If
                     
                 End If
                 
                 
                CountRownum = CountRownum + 1
            Loop
            
            If Len(resultStr) = 0 Then
                startCell.Offset(row - 1, col + 1).Value = "N/A"
            Else
                startCell.Offset(row - 1, col + 1).Value = resultStr
            End If
 
 'JP: Ends 2105656:To add formula to auto select the |fffd|Chassis Code|fffd| in currency matrix file - APJ
            
            
            
            
            'JP: Already existing code
            row = row + 1
             
             
             'Govind - APJ 3.1 : End of addition of Chasis Selection
             
            isFirstSKUList = True
            rownum = 0
            colnum = 0
            Dim noOfFreights As Integer
            Dim noOfUpgradesNOptions As Integer
            Dim noOfBaseConfigs As Integer
            noOfFreights = 0
            noOfUpgradesNOptions = 0
            noOfBaseConfigs = 0
            Do While (skuLists.Offset(rownum, colnum + 6).Value > 0)
                If (skuLists.Offset(rownum, 1).Value = currQuoteNumber And skuLists.Offset(rownum, 3).Value = currConfig And skuLists.Offset(rownum, 14).Value = currConfigVID) Then
                    
                    'Govind: APJ 3.1 - Check whether the current SKU in the config is GCP SKU and set value appropriately for GCPSKUFound Variable.
                    ' If the GCP Flag is found atleast once, no need to check for other SKUs in the same config, hence added If condition
                    If isGCPSKUFound = "No" Then
                        gcpMatchFormula = "IF(ISERROR(MATCH(" & Chr(34) & skuLists.Offset(rownum, 6).Value & Chr(34) & ",'Global SKUS'!D5:D139,0))," & Chr(34) & NO & Chr(34) & "," & Chr(34) & YES & Chr(34) & ")"
                        'MsgBox gcpMatchFormula
                        startCell.Offset(gcpRownum, col + 1).Formula = "=" & gcpMatchFormula
                        isGCPSKUFound = startCell.Offset(gcpRownum, col + 1).Value
                        'MsgBox isGCPSKUFound
                        'MsgBox gcpRownum
                        'MsgBox currConfig
                      End If
                    'End of APJ 3.1 addition
                    
                                        
                    currSKUType = skuLists.Offset(rownum, colnum + 9).Value
                    If isFirstSKUList = True Then
                        lastSKUType = currSKUTyp
                    End If
                    If currSKUType = "Freight" Then
                        noOfFreights = noOfFreights + 1
                    End If
                    If currSKUType = "Base Configuration" Then
                        noOfBaseConfigs = noOfBaseConfigs + 1
                    End If
                    
                    'Base Selling Price:  if Freight or Option/Upgrade exists is set here
                    If lastSKUType <> currSKUType And lastSKUType = "Base Configuration" Then
                        row = row + 2
                        'JP: Change Request 2908985:Currency Matrix Adjustments
                        'JP: Write the Quote Number in the first column
                        startCell.Offset(row, col).Value = currQuoteNumber
                        'JP: Change Request 2908985:Currency Matrix Adjustments
                        'JP: Place the "Base Selling Price" one column right side
                        startCell.Offset(row, col + 1).Value = "Base Selling Price"
                        'EMEA pricing is calculated based on the Pricing Currency and the current/future Hedge
                        startCell.Offset(row, regionalPricingStartCol - 1).Formula = "=" & str(LIGroup.Offset(configRow, configCol + 3).Value) & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeRateRowNum & "," & "Hedge!E" & hedgeRateRowNum & ")"
                        startCell.Offset(row, regionalPricingStartCol - 1).EntireRow.Interior.ColorIndex = 36
                        startCell.Offset(row, regionalPricingStartCol - 1).EntireRow.Font.Name = "Arial"
                        startCell.Offset(row, regionalPricingStartCol - 1).EntireRow.Font.Size = 10
                        startCell.Offset(row, regionalPricingStartCol - 1).EntireRow.Font.Bold = True
                        startCell.Offset(row, regionalPricingStartCol - 1).NumberFormat = "0.00"
                        startCell.Offset(row, regionalPricingStartCol - 1).Locked = True
                        
                        If isInternalReport = True Then
                            startCell.Offset(row, regionalPricingStartCol - 3).Formula = "=sum(D" & (17 + row - noOfBaseConfigs + 1) & ":D" & (17 + row) & ")"
                            startCell.Offset(row, regionalPricingStartCol - 3).NumberFormat = "0.00"
                            
                        End If
                            'add Uplift
                            Worksheets("Tempsheet").Range("a2:az2").Copy startCell.Offset(row + 1, col)
                            drawBottomLine startCell.Offset(row + 2, col).EntireRow
                        With startCell.Offset(row, col).EntireRow.Font
                            .Name = "Arial"
                            .Size = 10
                        End With
                        
                        Dim BaseSP As Double
                        Dim counter As Integer
                        
                        BaseSP = BaseSellingPrice
                        counter = 0
                        Do While (counter < noOfRegions)
                            'CHECK THIS
                            
                            'If startCell.Offset(row + 1, regionalPricingStartCol + counter).Value = "TBD" Then
                            '    startCell.Offset(row, regionalPricingStartCol + counter).Value = "TBD"
                            '    startCell.Offset(row, regionalPricingStartCol + counter).HorizontalAlignment = xlCenter
                            'End If
                            
                            If startCell.Offset(row + 1, regionalPricingStartCol + counter).Value <> "TBD" Then
                                startCell.Offset(row, regionalPricingStartCol + counter).Value = calculateUpliftedValue(BaseSP, startCell.Offset(row + 1, regionalPricingStartCol + counter).Value)
                            Else
                                startCell.Offset(row, regionalPricingStartCol + counter).Value = "TBD"
                                startCell.Offset(row, regionalPricingStartCol + counter).HorizontalAlignment = xlCenter
                            End If
                            counter = counter + 1
                        Loop
                        row = row + 1
                         'JP: Brazil Uplift
                       brazilUpliftLookUp brazilRownum, startCell.Offset(row, 10)
                    
                    End If
                    
                    If (lastSKUType = "Freight" And lastSKUType <> currSKUType And currSKUType <> "Base Configuration") Then
                        row = row + 1
                        Dim startingRange As Range
                        Set startingRange = startCell
                        Dim startRow As Integer
                        startRow = row
                        Dim startCol As Integer
                        startCol = col
                        addTotalSellingPrice startingRange, startRow, startCol, noOfFreights, noOfBaseConfigs, chasisRownum
                        'BJRT TODAY
                         row = row + 2
                       
                    End If
                    If (currSKUType = "Option" Or currSKUType = "Upgrade") Then
                        noOfUpgradesNOptions = noOfUpgradesNOptions + 1
                        
                        If (lastSKUType <> "Option" And lastSKUType <> "Upgrade") Then
                            If (lastSKUType = "Base Configuration") Then
                                addTotalSellingPrice startingRange, row + 1, col + 1 - 1, 0, noOfBaseConfigs, chasisRownum
                                row = row + 1
                                'Govind - APJ 3.1: Adding Titles with Frieght & Taxes for Base Configuration
                            startCell.Offset(row, col).Value = "With Freight"
                            startCell.Offset(row, col).EntireRow.Interior.ColorIndex = 36
                            startCell.Offset(row, col).Font.Name = "Arial"
                            startCell.Offset(row, col).Font.Bold = True
                            startCell.Offset(row, col).Font.Size = 10
                          
                            row = row + 1
                                                                                    
                            startCell.Offset(row, col).Value = "With Taxes"
                            startCell.Offset(row, col).EntireRow.Interior.ColorIndex = 36
                            startCell.Offset(row, col).Font.Name = "Arial"
                            startCell.Offset(row, col).Font.Bold = True
                            startCell.Offset(row, col).Font.Size = 10
                            'row = row + 2
                           'End of APJ 3.1 code change for Fresight & Taxes title
                            taxesRowNum = row + 19
                            displayFreightAndTax startCell.Offset(row - 3, 42), chasisRownum, taxesRowNum
                            row = row + 1
                            End If
                                row = row + 2
                                  
                            startCell.Offset(row, col + 1).Value = "OPTIONS / UPGRADES"
                            startCell.Offset(row, col + 1).Font.Name = "Arial"
                            startCell.Offset(row, col + 1).Font.Bold = True
                            startCell.Offset(row, col + 1).Font.Size = 10
                        End If
                    End If
                    
                    row = row + 1
                    'Adding SKU
                    startCell.Offset(row, col).Value = skuLists.Offset(rownum, 6).Value                 'SKU from SKUList
                    
                    'Adding SKU Description
                    If (skuLists.Offset(rownum, colnum + 18) = 0) Then
                    startCell.Offset(row, col + 1).Value = skuLists.Offset(rownum, colnum + 7).Value    'SKU Description from SKUList
                    Else
                    startCell.Offset(row, col + 1).Value = skuLists.Offset(rownum, colnum + 7).Value & " " & " " & "( " & skuLists.Offset(rownum, colnum + 18).Value & " Months ) "             'SKU Description from SKUList
                    End If
                    
                    'Adding SKU Quantity
                    startCell.Offset(row, col + 2).Value = skuLists.Offset(rownum, colnum + 8).Value    'Quantity from SKUList
                    
                    'In case of internal report
                    'add SKU List Price
                    'If (isInternalReport = True) Then
                        Dim listPrice As Double
                        listPrice = skuLists.Offset(rownum, colnum + 10).Value  'List Price from SKUList
                        startCell.Offset(row, col + 3).Value = skuLists.Offset(rownum, colnum + 10).Value   'List Price from SKUList
                        startCell.Offset(row, col + 3).Value = "=" & str(listPrice) & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeRateRowNum & "," & "Hedge!E" & hedgeRateRowNum & ")"
                        startCell.Offset(row, col + 3).NumberFormat = "0.00"
                    'End If
                    
                    'Story 5657452: GOAL: Flag VP/VI SKU and display duration in CM for upgrades if VP/VI
                    'Adding Duration
                    If (skuLists.Offset(rownum, 18) = 0) Then
                    startCell.Offset(row, col + 61).Value = ""                                              'Duration  from SKUList
                    Else
                    startCell.Offset(row, col + 61).Value = skuLists.Offset(rownum, 18).Value
                    End If
                    
                    'Adding ISVARIABLEPRICED
                    If (skuLists.Offset(rownum, 19) = "F") Then
                    startCell.Offset(row, col + 62).Value = ""                                           'ISVARIABLEPRICED  from SKUList
                    Else
                    startCell.Offset(row, col + 62).Value = skuLists.Offset(rownum, 19).Value
                    End If
                    
                    'Adding VISKU
                    If (skuLists.Offset(rownum, 20) = "F") Then
                    startCell.Offset(row, col + 63).Value = ""                                           'VISKU  from SKUList
                    Else
                    startCell.Offset(row, col + 63).Value = skuLists.Offset(rownum, 20).Value
                    End If
                    'End Story 5657452: GOAL: Flag VP/VI SKU and display duration in CM for upgrades if VP/VI
                    
                    'FIXED PRICE ONLY
                    If (skuLists.Offset(rownum, 21) = "T") Then
                    startCell.Offset(row, col + 64).Value = "Yes"                                           'FIXED PRICE ONLY  from SKUList
                    Else
                    startCell.Offset(row, col + 64).Value = ""
                    End If
                    
                    'Adding SKU Type
                    If (currSKUType <> "Base Configuration") Then
                        startCell.Offset(row, regionalPricingStartCol - 2).Value = skuLists.Offset(rownum, colnum + 9).Value
                        
                        'TD#66098 - FSP not calculated properly. Bring the freight from the current config row
                        If (currSKUType = "Freight") Then
                            startCell.Offset(row, regionalPricingStartCol - 1).Formula = "= " & str(FSP) & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeRateRowNum & "," & "Hedge!E" & hedgeRateRowNum & ")"
                        Else
                            startCell.Offset(row, regionalPricingStartCol - 1).Formula = "= " & str(skuLists.Offset(rownum, colnum + 12).Value) & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeRateRowNum & "," & "Hedge!E" & hedgeRateRowNum & ")"
                        End If
                        
                        startCell.Offset(row, regionalPricingStartCol - 1).NumberFormat = "0.00"
                    End If
                    
                    lastSKUType = currSKUType
                End If
                rownum = rownum + 1
            isFirstSKUList = False
            Loop
            'Finished adding SKU List
            '----------------------------------------------------------------
            'Govind - APJ 3.1 : Setting GCP Flag for the config as all SKUs for the Config has been iterated
            startCell.Offset(gcpRownum, col + 1).Value = isGCPSKUFound
            'End of APJ 3.1 : Setting of GCP Flag for the config
            
            If lastSKUType = "Base Configuration" Then
                    row = row + 2
                    'JP: Change Request 2908985:Currency Matrix Adjustments
                    'JP: Write the Quote Number in the first column
                    startCell.Offset(row, col).Value = currQuoteNumber
                    'JP: Change Request 2908985:Currency Matrix Adjustments
                    'JP: Place the "Base Selling Price" one column right side
                    startCell.Offset(row, col + 1).Value = "Base Selling Price"
                    With startCell.Offset(row, regionalPricingStartCol - 1).EntireRow
                        .Interior.ColorIndex = 36
                        .Font.Name = "Arial"
                        .Font.Size = 10
                        .Font.Bold = True
                    End With
                    
                    'EMea Base Selling Price
                    If isInternalReport = True Then
                        startCell.Offset(row, col + 3).Value = ConfigListPrice
                        startCell.Offset(row, col + 3).Value = "=" & str(ConfigListPrice) & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeRateRowNum & "," & "Hedge!E" & hedgeRateRowNum & ")"
                        startCell.Offset(row, col + 3).NumberFormat = "0.00"
                        'List Price from SKUList
                    End If
                    
                    startCell.Offset(row, regionalPricingStartCol - 1).Formula = "=" & str(BaseSellingPrice) & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeRateRowNum & "," & "Hedge!E" & hedgeRateRowNum & ")"
                    startCell.Offset(row, regionalPricingStartCol - 1).NumberFormat = "0.00"
                    row = row + 1
                    
                    'Add an uplift row
                    Worksheets("Tempsheet").Range("a2:az2").Copy startCell.Offset(row, col)
                    With startCell.Offset(row, col).EntireRow.Font
                        .Name = "Arial"
                        .Size = 10
                    End With
                    'row = row + 1
                            
                    drawBottomLine startCell.Offset(row, col).EntireRow
                    
                    
                    'JP: Modified
                    row = row + 1
                    'JP: Latam currency added, Brazil Base and percentage
                    brazilUpliftLookUp brazilRownum, startCell.Offset(row - 1, 10)
                    
                    'Calculate Total Selling Price
                    'startCell.Offset(row, col).Value = "Total Selling Price"
                    Set startingRange = startCell
                    startRow = row
                    
                    'adding Total Selling Price
                    startCol = col
                    addTotalSellingPrice startingRange, startRow, startCol, 0, noOfBaseConfigs, chasisRownum
                    'row = row + 2
                         'Govind - APJ 3.1: Adding Titles with Frieght & Taxes for Base Configuration
                            startCell.Offset(row, col).Value = "With Freight"
                            startCell.Offset(row, col).EntireRow.Interior.ColorIndex = 36
                            startCell.Offset(row, col).Font.Name = "Arial"
                            startCell.Offset(row, col).Font.Bold = True
                            startCell.Offset(row, col).Font.Size = 10
                          
                            row = row + 1
                                                                                    
                            startCell.Offset(row, col).Value = "With Taxes"
                            startCell.Offset(row, col).EntireRow.Interior.ColorIndex = 36
                            startCell.Offset(row, col).Font.Name = "Arial"
                            startCell.Offset(row, col).Font.Bold = True
                            startCell.Offset(row, col).Font.Size = 10
                            'row = row + 2
                           'End of APJ 3.1 code change for Fresight & Taxes title
                            taxesRowNum = row + 19
                            displayFreightAndTax startCell.Offset(row - 3, 42), chasisRownum, taxesRowNum
                            row = row + 1
                                            
            End If
            
               
            If lastSKUType = "Freight" Then
                row = row + 1
                Set startingRange = startCell
                startRow = row
                startCol = col
                addTotalSellingPrice startingRange, startRow, startCol, noOfFreights, noOfBaseConfigs, chasisRownum
                row = row + 2
                'addFreightTaxesPrice startingRange, startRow, startCol, noOfFreights, noOfBaseConfigs
                'row = row + 2
            End If
            
            If lastSKUType = "Upgrade" Or lastSKUType = "Option" Then
                  row = row + 1
                  '-------------------------------------
                  Worksheets("Tempsheet").Range("a2:az2").Copy startCell.Offset(row, col)
                  With startCell.Offset(row, col).EntireRow.Font
                            .Name = "Arial"
                            .Size = 10
                  End With
                  '-------------------------------------
                  
                  
                  'Mafe - CR: Apply Uplift of AP Direct (Column M) to the OPTIONS and UPGRADES
                  ' uplifts line in column T (i.e, India Ex-fact column 19)
                
                    startCell.Offset(row, 19).Formula = "=" & "+$M$" & (row + startingRow)
                  
                  startCell.Offset(row, 1).Value = "Uplift over Regional Direct Price"
                  drawBottomLine startCell.Offset(row + 1, 1).EntireRow
    
                  Dim refRange As Range
                  Set refRange = startCell
                  rownum = row
                  colnum = col
                  addOptionNUpgradePrice refRange, rownum, colnum, noOfUpgradesNOptions, chasisRownum, brazilRownum
                  row = row + 1
                
            End If
                       
            lastConfig = currConfig
            lastQuoteNumber = currQuoteNumber
            configRow = configRow + 1
            isFirstConfig = False
            prevLineId = currLineId
        Loop
        
        lastGroup = currGroup
        configRow = 0
        configCol = 0
        row = row + 2
     End If
    'End If
    prevLIGroup = currLIGroup
Else
    groupReset = True
End If
Next LIGroup
Set startCell = Worksheets("Global Price").Range("o17")
'Making column O is false as we need to display Japan. WE can remove this code later -- Padmini
startCell.EntireColumn.Hidden = False
Set startCell = Worksheets("Global Price").Range("p17")
startCell.EntireColumn.Hidden = True
Set startCell = Worksheets("Global Price").Range("q17")
startCell.EntireColumn.Hidden = True
Set startCell = Worksheets("Global Price").Range("r17")
startCell.EntireColumn.Hidden = True
'Changes for the story 5657509
Set startCell = Worksheets("Global Price").Range("s17")
startCell.EntireColumn.Hidden = False


End Sub
Function brazilUpliftLookUp(brazilRownum As Integer, destinationCell As Range)
    'JP: Brazil uplift
Dim brazilUpliftColnName As String

    brazilUpliftColnName = "B" & brazilRownum

      'JP:1161061:Currency matrix - automate the Brazil uplift selection
   
     'idxStr_tax = "VLOOKUP(" & brazilUpliftColnName & ",'Brazil uplift'!$A$1:$C$100,3,0)"
     idxStr_tax = "VLOOKUP(" & brazilUpliftColnName & ",'Brazil uplift'!$A$1:$B$100,2,0)"
        
        destinationCell.Offset(0, 0).Formula = "=1+" & idxStr_tax
        'destinationCell.Offset(0, 0).NumberFormat = "0.00"
End Function
'Calculate Uplift
Sub calculateUplift()
    
    Dim upliftDataRange As Range
    
    Dim upliftEmeaDirect As Double
    Dim upliftEmeaIndirect As Double
    Dim upliftUS As Double
    Dim upliftCanada As Double
    Dim upliftLatinAmerica As Double
    Dim upliftBrazil As Double
    Dim upliftIndonesia As Double
    Dim upliftAsiaPacDirect As Double
    Dim upliftAsiaPacIndirect As Double
    Dim upliftJapan As Double
    'Author Govind
    'Added below field to include the INDIA Ex-Fact For APJ 3.1 Rel
    Dim upliftIndia As Double
'    regionalPricingStartCol = 6
    Dim rowOffset As Integer
    Dim colOffset As Integer
    
    rowOffset = 1
    colOffset = 0
    
    Set upliftDataRange = Worksheets("Uplift").Range("a1")
    
    Do While (upliftDataRange.Offset(rowOffset, colOffset).Value > 0)
        Dim territory As String
        territory = upliftDataRange.Offset(rowOffset, colOffset).Value
        Select Case territory
            Case EMEA_DIRECT
                upliftEmeaDirect = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case EMEA_INDIRECT
                upliftEmeaIndirect = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case US
                upliftUS = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case CANADA
                upliftCanada = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case LATIN_AMERICA
                upliftLatinAmerica = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case BRAZIL
                upliftBrazil = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case INDONESIA
                upliftIndonesia = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case APAC_DIRECT
                upliftApacDirect = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case APAC_INDIRECT
                upliftApacIndirect = upliftDataRange.Offset(rowOffset, colOffset + 1)
            Case JAPAN
                upliftJapan = upliftDataRange.Offset(rowOffset, colOffset + 1)
            'Author Govind
            'Added this case to include the INDIA Ex-Fact
            Case INDIA
                upliftIndia = upliftDataRange.Offset(rowOffset, colOffset + 1)
        End Select
        rowOffset = rowOffset + 1
    Loop
        
    'JP: Change Request 2908985:Currency Matrix Adjustments
    ''Dim priceBookRange As Range
    ''Set priceBookRange = Worksheets("Global Price").Range("B10")
    ''Dim priceBookValue As String
    
    
    'idxStr_tax1 = "VLOOKUP(" & B10 & ",'PriceBookResource'!$B$10:$B$10)"
    
    'MsgBox idxStr_tax1
    
'    If priceBookRange.Value = "Global" Then
'            priceBookValue = "Global"
'    ElseIf priceBookRange.Value = "APEJ" Then
'            priceBookValue = "APEJ"
'    ElseIf priceBookRange.Value = "Japan" Then
'            priceBookValue = "Japan"
'    End If
    'JP: End of Change Request 2908985:Currency Matrix Adjustments
    
        
    Dim TempSheetRange As Range
    Set TempSheetRange = Worksheets("TempSheet").Range("a1")
    TempSheetRange.Value = "Uplift Data Row"
    
    TempSheetRange.Offset(1, 1).Value = "Uplift over Regional Direct Base Selling Price"
    drawBottomLine TempSheetRange.Offset(2, 1).EntireRow
              
    TempSheetRange.Offset(1, 1).Interior.ColorIndex = 35
    TempSheetRange.Offset(1, 1).Font.Name = "Arial"
    TempSheetRange.Offset(1, 1).Font.Size = 10
    TempSheetRange.Offset(1, 1).Font.Bold = True
    'regionalPricingStartCol = 6
    Dim tempColOffset As Integer
    tempColOffset = regionalPricingStartCol - 1
    TempSheetRange.Range("c2:az2").Clear
    TempSheetRange.Range("c2:az2").EntireRow.Font.Name = "Arial"
    TempSheetRange.Range("c2:az2").EntireRow.Font.Size = 10
    
    'TempSheetRange.Offset(1, tempColOffset).Value = upliftEmeaDirect / 100            '4
    'TempSheetRange.Offset(1, tempColOffset + 1).Value = upliftEmeaIndirect / 100      '5
    'TempSheetRange.Offset(1, tempColOffset + 2).Value = upliftUS / 100
    'TempSheetRange.Offset(1, tempColOffset + 3).Value = upliftCanada / 100
    'TempSheetRange.Offset(1, tempColOffset + 4).Value = upliftLatinAmerica / 100
    '' JP: Brazil Uplift
    ''TempSheetRange.Offset(1, tempColOffset + 5).Value = upliftBrazil / 100
    ''TempSheetRange.Offset(1, tempColOffset + 5).Value = "TBD"
    'TempSheetRange.Offset(1, tempColOffset + 5).HorizontalAlignment = xlCenter
    'TempSheetRange.Offset(1, tempColOffset + 6).Value = upliftIndonesia / 100         '10
    'TempSheetRange.Offset(1, tempColOffset + 7).Value = upliftApacDirect / 100
    'TempSheetRange.Offset(1, tempColOffset + 8).Value = upliftApacIndirect / 100
    'TempSheetRange.Offset(1, tempColOffset + 9).Value = upliftJapan / 100             '13
    ''Author Govind
    ''Added this line to include the uplift value for INDIA Ex-Fact for APJ 3.1 Rel
    'TempSheetRange.Offset(1, tempColOffset + 14).Value = upliftIndia
    
    
     'JP: 198132:Currency Matrix, Cost Package - Regional Uplift change "value" by "formula"
    TempSheetRange.Offset(1, tempColOffset).Value = upliftEmeaDirect / 100            '4
    TempSheetRange.Offset(1, tempColOffset + 1).Formula = "=(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 5%)" '5
   
    TempSheetRange.Offset(1, tempColOffset + 2).Formula = "=F" & (tempColOffset - 3)
    TempSheetRange.Offset(1, tempColOffset + 3).Formula = "=(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 4%)"
    TempSheetRange.Offset(1, tempColOffset + 4).Formula = "=(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 2%)"
    TempSheetRange.Offset(1, tempColOffset + 5).HorizontalAlignment = xlCenter
    TempSheetRange.Offset(1, tempColOffset + 6).Formula = "=(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 5%)"         '10
    
   ' TempSheetRange.Offset(1, tempColOffset + 7).Formula = "=(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 5%)" 'AsiaPacDirect uplift
   'JP: Change Request 2908985:Currency Matrix Adjustments
'    I.  When the account is headquartered in APEJ
'        a.  Column M - AP Direct uplift adjusted from 105% to 100%
'        b.  Column O - Japan uplift formula remains. The value should be automatically adjusted from 109.095% to 103.9% (103.95 formulated from M101+M101* 3.9%)
    'TempSheetRange.Offset(1, tempColOffset + 7).Formula = "=IF((PriceBookResource=" & Chr(34) & "APEJ" & Chr(34) & "),(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 0%)," & "IF((PriceBookResource=" & Chr(34) & "Japan" & Chr(34) & "),(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 0%),(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 5%)))"
    
    'Changes for the story# 5657509
    TempSheetRange.Offset(1, tempColOffset + 7).Formula = "=IF((PriceBookResource=" & Chr(34) & "APEJ" & Chr(34) & "),(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 0%)," & "IF((PriceBookResource=" & Chr(34) & "Japan" & Chr(34) & "),(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 0%), IF((PriceBookResource=" & Chr(34) & "China" & Chr(34) & "),(F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 0%), (F" & (tempColOffset - 3) & "+" & "F" & (tempColOffset - 3) & "* 5%))))"
    
    TempSheetRange.Offset(1, tempColOffset + 8).Formula = "=(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 7%)"
    
    'TempSheetRange.Offset(1, tempColOffset + 9).Formula = "=(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 3.9%)"   'Japan Uplift   '13
    'JP: Change Request 2908985:Currency Matrix Adjustments
'    When the account is headquartered in Japan
'    a.  Column M - uplift adjusted from 105% to 100%
'    b.  Column O - Japan uplift formula required change from (M101+M101* 3.9%) to (M101+M101* 0%). The value should reflect 100%.
    
    TempSheetRange.Offset(1, tempColOffset + 9).Formula = "=IF((PriceBookResource=" & Chr(34) & "Japan" & Chr(34) & "),(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 0%),(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 3.9%))"   'Japan Uplift   '13
    
    
    'JP: 2219904:Currency Matrix - Japan Uplift Percentage should show 3 decimals
    TempSheetRange.Offset(1, tempColOffset + 9).NumberFormat = "000.000%"
    
    'Changes for the story# 5657509
    TempSheetRange.Offset(1, tempColOffset + 13).Formula = "=IF((PriceBookResource=" & Chr(34) & "China" & Chr(34) & "),(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 0%),(M" & (tempColOffset - 3) & "+" & "M" & (tempColOffset - 3) & "* 0%))"   'China Uplift   '13
    TempSheetRange.Offset(1, tempColOffset + 13).NumberFormat = "000.000%"

    'Author Govind
    'Added this line to include the uplift value for INDIA Ex-Fact for APJ 3.1 Rel
    TempSheetRange.Offset(1, tempColOffset + 14).Value = upliftIndia
    
    
    isUpliftCalculated = False
    'Set TempSheetRange = Worksheets("TempSheet").Range("e2:o2")
    'JP: 2219904:Currency Matrix - Japan Uplift Percentage should show 3 decimals
    Set TempSheetRange = Worksheets("TempSheet").Range("e2:n2")
    TempSheetRange.NumberFormat = "0.00%"
    
End Sub

'Clears the entire report for housekeeping purpose.
Sub clearReportCells()
    Dim reportCells As Range
    Set reportCells = Worksheets("Global Price").Range("18:1000")
    reportCells.Clear
    reportCells.Font.Name = "Arial"
    reportCells.Font.Size = 10
    reportCells.Font.Bold = False
    
    Set reportCells = Worksheets("Global Price").Range("5:10")
    reportCells.Font.Name = "Arial"
    reportCells.Font.Size = 14
    reportCells.Font.Bold = True
    Set reportCells = Worksheets("Global Price").Range("B5:B10")
    
    Dim tempHedge As Range
    
End Sub


Sub copyUpliftRow(startCell As Range, row As Integer, col As Integer)
    Worksheets("Tempsheet").Range("a2:az2").Copy startCell.Offset(row, col)
    With startCell.Offset(row, col).EntireRow.Font
            .Name = "Arial"
            .Size = 10
    End With
End Sub


Function calculateUpliftedValue(base As Double, uplift As Double)

calculateUpliftedValue = base * uplift / 100

End Function

Function MultiplyTwo(num1, num2)
    MultiplyTwo = num1 * num2
End Function

Sub addTotalSellingPrice(startCell As Range, row As Integer, col As Integer, noOfFreights As Integer, noOfBaseConfigs As Integer, chasisRownum As Integer)
    Dim columnName As Integer
    Dim lastColName As Integer
    Dim chasisColnName As String
    
    columnName = regionalPricingStartCol
    
    chasisColnName = "B" & chasisRownum
    
    Set startCell = Worksheets("Global Price").Range("a19")
    
    With startCell.Offset(row, col).EntireRow.Font
        .Name = "Arial"
        .Size = 10
    End With
    lastColName = regionalPricingStartCol - 1 + noOfRegions
    
    ' lastColName = 18th Col for External and +1 for internal Report
    Do While (columnName < lastColName)
        ' Add Base Selling Price totals
        If (noOfBaseConfigs > 0 And columnName = 19) Then
            'Author Govind
            'Column 19 is for column value for INDIA EX-Fact for APJ 3.1 Rel
             startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*(" & ColNames(12) & (row + startingRowOffset - noOfFreights) & ")+" & ColNames(columnName) & (row + startingRowOffset - noOfFreights)
             startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
             
             'For India uplift
             startCell.Offset(row - 1 - noOfFreights, columnName).Formula = "=" & "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!C14:E338,3,FALSE)"
                                 
        ElseIf (noOfBaseConfigs > 0) Then
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*(" & ColNames(columnName) & (row + startingRowOffset - noOfFreights) & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
         
        End If
        
        col = col + 1
        columnName = columnName + 1
    Loop
    
    Dim hedgeRateColName As Integer
    Dim HedgeRowNum As Integer
    hedgeRateColName = 2
    HedgeRowNum = 5
     'JP: Brazil uplift
     Do While (columnName < (lastColName + noOfEmeaCosts + noOfAPJPricing + noOfAmerCosts))
       
       If (noOfBaseConfigs > 0 And columnName < 30) Then
        'calculation For EMEA
        startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
        startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
       'Author Govind
       'Added the below code to include the APJ currencies for APJ 3.1 Rel
       ElseIf (noOfBaseConfigs > 0 And columnName > 29 And columnName < 42) Then
        'calculation For APJ Pricing in local currencies
        'startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
         If (columnName = 30) Then
           HedgeRowNum = 16
         End If
        'startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*(" & ColNames(columnName - 18) & (row + startingRowOffset - noOfFreights) & ")" & "*Hedge!D" & HedgeRowNum - 1 & ""
        'JP: 201871:Need to change the formula for "Base Selling Price" in "ASIA PACIFIC Pricing in local currencies"
        'If (columnName > 39) Then
        '    startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+B" & ColNames(columnName - 40) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & ""
        '    startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
        'Else
        '    startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & ""
        '   startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
        'End If
        
        'JP: 201871:Need to change the formula for "Base Selling Price" in "ASIA PACIFIC Pricing in local currencies"
        If (columnName > 39) Then ' JP: Column AO and AP
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "+B" & ColNames(columnName - 40) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "+B" & ColNames(columnName - 40) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            
            If (columnName = 40) Then 'JP: Japan 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "RoundDown(" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "+B" & ColNames(columnName - 40) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "+B" & ColNames(columnName - 40) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & "),0)"
                startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            'JP: 207316:Work around - calcualte only the INDIA Rs pricing
            ElseIf (columnName = 41) Then 'JP: India
                startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "M" & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "M" & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & ")"
                startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            End If
            'JP: End of 207316:Work around - calcualte only the INDIA Rs pricing

        Else 'JP: Column AE to AN
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            
            'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
            If (columnName = 33) Then 'JP: Malaysia
                startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "MRound(" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & "),0.05)"
                startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            ElseIf (columnName = 35) Then 'JP: Taiwan
                startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "Round(" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & "),0)"
                startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            ElseIf (columnName = 36) Then 'JP: Korea
                startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "Round(" & "IF((Quarter=" & Chr(34) & "Current" & Chr(34) & ")," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!D" & HedgeRowNum - 1 & "," & "+A" & ColNames(columnName - 14) & (row + startingRowOffset - 1 - noOfFreights) & "*Hedge!E" & HedgeRowNum - 1 & "),0)"
                startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
            End If
        End If
        
       ElseIf (noOfBaseConfigs > 0 And columnName > 41 And columnName < 54) Then
        'calculation For APJ Pricing with USD
         If (columnName = 42) Then
           HedgeRowNum = 15
         End If
         'startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*(" & ColNames(12) & (row + startingRowOffset - noOfFreights) & ")"
         
         'JP: 1344718:Currency Matrix - Rounding should apply only on the Pricing in Local Currency
         
         If (columnName = 45) Then 'JP: Malaysia
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(12) & "$" & (row + startingRowOffset - 1 - noOfFreights) & ""
         ElseIf (columnName = 47) Then 'JP: Taiwan
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(12) & "$" & (row + startingRowOffset - 1 - noOfFreights) & ""
         ElseIf (columnName = 48) Then 'JP: Korea
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(12) & "$" & (row + startingRowOffset - 1 - noOfFreights) & ""
        'Changes for story# 5657509
         ElseIf (columnName = 51) Then 'JP: China
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(18) & "$" & (row + startingRowOffset - 1 - noOfFreights) & ""
         ElseIf (columnName = 52) Then 'JP: Japan
           'Mafe - CR: For Japan, pick from Column O
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(14) & "$" & (row + startingRowOffset - 1 - noOfFreights) & ""
         ElseIf (columnName = 53) Then
         'For India pick the data from Column T (India Column)
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(19) & "$" & (row + startingRowOffset - 1 - noOfFreights)
         Else
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & "+$" & ColNames(12) & "$" & (row + startingRowOffset - 1 - noOfFreights)
         End If
         startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
       
       'JP Brazil uplift
       ElseIf (noOfBaseConfigs > 0 And columnName < 61) Then
        'calculation For NA Pricing
        'startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
        'startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
        
         'CR: 156792 :comment above 2 line to Pick Canada Pricing from Column I (Read as I by adding 2 to regionalPricing) and apply hedge and LATAM America Pricing from Column J (Read as J by adding 3 to regionalPricing) and apply hedge
         If (columnName = 54) Then
         ' CAD -CAD
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 2) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
         ElseIf (columnName = 55) Then 'JP: Brazil Uplift
         'LATAM - MXN
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 3) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
         ElseIf (columnName = 56) Then 'JP: BRAZIL UPLIFT
         'LATAM - BRAZIL
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 4) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
        Else 'JP: BRAZIL UPLIFT
         'LATAM Argentina, Chile, Columbia and Peru - J column
            startCell.Offset(row - 2 - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 3) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
            startCell.Offset(row - 2 - noOfFreights, columnName).NumberFormat = "0.00"
         End If
       End If
              
       columnName = columnName + 1
       hedgeRateColName = hedgeRateColName + 1
       HedgeRowNum = HedgeRowNum + 1
    Loop
      
End Sub

Sub addOptionNUpgradePrice(startCell As Range, row As Integer, col As Integer, noOfItems As Integer, chasisRownum As Integer, brazilRownum As Integer)
    Dim columnName As Integer
    Dim lineNum As Integer
    Dim lastColName As Integer
    
    lineNum = 1
    Dim temp As Integer
    Dim temp1 As Integer
    
    'APJ 3.1 Rel Added below lines to fetch the duties from freight and dutied tab
    'Author: Govind
    Dim destColn1 As Integer
    Dim idxStr As String
    Dim idxStr1 As String
    Dim freightColnName As String
    Dim countryColn As Integer
    Dim chasisColnName As String
    Dim countryColnName As String
        
    destColn1 = 0
    'End of APJ 3.1 code
    Do While (lineNum <= noOfItems)
        temp = row + 18 - lineNum
        temp1 = row - lineNum
        columnName = regionalPricingStartCol
        lastColName = regionalPricingStartCol + noOfRegions
                        
        ' lastColName = 18th Col for External and +1 for internal Report
    
        Do While (columnName < lastColName - 1)
            startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset + 1 - lineNum) & "*" & ColNames(columnName) & (row + startingRowOffset + 1)
            startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
            
            If (columnName = 10) Then ' JP: For Options/Upgrade Brazil uplift
                    '=+IF(E94="upgrade",$F94*K$85,$F94*(1+'Brazil uplift'!$C$80))
                    '=1+VLOOKUP(B25,'Brazil uplift'!$A$2:$C$81,3,0)
                    'startCell.Offset(row - lineNum, columnName).Formula = "=+IF(E" & (row + startingRowOffset - lineNum + 1) & "=" & Chr(34) & "Upgrade" & Chr(34) & ",$F" & (row + startingRowOffset - lineNum + 1) & "*K$" & columnName & ",$F" & (row + startingRowOffset - lineNum + 1) & "*(1+'Brazil uplift'!$C$80))"
                    'JP:1161061:Currency matrix - automate the Brazil uplift selection
                    startCell.Offset(row - lineNum, columnName).Formula = "=+IF(E" & (row + startingRowOffset - lineNum + 1) & "=" & Chr(34) & "Upgrade" & Chr(34) & ",$F" & (row + startingRowOffset - lineNum + 1) & "*(1+VLOOKUP(B" & brazilRownum & ",'Brazil uplift'!$A$1:$B$100,2,0))" & ",$F" & (row + startingRowOffset - lineNum + 1) & "*(1+'Brazil uplift'!$B$58))"
       
                    startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
             End If
             
            columnName = columnName + 1
        Loop
        
        Dim HedgeRowNum As Integer
        HedgeRowNum = 5
        'JP: Option upgrade we can pick from J column for Canada,Mexico, Brazil
        Do While (columnName < (lastColName - 1 + noOfEmeaCosts + noOfAPJPricing + noOfAmerCosts))
          If (columnName > 53) Then
             If (columnName = 54) Then
                HedgeRowNum = 27
                'CAD column I to be used for Hedge Conversion in CAD Column
                startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 2) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
             ElseIf (columnName = 55) Then 'JP: Brazil Uplift
                'LATAM AMER column J to be used for Hedge Conversion in MXN Column
                startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 3) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
             ElseIf (columnName = 56) Then 'JP: Brazil Uplift
                'LATAM AMER column K to be used for Hedge Conversion in BRAZIL Column
                startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 4) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
             Else  'JP: Brazil Uplift
                'LATAM AMER column L to be used for Hedge Conversion
                startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol + 5) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
                          
             End If
             
             'Shalini - Commeting this two lines as part of 'CR: 156792. Change in column used in calculation
             
            'startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
            'startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
          
          ElseIf (columnName < 30) Then
            'startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),HedgeRateTemp!" & ColNames(columnName - 16) & currentQuarterRowNum & "," & "HedgeRateTemp!" & ColNames(columnName - 16) & (currentQuarterRowNum + 1) & ")"
            startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
            startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
          
          ElseIf (columnName > 29 And columnName < 42) Then
            'Includes Duties this need clarification
            If (columnName = 30) Then
             HedgeRowNum = 15
            End If
            countryColn = 30
            'chasisRownum = 23
                'If (destColn1 < 12) Then
                chasisColnName = "B" & chasisRownum
                countryColnName = ColNames(countryColn + destColn) & "17"
                'freightColnName = ColNames(countryColn + destColn1) & (row + 13)
            
                'idxStr = "INDEX('APJ freights and duties'!C10:AT324,MATCH(" & chasisColnName & ",'APJ freights and duties'!C10:C324,0),MATCH(" & countryColnName & ",'APJ freights and duties'!AA10:AT10,0) + 24)"
                'JP: changed 338 to 332 as per Vero request
                'JP: Changed 350 to 332 as per Vero request 200006:Currency Matrix APJ - Freight and Duties macro reference
                idxStr = "INDEX('APJ freights and duties'!C14:AT350,MATCH(" & chasisColnName & ",'APJ freights and duties'!C14:C350,0),MATCH(" & countryColnName & ",'APJ freights and duties'!AA14:AT14,0) + 24)"
                idxStr1 = ColNames(12) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                'startCell.Offset(row - lineNum, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                'startCell.Offset(row - lineNum, columnName).Formula = "=IFERROR(SUM(" & idxStr & "," & idxStr1 & "'" & freightColnName & "),0)"
                'Defect Fix for 156751: For Upgrades don't use the Taxes. Commented below line and added the next one
                ' startCell.Offset(row - lineNum, columnName).Formula = "=IFERROR(SUM(" & idxStr & "," & idxStr1 & "),0)"
                
                If (columnName = 40) Then 'JP: Defect 3784425:GOAL: Fix Currency Matrix macro code: Incorrect formula for Japan upgrades
                    'For Japan - ASIA PACIFIC Pricing in local currencies - Pick BA column from from USD section and apply the hedge
                    startCell.Offset(row - lineNum, columnName).Formula = "=" & "+BA" & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                 ElseIf (columnName = 41) Then
                     'For India - Pick BB column from USD section and apply the hedge
                     startCell.Offset(row - lineNum, columnName).Formula = "=" & "+BB" & (row + startingRowOffset - lineNum + 1) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
                 Else
                    startCell.Offset(row - lineNum, columnName).Formula = "=" & idxStr1
                End If
                startCell.Offset(row - lineNum, columnName).NumberFormat = "0.00"
                'End If
                
            destColn1 = destColn1 + 1
          End If
           'Defect Fix for 156751: Populate APJPricing in USD Section as well
            If (columnName > 41 And columnName < 54) Then
                If (columnName = 53) Then
                    startCell.Offset(row - lineNum, columnName).Formula = "=" & "+$" & ColNames(19) & "$" & (row + startingRowOffset - lineNum + 1)
                 ElseIf (columnName = 52) Then
                   'Mafe CR: For Japan take from Column O
                    startCell.Offset(row - lineNum, columnName).Formula = "=" & "+$" & ColNames(14) & "$" & (row + startingRowOffset - lineNum + 1)
                Else
                    startCell.Offset(row - lineNum, columnName).Formula = "=" & "+$" & ColNames(12) & "$" & (row + startingRowOffset - lineNum + 1)
                 End If
            End If
            columnName = columnName + 1
            HedgeRowNum = HedgeRowNum + 1
        Loop
        lineNum = lineNum + 1
    Loop
    
End Sub
Sub addFreightTaxesPrice(startCell As Range, row As Integer, col As Integer, noOfFreights As Integer, noOfBaseConfigs As Integer)
    Dim columnName As Integer
    Dim lastColName As Integer
    
    columnName = APFreightTaxesStartCol
    
    Set startCell = Worksheets("Global Price").Range("a19")
    
    With startCell.Offset(row, col).EntireRow.Font
        .Name = "Arial"
        .Size = 10
    End With
    lastColName = APFreightTaxesStartCol
    
    ' lastColName = 18th Col for External and +1 for internal Report
    
    Dim hedgeRateColName As Integer
    Dim HedgeRowNum As Integer
    hedgeRateColName = 2
    HedgeRowNum = 5
     ' JP: Brazil uplift
     Do While (columnName < (lastColName + noOfAPJPricing + noOfAmerCosts))
     'If (noOfBaseConfigs > 0 And columnName = 30) Then
     If (noOfBaseConfigs > 0 And columnName > 29 And columnName < 42) Then
        'Addded By Govind calculation For Frieght APJ Pricing in local currencies
       
        startCell.Offset(row - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
        startCell.Offset(row - noOfFreights, columnName).NumberFormat = "0.00"
      
      ElseIf (noOfBaseConfigs > 0 And columnName > 41 And columnName < 53) Then
        'Addded By Govind calculation For Freight APJ Pricing in USD
        'GetDropDownChasis Selection
        'Getcounty Col value
        'Using above 2 get the freight value
        'Get the base selling price value
        HedgeRowNum = 15
        Dim countrycode As Integer
        'ChasisSelection
        
        startCell.Offset(row - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
        startCell.Offset(row - noOfFreights, columnName).NumberFormat = "0.00"
      
      ElseIf (noOfBaseConfigs > 0 And columnName > 53) Then
        'Addded By Govind calculation For Freight NA Pricing in local currencies
       
        startCell.Offset(row - noOfFreights, columnName).Formula = "=" & ColNames(regionalPricingStartCol - 1) & (row + startingRowOffset - 1 - noOfFreights) & "*IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & HedgeRowNum & "," & "Hedge!E" & HedgeRowNum & ")"
        startCell.Offset(row - noOfFreights, columnName).NumberFormat = "0.00"
      End If
       columnName = columnName + 1
       hedgeRateColName = hedgeRateColName + 1
       HedgeRowNum = HedgeRowNum + 1
    Loop
    
   
End Sub

Sub processHedgeRate()
    Dim startCell As Range
    Set startCell = Worksheets("HedgeRate").Range("a1")
    Set resultStartCell = Worksheets("HedgeRateTemp").Range("a1")
    Dim rowOffset As Integer
    Dim colOffset As Integer
    Dim currQtr As String
    Dim lastQtr As String
    Dim firstRec As Boolean
    Dim fromCurrency As String
    Dim toCurrency As String
    Dim conversionFactor As Double
    Dim isCurrentQuarter As Boolean
    isCurrentQuarter = False
    Dim resultColumnStartOffset As Integer
    'resultColumnStartOffset = 16
    resultColumnStartOffset = 0
    rowOffset = 1
    colOffset = 0
    resultCol = resultColumnStartOffset
    resultRow = 2
    Dim today As Date
    today = Date
    
    Dim quarterRange As Range
    Set quarterRange = Worksheets("Global Price").Range("G5")
    quarterRange.Value = today
        
    Set tempHedge = Worksheets("HedgeRateTemp").Range("a3:z1000")
    tempHedge.Clear
    
    'Add Report Date
    Set quarterRange = Worksheets("Global Price").Range("H5")
    
    firstRec = True
    Do While (startCell.Offset(rowOffset, colOffset).Value > 0)
        currQtr = startCell.Offset(rowOffset, colOffset).Value
        Dim startDate As Date
        Dim endDate As Date
        'startDate = startCell.Offset(rowOffset, colOffset + 1).Value
        'endDate = startCell.Offset(rowOffset, colOffset + 2).Value
        
        startDate = startCell.Offset(rowOffset, colOffset + 1).Value
        endDate = startCell.Offset(rowOffset, colOffset + 2).Value
        
        'MsgBox startDate
        'MsgBox endDate
        If (firstRec = True) Then
            lastQtr = currQtr
            resultStartCell.Offset(resultRow, resultCol).Value = startCell.Offset(rowOffset, colOffset).Value
            
            
            If (startDate <= today And endDate >= Date) Then
                isCurrentQuarter = True
                quarterRange.Value = startCell.Offset(rowOffset, colOffset).Value
                currentQuarterRowNum = resultRow + 1
                resultStartCell.Offset(resultRow, resultCol + 1).Value = "Current"
                Else
                resultStartCell.Offset(resultRow, resultCol + 1).Value = "No"
                isCurrentQuarter = False
            End If
            
            'Govind: APJ 3.1: StartDate Column in HedgeRateTemp = AC(coln: 28) and End Date =  AD(coln: 29)
            ' JP: Brazil uplift added 5 currencies
            'resultStartCell.Offset(resultRow, resultCol + 32).Value = startCell.Offset(rowOffset, colOffset + 1).Value
            'resultStartCell.Offset(resultRow, resultCol + 33).Value = startCell.Offset(rowOffset, colOffset + 2).Value
            
            'JP: PRODUCTION ISSUE - ADDED IDR CURRENCY
            resultStartCell.Offset(resultRow, resultCol + 33).Value = startCell.Offset(rowOffset, colOffset + 1).Value
            resultStartCell.Offset(resultRow, resultCol + 34).Value = startCell.Offset(rowOffset, colOffset + 2).Value
            
            resultCol = resultCol + 2
            firstRec = False
        End If
        If (currQtr <> lastQtr) Then
            resultRow = resultRow + 1
            resultCol = resultColumnStartOffset
            resultStartCell.Offset(resultRow, resultCol).Value = startCell.Offset(rowOffset, colOffset).Value
 
            'Govind: APJ 3.1: StartDate Column in HedgeRateTemp = AC(coln: 28) and End Date =  AD(coln: 29)
            ' JP: Brazil uplift added 5 currencies
            
            'resultStartCell.Offset(resultRow, resultCol + 32).Value = startCell.Offset(rowOffset, colOffset + 1).Value
            'resultStartCell.Offset(resultRow, resultCol + 33).Value = startCell.Offset(rowOffset, colOffset + 2).Value
            
            'JP: PRODUCTION ISSUE - ADDED IDR CURRENCY
            resultStartCell.Offset(resultRow, resultCol + 33).Value = startCell.Offset(rowOffset, colOffset + 1).Value
            resultStartCell.Offset(resultRow, resultCol + 34).Value = startCell.Offset(rowOffset, colOffset + 2).Value
            
            If (startDate <= today And endDate >= Date) Then
                isCurrentQuarter = True
                quarterRange.Value = startCell.Offset(rowOffset, colOffset).Value
                currentQuarterRowNum = resultRow + 1
                resultStartCell.Offset(resultRow, resultCol + 1).Value = "Current"
            Else
                If isCurrentQuarter = True Then
                    resultStartCell.Offset(resultRow, resultCol + 1).Value = "Future"
                    quarterRange.Offset(0, 1).Value = startCell.Offset(rowOffset, colOffset).Value
                    isCurrentQuarter = False
                Else
                    resultStartCell.Offset(resultRow, resultCol + 1).Value = "No"
                End If
            End If
            resultCol = resultCol + 2
        End If
        
        conversionFactor = startCell.Offset(rowOffset, colOffset + 5).Value
        fromCurrency = startCell.Offset(rowOffset, colOffset + 3).Value
        toCurrency = startCell.Offset(rowOffset, colOffset + 3).Value
        
        If conversionFactor = 0 Then
            conversionFactor = startCell.Offset(rowOffset, colOffset + 255).Value
        End If
        If (conversionFactor <> 0) Then
            Select Case fromCurrency
                Case "EUR"
                    resultStartCell.Offset(resultRow, 2).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "CZK"
                    resultStartCell.Offset(resultRow, 3).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "DKK"
                    resultStartCell.Offset(resultRow, 4).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "NOK"
                    resultStartCell.Offset(resultRow, 5).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "PLN"
                    resultStartCell.Offset(resultRow, 6).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "ZAR"
                    resultStartCell.Offset(resultRow, 7).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "SEK"
                    resultStartCell.Offset(resultRow, 8).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "CHF"
                    resultStartCell.Offset(resultRow, 9).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "GBP"
                    resultStartCell.Offset(resultRow, 10).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                'BR 9.15 Add RUB to CP and CM exports
                'Added "RUB" to display internal data
                Case "RUB"
                    resultStartCell.Offset(resultRow, 11).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                'End of BR 9.15 Changes
                'Author Govind
                'Added these cases to include APJ currencies for APJ 3.1 Rel
                Case "HKD"
                    resultStartCell.Offset(resultRow, 12).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "MOP"
                    resultStartCell.Offset(resultRow, 13).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "SGD"
                    resultStartCell.Offset(resultRow, 14).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "MYR"
                    resultStartCell.Offset(resultRow, 15).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "THB"
                    resultStartCell.Offset(resultRow, 16).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "TWD"
                    resultStartCell.Offset(resultRow, 17).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "KRW"
                    resultStartCell.Offset(resultRow, 18).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "AUD"
                    resultStartCell.Offset(resultRow, 19).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "NZD"
                    resultStartCell.Offset(resultRow, 20).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "CNY"
                    resultStartCell.Offset(resultRow, 21).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "JPY"
                    resultStartCell.Offset(resultRow, 22).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "INR"
                    resultStartCell.Offset(resultRow, 23).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "CAD"
                    resultStartCell.Offset(resultRow, 24).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                Case "MXN"
                    resultStartCell.Offset(resultRow, 25).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                
'JP: Brazil Uplift
                  Case "BRL"
                    resultStartCell.Offset(resultRow, 26).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                
                  Case "ARS"
                    resultStartCell.Offset(resultRow, 27).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                    
                  Case "CLP"
                    resultStartCell.Offset(resultRow, 28).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                  
                  Case "COP"
                    resultStartCell.Offset(resultRow, 29).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                    
                  Case "PEN"
                    resultStartCell.Offset(resultRow, 30).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                
                  Case "IDR"
                    resultStartCell.Offset(resultRow, 31).Formula = "=Round(" & 1 / conversionFactor * 1000 & ", 4)"
                
                'End of adding cases to include APJ currencies for APJ 3.1 Rel
            End Select
            If isCurrentQuarter = True Then
                If pricingCurrency <> "USD" Then
                    If pricingCurrency = fromCurrency Then
                        multiplyFactor = conversionFactor
                        currentQuarterColNum = currentQtrCurrencyCol
                    End If
                Else
                    multiplyFactor = 1
                End If
            End If
        End If
        rowOffset = rowOffset + 1
        resultCol = resultCol + 1
        lastQtr = currQtr
        firstRec = False
    Loop
    
    'Fill out the current Quarter Currency and Future Quarter currency Value.
    Dim currentQtrRowOffset As Integer
    currentQtrRowOffset = currentQuarterRowNum - 1
    Dim currencyCount As Integer
    'Govind - APJ:3.1: Total Currency Count is 24 now which include CAD and MXN!
   'JP: Brazil Uplift
    'JP - PRODUCTION ISSUE - ADDED IDR CURRENCY
    'currencyCount = 29
    currencyCount = 30
    Dim i As Integer
    i = 1
    Do While (i <= currencyCount)
        If (IsEmpty(resultStartCell.Offset(2, 1 + i))) Then
            resultStartCell.Offset(2, 1 + i).Value = 0
        End If
            i = i + 1
    Loop
    
    'Copy the missing values to the subsequent quarters
    Dim rowIncrement As Integer
    rowIncrement = 1
    Do While (2 + rowIncrement <= resultRow)
        i = 1
        Do While (i <= currencyCount)
        If (IsEmpty(resultStartCell.Offset(2 + rowIncrement, 1 + i))) Then
            resultStartCell.Offset(2 + rowIncrement, 1 + i).Value = resultStartCell.Offset(2 + rowIncrement - 1, 1 + i).Value
        End If
        i = i + 1
        Loop
        rowIncrement = rowIncrement + 1
    Loop
    
    '---------------------------------------------------
    'Populate "Hedge" Tab
    Dim currentRow As Range
    Dim hedge As Range
    Dim currentRowAddress As String
    Dim x As Integer
    Dim y As Integer
    x = 0
    y = 0
    
    currentRowAddress = "a" & currentQuarterRowNum
    
    Set currentRow = Worksheets("HedgeRateTemp").Range(currentRowAddress)
    Set hedge = Worksheets("Hedge").Range("a1")
    
    Do While (Not IsEmpty(currentRow.Offset(x, y)) Or currentRow.Offset(x, y).Value > 0)
        If y = 0 And x = 0 Then
            hedge.Offset(3, 0).Value = "Currency"
            hedge.Offset(3, 1).Value = "From"
            hedge.Offset(3, 2).Value = "To"
            hedge.Offset(3, 3).Value = currentRow.Offset(x, y).Value
            hedge.Range("a4:e4").Interior.ColorIndex = 15
            hedge.Offset(3, 4).Value = currentRow.Offset(x + 1, y).Value
        End If
        hedge.Offset(3, 0).EntireRow.Font.Bold = True
        hedge.Offset(3, 0).EntireRow.Font.Bold = True
        
        If y > 1 Then
            hedge.Offset(2 + y, 0).Value = currentRow.Offset((2 - currentQuarterRowNum), y).Value
            hedge.Offset(2 + y, 1).Value = "USD"
            hedge.Offset(2 + y, 2).Value = currentRow.Offset((1 - currentQuarterRowNum), y).Value
            hedge.Offset(2 + y, 3).Value = currentRow.Offset(x, y).Value
            hedge.Offset(2 + y, 3).NumberFormat = "0.0000"
            hedge.Offset(2 + y, 4).Value = currentRow.Offset(x + 1, y).Value
            hedge.Offset(2 + y, 4).NumberFormat = "0.0000"
        End If
        y = y + 1
    Loop
    'Add a row for USD to USD for error handling purpose if the pricing currency is USD
    'Author Govind
    'Commented below lines not to insert new row in the Hedge tab for APJ 3.1 Rel
    'Shalini - uncommenting to fix :  TAS000000675391 - INC000018567083 - Incorrect value calculation in Deal Currency matrix for FY16Q2
    
    hedge.Offset(2 + y, 0).Value = "US Dollar"
    hedge.Offset(2 + y, 1).Value = "USD"
    hedge.Offset(2 + y, 2).Value = "USD"
    hedge.Offset(2 + y, 3).Value = 1
    hedge.Offset(2 + y, 3).NumberFormat = "0.0000"
    hedge.Offset(2 + y, 4).Value = 1
    hedge.Offset(2 + y, 4).NumberFormat = "0.0000"
    
    'JP: 200012:Currency Matrix APJ  - Hedge Customer are different ffrom Treasury
    'Copy the 3 country value from "Hedge Bussiness APJ" tab
    'Malaysia
    hedge.Offset(14, 3).Formula = "='HEDGE BUSINESS APJ'!D15"
    hedge.Offset(14, 4).Formula = "='HEDGE BUSINESS APJ'!E15"
    'Macau
    hedge.Offset(15, 3).Formula = "='HEDGE BUSINESS APJ'!D16"
    hedge.Offset(15, 4).Formula = "='HEDGE BUSINESS APJ'!E16"
    'Singapore Dollar
    hedge.Offset(16, 3).Formula = "='HEDGE BUSINESS APJ'!D17"
    hedge.Offset(16, 4).Formula = "='HEDGE BUSINESS APJ'!E17"
    'Malaysia
    hedge.Offset(17, 3).Formula = "='HEDGE BUSINESS APJ'!D18"
    hedge.Offset(17, 4).Formula = "='HEDGE BUSINESS APJ'!E18"
    'Thai Baht
    hedge.Offset(18, 3).Formula = "='HEDGE BUSINESS APJ'!D19"
    hedge.Offset(18, 4).Formula = "='HEDGE BUSINESS APJ'!E19"
    'Taiwanese Dollar
    hedge.Offset(19, 3).Formula = "='HEDGE BUSINESS APJ'!D20"
    hedge.Offset(19, 4).Formula = "='HEDGE BUSINESS APJ'!E20"
    'S. Korean Won
    hedge.Offset(20, 3).Formula = "='HEDGE BUSINESS APJ'!D21"
    hedge.Offset(20, 4).Formula = "='HEDGE BUSINESS APJ'!E21"
    'Australian Dollar
    hedge.Offset(21, 3).Formula = "='HEDGE BUSINESS APJ'!D22"
    hedge.Offset(21, 4).Formula = "='HEDGE BUSINESS APJ'!E22"
    'New Zealand Dollar
    hedge.Offset(22, 3).Formula = "='HEDGE BUSINESS APJ'!D23"
    hedge.Offset(22, 4).Formula = "='HEDGE BUSINESS APJ'!E23"
    'Chineess
    hedge.Offset(23, 3).Formula = "='HEDGE BUSINESS APJ'!D24"
    hedge.Offset(23, 4).Formula = "='HEDGE BUSINESS APJ'!E24"
    'Japanes Yen
    hedge.Offset(24, 3).Formula = "='HEDGE BUSINESS APJ'!D25"
    hedge.Offset(24, 4).Formula = "='HEDGE BUSINESS APJ'!E25"
    'India
    hedge.Offset(25, 3).Formula = "='HEDGE BUSINESS APJ'!D26"
    hedge.Offset(25, 4).Formula = "='HEDGE BUSINESS APJ'!E26"
End Sub

Sub showQuarterList()
    Dim quarterList As Range
    Dim srcList As Range
    
    Set quarterList = Worksheets("Global Price").Range("s3")
    quarterList.Value
End Sub

Sub formatReport()
    
    Dim formatSheet As Worksheet
    Set formatSheet = Worksheets("Global Price")
    formatSheet.Activate
    Rows("5:10").RowHeight = 20
    With Rows("5:10").Font
        .Name = "Arial"
        .Size = 14
    End With
    'Rows("10:10").RowHeight = 12.75
    Rows("15:15").RowHeight = 30
    With Rows("15:15").Font
        .Name = "Arial"
        .Size = 20
        .Bold = True
    End With
    With Rows("17:17").Font
        .Name = "Arial"
        .Size = 10
    End With
    Rows("17:17").RowHeight = 40
    Columns("A:A").ColumnWidth = 32
    Columns("B:B").ColumnWidth = 70
    Columns("C:C").ColumnWidth = 10
    Columns("D:AA").ColumnWidth = 15
    Rows("18:5000").RowHeight = 12.75
    formatQuarter
End Sub

Public Sub createHeader()
'In this section, we construct the
'Header information of the report.

    Dim AnswerCell As Range
    Dim reportSheet As Worksheet
    Dim srcRange As Range
    Dim myVID As String
    Dim GcpFlag As Integer
    
    Dim ReportCell As Range
    Set reportSheet = Worksheets("Global Price")
    Set ReportCell = Worksheets("Global Price").Range("a4")
    Set srcRange = Worksheets("Header").Range("a1")
    
    Dim ConfigCurrencyCell As Range
    Set ConfigCurrencyCell = Worksheets("ConfigLines").Range("o2")
    Dim lineItemPricingCurrency As String
    lineItemPricingCurrency = ConfigCurrencyCell.Value
    
    
    ReportCell.Offset(1, 0).Value = "Account"
    ReportCell.Offset(2, 0).Value = "Goal Deal ID"
    ReportCell.Offset(3, 0).Value = "Goal Name"
    ReportCell.Offset(4, 0).Value = "Pricing Effective For"
    'JP: Change Request 2908985:Currency Matrix Adjustments
    ReportCell.Offset(5, 0).Value = "SFDC ID"
    ReportCell.Offset(6, 0).Value = "Price Book Resource"
    
    ' JP: Brazil uplift create a Name Manager
    'JP:1161061:Currency matrix - automate the Brazil uplift selection
'    ReportCell.Offset(6, 1).Validation.Add xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=PriceBookResource"
'    ReportCell.Offset(6, 1).Validation.IgnoreBlank = True
'    ReportCell.Offset(6, 1).Validation.InCellDropdown = True
     
    'ReportCell.Offset(5, 0).Value = "Pricing Effective To"
    'ReportCell.Offset(5, 0).Value = "GCP Config"
    
    ReportCell.Offset(1, 1).Value = srcRange.Offset(1, 0)
    myVID = srcRange.Offset(1, 1).Value
    myVID = Application.WorksheetFunction.Substitute(myVID, "_W_", "")
    
    ReportCell.Offset(2, 1).Value = myVID
    
    ReportCell.Offset(3, 1).Value = srcRange.Offset(1, 2)
    'JP: Change Request 2908985:Currency Matrix Adjustments
    ReportCell.Offset(5, 1).Value = srcRange.Offset(1, 8)
    
    'ReportCell.Offset(4, 1).Value = Format(srcRange.Offset(1, 3).Value, "DD-MMM-YYYY")
    'ReportCell.Offset(5, 1).Value = Format(srcRange.Offset(1, 4).Value, "DD-MMM-YYYY")
    
    'GcpFlag = updateGCPFlag(1)
    'If (GcpFlag = 1) Then
     ' ReportCell.Offset(5, 1).Value = "Yes"
    'ElseIf (GcpFlag = 1) Then
      'ReportCell.Offset(5, 1).Value = "No"
    'End If
    
    If IsEmpty(ConfigCurrencyCell) Then
        pricingCurrency = srcRange.Offset(1, 7).Value
    Else
        If Not IsEmpty(ConfigCurrencyCell.Offset(1, 0)) Then
            pricingCurrency = ConfigCurrencyCell.Offset(1, 0).Value
        Else
            pricingCurrency = ConfigCurrencyCell.Value
        End If
    End If
    
    'Set the default pricing currency, if it is not present.
    If IsEmpty(srcRange.Offset(1, 7)) Then
        pricingCurrency = "USD"
    End If
    If pricingCurrency = "USD" Then
        multiplyFactor = 1
    End If
    ReportCell.Font.Bold = True
    
    Dim currCell As Range
    Set currCell = reportSheet.Range("a11")
    
    createHeaderNotes currCell '3 lines are created here.
    
    Set currCell = currCell.Offset(4, 0)
    currCell.Value = "Configurations"
    currCell.Font.Name = "Arial"
    currCell.Font.Size = 20
    
    Set currCell = currCell.Offset(0, 1)
    currCell.Value = "Regional Pricing - All Values are in USD"
    currCell.Font.Name = "Arial"
    currCell.Font.Size = 20

End Sub

Public Sub createHeaderNotes(StartingLocation As Range)
    StartingLocation.EntireRow.Hidden = True
    StartingLocation.Offset(1, 0).EntireRow.Hidden = True
    StartingLocation.Offset(2, 0).EntireRow.Hidden = True
End Sub

Public Sub hideWorksheets()
    Worksheets("Header").Visible = xlSheetVeryHidden
    Worksheets("ConfigLines").Visible = xlSheetVeryHidden
    Worksheets("SKUList").Visible = xlSheetVeryHidden
    Worksheets("Uplift").Visible = xlSheetVeryHidden
    Worksheets("HedgeRate").Visible = xlSheetVeryHidden
    Worksheets("HedgeRateTemp").Visible = xlSheetVeryHidden
    Worksheets("TempSheet").Visible = xlSheetVeryHidden
    Worksheets("ConfigLabelList").Visible = xlSheetVeryHidden
    Worksheets("ParameterData").Visible = xlSheetVeryHidden
    'Govind-Added this new tab for APJ 3.1 Rel
    'Worksheets("APJ freights and duties").Visible = xlSheetVeryHidden
    Worksheets("Global SKUS").Visible = xlSheetVeryHidden
    Worksheets("Asia Uplifts and notes").Visible = xlSheetVeryHidden
    
End Sub

Public Sub unhideWorksheets()
    Worksheets("Header").Visible = True
    Worksheets("ConfigLines").Visible = True
    Worksheets("Uplift").Visible = True
    Worksheets("SKUList").Visible = True
    Worksheets("HedgeRate").Visible = True
    Worksheets("HedgeRateTemp").Visible = True
    Worksheets("TempSheet").Visible = True
    Worksheets("ConfigLabelList").Visible = True
    Worksheets("ParameterData").Visible = True
    'Govind-Added this new tab for APJ 3.1 Rel
    Worksheets("APJ freights and duties").Visible = True
    Worksheets("Global SKUS").Visible = True
    Worksheets("Asia Uplifts and notes").Visible = True
    'JP: 200012:Currency Matrix APJ  - Hedge Customer are different ffrom Treasury
    Worksheets("HEDGE BUSINESS APJ").Visible = True
    
    
End Sub

Public Sub drawBottomLine(xlRange As Range)
    With xlRange
        With .Borders(Excel.XlBordersIndex.xlEdgeTop)
                        .ColorIndex = 0
                        .Weight = Excel.XlBorderWeight.xlThin
                        .LineStyle = Excel.XlLineStyle.xlContinuous
                        .TintAndShade = 0
        End With
    End With
End Sub

Sub SortSKUList()
   Worksheets("SKUList").Range("A2:Z10000").Sort _
        Key1:=Worksheets("SKUList").Range("P2"), _
        Key1:=Worksheets("SKUList").Range("B2"), _
        Key1:=Worksheets("SKUList").Range("Q2"), _
        Key1:=Worksheets("SKUList").Range("C2"), _
        Key1:=Worksheets("SKUList").Range("R2"), _
        Key1:=Worksheets("SKUList").Range("J2"), _
        Key1:=Worksheets("SKUList").Range("N2"), _
        Key1:=Worksheets("SKUList").Range("H2")
End Sub

Sub testHedgeRate()
    Dim x As Integer
    x = HedgeRateRow("SEK")
    MsgBox x
End Sub

Function HedgeRateRow(pricingCurrency As String)
        Select Case pricingCurrency
            Case "EUR"
                HedgeRateRow = 5
            Case "CZK"
                HedgeRateRow = 6
            Case "DKK"
                HedgeRateRow = 7
            Case "NOK"
                HedgeRateRow = 8
            Case "PLN"
                HedgeRateRow = 9
            Case "ZAR"
                HedgeRateRow = 10
            Case "SEK"
                HedgeRateRow = 11
            Case "CHF"
                HedgeRateRow = 12
            Case "GBP"
                HedgeRateRow = 13
            'BR 9.15 Add RUB to CP and CM exports
            'Added "RUB" with HedgeRateRow as 14 and Modified "USD" HedgeRateRow as 15.
            Case "RUB"
                HedgeRateRow = 14
            'End of BR 9.15 Changes
            'Author Govind
            'Added these cases to include the APJ currencies for APJ 3.1 Rel
            Case "HKD"
                HedgeRateRow = 15
            Case "MOP"
                HedgeRateRow = 16
            Case "SGD"
                HedgeRateRow = 17
            Case "MYR"
                HedgeRateRow = 18
            Case "THB"
                HedgeRateRow = 19
            Case "TWD"
                HedgeRateRow = 20
            Case "KRW"
                HedgeRateRow = 21
            Case "AUD"
                HedgeRateRow = 22
            Case "NZD"
                HedgeRateRow = 23
            Case "CNY"
                HedgeRateRow = 24
            Case "JPY"
                HedgeRateRow = 25
            Case "INR"
                HedgeRateRow = 26
            Case "CAD"
                HedgeRateRow = 27
            Case "MXN"
                HedgeRateRow = 28
            'End Of adding cases to include the APJ currencies for APJ 3.1 Rel
            'Case USD in moved to down to bottom as per the Hedge tab rows
            
            ' JP Brazil uplift
            Case "BRL"
                HedgeRateRow = 29
            Case "ARS"
                HedgeRateRow = 30
            Case "CLP"
                HedgeRateRow = 31
            Case "COP"
                HedgeRateRow = 32
            Case "PEN"
                HedgeRateRow = 33
                
            'JP: Production ISSUE - ADDED IDR CURRENCY
            Case "IDR"
                HedgeRateRow = 34
            
            Case "USD"
                HedgeRateRow = 35
                
            End Select
End Function


Public Sub formatPricingEffective()

    'Added By Purvi -  new CR
    Dim quarterRange1 As Range
    Set quarterRange1 = Worksheets("Global Price").Range("F5")
    
    Dim currentQuarter1 As Range
    Set currentQuarter1 = Worksheets("Global Price").Range("H5")
    
    Dim futureQuarter1 As Range
    Set futureQuarter1 = Worksheets("Global Price").Range("I5")
    
    Set ReportCell = Worksheets("Global Price").Range("a4")
   
    
    If quarterRange1.Value = "Current" Then
         ReportCell.Offset(4, 1).Value = currentQuarter1
    Else
         ReportCell.Offset(4, 1).Value = futureQuarter1
    End If

End Sub

Sub clearListPrice()
    Dim lPrice As Range
    Set lPrice = Range("D:D")
    lPrice.Value = ""
    Selection.Columns("D:D").Hidden = True
End Sub

Public Sub updateSkuLabels()
Dim skuListRange As Range
Dim configLinesRange As Range

Dim wrkShtSkulist As Worksheet
Dim wrkShtConfigLines As Worksheet
Dim skulistRowCount  As Integer
Dim configLinesRowCount  As Integer
Dim str As String
Dim strConfig As String
Dim strConfigLines As String


Set wrkShtSkulist = Worksheets("SkuList")
If CStr(wrkShtSkulist.Range("E2").Value) = "Dummy" Then

    Set skuListRange = wrkShtSkulist.Range("Vendavo_Data3")
    skulistRowCount = skuListRange.Rows.Count
    wrkShtSkulist.Activate
    
    str = "SkuList!E2:SkuList!E" & skulistRowCount
    Range(str).Formula = "=" & "VLOOKUP(D$2:D$" & skulistRowCount & ",ConfigLabelList!Vendavo_Data6,2,FALSE)"
    
    
    Set wrkShtConfigLines = Worksheets("ConfigLines")
    Set configLinesRange = wrkShtConfigLines.Range("Vendavo_Data2")
    configLinesRowCount = configLinesRange.Rows.Count
    wrkShtConfigLines.Activate
    strConfigLines = "ConfigLines!D2:ConfigLines!D" & configLinesRowCount
    Range(strConfigLines).Formula = "=" & "VLOOKUP(C$2:C$" & configLinesRowCount & ",ConfigLabelList!Vendavo_Data6,2,FALSE)"


End If
End Sub
'Author Govind
'Added this function to update the status flag for APJ 3.1 Rel
Function updateGCPFlag(x As Integer)
    Dim Src As Range
    Dim Dest As Range
     
    Set Src = Worksheets("SKUList").Range("G2", Worksheets("SKUList").Range("G1000").End(xlUp))
    Set Dest = Worksheets("Global SKUS").Range("D5", Worksheets("Global SKUS").Range("D1000").End(xlUp))
     
    For Each c In Src
        Set D = Dest.Find(c.Value, LookIn:=xlValues)
        If Not D Is Nothing Then
            'MsgBox "Yes"
            updateGCPFlag = 1
            Set D = Nothing
            Exit Function
        End If
    Next c
          'MsgBox "No"
          updateGCPFlag = 0
End Function
'Author Govind
'Added this method to fetch the chassis code selection from dropdown in Global Price Tab
Sub GetDropdown()
    Dim ws As Worksheet
    Dim dd As DropDown
    Dim Src As Range
    Dim Dest As Range
    'Dim x As String
    Dim y As Integer
    
    
    Set Src = Worksheets("APJ freights and duties").Range("C11", Worksheets("APJ freights and duties").Range("E381").End(xlUp))
    Set Dest = Worksheets("Uplift").Range("A2", Worksheets("Uplift").Range("B12").End(xlUp))
    'MsgBox "111"
    Set ws = ActiveSheet
    Set dd = ws.Shapes("Chasis_DrpValues").OLEFormat.Object
    ChasisSelection = dd.List(dd.ListIndex)
    'MsgBox ChasisSelection
    
   With ThisWorkbook.Worksheets("APJ freights and duties")
     
     y = Application.VLookup(ChasisSelection, Src, 3, False)
    
     'MsgBox y
     Dest.Range("B12").Value = y
    End With
    'GetFreightFromChasisDropdown
    'processReport
End Sub
'Author Govind
'Added this method to Get the freight values for APJ 3.1 Rel
Sub GetFreightFromChasisDropdown()
    Dim ws As Worksheet
    Dim dd As DropDown
    Dim Src As Range
    Dim Dest As Range
    Dim x As String
    Dim y As Integer
    Dim Country_Col As Integer
    
    Country_Col = 0
    Set Src = Worksheets("APJ freights and duties").Range("C11", Worksheets("APJ freights and duties").Range("Y381").End(xlUp))
    'Set Dest = Worksheets("Uplift").Range("A2", Worksheets("Uplift").Range("B12").End(xlUp))
    'MsgBox "111"
    Set ws = ActiveSheet
    Set dd = ws.Shapes("Chasis_DrpValues").OLEFormat.Object
    x = dd.List(dd.ListIndex)
    
    
    With ThisWorkbook.Worksheets("APJ freights and duties")
              
    y = Application.VLookup(x, Src, 6, False)
    
    
     
     'Dest.Range("B12").Value = y
    End With
    'processReport
End Sub
'Author Govind
'Added this function to return the country based on the pricing currency
Function Country_Col(country As Integer)
  Select Case pricingCurrency
            Case "15"
                Country_Col = 4
            Case "16"
                Country_Col = 5
            Case "17"
                Country_Col = 6
            Case "18"
                Country_Col = 8
            Case "19"
                Country_Col = 9
            Case "20"
                Country_Col = 10
            Case "21"
                Country_Col = 11
            Case "22"
                Country_Col = 12
            Case "23"
                Country_Col = 13
            Case "24"
                Country_Col = 14
            Case "25"
                Country_Col = 15
            Case "26"
                Country_Col = 17
            Case "27"
                Country_Col = 0
            Case "28"
                Country_Col = 0
                        
            End Select

End Function

'Govind - Added below as part of APJ 3.1 to display Freight and Tax value
Sub displayFreightAndTax(destinationCell As Range, chasisRownum As Integer, taxesRowNum As Integer)

'On Error GoTo ErrorHandler

Dim destColn As Integer
Dim withFreightValue As Double
Dim chasisColnName As String
Dim countryColnName As String

Dim country As String

Dim countryColn As Integer
Dim baseSPAdded As Double
'JP: 198134:Currency Matrix APJ - ASIA PACIFIC Pricing in Local Currency - with Freight and Dutees are not calculated for all countries
Dim hedgeCount As Integer
hedgeCount = 15
Dim tempFreightColnName As String
Dim tempINDFreightColnName As String
Dim tempINDTaxColnName As String
Dim tempCountryColnName As String
'JP: End of declaration: 198134:Currency Matrix APJ - ASIA PACIFIC Pricing in Local Currency - with Freight and Dutees are not calculated for all countries

'Offset to Japan Direct, i.e, column M from current column position in APJ regional Pricing
Dim offsetToAPACDir As Integer
offsetToAPACDir = 30
Dim idxStr_freight As String
Dim idxStr_duty As String
Dim idxStr_tax As String
Dim freightColnName As String
'JP: 207316:Work around - calcualte only the INDIA Rs pricing
Dim idxStr_QTRIND As String
Dim idxStr_freightIND As String
Dim idxStr_dutyIND As String
Dim idxStr_taxIND As String
Dim baseSPAddedIND As Double
'JP: End of 207316:Work around - calcualte only the INDIA Rs pricing

'JP: 207318 - Correct Duties calculation in the With Freight
Dim idxStr_QTRHKD As String
Dim idxStr_freightHKD As String
Dim idxStr_dutyHKD As String
Dim idxStr_taxHKD As String
Dim baseSPAddedHKD As Double
'JP: Modified 19-Nov - 210446:Currency Matrix - APJ - macro to get the "with Freight" and "with Taxes" doesn't work when selecting quarter = Future
Dim baseSPRange As String

'JP: End of 207318 - Correct Duties calculation in the With Freight

destColn = 0
'42- Corresponds to AQ value in ColNames array. APJ Pricing section with country HKD starts at AQ column of Global Price Tab.
countryColn = 42
'For India Freight not needed. Hence last India column to be ignored
 Do While (destColn < noOfAPJCosts) 'JP: Removed -1 included India Freights and Taxes
    chasisColnName = "B" & chasisRownum
    countryColnName = ColNames(countryColn + destColn) & "17"
    freightColnName = ColNames(countryColn + destColn) & (taxesRowNum - 1)
       
    
    If (countryColnName = "ba17") Then
         'For Japan, take regional SP
         baseSPAdded = destinationCell.Offset(0, destColn - 12).Value
    Else
         'For other countries, take USD value, i.e., value from column M
         baseSPAdded = destinationCell.Offset(0, destColn - offsetToAPACDir).Value
    End If
        'For Freight value
        'JP: changed from 338 to 332 as per Vero request
        idxStr_freight = "INDEX('APJ freights and duties'!C14:AT350,MATCH(" & chasisColnName & ",'APJ freights and duties'!C14:C350,0),MATCH(" & countryColnName & ",'APJ freights and duties'!C14:Y14,0))"
        
       
        'For Duties value
        'JP: changed from 338 to 350 as per Vero request
        idxStr_duty = "INDEX('APJ freights and duties'!C14:AT350,MATCH(" & chasisColnName & ",'APJ freights and duties'!C14:C350,0),MATCH(" & countryColnName & ",'APJ freights and duties'!AA14:AT14,0) + 24)"
        'For Taxes value
        idxStr_tax = "HLOOKUP(" & countryColnName & ",'APJ freights and duties'!Z1:AT10,10,FALSE)"
                
        'destinationCell.Offset(2, destColn).Formula = "=IFERROR(SUM(" & idxStr_freight & "," & baseSPAdded & "), 0)"
        'APJ 3.1 Rel Modified as per the latest req on 23/02/2015
        'Author: Govind
        'destinationCell.Offset(2, destColn).Formula = "=IFERROR(PRODUCT(" & idxStr_duty & "," & freightColnName & " ),0)"
       ' destinationCell.Offset(2, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_duty & "), 0)"
       ' destinationCell.Offset(2, destColn).NumberFormat = "0.00"
       
        If (countryColnName = "ba17") Then
            'JP: 207318 - Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
           'destinationCell.Offset(2, destColn - 12).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_duty & "), 0)"
           ' destinationCell.Offset(2, destColn - 12).NumberFormat = "0.00"
            
            'JP: 198131:Currency Matrix APJ - ASIA PACIFIC Pricing in USD - update JAPAN
            destinationCell.Offset(2, destColn).NumberFormat = "0.00"
            'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
            destinationCell.Offset(2, destColn).Formula = "=" & "AO" & taxesRowNum - 1 & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D25" & "," & "Hedge!E25" & ")"
            
            
            'destinationCell.Offset(3, destColn).Formula = "=IFERROR(SUM(" & idxStr_duty & "," & freightColnName & " ),0)"
            'JP: 207318 - Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
            'destinationCell.Offset(3, destColn - 12).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_tax & "), 0)"
            'destinationCell.Offset(3, destColn - 12).NumberFormat = "0.00"
            'JP: end of  207318 - Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
            
            'JP: 198131:Currency Matrix APJ - ASIA PACIFIC Pricing in USD - update JAPAN
            destinationCell.Offset(3, destColn).NumberFormat = "0.00"
            'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
            destinationCell.Offset(3, destColn).Formula = "=" & "AO" & taxesRowNum & "/ IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D25" & "," & "Hedge!E25" & ")"
            
        Else
            
           ' Start of 'JP: 198134:Currency Matrix APJ - ASIA PACIFIC Pricing in Local Currency - with Freight and Dutees are not calculated for all countries
           'JP: 205787 - Currency Matrix - for INDIA column, line "With Freight" and "With Taxes", mention *to be confirmed locally* instead of 0
           If ((destColn >= 0 And destColn < 10)) Then
                
                tempFreightColnName = ColNames(countryColn + destColn) & (taxesRowNum)
                
                'destinationCell.Offset(2, destColn - 12).Formula = "=" & freightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & ")"
                'destinationCell.Offset(2, destColn - 12).NumberFormat = "0.00"
                    
                'destinationCell.Offset(3, destColn - 12).NumberFormat = "0.00"
                'destinationCell.Offset(3, destColn - 12).Formula = "=" & tempFreightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & ")"
                
                'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                If (destColn = 3) Then 'JP: Malaysia
                    destinationCell.Offset(2, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(2, destColn - 12).Formula = "=IF(" & freightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & ",MRound(" & freightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "),0.05))"
                    destinationCell.Offset(3, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(3, destColn - 12).Formula = "=IF(" & tempFreightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & ",MRound(" & tempFreightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "),0.05))"
                ElseIf (destColn = 5) Then 'JP: Taiwan
                    destinationCell.Offset(2, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(2, destColn - 12).Formula = "=IF(" & freightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & ",Round(" & freightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "),0))"
                    destinationCell.Offset(3, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(3, destColn - 12).Formula = "=IF(" & tempFreightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & ",Round(" & tempFreightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "),0))"
                ElseIf (destColn = 6) Then 'JP: Korea
                    destinationCell.Offset(2, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(2, destColn - 12).Formula = "=IF(" & freightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & ",Round(" & freightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "),0))"
                    destinationCell.Offset(3, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(3, destColn - 12).Formula = "=IF(" & tempFreightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & ",Round(" & tempFreightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "),0))"
                Else
                    destinationCell.Offset(2, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(2, destColn - 12).Formula = "=IF(" & freightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & "," & freightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "))"
                    destinationCell.Offset(3, destColn - 12).NumberFormat = "0.00"
                    destinationCell.Offset(3, destColn - 12).Formula = "=IF(" & tempFreightColnName & "=" & Chr(34) & "Product N/A" & Chr(34) & "," & Chr(34) & "Product N/A" & Chr(34) & "," & tempFreightColnName & "* IF((Quarter=" & Chr(34) & "Current" & Chr(34) & "),Hedge!D" & hedgeCount & "," & "Hedge!E" & hedgeCount & "))"
                End If
            
                hedgeCount = hedgeCount + 1
            End If
            
            tempCountryColnName = ColNames(countryColn - 1 + destColn) & "17"
            'JP: 205787 - Currency Matrix - for INDIA column, line "With Freight" and "With Taxes", mention *to be confirmed locally* instead of 0
            'tempINDFreightColnName = "M" & taxesRowNum - 1 & ""
            'tempINDTaxColnName = "+BB" & taxesRowNum & ""
            
   
            'JP: 207316:Work around - calcualte only the INDIA Rs pricing
            'JP: 205787 - Currency Matrix - for INDIA column, line "With Freight" and "With Taxes", mention *to be confirmed locally* instead of 0
            If (tempCountryColnName = "ap17") Then
            
            'JP: 207316:Work around - calcualte only the INDIA Rs pricing
                ''JP: Modified 19-Nov - 210446:Currency Matrix - APJ - macro to get the "with Freight" and "with Taxes" doesn't work when selecting quarter = Future
                baseSPRange = ColNames(countryColn + destColn - 1) & (taxesRowNum - 3)
                'baseSPAddedIND = destinationCell.Offset(0, destColn - 1).Value
                idxStr_QTRIND = "=+PRODUCT(SUM(" & baseSPRange & ",IF(Quarter=" & Chr(34) & "Current" & Chr(34) & ","
                idxStr_freightIND = "INDEX('APJ freights and duties'!$C$14:$AT$350,MATCH(" & chasisColnName & ",'APJ freights and duties'!$C$14:$C$350,0),MATCH(AP17,'APJ freights and duties'!$C$14:$Y$14,0))*Hedge!D26,"
                idxStr_dutyIND = "INDEX('APJ freights and duties'!$C$14:$AT$350,MATCH(" & chasisColnName & ",'APJ freights and duties'!$C$14:$C$350,0),MATCH(AP17,'APJ freights and duties'!$C$14:$Y$14,0))*Hedge!E26)),"
                idxStr_taxIND = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$Z$350,24,0))"
            
                destinationCell.Offset(2, destColn - 1).Formula = idxStr_QTRIND & idxStr_freightIND & idxStr_dutyIND & idxStr_taxIND
                destinationCell.Offset(2, destColn - 1).NumberFormat = "0.00"
                destinationCell.Offset(3, destColn - 1).Value = "*To Be Confirmed Locally*"
                
            End If
            ' End of 'JP: 198134:Currency Matrix APJ - ASIA PACIFIC Pricing in Local Currency - with Freight and Dutees are not calculated for all countries
            
            'JP: 199962 - APJ - ASIA PACIFIC Pricing in Local Currency India + calculation in USD
            'If (countryColnName = "bb17") Then
                'tempBaseSPAdded = destinationCell.Offset(0, (destColn + 2) - offsetToAPACDir + 2).Value
           
            'destinationCell.Offset(2, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & tempBaseSPAdded & "," & idxStr_freight & ")," & idxStr_duty & "), 0)"
            'destinationCell.Offset(2, destColn).NumberFormat = "0.00"
            ' 'destinationCell.Offset(3, destColn).Formula = "=IFERROR(SUM(" & idxStr_duty & "," & freightColnName & " ),0)"
            'destinationCell.Offset(3, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_tax & "), 0)"
            'destinationCell.Offset(3, destColn).NumberFormat = "0.00"
           ' End of 'JP: 199962 - APJ - ASIA PACIFIC Pricing in Local Currency India + calculation in USD
          ' Else
            
            ' JP: 205787 - Currency Matrix - for INDIA column, line "With Freight" and "With Taxes", mention *to be confirmed locally* instead of 0
            If (countryColnName = "bb17") Then
                 baseSPRange = ColNames(countryColn + destColn) & (taxesRowNum - 3)
                 
                    idxStr_QTRHKD = "=IFERROR(PRODUCT(SUM(" & baseSPRange & ","
                    idxStr_freightHKD = "INDEX('APJ freights and duties'!$C$14:$AT$350,MATCH(" & chasisColnName & ",'APJ freights and duties'!$C$14:$C$350,0),"
                    'JP: Change Request: 2186568:Currency Matrix - India Duties should be removed
                    idxStr_dutyHKD = "MATCH(BB17,'APJ freights and duties'!$C$14:$Y$14,0))))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                    'JP: Change Request: 2186568:Currency Matrix - India Duties should be removed
                    'idxStr_taxIND = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,24,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                    'JP: Change Request: 2186568:Currency Matrix - India Duties should be removed
                    'destinationCell.Offset(2, destColn).Formula = idxStr_QTRHKD & idxStr_freightHKD & idxStr_dutyHKD & idxStr_taxIND
                    destinationCell.Offset(2, destColn).Formula = idxStr_QTRHKD & idxStr_freightHKD & idxStr_dutyHKD
                    'JP: Change Request: 2186568:Currency Matrix - India Duties should be removed
                    destinationCell.Offset(2, destColn).NumberFormat = "####.##"
                    destinationCell.Offset(3, destColn).Value = "*To Be Confirmed Locally*"
            Else
                'destinationCell.Offset(2, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_duty & "), 0)"
                'destinationCell.Offset(2, destColn).NumberFormat = "0.00"
                 ''destinationCell.Offset(3, destColn).Formula = "=IFERROR(SUM(" & idxStr_duty & "," & freightColnName & " ),0)"
                'destinationCell.Offset(3, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_tax & "), 0)"
                'destinationCell.Offset(3, destColn).NumberFormat = "0.00"
               
                    'JP: 207318 - Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
                     'JP: Modified 19-Nov - 210446:Currency Matrix - APJ - macro to get the "with Freight" and "with Taxes" doesn't work when selecting quarter = Future
                     'baseSPAddedHKD = destinationCell.Offset(0, destColn).Value
                     baseSPRange = ColNames(countryColn + destColn) & (taxesRowNum - 3)
                    idxStr_QTRHKD = "=IFERROR(PRODUCT(SUM(" & baseSPRange & ","
                    idxStr_freightHKD = "INDEX('APJ freights and duties'!$C$14:$AT$350,MATCH(" & chasisColnName & ",'APJ freights and duties'!$C$14:$C$350,0),"
                    idxStr_dutyHKD = "MATCH(AQ17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   
                   If (countryColnName = "aq17") Then       'Hongkong => 25
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,25,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AQ17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "ar17") Then       'Macau => 26
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,26,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AR17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "as17") Then   'Singapore => 27
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,27,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AS17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "at17") Then   'Malaysia => 29
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        idxStr_QTRHKD = "=IFERROR(PRODUCT(SUM(" & baseSPRange & ","
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,29,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AT17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "au17") Then     'Thailand => 30
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,30,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AU17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "av17") Then      'Taiwan => 31
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        idxStr_QTRHKD = "=IFERROR(PRODUCT(SUM(" & baseSPRange & ","
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,31,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AV17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "aw17") Then       'Korea => 32
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        idxStr_QTRHKD = "=IFERROR(PRODUCT(SUM(" & baseSPRange & ","
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,32,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AW17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "ax17") Then       'Australia => 33
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,33,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AX17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "ay17") Then       'New Zealand => 34
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,34,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AY17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   ElseIf (countryColnName = "az17") Then       'China => 25
                        idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,25,0))," & Chr(34) & "Product N/A" & Chr(34) & ")"
                        idxStr_dutyHKD = "MATCH(AZ17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                   End If
                   
                    destinationCell.Offset(2, destColn).Formula = idxStr_QTRHKD & idxStr_freightHKD & idxStr_dutyHKD & idxStr_taxHKD
                    'destinationCell.Offset(2, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPAdded & "," & idxStr_freight & ")," & idxStr_duty & ")," & Chr(34) & "Product N/A" & Chr(34) & ")"
                
                'JP: 207318 - End of Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
                    
                    destinationCell.Offset(2, destColn).NumberFormat = "0.00"
                    'JP: Modified 19-Nov - 210446:Currency Matrix - APJ - macro to get the "with Freight" and "with Taxes" doesn't work when selecting quarter = Future
                    If (countryColnName = "at17") Then   'Malaysia => 29
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        destinationCell.Offset(3, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPRange & "," & idxStr_freight & ")," & idxStr_tax & ")," & Chr(34) & "Product N/A" & Chr(34) & ")"
                    ElseIf (countryColnName = "av17") Then      'Taiwan => 31
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        destinationCell.Offset(3, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPRange & "," & idxStr_freight & ")," & idxStr_tax & ")," & Chr(34) & "Product N/A" & Chr(34) & ")"
                    ElseIf (countryColnName = "aw17") Then       'Korea => 32
                        'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                        destinationCell.Offset(3, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPRange & "," & idxStr_freight & ")," & idxStr_tax & ")," & Chr(34) & "Product N/A" & Chr(34) & ")"
                    Else
                        destinationCell.Offset(3, destColn).Formula = "=IFERROR(PRODUCT(SUM(" & baseSPRange & "," & idxStr_freight & ")," & idxStr_tax & ")," & Chr(34) & "Product N/A" & Chr(34) & ")"
                    End If
                        destinationCell.Offset(3, destColn).NumberFormat = "0.00"
            
            End If
            
             'JP: Start of 207318 - Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
             'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
             tempCountryColnName = ColNames(countryColn - 2 + destColn) & "17"
             baseSPRange = ColNames(countryColn + destColn - 2) & (taxesRowNum - 3)
             If (tempCountryColnName = "ao17") Then ' Japan Local currencies
               ' baseSPAddedHKD = destinationCell.Offset(0, destColn - 2).Value
                'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                idxStr_QTRHKD = "=IFERROR(ROUNDDOWN(PRODUCT(SUM(" & baseSPRange & ","
                idxStr_freightHKD = "INDEX('APJ freights and duties'!$C$14:$AT$350,MATCH(" & chasisColnName & ",'APJ freights and duties'!$C$14:$C$350,0),"
                idxStr_dutyHKD = "MATCH(AO17,'APJ freights and duties'!$C$14:$Y$14,0))),"
                'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                idxStr_taxHKD = "VLOOKUP(" & chasisColnName & ",'APJ freights and duties'!$C$14:$AT$350,36,0)),0)," & Chr(34) & "Product N/A" & Chr(34) & ")"
                
                destinationCell.Offset(2, destColn - 2).Formula = idxStr_QTRHKD & idxStr_freightHKD & idxStr_dutyHKD & idxStr_taxHKD
                destinationCell.Offset(2, destColn - 2).NumberFormat = "0.00"
                
                 idxStr_freight = "INDEX('APJ freights and duties'!C14:AT350,MATCH(" & chasisColnName & ",'APJ freights and duties'!C14:C350,0),MATCH(AO17,'APJ freights and duties'!C14:Y14,0))"
                 'JP: 212779:Currency Matrix APJ Round mechanism for Base selling Price, With Freight and With Taxes lines
                 idxStr_tax = "HLOOKUP(AO17,'APJ freights and duties'!Z1:AT10,10,FALSE)"
                
                destinationCell.Offset(3, destColn - 2).Formula = "=IFERROR(ROUNDDOWN(PRODUCT(SUM(" & baseSPRange & "," & idxStr_freight & ")," & idxStr_tax & "),0)," & Chr(34) & "Product N/A" & Chr(34) & ")"
                destinationCell.Offset(3, destColn - 2).NumberFormat = "0.00"
                
             End If
              
             'JP: end of 207318 - Correct Duties calculation in the With Freight - copy formula for All USD except Japan USD and Japan Yen
        End If
 
        destColn = destColn + 1
        offsetToAPACDir = offsetToAPACDir + 1
       
 Loop

End Sub
Sub onChangeFreightRowVisibility()
    Dim rg As Range, frightRow As Range, taxRow As Range, freightVisibilitySelectRg As Range
    Set rg = Worksheets("Global Price").Range("A1:A2000")
    Set freightVisibilitySelectRg = Worksheets("Global Price").Range("J5")
    For Each cell In rg
        'If UCase(cell.Value) = "NO" Then
        'cell.EntireRow.Hidden = True
        
        If freightVisibilitySelectRg.Value = "Hide Freight/Taxes rows" And (UCase(cell.Value) = "WITH FREIGHT" Or UCase(cell.Value) = "WITH TAXES") Then
            cell.EntireRow.Hidden = True
        ElseIf freightVisibilitySelectRg.Value = "Show Freight/Taxes rows" And (UCase(cell.Value) = "WITH FREIGHT" Or UCase(cell.Value) = "WITH TAXES") Then
            cell.EntireRow.Hidden = False
        End If
    
Next

End Sub
'JP:158210:CR 157622: CM export- give user the possibility of hiding or unhiding the rows for freights and taxes
Sub onClickFreightRowVisibility()
    Dim freightVisible As String
    
    Dim rg As Range, frightRow As Range, taxRow As Range, freightVisibilitySelectRg As Range
    
    Set rg = Worksheets("Global Price").Range("A1:A8000")
   
    If isHiddenTax = True Then
        freightVisible = "Show Freight/Taxes rows"
    Else
        freightVisible = "Hide Freight/Taxes rows"
    End If
    
    
    For Each cell In rg
        'If UCase(cell.Value) = "NO" Then
        'cell.EntireRow.Hidden = True
        
        If freightVisible = "Hide Freight/Taxes rows" And (UCase(cell.Value) = "WITH FREIGHT" Or UCase(cell.Value) = "WITH TAXES") Then
            cell.EntireRow.Hidden = True
            isHiddenTax = True
        ElseIf freightVisible = "Show Freight/Taxes rows" And (UCase(cell.Value) = "WITH FREIGHT" Or UCase(cell.Value) = "WITH TAXES") Then
            cell.EntireRow.Hidden = False
            isHiddenTax = False
        End If
    
Next

End Sub




Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.Header_Loaded = True
    processReport
End Sub
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.ConfigLabelList_Loaded = True
    processReport
End Sub

Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.ConfigLines_Loaded = True
    processReport
End Sub
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.SKUList_Loaded = True
    processReport
End Sub
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.HedgeRate_Loaded = True
    processReport
End Sub
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.Uplift_Loaded = True
    processReport
End Sub

Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
If Target.Address = "$F$5" Then
    Call formatPricingEffective
End If
If Target.Address = "$J$5" Then
    Call onChangeFreightRowVisibility
End If
End Sub

Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Module1.HedgeRate_Populated = True
End Sub

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Workbook_AfterSave(ByVal Success As Boolean)
If Success = True Then
createHeader
End If

End Sub

Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)
If Range("A1") <> "CUSTOMER FRIENDLY" Then
intResponse = MsgBox(" Do you want to save this file as a ""Customer Friendly"" copy? ", vbYesNo + vbQuestion)
    If intResponse = vbYes Then
        If Range("F5") = "Current" Then
            Worksheets("Hedge").Activate
            [E:E].Delete
            Worksheets("Global Price").Activate
            Range("F5").Clear
            Range("F5") = "Current"
            Range("F5").Font.Color = vbWhite
            Range("F5").Font.Size = 1
        Else
            Range("F5").Clear
        End If
        
        Range("E5").Clear
        [E4:I4] = ""
        [G5:I5].Clear

        'Shalini: GOAL 3.1: Hide APJ freight and taxes while saving cutomer friendly copy
        Worksheets("APJ freights and duties").Visible = xlSheetVeryHidden
        'JP: Latam currencies added Amer, as per Veronique conversation below worksheets are hidden
        Worksheets("Brazil uplift").Visible = xlSheetVeryHidden
        Worksheets("Hedge").Visible = xlSheetVeryHidden
        'JP: 200012:Currency Matrix APJ  - Hedge Customer are different ffrom Treasury
        Worksheets("HEDGE BUSINESS APJ").Visible = xlSheetVeryHidden
           
        
        Range("A1") = "CUSTOMER FRIENDLY"
        MsgBox (" A Customer Friendly copy has successfully been created ")
    End If
        
         'Worksheets("APJ freights and duties").Visible = xlSheetVeryHidden
End If
End Sub

Private Sub Workbook_Open()

End Sub

' InQuest injected base64 decoded content
' kz(!

INQUEST-PP=macro
