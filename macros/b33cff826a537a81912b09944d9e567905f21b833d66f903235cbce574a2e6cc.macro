Attribute VB_Name = "Module1"

Sub RIYMac()
Attribute RIYMac.VB_ProcData.VB_Invoke_Func = " \n14"
'
' RIYMac Macro
'

    SolverOk SetCell:="$M$4", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$4", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$M$4", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$4", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Range("O4").Select
    SolverOk SetCell:="$O$4", MaxMinVal:=3, ValueOf:=0, ByChange:="$N$4", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$O$4", MaxMinVal:=3, ValueOf:=0, ByChange:="$N$4", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Sheets("Input").Select
    Range("F26").Select
    ActiveCell.FormulaR1C1 = "='EAC CALC AND OUTPUT'!R[-21]C[6]"
    Range("H26").Select
    ActiveCell.FormulaR1C1 = "='EAC CALC AND OUTPUT'!R[-21]C[6]"
    Range("H27").Select
    Sheets("EAC CALC AND OUTPUT").Select
    SolverOk SetCell:="$M$5", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$5", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$M$5", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$5", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Range("O5").Select
    SolverOk SetCell:="$O$5", MaxMinVal:=3, ValueOf:=0, ByChange:="$N$5", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$O$5", MaxMinVal:=3, ValueOf:=0, ByChange:="$N$5", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Sheets("Input").Select
    Range("F26").Select
    ActiveCell.FormulaR1C1 = "='EAC CALC AND OUTPUT'!R[-20]C[6]"
    Range("H26").Select
    ActiveCell.FormulaR1C1 = "='EAC CALC AND OUTPUT'!R[-20]C[6]"
    Range("H27").Select
    Sheets("EAC CALC AND OUTPUT").Select
    SolverOk SetCell:="$M$6", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$6", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$M$6", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$6", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Range("O6").Select
    SolverOk SetCell:="$O$6", MaxMinVal:=3, ValueOf:=0, ByChange:="$N$6", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$O$6", MaxMinVal:=3, ValueOf:=0, ByChange:="$N$6", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Sheets("Input").Select
    Range("F26").Select
    ActiveCell.FormulaR1C1 = "='EAC CALC AND OUTPUT'!R[-19]C[6]"
    Range("H26").Select
    ActiveCell.FormulaR1C1 = "='EAC CALC AND OUTPUT'!R[-19]C[6]"
    Range("H27").Select
    Sheets("EAC CALC AND OUTPUT").Select
    SolverOk SetCell:="$M$7", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$7", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverOk SetCell:="$M$7", MaxMinVal:=3, ValueOf:=0, ByChange:="$L$7", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    SolverSolve True
    Range("J19").Select
    Windows("EAC.Demonstation.xlsx").Activate
    ActiveWindow.SmallScroll Down:=3
    Windows("EAC.DEMO.xlsx").Activate
    Sheets("Input").Select
    ChDir "C:\Users\rhowarth\Documents\Asisa RIY"
    ActiveWorkbook.SaveAs Filename:= _
        "C:\Users\rhowarth\Documents\Asisa RIY\EAC.DEMO.xlsm", FileFormat:= _
        xlOpenXMLWorkbookMacroEnabled, CreateBackup:=False
    Windows("EAC.Demonstation.xlsx").Activate
    Range("F9").Select
    ActiveCell.FormulaR1C1 = "0%"
    Range("F9").Select
    Selection.AutoFill Destination:=Range("F9:F14"), Type:=xlFillDefault
    Range("F9:F14").Select
    Range("G15").Select
    ActiveWorkbook.Save
    Windows("EAC.DEMO.xlsm").Activate
    Sheets("EAC CALC AND OUTPUT").Select
    Range("H11").Select
    ActiveCell.FormulaR1C1 = "EAC"
    Range("I11").Select
    ActiveCell.FormulaR1C1 = "1"
    Range("J11").Select
    ActiveCell.FormulaR1C1 = "3"
    Range("K11").Select
    ActiveCell.FormulaR1C1 = "5"
    Range("L11").Select
    ActiveCell.FormulaR1C1 = "20"
    Range("H12").Select
    ActiveCell.FormulaR1C1 = "Product Costs"
    Range("I12").Select
    ActiveCell.FormulaR1C1 = "=R[-8]C[3]-6%"
    Range("J12").Select
    ActiveCell.FormulaR1C1 = "=R[-7]C[2]-6%"
    Range("K12").Select
    ActiveCell.FormulaR1C1 = "=-R[-6]C[1]-6%"
    Range("K12").Select
    ActiveCell.FormulaR1C1 = "=R[-6]C[1]-6%"
    Range("I12:L16").Select
    Selection.NumberFormat = "0.00%"
    Range("L12").Select
    ActiveCell.FormulaR1C1 = "=R[-5]C-6%"
    Range("H13").Select
    ActiveCell.FormulaR1C1 = "Advice Costs"
    Range("I13").Select
    ActiveCell.FormulaR1C1 = "=R[-9]C[5]-6%"
    Range("J13").Select
    ActiveCell.FormulaR1C1 = "=R[-8]C[4]-6%"
    Range("K13").Select
    ActiveCell.FormulaR1C1 = "=R[-7]C[3]-6%"
    Range("L13").Select
    ActiveCell.FormulaR1C1 = "=R[-6]C[2]-6%"
    Range("I12:L14").Select
    Selection.NumberFormat = "0.00%"
    Range("H14").Select
    ActiveCell.FormulaR1C1 = "TER"
    Range("I14").Select
    ActiveCell.FormulaR1C1 = "=Input!R[6]C[-5]"
    Range("I14").Select
    Selection.AutoFill Destination:=Range("I14:L14"), Type:=xlFillDefault
    Range("I14:L14").Select
    Range("H15").Select
    ActiveCell.FormulaR1C1 = "Total EAC"
    Range("I15").Select
    ActiveCell.FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
    Range("I15").Select
    Selection.AutoFill Destination:=Range("I15:L15"), Type:=xlFillDefault
    Range("I15:L15").Select
    Range("J14").Select
    ActiveCell.FormulaR1C1 = "=R[-9]C[4]-6%"
    Range("K14").Select
    ActiveCell.FormulaR1C1 = "=R[-8]C[3]-6%"
    Range("L14").Select
    ActiveCell.FormulaR1C1 = "=R[-7]C[2]-6%"
    Range("I14").Select
    ActiveCell.FormulaR1C1 = "=Input!R20C4"
    Range("I14").Select
    Selection.AutoFill Destination:=Range("I14:L14"), Type:=xlFillDefault
    Range("I14:L14").Select
    Range("H11:L15").Select
    Selection.Borders(xlDiagonalDown).LineStyle = xlNone
    Selection.Borders(xlDiagonalUp).LineStyle = xlNone
    With Selection.Borders(xlEdgeLeft)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeTop)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeBottom)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlEdgeRight)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideVertical)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    With Selection.Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .ColorIndex = 0
        .TintAndShade = 0
        .Weight = xlThin
    End With
    Range("I23").Select
    ActiveWorkbook.Save
    Columns("D:G").Select
    Selection.EntireColumn.Hidden = True
    Columns("H:H").Select
    Selection.Insert Shift:=xlToRight, CopyOrigin:=xlFormatFromLeftOrAbove
    Selection.ColumnWidth = 3.63
    Range("K19").Select
    Sheets("Input").Select
    ActiveWindow.SmallScroll Down:=9
    ActiveWorkbook.Save
    Windows("EAC.Demonstation.xlsx").Activate
    Range("F6").Select
    ActiveCell.FormulaR1C1 = "escalating at 6% per annum"
    Range("B27:D29").Select
    Selection.Font.Bold = False
    Range("H34").Select
    ActiveWorkbook.Save
    Application.Dialogs(xlDialogSendMail).Show
    Columns("E:E").ColumnWidth = 16
    Windows("EAC.DEMO.xlsm").Activate
    ActiveWindow.ScrollRow = 9
    ActiveWindow.ScrollRow = 8
    ActiveWindow.ScrollRow = 7
    ActiveWindow.ScrollRow = 5
    ActiveWindow.ScrollRow = 4
    ActiveWindow.ScrollRow = 2
    ActiveWindow.ScrollRow = 1
    ActiveWorkbook.Save
    Range("D9").Select
    ActiveCell.FormulaR1C1 = "500000"
    Range("D10").Select
    ActiveCell.FormulaR1C1 = "6%"
    Range("D9").Select
    ActiveCell.FormulaR1C1 = "20000"
    Range("J7").Select
    ActiveCell.FormulaR1C1 = "1%"
    Range("K7").Select
    ActiveCell.FormulaR1C1 = "1%"
    Range("K11").Select
    Sheets("EAC CALC AND OUTPUT").Select
    Range("M27").Select
    Application.Run "EAC.DEMO.xlsm!RIYMac"
   
    Range("P14").Select
    ActiveWorkbook.Save
    Range("S12").Select
    Application.Run "EAC.DEMO.xlsm!RIYMac"
    ActiveWorkbook.Save
    Sheets("Input").Select
    Application.Dialogs(xlDialogSendMail).Show
    ActiveWorkbook.RunAutoMacros Which:=xlAutoClose
    ActiveWindow.SmallScroll Down:=18
    ActiveWindow.Close
    ActiveWindow.Close
    Windows("ASISA.FOF.June2013.xlsx").Activate
    Workbooks.Add
    Range("B2").Select
    ActiveSheet.Paste
    Range("K14").Select
    ChDir "C:\Users\rhowarth\Documents\Bus Intel"
    Sheets("Sheet2").Select
    Range("A3").Select
    Columns("A:A").ColumnWidth = 19
    Range("A3").Select
    ActiveCell.FormulaR1C1 = "Value"
    Range("B3").Select
    Sheets("Sheet2").Select
    Range("A4").Select
    ActiveCell.FormulaR1C1 = "1000000000"
    Range("A5").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C+1000000"
    Range("A4").Select
    ActiveCell.FormulaR1C1 = "1000000"
    Range("A5").Select
    Selection.AutoFill Destination:=Range("A5:A188"), Type:=xlFillDefault
    Range("A5:A188").Select
    Columns("A:A").Select
    Range("A160").Activate
    Selection.Style = "Comma"
    Selection.NumberFormat = "_ * #,##0.0_ ;_ * -#,##0.0_ ;_ * ""-""??_ ;_ @_ "
    Selection.NumberFormat = "_ * #,##0_ ;_ * -#,##0_ ;_ * ""-""??_ ;_ @_ "
    Range("A188").Select
    Selection.AutoFill Destination:=Range("A188:A332"), Type:=xlFillDefault
    Range("A188:A332").Select
    Selection.AutoFill Destination:=Range("A188:A436"), Type:=xlFillDefault
    Range("A188:A436").Select
    Selection.AutoFill Destination:=Range("A188:A603"), Type:=xlFillDefault
    Range("A188:A603").Select
    ActiveWindow.ScrollRow = 572
    ActiveWindow.ScrollRow = 571
    ActiveWindow.ScrollRow = 566
    ActiveWindow.ScrollRow = 563
    ActiveWindow.ScrollRow = 558
    ActiveWindow.ScrollRow = 551
    ActiveWindow.ScrollRow = 537
    ActiveWindow.ScrollRow = 526
    ActiveWindow.ScrollRow = 512
    ActiveWindow.ScrollRow = 497
    ActiveWindow.ScrollRow = 480
    ActiveWindow.ScrollRow = 459
    ActiveWindow.ScrollRow = 431
    ActiveWindow.ScrollRow = 404
    ActiveWindow.ScrollRow = 375
    ActiveWindow.ScrollRow = 341
    ActiveWindow.ScrollRow = 314
    ActiveWindow.ScrollRow = 282
    ActiveWindow.ScrollRow = 248
    ActiveWindow.ScrollRow = 216
    ActiveWindow.ScrollRow = 189
    ActiveWindow.ScrollRow = 155
    ActiveWindow.ScrollRow = 129
    ActiveWindow.ScrollRow = 102
    ActiveWindow.ScrollRow = 74
    ActiveWindow.ScrollRow = 58
    ActiveWindow.ScrollRow = 41
    ActiveWindow.ScrollRow = 27
    ActiveWindow.ScrollRow = 11
    ActiveWindow.ScrollRow = 1
    ActiveWindow.SmallScroll Down:=84
    Sheets("Sheet2").Select
    ActiveWindow.ScrollRow = 86
    ActiveWindow.ScrollRow = 89
    ActiveWindow.ScrollRow = 92
    ActiveWindow.ScrollRow = 95
    ActiveWindow.ScrollRow = 97
    ActiveWindow.ScrollRow = 102
    ActiveWindow.ScrollRow = 108
    ActiveWindow.ScrollRow = 111
    ActiveWindow.ScrollRow = 116
    ActiveWindow.ScrollRow = 122
    ActiveWindow.ScrollRow = 125
    ActiveWindow.ScrollRow = 128
    ActiveWindow.ScrollRow = 133
    ActiveWindow.ScrollRow = 140
    ActiveWindow.ScrollRow = 154
    ActiveWindow.ScrollRow = 165
    ActiveWindow.ScrollRow = 175
    ActiveWindow.ScrollRow = 186
    ActiveWindow.ScrollRow = 194
    ActiveWindow.ScrollRow = 202
    ActiveWindow.ScrollRow = 208
    ActiveWindow.ScrollRow = 212
    ActiveWindow.ScrollRow = 218
    ActiveWindow.ScrollRow = 221
    ActiveWindow.ScrollRow = 227
    ActiveWindow.ScrollRow = 230
    ActiveWindow.ScrollRow = 231
    ActiveWindow.ScrollRow = 232
    ActiveWindow.ScrollRow = 233
    ActiveWindow.ScrollRow = 234
    ActiveWindow.ScrollRow = 235
    ActiveWindow.ScrollRow = 236
    ActiveWindow.ScrollRow = 237
    ActiveWindow.ScrollRow = 238
    ActiveWindow.ScrollRow = 241
    ActiveWindow.ScrollRow = 242
    ActiveWindow.ScrollRow = 243
    ActiveWindow.ScrollRow = 244
    ActiveWindow.ScrollRow = 245
    ActiveWindow.ScrollRow = 246
    ActiveWindow.ScrollRow = 247
    ActiveWindow.ScrollRow = 249
    ActiveWindow.ScrollRow = 250
    ActiveWindow.ScrollRow = 251
    ActiveWindow.ScrollRow = 252
    ActiveWindow.ScrollRow = 253
    ActiveWindow.ScrollRow = 254
    ActiveWindow.ScrollRow = 257
    ActiveWindow.ScrollRow = 260
    ActiveWindow.ScrollRow = 265
    ActiveWindow.ScrollRow = 268
    ActiveWindow.ScrollRow = 271
    ActiveWindow.ScrollRow = 274
    ActiveWindow.ScrollRow = 278
    ActiveWindow.ScrollRow = 281
    ActiveWindow.ScrollRow = 286
    ActiveWindow.ScrollRow = 288
    ActiveWindow.ScrollRow = 291
    ActiveWindow.ScrollRow = 294
    ActiveWindow.ScrollRow = 299
    ActiveWindow.ScrollRow = 302
    ActiveWindow.ScrollRow = 308
    ActiveWindow.ScrollRow = 311
    ActiveWindow.ScrollRow = 317
    ActiveWindow.ScrollRow = 322
    ActiveWindow.ScrollRow = 327
    ActiveWindow.ScrollRow = 332
    ActiveWindow.ScrollRow = 338
    ActiveWindow.ScrollRow = 344
    ActiveWindow.ScrollRow = 349
    ActiveWindow.ScrollRow = 352
    ActiveWindow.ScrollRow = 353
    ActiveWindow.ScrollRow = 355
    ActiveWindow.ScrollRow = 356
    ActiveWindow.ScrollRow = 357
    ActiveWindow.ScrollRow = 358
    ActiveWindow.ScrollRow = 359
    ActiveWindow.ScrollRow = 360
    ActiveWindow.ScrollRow = 362
    ActiveWindow.ScrollRow = 365
    ActiveWindow.ScrollRow = 366
    ActiveWindow.ScrollRow = 367
    ActiveWindow.ScrollRow = 370
    ActiveWindow.ScrollRow = 373
    ActiveWindow.ScrollRow = 376
    ActiveWindow.ScrollRow = 381
    ActiveWindow.ScrollRow = 384
    ActiveWindow.ScrollRow = 387
    ActiveWindow.ScrollRow = 390
    ActiveWindow.ScrollRow = 391
    ActiveWindow.ScrollRow = 392
    ActiveWindow.ScrollRow = 393
    ActiveWindow.ScrollRow = 395
    ActiveWindow.ScrollRow = 399
    ActiveWindow.ScrollRow = 403
    ActiveWindow.ScrollRow = 406
    ActiveWindow.ScrollRow = 409
    ActiveWindow.ScrollRow = 412
    ActiveWindow.ScrollRow = 413
    ActiveWindow.ScrollRow = 415
    ActiveWindow.ScrollRow = 418
    ActiveWindow.ScrollRow = 419
    ActiveWindow.ScrollRow = 420
    ActiveWindow.ScrollRow = 421
    ActiveWindow.ScrollRow = 424
    ActiveWindow.ScrollRow = 429
    ActiveWindow.ScrollRow = 433
    ActiveWindow.ScrollRow = 436
    ActiveWindow.ScrollRow = 440
    ActiveWindow.ScrollRow = 446
    ActiveWindow.ScrollRow = 449
    ActiveWindow.ScrollRow = 455
    ActiveWindow.ScrollRow = 458
    ActiveWindow.ScrollRow = 461
    ActiveWindow.ScrollRow = 462
    ActiveWindow.ScrollRow = 464
    ActiveWindow.ScrollRow = 467
    ActiveWindow.ScrollRow = 470
    ActiveWindow.ScrollRow = 474
    ActiveWindow.ScrollRow = 476
    ActiveWindow.ScrollRow = 479
    ActiveWindow.ScrollRow = 480
    ActiveWindow.ScrollRow = 482
    ActiveWindow.ScrollRow = 485
    ActiveWindow.ScrollRow = 486
    ActiveWindow.ScrollRow = 487
    ActiveWindow.ScrollRow = 490
    ActiveWindow.ScrollRow = 493
    ActiveWindow.ScrollRow = 494
    ActiveWindow.ScrollRow = 496
    ActiveWindow.ScrollRow = 497
    ActiveWindow.ScrollRow = 498
    ActiveWindow.ScrollRow = 499
    ActiveWindow.ScrollRow = 502
    ActiveWindow.ScrollRow = 503
    ActiveWindow.ScrollRow = 504
    ActiveWindow.ScrollRow = 507
    ActiveWindow.ScrollRow = 508
    ActiveWindow.ScrollRow = 509
    ActiveWindow.ScrollRow = 511
    ActiveWindow.ScrollRow = 512
    ActiveWindow.ScrollRow = 513
    ActiveWindow.ScrollRow = 514
    ActiveWindow.ScrollRow = 515
    ActiveWindow.ScrollRow = 516
    ActiveWindow.ScrollRow = 517
    ActiveWindow.ScrollRow = 518
    ActiveWindow.ScrollRow = 519
    ActiveWindow.ScrollRow = 520
    ActiveWindow.ScrollRow = 521
    ActiveWindow.ScrollRow = 522
    ActiveWindow.ScrollRow = 523
    ActiveWindow.ScrollRow = 524
    ActiveWindow.ScrollRow = 525
    ActiveWindow.ScrollRow = 526
    ActiveWindow.ScrollRow = 529
    ActiveWindow.ScrollRow = 530
    ActiveWindow.ScrollRow = 531
    ActiveWindow.ScrollRow = 532
    ActiveWindow.ScrollRow = 533
    ActiveWindow.ScrollRow = 535
    ActiveWindow.ScrollRow = 538
    ActiveWindow.ScrollRow = 539
    ActiveWindow.ScrollRow = 542
    ActiveWindow.ScrollRow = 543
    ActiveWindow.ScrollRow = 544
    ActiveWindow.ScrollRow = 545
    ActiveWindow.ScrollRow = 546
    ActiveWindow.ScrollRow = 547
    ActiveWindow.ScrollRow = 548
    ActiveWindow.ScrollRow = 549
    ActiveWindow.ScrollRow = 550
    ActiveWindow.ScrollRow = 551
    ActiveWindow.ScrollRow = 552
    ActiveWindow.ScrollRow = 553
    ActiveWindow.ScrollRow = 554
    ActiveWindow.ScrollRow = 555
    ActiveWindow.ScrollRow = 556
    ActiveWindow.ScrollRow = 557
    ActiveWindow.ScrollRow = 558
    ActiveWindow.ScrollRow = 559
    ActiveWindow.ScrollRow = 562
    ActiveWindow.ScrollRow = 567
    ActiveWindow.ScrollRow = 571
    ActiveWindow.SmallScroll Down:=22
    Range("A603").Select
    Selection.AutoFill Destination:=Range("A603:A1149"), Type:=xlFillDefault
    Range("A603:A1149").Select
    Range("A1149").Select
    Selection.AutoFill Destination:=Range("A1149:A2498"), Type:=xlFillDefault
    Range("A1149:A2498").Select
    ActiveWindow.ScrollRow = 2463
    ActiveWindow.ScrollRow = 2459
    ActiveWindow.ScrollRow = 2446
    ActiveWindow.ScrollRow = 2422
    ActiveWindow.ScrollRow = 2389
    ActiveWindow.ScrollRow = 2332
    ActiveWindow.ScrollRow = 2274
    ActiveWindow.ScrollRow = 2200
    ActiveWindow.ScrollRow = 2131
    ActiveWindow.ScrollRow = 2036
    ActiveWindow.ScrollRow = 1946
    ActiveWindow.ScrollRow = 1852
    ActiveWindow.ScrollRow = 1761
    ActiveWindow.ScrollRow = 1692
    ActiveWindow.ScrollRow = 1601
    ActiveWindow.ScrollRow = 1531
    ActiveWindow.ScrollRow = 1462
    ActiveWindow.ScrollRow = 1367
    ActiveWindow.ScrollRow = 1293
    ActiveWindow.ScrollRow = 1224
    ActiveWindow.ScrollRow = 1142
    ActiveWindow.ScrollRow = 1051
    ActiveWindow.ScrollRow = 982
    ActiveWindow.ScrollRow = 912
    ActiveWindow.ScrollRow = 854
    ActiveWindow.ScrollRow = 801
    ActiveWindow.ScrollRow = 731
    ActiveWindow.ScrollRow = 686
    ActiveWindow.ScrollRow = 616
    ActiveWindow.ScrollRow = 563
    ActiveWindow.ScrollRow = 518
    ActiveWindow.ScrollRow = 473
    ActiveWindow.ScrollRow = 428
    ActiveWindow.ScrollRow = 383
    ActiveWindow.ScrollRow = 358
    ActiveWindow.ScrollRow = 325
    ActiveWindow.ScrollRow = 301
    ActiveWindow.ScrollRow = 288
    ActiveWindow.ScrollRow = 276
    ActiveWindow.ScrollRow = 272
    ActiveWindow.ScrollRow = 268
    ActiveWindow.ScrollRow = 264
    ActiveWindow.ScrollRow = 259
    ActiveWindow.ScrollRow = 239
    ActiveWindow.ScrollRow = 227
    ActiveWindow.ScrollRow = 202
    ActiveWindow.ScrollRow = 190
    ActiveWindow.ScrollRow = 169
    ActiveWindow.ScrollRow = 157
    ActiveWindow.ScrollRow = 136
    ActiveWindow.ScrollRow = 124
    ActiveWindow.ScrollRow = 112
    ActiveWindow.ScrollRow = 99
    ActiveWindow.ScrollRow = 87
    ActiveWindow.ScrollRow = 83
    ActiveWindow.ScrollRow = 71
    ActiveWindow.ScrollRow = 58
    ActiveWindow.ScrollRow = 54
    ActiveWindow.ScrollRow = 46
    ActiveWindow.ScrollRow = 34
    ActiveWindow.ScrollRow = 9
    ActiveWindow.ScrollRow = 1
    Range("A4").Select
    ActiveCell.FormulaR1C1 = "5000000"
    Range("B3").Select
    Sheets("Sheet1").Select
    ActiveSheet.Shapes.Range(Array("Picture 1")).Select
    Selection.Copy
    Sheets("Sheet2").Select
    Range("N2").Select
    ActiveSheet.Paste
    Range("E4").Select
    ActiveCell.FormulaR1C1 = "50000000"
    Range("F4").Select
    ActiveCell.FormulaR1C1 = "0.59%"
    Range("E5").Select
    ActiveCell.FormulaR1C1 = "50000000"
    Range("F5").Select
    ActiveCell.FormulaR1C1 = "0.61%"
    Range("E6").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C+50000000"
    Range("E6").Select
    Selection.AutoFill Destination:=Range("E6:E13"), Type:=xlFillDefault
    Range("E6:E13").Select
    Selection.AutoFill Destination:=Range("E6:E15"), Type:=xlFillDefault
    Range("E6:E15").Select
    Range("E5").Select
    Selection.AutoFill Destination:=Range("E5:E9"), Type:=xlFillDefault
    Range("E5:E9").Select
    Range("E10:E16").Select
    Selection.ClearContents
    Range("E5").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C+50000000"
    Range("E5").Select
    Selection.AutoFill Destination:=Range("E5:E9"), Type:=xlFillDefault
    Range("E5:E9").Select
    Range("E9").Select
    ActiveCell.FormulaR1C1 = "=R[-1]C+250000000"
    Range("E9").Select
    Windows("EAC.DEMO.xlsm").Activate
    Sheets("Input").Select
    Range("F26").Select
    Windows("ASISA.FOF.June2013.xlsx").Activate
    Windows("EAC.DEMO.xlsm").Activate
    Range("F26").Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .Color = 65535
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    Range("H26").Select
    With Selection.Interior
        .Pattern = xlSolid
        .PatternColorIndex = xlAutomatic
        .Color = 65535
        .TintAndShade = 0
        .PatternTintAndShade = 0
    End With
    ActiveWorkbook.Save
    Application.Dialogs(xlDialogSendMail).Show
    Sheets("EAC CALC AND OUTPUT").Select
    SolverOk SetCell:="$P$7", MaxMinVal:=3, ValueOf:=0, ByChange:="$O$7", Engine:=1 _
        , EngineDesc:="GRG Nonlinear"
    Windows("ASISA.FOF.June2013.xlsx").Activate
    ActiveWindow.Close
    Sheets("Equity Info 1").Select
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    Sheets("EquityGraphic").Select
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    ActiveWindow.ScrollWorkbookTabs Sheets:=1
    Sheets("Calendar Years Performance 2").Select
    ActiveWindow.ScrollColumn = 3
    ActiveWindow.ScrollColumn = 4
    ActiveWindow.ScrollColumn = 7
    ActiveWindow.ScrollColumn = 8
    ActiveWindow.ScrollColumn = 9
    ActiveWindow.ScrollColumn = 10
    ActiveWindow.ScrollColumn = 8
    ActiveWindow.ScrollColumn = 5
    ActiveWindow.ScrollColumn = 3
    ActiveWindow.ScrollColumn = 1
    Sheets("Investable Survey Stats (Act)").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 1
    Sheets("Non Invest Survey Stats (Perf)").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    Sheets("Volatility").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 4
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    Sheets("Equity Info 2").Select
    Range("I11").Select
    Sheets("Equity Info 2").Select
    ActiveWindow.SmallScroll ToRight:=1
    ActiveWindow.ScrollColumn = 1
    ChDir "C:\Users\rhowarth\Documents\Ins Data Compile"
    ActiveWorkbook.SaveAs Filename:= _
        "C:\Users\rhowarth\Documents\Ins Data Compile\Copy of Equity Survey June 2013 - Final.xls" _
        , FileFormat:=xlExcel8, password:="", WriteResPassword:="", _
        ReadOnlyRecommended:=False, CreateBackup:=False
    Sheets("Performance Only 2").Select
    ActiveWindow.ScrollRow = 15
    ActiveWindow.ScrollRow = 14
    ActiveWindow.ScrollRow = 13
    ActiveWindow.ScrollRow = 12
    ActiveWindow.ScrollRow = 11
    ActiveWindow.ScrollRow = 9
    ActiveWindow.ScrollRow = 8
    ActiveWindow.ScrollRow = 7
    ActiveWindow.ScrollRow = 6
    ActiveWindow.ScrollRow = 4
    ActiveWindow.ScrollRow = 3
    ActiveWindow.ScrollRow = 2
    ActiveWindow.ScrollRow = 1
    Sheets("Performance Only 1").Select
    ActiveWindow.ScrollRow = 18
    ActiveWindow.ScrollRow = 17
    ActiveWindow.ScrollRow = 16
    ActiveWindow.ScrollRow = 14
    ActiveWindow.ScrollRow = 13
    ActiveWindow.ScrollRow = 12
    ActiveWindow.ScrollRow = 11
    ActiveWindow.ScrollRow = 10
    ActiveWindow.ScrollRow = 9
    ActiveWindow.ScrollRow = 8
    ActiveWindow.ScrollRow = 7
    ActiveWindow.ScrollRow = 6
    ActiveWindow.ScrollRow = 5
    ActiveWindow.ScrollRow = 4
    ActiveWindow.ScrollRow = 3
    ActiveWindow.ScrollRow = 2
    ActiveWindow.ScrollRow = 1
    Sheets("Performance Only 2").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 5
    ActiveWindow.ScrollColumn = 6
    ActiveWindow.ScrollColumn = 9
    ActiveWindow.ScrollColumn = 10
    ActiveWindow.ScrollColumn = 11
    ActiveWindow.ScrollColumn = 8
    ActiveWindow.ScrollColumn = 3
    ActiveWindow.ScrollColumn = 1
    Sheets("Calendar Years Performance").Select
    ActiveWindow.SmallScroll ToRight:=3
    Sheets("Sheet1").Select
    ActiveWindow.ScrollWorkbookTabs Sheets:=-1
    ActiveWindow.ScrollWorkbookTabs Sheets:=-9
    Sheets("Performance Only 1").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 4
    ActiveWindow.ScrollColumn = 5
    ActiveWindow.ScrollColumn = 4
    ActiveWindow.ScrollColumn = 3
    ActiveWindow.ScrollColumn = 1
    ActiveWindow.SmallScroll Down:=-15
    Windows("Copy of Equity Survey June 2013 - Final.xls").Activate
    ActiveWindow.ScrollRow = 2
    ActiveWindow.ScrollRow = 3
    ActiveWindow.ScrollRow = 4
    ActiveWindow.ScrollRow = 5
    ActiveWindow.ScrollRow = 6
    ActiveWindow.ScrollRow = 7
    ActiveWindow.ScrollRow = 8
    ActiveWindow.ScrollRow = 9
    ActiveWindow.ScrollRow = 10
    ActiveWindow.ScrollRow = 11
    ActiveWindow.ScrollRow = 12
    ActiveWindow.ScrollRow = 13
    ActiveWindow.ScrollRow = 14
    ActiveWindow.ScrollRow = 15
    ActiveWindow.ScrollRow = 14
    ActiveWindow.ScrollRow = 13
    ActiveWindow.ScrollRow = 10
    ActiveWindow.ScrollRow = 9
    ActiveWindow.ScrollRow = 7
    ActiveWindow.ScrollRow = 6
    ActiveWindow.ScrollRow = 5
    ActiveWindow.ScrollRow = 4
    ActiveWindow.ScrollRow = 3
    ActiveWindow.ScrollRow = 2
    ActiveWindow.ScrollRow = 1
    Sheets("Equity Info 1").Select
    Windows("Equity Survey July 2012- Final.xls").Activate
    Sheets("Performance Only 2").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 5
    ActiveWindow.ScrollColumn = 6
    ActiveWindow.ScrollColumn = 8
    ActiveWindow.ScrollColumn = 10
    ActiveWindow.ScrollColumn = 11
    ActiveWindow.ScrollColumn = 9
    ActiveWindow.ScrollColumn = 5
    ActiveWindow.ScrollColumn = 1
    Sheets("Performance Only 1").Select
    ActiveWindow.ScrollColumn = 2
    ActiveWindow.ScrollColumn = 5
    ActiveWindow.ScrollColumn = 3
    ActiveWindow.ScrollColumn = 1
    Range("D23").Select
    ChDir "C:\Users\rhowarth\Documents"
    ActiveWindow.SmallScroll Down:=-6
    ActiveWindow.Close
    Windows("EAC.DEMO.xlsm").Activate
    Range("N20").Select
    ActiveWorkbook.Save
End Sub
Attribute VB_Name = "Module2"
Dim wsin As Worksheet

Sub SelectFundsByProduct()
    Dim prdct As String
    Set wsdi = ThisWorkbook.wsdi
    prdct = wsdi.Range("H13").Value
    wsdi.Columns("M:P").Hidden = True
    wsdi.Shapes("Group 9").Visible = False          'hide retirement compliance tables
    wsdi.Shapes("Group 10").Visible = False         'hide preservation compliance table
    wsdi.Shapes("Group Withdr").Visible = False     'show withdrawal options
    wsdi.Shapes("Group RecCont").Visible = False    'show recurring contibution options
    wsdi.Range("E16:E17,E20").Validation.Delete         'delete data validation for recurring contribution amount, and withdrawal
    wsdi.Range("E16, J16:J20, J24:J28, J32:J36, E16, E17, E19, E20, E22 ").Value = 0   'clear allocations
    wsdi.Range("L2:L46").Borders(xlEdgeRight).LineStyle = xlContinuous
    wsdi.Shapes("Rectangle 4").Visible = True       'hide living annuity  selected income and tax rate options
    Worksheets("Input").Range("B6:I15").Value = ""      'blank all relevant cells at destination to make sure nothing is left over from previous calculations
    wsdi.Range("E21").Locked = False                   'unlock withdrawal frequency cell (used for living annuities only)
    
    Select Case prdct
        Case Is = "Retirement"
            wsdi.Range("E16").Value = Worksheets("Lists").Range("I2")   'set initial minimum value
            ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
            With wsdi.Range("E16").Validation
                  .Delete
                  .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                  Operator:=xlGreaterEqual, Formula1:=Worksheets("Lists").Range("I2").Value
                  .IgnoreBlank = False
                  .InputTitle = ""
                  .ErrorTitle = ""
                  .InputMessage = ""
                  .ErrorMessage = "Minimum lumpsum amount must be equal to or larger than " & Worksheets("Lists").Range("I2").Value
                  .ShowInput = True
                  .ShowError = True
              End With
              ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
              wsdi.Range("L2:L46").Borders(xlEdgeRight).LineStyle = xlNone
              wsdi.Columns("M:P").Hidden = False
              wsdi.Columns("M:Q").Hidden = False
              wsdi.Shapes("Group 9").Visible = True         'show compliance tables for retirement lump sum and recurring contribution
              wsdi.Shapes("Group Withdr").Visible = True        'hide withdrawal options for retirement
              MakeList (prdct)
        Case Is = "Preservation"
            wsdi.Range("E16").Value = Worksheets("Lists").Range("I9")   'set initial minimum value
            ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
            With wsdi.Range("E16").Validation
                 .Delete
                 .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                 Operator:=xlGreaterEqual, Formula1:=Worksheets("Lists").Range("I9").Value
                 .IgnoreBlank = False
                 .InputTitle = ""
                 .ErrorTitle = ""
                 .InputMessage = ""
                 .ErrorMessage = "Minimum lumpsum amount must be equal to or larger than " & Worksheets("Lists").Range("I9").Value
                 .ShowInput = True
                 .ShowError = True
             End With
             ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
             wsdi.Range("L2:L46").Borders(xlEdgeRight).LineStyle = xlNone
             wsdi.Columns("M:P").Hidden = False
             wsdi.Columns("M:Q").Hidden = False
             wsdi.Shapes("Group 10").Visible = True        'show compliance table for preservation lump sum
             wsdi.Shapes("Group RecCont").Visible = True        'hide withdrawal options for preservation
             wsdi.Shapes("Group Withdr").Visible = True        'hide withdrawal options for preservation
             MakeList (prdct)
        Case Is = "UnitTrust"
            wsdi.Range("E16").Value = Worksheets("Lists").Range("I7")   'set initial minimum value
            ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
            With wsdi.Range("E16").Validation
                 .Delete
                 .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                 Operator:=xlGreaterEqual, Formula1:=Worksheets("Lists").Range("I7").Value
                 .IgnoreBlank = False
                 .InputTitle = ""
                 .ErrorTitle = ""
                 .InputMessage = ""
                 .ErrorMessage = "Minimum lumpsum amount must be equal to or larger than " & Worksheets("Lists").Range("I7").Value
                 .ShowInput = True
                 .ShowError = True
             End With
             ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
             wsdi.Columns("M:Q").Hidden = True
             MakeList (prdct)
        Case Is = "TaxFree"
            Call SetupTaxFreeValidations("")
            wsdi.Columns("M:Q").Hidden = True
            wsdi.Shapes("Group Withdr").Visible = True        'hide withdrawal options for tax free
            MakeList (prdct)
        Case Is = "LivingAnnuity"
            Select Case wsdi.Range("D13")
                Case Is = Worksheets("Lists").Range("C3")
                    wsdi.Range("E21").Value = "Monthly"
                Case Is = Worksheets("Lists").Range("C4")
                    wsdi.Range("E21").Value = "Quarterly"
                Case Is = Worksheets("Lists").Range("C5")
                    wsdi.Range("E21").Value = "Biannually"
                Case Is = Worksheets("Lists").Range("C6")
                    wsdi.Range("E21").Value = "Annually"
            End Select
            wsdi.Range("E21").Locked = True                   'lock withdrawal frequency cell
            wsdi.Range("E16").Value = Worksheets("Lists").Range("I3")   'set initial minimum value for lump sum
            wsdi.Range("E20").Value = Worksheets("Lists").Range("I3").Value * 0.025  'set initial minimum value for withdrawal after product change
            ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
            With wsdi.Range("E16").Validation
                 .Delete
                 .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                 Operator:=xlGreaterEqual, Formula1:=Worksheets("Lists").Range("I3").Value
                 .IgnoreBlank = False
                 .InputTitle = ""
                 .ErrorTitle = ""
                 .InputMessage = ""
                 .ErrorMessage = "Minimum lumpsum amount must be equal to or larger than " & Worksheets("Lists").Range("I3").Value
                 .ShowInput = True
                 .ShowError = True
             End With
             ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
             wsdi.Shapes("Rectangle 4").Visible = False
             wsdi.Shapes("Group RecCont").Visible = True    'show recurring contibution options
             wsdi.Columns("M:Q").Hidden = True
             MakeList (prdct)
    End Select
End Sub



Sub MakeList(product As String) '"product" is the name of the sheet! Do not modify sheet names
    Dim LastRow As String
    Set wsdi = ThisWorkbook.wsdi
    
    'find last row used in product
    With Worksheets(product)
        LastRow = .Cells(.Rows.Count, "C").End(xlUp).Row
    End With

    'create list for a specific product in selected fund
    product = "=" & product & "!$C$2:$C$" & LastRow    'format string for argument to list creator
    wsdi.Range("$H$16:$H$20, $H$24:$H$28").Value = "Select Fund"
    ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
    With wsdi.Range("$H$16:$H$20, $H$24:$H$28").Validation
        .Delete
        .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, _
        Operator:=xlBetween, Formula1:=product
        .IgnoreBlank = False
        .InCellDropdown = True
        .InputTitle = ""
        .ErrorTitle = ""
        .InputMessage = ""
        .ErrorMessage = ""
        .ShowInput = True
        .ShowError = True
    End With
    ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
End Sub



Sub MakeWithdrawalList()
    Dim fundsArray As String
    Dim fundStr As String       'temporary string to read selected funds
    Set wsdi = ThisWorkbook.wsdi
    
    'get funds selected in lumpsum section
    fundsArray = "Select Fund"      'initialise list values
    For si = 16 To 20               'number of rows to scan in column "H"
        fundStr = wsdi.Range("H" & si)
        If fundStr <> "Select Fund" Then
            fundsArray = fundsArray & "," & fundStr
        End If
    Next si
    
    ' create list for withdrawals based on funds by lumpsums
    wsdi.Range("$H$32:$H$36").Value = "Select Fund"
    ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
    With wsdi.Range("$H$32:$H$36").Validation
        .Delete
        .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, _
        Operator:=xlBetween, Formula1:=fundsArray
        .IgnoreBlank = True
        .InCellDropdown = True
        .InputTitle = ""
        .ErrorTitle = ""
        .InputMessage = ""
        .ErrorMessage = ""
        .ShowInput = True
        .ShowError = True
    End With
    ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
End Sub



Sub CopyLumpsumInfoToInput()
    Dim counter As Integer
    Set wsdi = ThisWorkbook.wsdi
    Set wsin = ThisWorkbook.Worksheets("Input")
    Worksheets("Input").Range("B6:I15, R6:R15").Value = ""      'blank all relevant cells at destination to make sure nothing is left over from previous calculations
    
    'wsin.Range("R4").Value = wsdi.Range("E32").Value / 100      'copy ongoing fee
    'wsin.Range("O6").Value = (wsdi.Range("E27").Value + _
                               wsdi.Range("E28").Value) / 100    'copy sum of inital commission rates for lumpsum
    
    counter = 6
    For i = 16 To 20
        If wsdi.Range("H" & i) <> "Select Fund" Then
            wsin.Range("B" & counter).Value = wsdi.Range("H" & i)    'copy fund name
            wsin.Range("D" & counter).Value = wsdi.Range("K" & i)    'copy amount
            'wsin.Range("O" & counter).Value = (wsdi.Range("E27").Value + _
                                               wsdi.Range("E28").Value) / 100    'copy sum of inital commission rates for lumpsum
            wsin.Range("R" & counter).Value = wsdi.Range("E32").Value / 100    'copy ongoing adviser fees
            counter = counter + 1
        End If
    Next i
End Sub



Sub CopyRecurrContInfoToInput()
    'retrieve selected recurring contribution funds
    Dim RecContFunds(1 To 5) As String
    Dim FundFoundAtRow(1 To 5) As Integer
    Dim f As String
    Dim counter As Integer
    Dim RCfInt As Integer
    Dim RWfInt As Integer
    Set wsdi = ThisWorkbook.wsdi
    Set wsin = ThisWorkbook.Worksheets("Input")
    
    Select Case wsdi.Range("E18").Value
        Case Is = "Monthly"
            RCfInt = 12
        Case Is = "Quarterly"
            RCfInt = 4
        Case Is = "Biannually"
            RCfInt = 2
        Case Is = "Annually"
            RCfInt = 1
    End Select
    
    Select Case wsdi.Range("E21").Value
        Case Is = "Monthly"
            RWfInt = 12
        Case Is = "Quarterly"
            RWfInt = 4
        Case Is = "Biannually"
            RWfInt = 2
        Case Is = "Annually"
            RWfInt = 1
    End Select
    
    counter = 0     'number of recurring contribution funds
    For i = 24 To 28
        f = wsdi.Range("H" & i).Value
        If f <> "Select Fund" Then
            counter = counter + 1
            RecContFunds(counter) = f
            FundFoundAtRow(counter) = i
        End If
    Next i
    
    If counter > 0 Then     'there is at least one fund selected
        wsin.Range("B27").Value = wsdi.Range("E18").Value    'copy contribution frequency
        Dim LastRow As Integer
        LastRow = 6     'initialise to minimum possible, as if there were no lumpsum funds
        For i = 6 To 10     'a maximum of 5 funds can be selected
            If wsin.Range("B" & i).Value <> "" Then
                LastRow = i
            End If
            
            For c = 1 To counter
                If wsin.Range("B" & i).Value = RecContFunds(c) Then
                    wsin.Range("E" & i).Value = wsdi.Range("K" & FundFoundAtRow(c)).Value * RCfInt
                    wsin.Range("G" & i).Value = wsdi.Range("E19").Value
                    'wsin.Range("Q" & i).Value = (wsdi.Range("E27").Value + _
                                                       wsdi.Range("E28").Value) / 100    'copy sum of inital commission rates for recurring contributions
                    RecContFunds(c) = "/?"
                End If
            Next c
        Next i
        
        'insert funds that are not the same as lumpsums
        Dim AllocatedToempty As Boolean     'to check if a contribution that is not part of a lumpsum has already been transfered
        For i = LastRow + 1 To LastRow + counter
            AllocatedToempty = False
            For x = 1 To counter
                If AllocatedToempty <> True Then
                    If RecContFunds(x) <> "/?" Then
                        wsin.Range("B" & i).Value = RecContFunds(x)
                        wsin.Range("E" & i).Value = wsdi.Range("K" & FundFoundAtRow(x)).Value * RCfInt
                        wsin.Range("G" & i).Value = wsdi.Range("E19").Value
                        wsin.Range("R" & i).Value = wsdi.Range("E32").Value / 100    'copy ongoing adviser fees
                        'wsin.Range("Q" & i).Value = (wsdi.Range("E27").Value + _
                                                     wsdi.Range("E28").Value) / 100    'copy sum of inital commission rates for recurring contributions
                        RecContFunds(x) = "/?"
                        AllocatedToempty = True
                    End If
                End If
            Next x
        Next i
    End If
End Sub



Sub SetupTaxFreeValidations(modifiedCell As String)
    Dim LS As Single
    Dim RC As Single
    Dim RCf As String
    Dim freqInt As Integer
    Dim RCmax As Single
    Dim checkVal As Single
    Dim messg As String
    Set wsdi = ThisWorkbook.wsdi
    
    RC = wsdi.Range("E17").Value
    RCf = wsdi.Range("E18").Value
    Select Case RCf
        Case Is = "Monthly"
            freqInt = 12
        Case Is = "Quarterly"
            freqInt = 4
        Case Is = "Biannually"
            freqInt = 2
        Case Is = "Annually"
            freqInt = 1
    End Select
    
    If wsdi.Range("E16").Value = "" Then
        LS = 0
    Else
        LS = wsdi.Range("E16").Value
    End If
    RCmax = LS + (RC * freqInt)
    
    If wsdi.Range("B4").Value = "I do not have an adviser" Then
        checkVal = Worksheets("Lists").Range("J8").Value
        
    Else
        checkVal = Worksheets("Lists").Range("J8").Value * (1.0342)
    End If
    messg = "Maximum yearly contribution [Lumpsum + (Recurring contribution * frequency)] must be less than " _
            & CStr(checkVal) & ". Please adjust the lumpsum amount, recurring contribution amount or frequency."
    
    If modifiedCell = "$E$16" Then
        If RCmax > checkVal Then
            MsgBox messg
            'wsdi.Range(modifiedCell).Value = 0
        End If
    ElseIf modifiedCell = "$E$17" Then
        If RCmax > checkVal Then
            MsgBox messg
            'wsdi.Range(modifiedCell).Value = 0
        End If
    ElseIf modifiedCell = "$E$18" Then
        If RCmax > checkVal Then
            MsgBox messg
            'wsdi.Range(modifiedCell).Value = 0
        End If
    Else
        wsdi.Range("E16, E17").Value = 0
        ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
        With wsdi.Range("E16").Validation       'set up lumpsum validation
            .Delete
            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
            Operator:=xlBetween, Formula1:="0", Formula2:=CStr(checkVal)
            .IgnoreBlank = False
            .InputTitle = ""
            .ErrorTitle = ""
            .InputMessage = ""
            .ErrorMessage = "Maximum lumpsum amount must be equal to or less than R" & CStr(checkVal)
            .ShowInput = True
            .ShowError = True
        End With
        ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
    End If
End Sub



Sub CopyWithdrawalsInfoToInput()
    Dim WithdFund As String
    Dim counter As Integer
    Dim InCounter As Integer
    Dim NumOfFunds As Integer
    Dim RWfInt As Integer
    Set wsdi = ThisWorkbook.wsdi
    Set wsin = ThisWorkbook.Worksheets("Input")
    
    NumOfFunds = 0
    For counter = 16 To 20      'find out how many lumpsum funds there are
        If wsdi.Range("$H$" & counter).Value <> "Select Fund" Then
            NumOfFunds = NumOfFunds + 1
        End If
    Next counter
    
    RWf = wsdi.Range("E21").Value
    Select Case RWf
        Case Is = "Monthly"
            RWfInt = 12
        Case Is = "Quarterly"
            RWfInt = 4
        Case Is = "Biannually"
            RWfInt = 2
        Case Is = "Annually"
            RWfInt = 1
    End Select
    
    For InCounter = 6 To 6 + NumOfFunds - 1
        For counter = 32 To 36
            If wsin.Range("$B$" & InCounter).Value = wsdi.Range("$H$" & counter).Value Then
               wsin.Range("$H$" & InCounter).Value = wsdi.Range("$K$" & counter).Value * RWfInt  'copy total withdrawal value for annum
               wsin.Range("$I$" & InCounter).Value = wsdi.Range("$E$22").Value   'copy annyal withdrawal increase %
            End If
        Next counter
    Next InCounter
End Sub



Sub DisplayPrintPreview()
    Dim prntA As String
    Dim pr As String
    Dim wb As Excel.Workbook
    Dim sh As Excel.Worksheet
    Set wsdi = ThisWorkbook.wsdi
    
    Set wb = ThisWorkbook
    pr = wb.Worksheets("Data Input").Range("H13").Value
    
    If pr <> "0" Then
        wb.Unprotect password:=ThisWorkbook.passw   'workbook must be unprotected to select hidden sheets
        Select Case pr
            Case Is = "TaxFree"
                Set sh = wb.Sheets("TaxFreeDisc")
                printA = "B1:J190"
            Case Is = "Retirement"
               Set sh = wb.Sheets("RetirementDisc")
               printA = "C1:H217"
            Case Is = "LivingAnnuity"
               Set sh = wb.Sheets("LivingAnnuityDisc")
               printA = "B1:I323"
           Case Is = "UnitTrust"
               Set sh = wb.Sheets("UnitTrustDisc")
               printA = "B1:J239"
            Case Is = "Preservation"
               Set sh = wb.Sheets("PreservationDisc")
               printA = "B1:G184"
        End Select
        
        With sh
            .PageSetup.PrintArea = printA   'assign printable area to print preview
            .Visible = xlSheetVisible       'sheet must be visible before it can be selected
            .Select         'sheet must be selected before it can be print previewed
        End With
        ActiveWindow.SelectedSheets.PrintPreview    'display print preview
        sh.Visible = xlSheetHidden              'hide the displayed disclosure sheet
        wb.Protect password:=ThisWorkbook.passw     'reprotect workbook
        wsdi.Select
        wsdi.Range("A1").Select 'return focus to "Data Input" sheet
    End If
End Sub



Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub ComboBox1_Change()

End Sub

Private Sub ComboBox1_Click()

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_Change(ByVal Target As Range)
    Dim modcell As Range
    Dim ws As Worksheet
    Set ws = ThisWorkbook.wsdi
    
    Application.EnableEvents = False
    
    If Target.Address = "$D$13" Then            'product type change
        Worksheets("Input").Range("A6").Value = ws.Range("D13").Value
        Call SelectFundsByProduct
        Call MakeWithdrawalList
    ElseIf Target.Address = ("$B$4") Then       'Intermediary/client change
                Set modcell = Range("$B$4")
                If modcell.Value = "I have an adviser" Or modcell.Value = "I am an adviser" Then
                    ws.Shapes("Group 3").Visible = False
                Else
                    ws.Shapes("Group 3").Visible = True
                    ws.Range("E27:E29,E32").Value = 0
                End If
                Call SelectFundsByProduct
                If ws.Range("$H$13") = "LivingAnnuity" Or ws.Range("$H$13") = "UnitTrust" Then
                    Call MakeWithdrawalList
                End If
    Else
        If Not Intersect(Target, Range("$H$16:$H$20")) Is Nothing Then
            Call MakeWithdrawalList
            Call CopyLumpsumInfoToInput
            Call CopyRecurrContInfoToInput
        End If
        If Not Intersect(Target, Range("$J$16:$J$20")) Is Nothing Then
            Call CopyLumpsumInfoToInput
            Call CopyRecurrContInfoToInput
        End If
        
        'copy recurrent contribution info from "Data Input" to "Input"
        If Not Intersect(Target, Range("$H$24:$J$28")) Is Nothing Then
            Call CopyLumpsumInfoToInput
            Call CopyRecurrContInfoToInput
        End If
        
        'copy withdrawal infro from "Data Input" to "Input"
        If Not Intersect(Target, Range("$H$32:$J$36")) Is Nothing Then
            Call CopyWithdrawalsInfoToInput
        End If
        
        'set up validations
        If Not Intersect(Target, Range("$E$16:$E$32")) Is Nothing Then
            If ws.Range("$H$13").Value = "TaxFree" Then     'for tax free product
                If Target.Address = "$E$16" Then
                    Call SetupTaxFreeValidations(Target.Address)
                End If
            ElseIf ws.Range("$H$13").Value = "LivingAnnuity" Then   'for living annuity withdrawal
                If Target.Address = "$E$16" Then
                    ws.Range("E20").Value = ws.Range("E16").Value * 0.025 'initialise minimum amount
                    ThisWorkbook.Worksheets("Data Input").Unprotect (ThisWorkbook.passw)
                    With ws.Range("$E$20").Validation   'validate selected income to between 2.5% and 17.5% of lump sum
                        .Delete
                        .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                        Operator:=xlBetween, Formula1:=(ws.Range("$E$16").Value * 0.025), Formula2:=(ws.Range("$E$16").Value * 0.175)
                        .IgnoreBlank = True
                        .InputTitle = ""
                        .ErrorTitle = ""
                        .InputMessage = ""
                        .ErrorMessage = "Withdrawal amount should be between 2.5% (R" & ws.Range("$E$16").Value * 0.025 & ") and 17.5% (R" & ws.Range("$E$16").Value * 0.175 & ") of lump sum contribution."
                        .ShowInput = True
                        .ShowError = True
                    End With
                    ThisWorkbook.Worksheets("Data Input").Protect (ThisWorkbook.passw), userinterfaceonly = True
                End If
            End If
            Call CopyLumpsumInfoToInput
            Call CopyRecurrContInfoToInput
            Call CopyWithdrawalsInfoToInput
        End If
    End If
    
    Application.EnableEvents = True
End Sub


Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub ComboBox1_Change()

End Sub

Private Sub ComboBox1_Click()

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub ComboBox1_Change()

End Sub

Private Sub ComboBox1_Click()

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub ComboBox1_Change()

End Sub

Private Sub ComboBox1_Click()

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
Attribute VB_Name = "Sheet21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub ComboBox1_Change()

End Sub

Private Sub ComboBox1_Click()

End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub
Attribute VB_Name = "Sheet22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Public passw As String
Public wsdi As Worksheet

Private Sub Workbook_Open()
    Dim ExpiryDate As Date
    
    
    ExpiryDate = #2/29/2020#                 ''''''''This is the expiry date to be set (MM/DD/YY)
    If ExpiryDate < Now() Then
        Response = MsgBox("This calculator has expired! Please request a more up to date version. This file will close now.", vbOKOnly + vbExclamation + vbDefaultButton2, "Message")
        'ThisWorkbook.Close
    Else
                    
        MsgBox "Please note this EAC illustrator is for ILLUSTRATION purposes only. Final costs will be shown in the official EAC table on the transaction confirmation statement once the investment has been processed. Please also review Minimum Disclosure Documents (MDDs) of all funds selected, these will contain the latest up to date costs.", , "Old Mutual Unit Trust EAC Illustrator"
        
        
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        'This is the password for the whole book and "Data Input" sheet.
        
        passw = "Omut"
        
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
        
        Set wsdi = ThisWorkbook.Worksheets("Data Input")
        Application.EnableEvents = False
        wsdi.Range("$D$13").Value = "Please select product type"
        wsdi.Range("$H$16:$H$20, $H$24:H$28, $H$32:$H$36").Validation.Delete
        wsdi.Range("$H$16:$H$20, $H$24:H$28, $H$32:$H$36").Value = "Select product"
        wsdi.Range("$B$4").Value = "Please select investor type"
        Application.EnableEvents = True
        
        ThisWorkbook.Worksheets("Data Input").Protect password:=passw, userinterfaceonly:=True
        ThisWorkbook.Protect password:=passw
    End If
End Sub

' InQuest injected base64 decoded content
' rZ+av

INQUEST-PP=macro
