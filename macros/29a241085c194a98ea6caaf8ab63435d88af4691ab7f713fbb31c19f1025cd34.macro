Attribute VB_Name = "Arkusz08"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Arkusz15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    If ActiveSheet.Name <> Me.Name Then Exit Sub
    odblokuj Me.Name
    Range("A1") = Sheets("deklaracja").Range("deklaracja_index")
    If Application.WorksheetFunction.Sum(Sheets("dane_ankiet").Range("dane_1").Cells(Sheets("deklaracja").Range("deklaracja_index"), 6).Resize(1, 13)) = 0 Then
        MsgBox "Nie wybrano UFK."
        Sheets("Wype|fffd|nianie deklaracji").Activate
        Exit Sub
    End If
    If Sheets("dane_ankiet").Range("dane_2").Cells(Sheets("deklaracja").Range("deklaracja_index"), 1) = "" Then
        Range("AE5").ClearContents
        Range("AE3") = False
        Range("AD7") = 0
        Range("AE8:AE33").ClearContents
        Range("AE35:AE36").ClearContents
        Range("AD34") = ""
    Else
        Range("AE3") = True
        Range("AE5") = CBool(Sheets("dane_ankiet").Range("dane_2").Cells(Sheets("deklaracja").Range("deklaracja_index"), 1))
        Range("AD7") = Range("AH7")
        For i = 8 To 33
            If Range("AF" & i) = "" Then
                Range("AD" & i) = Range("AH" & i)
            Else
                Range("AE" & i) = Range("AH" & i)
            End If
        Next i
        Range("AD34") = Range("AH34")
        Range("AE35") = Range("AH35")
        Range("AE36") = Range("AH36")
    End If
    zablokuj Me.Name
End Sub

Private Sub Worksheet_Calculate()
    If ActiveSheet.Name <> Me.Name Then Exit Sub
    If Range("A1") <> Sheets("deklaracja").Range("deklaracja_index") Then
        If Range("AK1") = False Then
            If Not (Application.WorksheetFunction.Sum(Sheets("dane_ankiet").Range("dane_1").Cells(Range("A1"), 6).Resize(1, 13)) = 0) Then
                odp = MsgBox("Uwaga! Odpowiedzi dla uczestnika nr " & Range("A1") & " nie zosta|fffd|y zapisane. Czy zapisa|fffd|? Przy wybraniu opcji NIE zmiany zostan|fffd| utracone.", vbYesNo)
                If odp = vbYes Then zapis_ankieta
            End If
        End If
        Application.ScreenUpdating = False
        Application.EnableEvents = False
        Sheets("PIDUU").Activate
        Application.EnableEvents = True
        Me.Activate
        Application.ScreenUpdating = True
    End If
End Sub

Private Sub Worksheet_Deactivate()
    If Range("AK1") = False Then
        If Not (Application.WorksheetFunction.Sum(Sheets("dane_ankiet").Range("dane_1").Cells(Sheets("deklaracja").Range("deklaracja_index"), 6).Resize(1, 13)) = 0) Then
            odp = MsgBox("Uwaga! Odpowiedzi dla uczestnika nr " & Sheets("deklaracja").Range("deklaracja_index") & " nie zosta|fffd|y zapisane. Czy zapisa|fffd|? Przy wybraniu opcji NIE zmiany zostan|fffd| utracone.", vbYesNo)
            If odp = vbYes Then zapis_ankieta
        End If
    End If
End Sub

Attribute VB_Name = "Arkusz17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    If ActiveSheet.Name <> Me.Name Then Exit Sub
    odblokuj Me.Name
    Range("A1") = Sheets("deklaracja").Range("deklaracja_index")
    Application.EnableEvents = False
    For i = 3 To 70
        If Len(Range("F" & i)) > 0 Then Range("C" & i) = Range("G" & i)
    Next i
    Application.EnableEvents = True
    zablokuj Me.Name
End Sub

Private Sub Worksheet_Calculate()
    If ActiveSheet.Name <> Me.Name Then Exit Sub
    If Range("A1") <> Sheets("deklaracja").Range("deklaracja_index") Then
        If Range("H1") = False Then
            odp = MsgBox("Uwaga! Dane deklaracji nr " & Range("A1") & " nie zosta|fffd|y zapisane. Czy zapisa|fffd|? Przy wybraniu opcji NIE zmiany zostan|fffd| utracone.", vbYesNo)
            If odp = vbYes Then zapis_deklaracja
        End If
        If Range("A1") <> Sheets("deklaracja").Range("deklaracja_index") Then
            Application.ScreenUpdating = False
            Application.EnableEvents = False
            Sheets("PIDUU").Activate
            Application.EnableEvents = True
            Application.ScreenUpdating = True
            Me.Activate
        End If
    End If
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub

Private Sub Worksheet_Deactivate()
    If Range("H1") = False Then
        odp = MsgBox("Uwaga! Dane deklaracji nr " & Sheets("deklaracja").Range("deklaracja_index") & " nie zosta|fffd|y zapisane. Czy zapisa|fffd|? Przy wybraniu opcji NIE zmiany zostan|fffd| utracone.", vbYesNo)
        If odp = vbYes Then zapis_deklaracja
    End If
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Target.Column = 4 And (Target.Row = 51 Or Target.Row = 57 Or Target.Row = 63 Or Target.Row = 69) Then
        kalendarz.Show
    End If
End Sub

Attribute VB_Name = "Arkusz18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Arkusz3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Arkusz5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Arkusz6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Deklaracja"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    Dim dekl_strony_max As Integer
    'Exit Sub
    Application.EnableEvents = False
    Application.ScreenUpdating = False
    odblokuj Me.Name
    Range("A1") = Range("deklaracja_index")
    If Range("BB" & Range("wiersz_odmowa").Row) = 1 Then
        If Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = True Then Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = False
    Else
        If Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = False Then Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = True
    End If
    If Sheets("dane_ankiet").Range("dane_2").Cells(Range("deklaracja_index"), 1) = "" Then
        Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = True
        Range(Range("wiersz_podzial_4"), Range("wiersz_koniec").Offset(-1)).EntireRow.Hidden = True
    ElseIf Sheets("dane_ankiet").Range("dane_2").Cells(Range("deklaracja_index"), 1) = 1 Then
        dekl_strony_max = 4
        Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = False
        Range(Range("wiersz_podzial_4"), Range("wiersz_koniec").Offset(-1)).EntireRow.Hidden = True
    Else
        Range("wiersz_odmowa").Offset(-1).Resize(2).EntireRow.Hidden = True
        Range(Range("wiersz_podzial_4"), Range("wiersz_podzial_5").Offset(-1)).EntireRow.Hidden = False
        For i = Range("wiersz_podzial_4").Row To Range("wiersz_podzial_5").Row - 1
            If Range("BB" & i) = 1 Then
                If Rows(i).Hidden = True Then Rows(i).Hidden = False
            Else
                If Rows(i).Hidden = False Then Rows(i).Hidden = True
            End If
        Next i
        If Range("BB282") = 1 Then '!!!!!!!!!
            dekl_strony_max = 6
            Range(Range("wiersz_podzial_5"), Range("wiersz_koniec").Offset(-1)).EntireRow.Hidden = False
        Else
            dekl_strony_max = 5
            Range(Range("wiersz_podzial_5"), Range("wiersz_koniec").Offset(-1)).EntireRow.Hidden = True
        End If
    End If
    If Len(Sheets("dane_ankiet").Range("dane_2").Cells(Range("deklaracja_index"), 1)) > 0 Then
        If dekl_strony = 0 Then
            Me.PageSetup.CenterFooter = "&P/&N"
        Else
            Me.PageSetup.CenterFooter = "&P-" & dekl_strony & "/" & dekl_strony_max
        End If
        ActiveWindow.View = xlPageBreakPreview
        Me.ResetAllPageBreaks
        Set ActiveSheet.HPageBreaks(1).Location = Range("wiersz_podzial_1").Offset(, 1)
        Set ActiveSheet.HPageBreaks(2).Location = Range("wiersz_podzial_2").Offset(, 1)
        Set ActiveSheet.HPageBreaks(3).Location = Range("wiersz_podzial_3").Offset(, 1)
        If Sheets("dane_ankiet").Range("dane_2").Cells(Range("deklaracja_index"), 1) = 0 Then
            Set ActiveSheet.HPageBreaks(4).Location = Range("wiersz_podzial_4").Offset(, 1)
            If Range("BB282") = 1 Then '!!!!!!!
                Set ActiveSheet.HPageBreaks(5).Location = Range("wiersz_podzial_5").Offset(, 1)
            End If
        End If
        ActiveWindow.View = xlNormalView
        Me.DisplayPageBreaks = False
    End If
    zablokuj Me.Name
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub

Private Sub Worksheet_Calculate()
    If ActiveSheet.Name <> Me.Name Then Exit Sub
    If Range("A1") <> Range("deklaracja_index") Then
        Application.ScreenUpdating = False
        Sheets("PIDUU").Activate
        Me.Activate
        Application.ScreenUpdating = True
    End If
End Sub

Attribute VB_Name = "Deklaracyjne"
Option Private Module

Public dekl_strony As Integer

Sub import_ankiety()
    import_nazwa = Application.GetOpenFilename("Dane deklaracji (*.xls; *.xlsx), *.xls;*.xlsx")
    If import_nazwa <> False Then
        Dim import_spr As Boolean
        Dim import_plik As Workbook
        import_spr = True
        Set import_plik = Workbooks.Open(import_nazwa, False, True)
        If import_plik.Sheets(1).Cells(1, 91) <> "opis zawodu" Then import_spr = False
        For i = 1 To 30
            For j = 1 To 5
                If import_plik.Sheets(1).Cells(1 + i, 1 + j) <> ThisWorkbook.Sheets("dane_ankiet").Range("dane_1").Cells(i, j) Then import_spr = False
            Next j
        Next i
        If import_spr Then
            import_plik.Sheets(1).Range(Cells(2, 2), Cells(31, 19)).Copy
            ThisWorkbook.Sheets("dane_ankiet").Range("dane_1").PasteSpecial xlPasteValues
            import_plik.Sheets(1).Range(Cells(2, 20), Cells(31, 43)).Copy
            ThisWorkbook.Sheets("dane_ankiet").Range("dane_2").PasteSpecial xlPasteValues
            import_plik.Sheets(1).Range(Cells(2, 44), Cells(31, 86)).Copy
            ThisWorkbook.Sheets("dane_ankiet").Range("dane_3").PasteSpecial xlPasteValues
            import_plik.Sheets(1).Range(Cells(2, 87), Cells(31, 91)).Copy
            ThisWorkbook.Sheets("dane_ankiet").Range("dane_4").PasteSpecial xlPasteValues
        Else
            MsgBox "B|fffd||fffd|d: nie zaczytano pliku z powodu niezgodno|fffd|ci uczestnik|fffd|w."
        End If
        Application.CutCopyMode = False
        import_plik.Close False
    End If
End Sub

Sub eksport_ankiety()
    Dim wb As Workbook
    Set wb = Workbooks.Add
    ThisWorkbook.Sheets("dane_ankiet").Range("A3").Offset(-1, 0).Resize(101).Copy
    wb.Sheets(1).Range("A1").PasteSpecial xlPasteValuesAndNumberFormats
    ThisWorkbook.Sheets("dane_ankiet").Range("dane_1").Offset(-1, 0).Resize(31).Copy
    wb.Sheets(1).Range("A1").Offset(0, 1).PasteSpecial xlPasteValuesAndNumberFormats
    ThisWorkbook.Sheets("dane_ankiet").Range("dane_2").Offset(-1, 0).Resize(31).Copy
    wb.Sheets(1).Range("A1").End(xlToRight).Offset(0, 1).PasteSpecial xlPasteValuesAndNumberFormats
    ThisWorkbook.Sheets("dane_ankiet").Range("dane_3").Offset(-1, 0).Resize(31).Copy
    wb.Sheets(1).Range("A1").End(xlToRight).Offset(0, 1).PasteSpecial xlPasteValuesAndNumberFormats
    ThisWorkbook.Sheets("dane_ankiet").Range("dane_4").Offset(-1, 0).Resize(31).Copy
    wb.Sheets(1).Range("A1").End(xlToRight).Offset(0, 1).PasteSpecial xlPasteValuesAndNumberFormats
    eksport_nazwa = Application.GetSaveAsFilename(a2y(ThisWorkbook.Name, 5) & "_eksport.xlsx", "Plik programu Excel (*.xlsx), *.xlsx")
    If eksport_nazwa <> False Then wb.SaveAs eksport_nazwa
End Sub

Sub zapis_ankieta()
    If Sheets("Wype|fffd|nianie ankiety").Range("AE3") = False Then
        MsgBox "Brak o|fffd|wiadczenia - nie mo|fffd|na zapisa|fffd| ankiety."
        Exit Sub
    End If
    Application.Calculation = xlCalculationManual
    If Sheets("Wype|fffd|nianie ankiety").Range("AE5") = True Then
        Sheets("dane_ankiet").Range("dane_2").Cells(Sheets("Wype|fffd|nianie ankiety").Range("A1"), 1) = 1
    Else
        Sheets("dane_ankiet").Range("dane_2").Cells(Sheets("Wype|fffd|nianie ankiety").Range("A1"), 1) = 0
    End If
    For i = 2 To 24
        Sheets("dane_ankiet").Range("dane_2").Cells(Sheets("Wype|fffd|nianie ankiety").Range("A1"), i) = Sheets("Wype|fffd|nianie ankiety").Range("AL" & i)
    Next i
    Application.Calculation = xlCalculationAutomatic
End Sub

Sub zapis_ankieta_wyp_dekl()
    zapis_ankieta
    Sheets("Wype|fffd|nianie deklaracji").Activate
End Sub

Sub zapis_ankieta_idz_dekl()
    zapis_ankieta
    Sheets("Deklaracja").Activate
    ActiveWindow.ScrollRow = 255
End Sub

Sub zapis_deklaracja()
    If Sheets("Wype|fffd|nianie deklaracji").Range("K1") = False Then
        Application.EnableEvents = False
        Sheets("Wype|fffd|nianie deklaracji").Activate
        Sheets("deklaracja").Range("deklaracja_index") = Range("A1")
        Application.EnableEvents = True
        Dim komunikat As String
        If Range("L3") = False Then komunikat = komunikat & "Udzia|fffd| jednego funduszu musi wynosi|fffd| min. 5%." & Chr(10)
        If Range("L4") = False Then komunikat = komunikat & "Suma udzia|fffd||fffd|w funduszy musi by|fffd| r|fffd|wna 100%." & Chr(10)
        If Range("L5") = False Then komunikat = komunikat & "Niew|fffd|a|fffd|ciwa suma sk|fffd|adek op|fffd|acanych przez Ubezpieczaj|fffd|cego i Uczestnika." & Chr(10)
        If Range("L6") = False Then komunikat = komunikat & "Suma udzia|fffd||fffd|w dla uposa|fffd|onych g|fffd||fffd|wnych musi by|fffd| r|fffd|wna 100%." & Chr(10)
        If Range("L7") = False Then komunikat = komunikat & "Suma udzia|fffd||fffd|w dla uposa|fffd|onych zast|fffd|pczych musi by|fffd| r|fffd|wna 100%." & Chr(10)
        MsgBox komunikat, vbCritical, "B|fffd||fffd|D"
        Exit Sub
    End If
    Application.Calculation = xlCalculationManual
    For i = 3 To 70
        If Sheets("Wype|fffd|nianie deklaracji").Range("I" & i) <> "" Then _
            Sheets("dane_ankiet").Range("dane_" & Sheets("Wype|fffd|nianie deklaracji").Range("I" & i)).Cells(Sheets("Wype|fffd|nianie deklaracji").Range("A1"), Sheets("Wype|fffd|nianie deklaracji").Range("F" & i)) = Sheets("Wype|fffd|nianie deklaracji").Range("C" & i)
    Next i
    Application.Calculation = xlCalculationAutomatic
End Sub

Sub zapis_deklaracja_idz_dekl()
    zapis_deklaracja
    Sheets("Deklaracja").Activate
End Sub

Function kontrola_pesel(pesel As String, dur As Date, Optional mezczyzna As Integer = -1) As Boolean
    kontrola_pesel = True
    If Len(pesel) <> 11 Then
        kontrola_pesel = False
        Exit Function
    End If
    If Mid(pesel, 1, 2) <> Right(Year(dur), 2) Then kontrola_pesel = False
    mies = Month(dur)
    If Year(dur) >= 2000 Then mies = mies + 20
    If Mid(pesel, 3, 2) <> Format(mies, "00") Then kontrola_pesel = False
    If Mid(pesel, 5, 2) <> Format(Day(dur), "00") Then kontrola_pesel = False
    If Mid(pesel, 10, 1) Mod 2 = 0 And mezczyzna = 1 Then kontrola_pesel = False
    If Mid(pesel, 10, 1) Mod 2 = 1 And mezczyzna = 0 Then kontrola_pesel = False
    If (10 - ((1 * Mid(pesel, 1, 1) + 3 * Mid(pesel, 2, 1) + 7 * Mid(pesel, 3, 1) + 9 * Mid(pesel, 4, 1) _
             + 1 * Mid(pesel, 5, 1) + 3 * Mid(pesel, 6, 1) + 7 * Mid(pesel, 7, 1) + 9 * Mid(pesel, 8, 1) _
             + 1 * Mid(pesel, 9, 1) + 3 * Mid(pesel, 10, 1)) Mod 10)) Mod 10 _
       <> 1 * Mid(pesel, 11, 1) Then kontrola_pesel = False
End Function

Sub wyp_deklar()
    Sheets("Wype|fffd|nianie deklaracji").Activate
End Sub

Sub wyp_ankiet()
    Sheets("Wype|fffd|nianie ankiety").Activate
End Sub

Attribute VB_Name = "Funkcje"
Option Explicit
Option Private Module

Public Const h_ As String = "wiF"
Public Const a_ As String = "g6w"
Public Const s_ As String = "kg7"
Public Const l_ As String = "K7I"
Public Const o_ As String = "4f"

'sprawdzenie poprawno|fffd|ci wprowadzonych danych i warunk|fffd|w dla wszystkich uczestnik|fffd|w (te|fffd| underwriting)
Public Sub testuj()
    Dim komorka As Range
    Dim suma_inw As Double
    Dim i, x As Integer
    ustaw_swiadczenia
    ile = Sheets("tablice").Range("ilu_uczestnikow")
    
    'sprawdzenie czy wprowadzono min jedn|fffd| osob|fffd| do kwotowania w arkuszu
    If ile = 0 Then
        MsgBox "Nie wprowadzono uczestnik|fffd|w."
        Sheets("tablice").Range("blad") = True
        Exit Sub
    End If
    
    'sprawdzenie maksymalnej liczby os|fffd|b do kwotowania w arkuszu
    If ile > 30 Then
        MsgBox "Niestety, program pozwala na przeliczenie jedynie 30 uczestnik|fffd|w."
        Sheets("tablice").Range("blad") = True
        Exit Sub
    End If
    
    'ustawienie trybu sum minimalnych
    Dim su_min_tryb As Integer
    ReDim u(ile) As uczestnik
    If (ile = 1 And Sheets("tablice").Range("czy_dolaczajacy") = False And Sheets("tablice").Range("cokk") = False) Or _
       (Sheets("tablice").Range("osoba_fizyczna") = True And Sheets("tablice").Range("cokk") = False) Then
        su_min_tryb = 1
    Else
        su_min_tryb = 2
    End If
    Range("params!tryb") = su_min_tryb

    'wst|fffd|p do sprawdzenia danych uczestnik|fffd|w i sum
    sprawdz_wartosci Sheets("uczestnicy").Range("A5:G" & 4 + ile)
    
    'sprawdzenie danych uczestnik|fffd|w
    For Each komorka In Sheets("uczestnicy").Range("B5:G" & 4 + ile)
        If Len(komorka.Value) = 0 Then
            MsgBox "Brakuj|fffd|ce dane osobowe uczestnika nr " & komorka.Row - 4 & "."
            Sheets("tablice").Range("blad") = True
            Exit Sub
        End If
    Next komorka
    
    'sprawdzenie sum
    If Range("uczestnicy!uczestnicy_poprawnosc").Cells(ile) = False Then
        MsgBox "Niew|fffd|a|fffd|ciwe sumy ubezpieczenia lub sk|fffd|adki w zak|fffd|adce ""Uczestnicy"". B|fffd||fffd|dy zosta|fffd|y zaznaczone na czerwono."
        Sheets("tablice").Range("blad") = True
        Exit Sub
    End If
    
    suma_inw = 0
    'zapis danych uczestnik|fffd|w w zmiennej obiektowej u (uczestnik)
    For i = 1 To ile
        u(i).nazwisko = Sheets("uczestnicy").Cells(i + 4, 2)
        u(i).imie = Sheets("uczestnicy").Cells(i + 4, 3)
        If UCase(Sheets("uczestnicy").Cells(i + 4, 4)) = "K" Then
            u(i).plec = 1
        Else
            u(i).plec = 2
        End If
        u(i).data_ur = Format(Sheets("uczestnicy").Cells(i + 4, 5), "yyyy-mm-dd")
        u(i).ryzyko = Sheets("uczestnicy").Cells(i + 4, 6)
        u(i).invest_prem = Sheets("uczestnicy").Cells(i + 4, 7 + 16)
        suma_inw = suma_inw + u(i).invest_prem
        For x = 1 To 16
            u(i).SU(Sheets("uczestnicy").Cells(3, 16 + 8 + x)) = Sheets("uczestnicy").Cells(i + 4, 6 + x)
            If Len(u(i).SU(Sheets("uczestnicy").Cells(3, 16 + 8 + x))) = 0 _
                Or Sheets("uczestnicy").Cells(2, 6 + x) = 0 Then u(i).SU(Sheets("uczestnicy").Cells(3, 16 + 8 + x)) = 0
        Next x
    Next i
    If Sheets("tablice").Range("czy_import") Then
        import_loadingi
    Else
        freq_disc = 1
    End If
    
    'sprawdzenie wersji OWU przy do|fffd||fffd|czeniach
    If Range("tablice!nr_polisy") > 0 And suma_inw > 0 And Range("tablice!owu") = "PGV/2016/1" Then
        MsgBox "Przy obecnej wersji OWU nie ma mo|fffd|liwo|fffd|ci do|fffd||fffd|czenia os|fffd|b ze sk|fffd|adk|fffd| kapita|fffd|ow|fffd|. Wymagana konwersja na OWU PGVF/2016/1."
        Sheets("tablice").Range("blad") = True
        Exit Sub
    End If
End Sub

'sprawdzenie czy warto|fffd||fffd| jest liczb|fffd|, je|fffd|li tak to zwraca t|fffd| liczb|fffd|, je|fffd|li nie liczba to zwraca 0
Public Function test_liczba(liczba)
    If Len(liczba) > 0 Then
        If IsNumeric(liczba) = False Then
            test_liczba = 0
        Else
            test_liczba = liczba
        End If
    Else
        test_liczba = 0
    End If
End Function

'obci|fffd|cie ostatniego znaku ze stringa
Public Function a2y(text As String, Optional ileznakow As Integer = 1)
    a2y = Left(text, Len(text) - ileznakow)
End Function

'czyszczenie danych uczestnik|fffd|w
Public Sub CzyscUczestnicy()
    Dim nazwa As String
    nazwa = ActiveSheet.Name
    Sheets("uczestnicy").Select
    Application.EnableEvents = False
    odblokuj "uczestnicy"
    Range("uczestnicy_all").Locked = False
    Range("uczestnicy_all").ClearContents
    If Sheets("tablice").Range("czy_import") = True Then
        Sheets("tablice").Range("czy_import") = False
        Sheets("tablice").Range("czy_konwersja") = False
        Sheets("tablice").Range("nr_polisy") = ""
        Sheets("uczestnicy").Range("SU_import").ClearContents
        Sheets("uczestnicy").Range("ryzyko_import").ClearContents
    End If
    zablokuj "uczestnicy"
    Application.EnableEvents = True
    Cells(5, 2).Select
    ile = 0
    Sheets("raport partenon").Cells.ClearContents
    sprawdz_wartosci Range("uczestnicy_all")
    Sheets(nazwa).Activate
End Sub

'czyszczenie kwotacji
Public Sub CzyscKwotacja()
    'czyszczenie tekst|fffd|w sta|fffd|ych na kwotacji
    Sheets("kwotacja").Select
    odblokuj "kwotacja"
    Range("kwot_firma") = ""
    Range("kwot_adres1") = ""
    Range("kwot_adres2") = ""
    Range("kwot_data_kwot") = ""
    Range("kwot_data_na_dzien") = ""
    Range("kwot_wersja") = ""
    Range("kwot_numer") = ""
    Range("kwot_czestot") = ""
    Range("total_risk") = ""
    Range("total_invest") = ""
    Range("total_prem") = ""
    Range("kwot_OWU") = ""
    Range("kwot_OWU_link") = ""
    Range("kwot_UWR") = ""
    Range("kwot_serial") = ""
        
    'czyszczenie danych uczestnik|fffd|w na kwotacji, ukrywanie wierszy i zw|fffd|enie kolumny C
    Rows("11:" & 10 + (16 + 5) * 30).ClearContents
    Rows("11:" & 10 + (16 + 5) * 30).Hidden = True
    Columns("C").ColumnWidth = 6.29
    zablokuj "kwotacja"
    Cells(1, 1).Select

    'czyszczenie informacji o dokumentach finansowych
    Range("params!info_dok_finansowe") = 0
End Sub
    
'czyszczenie listu; czyszczenie os|fffd|b na ilustracji
Public Sub CzyscListIlustracja()
    If Sheets("list").Visible = False Then Exit Sub
    Sheets("list").Select
    odblokuj "list"
    Range("miasto_list") = "": Range("firma_nazwisko_list") = ""
    Range("firma_stanowisko_list") = "": Range("firma_nazwa_list") = ""
    Range("firma_adres_list") = "": Range("firma_miasto_list") = ""
    Range("nr_kwotacji_list") = "": Range("firma_nazwa_list_2") = ""
    Range("nazwa_list") = "": Range("cc_list") = "": Range("cc_tytul_list") = ""
    Range("agent_list") = "": Range("agent_tytul_list") = ""
    zablokuj "list"

    odblokuj "ilustracja - ochrona"
    Sheets("Ilustracja - ochrona").Range("ilustracja_uczestnicy").ClearContents
    zablokuj "ilustracja - ochrona"
End Sub

'czyszczenie danych firmy i (opcjonalnie) agenta w zak|fffd|adce "Tablice"
Public Sub CzyscDaneFirmyAgenta(Optional czysc_agenta As Boolean = True)
    Range("tablice!firma_plec") = 2
    Range("tablice!firma_nazwisko") = ""
    Range("tablice!firma_stanowisko") = ""
    Range("tablice!firma_nazwa") = ""
    Range("tablice!firma_adres") = ""
    Range("tablice!firma_miasto") = ""
    Range("tablice!nazwa_grupy") = ""
    If czysc_agenta Then
        Range("tablice!agent_nazwisko") = ""
        Range("tablice!agent_stanowisko") = ""
        Range("tablice!agent_numer") = ""
        Range("tablice!agent_plec") = 2
        Range("tablice!agent_cc") = ""
        Range("tablice!agent_cc_stanowisko") = ""
        Range("tablice!agent_miasto") = ""
    End If
End Sub

'CZYSZCZENIE I BLOKOWANIE SKOROSZYTU DLA AGENT|fffd|W (wo|fffd|ane tylko tutaj z kodu)
Private Sub zablokuj_ag()
    Application.EnableEvents = True
    odblokuj_app
    Range("tablice!cokk") = False
    Range("tablice!alokacja") = 100
    Range("tablice!alokacja_lok") = 97
    Sheets("tablice").Range("adm_ch") = 72
    Range("tablice!comm_ws") = 20
    Range("tablice!nadprowizja") = True
    Sheets("ilustracja - fundusz").Visible = True
    zablokuj "menu"
    zablokuj "kwotacja"
    zablokuj "list"
    zablokuj "ilustracja - ochrona"
    zablokuj "ilustracja - fundusz"
    zablokuj "uczestnicy"
    zablokuj "Lista zawod|fffd|w"
    Application.EnableEvents = False
    If Sheets("qx_old").Visible = True Then Sheets("qx_old").Visible = False
    If Sheets("qx_GN").Visible = True Then Sheets("qx_GN").Visible = False
    If Sheets("loadings").Visible = True Then Sheets("loadings").Visible = False
    If Sheets("params").Visible = True Then Sheets("params").Visible = False
    If Sheets("tablice").Visible = True Then Sheets("tablice").Visible = False
    If Sheets("polisy").Visible = True Then Sheets("polisy").Visible = False
    If Sheets("raport partenon").Visible = True Then Sheets("raport partenon").Visible = False
    If Sheets("PIDUU").Visible = True Then Sheets("PIDUU").Visible = False
    If Sheets("Deklaracja").Visible = True Then Sheets("Deklaracja").Visible = False
    If Sheets("Wype|fffd|nianie ankiety").Visible = True Then Sheets("Wype|fffd|nianie ankiety").Visible = False
    If Sheets("Wype|fffd|nianie deklaracji").Visible = True Then Sheets("Wype|fffd|nianie deklaracji").Visible = False
    If Sheets("PIDUU opcje").Visible = True Then Sheets("PIDUU opcje").Visible = False
    If Sheets("ankieta_nazwy").Visible = True Then Sheets("ankieta_nazwy").Visible = False
    If Sheets("dane_ankiet").Visible = True Then Sheets("dane_ankiet").Visible = False
    If Sheets("agenci_przekodownik").Visible = True Then Sheets("agenci_przekodownik").Visible = False
    Application.EnableEvents = True
    Range("dane_ankiet!dane_1").ClearContents
    Range("dane_ankiet!dane_2").ClearContents
    Range("dane_ankiet!dane_3").ClearContents
    Range("dane_ankiet!dane_4").ClearContents
    CzyscUczestnicy
    CzyscKwotacja
    CzyscListIlustracja
    CzyscDaneFirmyAgenta
    zablokuj_app
    Sheets("menu").Activate
    MENU.menu_dolaczenie.Value = True
    MENU.menu_nowa.Value = True
    Sheets("menu").Range("C13") = ""
    Sheets("menu").Range("C15") = "Miesi|fffd|czna"
End Sub

'ODBLOKOWANIE SKOROSZYTU DO DEVELOPERKI (wo|fffd|ane tylko tutaj z kodu)
Private Sub Odblokuj_AS()
    Dim i As Integer
    Dim nazwaa As String
    odblokuj_app
    Application.EnableEvents = False
    For i = 1 To 22
        nazwaa = Range("params!lista_arkuszy").Cells(i)
        Sheets(nazwaa).Visible = True
        odblokuj nazwaa
    Next i
    Application.EnableEvents = True
'    Sheets("qx_old").Visible = True
'    Sheets("qx_GN").Visible = True
'    Sheets("ilustracja - fundusz").Visible = True
'    Sheets("loadings").Visible = True
'    Sheets("params").Visible = True
'    Sheets("tablice").Visible = True
'    Sheets("raport partenon").Visible = True
'    odblokuj "menu"
'    odblokuj "uczestnicy"
'    odblokuj "kwotacja"
'    odblokuj "list"
'    odblokuj "ilustracja - ochrona"
'    odblokuj "ilustracja - fundusz"
'    odblokuj "Lista zawod|fffd|w"
End Sub

Public Sub odblokuj_app()
    ActiveWorkbook.Unprotect h_ & a_ & s_ & l_ & o_
End Sub

Public Sub zablokuj_app()
    ActiveWorkbook.Protect h_ & a_ & s_ & l_ & o_
End Sub

Public Sub odblokuj(Arkusz)
    Sheets(Arkusz).Unprotect h_ & a_ & s_ & l_ & o_
End Sub

Public Sub zablokuj(Arkusz)
    Sheets(Arkusz).Protect Password:=h_ & a_ & s_ & l_ & o_, AllowFiltering:=True
End Sub

Sub otworz_plik_pdf(nazwa As String)
    Dim plik_pdf As Object
    Set plik_pdf = Sheets("tablice").OLEObjects(nazwa)
    plik_pdf.Verb Verb:=xlPrimary
    Set plik_pdf = Nothing
End Sub
Attribute VB_Name = "IlustracjaList"
Option Private Module

'PRZYGOTOWANIE LISTU
Public Sub Pisz_list()
    If Sheets("tablice").Range("nr_polisy") > 0 Then
        odblokuj_app
        odblokuj "list"
        Range("firma_nazwa_list") = Sheets("tablice").Range("firma_nazwa")
        Range("firma_adres_list") = Sheets("tablice").Range("firma_adres")
        Range("firma_miasto_list") = Sheets("tablice").Range("firma_miasto")
        zablokuj "list"
        If Sheets("list").Visible = True Then Sheets("list").Visible = False
        zablokuj_app
        Exit Sub
    End If
    
    odblokuj_app
    If Sheets("list").Visible = False Then Sheets("list").Visible = True
    zablokuj_app
    odblokuj "list"
    
    Sheets("list").Select
    If Range("tablice!firma_plec") = 1 Then
        firma_plec_list = "Pani "
    Else
        firma_plec_list = "Pan "
    End If
    Range("miasto_list") = Sheets("tablice").Range("agent_miasto") & ", " & Format(Now(), "d mmmm yyyy")
    Range("firma_nazwisko_list") = firma_plec_list & Sheets("tablice").Range("firma_nazwisko")
    Range("firma_stanowisko_list") = Range("tablice!firma_stanowisko")
    If Range("tablice!osoba_fizyczna") Then
        Range("firma_nazwisko_list").EntireRow.Hidden = False
        Range("firma_stanowisko_list").EntireRow.Hidden = True
    ElseIf Sheets("tablice").Range("firma_nazwisko") = "" And Sheets("tablice").Range("firma_stanowisko") = "" Then
        Range("firma_nazwisko_list").EntireRow.Hidden = True
        Range("firma_stanowisko_list").EntireRow.Hidden = True
    Else
        Range("firma_nazwisko_list").EntireRow.Hidden = False
        Range("firma_stanowisko_list").EntireRow.Hidden = False
    End If
    If Range("tablice!osoba_fizyczna") = False Then
        Range("szanowni_list") = "Szanowni Pa|fffd|stwo,"
    ElseIf Range("tablice!firma_plec") = 1 Then
        Range("szanowni_list") = "Szanowna Pani,"
    Else
        Range("szanowni_list") = "Szanowny Panie,"
    End If
    Range("firma_nazwa_list") = Sheets("tablice").Range("firma_nazwa")
    Range("firma_adres_list") = Sheets("tablice").Range("firma_adres")
    Range("firma_miasto_list") = Sheets("tablice").Range("firma_miasto")
    If Sheets("tablice").Range("nr_kwotacji") = "" Then
        Range("nr_kwotacji_list").EntireRow.Hidden = True
    Else
        Range("nr_kwotacji_list").EntireRow.Hidden = False
        Range("nr_kwotacji_list") = Sheets("tablice").Range("nr_kwotacji")
    End If
    Range("firma_nazwa_list_2") = Sheets("tablice").Range("firma_nazwa")
    If Sheets("tablice").Range("nazwa_grupy") = "" Then
        Range("nazwa_list").EntireRow.Hidden = True
    Else
        Range("nazwa_list").EntireRow.Hidden = False
        Range("nazwa_list") = Sheets("tablice").Range("nazwa_grupy")
    End If
    If Range("tablice!OWU") = "PGV/2015/1" Or Range("tablice!OWU") = "PGV/2016/1" Or Range("tablice!OWU") = "PGVF/2016/1" Then
        wiek_max = Range("tablice!emeryt") - 1
    Else
        wiek_max = Range("tablice!emeryt") - 2 - 1
    End If
    If wiek_max Mod 10 = 2 Or wiek_max Mod 10 = 3 Or wiek_max Mod 10 = 4 Then
        lata_tekst = "lata"
    Else
        lata_tekst = "lat"
    End If
    Range("wiek_list") = "- uko|fffd|czone " & Range("tablice!wiek_min") & " lat " _
                       & "- nie uko|fffd|czone " & wiek_max & " " & lata_tekst
    Range("agent_list") = Sheets("tablice").Range("agent_nazwisko")
    Range("agent_tytul_list") = Sheets("tablice").Range("agent_stanowisko")
    If Range("tablice!agent_plec") = 1 Then
        cc_plec = "Pani "
    Else
        cc_plec = "Pan "
    End If
    Range("cc_list") = cc_plec & Sheets("tablice").Range("agent_cc")
    Range("cc_tytul_list") = Sheets("tablice").Range("agent_cc_stanowisko")
    If Sheets("tablice").Range("agent_cc") = "" And _
            Sheets("tablice").Range("agent_cc_stanowisko") = "" Then
        Range("cc_list").Offset(-2).Resize(4).EntireRow.Hidden = True
    Else
        Range("cc_list").Offset(-2).Resize(4).EntireRow.Hidden = False
    End If
    
    If Sheets("tablice").Range("czy_fundusz") Then
        If Range("tablice!osoba_fizyczna") = True Then
            Range("punkt_0_list") = "dzi|fffd|kujemy za zainteresowanie ofert|fffd| ubezpieczenia grupowego Aviva. " _
                & "Na podstawie otrzymanych danych dotycz|fffd|cych Uczestnika, Aviva przedstawia " _
                & "szacunkow|fffd| kwotacj|fffd| Grupowego Ubezpieczenia na |fffd|ycie z Ubezpieczeniowym Funduszem Kapita|fffd|owym OPIEKUN VIP."
            Range("punkt_0_list").EntireRow.Offset(1).Hidden = False
        Else
            Range("punkt_0_list") = "dzi|fffd|kujemy za zainteresowanie ofert|fffd| ubezpieczenia grupowego Aviva. " _
                & "Na podstawie otrzymanych danych dotycz|fffd|cych Uczestnik|fffd|w, Aviva przedstawia " _
                & "szacunkow|fffd| kwotacj|fffd| Grupowego Ubezpieczenia na |fffd|ycie z Ubezpieczeniowym Funduszem Kapita|fffd|owym OPIEKUN VIP."
            Range("punkt_0_list").EntireRow.Offset(1).Hidden = False
        End If
    Else
        If Range("tablice!osoba_fizyczna") = True Then
            Range("punkt_0_list") = "dzi|fffd|kujemy za zainteresowanie ofert|fffd| ubezpieczenia grupowego Aviva. " _
                & "Na podstawie otrzymanych danych dotycz|fffd|cych Uczestnika, Aviva przedstawia " _
                & "szacunkow|fffd| kwotacj|fffd| Grupowego Ubezpieczenia na |fffd|ycie OPIEKUN VIP."
            Range("punkt_0_list").EntireRow.Offset(1).Hidden = True
        Else
            Range("punkt_0_list") = "dzi|fffd|kujemy za zainteresowanie ofert|fffd| ubezpieczenia grupowego Aviva. " _
                & "Na podstawie otrzymanych danych dotycz|fffd|cych Uczestnik|fffd|w, Aviva przedstawia " _
                & "szacunkow|fffd| kwotacj|fffd| Grupowego Ubezpieczenia na |fffd|ycie OPIEKUN VIP."
            Range("punkt_0_list").EntireRow.Offset(1).Hidden = True
        End If
    End If
    
    If Range("tablice!osoba_fizyczna") = True Then
        Range("punkt_1_list") = "1) Ubezpieczeniem zostanie obj|fffd|ty Uczestnik maj|fffd|cy uko|fffd|czone " _
            & Range("tablice!wiek_min") & " lat i nie uko|fffd|czone " & wiek_max & " lata."
        Range("punkt_1_list").Offset(1).Resize(7).EntireRow.Hidden = True
        Range("punkt_2_list") = "2) W odniesieniu do Uczestnika przyst|fffd|puj|fffd|cego do ubezpieczenia b|fffd|d|fffd| mia|fffd|y " _
            & "zastosowanie procedury oceny ryzyka. Ostateczny zakres i wysoko|fffd||fffd| ochrony ubezpieczeniowej " _
            & "oraz wysoko|fffd||fffd| kosztu ochrony Towarzystwo potwierdzi po zako|fffd|czeniu procesu oceny ryzyka."
    Else
        Range("punkt_1_list") = "1) Ubezpieczeniem zostan|fffd| obj|fffd|ci Uczestnicy spe|fffd|niaj|fffd|cy nast|fffd|puj|fffd|ce warunki wieku oraz zatrudnienia:"
        Range("punkt_1_list").Offset(1).Resize(7).EntireRow.Hidden = False
        Range("punkt_2_list") = "2) W odniesieniu do wszystkich Uczestnik|fffd|w przyst|fffd|puj|fffd|cych do ubezpieczenia b|fffd|d|fffd| mia|fffd|y " _
            & "zastosowanie procedury oceny ryzyka. Ostateczny zakres i wysoko|fffd||fffd| ochrony ubezpieczeniowej " _
            & "oraz wysoko|fffd||fffd| kosztu ochrony Towarzystwo potwierdzi po zako|fffd|czeniu procesu oceny ryzyka."
    End If
    
    If Range("tablice!osoba_fizyczna") = False Then
        Range("punkt_3_list") = "3) Je|fffd|li akceptuj|fffd| Pa|fffd|stwo"
    ElseIf Range("tablice!firma_plec") = 1 Then
        Range("punkt_3_list") = "3) Je|fffd|li akceptuje Pani"
    Else
        Range("punkt_3_list") = "3) Je|fffd|li akceptuje Pan"
    End If
    Range("punkt_3_list") = Range("punkt_3_list") & " niniejsze warunki, prosimy o wp|fffd|acenie pierwszej sk|fffd|adki na konto bankowe Towarzystwa:"
    
    Cells(1, 1).Select
    zablokuj "list"
End Sub

'PRZYGOTOWANIE LISTY OS|fffd|B DO ILUSTRACJI; PRZYGOTOWANIE DANYCH WEJ|fffd|CIOWYCH
Public Sub Ilustracja_uczestnicy()
    ThisWorkbook.Names("ilustracja_uczestnicy").RefersTo = Sheets("Ilustracja - ochrona").Range("T12:T" & ile + 11)
    odblokuj "Ilustracja - fundusz"
    odblokuj "Ilustracja - ochrona"
    For i = 1 To ile
        Sheets("Ilustracja - ochrona").Range("ilustracja_uczestnicy").Cells(i) = _
            i & ". " & u(i).imie & " " & u(i).nazwisko
    Next i
    
    Sheets("Ilustracja - ochrona").Range("il_freq") = Sheets("tablice").Range("freq")
    Sheets("Ilustracja - fundusz").Range("il2_freq") = Sheets("tablice").Range("freq")
'    Sheets("Ilustracja - fundusz").Range("il2_indeksacja") = Sheets("tablice").Range("czy_indeksacja")
'    Sheets("Ilustracja - fundusz").Range("il2_stopa1") = Sheets("tablice").Range("stopa1")
'    Sheets("Ilustracja - fundusz").Range("il2_stopa2") = Sheets("tablice").Range("stopa2")
    Sheets("Ilustracja - fundusz").Range("il2_dlugosc") = 40
    Sheets("Ilustracja - fundusz").Range("il2_alokacja") = Sheets("tablice").Range("alokacja")
    
    zablokuj "Ilustracja - fundusz"
    zablokuj "Ilustracja - ochrona"
End Sub

'PRZYGOTOWANIE ILUSTRACJI 1 (OCHRONA)
Public Sub Drukuj_ilustracje(uczestnik)
    Application.EnableCancelKey = xlDisabled

    Dim skala As Double
    Dim podzialy As Range
    Dim ikona As Object
    Dim ws As Worksheet
    Set ws = Sheets("Ilustracja - ochrona")     'zaczytanie arkusza do zmiennej
    Set podzialy = ws.Range("il_podzialy")      'zaczytanie zakresu z nr wierszy |fffd|wiadcze|fffd| do zmiennej

    ws.Activate
    odblokuj ws.Name
    ws.Range("il_wybrany_wniosek") = uczestnik
    Application.EnableEvents = False
    'wpisanie imienia i nazwiska uczestnika
    ws.Range("B5") = "Ubezpieczony: " & LTrim(Mid(Sheets("Kwotacja").Cells((16 + 5) * uczestnik - 10, 2), 5))
    Application.EnableEvents = True
    
    'dla wersji z ikonami poszerza kolumn|fffd| B
    If ws.Range("il_ikony") = 1 Then
        ws.Columns(2).ColumnWidth = 5
        ws.Columns(3).ColumnWidth = 3.14
    Else
        ws.Columns(2).ColumnWidth = 2.14
        ws.Columns(3).ColumnWidth = 6
    End If
    
    'resetuje wszystkie kraw|fffd|dzie poziome w tabeli
    With ws.Range(ws.Cells(Application.WorksheetFunction.Min(podzialy), 3), _
            ws.Cells(Application.WorksheetFunction.Max(podzialy), 12)).Borders(xlInsideHorizontal)
        .LineStyle = xlContinuous
        .Color = RGB(99, 102, 106)
        .Weight = xlHairline
    End With
    'usuwa kraw|fffd|dzie w kolumnie B tabeli
    ws.Range(ws.Cells(Application.WorksheetFunction.Min(podzialy), 2), _
        ws.Cells(Application.WorksheetFunction.Max(podzialy), 2)).Borders.LineStyle = xlNone
        
    'zresetowanie pozycji ikon (przeniesienie za "zas|fffd|aniacz")
    For Each ikona In ws.Shapes
        If Left(ikona.Name, 1) = "i" Then
            ikona.Top = 5
            ikona.Left = ws.Range("M1").Left + 5
        End If
    Next ikona
    
    'odkrycie aktywnych wierszy, ukrycie reszty
    For i = Application.WorksheetFunction.Min(podzialy) To Application.WorksheetFunction.Max(podzialy)
        If ws.Cells(i, 14) = 1 Then
            If ws.Rows(i).Hidden = True Then ws.Rows(i).Hidden = False
        Else
            If ws.Rows(i).Hidden = False Then ws.Rows(i).Hidden = True
        End If
    Next i
    
    If ws.Range("il_ikony") = 1 Then
        'dla wersji z ikonami - wywo|fffd|anie funkcji "pozycja" dla ka|fffd|dej ikony
        pozycja 1, "i_smierc"
        pozycja 2, "i_lapka"
        pozycja 3, "i_kalectwo"
        pozycja 4, "i_pluslozko"
        pozycja 5, "i_lozko"
        pozycja 6, "i_assistance"
    Else
        'dla wersji bez ikon - ustawienie wysoko|fffd|ci wierszy
        For i = Application.WorksheetFunction.Min(podzialy) To Application.WorksheetFunction.Max(podzialy)
            If ws.Cells(i, 14) = 1 And ws.Rows(i).RowHeight <> ws.Cells(i, 16) Then ws.Rows(i).RowHeight = ws.Cells(i, 16)
        Next i
        'dla wersji bez ikon - pogrubienie zewn|fffd|trznych kraw|fffd|dzi poziomych tabeli
        ws.Range("B" & Application.WorksheetFunction.Min(podzialy) - 1 & _
            ":L" & Application.WorksheetFunction.Min(podzialy) - 1).Select
        With Selection.Borders(xlEdgeBottom)
            .LineStyle = xlContinuous
            .Color = RGB(99, 102, 106)
            .Weight = xlMedium
        End With
        ws.Range("B" & Application.WorksheetFunction.Max(podzialy) & _
            ":L" & Application.WorksheetFunction.Max(podzialy)).Select
        With Selection.Borders(xlEdgeTop)
            .LineStyle = xlContinuous
            .Color = RGB(99, 102, 106)
            .Weight = xlMedium
        End With
    End If
    
    If Range("tablice!OWU") = "PGV/2015/1" Or Range("tablice!OWU") = "PGV/2016/1" Or Range("tablice!OWU") = "PGVF/2016/1" Then
        'dla nowego OWU (wi|fffd|cej opcji) przestawienie podzia|fffd|u strony w miejsce granicy mi|fffd|dzy kategoriami
        With ws.PageSetup
            .Zoom = False
            .FitToPagesWide = 1
            .FitToPagesTall = 2
            .PrintTitleRows = "$1:$6"
        End With
        ws.ResetAllPageBreaks
        i = podzialy.Cells(3)
        Do Until i = Application.WorksheetFunction.Max(podzialy) + 4 Or i = 1000
            If ws.Rows(i).PageBreak = xlPageBreakAutomatic Then
                Do Until Application.WorksheetFunction.CountIf(podzialy.Resize(podzialy.Count - 1), i) = 1
                    i = i - 1
                Loop
                ws.HPageBreaks.Add Before:=ws.Rows(i)
                i = 999
            End If
            i = i + 1
        Loop
    Else
        'dla starego OWU (ma|fffd|o opcji) druk na jednej stronie
        ws.ResetAllPageBreaks
        With ws.PageSetup
            .Zoom = False
            .FitToPagesWide = 1
            .FitToPagesTall = 1
            .PrintTitleRows = ""
        End With
    End If
            
    zablokuj ws.Name
    
    'je|fffd|li wygl|fffd|d przycisk|fffd|w si|fffd| zepsu|fffd|, przywraca go
    ilustracja1.odswiez_przyciski
    ws.Range("B5").Select
    
    Application.EnableCancelKey = xlInterrupt
End Sub

'USTAWIANIE IKON W ILUSTRACJI 1
Private Sub pozycja(i As Integer, obrazek As String)
    Dim podzialy As Range
    Dim ws As Worksheet
    Dim widac As Integer
    Dim gora As Integer
    Dim dol As Integer
    Set ws = Sheets("Ilustracja - ochrona")     'zaczytanie arkusza do zmiennej
    Set podzialy = ws.Range("il_podzialy")      'zaczytanie zakresu z nr wierszy |fffd|wiadcze|fffd| do zmiennej
        
    'policzenie aktywnych wierszy w dla klasy |fffd|wiadcze|fffd|
    widac = 0
    For j = podzialy.Cells(i) To podzialy.Cells(i + 1) - 1
        If ws.Cells(j, 14) <> 0 Then
            widac = widac + 1
            If ws.Rows(j).RowHeight <> ws.Cells(j, 16) Then ws.Rows(j).RowHeight = ws.Cells(j, 16)
            If widac = 1 Then gora = j
            dol = j
        End If
    Next j
    
    'ustawianie ikon, ewentualne zwi|fffd|kszanie wysoko|fffd|ci wierszy, szeroko|fffd|ci linii dla pe|fffd|nych klas |fffd|wiadcze|fffd|
    If widac > 0 Then
        ws.Shapes(obrazek).ScaleHeight 0.33, msoTrue
        If ws.Range(ws.Cells(gora, 2), ws.Cells(dol, 2)).Height < ws.Shapes(obrazek).Height + 3 Then
            For k = gora To dol
                If ws.Cells(k, 14) <> 0 Then
                    If ws.Rows(k).RowHeight < (ws.Shapes(obrazek).Height + 3) / widac Then _
                            ws.Rows(k).RowHeight = (ws.Shapes(obrazek).Height + 3) / widac
                End If
            Next k
        End If
        ws.Shapes(obrazek).Top = ws.Cells(gora, 1).Top + ws.Range(ws.Cells(gora, 1), ws.Cells(dol, 1)) _
                    .Height / 2 - ws.Shapes(obrazek).Height / 2
        ws.Shapes(obrazek).Left = ws.Range("B1").Left
        ws.Range(ws.Cells(gora, 2), ws.Cells(dol, 12)).Select
        With Selection.Borders(xlEdgeTop)
            .LineStyle = xlContinuous
            .Color = RGB(99, 102, 106)
            .Weight = xlMedium
        End With
        With Selection.Borders(xlEdgeBottom)
            .LineStyle = xlContinuous
            .Color = RGB(99, 102, 106)
            .Weight = xlMedium
        End With
    End If
End Sub

'PRZYGOTOWANIE ILUSTRACJI 2 (FUNDUSZ) - pokazywanie / chowanie wierszy
Sub Drukuj_Ilustracje2()
    Dim ws As Worksheet
    Set ws = Sheets("Ilustracja - fundusz")
    odblokuj ws.Name
    For i = 23 To 33
        If ws.Cells(i, 3) > ws.Range("il2_dlugosc") Then
            If ws.Rows(i).Hidden = False Then ws.Rows(i).Hidden = True
        Else
            If ws.Rows(i).Hidden = True Then ws.Rows(i).Hidden = False
        End If
    Next i
    If ws.Range("il2_indeksacja") = 1 Then
        If ws.Range("10:11").EntireRow.Hidden = True Then ws.Range("10:11").EntireRow.Hidden = False
    Else
        If ws.Range("10:11").EntireRow.Hidden = False Then ws.Range("10:11").EntireRow.Hidden = True
    End If
    zablokuj ws.Name
    If Range("tablice!czy_renta") Then
        If ws.Range("16:17,36:36").EntireRow.Hidden = True Then ws.Range("16:17,36:36").EntireRow.Hidden = False
    Else
        If ws.Range("16:17,36:36").EntireRow.Hidden = False Then ws.Range("16:17,36:36").EntireRow.Hidden = True
    End If
    zablokuj ws.Name
End Sub

' FUNDUSZ - funkcja w arkuszu
Function fundusz_func(alloc, premium, oplata, czest, stopa, indfla, rok)
    sumuj = 0
    frag = 0
    For i = 1 To rok
        frag = alloc * ((1 + stopa) ^ (rok - i)) * Application.Max(1, indfla * ((1 + stopa) / 1.03) ^ (i - 1))
        sumuj = sumuj + frag
    Next i
    fundusz_func = ((premium - (oplata / czest)) * (stopa * (1 + stopa) ^ (1 / czest)) / ((1 + stopa) ^ (1 / czest) - 1)) * sumuj
End Function

' SUMA WP|fffd|AT - funkcja w arkuszu
Function suma_wplat(skladka, czest, stopa, indflag, rok)
    sumuj = 0
    frag = 0
    For i = 1 To rok
        frag = Application.Max(1, indflag * ((1 + stopa) / 1.03) ^ (i - 1))
        sumuj = sumuj + frag
    Next i
    suma_wplat = czest * skladka * sumuj
End Function

' RENTA - funkcja w arkuszu
Function renta(spec, wiek, plec, fundusz, wyswietl_blad)
    Dim tablica(1 To 29) As Single
    
    tablica(1) = 6.27:  tablica(2) = 6.38:  tablica(3) = 6.49:  tablica(4) = 6.61
    tablica(5) = 6.73:  tablica(6) = 6.86:  tablica(7) = 6.99:  tablica(8) = 7.13
    tablica(9) = 7.27:  tablica(10) = 7.41: tablica(11) = 7.56: tablica(12) = 7.71
    tablica(13) = 7.86: tablica(14) = 8.02: tablica(15) = 8.17: tablica(16) = 8.33
    tablica(17) = 8.48: tablica(18) = 8.64: tablica(19) = 8.79: tablica(20) = 8.94
    tablica(21) = 9.09: tablica(22) = 9.23: tablica(23) = 9.37: tablica(24) = 9.5
    tablica(25) = 9.62: tablica(26) = 9.74: tablica(27) = 9.85: tablica(28) = 9.95
    tablica(29) = 10.04

    anntmax = Application.Min(50, 70 - wiek)
    
    If (spec + wiek) >= 55 Then
        F2 = wiek
        If plec = 2 Then ager = F2 Else ager = F2 '- 3
        indeks = tablica(ager + spec - 52 + 1)
        If anntmax >= spec Then renta = CLng(fundusz * Application.Max(0, indeks) / 1000) Else renta = ""
    Else
        If wyswietl_blad = True Then MsgBox "Minimalny wiek zawarcia umowy o rent|fffd|" & vbLf & "dla kobiet 55 lat" & vbLf & "dla m|fffd|czyzn 60 lat"
        renta = ""
    End If
End Function


Attribute VB_Name = "MENU"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "menu_naglowkowe, 148, 0, MSForms, CommandButton"
Attribute VB_Control = "menu_uczestnicy, 149, 1, MSForms, CommandButton"
Attribute VB_Control = "menu_przelicz, 150, 2, MSForms, CommandButton"
Attribute VB_Control = "menu_wydruki, 151, 3, MSForms, CommandButton"
Attribute VB_Control = "menu_wyczysc, 152, 4, MSForms, CommandButton"
Attribute VB_Control = "menu_nowa, 169, 5, MSForms, OptionButton"
Attribute VB_Control = "menu_dolaczenie, 170, 6, MSForms, OptionButton"
Attribute VB_Control = "menu_zaslaniacz, 177, 7, MSForms, Label"
Attribute VB_Control = "menu_prowizja, 178, 8, MSForms, CommandButton"
Attribute VB_Control = "menu_zaslaniacz_2, 186, 9, MSForms, Label"
'ustawienie domy|fffd|lnej wersji OWU; zablokowanie p|fffd|l "do|fffd||fffd|czeniowych"
Private Sub menu_nowa_Click()
    Sheets("tablice").Range("czy_dolaczajacy") = False
    odblokuj "MENU"
    Range("F13") = ""
    Range("F15") = Sheets("params").Range("OWU_lista").Cells( _
            Sheets("params").Range("OWU_lista").Rows.Count, 2)
    Range("F13,F15").Select
    Selection.Locked = True
    Range("C13").Select
    menu_zaslaniacz.Visible = True
    menu_zaslaniacz.ForeColor = RGB(255, 217, 0)
    menu_zaslaniacz_2.Height = 12
    zablokuj "MENU"
    Sheets("Tablice").Range("alokacja") = 100
    Sheets("Tablice").Range("alokacja_lok") = 97
    Sheets("tablice").Range("adm_ch") = 72
End Sub

'odblokowanie p|fffd|l "do|fffd||fffd|czeniowych"
Private Sub menu_dolaczenie_Click()
    Sheets("tablice").Range("czy_dolaczajacy") = True
    odblokuj "MENU"
    Range("F13,F15").Select
    Selection.Locked = False
    Application.EnableEvents = False
    Range("F15") = ""
    Application.EnableEvents = True
    Sheets("tablice").Range("OWU") = ""
    Range("C13").Select
    menu_zaslaniacz.ForeColor = RGB(255, 217, 0)
    menu_zaslaniacz.Visible = False
    menu_zaslaniacz_2.Height = 12
    zablokuj "MENU"
End Sub

Private Sub menu_naglowkowe_Click()
    headers.Show
End Sub

Private Sub menu_prowizja_Click()
    prowizja.Show
End Sub

Private Sub menu_uczestnicy_Click()
    Sheets("uczestnicy").Activate
End Sub

Private Sub menu_przelicz_Click()
    If Sheets("tablice").Range("czy_dolaczajacy") And _
        (Sheets("tablice").Range("nr_polisy") = "" Or Sheets("tablice").Range("OWU") = "") Then
        MsgBox "Aby przeliczy|fffd| kwotacj|fffd| dla os|fffd|b do|fffd||fffd|czaj|fffd|cych, nale|fffd|y wpisa|fffd| numer polisy i wybra|fffd| aktualne OWU.", vbExclamation, "Uwaga"
        Range("F13").Select
        Exit Sub
    End If
    Sheets("Uczestnicy").Activate
    Licz
End Sub

Private Sub menu_wydruki_Click()
    If Len(Sheets("Kwotacja").Cells(11, 2)) = 0 Then
        Beep
        ok = MsgBox("Kwotacja nie zosta|fffd|a wykonana - opcje wydruk|fffd|w s|fffd| niedost|fffd|pne.", _
            vbOKOnly + vbExclamation, "Kontrola poprawno|fffd|ci danych")
        Exit Sub
    End If
    wydruki.Show
End Sub

'czyszczenie danych w arkuszu, przywr|fffd|cenie danych domy|fffd|lnych
Private Sub menu_wyczysc_Click()
    Application.EnableCancelKey = xlDisabled
    Sheets("Tablice").Range("cokk") = False
    Sheets("Tablice").Range("alokacja") = 100
    Sheets("Tablice").Range("alokacja_lok") = 97
    Sheets("tablice").Range("adm_ch") = 72
    Sheets("Tablice").Range("comm_ws") = 20
    Sheets("Tablice").Range("nadprowizja") = True
    CzyscUczestnicy
    CzyscKwotacja
    CzyscListIlustracja
    
    'czyszczenie danych agenta jako opcja
    ok = MsgBox("Czy wyczy|fffd|ci|fffd| tak|fffd|e dane dotycz|fffd|ce agenta?", vbYesNo)
    If ok = vbNo Then
        CzyscDaneFirmyAgenta False
    Else
        CzyscDaneFirmyAgenta
    End If
    
    odblokuj_app
    If Sheets("PIDUU").Visible = True Then Sheets("PIDUU").Visible = False
    If Sheets("Deklaracja").Visible = True Then Sheets("Deklaracja").Visible = False
    If Sheets("Wype|fffd|nianie ankiety").Visible = True Then Sheets("Wype|fffd|nianie ankiety").Visible = False
    If Sheets("Wype|fffd|nianie deklaracji").Visible = True Then Sheets("Wype|fffd|nianie deklaracji").Visible = False
    Sheets("dane_ankiet").Range("dane_1").ClearContents
    Sheets("dane_ankiet").Range("dane_2").ClearContents
    Sheets("dane_ankiet").Range("dane_3").ClearContents
    Sheets("dane_ankiet").Range("dane_4").ClearContents
    
    Sheets("menu").Activate
    menu_dolaczenie.Value = True
    menu_nowa.Value = True
    Sheets("menu").Range("C13") = ""
    Sheets("menu").Range("C15") = "miesi|fffd|czna"
    zablokuj_app
    Application.EnableCancelKey = xlInterrupt
End Sub

'wpisanie odpowiednich danych do tablic przy zmianie odpowiedniego pola
Private Sub Worksheet_Change(ByVal Target As Range)
    Application.EnableEvents = False
    If Not Intersect(Target, Range("C13")) Is Nothing Then
        Sheets("tablice").Range("nr_kwotacji") = Target
    End If
    If Not Intersect(Target, Range("C15")) Is Nothing Then
        If Target = "roczna" Then
            Sheets("tablice").Range("freq") = 1
        ElseIf Target = "p|fffd|roczna" Then
            Sheets("tablice").Range("freq") = 2
        ElseIf Target = "kwartalna" Then
            Sheets("tablice").Range("freq") = 4
        ElseIf Target = "miesi|fffd|czna" Then
            Sheets("tablice").Range("freq") = 12
        Else
            Sheets("tablice").Range("freq") = 12
            Target = "miesi|fffd|czna"
        End If
    End If
    If Not Intersect(Target, Range("F15")) Is Nothing Then
        If Len(Range("F13")) > 0 Then
            If Target = "PGV/2016/1" And Sheets("tablice").Range("czy_fundusz") Then Target = "PGVF/2016/1"
            If Target = "PGV/2016/1" Or Target = "PGVF/2016/1" Then
                Sheets("Tablice").Range("alokacja") = 100
                Sheets("Tablice").Range("adm_ch") = 72
            Else
                Target = Sheets("tablice").Range("OWU")
            End If

        Else
            'Target = ""
        End If
        Sheets("tablice").Range("OWU") = Target
    End If
    If Not Intersect(Target, Range("F13")) Is Nothing Then
        If Len(Target) = 0 Then
            Sheets("tablice").Range("nr_polisy") = ""
        Else
            Dim poz&
            On Error Resume Next
            poz = Application.WorksheetFunction.Match(Target, Sheets("polisy").Range("A:A"), 0)
            On Error GoTo 0
            If Err.Number = 1004 Then poz = 0
            If poz > 0 Then
                Sheets("tablice").Range("nr_polisy") = Target
                Sheets("tablice").Range("czy_fundusz") = CBool(Sheets("polisy").Cells(poz, 2))
                Sheets("tablice").Range("freq") = Sheets("polisy").Cells(poz, 3)
                If Sheets("polisy").Cells(poz, 3) = 12 Then
                    Range("C15") = "miesi|fffd|czna"
                ElseIf Sheets("polisy").Cells(poz, 3) = 4 Then
                    Range("C15") = "kwartalna"
                ElseIf Sheets("polisy").Cells(poz, 3) = 2 Then
                    Range("C15") = "p|fffd|roczna"
                Else
                    Range("C15") = "roczna"
                End If
                Sheets("tablice").Range("OWU") = Sheets("polisy").Cells(poz, 4)
                Range("F15") = Sheets("polisy").Cells(poz, 4)
                If Sheets("tablice").Range("OWU") = "PGV/2016/1" Or Sheets("tablice").Range("OWU") = "PGVF/2016/1" Then
                    Sheets("tablice").Range("adm_ch") = 72
                Else
                    Sheets("tablice").Range("adm_ch") = 36
                End If
                Sheets("tablice").Range("alokacja") = Sheets("polisy").Cells(poz, 5) * 100
                Sheets("tablice").Range("alokacja_lok") = Sheets("polisy").Cells(poz, 6) * 100
                
            Else
                MsgBox "Brak aktywnej polisy Opiekun VIP o takim numerze."
                Target = Sheets("tablice").Range("nr_polisy")
            End If
        End If
    End If
    Application.EnableEvents = True
End Sub
Attribute VB_Name = "PIDUU"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True



Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_BeforePrint(Cancel As Boolean)
     
     If ActiveSheet.Name = "Deklaracja" Then
        If Sheets("Deklaracja").Range("N1") = "DEKLARACJA: OK" & Chr(10) & "ANKIETA: OK" Then
            'nic
        Else
            MsgBox "Braki w deklaracji - nie mo|fffd|na wydrukowa|fffd|"
            Cancel = True
        End If
     End If

End Sub
Attribute VB_Name = "definicje"
Option Private Module

'|fffd|WIADCZENIA - DEFINICJE
Public Sub ustaw_swiadczenia()
Attribute ustaw_swiadczenia.VB_ProcData.VB_Invoke_Func = " \n14"
    s(1).nazwa = "|fffd|mier|fffd| ubezpieczonego"
    s(2).nazwa = "|fffd|mier|fffd| wskutek NW"
    s(3).nazwa = "Kalectwo wskutek NW"
    s(4).nazwa = "Trwa|fffd|y uszczerbek na zdrowiu wskutek NW"
    s(5).nazwa = "Trwa|fffd|y uszczerbek na zdrowiu wskutek NW w systemie |fffd|wiadcze|fffd| progresywnych"
    s(6).nazwa = "Niezdolno|fffd||fffd| do pracy wskutek NW"
    s(7).nazwa = "Niezdolno|fffd||fffd| do pracy"
    s(8).nazwa = "Powa|fffd|ne zachorowanie - 6 jednostek chorobowych"
    s(9).nazwa = "Powa|fffd|ne zachorowanie - 11 jednostek chorobowych"
    s(10).nazwa = "Powa|fffd|ne zachorowanie - 20 jednostek chorobowych"
    s(11).nazwa = "Leczenie szpitalne"
    s(12).nazwa = "Leczenie szpitalne w systemie |fffd|wiadcze|fffd| progresywnych"
    s(13).nazwa = "Zdrowe |fffd|ycie - wariant II"
    s(14).nazwa = "Zdrowe |fffd|ycie - |fffd|wiadczenie lekowe"
    s(15).nazwa = "Powa|fffd|ne zachorowanie - 46 jednostek chorobowych"
    s(16).nazwa = "Assistance - wariant II"
    
    'qxy
    If Sheets("tablice").Range("taryfa_GN") = 1 Then 'nowa taryfa GN
        For i = 1 To 2
            For j = 1 To 70
                For k = 1 To 16
                    s(k).taryfa(i, j) = Sheets("qx_GN").Cells(4 + j, 2 * k + i)
                Next k
            Next j
        Next i
    Else 'stara taryfa
        For i = 1 To 2
            For j = 1 To 70
                For k = 1 To 13
                    s(k).taryfa(i, j) = Sheets("qx_old").Cells(4 + j, 2 * k + i)
                Next k
            Next j
        Next i
    End If
    
    'SU_min i SU_max
    For i = 1 To 16
        For j = 1 To 2
            s(i).SU_max(j) = Range("SU_max").Cells(i, j)
        Next j
        For j = 1 To 3
            s(i).SU_min(j) = Range("SU_min").Cells(i, j)
        Next j
    Next i
    
    'load_occ
    For i = 1 To 16
        For j = 1 To 5
            s(i).load_occ(j) = Range("load_occ").Cells(j, i)
        Next j
    Next i
    
    'koszty_adm
    s(1).koszty_adm = Sheets("tablice").Range("koszty_adm")
    s(1).koszty_uw = Sheets("tablice").Range("koszty_uw")
    For i = 2 To 16
        s(i).koszty_adm = 0
        s(i).koszty_uw = 0
    Next i
    ile = Sheets("tablice").Range("ilu_uczestnikow")
    total_risk_prem = 0
    total_invest_prem = 0
    freq = Sheets("tablice").Range("freq")
    
    If Sheets("tablice").Range("czy_import") Then
        'data liczenia do wpisania
        odp = InputBox("Data liczenia w formacie RRRR-MM-DD (minimalna data to " & Format(Range("tablice!min_data_liczenia"), "yyyy-mm-dd") & "):", "Wprowad|fffd| dat|fffd| liczenia", Format(Range("tablice!data_liczenia"), "yyyy-mm-dd"))
        If IsDate(odp) And DateDiff("d", Sheets("tablice").Range("min_data_liczenia"), odp) >= 0 Then
            Sheets("tablice").Range("data_liczenia") = Format(odp, "yyyy-mm-dd")
        ElseIf IsDate(odp) Then
            MsgBox "Data jest ni|fffd|sza od minimalnej"
            Sheets("tablice").Range("blad") = True
        ElseIf odp = "" Then
            Sheets("tablice").Range("blad") = True
        Else
            MsgBox "Wpisano niew|fffd|a|fffd|ciwy format daty"
            Sheets("tablice").Range("blad") = True
        End If
    Else
        'data liczenia dzi|fffd| + 14 dni
        Sheets("tablice").Range("data_liczenia") = Format(Now() + 14, "yyyy-mm-dd")
    End If

End Sub
Attribute VB_Name = "deklaracje"
Type swiadczenie
    nazwa As String                     'nazwa |fffd|wiadczenia
    SU_min(1 To 3) As Double            'sumy minimalna
    SU_max(1 To 2) As Double            'suma maksymalna
    taryfa(1 To 2, 1 To 70) As Double   'taryfy qx'|fffd|w(p|fffd|e|fffd|/wiek)
    load_occ(1 To 5) As Double          'loading zawodowy(grupa ryzyka)
    SU As Double                        'suma ubezpieczenia
    koszty_adm As Double
    koszty_uw As Double
End Type

Type uczestnik
    nazwisko As String                  'nazwisko uczestnika
    imie As String                      'imi|fffd| uczestnika
    data_ur As Date                     'data urodzenia
    ryzyko As Byte                      'grupa ryzyka
    plec As Byte                        'p|fffd|e|fffd|
    invest_prem As Double               'wymagalno|fffd|ciowa sk|fffd|adka inwestycyjna
    s_akt(1 To 16) As Boolean           'aktywno|fffd||fffd| |fffd|wiadczenia dla uczestnika
    SU(1 To 16) As Double               '|fffd|wiadczenia
    
    disc(1 To 16) As Double             'disc
    load_pc(1 To 16) As Double          'load pc
    load_const(1 To 16) As Double       'load const
    load_wiek(1 To 16) As Double        'load wiek
    load_med_pc(1 To 16) As Double      'load medyczny pc
    load_med_const(1 To 16) As Double   'load medyczny const
    
    med_mod(1 To 16) As Double          'MedModQX (narzuty medyczne)
    stopa_netto(1 To 16) As Double      'stopa netto
    stopa_netto_disc(1 To 16) As Double 'stopa netto z disc
    stopa_brutto(1 To 16) As Double     'stopa brutto
    skladka_brutto(1 To 16) As Double   'sk|fffd|adka brutto
    
'    gross_prem(1 To 16) As Double       'roczna sk|fffd|adka brutto za g
    risk_prem As Double                 'wymagalno|fffd|ciowa sk|fffd|adka ochronna
End Type

Public u() As uczestnik                 'uczestnicy
Public s(1 To 16) As swiadczenie        'swiadczenia
Public nr As Integer                    'kolejny nr uczestnika
Public ile As Long                      'ilu uczestnik|fffd|w

'parametry ubezpieczenia
Public freq As Byte                     'cz|fffd|stotliwo|fffd||fffd| sk|fffd|adki
Public freq_disc As Byte
Public comm_exp As Double               'comm exp
Public nr_kwotacji As String            'nr kwotacji

Public total_prem As Double             'ca|fffd|kowita sk|fffd|adka dla grupy
Public total_risk_prem As Double        'ca|fffd|kowita sk|fffd|adka ochronna dla grupy
Public total_invest_prem As Double      'ca|fffd|kowita sk|fffd|adka inwestycyjna dla grupy
Attribute VB_Name = "dopasowanie"
Attribute VB_Base = "0{ACB9B817-8C93-494A-A84A-20263E7CD1FA}{50E98111-7543-46EC-A190-AC6E586D4EDB}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim stopa(1 To 16) As Double
Dim adm As Double
Dim suma(1 To 16) As Double

Private Sub ustaw_zmienne(nr_u)
    ustaw_swiadczenia
    If UCase(Sheets("uczestnicy").Cells(nr_u + 4, 4)) = "K" Then
            plec = 1
        Else
            plec = 2
        End If
    wiek = ObliczWiek(Sheets("uczestnicy").Cells(nr_u + 4, 5), Sheets("tablice").Range("data_liczenia"))
    ryzyko = Sheets("uczestnicy").Cells(nr_u + 4, 6)
    For i = 1 To 16
        stopa(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).taryfa(plec, wiek) * (1 + s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).load_occ(ryzyko))
    Next i
    adm = Round((s(1).koszty_adm + s(1).koszty_uw) / (1 - Sheets("tablice").Range("comm_ws") * 1.3 / 100) / freq, 2)
End Sub

Private Sub sumy_do_zmiennych()
    For Each pole In Me.Controls
        For i = 1 To 16
            If pole.Name = "su_" & i Then suma(i) = pole.Caption
        Next i
    Next pole
End Sub

Private Sub sumy_do_formularza()
    For Each pole In Me.Controls
        For i = 1 To 16
            If pole.Name = "su_" & i Then pole.Caption = suma(i)
        Next i
    Next pole
End Sub

Function x_skladka()
    stopa_x_SU = 0
    For i = 1 To 16
        stopa_x_SU = stopa_x_SU + stopa(i) * suma(i)
    Next i

    x_skladka = Round((stopa_x_SU / 1000) / (1 - comm_exp) / freq, 2) + adm
End Function

Private Sub UserForm_Activate()
    
    nr_u = Selection.Row - 4
    
    naglowek.Caption = "Obecnie dopasowujesz sumy ubezpieczenia do wysoko|fffd|ci sk|fffd|adki ochronnej dla osoby nr " & nr_u

    For Each pole In Me.Controls
        For i = 1 To 16
            If pole.Name = "su_" & i Then
                suma(i) = Sheets("uczestnicy").Cells(nr_u + 4, 6 + i)
                If Len(suma(i)) = 0 _
                    Or Sheets("uczestnicy").Cells(2, 6 + i) = 0 Then suma(i) = 0
                pole.Caption = suma(i)
            End If
        Next i
    Next pole
    ustaw_zmienne (nr_u)
    
    j = 0
    For i = 1 To 16
        If suma(i) = 0 Then
            For Each pole In Me.Controls
                If pole.Name = "s_" & i Then
                    pole.Top = 174
                    pole.Left = 154.5
                    pole.Visible = False
                End If
                If pole.Name = "su_" & i Then
                    pole.Top = 180
                    pole.Left = 264
                    pole.Visible = False
                End If
            Next pole
        Else
            j = j + 1
            For Each pole In Me.Controls
                If pole.Name = "s_" & i Then
                    pole.Visible = True
                    If j <= 8 Then
                        pole.Top = 24 * j - 18
                        pole.Left = 4.5
                    Else
                        pole.Top = 24 * (j - 8) - 18
                        pole.Left = 154.5
                    End If
                End If
                If pole.Name = "su_" & i Then
                    pole.Visible = True
                    If j <= 8 Then
                        pole.Top = 24 * j - 11.25
                        pole.Left = 108
                    Else
                        pole.Top = 24 * (j - 8) - 11.25
                        pole.Left = 264
                    End If
                End If
            Next pole
        End If
    Next i
    
    skladka_dopas.Caption = "Dopasowana sk|fffd|adka ochronna: " & x_skladka & "z|fffd|"
    
    opcja1.Value = True

End Sub

Private Sub opcja1_Click()
    s_1.Value = True
    s_1.Value = False
    For Each pole In Me.Controls
        For i = 1 To 16
            If pole.Name = "s_" & i Then pole.Locked = True
        Next i
    Next pole
End Sub

Private Sub opcja2_Click()
    For Each pole In Me.Controls
        For i = 1 To 16
            If pole.Name = "s_" & i Then pole.Locked = False
        Next i
    Next pole
    s_1.Value = True
End Sub

Private Sub przelicz_Click()
    If Not IsNumeric(skladka.Value) Then
        skladka.Value = x_skladka
        Exit Sub
    End If

    sumy_do_zmiennych
    
    j = 0
    If opcja1.Value = True Then 'proporcjonalnie
        Do
            procent = (skladka.Value - adm) / (x_skladka - adm)
            For i = 1 To 16
                If suma(i) > 0 Then
                    suma(i) = Round(suma(i) * procent, 0)
                    If suma(i) - s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(1 + Range("params!tryb")) < 0 Then suma(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(1 + Range("params!tryb"))
                    If suma(i) - s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(3) * suma(1) < 0 Then suma(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(3) * suma(1)
                    If suma(i) - s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_max(1) > 0 Then suma(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_max(1)
                End If
            Next i
            j = j + 1
        Loop Until Abs(skladka.Value - x_skladka) < 0.01 Or j = 10
    Else 'jedna opcja
        For Each pole In Me.Controls
            If Left(pole.Name, 2) = "s_" Then
                If pole.Value = True Then i = Mid(pole.Name, 3)
            End If
        Next pole
        suma(i) = Round(suma(i) * (1 - (x_skladka - skladka.Value) / Round(stopa(i) * suma(i) / 1000 / (1 - comm_exp) / freq, 2)), 0)
        If suma(i) - s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(1 + Range("params!tryb")) < 0 Then suma(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(1 + Range("params!tryb"))
        If suma(i) - s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_max(1) > 0 Then suma(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_max(1)
        If i = 1 Then
            For j = 2 To 16
                If suma(j) > 0 Then
                    If suma(1) - suma(j) < 0 Then suma(1) = suma(j)
                    If suma(1) * s(Sheets("uczestnicy").Cells(3, 16 + 8 + j)).SU_min(3) - suma(j) > 0 Then suma(1) = suma(j) / s(Sheets("uczestnicy").Cells(3, 16 + 8 + j)).SU_min(3)
                End If
            Next j
        Else
            If suma(i) - s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(3) * suma(1) < 0 Then suma(i) = s(Sheets("uczestnicy").Cells(3, 16 + 8 + i)).SU_min(3) * suma(1)
            If suma(i) - suma(1) > 0 Then suma(i) = suma(1)
        End If
    End If
    
    sumy_do_formularza
    skladka_dopas.Caption = "Dopasowana sk|fffd|adka ochronna: " & x_skladka & "z|fffd|"
    
End Sub

Private Sub zapisz_Click()
    sumy_do_zmiennych
    For i = 1 To 16
        If suma(i) > 0 Then
            Sheets("uczestnicy").Cells(Selection.Row, 6 + i) = suma(i)
        End If
    Next i
    dopasowanie.Hide
End Sub

Private Sub anuluj_Click()
    dopasowanie.Hide
End Sub
Attribute VB_Name = "headers"
Attribute VB_Base = "0{06DB370D-1D63-411D-9A14-CDB28CC12213}{8065D472-035D-4A6C-AD3F-8D63A77F45FA}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub fizyczna_Click()
    firma_nazwisko.Value = ""
    firma_nazwisko.Enabled = False
    label_nazwisko.Enabled = False
    firma_stanowisko.Value = ""
    firma_stanowisko.Enabled = False
    label_stanowisko.Enabled = False
    label_nazwa.Caption = "Imi|fffd| i nazwisko"
    frame_osoba.Caption = ""
End Sub

Private Sub firma_plec_f_Click()
    firma_nazwisko.Enabled = True
    label_nazwisko.Enabled = True
    firma_stanowisko.Enabled = True
    label_stanowisko.Enabled = True
    label_nazwa.Caption = "Nazwa"
    frame_osoba.Caption = "Dane osoby reprezentuj|fffd|cej firm|fffd|"
End Sub

'START - POBRANIE WARTO|fffd|CI Z TABLIC
Private Sub UserForm_Activate()
    If Range("tablice!firma_plec") = 1 Then firma_plec_k.Value = True
    If Range("tablice!firma_plec") = 2 Then firma_plec_m.Value = True
    If Sheets("tablice").Range("osoba_fizyczna") Then
        fizyczna.Value = True
    Else
        firma_plec_f.Value = True
    End If
    firma_nazwisko.Value = Sheets("tablice").Range("firma_nazwisko")
    firma_stanowisko.Value = Sheets("tablice").Range("firma_stanowisko")
    firma_nazwa.Value = Sheets("tablice").Range("firma_nazwa")
    firma_adres.Value = Sheets("tablice").Range("firma_adres")
    firma_miasto.Value = Sheets("tablice").Range("firma_miasto")
    nazwa_grupy.Value = Sheets("tablice").Range("nazwa_grupy")
    agent_nazwisko.Value = Sheets("tablice").Range("agent_nazwisko")
    agent_stanowisko.Value = Sheets("tablice").Range("agent_stanowisko")
    agent_numer.Value = Sheets("tablice").Range("agent_numer")
    If Range("tablice!agent_plec") = 1 Then agent_plec_k.Value = True
    If Range("tablice!agent_plec") = 2 Then agent_plec_m.Value = True
    agent_cc.Value = Sheets("tablice").Range("agent_cc")
    agent_cc_stanowisko.Value = Sheets("tablice").Range("agent_cc_stanowisko")
    agent_miasto.Value = Sheets("tablice").Range("agent_miasto")
End Sub

'ZAPISANIE WARTO|fffd|CI DO TABLIC
Private Sub naglowkowe_ok_Click()
    'DANE FIRMY
    If firma_plec_k.Value = True Then Sheets("tablice").Range("firma_plec") = 1
    If firma_plec_m.Value = True Then Sheets("tablice").Range("firma_plec") = 2
    Sheets("tablice").Range("osoba_fizyczna") = fizyczna.Value
    Sheets("tablice").Range("firma_nazwisko") = firma_nazwisko.Value
    Sheets("tablice").Range("firma_stanowisko") = firma_stanowisko.Value
    Sheets("tablice").Range("firma_nazwa") = firma_nazwa.Value
    Sheets("tablice").Range("firma_adres") = firma_adres.Value
    Sheets("tablice").Range("firma_miasto") = firma_miasto.Value
    Sheets("tablice").Range("nazwa_grupy") = nazwa_grupy.Value
    
    'DANE AGENTA
    Sheets("tablice").Range("agent_numer") = agent_numer.Value
    Sheets("tablice").Range("agent_nazwisko") = agent_nazwisko.Value
    Sheets("tablice").Range("agent_stanowisko") = agent_stanowisko.Value
    If agent_plec_k.Value = True Then Sheets("tablice").Range("agent_plec") = 1
    If agent_plec_m.Value = True Then Sheets("tablice").Range("agent_plec") = 2
    Sheets("tablice").Range("agent_cc") = agent_cc.Value
    Sheets("tablice").Range("agent_cc_stanowisko") = agent_cc_stanowisko.Value
    
    'MIASTO W NAG|fffd||fffd|WKU
    Sheets("tablice").Range("agent_miasto") = agent_miasto.Value
    
    Me.Hide
End Sub

'CZYSZCZENIE DANYCH FIRMY Z TABLIC
Private Sub naglowkowe_wyczysc_Click()
    Me.Hide
    CzyscDaneFirmyAgenta False
    Me.Show
End Sub
Attribute VB_Name = "ilustracja1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "option_hcb, 2, 0, MSForms, CheckBox"
Attribute VB_Control = "option_as2, 118, 1, MSForms, CheckBox"
Attribute VB_Control = "option_ikony, 1, 2, MSForms, CheckBox"
Attribute VB_Control = "option_pz, 119, 3, MSForms, CheckBox"
Attribute VB_Control = "odswiez, 3, 4, MSForms, CommandButton"
Private Sub Worksheet_Activate()
    'ustawienie warto|fffd|ci p|fffd|l wyboru
    Application.EnableEvents = False
    option_ikony.Value = CBool(Range("il_ikony"))
    option_pz.Value = CBool(Range("il_rozw_pz"))
    option_hcb.Value = CBool(Range("il_rozw_hb"))
    If Sheets("tablice").Range("OWU") = "PGV/2015/1" Or Sheets("tablice").Range("OWU") = "PGV/2016/1" Or Sheets("tablice").Range("OWU") = "PGVF/2016/1" Then
        odblokuj Me.Name
        option_as2.Visible = True
        zablokuj Me.Name
        option_as2.Value = CBool(Range("il_rozw_as2"))
    Else
        odblokuj Me.Name
        option_as2.Visible = False
        zablokuj Me.Name
    End If
    Application.EnableEvents = True
    
    odswiez_przyciski
End Sub

'przy zmianie osoby w kom|fffd|rce B5 uruchomienie funkcji ustawiaj|fffd|cej ilustracj|fffd|
Private Sub Worksheet_Change(ByVal Target As Range)
    If Intersect(Target, Range("B5")) Is Nothing Then Exit Sub
    osoba = Val(Range("B5"))
    If osoba > 0 Then Drukuj_ilustracje osoba
End Sub

Private Sub odswiez_Click()
    If Len(Sheets("Kwotacja").Cells(11, 2)) = 0 Then Exit Sub
    Drukuj_ilustracje Range("il_wybrany_wniosek")
End Sub

Private Sub option_ikony_Click()
    odblokuj Me.Name
    If option_ikony.Value = True Then
        Range("il_ikony") = 1
    Else
        Range("il_ikony") = 0
    End If
    zablokuj Me.Name
End Sub

Private Sub option_pz_Click()
    odblokuj Me.Name
    If option_pz.Value = True Then
        Range("il_rozw_pz") = 1
    Else
        Range("il_rozw_pz") = 0
    End If
    zablokuj Me.Name
End Sub

Private Sub option_hcb_Click()
    odblokuj Me.Name
    If option_hcb.Value = True Then
        Range("il_rozw_hb") = 1
    Else
        Range("il_rozw_hb") = 0
    End If
    zablokuj Me.Name
End Sub

Private Sub option_as2_Click()
    odblokuj Me.Name
    If option_as2.Value = True Then
        Range("il_rozw_as2") = 1
    Else
        Range("il_rozw_as2") = 0
    End If
    zablokuj Me.Name
End Sub

'przywr|fffd|cenie dobrego rozmiaru p|fffd|l wyboru i przycisku
Sub odswiez_przyciski()
    odblokuj Me.Name
    With Shapes("odswiez")
        .Height = 9
        .Height = 36
        .Left = Range("M1").Left + 111
        .Top = 6
        .Width = 36
    End With
    With Shapes("option_ikony")
        .Height = 9
        .Height = 16.5
        .Left = Range("M1").Left + 5
        .Top = 24
        .Width = 102
    End With
    With Shapes("option_pz")
        .Height = 9
        .Height = 28.5
        .Left = Range("M1").Left + 5
        .Top = 45
        .Width = 153
    End With
    With Shapes("option_hcb")
        .Height = 9
        .Height = 28.5
        .Left = Range("M1").Left + 5
        .Top = 78
        .Width = 153
    End With
    If Sheets("tablice").Range("OWU") = "PGV/2015/1" Or Sheets("tablice").Range("OWU") = "PGV/2016/1" Or Sheets("tablice").Range("OWU") = "PGVF/2016/1" Then
        With Shapes("option_as2")
            .Height = 9
            .Height = 28.5
            .Left = Range("M1").Left + 5
            .Top = 111
            .Width = 153
        End With
    End If
    zablokuj Me.Name
End Sub
Attribute VB_Name = "ilustracja2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'przy zmianie osoby w kom|fffd|rce B5
'wpisanie numeru osoby do il2_wybrany_wniosek + wpisanie imienia i nazwiska do B5
Private Sub Worksheet_Change(ByVal Target As Range)
    If Intersect(Target, Range("B5")) Is Nothing Then Exit Sub
    If Range("B5") = "" Then Exit Sub
    Application.EnableEvents = False
    Dim osoba As Integer
    odblokuj Me.Name
    If Sheets("Kwotacja").Cells(21 * Val(Range("B5")) - 1 - 6, 7) = 0 Then
        MsgBox "Wybrana osoba nie op|fffd|aca sk|fffd|adki kapita|fffd|owej"
        osoba = Range("il2_wybrany_wniosek")
    Else
        osoba = Val(Range("B5"))
    End If
    Range("il2_wybrany_wniosek") = osoba
    Range("B5") = "Ubezpieczony: " & LTrim(Mid(Sheets("Kwotacja").Cells((16 + 5) * osoba - 10, 2), 5))
    zablokuj Me.Name
    Application.EnableEvents = True
End Sub
Attribute VB_Name = "import"
Option Private Module

Sub import_plik()
    Dim katalog As String
    Dim raport As String
    katalog = ThisWorkbook.Path
    ChDir katalog
    nazwa = Application.GetOpenFilename("Dane do kwotacji (*.xls; *.xlsx), *.xls;*.xlsx")
    odp = vbNo
    If nazwa <> False Then
        CzyscUczestnicy
        odblokuj_app
        Sheets("raport partenon").Visible = True
        Sheets("raport partenon").Activate
        raport = "'" & Left(nazwa, InStrRev(nazwa, "\")) & "[" & Mid(nazwa, InStrRev(nazwa, "\") + 1) & "]" & "Raport'"
        For i = 1 To 2
            For j = 1 To 26
                Sheets("raport partenon").Cells(j, i).FormulaR1C1 = "=" & raport & "!R" & j & "C" & i
            Next j
        Next i
        For i = 4 To 16 + 11 * 16
            For j = 29 To 29 + Sheets("raport partenon").Range("B11")
                Sheets("raport partenon").Cells(j, i).FormulaR1C1 = "=" & raport & "!R" & j & "C" & i
            Next j
        Next i
        Sheets("raport partenon").Cells.Copy
        Sheets("raport partenon").Cells.PasteSpecial xlPasteValues
        import_dane
        odblokuj "MENU"
        Sheets("MENU").menu_zaslaniacz.Visible = True
        Sheets("MENU").menu_zaslaniacz.ForeColor = RGB(99, 102, 106)
        Sheets("MENU").menu_zaslaniacz_2.Height = 42
        Sheets("tablice").Range("czy_import") = True
        Sheets("tablice").Range("czy_konwersja") = False 'NA RAZIE BRAK KONWERSJI
        Do
            Sheets("tablice").Range("min_data_liczenia") = InputBox("Wprowad|fffd| minimaln|fffd| dat|fffd| liczenia:", "Dane przeliczenia")
        Loop Until IsDate(Sheets("tablice").Range("min_data_liczenia"))
        Sheets("tablice").Range("data_liczenia") = Sheets("tablice").Range("min_data_liczenia")
        Sheets("raport partenon").Visible = False
        zablokuj_app
        Sheets("Uczestnicy").Activate
        odp = MsgBox("Czy przeliczy|fffd| arkusz?", vbYesNo)
    End If
    If odp = vbYes Then Licz
End Sub

Sub import_dane()
    Range("tablice!firma_nazwa") = Sheets("raport partenon").Range("B8")
    Range("tablice!nr_polisy") = Sheets("raport partenon").Range("B6")
    Range("tablice!OWU") = Sheets("raport partenon").Range("B15")
    Range("tablice!comm_ws") = Sheets("raport partenon").Range("B18") * 100 / 1.3
    Range("tablice!freq") = Range("params!freq_text").Cells(Application.WorksheetFunction.Match _
        (Sheets("raport partenon").Range("B19"), Range("params!freq_text").Columns(2), 0), 1)
    If Sheets("raport partenon").Range("G9") = 0.98 Then
        Range("tablice!alokacja") = 98
    Else
        Range("tablice!alokacja") = 95
    End If
    Application.EnableEvents = False
    Sheets("Uczestnicy").Activate
    odblokuj "Uczestnicy"
    ile = Sheets("raport partenon").Range("B11")
    For i = 1 To ile
        Sheets("Uczestnicy").Cells(4 + i, 2) = "Potw_" & i
        Sheets("Uczestnicy").Cells(4 + i, 3) = " "
        Sheets("Uczestnicy").Cells(4 + i, 5) = Sheets("raport partenon").Cells(29 + i, 8)
        Sheets("Uczestnicy").Cells(4 + i, 4) = Sheets("raport partenon").Cells(29 + i, 9)
        Sheets("Uczestnicy").Cells(4 + i, 6) = Val(Sheets("raport partenon").Cells(29 + i, 10))
        Range("uczestnicy!ryzyko_import").Cells(i) = Sheets("Uczestnicy").Cells(4 + i, 6)
    Next i
    For i = 1 To 16
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("SU " & Range("params!swiadczenia_symbole").Cells(Sheets("uczestnicy").Cells(3, 16 + 8 + i)), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                If Sheets("raport partenon").Cells(29 + j, poz) > 0 Then
                    Sheets("Uczestnicy").Cells(4 + j, 6 + i) = Sheets("raport partenon").Cells(29 + j, poz)
                    Range("uczestnicy!SU_import").Cells(j, i) = Sheets("raport partenon").Cells(29 + j, poz)
                End If
            Next j
        Else
            For j = 1 To ile
                Range("uczestnicy!SU_import").Cells(j, i) = ""
            Next j
        End If
    Next i
    Intersect(Range("uczestnicy!uczestnicy_all"), Sheets("Uczestnicy").Range("D:E")).Locked = True
    zablokuj "Uczestnicy"
    Application.EnableEvents = True
    
End Sub

Sub import_loadingi()
    freq_disc = Sheets("raport partenon").Range("B20")
    For i = 1 To 16
    
        'disc
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("DISC " & Range("params!swiadczenia_symbole").Cells(i), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                u(j).disc(i) = Sheets("raport partenon").Cells(29 + j, poz)
            Next j
        End If
        
        'load pc
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("LOAD_PC " & Range("params!swiadczenia_symbole").Cells(i), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                u(j).load_pc(i) = Sheets("raport partenon").Cells(29 + j, poz)
            Next j
        End If
        
        'load const
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("LOAD_CONST " & Range("params!swiadczenia_symbole").Cells(i), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                u(j).load_const(i) = Sheets("raport partenon").Cells(29 + j, poz)
            Next j
        End If
        
        'load wiek
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("LOAD_WIEK " & Range("params!swiadczenia_symbole").Cells(i), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                u(j).load_wiek(i) = Sheets("raport partenon").Cells(29 + j, poz)
            Next j
        End If
        
        'load med pc
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("LOAD_MED_PC " & Range("params!swiadczenia_symbole").Cells(i), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                u(j).load_med_pc(i) = Sheets("raport partenon").Cells(29 + j, poz)
            Next j
        End If
        
        'load med const
        poz = 0
        On Error Resume Next
        poz = Application.WorksheetFunction.Match("LOAD_MED_CONST " & Range("params!swiadczenia_symbole").Cells(i), _
            Sheets("raport partenon").Rows(29), 0)
        On Error GoTo 0
        If poz > 0 Then
            For j = 1 To ile
                u(j).load_med_const(i) = Sheets("raport partenon").Cells(29 + j, poz)
            Next j
        End If
        
    Next i
End Sub
Attribute VB_Name = "kalendarz"
Attribute VB_Base = "0{D0464235-583D-455D-8AC6-4C12F8407F2F}{ADD44D6F-8512-439B-82F7-DED3D5B5703F}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Dim przerwij As Boolean
Dim komorka As Range

Private Sub UserForm_Activate()
    przerwij = True
    Set komorka = ActiveCell.Offset(, -1)
    miesiace.Clear
    lata.Clear
    For i = 1 To 12
        miesiace.AddItem MonthName(i)
    Next i
    For i = 1 To 75
        lata.AddItem 1940 + i
    Next i
    lata.Value = lata.list(29)
    przerwij = False
    miesiace.Value = miesiace.list(0)
End Sub

Private Sub lata_change()
    If przerwij Then Exit Sub
    Dim dzien As Control
    Dim aktywny As Boolean
    Dim pierwszadata As Long
    aktywny = False
    pierwszadata = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-01")
    pierwszadata = pierwszadata - DatePart("w", pierwszadata, vbMonday) + 1
    For i = 1 To 6
        For j = 1 To 7
            For Each dzien In kalendarz.Controls
                If dzien.Name = "data" & i & j Then
                    dzien.Caption = DatePart("d", pierwszadata + 7 * i + j - 8)
                    If dzien.Caption = 1 Then aktywny = Not aktywny
                    dzien.Enabled = aktywny
                End If
            Next dzien
        Next j
    Next i
End Sub

Private Sub miesiace_Change()
    If przerwij Then Exit Sub
    Dim dzien As Control
    Dim aktywny As Boolean
    Dim pierwszadata As Long
    aktywny = False
    pierwszadata = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-01")
    pierwszadata = pierwszadata - DatePart("w", pierwszadata, vbMonday) + 1
    For i = 1 To 6
        For j = 1 To 7
            For Each dzien In kalendarz.Controls
                If dzien.Name = "data" & i & j Then
                    dzien.Caption = DatePart("d", pierwszadata + 7 * i + j - 8)
                    If dzien.Caption = 1 Then aktywny = Not aktywny
                    dzien.Enabled = aktywny
                End If
            Next dzien
        Next j
    Next i
End Sub

Private Sub miesiac_prev_Click()
    If miesiace.ListIndex = 0 And lata.ListIndex = 0 Then Exit Sub
    If miesiace.ListIndex = 0 Then
        przerwij = True
        lata.Value = lata.list(lata.ListIndex - 1)
        przerwij = False
        miesiace.Value = miesiace.list(11)
    Else
        miesiace.Value = miesiace.list(miesiace.ListIndex - 1)
    End If
End Sub

Private Sub miesiac_next_Click()
    If miesiace.ListIndex = 11 And lata.ListIndex = lata.ListCount - 1 Then Exit Sub
    If miesiace.ListIndex = 11 Then
        przerwij = True
        lata.Value = lata.list(lata.ListIndex + 1)
        przerwij = False
        miesiace.Value = miesiace.list(0)
    Else
        miesiace.Value = miesiace.list(miesiace.ListIndex + 1)
    End If
End Sub

Private Sub data11_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data11.Caption)
kalendarz.Hide
End Sub
Private Sub data12_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data12.Caption)
kalendarz.Hide
End Sub
Private Sub data13_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data13.Caption)
kalendarz.Hide
End Sub
Private Sub data14_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data14.Caption)
kalendarz.Hide
End Sub
Private Sub data15_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data15.Caption)
kalendarz.Hide
End Sub
Private Sub data16_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data16.Caption)
kalendarz.Hide
End Sub
Private Sub data17_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data17.Caption)
kalendarz.Hide
End Sub
Private Sub data21_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data21.Caption)
kalendarz.Hide
End Sub
Private Sub data22_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data22.Caption)
kalendarz.Hide
End Sub
Private Sub data23_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data23.Caption)
kalendarz.Hide
End Sub
Private Sub data24_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data24.Caption)
kalendarz.Hide
End Sub
Private Sub data25_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data25.Caption)
kalendarz.Hide
End Sub
Private Sub data26_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data26.Caption)
kalendarz.Hide
End Sub
Private Sub data27_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data27.Caption)
kalendarz.Hide
End Sub
Private Sub data31_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data31.Caption)
kalendarz.Hide
End Sub
Private Sub data32_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data32.Caption)
kalendarz.Hide
End Sub
Private Sub data33_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data33.Caption)
kalendarz.Hide
End Sub
Private Sub data34_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data34.Caption)
kalendarz.Hide
End Sub
Private Sub data35_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data35.Caption)
kalendarz.Hide
End Sub
Private Sub data36_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data36.Caption)
kalendarz.Hide
End Sub
Private Sub data37_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data37.Caption)
kalendarz.Hide
End Sub
Private Sub data41_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data41.Caption)
kalendarz.Hide
End Sub
Private Sub data42_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data42.Caption)
kalendarz.Hide
End Sub
Private Sub data43_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data43.Caption)
kalendarz.Hide
End Sub
Private Sub data44_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data44.Caption)
kalendarz.Hide
End Sub
Private Sub data45_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data45.Caption)
kalendarz.Hide
End Sub
Private Sub data46_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data46.Caption)
kalendarz.Hide
End Sub
Private Sub data47_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data47.Caption)
kalendarz.Hide
End Sub
Private Sub data51_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data51.Caption)
kalendarz.Hide
End Sub
Private Sub data52_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data52.Caption)
kalendarz.Hide
End Sub
Private Sub data53_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data53.Caption)
kalendarz.Hide
End Sub
Private Sub data54_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data54.Caption)
kalendarz.Hide
End Sub
Private Sub data55_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data55.Caption)
kalendarz.Hide
End Sub
Private Sub data56_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data56.Caption)
kalendarz.Hide
End Sub
Private Sub data57_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data57.Caption)
kalendarz.Hide
End Sub
Private Sub data61_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data61.Caption)
kalendarz.Hide
End Sub
Private Sub data62_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data62.Caption)
kalendarz.Hide
End Sub
Private Sub data63_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data63.Caption)
kalendarz.Hide
End Sub
Private Sub data64_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data64.Caption)
kalendarz.Hide
End Sub
Private Sub data65_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data65.Caption)
kalendarz.Hide
End Sub
Private Sub data66_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data66.Caption)
kalendarz.Hide
End Sub
Private Sub data67_Click()
komorka = CDate(lata.Value & "-" & miesiace.ListIndex + 1 & "-" & data67.Caption)
kalendarz.Hide
End Sub
Attribute VB_Name = "kwotacja"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "list"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "main"
Option Explicit
Option Private Module

Public Sub Licz()
    Dim seryjny_wniosku
    seryjny_wniosku = Range("tablice!nr_wniosku")

    Application.EnableCancelKey = xlDisabled

    Sheets("tablice").Range("blad") = False
    CzyscKwotacja
    
    'sprawdzenie, czy nazwa firmy jest
    If Sheets("tablice").Range("firma_nazwa") = "" Then
        If Sheets("tablice").Range("osoba_fizyczna") Then
            MsgBox "B|fffd||fffd|d w danych. Wprowad|fffd| imi|fffd| i nazwisko osoby fizycznej w danych nag|fffd||fffd|wkowych"
        Else
            MsgBox "B|fffd||fffd|d w danych. Wprowad|fffd| nazw|fffd| firmy w danych nag|fffd||fffd|wkowych"
        End If
        Sheets("MENU").Activate
        Exit Sub
    End If

    'sprawdzenie poprawno|fffd|ci i zapisanie ustawionych sum i danych uczestnik|fffd|w
    testuj
    
    'je|fffd|li b|fffd||fffd|d - przerwanie
    If Sheets("tablice").Range("blad") Then
        MsgBox "B|fffd||fffd|d w danych. Przeliczenie nie jest mo|fffd|liwe."
        Sheets("Uczestnicy").Activate
        Exit Sub
    End If
        
    'wyliczenie comm_exp w tablicach w zale|fffd|no|fffd|ci od nadprowizji (domy|fffd|lnie - nadprowizja)
    If Sheets("tablice").Range("nadprowizja") = True Then
        Sheets("tablice").Range("comm_exp") = Sheets("tablice").Range("comm_ws") / 100 * 1.3
    Else
        Sheets("tablice").Range("comm_exp") = Sheets("tablice").Range("comm_ws") / 100
    End If
    
    'ustawienie parametr|fffd|w do wylicze|fffd|
    Dim data_liczenia As Date
    comm_exp = Sheets("tablice").Range("comm_exp")
    data_liczenia = Sheets("tablice").Range("data_liczenia")
    freq = Sheets("tablice").Range("freq")
               
    ' ######## POCZ|fffd|TEK P|fffd|TLI DLA UCZESTNIKA ########
    Dim i, x As Integer
    Dim ryzyko, plec, wiek, wiek_max As Integer
    For i = 1 To ile
        
        ryzyko = u(i).ryzyko    'klasa ryzyka
        plec = u(i).plec        'p|fffd|e|fffd|
        u(i).risk_prem = 0      'wyzerowanie sk|fffd|adki
        
        'obliczenie wieku ludk|fffd|w, sprawdzenie emeryt|fffd|w i junior|fffd|w
        wiek = ObliczWiek(u(i).data_ur, data_liczenia)
        If Range("tablice!OWU") = "PGV/2015/1" Or Range("tablice!OWU") = "PGV/2016/1" Or Range("tablice!OWU") = "PGVF/2016/1" Then
            wiek_max = Range("tablice!emeryt") - 1
        Else
            wiek_max = Range("tablice!emeryt") - 2 - 1
        End If
        If wiek >= wiek_max Or wiek < Range("tablice!wiek_min") Then
            MsgBox "Wiek uczestnika nr " & i & " nie mie|fffd|ci si|fffd| w przedziale <" & Range("tablice!wiek_min") _
                & " - " & wiek_max & "). Je|fffd|eli data urodzenia (" & u(i).data_ur _
                & ") jest wpisana poprawnie, prosz|fffd| usun|fffd||fffd| tego uczestnika."
            Exit Sub
        End If
        
        'OBLICZENIE KOSZT|fffd|W DLA |fffd|WIADCZE|fffd| UCZESTNIKA (te|fffd| ustawienie aktywno|fffd|ci |fffd|wiadczenia na podstawie niezerowej sumy)
        For x = 1 To 16
            If u(i).SU(x) > 0 Then
                u(i).s_akt(x) = True
                
                u(i).med_mod(x) = F_Med_mod(x, i)
                u(i).stopa_netto(x) = F_Stopa_netto(x, i)
                u(i).stopa_netto_disc(x) = F_Stopa_netto_disc(x, i)
                u(i).stopa_brutto(x) = F_Stopa_brutto(x, i)
                u(i).skladka_brutto(x) = F_Skladka_brutto(x, i)
                
                u(i).risk_prem = u(i).risk_prem + u(i).skladka_brutto(x)
            Else
                u(i).s_akt(x) = False
            End If
        Next x
        
        'ustawienie informacji o wymaganiu dokument|fffd|w finansowych
        If Sheets("tablice").Range("osoba_fizyczna") = False Then
            If u(i).SU(1) >= Range("su_dok_finansowe") Then Range("info_dok_finansowe") = Range("info_dok_finansowe") + 1
        Else
            If u(i).SU(1) >= Range("su_dok_finansowe_fiz") Then Range("info_dok_finansowe") = Range("info_dok_finansowe") + 1
        End If
                
        Pisz_uczestnik i 'wprowadzenie danych dla uczestnika na kwotacj|fffd|
        
    Next i
    '########### KONIEC P|fffd|TLI DLA UCZESTNIKA #################
        
    'wyznaczenie pierwszej osoby z ufk
    Dim pierwszy_fundusz As Integer
    pierwszy_fundusz = 0
    For i = ile To 1 Step -1
        If u(i).invest_prem > 0 Then pierwszy_fundusz = i
    Next i
        
    Sheets("kwotacja").Activate
    'podsumowania sk|fffd|adek
    total_risk_prem = 0
    total_invest_prem = 0
    For i = 1 To ile
        total_risk_prem = total_risk_prem + u(i).risk_prem
        total_invest_prem = total_invest_prem + u(i).invest_prem
    Next i
    odblokuj "kwotacja"
    total_prem = total_risk_prem + total_invest_prem
    Range("total_risk") = total_risk_prem
    Range("total_invest") = total_invest_prem
    Range("total_prem") = total_prem
    zablokuj "kwotacja"
       
    'korekta numeru OWU
    If Range("tablice!nr_polisy") = 0 Then
        If total_invest_prem = 0 Then
            If Range("tablice!OWU") = "PGVF/2016/1" Then Range("tablice!OWU") = "PGV/2016/1"
        Else
            If Range("tablice!OWU") = "PGV/2016/1" Then Range("tablice!OWU") = "PGVF/2016/1"
        End If
    End If
       
    'TEKSTY I INFORMACJE O KWOTACJI
    odblokuj "kwotacja"
    Sheets("kwotacja").Shapes("logo_k").Left = Sheets("kwotacja").Range("B1:H1").Left + Sheets("kwotacja").Range("B1:H1").Width / 2 - Sheets("kwotacja").Shapes("logo_k").Width / 2
    If Range("tablice!nr_polisy") > 0 And Sheets("tablice").Range("czy_fundusz") = True Then
        Sheets("kwotacja").Cells(2, 2) = "Szacunkowa kwotacja Grupowego Ubezpieczenia na |fffd|ycie" & Chr(10) & "z Ubezpieczeniowym Funduszem Kapita|fffd|owym OPIEKUN VIP"
    ElseIf total_invest_prem > 0 Then
        Sheets("tablice").Range("czy_fundusz") = True
        Sheets("kwotacja").Cells(2, 2) = "Szacunkowa kwotacja Grupowego Ubezpieczenia na |fffd|ycie" & Chr(10) & "z Ubezpieczeniowym Funduszem Kapita|fffd|owym OPIEKUN VIP"
    Else
        Sheets("tablice").Range("czy_fundusz") = False
        Sheets("kwotacja").Cells(2, 2) = "Szacunkowa kwotacja Grupowego Ubezpieczenia na |fffd|ycie" & Chr(10) & "OPIEKUN VIP"
    End If
    If Sheets("tablice").Range("czy_dolaczajacy") Then _
        Sheets("kwotacja").Cells(2, 2) = Sheets("kwotacja").Cells(2, 2) & " - dla polisy nr " & Sheets("tablice").Range("nr_polisy")
    If Sheets("tablice").Range("czy_import") Then _
        Sheets("kwotacja").Cells(2, 2) = Sheets("kwotacja").Cells(2, 2) & " - przeliczenie dla polisy nr " & Sheets("tablice").Range("nr_polisy")
    Range("kwot_firma") = Sheets("tablice").Range("firma_nazwa")
    If Sheets("tablice").Range("osoba_fizyczna") = True Then
        Range("kwot_fiz") = "(Osoba fizyczna)"
    Else
        Range("kwot_fiz") = ""
    End If
    Range("kwot_adres1") = Sheets("tablice").Range("firma_adres")
    Range("kwot_adres2") = Sheets("tablice").Range("firma_miasto")
    Range("kwot_data_kwot") = "Data kwotacji: " & Format(Now(), "yyyy-mm-dd")
    Range("kwot_data_na_dzien") = "Na dzie|fffd|: " & Format(Sheets("tablice").Range("data_liczenia"), "yyyy-mm-dd")
    Range("kwot_wersja") = "Wersja: " & Sheets("tablice").Range("wersja") & "." & Range("tablice!comm_ws")
    If Range("cokk") = True Then Range("kwot_wersja") = Range("kwot_wersja") & " COKK"
    If Range("tablice!nr_polisy") = 0 Then
        If Len(Range("tablice!nr_kwotacji")) = 0 Then
            Range("kwot_numer").EntireRow.Hidden = False
            Range("kwot_numer") = "Numer seryjny wniosku: " & seryjny_wniosku
        Else
            Range("kwot_numer").EntireRow.Hidden = False
            Range("kwot_numer") = "Numer seryjny wniosku: " & seryjny_wniosku & "; Numer kwotacji: " & Range("tablice!nr_kwotacji")
        End If
    Else
        If Len(Range("tablice!nr_kwotacji")) = 0 Then
            Range("kwot_numer").EntireRow.Hidden = True
            Range("kwot_numer") = ""
        Else
            Range("kwot_numer").EntireRow.Hidden = False
            Range("kwot_numer") = "Numer kwotacji: " & Range("tablice!nr_kwotacji")
        End If
    End If
    Range("kwot_czestot") = "Cz|fffd|stotliwo|fffd||fffd| wp|fffd|at: " & Application.WorksheetFunction.VLookup(Range("tablice!freq"), Range("params!freq_text"), 2, False)
    If Range("tablice!czy_dolaczajacy") Or Range("tablice!czy_import") Then
        Range("kwot_OWU") = "Niniejsza propozycja powinna by|fffd| czytana |fffd||fffd|cznie z OWU nr " & Range("tablice!OWU") & " obowi|fffd|zuj|fffd|cymi dla umowy " & Range("tablice!nr_polisy") & "."
    Else
        Range("kwot_OWU") = "Niniejsza propozycja powinna by|fffd| czytana |fffd||fffd|cznie z OWU Opiekun VIP nr " & Range("tablice!OWU") & "."
    End If
    Range("kwot_OWU_link") = "OWU dost|fffd|pne jest pod adresem " & Application.WorksheetFunction.VLookup(Range("tablice!OWU"), Range("params!OWU_lista").Offset(, 1), 2, False) & "."
    If Range("tablice!czy_import") Then
        Range("kwot_serial") = ""
    Else
        Range("kwot_serial") = Sheets("tablice").Range("A54") & Sheets("tablice").Range("B54")
    End If
    If Sheets("tablice").Range("czy_import") Then
        For i = 1 To ile
            For x = 1 To 16
                If Val(Sheets("uczestnicy").Range("SU_import").Cells(i, x)) - Val(Sheets("uczestnicy").Range("uczestnicy_all").Cells(i, x + 5)) < 0 Then
                    Range("kwot_UWR") = "Ostateczny zakres i wysoko|fffd||fffd| ubezpieczenia oraz sk|fffd|adki Towarzystwo potwierdzi po zako|fffd|czeniu procesu oceny ryzyka."
                End If
            Next x
            If Sheets("uczestnicy").Range("ryzyko_import").Cells(i) - Sheets("uczestnicy").Range("uczestnicy_all").Cells(i, 5) > 0 Then
                Range("kwot_UWR") = "Ostateczny zakres i wysoko|fffd||fffd| ubezpieczenia oraz sk|fffd|adki Towarzystwo potwierdzi po zako|fffd|czeniu procesu oceny ryzyka."
            End If
        Next i
        If Range("kwot_UWR") = "" Then Range("kwot_UWR") = "" 'komunikat o braku konieczno|fffd|ci?
    Else
        Range("kwot_UWR") = "Ostateczny zakres i wysoko|fffd||fffd| ubezpieczenia oraz sk|fffd|adki Towarzystwo potwierdzi po zako|fffd|czeniu procesu oceny ryzyka."
    End If
    zablokuj "kwotacja"
    
    'info o dokumentach finansowych
    If Range("info_dok_finansowe") >= 1 Then
        Beep
        If Sheets("tablice").Range("osoba_fizyczna") = False Then
            MsgBox "Suma ubezpieczenia niekt|fffd|rych uczestnik|fffd|w r|fffd|wna lub wi|fffd|ksza od " & Range("su_dok_finansowe") & " z|fffd|. Do wniosku nale|fffd|y do|fffd||fffd|czy|fffd| dokumenty finansowe."
        Else
            MsgBox "Suma ubezpieczenia niekt|fffd|rych uczestnik|fffd|w r|fffd|wna lub wi|fffd|ksza od " & Range("su_dok_finansowe_fiz") & " z|fffd|. Do wniosku nale|fffd|y do|fffd||fffd|czy|fffd| dokumenty finansowe."
        End If
    End If
        
    If Sheets("tablice").Range("taryfa_GN") = 1 Then Sheets("tablice").Range("taryfa_licz") = 1 Else Sheets("tablice").Range("taryfa_licz") = 0
    
    Pisz_list                   'generowanie listu
    Ilustracja_uczestnicy       'wst|fffd|pne ustawienia ilustracji
    Drukuj_ilustracje 1         'dostosowywanie ilustracji (ochrona)
    
    'pokazywanie/chowanie ilustracji funduszu
    If pierwszy_fundusz > 0 Then
        If Sheets("ilustracja - fundusz").Visible = False Then
            odblokuj_app
            Sheets("ilustracja - fundusz").Visible = True
            zablokuj_app
        End If
        odblokuj "ilustracja - fundusz"
        Application.EnableEvents = False
        Sheets("ilustracja - fundusz").Range("il2_wybrany_wniosek") = pierwszy_fundusz
        Sheets("ilustracja - fundusz").Range("B5") = "Ubezpieczony: " & _
            LTrim(Mid(Sheets("Kwotacja").Cells((16 + 5) * pierwszy_fundusz - 10, 2), 5))
        Application.EnableEvents = True
        zablokuj "ilustracja - fundusz"
        Drukuj_Ilustracje2      'funkcja dostosowuj|fffd|ca (chowa/pokazuje wiersze)
    End If
        
    If Sheets("tablice").Range("czy_fundusz") = True Then
        odblokuj_app
        Sheets("PIDUU").Visible = True
        Sheets("Deklaracja").Visible = True
        Sheets("Wype|fffd|nianie deklaracji").Visible = True
        zablokuj "Wype|fffd|nianie deklaracji"
        Sheets("Wype|fffd|nianie ankiety").Visible = True
        zablokuj "Wype|fffd|nianie ankiety"
        zablokuj_app
        'PIDUU
        odblokuj "PIDUU"
        If Range("tablice!nr_polisy") = "" Then
            Range("PIDUU!piduu_rodzaj") = 0
        Else
            Range("PIDUU!piduu_rodzaj") = 2
        End If
        Range("PIDUU!piduu_numer") = seryjny_wniosku
        Range("PIDUU!piduu_polisa") = Range("tablice!nr_polisy")
        Range("PIDUU!piduu_vip_os_fiz") = -CInt(Sheets("tablice").Range("osoba_fizyczna") = True)
        Range("PIDUU!piduu_owu") = Range("tablice!owu")
        Range("PIDUU!piduu_adm") = Range("tablice!adm_ch")
        Range("PIDUU!piduu_freq") = Range("tablice!freq")
        Range("PIDUU!piduu_alok1") = Range("tablice!alokacja")
        Range("PIDUU!piduu_alok2") = Range("tablice!alokacja")
        Range("PIDUU!piduu_alok_lok") = Range("tablice!alokacja_lok")
        For i = 2 To 244
            If Sheets("PIDUU").Cells(i, 15) = 1 Then
                If Sheets("PIDUU").Rows(i).Hidden = True Then Sheets("PIDUU").Rows(i).Hidden = False
            Else
                If Sheets("PIDUU").Rows(i).Hidden = False Then Sheets("PIDUU").Rows(i).Hidden = True
            End If
        Next i
        zablokuj "PIDUU"
        
        'deklaracja
        odblokuj "deklaracja"
        Range("deklaracja!deklaracja_index") = 1
        Range("deklaracja!deklaracja_dro") = data_liczenia
        zablokuj "deklaracja"
    Else
        odblokuj_app
        If Sheets("ilustracja - fundusz").Visible = True Then Sheets("ilustracja - fundusz").Visible = False
        If Sheets("PIDUU").Visible = True Then Sheets("PIDUU").Visible = False
        If Sheets("Deklaracja").Visible = True Then Sheets("Deklaracja").Visible = False
        If Sheets("Wype|fffd|nianie ankiety").Visible = True Then Sheets("Wype|fffd|nianie ankiety").Visible = False
        If Sheets("Wype|fffd|nianie deklaracji").Visible = True Then Sheets("Wype|fffd|nianie deklaracji").Visible = False
        zablokuj_app
'        Range("dane_ankiet!dane_1").ClearContents
'        Range("dane_ankiet!dane_2").ClearContents
'        Range("dane_ankiet!dane_3").ClearContents
'        Range("dane_ankiet!dane_4").ClearContents
    End If
    
    Sheets("kwotacja").Select
    Cells(1, 1).Select
End Sub

'wprowadzenie i odkrycie danych o sumach i sk|fffd|adkach dla uczestnika na kwotacji
'i w danych deklaracji
Private Sub Pisz_uczestnik(nr)
    odblokuj "kwotacja"
    Sheets("kwotacja").Rows(10 + 1 + (nr - 1) * 21).Hidden = False
    Sheets("kwotacja").Rows(10 + 2 + (nr - 1) * 21).Hidden = False
    Sheets("kwotacja").Rows(10 + 3 + (nr - 1) * 21).Hidden = False
    Sheets("kwotacja").Rows(10 + 4 + (nr - 1) * 21).Hidden = False
    Sheets("kwotacja").Rows(10 + 20 + (nr - 1) * 21).Hidden = False
        If u(nr).plec = 2 Then
        Sheets("kwotacja").Cells(10 + 1 + (nr - 1) * 21, 2) = "Pan " & u(nr).imie & " " & u(nr).nazwisko
    ElseIf u(nr).plec = 1 Then
        Sheets("kwotacja").Cells(10 + 1 + (nr - 1) * 21, 2) = "Pani " & u(nr).imie & " " & u(nr).nazwisko
    Else
        Sheets("kwotacja").Cells(10 + 1 + (nr - 1) * 21, 2) = u(nr).imie & " " & u(nr).nazwisko
    End If
    Sheets("kwotacja").Cells(10 + 2 + (nr - 1) * 21, 2) = "Data urodzenia " & Format(u(nr).data_ur, "d mmm yyyy") & " r."
    Sheets("kwotacja").Cells(10 + 3 + (nr - 1) * 21, 2) = "|fffd|wiadczenia"
    Sheets("kwotacja").Cells(10 + 3 + (nr - 1) * 21, 4) = "Suma ubezpieczenia"
    Sheets("kwotacja").Cells(10 + 3 + (nr - 1) * 21, 5) = "Koszt ochrony"
    Sheets("kwotacja").Cells(10 + 2 + (nr - 1) * 21, 6) = "|fffd||fffd|czny" & Chr(10) & "koszt ochrony"
    Sheets("kwotacja").Cells(10 + 2 + (nr - 1) * 21, 7) = "Sk|fffd|adka kapita|fffd|owa"
    Sheets("kwotacja").Cells(10 + 2 + (nr - 1) * 21, 8) = "Sk|fffd|adka ca|fffd|kowita"
    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 2) = s(1).nazwa  'nazwa dla ZUB
    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 4) = u(nr).SU(1)  'suma na ZUB
    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 5) = u(nr).skladka_brutto(1) 'wymagalno|fffd|ciowy koszt dla ZUB
'    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 5) = Round(u(nr).gross_prem(1) / freq, 2) 'wymagalno|fffd|ciowy koszt dla ZUB
    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 6) = u(nr).risk_prem
    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 7) = u(nr).invest_prem
    Sheets("kwotacja").Cells(10 + 4 + (nr - 1) * 21, 8) = u(nr).risk_prem + u(nr).invest_prem
    
    Dim x As Integer
    For x = 2 To 16
        If u(nr).s_akt(x) = True Then
            Sheets("kwotacja").Rows(10 + 3 + x + (nr - 1) * 21).Hidden = False
            Sheets("kwotacja").Cells(10 + 3 + x + (nr - 1) * 21, 2) = s(x).nazwa  'nazwa swiadczenia
            Sheets("kwotacja").Cells(10 + 3 + x + (nr - 1) * 21, 4) = u(nr).SU(x) 'suma na swiadczeniu
            If x = 16 Then Sheets("kwotacja").Cells(10 + 3 + x + (nr - 1) * 21, 4) = "TAK" 'brak sumy dla AS2
            Sheets("kwotacja").Cells(10 + 3 + x + (nr - 1) * 21, 5) = u(nr).skladka_brutto(x) 'wymagalno|fffd|ciowy koszt dla swiadczenia
'            Sheets("kwotacja").Cells(10 + 3 + x + (nr - 1) * 21, 5) = Round(u(nr).gross_prem(x) / freq, 2) 'wymagalno|fffd|ciowy koszt dla swiadczenia
             'dla TUZ i NPW odkrycie kolumny poszerzaj|fffd|cej opis,
            If x = 4 Then Sheets("kwotacja").Columns(3).ColumnWidth = 12.29 'TUZ
            If x = 6 And Sheets("kwotacja").Columns(3).ColumnWidth < 10 Then Sheets("kwotacja").Columns(3).ColumnWidth = 11 'NPW
            ' zawijanie wieszy gdzie potrzeba
            If x = 5 Or x = 12 Then
            Sheets("kwotacja").Cells(10 + 3 + x + (nr - 1) * 21, 2).WrapText = True
            End If
        End If
    Next x
    zablokuj "kwotacja"
    
    'dane deklaracji
    Range("dane_ankiet!dane_1").Cells(nr, 1) = u(nr).nazwisko
    Range("dane_ankiet!dane_1").Cells(nr, 2) = u(nr).imie
    If u(nr).plec = 2 Then
        Range("dane_ankiet!dane_1").Cells(nr, 3) = "M"
    Else
        Range("dane_ankiet!dane_1").Cells(nr, 3) = "K"
    End If
    Range("dane_ankiet!dane_1").Cells(nr, 4) = u(nr).data_ur
    Range("dane_ankiet!dane_1").Cells(nr, 5) = u(nr).invest_prem
End Sub


Attribute VB_Name = "metody"
'Funkcja wylicza wiek  przyst|fffd|pienia jako liczb|fffd| pe|fffd|nych lat uko|fffd|czonych na dat|fffd| liczenia
Public Function ObliczWiek(DataUrodzenia, DataLiczenia)
Attribute ObliczWiek.VB_ProcData.VB_Invoke_Func = " \n14"
    LiczbaLat = Year(DataLiczenia) - Year(DataUrodzenia)
    miesiace = Month(DataLiczenia) - Month(DataUrodzenia)
    If miesiace > 0 Then
        ObliczWiek = LiczbaLat
    ElseIf miesiace = 0 Then
        Dni = Day(DataLiczenia) - Day(DataUrodzenia)
        If Dni < 0 Then
            ObliczWiek = LiczbaLat - 1
        ElseIf Dni >= 0 Then
            ObliczWiek = LiczbaLat
        End If
    ElseIf miesiace < 0 Then
        ObliczWiek = LiczbaLat - 1
    End If
End Function

Public Function F_Podst_mod(nr_s, nr_u, wiek)
    qx = s(nr_s).taryfa(u(nr_u).plec, wiek)
    load_occ = s(nr_s).load_occ(u(nr_u).ryzyko)
    load_pc = u(nr_u).load_pc(nr_s)
    load_const = u(nr_u).load_const(nr_s)
    F_Podst_mod = qx * (1 + load_occ) * (1 + load_pc) + load_const
End Function

Public Function F_Med_mod(nr_s, nr_u)
    data_liczenia = Sheets("tablice").Range("data_liczenia")
    load_wiek = u(nr_u).load_wiek(nr_s)
    u_wiek = ObliczWiek(u(nr_u).data_ur, data_liczenia)
    podst_mod_1 = F_Podst_mod(nr_s, nr_u, u_wiek + load_wiek)
    podst_mod_2 = F_Podst_mod(nr_s, nr_u, u_wiek)
    load_med_pc = u(nr_u).load_med_pc(nr_s)
    load_med_const = u(nr_u).load_med_const(nr_s)
    F_Med_mod = (podst_mod_1 - podst_mod_2) + podst_mod_2 * load_med_pc + load_med_const
End Function

Public Function F_Stopa_netto(nr_s, nr_u)
    data_liczenia = Sheets("tablice").Range("data_liczenia")
    u_wiek = ObliczWiek(u(nr_u).data_ur, data_liczenia)
    F_Stopa_netto = F_Podst_mod(nr_s, nr_u, u_wiek)
End Function

Public Function F_Stopa_netto_disc(nr_s, nr_u)
    stopa_netto = u(nr_u).stopa_netto(nr_s)
    disc = u(nr_u).disc(nr_s)
    F_Stopa_netto_disc = stopa_netto * (1 + disc)
End Function

Public Function F_Stopa_brutto(nr_s, nr_u)
    stopa_netto_disc = u(nr_u).stopa_netto_disc(nr_s)
    koszty_adm = s(nr_s).koszty_adm + s(nr_s).koszty_uw
    SU = u(nr_u).SU(nr_s)
    F_Stopa_brutto = (stopa_netto_disc + koszty_adm * 1000 / SU) / (1 - comm_exp)
End Function

Public Function F_Skladka_brutto(nr_s, nr_u)
    stopa_brutto = u(nr_u).stopa_brutto(nr_s)
    SU = u(nr_u).SU(nr_s)
    med_mod = u(nr_u).med_mod(nr_s)
    ALA = 0
    F_Skladka_brutto = Round((stopa_brutto * SU / 1000 + med_mod / 1000 * (SU - ALA) / (1 - comm_exp)) * freq_disc / freq, 2)
End Function
Attribute VB_Name = "prowizja"
Attribute VB_Base = "0{4E88E060-0C58-4ED6-AC39-26BA6A288D9B}{428FF11C-5F40-4AD4-B936-E84E7A7BD06A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'pobranie warto|fffd|ci z tablic
Private Sub UserForm_Activate()
    
    If Sheets("tablice").Range("alokacja") = 100 Then
        alo_100.Value = True
    ElseIf Sheets("tablice").Range("alokacja") = 98 Then
        alo_98.Value = True
    ElseIf Sheets("tablice").Range("alokacja") = 95 Then
        alo_95.Value = True
    End If
    If Sheets("tablice").Range("OWU") = "PGV/2016/1" Or Sheets("tablice").Range("OWU") = "PGVF/2016/1" Then
        alo_100.Visible = True
        alo_98.Visible = False
        alo_95.Visible = False
    Else
        alo_100.Visible = False
        alo_98.Visible = True
        alo_95.Visible = True
    End If
    prowizja_val.Value = Sheets("tablice").Range("comm_ws")
    zamknij.SetFocus
End Sub

Private Sub alo_95_click()
    Sheets("tablice").Range("alokacja") = 95
End Sub

Private Sub alo_98_click()
    Sheets("tablice").Range("alokacja") = 98
End Sub

Private Sub alo_100_click()
    Sheets("tablice").Range("alokacja") = 100
End Sub

'ustawianie prowizji za ochron|fffd| w wersji std od 5 do 20%, w wersji cokk od 0% do 20%
Private Sub prowizja_val_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    prowizja_val.Value = test_liczba(prowizja_val.Value)
    If Not Range("tablice!cokk") Then
        If prowizja_val.Value < 5 Then prowizja_val.Value = 5
        If prowizja_val.Value > 20 Then prowizja_val.Value = 20
    ElseIf Range("tablice!cokk") Then
        If prowizja_val.Value > 20 Then prowizja_val.Value = 20
        If prowizja_val.Value < 0 Then prowizja_val.Value = 0
    End If
    Sheets("tablice").Range("comm_ws") = prowizja_val.Value
End Sub

Private Sub zamknij_Click()
    Me.Hide
End Sub
Attribute VB_Name = "skroty"
'Ctrl + m
Sub skrot_menu()
Attribute skrot_menu.VB_ProcData.VB_Invoke_Func = "m\n14"
    Sheets("MENU").Activate
End Sub

'Ctrl + d
Sub skrot_naglowki()
Attribute skrot_naglowki.VB_ProcData.VB_Invoke_Func = "d\n14"
    headers.Show
End Sub

'Ctrl + y
Sub skrot_prowizja()
Attribute skrot_prowizja.VB_ProcData.VB_Invoke_Func = "y\n14"
    prowizja.Show
End Sub

'Ctrl + u
Sub skrot_uczestnicy()
Attribute skrot_uczestnicy.VB_ProcData.VB_Invoke_Func = "u\n14"
    Sheets("Uczestnicy").Activate
End Sub

'Ctrl + w
Sub skrot_wydruki()
Attribute skrot_wydruki.VB_ProcData.VB_Invoke_Func = "w\n14"
    If Len(Sheets("Kwotacja").Cells(11, 2)) = 0 Then
        Beep
        ok = MsgBox("Kwotacja nie zosta|fffd|a wykonana - opcje wydruk|fffd|w s|fffd| niedost|fffd|pne.", _
            vbOKCancel + vbExclamation, "Kontrola poprawno|fffd|ci danych")
        Exit Sub
    End If
    wydruki.Show
End Sub

'Ctrl + r
Sub skrot_przelicz()
Attribute skrot_przelicz.VB_ProcData.VB_Invoke_Func = "r\n14"
    If Sheets("tablice").Range("czy_dolaczajacy") And _
        (Sheets("tablice").Range("nr_polisy") = "" Or Sheets("tablice").Range("OWU") = "") Then
        MsgBox "Aby przeliczy|fffd| kwotacj|fffd| dla os|fffd|b do|fffd||fffd|czaj|fffd|cych, nale|fffd|y wpisa|fffd| numer polisy i wybra|fffd| aktualne OWU.", vbExclamation, "Uwaga"
        Sheets("MENU").Activate
        Range("F13").Select
        Exit Sub
    End If
    Sheets("Uczestnicy").Activate
    Licz
End Sub

Sub ustaw_cokk()
Attribute ustaw_cokk.VB_ProcData.VB_Invoke_Func = "C\n14"
' Klawisz skr|fffd|tu: Ctrl+Shift+C
'    haslo = InputBox("Podaj has|fffd|o do wersji COKK:")
'    If haslo <> "xxx" Then Exit Sub
    MsgBox ("Arkusz jest ustawiony w trybie przelicze|fffd| dla COKK")
    If Sheets("tablice").Range("cokk") = False Then
        Sheets("tablice").Range("cokk") = True
    End If
End Sub

Sub wylacz_COKK()
Attribute wylacz_COKK.VB_ProcData.VB_Invoke_Func = "Z\n14"
' Klawisz skr|fffd|tu: Ctrl+Shift+Z
    MsgBox ("Arkusz jest ustawiony w trybie przelicze|fffd| standardowych")
    If Sheets("tablice").Range("cokk") = True Then
        Sheets("tablice").Range("cokk") = False
        If Sheets("tablice").Range("comm_ws") < 5 Then Sheets("tablice").Range("comm_ws") = 5
        ustaw_swiadczenia
        Licz
    End If
End Sub

'Ctrl + Shift + I
Sub skrot_import_DPG()
Attribute skrot_import_DPG.VB_ProcData.VB_Invoke_Func = "I\n14"
    odp = InputBox("Has|fffd|o:", "Podaj has|fffd|o do importu")
    If odp = "import-haslo" Then
        import_plik
    Else
        MsgBox "B|fffd||fffd|dne has|fffd|o"
    End If
End Sub
Attribute VB_Name = "uczestnicy"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "przelicz_button_arkusz, 1, 0, MSForms, CommandButton"
Attribute VB_Control = "CzyscUczest, 2, 1, MSForms, CommandButton"
Attribute VB_Control = "MenuUczest, 3, 2, MSForms, CommandButton"
Attribute VB_Control = "DopasujSumy, 5, 3, MSForms, CommandButton"
Private Sub DopasujSumy_Click()
    If Not IsDate(Cells(Selection.Row, 5)) Then
        MsgBox "Aby dopasowa|fffd| sumy ubezpieczenia dla uczestnika, wybierz wiersz, w kt|fffd|rym wpisane s|fffd| dane uczestnika."
        Range("B5").Select
        Exit Sub
    End If
    dopasowanie.Show
End Sub

'pokazywanie / chowanie kolumn w zale|fffd|no|fffd|ci od wersji OWU (kontrola w formu|fffd|ach w wierszu 2)
Private Sub Worksheet_Activate()
    If Sheets("tablice").Range("OWU") = "" Then
        MsgBox "Aby przygotowa|fffd| kwotacj|fffd| dla do|fffd||fffd|czaj|fffd|cych, nale|fffd|y wybra|fffd| aktualny nr OWU dla polisy.", vbExclamation, "Uwaga"
        Sheets("MENU").Activate
        Sheets("MENU").Range("F15").Select
        Exit Sub
    End If
    odblokuj "uczestnicy"
    If Sheets("tablice").Range("czy_import") Then
        CzyscUczest.Caption = "Przywr|fffd||fffd| sumy i grupy ryzyka dla polisy"
    Else
        CzyscUczest.Caption = "Czy|fffd||fffd| dane os|fffd|b"
    End If
    For i = 1 To 16
        If Cells(2, 6 + i) = 1 Then
            If Columns(6 + i).Hidden = True Then Columns(6 + i).Hidden = False
        Else
            If Columns(6 + i).Hidden = False Then
                Application.EnableEvents = False
                Intersect(Range("uczestnicy_all"), Columns(6 + i)).ClearContents
                Application.EnableEvents = True
                Columns(6 + i).Hidden = True
            End If
        End If
    Next i
    zablokuj "uczestnicy"
    If Sheets("tablice").Range("ilu_uczestnikow") > 0 Then _
        sprawdz_wartosci Range("F5:F" & 4 + Sheets("tablice").Range("ilu_uczestnikow"))
End Sub

Private Sub przelicz_button_arkusz_Click()
    If Sheets("tablice").Range("czy_dolaczajacy") And _
        (Sheets("tablice").Range("nr_polisy") = "" Or Sheets("tablice").Range("OWU") = "") Then
        MsgBox "Aby przeliczy|fffd| kwotacj|fffd| dla os|fffd|b do|fffd||fffd|czaj|fffd|cych, nale|fffd|y wpisa|fffd| numer polisy i wybra|fffd| aktualne OWU.", vbExclamation, "Uwaga"
        Sheets("MENU").Activate
        Exit Sub
    End If
    Sheets("Uczestnicy").Activate
    Licz
End Sub

Private Sub CzyscUczest_Click()
    If Sheets("tablice").Range("czy_import") Then
        Application.EnableEvents = False
        odblokuj "uczestnicy"
        Range("ryzyko_import").Copy
        Range("uczestnicy_all").Cells(1, 5).PasteSpecial xlPasteValues
        Range("SU_import").Copy
        Range("uczestnicy_all").Cells(1, 6).PasteSpecial xlPasteValues
        zablokuj "uczestnicy"
        Application.EnableEvents = True
    Else
        CzyscUczestnicy
    End If
End Sub

Private Sub MenuUczest_Click()
    Sheets("MENU").Activate
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
    sprawdz_wartosci Target
End Sub

Private Sub Worksheet_SelectionChange(ByVal Target As Range)
    If Application.CutCopyMode = xlCut Then Application.CutCopyMode = False
End Sub
Attribute VB_Name = "uczestnicy_spr"
Dim sumin, sumax As Double

'funkcja sprawdzaj|fffd|ca dane uczestnik|fffd|w, w tym warto|fffd|ci sum ubezpieczenia
'domy|fffd|lnie pozostawia nieprawid|fffd|owe warto|fffd|ci
Sub sprawdz_wartosci(Target As Range, Optional kasuj_bledy As Boolean = False)

    Dim ws As Worksheet
    Set ws = Sheets("Uczestnicy")

    ws.Activate
    odblokuj ws.Name
    Dim zakres, wiersz As Range
    
    'ustawienie trybu sum minimalnych
    If (Sheets("tablice").Range("ilu_uczestnikow") = 1 And Sheets("tablice").Range("czy_dolaczajacy") = False And Sheets("tablice").Range("cokk") = False) Or _
       (Sheets("tablice").Range("osoba_fizyczna") = True And Sheets("tablice").Range("cokk") = False) Then
        Sheets("params").Range("tryb") = 1
    Else
        Sheets("params").Range("tryb") = 2
    End If
    
    'cz|fffd||fffd| z danymi osobowymi: imi|fffd|, nazwisko, p|fffd|e|fffd|, data urodzenia, grupa ryzyka
    Set zakres = Intersect(Target, ws.Range("B5:F34"))
    If Not (zakres Is Nothing) Then
        Application.EnableEvents = False
        For Each wiersz In zakres.Rows
            'kontrola p|fffd|ci
            If Not (Intersect(wiersz, ws.Range("D:D")) Is Nothing) Then
                If Intersect(wiersz, ws.Range("D:D")) = "m" Then Intersect(wiersz, ws.Range("D:D")) = "M"
                If Intersect(wiersz, ws.Range("D:D")) = "k" Then Intersect(wiersz, ws.Range("D:D")) = "K"
                If Intersect(wiersz, ws.Range("D:D")) <> "M" And Intersect(wiersz, ws.Range("D:D")) <> "K" Then
                    Intersect(wiersz, ws.Range("D:D")) = ""
                End If
            End If
            'kontrola daty urodzenia (tylko czy prawid|fffd|owy format daty
            If Not (Intersect(wiersz, ws.Range("E:E")) Is Nothing) Then
                If Not IsDate(Intersect(wiersz, ws.Range("E:E"))) Then
                    Intersect(wiersz, ws.Range("E:E")) = ""
                End If
            End If
            'kontrola grupy ryzyka (musi by|fffd| r|fffd|wna 1, 2, 3, 4 lub 5)
            If Not (Intersect(wiersz, ws.Range("F:F")) Is Nothing) Then
                If Not IsNumeric(Intersect(wiersz, ws.Range("F:F"))) Then
                    Intersect(wiersz, ws.Range("F:F")) = ""
                Else
                    If Intersect(wiersz, ws.Range("F:F")) < 1 Or Intersect(wiersz, ws.Range("F:F")) > 5 _
                        Or Intersect(wiersz, ws.Range("F:F")) <> Int(Intersect(wiersz, ws.Range("F:F"))) Then
                            Intersect(wiersz, ws.Range("F:F")) = ""
                    End If
                End If
            End If
        Next wiersz
        Application.EnableEvents = True
    End If
    
    'cz|fffd||fffd| z sumami ubezpieczenia i sk|fffd|adk|fffd| inwestycyjn|fffd|
    Set zakres = Intersect(Target, ws.Range("B5:W34"))
    If Not (zakres Is Nothing) Then
        Application.EnableEvents = False
        'oddzielne sprawdzenie dla ka|fffd|dego wiersza
        For Each wiersz In zakres.Rows
            For i = 1 To 16 + 1
                'wywo|fffd|anie funkcji sprawdz_komentarz
                sprawdz_komentarz ws.Cells(wiersz.Row, i + 6), kasuj_bledy
                'zmiana komentarza na aktualny z formu|fffd|y
                If Val(Application.Version) < 12 Then
                    ws.Cells(wiersz.Row, i + 6).Validation.Delete
                Else
                    With ws.Cells(wiersz.Row, i + 6).Validation
                        .Delete
                        If Left(ws.Cells(wiersz.Row, i + 8 + 16), 1) = "M" Then
                            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                                Operator:=xlBetween, Formula1:=sumin, Formula2:=sumax
                        Else
                            .Add Type:=xlValidateDecimal, AlertStyle:=xlValidAlertStop, _
                                Operator:=xlBetween, Formula1:="-1", Formula2:="-1"
                        End If
                        .IgnoreBlank = True
                        .InCellDropdown = True
                        .InputTitle = ""
                        .ErrorTitle = "B|fffd||fffd|d"
                        .InputMessage = ws.Cells(wiersz.Row, i + 8 + 16)
                        If i = 16 + 1 Then
                            .ErrorMessage = "Niepoprawna sk|fffd|adka"
                        Else
                            .ErrorMessage = "Niepoprawna suma"
                        End If
                        .ShowInput = True
                        .ShowError = True
                    End With
                End If
            Next i
        Next wiersz
        Application.EnableEvents = True
    End If
    
    If Not Sheets("tablice").Range("czy_import") Then _
        Range("uczestnicy_all").Locked = False
            
    zablokuj "uczestnicy"
End Sub

'sprawdza, czy zosta|fffd|a wprowadzona odpowiednia warto|fffd||fffd| SU i zapisuje warto|fffd|ci su-min i su-max
Private Sub sprawdz_komentarz(wartosc As Range, kasuj_bledy As Boolean)
    Dim tekst As String
    If Left(wartosc.Offset(, 2 + 16), 1) = "M" Then
        tekst = wartosc.Offset(, 2 + 16)
        tekst = Mid(tekst, InStr(1, tekst, ":") + 2)
        sumin = Val(tekst)
        tekst = Mid(tekst, InStr(1, tekst, ":") + 2)
        sumax = Val(tekst)
        '"maksymalna" sk|fffd|adka inwestycyjna
        If sumax < 1000 Then sumax = 100000
    End If
    If wartosc <> "" Then
        If Left(wartosc.Offset(, 2 + 16), 1) = "M" Then
            If wartosc < sumin Or wartosc > sumax Then
                If kasuj_bledy Then wartosc = ""
            End If
        Else
            If kasuj_bledy Then wartosc = ""
        End If
    End If
End Sub

Attribute VB_Name = "wydruki"
Attribute VB_Base = "0{1C0F6C46-FE6D-46E3-8962-D674EC5DDDB8}{C92F6169-2EC7-445D-9E50-18AC6CB7E9B6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim blokada As Boolean 'bool blokuj|fffd|cy wykonywanie funkcji - np podczas uruchamiania okna

Private Sub pdf_wniosek_Click()
    If Sheets("tablice").Range("czy_fundusz") Then
        otworz_plik_pdf "PDF_wniosek_z_UFK"
    Else
        otworz_plik_pdf "PDF_wniosek_bez_UFK"
    End If
End Sub

Private Sub pdf_deklaracja_Click()
    If Sheets("tablice").Range("czy_fundusz") Then
        'nic
    Else
        otworz_plik_pdf "PDF_deklaracja_bez_UFK"
    End If
End Sub

'zaczytanie warto|fffd|ci z tablic
Private Sub UserForm_Activate()
    blokada = True
    
    'nazwa aktywnej drukarki
    drukarka_nazwa.Caption = "Aktywna drukarka to: " & ActivePrinter
    
    'brak listu dla do|fffd||fffd|cze|fffd|
    If Range("tablice!nr_polisy") > 0 Then
        druk_list.Value = False
        druk_list.Enabled = False
    Else
        druk_list.Enabled = True
        If Range("tablice!wydruki").Cells(2) Then druk_list.Value = True Else druk_list.Value = False
    End If
    
    'brak ilustracji-fundusz, deklaracji i piduu dla polis bez funduszu, zmiana wniosku
    If Sheets("tablice").Range("czy_fundusz") Then
        druk_ilustracja_fin.Enabled = True
        druk_piduu.Enabled = True
        druk_deklaracje.Enabled = True
        pdf_wniosek.Caption = "Otw|fffd|rz PDF - wniosek o ubezpieczenie Opiekun VIP z UFK"
    Else
        druk_ilustracja_fin.Enabled = False
        druk_ilustracja_fin.Value = False
        druk_piduu.Enabled = False
        druk_piduu.Value = False
        druk_deklaracje.Enabled = False
        druk_deklaracje.Value = False
        pdf_wniosek.Caption = "Otw|fffd|rz PDF - wniosek o ubezpieczenie Opiekun VIP bez UFK"
    End If
    
    'kwotacja
    If Range("tablice!wydruki").Cells(1) Then druk_kwotacja.Value = True Else druk_kwotacja.Value = False
    
    'ilustracja
    If Range("tablice!wydruki").Cells(3) Or Range("tablice!wydruki").Cells(4) Then
        druk_ilustracja_frame.Visible = True
        druk_ilustracja_wszystkie.Value = True
        
        'ilustracja - ochrona
        If Range("tablice!wydruki").Cells(3) Then
            druk_ilustracja_risk.Value = True
            druk_ilustracja_risk_frame.Visible = True
            If Sheets("ilustracja - ochrona").Range("il_ikony") = 1 Then
                druk_ikonki.Value = True
            Else
                druk_ikonki.Value = False
            End If
            If Sheets("ilustracja - ochrona").Range("il_rozw_pz") = 1 Then
                druk_PZ.Value = True
            Else
                druk_PZ.Value = False
            End If
            If Sheets("ilustracja - ochrona").Range("il_rozw_hb") = 1 Then
                druk_HCB.Value = True
            Else
                druk_HCB.Value = False
            End If
            If Sheets("ilustracja - ochrona").Range("il_rozw_as2") = 1 Then
                druk_AS2.Value = True
            Else
                druk_AS2.Value = False
            End If
            If Range("tablice!OWU") = "PGV/2015/1" Or Range("tablice!OWU") = "PGV/2016/1" Or Range("tablice!OWU") = "PGVF/2016/1" Then
                druk_AS2.Visible = True
            Else
                druk_AS2.Visible = False
            End If
        Else
            druk_ilustracja_risk.Value = False
            druk_ilustracja_risk_frame.Visible = False
        End If
        
        'ilustracja - fundusz
        If Range("tablice!wydruki").Cells(4) And Range("tablice!czy_fundusz") Then
            druk_ilustracja_fin.Value = True
            druk_ilustracja_fin_frame.Visible = True
            druk_zwrot1.Value = Sheets("ilustracja - fundusz").Range("il2_stopa1")
            druk_zwrot2.Value = Sheets("ilustracja - fundusz").Range("il2_stopa2")
            druk_wsk_indeks.Value = Sheets("ilustracja - fundusz").Range("il2_indeksacja")
            druk_czy_renta.Value = Range("tablice!czy_renta")
            druk_prognoza.Value = Sheets("ilustracja - fundusz").Range("il2_dlugosc")
        Else
            druk_ilustracja_fin.Value = False
            druk_ilustracja_fin_frame.Visible = False
        End If
    Else
        druk_ilustracja_frame.Visible = False
    End If

    'piduu
    If Range("tablice!wydruki").Cells(5) And Range("tablice!czy_fundusz") Then
        druk_piduu.Value = True
    Else
        druk_piduu.Value = False
    End If
    
    'deklaracje
    If Range("tablice!wydruki").Cells(6) And Range("tablice!czy_fundusz") Then
        druk_deklaracje.Value = True
        druk_deklaracje_frame.Visible = True
        druk_deklaracja_wszystkie.Value = True
        PDF_deklaracja.Visible = False
    Else
        druk_deklaracje.Value = False
        druk_deklaracje_frame.Visible = False
        PDF_deklaracja.Visible = True
    End If

    'brak wniosku pdf dla do|fffd||fffd|cze|fffd|
    If Range("tablice!nr_polisy") > 0 Then
        pdf_wniosek.Enabled = False
    Else
        pdf_wniosek.Enabled = True
    End If

    'wy|fffd||fffd|czenie druku pdf dla excel 2003 i starszych
    If Val(Application.Version) < 12 Then
        druk_pdf.Enabled = False
    Else
        druk_pdf.Enabled = True
    End If
    
    blokada = False
End Sub

Private Sub druk_list_Click()
    If blokada Then Exit Sub
    Range("tablice!wydruki").Cells(2) = druk_list.Value
End Sub

Private Sub druk_kwotacja_Click()
    If blokada Then Exit Sub
    Range("tablice!wydruki").Cells(1) = druk_kwotacja.Value
End Sub

Private Sub druk_ilustracja_risk_Click()
    If blokada Then Exit Sub
    If druk_ilustracja_risk.Value = True Then
        Range("tablice!wydruki").Cells(3) = True
        If druk_ilustracja_frame.Visible = False Then druk_ilustracja_frame.Visible = True
        druk_ilustracja_risk_frame.Visible = True
    Else
        Range("tablice!wydruki").Cells(3) = False
        druk_ilustracja_risk_frame.Visible = False
        If druk_ilustracja_fin_frame.Visible = False Then druk_ilustracja_frame.Visible = False
    End If
End Sub

Private Sub pokaz_ilustracja_risk_Click()
    If blokada Then Exit Sub
    wydruki.Hide
    Sheets("ilustracja - ochrona").Activate
    Drukuj_ilustracje Sheets("ilustracja - ochrona").Range("il_wybrany_wniosek")
End Sub

Private Sub druk_ilustracja_fin_Click()
    If blokada Then Exit Sub
    If druk_ilustracja_fin.Value = True Then
        Range("tablice!wydruki").Cells(4) = True
        If druk_ilustracja_frame.Visible = False Then druk_ilustracja_frame.Visible = True
        druk_ilustracja_fin_frame.Visible = True
    Else
        Range("tablice!wydruki").Cells(4) = False
        druk_ilustracja_fin_frame.Visible = False
        If druk_ilustracja_risk_frame.Visible = False Then druk_ilustracja_frame.Visible = False
    End If
End Sub

Private Sub pokaz_ilustracja_fin_Click()
    If blokada Then Exit Sub
    wydruki.Hide
    Sheets("ilustracja - fundusz").Activate
End Sub

Private Sub druk_ikonki_Click()
    If blokada Then Exit Sub
    odblokuj "Ilustracja - ochrona"
    If druk_ikonki.Value = True Then
        Sheets("ilustracja - ochrona").Range("il_ikony") = 1
    Else
        Sheets("ilustracja - ochrona").Range("il_ikony") = 0
    End If
    zablokuj "Ilustracja - ochrona"
End Sub

Private Sub druk_PZ_Click()
    If blokada Then Exit Sub
    odblokuj "Ilustracja - ochrona"
    If druk_PZ.Value = True Then
        Sheets("ilustracja - ochrona").Range("il_rozw_PZ") = 1
    Else
        Sheets("ilustracja - ochrona").Range("il_rozw_PZ") = 0
    End If
    zablokuj "Ilustracja - ochrona"
End Sub

Private Sub druk_HCB_Click()
    If blokada Then Exit Sub
    odblokuj "Ilustracja - ochrona"
    If druk_HCB.Value = True Then
        Sheets("ilustracja - ochrona").Range("il_rozw_HB") = 1
    Else
        Sheets("ilustracja - ochrona").Range("il_rozw_HB") = 0
    End If
    zablokuj "Ilustracja - ochrona"
End Sub

Private Sub druk_AS2_Click()
    If blokada Then Exit Sub
    odblokuj "Ilustracja - ochrona"
    If druk_AS2.Value = True Then
        Sheets("ilustracja - ochrona").Range("il_rozw_AS2") = 1
    Else
        Sheets("ilustracja - ochrona").Range("il_rozw_AS2") = 0
    End If
    zablokuj "Ilustracja - ochrona"
End Sub

Private Sub druk_wsk_indeks_Click()
    If blokada Then Exit Sub
    odblokuj "Ilustracja - fundusz"
    If druk_wsk_indeks.Value = True Then
        Sheets("Ilustracja - fundusz").Range("il2_indeksacja") = 1
        If Sheets("Ilustracja - fundusz").Rows("10:11").Hidden = True Then _
            Sheets("Ilustracja - fundusz").Rows("10:11").Hidden = False
    Else
        Sheets("Ilustracja - fundusz").Range("il2_indeksacja") = 0
        If Sheets("Ilustracja - fundusz").Rows("10:11").Hidden = False Then _
            Sheets("Ilustracja - fundusz").Rows("10:11").Hidden = True
    End If
    zablokuj "Ilustracja - fundusz"
End Sub

Private Sub druk_czy_renta_Click()
    If blokada Then Exit Sub
    Range("tablice!czy_renta") = druk_czy_renta.Value
    odblokuj "Ilustracja - fundusz"
    If Sheets("Ilustracja - fundusz").Range("16:17, 36:36").EntireRow.Hidden = druk_czy_renta.Value _
        Then Sheets("Ilustracja - fundusz").Range("16:17, 36:36").EntireRow.Hidden = Not (druk_czy_renta.Value)
    zablokuj "Ilustracja - fundusz"
End Sub

Private Sub druk_zwrot1_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    If blokada Then Exit Sub
    If IsNumeric(druk_zwrot1.Value) Then
        If druk_zwrot1.Value < 2.5 Then druk_zwrot1.Value = 2.5
        If druk_zwrot1.Value > 10 Then druk_zwrot1.Value = 10
        druk_zwrot1.Value = Round(druk_zwrot1.Value, 2)
    Else
        druk_zwrot1.Value = 3
    End If
    odblokuj "Ilustracja - fundusz"
    Sheets("ilustracja - fundusz").Range("il2_stopa1") = CDbl(druk_zwrot1.Value)
    zablokuj "Ilustracja - fundusz"
End Sub

Private Sub druk_zwrot2_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    If blokada Then Exit Sub
    If IsNumeric(druk_zwrot2.Value) Then
        If druk_zwrot2.Value < 2.5 Then druk_zwrot2.Value = 2.5
        If druk_zwrot2.Value > 10 Then druk_zwrot2.Value = 10
        druk_zwrot2.Value = Round(druk_zwrot2.Value, 2)
    Else
        druk_zwrot2.Value = 3
    End If
    odblokuj "Ilustracja - fundusz"
    Sheets("ilustracja - fundusz").Range("il2_stopa2") = CDbl(druk_zwrot2.Value)
    zablokuj "Ilustracja - fundusz"
End Sub

Private Sub druk_prognoza_BeforeUpdate(ByVal Cancel As MSForms.ReturnBoolean)
    If blokada Then Exit Sub
    If IsNumeric(druk_prognoza.Value) Then
        If druk_prognoza.Value < 5 Then druk_prognoza.Value = 5
        If druk_prognoza.Value > 55 Then druk_prognoza.Value = 55
        druk_prognoza.Value = Fix(druk_prognoza.Value / 5) * 5
    Else
        druk_prognoza.Value = 40
    End If
    odblokuj "Ilustracja - fundusz"
    Sheets("ilustracja - fundusz").Range("il2_dlugosc") = CDbl(druk_prognoza.Value)
    'schowanie / pokazanie odpowiednich wierszy
    For i = 1 To 11
        If i > druk_prognoza.Value / 5 Then
            If Sheets("ilustracja - fundusz").Rows(22 + i).Hidden = False Then _
                Sheets("ilustracja - fundusz").Rows(22 + i).Hidden = True
        Else
            If Sheets("ilustracja - fundusz").Rows(22 + i).Hidden = True Then _
                Sheets("ilustracja - fundusz").Rows(22 + i).Hidden = False
        End If
    Next i
    zablokuj "Ilustracja - fundusz"
End Sub

Private Sub druk_piduu_Click()
    If blokada Then Exit Sub
    Range("tablice!wydruki").Cells(5) = druk_list.Value
End Sub

Private Sub druk_deklaracje_Click()
    If blokada Then Exit Sub
    Range("tablice!wydruki").Cells(6) = druk_list.Value
    If druk_deklaracje.Value = True Then
        druk_deklaracje_frame.Visible = True
        druk_deklaracja_wszystkie.Value = True
    Else
        druk_deklaracje_frame.Visible = False
    End If
End Sub

Private Sub druk_powrot_Click()
    wydruki.Hide
    Sheets("Menu").Activate
End Sub

Private Sub druk_drukuj_Click()
    drukowanie
End Sub

Private Sub druk_pdf_Click()
    drukowanie True
End Sub

Private Sub zmien_drukarke_Click()
    Application.Dialogs(xlDialogPrinterSetup).Show
    drukarka_nazwa.Caption = "Aktywna drukarka to: " & ActivePrinter
End Sub

'drukowanie wszystkich zaznaczonych arkuszy, domy|fffd|lnie wydruk (opcjonalnie pdf)
Private Sub drukowanie(Optional pdf As Boolean = False)
    Dim arkusze(1 To 22)
    Dim nazwa As String
    Dim ws As Worksheet
    
    'dla unikni|fffd|cia b|fffd||fffd|d|fffd|w - wykasowanie roboczych arkuszy, je|fffd|li s|fffd| utworzone
    For Each ws In ThisWorkbook.Worksheets
        If Left(ws.Name, 5) = "druk_" Or Left(ws.Name, 5) = "dekl_" Or Right(ws.Name, 1) = ")" Then
            Application.EnableEvents = False
            Application.DisplayAlerts = False
            ws.Delete
            Application.EnableEvents = True
            Application.DisplayAlerts = True
        End If
    Next ws

    'zatrzymanie wydruku, je|fffd|li deklaracje niewype|fffd|nione
    If druk_deklaracje.Value = True Then
        If druk_deklaracja_wybrany.Value = True Then
            If Len(Sheets("dane_ankiet").Range("dane_2").Cells(Sheets("deklaracja").Range("deklaracja_index"), 1)) = 0 _
                Or Sheets("dane_ankiet").Range("CP" & 2 + Sheets("deklaracja").Range("deklaracja_index")) = False Then
                    MsgBox "Deklaracja nr " & Sheets("deklaracja").Range("deklaracja_index") & " nie jest wype|fffd|niona w spos|fffd|b kompletny. Zapis do PDF przerwany."
                    Exit Sub
            End If
        Else
            For i = 1 To Sheets("Ilustracja - ochrona").Range("ilustracja_uczestnicy").Count
                If Len(Sheets("dane_ankiet").Range("dane_2").Cells(i, 1)) = 0 _
                    Or Sheets("dane_ankiet").Range("CP" & 2 + i) = False Then
                        MsgBox "Deklaracja nr " & i & " nie jest wype|fffd|niona w spos|fffd|b kompletny. Zapis do PDF przerwany."
                        Exit Sub
                End If
            Next i
        End If
    End If

    'ostrze|fffd|enie, je|fffd|li w ilustracjach s|fffd| zaznaczone inne osoby, mo|fffd|liwo|fffd||fffd| anulowania
    If druk_ilustracja_risk.Value = True And druk_ilustracja_fin.Value = True And druk_ilustracja_wybrany.Value = True Then
        If Sheets("Ilustracja - ochrona").Range("il_wybrany_wniosek") _
                <> Sheets("Ilustracja - fundusz").Range("il2_wybrany_wniosek") Then
            ok = MsgBox("Uwaga: w cz|fffd|ci ochronnej i kapita|fffd|owej ilustracji aktywne s|fffd| r|fffd|ne osoby. " _
                & "(ochrona - os. nr " & Sheets("Ilustracja - ochrona").Range("il_wybrany_wniosek") _
                & "; fundusz - os. nr " & Sheets("Ilustracja - fundusz").Range("il2_wybrany_wniosek") _
                & ". Kontynuowa|fffd|?", vbYesNo)
            If ok = vbNo Then Exit Sub
        End If
    End If

    Dim licz_strony
    licz_strony = 0
    dekl_strony = 0
    
    'dla wydruku wszystkich - skopiowanie po jednym arkuszu dla jednej osoby
    If druk_ilustracja_risk.Value = True Then
        If druk_ilustracja_wszystkie.Value = True Then
            For i = 1 To Sheets("Ilustracja - ochrona").Range("ilustracja_uczestnicy").Count
                nazwa = "druk_1_" & i
                Drukuj_ilustracje i
                odblokuj_app
                Sheets("Ilustracja - ochrona").Copy Before:=Sheets("Ilustracja - ochrona")
                Sheets("Ilustracja - ochrona (2)").Name = nazwa
                odblokuj nazwa
                With Sheets(nazwa).UsedRange
                    .Value = .Value
                End With
                If pdf Then
                    dekl_strony = dekl_strony + 1 + Sheets(nazwa).HPageBreaks.Count
                Else
                    licz_strony = licz_strony + 1 + Sheets(nazwa).HPageBreaks.Count
                End If
            Next i
        Else
            Drukuj_ilustracje Sheets("Ilustracja - ochrona").Range("il_wybrany_wniosek")
            If pdf Then
                dekl_strony = dekl_strony + 1 + Sheets("Ilustracja - ochrona").HPageBreaks.Count
            Else
                licz_strony = licz_strony + 1 + Sheets("Ilustracja - ochrona").HPageBreaks.Count
            End If
        End If
    End If
    
    'dla wydruku wszystkich - skopiowanie po jednym arkuszu dla jednej osoby
    If druk_ilustracja_fin.Value = True Then
        If druk_ilustracja_wszystkie.Value = True Then
            Application.EnableEvents = False
            For i = 1 To Sheets("Ilustracja - ochrona").Range("ilustracja_uczestnicy").Count
                If Sheets("Kwotacja").Cells((16 + 5) * i - 7, 7) > 0 Then
                    nazwa = "druk_2_" & i
                    odblokuj "Ilustracja - fundusz"
                    odblokuj_app
                    If druk_ilustracja_risk.Value = True Then
                        Sheets("Ilustracja - fundusz").Copy After:=Sheets("druk_1_" & i)
                    Else
                        Sheets("Ilustracja - fundusz").Copy Before:=Sheets("Ilustracja - fundusz")
                    End If
                    Sheets("Ilustracja - fundusz (2)").Name = nazwa
                    Sheets(nazwa).Range("M2") = i
                    Sheets(nazwa).Range("B5") = "Ubezpieczony: " & _
                        LTrim(Mid(Sheets("Kwotacja").Cells((16 + 5) * i - 10, 2), 5))
                    With Sheets(nazwa).UsedRange
                        .Value = .Value
                    End With
                    If pdf Then
                        dekl_strony = dekl_strony + 1
                    Else
                        licz_strony = licz_strony + 1
                    End If
                End If
            Next i
            Application.EnableEvents = True
        Else
            If pdf Then
                dekl_strony = dekl_strony + 1
            Else
                licz_strony = licz_strony + 1
            End If
        End If
    End If

    If druk_list.Value = True Then
        If pdf Then
            dekl_strony = dekl_strony + 1
        Else
            licz_strony = licz_strony + 1
        End If
    End If
    
    If druk_kwotacja.Value = True Then
        Sheets("kwotacja").Activate
        ActiveWindow.View = xlPageBreakPreview
        ActiveWindow.View = xlNormalView
        If pdf Then
            dekl_strony = dekl_strony + 1 + Sheets("kwotacja").HPageBreaks.Count
        Else
            licz_strony = licz_strony + 1 + Sheets("kwotacja").HPageBreaks.Count
        End If
    End If
    
    If druk_piduu.Value = True Then
        Sheets("PIDUU").Activate
        ActiveWindow.View = xlPageBreakPreview
        ActiveWindow.View = xlNormalView
        If pdf Then
            dekl_strony = dekl_strony + 1 + Sheets("PIDUU").HPageBreaks.Count
        Else
            licz_strony = licz_strony + 1 + Sheets("PIDUU").HPageBreaks.Count
        End If
    End If

    'dla wydruku wszystkich - skopiowanie po jednym arkuszu dla jednej osoby
    If druk_deklaracje.Value = True Then
        If druk_deklaracja_wszystkie.Value = True Then
            Application.EnableEvents = False
            For i = 1 To Sheets("Ilustracja - ochrona").Range("ilustracja_uczestnicy").Count
                nazwa = "dekl_" & i
                odblokuj "Deklaracja"
                odblokuj_app
                Sheets("Deklaracja").Copy Before:=Sheets("Deklaracja")
                Sheets("Deklaracja (2)").Name = nazwa
                Sheets(nazwa).Range("deklaracja_index") = i
                Sheets("kwotacja").Activate
                Application.EnableEvents = True
                Sheets(nazwa).Activate
                odblokuj nazwa
                With Sheets(nazwa).UsedRange
                    .Value = .Value
                End With
                If Sheets("dane_ankiet").Range("dane_2").Cells(i, 1) = 1 Then
                    If pdf Then
                        dekl_strony = dekl_strony + 4
                    Else
                        licz_strony = licz_strony + 4
                    End If
                ElseIf IsError(Sheets("dane_ankiet").Range("AX" & i + 2)) Then
                    If pdf Then
                        dekl_strony = dekl_strony + 5
                    Else
                        licz_strony = licz_strony + 5
                    End If
                ElseIf Sheets("dane_ankiet").Range("AX" & i + 2) = 0 Then
                    If pdf Then
                        dekl_strony = dekl_strony + 6
                    Else
                        licz_strony = licz_strony + 6
                    End If
                Else
                    If pdf Then
                        dekl_strony = dekl_strony + 5
                    Else
                        licz_strony = licz_strony + 5
                    End If
                End If
            Next i
            Application.EnableEvents = True
        Else
            ' nic
        End If
    End If

    'zapisanie listy widocznych arkuszy (|fffd|eby m|fffd|c p|fffd|niej przywr|fffd|ci|fffd|)
    odblokuj_app
    For i = 1 To 22
        nazwa = Range("params!lista_arkuszy").Cells(i)
        If Sheets(nazwa).Visible = True Then _
            arkusze(i) = True Else arkusze(i) = False
    Next i
    
    'przeniesienie listu przed kwotacj|fffd| na wydruku
    On Error Resume Next
    Sheets("List").Select
    Sheets("List").Move Before:=Sheets("Kwotacja")
    On Error GoTo 0
    
    Application.EnableEvents = False
    
    'ukrycie niedrukowanych arkuszy
    For i = 1 To 2
        If arkusze(i) Then
            nazwa = Range("params!lista_arkuszy").Cells(i)
            Sheets(nazwa).Visible = False
        End If
    Next i
    If druk_kwotacja.Value = False Then Sheets("Kwotacja").Visible = False
    If druk_list.Value = False Then Sheets("List").Visible = False
    If Not (druk_ilustracja_risk.Value = True And druk_ilustracja_wybrany.Value = True) Then
        Sheets("Ilustracja - ochrona").Visible = False
    End If
    If Not (druk_ilustracja_fin.Value = True And druk_ilustracja_wybrany.Value = True) Then
        Sheets("Ilustracja - fundusz").Visible = False
    End If
    For i = 7 To 13
        If arkusze(i) Then
            nazwa = Range("params!lista_arkuszy").Cells(i)
            Sheets(nazwa).Visible = False
        End If
    Next i
    If druk_piduu.Value = False Then Sheets("PIDUU").Visible = False
    If Not (druk_deklaracje.Value = True And druk_deklaracja_wybrany.Value = True) Then
        Sheets("Deklaracja").Visible = False
    End If
    For i = 16 To 22
        If arkusze(i) Then
            nazwa = Range("params!lista_arkuszy").Cells(i)
            Sheets(nazwa).Visible = False
        End If
    Next i
    
    Application.EnableEvents = True
    
    wydruki.Hide
    'wydruk normalny czy pdf
    If pdf Then
        'drukowanie do pdf
        pdf_nazwa = Application.GetSaveAsFilename(Left(ThisWorkbook.Name, _
            Len(ThisWorkbook.Name) - 4) & "pdf", "PDF (*.pdf), *.pdf")
        If pdf_nazwa <> False Then ActiveWorkbook.ExportAsFixedFormat Type:=xlTypePDF, _
            Filename:=pdf_nazwa, Quality:=xlQualityStandard, IncludeDocProperties:=True, _
            IgnorePrintAreas:=False, OpenAfterPublish:=True
    Else
        odp = MsgBox("Stron do wydrukowania: " & licz_strony & ". Drukowa|fffd|?", vbYesNo, "Ostrze|fffd|enie")
        If odp = vbYes Then
            For Each ws In ThisWorkbook.Sheets
                If ws.Visible = True Then ws.PrintOut Copies:=1, Collate:=True
            Next ws
        End If
'        'drukowanie z podgl|fffd|dem
'        ActiveWorkbook.PrintOut , , , True
    End If

    Application.EnableEvents = False
    
    'przywr|fffd|cenie widoczno|fffd|ci wcze|fffd|niej schowanych arkuszy
    For i = 1 To 22
        If arkusze(i) Then
            nazwa = Range("params!lista_arkuszy").Cells(i)
            Sheets(nazwa).Visible = True
        End If
    Next i
    
    'wykasowanie stworzonych arkuszy ilustracji
    Application.DisplayAlerts = False
    For Each ws In ThisWorkbook.Sheets
        If Left(ws.Name, 5) = "druk_" Or Left(ws.Name, 5) = "dekl_" Then ws.Delete
    Next ws
    Application.DisplayAlerts = True
    Application.EnableEvents = True

    'przesuni|fffd|cie listu z powrotem za kwotacj|fffd|
    On Error Resume Next
    Sheets("List").Select
    Sheets("List").Move After:=Sheets("Kwotacja")
    On Error GoTo 0
    zablokuj_app
    wydruki.Show
End Sub




INQUEST-PP=macro
