Attribute VB_Name = "Module1"
' Version Setup-190925 ( modified from Setup-170125)
' Version A2.0 for use in Microsoft Excel 2007 or later versions
' Setup file for MMT Accounts
' It was developed by Vitus Tse of Mark-Motum Co. Ltd. dated 28 MAy, 2011 and is protected by copyright law
' Use or copy in full or partial portion of this program by any means without permission from Mark-Motum Co. Ltd. and Vitus Tse is not allowed
Public Mybook As Workbook
Public FilePath As String, OldSystemName As String, SystemName As String, DataFileName As String, RawSystemName As String
Public DataFilePath As String, DExtn As String, SExtn As String, FileMode As String, DriveSN As Long
Function CharCon(A)
  If A < 10 Then
    CharCon = Chr(A + 48)
    Else
    CharCon = Chr(A + 55)
  End If
  If CharCon = "I" Then CharCon = "X"
  If CharCon = "O" Then CharCon = "Y"
End Function
Function NumCon(A)
  If A = "X" Then A = "I"
  If A = "Y" Then A = "O"
  If Asc(A) < 65 Then
    NumCon = Asc(A) - 48
    Else
    NumCon = Asc(A) - 55
  End If
End Function
Sub Installation(SetA As String)
Dim myFSO As Object, myDrive As Object, DriveCode As String
Application.EnableEvents = False
Application.ScreenUpdating = False
Worksheets("WaitNote").Visible = xlSheetVisible
Worksheets("Notes to User").Visible = xlSheetHidden
ThisWorkbook.Worksheets("WaitNote").Activate
Application.ScreenUpdating = True
 Range("A1:G16").Select
 ActiveWindow.Zoom = True
 Range("A1").Select
 DoEvents
 FilePath = ""
Application.ScreenUpdating = False
On Error Resume Next
Set myFSO = CreateObject("Scripting.FileSystemObject")
If myFSO.DriveExists("C") = True Then
 If myFSO.Drives("C").DriveType = 2 Then
  FilePath = "C:\MMT Account\"
 End If
End If
If FilePath = "" Then
  DriveCode = Left(Application.Path, 1)
 If myFSO.GetDrive(DriveCode).DriveType = 2 Then
    FilePath = DriveCode & ":\MMT Account\"
 Else
  For Each myDrive In myFSO.Drives
    If myFSO.Drives(myDrive.DriveLetter).DriveType = 2 Then
     FilePath = myDrive.DriveLetter & ":\MMT Account\"
     Exit For
    End If
   Next
 End If
End If
If FilePath = "" Then
  MsgBox ("The appropriate drive is not found." & Chr(13) & Chr(13) & "Setup cannot be proceeded")
    ThisWorkbook.Close (False)
   End
End If
 DriveCode = Left(FilePath, 1)
 DriveSN = 0
 DriveCode = myFSO.GetDrive(DriveCode).SerialNumber
 If Len(DriveCode) > 3 Then
  DriveSN = Val(Right(DriveCode, 3))
 Else
  DriveSN = Abs(Val(DriveCode))
 End If
On Error GoTo 0
SystemName = "MMT Account"
RawSystemName = "AcctFile.xlsm"
 Call CheckNCreateFolder("")
 Application.ScreenUpdating = True
 DoEvents
 Application.ScreenUpdating = False
 ActiveWorkbook.Close (True)
Application.EnableEvents = True
On Error Resume Next
Workbooks.Open FilePath & SystemName
ThisWorkbook.Close (False)
On Error GoTo 0
End Sub
Sub CheckNCreateFolder(SetA As String)
Dim myFSO As Object
Dim FileNo As Long
Application.DisplayAlerts = False
Set myFSO = CreateObject("Scripting.FileSystemObject")
If myFSO.FolderExists(FilePath) = True Then
    If myFSO.FileExists(FilePath & SystemName & ".xlsm") = True Then
    On Error Resume Next
    If myFSO.FileExists(FilePath & SystemName & ".bak") = True Then
      myFSO.GetFile(FilePath & SystemName & ".bak").Attributes = 0
      Kill FilePath & SystemName & ".bak"
    End If
     myFSO.Copyfile FilePath & SystemName & ".xlsm", FilePath & SystemName & ".bak"
     myFSO.GetFile(FilePath & SystemName & ".bak").Attributes = 2
     On Error GoTo 0
     OldSystemName = SystemName & ".xlsm"
     SystemName = SystemName & ".xlsm"
     SExtn = ".xlsm"
     DExtn = ".xlsm"
    Call OldSystem("")
   Else
    SystemName = SystemName & ".xlsm"
    SExtn = ".xlsm"
    DExtn = ".xlsm"
    Call NewSystem("")
   End If
Else
 MkDir FilePath
  SystemName = SystemName & ".xlsm"
  SExtn = ".xlsm"
  DExtn = ".xlsm"
  Call NewSystem("")
End If
End Sub
Sub CreateIcon(SetA As String)
Dim MMTIcon As Object, myFSO As Object
Dim Shortcut As Object
Dim PathDeskTop As String, DisplayName As String
DisplayName = "MMT ACCOUNT"
Set MMTIcon = CreateObject("WScript.Shell")
PathDeskTop = MMTIcon.SpecialFolders("Desktop")
On Error Resume Next
  Set myFSO = CreateObject("Scripting.FileSystemObject")
   If myFSO.FileExists(FilePath & "mmtacct.ico") = True Then
      myFSO.GetFile(FilePath & "mmtacct.ico").Attributes = 0
      Kill FilePath & "mmtacct.ico"
   End If
FileCopy ThisWorkbook.Path & "\mmtacct.ico", FilePath & "mmtacct.ico"
Set Shortcut = MMTIcon.CreateShortCut(PathDeskTop & "\" & _
DisplayName & ".lnk")
With Shortcut
.TargetPath = ActiveWorkbook.FullName
.IconLocation = FilePath & "mmtacct.ico"
.Save
End With
Set MMTIcon = Nothing
End Sub
Sub NewSystem(SetA As String)
Dim A As Long, I As Long, J As Long, C As String
Dim CompName As String, Address1 As String, Address2 As String, Address3 As String, YearEndMonth As Long
Dim myFSO As Object, FilePathSub As String, DataCurrency As String
Dim MySheet As Worksheet, DPaper As Long
    Set myFSO = CreateObject("Scripting.FileSystemObject")
    If myFSO.FileExists(ThisWorkbook.Path & "\DataFile.xlsm") <> True Then
      MsgBox ("The required Files are not found." & Chr(13) & Chr(13) & "Setup will not proceed")
      GoTo SetupQuit
      Exit Sub
    End If
On Error Resume Next
   If myFSO.FileExists(FilePath & "DataFile.bak") = True Then
      myFSO.GetFile(FilePath & "DataFile.bak").Attributes = 0
      Kill FilePath & "DataFile.bak"
   End If
FileCopy ThisWorkbook.Path & "\DataFile.xlsm", FilePath & "DataFile.bak"
myFSO.GetFile(FilePath & "DataFile.bak").Attributes = 2
  Application.DisplayAlerts = False
   DPaper = 1
  On Error Resume Next
  Sheets.Add
  Application.DisplayAlerts = True
 If ActiveSheet.PageSetup.PaperSize = xlPaperA4 Then DPaper = xlPaperA4
   On Error GoTo WrongDataFile
Workbooks.Open ThisWorkbook.Path & "\DataFile.xlsm"
 Workbooks("DataFile.xlsm").Activate
  I = ActiveWorkbook.Worksheets.Count
  If I <> 22 Then GoTo WrongDataFile
    ActiveWorkbook.Worksheets("Data").Activate
    ActiveWorkbook.Worksheets("YearStartDat").Activate
    ActiveWorkbook.Worksheets("ComData").Activate
    ActiveWorkbook.Worksheets("Chart of Account").Activate
    ActiveWorkbook.Worksheets("Receivable").Activate
    ActiveWorkbook.Worksheets("ProInvoice").Activate
    ActiveWorkbook.Worksheets("Customer Data").Activate
    ActiveWorkbook.Worksheets("Product Data").Activate
    ActiveWorkbook.Worksheets("PayRec").Activate
    ActiveWorkbook.Worksheets("Supplier Data").Activate
    ActiveWorkbook.Worksheets("Payable").Activate
    ActiveWorkbook.Worksheets("Supply Data").Activate
    ActiveWorkbook.Worksheets("PORecord").Activate
    ActiveWorkbook.Worksheets("PayMake").Activate
    ActiveWorkbook.Worksheets("StockRec").Activate
    ActiveWorkbook.Worksheets("InvDetail1").Activate
    ActiveWorkbook.Worksheets("IOData").Activate
    ActiveWorkbook.Worksheets("BuildRec").Activate
    ActiveWorkbook.Worksheets("StockAdRec").Activate
    ActiveWorkbook.Worksheets("CountRec").Activate
    ActiveWorkbook.Worksheets("BOM1").Activate
  On Error GoTo 0
ActiveWorkbook.Worksheets("Data").Name = "Raw Data"
 Set Mybook = ActiveWorkbook
DataInput:
ThisWorkbook.Worksheets("WaitNote").Activate
UserForm2.Show
CompanyDataInput:
Mybook.Activate
 If ThisWorkbook.Worksheets("Notes to User").Range("C13").Value = "CANCEL" Then
   ThisWorkbook.Worksheets("Notes to User").Range("C1:D13").ClearContents
AskReply1:
 MSG = "You chose to terminate the Setup." + Chr(13) + _
 Chr(13) + Chr(13) + "Enter 'Y' to confirm."
   Title = "ALERT"
    C = InputBox(MSG, Title)
    If C = "Y" Or C = "y" Then GoTo DataRemoval
    If C = "N" Or C = "n" Or C = "" Then GoTo DataInput
    GoTo AskReply1
DataRemoval:
   ActiveWorkbook.Close (False)
   GoTo SetupQuit
   Exit Sub
 End If
CompName = ThisWorkbook.Worksheets("Notes to User").Range("C6").Value
Address1 = ThisWorkbook.Worksheets("Notes to User").Range("C7").Value
Address2 = ThisWorkbook.Worksheets("Notes to User").Range("C8").Value
Address3 = ThisWorkbook.Worksheets("Notes to User").Range("C9").Value
YearEndMonth = ThisWorkbook.Worksheets("Notes to User").Range("C10").Value
DataCurrency = ThisWorkbook.Worksheets("Notes to User").Range("D10").Value
DataFilePath = ThisWorkbook.Worksheets("Notes to User").Range("C11").Value
DataFileName = ThisWorkbook.Worksheets("Notes to User").Range("C12").Value & "-" & Year(Now)
If Right(DataFilePath, 1) <> "\" Then DataFilePath = DataFilePath & "\"
ThisWorkbook.Worksheets("Notes to User").Range("C1:D13").ClearContents
On Error GoTo WrongPath
  If myFSO.FolderExists(DataFilePath) = False Then
    I = Len(DataFilePath)
     For J = 3 To I
      If Mid(DataFilePath, J, 1) = "\" Then
       FilePathSub = Left(DataFilePath, J)
       If myFSO.FolderExists(FilePathSub) = False Then
        myFSO.CreateFolder (FilePathSub)
       End If
      End If
    Next J
   End If
On Error GoTo 0
ActiveWorkbook.Worksheets("ComData").Range("B1").Value = FilePath
ActiveWorkbook.Worksheets("ComData").Range("B2").Value = CompName
ActiveWorkbook.Worksheets("ComData").Range("B3").Value = Address1
ActiveWorkbook.Worksheets("ComData").Range("B4").Value = Address2
ActiveWorkbook.Worksheets("ComData").Range("B5").Value = Address3
ActiveWorkbook.Worksheets("ComData").Range("B6").Value = YearEndMonth
ActiveWorkbook.Worksheets("ComData").Range("C6").Value = DataCurrency
If YearEndMonth = 12 Then
 ActiveWorkbook.Worksheets("Raw Data").Range("A1").Value = Year(Now) & "/1/1"
Else
 ActiveWorkbook.Worksheets("Raw Data").Range("A1").Value = Year(Now) & "/" & YearEndMonth + 1 & "/1"
End If
FileUpdateXls:
    If myFSO.FileExists(DataFilePath & DataFileName & ".xlsm") = True Then
AskReply3:
      MSG = "Old Data file with the same name " & DataFileName & ".xlsm is found." + Chr(13) + _
      Chr(13) + Chr(13) + "Enter 'I' --- to Import the Old Data File;" & Chr(13) & _
      "         'D' --- to Delete the Old File;" & Chr(13) & _
      "         'R' --- to Return to Company Data Input Screen;"
      Title = "ALERT"
      C = InputBox(MSG, Title)
   If C = "I" Or C = "i" Then
       DExtn = ".xlsm"
       ActiveWorkbook.Close (False)
    On Error GoTo WrongImportFile
       Workbooks.Open DataFilePath & DataFileName & ".xlsm"
       Workbooks(DataFileName & ".xlsm").Activate
        I = ActiveWorkbook.Worksheets.Count
    I = ActiveWorkbook.Worksheets.Count
  If I < 22 Then GoTo WrongDataFile
    Worksheets("Raw Data").Activate
    Worksheets("YearStartDat").Activate
    Worksheets("ComData").Activate
    Worksheets("Chart of Account").Activate
    Worksheets("Receivable").Activate
    Worksheets("ProInvoice").Activate
    Worksheets("Customer Data").Activate
    Worksheets("Product Data").Activate
    Worksheets("PayRec").Activate
    Worksheets("Supplier Data").Activate
    Worksheets("Payable").Activate
    Worksheets("Supply Data").Activate
    Worksheets("PORecord").Activate
    Worksheets("PayMake").Activate
    Worksheets("StockRec").Activate
    Worksheets("IOData").Activate
    Worksheets("BuildRec").Activate
    Worksheets("StockAdRec").Activate
    Worksheets("CountRec").Activate
    Worksheets("BOM1").Activate
     J = Range("A9").Value
    If J > 1 Then
     For I = 2 To J
      ShName = "BOM" & I
      Worksheets(ShName).Activate
     Next I
    End If
     Worksheets("InvDetail1").Activate
     J = Range("B1").Value
    If J > 1 Then
     For I = 2 To J
      ShName = "InvDetail" & I
      Worksheets(ShName).Activate
     Next I
    End If
  On Error GoTo 0
    GoTo ImportFile
   End If
     If C = "D" Or C = "d" Then GoTo FileUpdateXlsm
     If C = "R" Or C = "r" Then GoTo DataInput
      GoTo AskReply3
   End If
FileUpdateXlsm:
   Application.DisplayAlerts = False
    ActiveWorkbook.SaveAs DataFilePath & DataFileName & ".xlsm", FileFormat:=52
    Application.DisplayAlerts = True
ImportFile:
 On Error GoTo WrongDataFile
Workbooks.Open ThisWorkbook.Path & "\" & RawSystemName
Workbooks(RawSystemName).Activate
  I = ActiveWorkbook.Worksheets.Count
  If I < 21 Then GoTo WrongDataFile
    ActiveWorkbook.Worksheets("System Menu").Activate
    ActiveWorkbook.Worksheets("ComFactSheet").Activate
  On Error GoTo 0
ActiveWorkbook.Worksheets("System Menu").Range("C4").Value = DataFileName
ActiveWorkbook.Worksheets("ComFactSheet").Range("A18").Value = DataFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B18").Value = DataFileName
ActiveWorkbook.Worksheets("ComFactSheet").Range("C18").Value = DExtn
ActiveWorkbook.Worksheets("ComFactSheet").Range("A17").Value = DataFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B17").Value = DataFileName
ActiveWorkbook.Worksheets("ComFactSheet").Range("C17").Value = DExtn
ActiveWorkbook.Worksheets("System Menu").Range("C5").Value = DataFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B1").Value = FilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B7").Value = 0
ActiveWorkbook.Worksheets("ComFactSheet").Range("B8").Value = ""
ActiveWorkbook.Worksheets("ComFactSheet").Range("B9").NumberFormat = "yyyy/m/d"
ActiveWorkbook.Worksheets("ComFactSheet").Range("B9").Value = Date
ActiveWorkbook.Worksheets("ComFactSheet").Cells(2, 13).Value = ""
ActiveWorkbook.Worksheets("ComFactSheet").Range("DE321").Value = Date
ActiveWorkbook.Worksheets("ComFactSheet").Range("C11").Value = DriveSN
ActiveWorkbook.Worksheets("ComFactSheet").Range("A6").Value = DPaper
ActiveWorkbook.Worksheets("ComFactSheet").Range("A7").Value = DPaper
ActiveWorkbook.Worksheets("ComFactSheet").Range("A21").Value = DataFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B21").Value = DataFileName
ActiveWorkbook.Worksheets("ComFactSheet").Range("C21").Value = DExtn
ActiveWorkbook.Worksheets("ComFactSheet").Range("B2").Value = CompName
ActiveWorkbook.Worksheets("ComFactSheet").Range("B3").Value = Address1
ActiveWorkbook.Worksheets("ComFactSheet").Range("B4").Value = Address2
ActiveWorkbook.Worksheets("ComFactSheet").Range("B5").Value = Address3
ActiveWorkbook.Worksheets("ComFactSheet").Range("B6").Value = YearEndMonth
On Error Resume Next
ActiveWorkbook.Worksheets("Invoice").PageSetup.PaperSize = DPaper
ActiveWorkbook.Worksheets("PO").PageSetup.PaperSize = DPaper
On Error GoTo 0
Call InsCodeGen("")
Call KeyGen("")
On Error GoTo FileSaveFail
 ActiveWorkbook.Worksheets("System Menu").Activate
 Range("C4").Select
  ActiveWorkbook.SaveAs FilePath & SystemName, FileFormat:=52
On Error GoTo 0
Workbooks(DataFileName & DExtn).Worksheets("ComData").Range("B11").Value = ActiveWorkbook.Worksheets("ComFactSheet").Range("B11").Value
If Workbooks(DataFileName & DExtn).Worksheets("ComData").Range("B9").Value = "" Then _
Workbooks(DataFileName & DExtn).Worksheets("ComData").Range("B9").Value = Date
Workbooks(DataFileName & DExtn).Worksheets("ComData").Range("DE213").Value = ActiveWorkbook.Worksheets("ComFactSheet").Range("B12").Value
If Workbooks(DataFileName & DExtn).Worksheets("ComData").Range("DE123").Value = "" Then _
Workbooks(DataFileName & DExtn).Worksheets("ComData").Range("DE123").Value = Date
Workbooks(DataFileName & DExtn).Save
Workbooks(DataFileName & DExtn).Close (False)
 Call CreateIcon("")
Exit Sub
FileSaveFail:
 MsgBox ("System Problem !!!" & Chr(13) & Chr(13) & "System File Saving Error")
  Application.DisplayAlerts = False
  ActiveWorkbook.Close (False)
  ThisWorkbook.Activate
  Application.EnableEvents = True
  ThisWorkbook.Saved = True
  Application.Quit
  Exit Sub
WrongPath:
UserForm2.Label8.BackColor = &HC0&
UserForm2.Label8.ForeColor = &HFFFF&
UserForm2.Label8.Caption = "Incorrect Data File Path, Please correct it before proceed"
UserForm2.Label8.Visible = True
UserForm2.TextBox5.Text = DataFilePath
UserForm2.Show
GoTo CompanyDataInput
Exit Sub
WrongDataFile:
  MsgBox ("The required Valid Files are not found." & Chr(13) & Chr(13) & "Setup will not proceed")
  Application.DisplayAlerts = False
  ActiveWorkbook.Close (False)
  ThisWorkbook.Activate
  Application.EnableEvents = True
  ThisWorkbook.Saved = True
  Application.Quit
  Exit Sub
WrongImportFile:
 MsgBox ("The File Imported is not a Valid File." & Chr(13) & Chr(13) & "Setup will not proceed")
 Application.DisplayAlerts = False
  ActiveWorkbook.Close (False)
SetupQuit:
  ThisWorkbook.Activate
  Application.EnableEvents = True
  ThisWorkbook.Saved = True
  Application.Quit
End Sub
Sub OldSystem(SetA As String)
Dim DataFileNameA As String, DataFileNameB As String, FileBExtn As String, SystemPath As String, CompName As String, Address1 As String, Address2 As String, Address3 As String
Dim InsDate As Date, ControlCode As String, YearEndMonth As Long, InitialData As String, SetupDate As Date, DefaultFilePath As String
Dim ProductAct As String, SNnum As String, InsCode As String, TrialUsed As Long, ActCode As String, KeyCode As String
Dim MultiCompany As String, VersionType As String, I As Long, J As Long, PassCode As String
Dim InvPaper As Long, POPaper As Long
  I = Workbooks.Count
  Do While I > 0
   If UCase(Workbooks(I).Name) = UCase(OldSystemName) Then
     MsgBox ("The MMT Account System is currently opened and running." & Chr(13) & Chr(13) & "Setup will not proceed")
     Application.ScreenUpdating = True
     Application.EnableEvents = True
     ThisWorkbook.Close (False)
    Exit Sub
   End If
   I = I - 1
  Loop
 On Error GoTo WrongDataFile
 Workbooks.Open FilePath & OldSystemName
 Workbooks(OldSystemName).Activate
  I = ActiveWorkbook.Worksheets.Count
  If I < 21 Then GoTo WrongDataFile
    ActiveWorkbook.Worksheets("System Menu").Activate
    ActiveWorkbook.Worksheets("ComFactSheet").Activate
  On Error GoTo 0
DataFileNameA = ActiveWorkbook.Worksheets("System Menu").Range("C4").Value
DataFilePath = ActiveWorkbook.Worksheets("ComFactSheet").Range("A18").Value
DataFileNameB = ActiveWorkbook.Worksheets("ComFactSheet").Range("B18").Value
FileBExtn = ActiveWorkbook.Worksheets("ComFactSheet").Range("C18").Value
DefaultFilePath = ActiveWorkbook.Worksheets("System Menu").Range("C5").Value
SystemPath = ActiveWorkbook.Worksheets("ComFactSheet").Range("B1").Value
CompName = ActiveWorkbook.Worksheets("ComFactSheet").Range("B2").Value
Address1 = ActiveWorkbook.Worksheets("ComFactSheet").Range("B3").Value
Address2 = ActiveWorkbook.Worksheets("ComFactSheet").Range("B4").Value
Address3 = ActiveWorkbook.Worksheets("ComFactSheet").Range("B5").Value
InsDate = ActiveWorkbook.Worksheets("ComFactSheet").Range("DE321").Value
DriveSN = ActiveWorkbook.Worksheets("ComFactSheet").Range("C11").Value
InvPaper = ActiveWorkbook.Worksheets("ComFactSheet").Range("A6").Value
POPaper = ActiveWorkbook.Worksheets("ComFactSheet").Range("A7").Value
ControlCode = ActiveWorkbook.Worksheets("ComFactSheet").Range("DE123").Value
YearEndMonth = ActiveWorkbook.Worksheets("ComFactSheet").Range("B6").Value
InitialData = ActiveWorkbook.Worksheets("ComFactSheet").Range("B7").Value
PassCode = ActiveWorkbook.Worksheets("ComFactSheet").Range("B8").Value
SetupDate = ActiveWorkbook.Worksheets("ComFactSheet").Range("B9").Value
ProductAct = ActiveWorkbook.Worksheets("ComFactSheet").Range("B10").Value
SNnum = ActiveWorkbook.Worksheets("ComFactSheet").Range("B11").Value
InsCode = ActiveWorkbook.Worksheets("ComFactSheet").Range("B12").Value
TrialUsed = ActiveWorkbook.Worksheets("ComFactSheet").Range("B14").Value
MultiCompany = ActiveWorkbook.Worksheets("ComFactSheet").Cells(1, 13).Value
VersionType = ActiveWorkbook.Worksheets("ComFactSheet").Range("C15").Value
ActCode = ActiveWorkbook.Worksheets("ComFactSheet").Cells(2, 13).Value
KeyCode = ActiveWorkbook.Worksheets("ComFactSheet").Cells(3, 13).Value
If ActCode <> "Yes" And MultiCompany = "" Then MultiCompany = "Multi-ARP"
ActiveWorkbook.Worksheets("ComFactSheet").Activate
Range("A21").Select
If Range("A22").Value = "" Then
 J = 21
Else
 Range("A20").End(xlDown).Select
 J = ActiveCell.Row
End If
Range("A20:C" & J).Select
Selection.Copy
ThisWorkbook.Activate
Worksheets("WaitNote").Range("G220").Select
ActiveSheet.Paste
Application.CutCopyMode = False
Workbooks(OldSystemName).Activate
ActiveWorkbook.Close (False)
Workbooks.Open ThisWorkbook.Path & "\" & RawSystemName
Workbooks(RawSystemName).Activate
  On Error GoTo WrongDataFile
  I = ActiveWorkbook.Worksheets.Count
  If I < 21 Then GoTo WrongDataFile
    ActiveWorkbook.Worksheets("System Menu").Activate
    ActiveWorkbook.Worksheets("ComFactSheet").Activate
  On Error GoTo 0
ActiveWorkbook.Worksheets("System Menu").Range("C4").Value = DataFileNameA
ActiveWorkbook.Worksheets("ComFactSheet").Range("A18").Value = DataFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B18").Value = DataFileNameB
ActiveWorkbook.Worksheets("ComFactSheet").Range("C18").Value = FileBExtn
ActiveWorkbook.Worksheets("ComFactSheet").Range("A17").Value = DataFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B17").Value = DataFileNameB
ActiveWorkbook.Worksheets("ComFactSheet").Range("C17").Value = FileBExtn
ActiveWorkbook.Worksheets("System Menu").Range("C5").Value = DefaultFilePath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B1").Value = SystemPath
ActiveWorkbook.Worksheets("ComFactSheet").Range("B2").Value = CompName
ActiveWorkbook.Worksheets("ComFactSheet").Range("B3").Value = Address1
ActiveWorkbook.Worksheets("ComFactSheet").Range("B4").Value = Address2
ActiveWorkbook.Worksheets("ComFactSheet").Range("B5").Value = Address3
ActiveWorkbook.Worksheets("ComFactSheet").Range("B7").Value = "Activated"
ActiveWorkbook.Worksheets("ComFactSheet").Range("B8").Value = PassCode
ActiveWorkbook.Worksheets("ComFactSheet").Range("DE321").Value = InsDate
ActiveWorkbook.Worksheets("ComFactSheet").Range("C11").Value = DriveSN
ActiveWorkbook.Worksheets("ComFactSheet").Range("A6").Value = InvPaper
ActiveWorkbook.Worksheets("ComFactSheet").Range("A7").Value = POPaper
ActiveWorkbook.Worksheets("ComFactSheet").Range("DE123").Value = ControlCode
ActiveWorkbook.Worksheets("ComFactSheet").Range("B6").Value = YearEndMonth
ActiveWorkbook.Worksheets("ComFactSheet").Range("B7").Value = InitialData
ActiveWorkbook.Worksheets("ComFactSheet").Range("B9").Value = SetupDate
ActiveWorkbook.Worksheets("ComFactSheet").Range("B10").Value = ProductAct
ActiveWorkbook.Worksheets("ComFactSheet").Range("B11").Value = SNnum
ActiveWorkbook.Worksheets("ComFactSheet").Range("B12").Value = InsCode
ActiveWorkbook.Worksheets("ComFactSheet").Range("B14").Value = TrialUsed
If ActCode = "Yes" Then
  ActiveWorkbook.Worksheets("ComFactSheet").Cells(1, 13).Value = MultiCompany
  ActiveWorkbook.Worksheets("ComFactSheet").Range("C15").Value = VersionType
End If
ActiveWorkbook.Worksheets("ComFactSheet").Cells(2, 13).Value = ActCode
ActiveWorkbook.Worksheets("ComFactSheet").Cells(3, 13).Value = KeyCode
ThisWorkbook.Worksheets("WaitNote").Activate
Range("G220").CurrentRegion.Select
Selection.Cut
Workbooks(RawSystemName).Worksheets("ComFactSheet").Activate
Range("A20").Select
ActiveSheet.Paste
Application.CutCopyMode = False
On Error Resume Next
ActiveWorkbook.Worksheets("Invoice").PageSetup.PaperSize = InvPaper
ActiveWorkbook.Worksheets("PO").PageSetup.PaperSize = POPaper
On Error GoTo FileSaveFail
 ActiveWorkbook.Worksheets("System Menu").Activate
 Range("C4").Select
  ActiveWorkbook.SaveAs FilePath & SystemName, FileFormat:=52
On Error GoTo 0
 Call CreateIcon("")
 Exit Sub
FileSaveFail:
  MsgBox ("System Problem !!!" & Chr(13) & Chr(13) & "System File Saving Error")
  Application.DisplayAlerts = False
  ActiveWorkbook.Close (False)
  ThisWorkbook.Activate
  Application.EnableEvents = True
  ThisWorkbook.Saved = True
  Application.Quit
  Exit Sub
WrongDataFile:
  MsgBox ("The required Valid Files are not found." & Chr(13) & Chr(13) & "Setup will not proceed")
  ActiveWorkbook.Close (False)
  ThisWorkbook.Activate
  Application.DisplayAlerts = False
  Application.EnableEvents = True
  ThisWorkbook.Saved = True
   Application.Quit
End Sub
Sub InsCodeGen(SetA As String)
Dim InsCode As String, SoftType As String, SetupDate As Date, C1 As String, C2 As String, C3 As String, C4 As String, C5 As String
Dim ORnum As String, C6 As String, C7 As String, C8 As String, C9 As String, C10 As String
ORnum = ActiveWorkbook.Worksheets("ComFactSheet").Range("B11").Value
SoftType = Left(ORnum, 1)
SetupDate = ActiveWorkbook.Worksheets("ComFactSheet").Range("B9").Value
C1 = CharCon(Val(Right(Year(SetupDate), 2)))
C3 = CharCon(Month(SetupDate))
C5 = CharCon(Day(SetupDate))
C7 = CharCon(DriveSN Mod 31)
C10 = Right(ORnum, 1)
C9 = Mid(ORnum, 6, 1)
C8 = CharCon(Val(Mid(ORnum, 2, 1)) + (Val(Right(Year(SetupDate), 2)) + (DriveSN Mod 31)) Mod 7)
C6 = CharCon(Val(Mid(ORnum, 3, 1)) + Month(SetupDate))
C4 = CharCon(Val(Mid(ORnum, 4, 1)) + (Day(SetupDate) Mod 10))
C2 = CharCon(Val(Mid(ORnum, 5, 1)) + (DriveSN Mod 31) Mod 11)
InsCode = SoftType & C1 & C2 & C3 & C4 & C5 & C6 & C7 & C8 & C9 & C10
ActiveWorkbook.Worksheets("ComFactSheet").Range("B12").Value = InsCode
End Sub
Sub KeyGen(SetA As String)
Dim A As String, SoftType As String, SetupDate As Date, C1 As Long, C2 As Long, C3 As Long, C4 As Long, C5 As Long
Dim Key As String, C6 As Long, C7 As Long, C8 As Long, C9 As String, C10 As String
Dim B1 As String, B2 As String, B3 As String, B4 As String, CD2 As Long, Num As Long, TextNum As String
A = ActiveWorkbook.Worksheets("ComFactSheet").Range("B12").Value
SoftType = Left(A, 1)
C10 = Right(A, 1)
C9 = Mid(A, 10, 1)
C1 = NumCon(Mid(A, 2, 1))
C2 = NumCon(Mid(A, 3, 1))
C3 = NumCon(Mid(A, 4, 1))
C4 = NumCon(Mid(A, 5, 1))
C5 = NumCon(Mid(A, 6, 1))
C6 = NumCon(Mid(A, 7, 1))
C7 = NumCon(Mid(A, 8, 1))
C8 = NumCon(Mid(A, 9, 1))
B1 = C8 - ((C1 + C7) Mod 7)
B2 = C6 - C3
B3 = C4 - (C5 Mod 10)
B4 = C2 - (C7 Mod 11)
Num = Val(C2 & C4 & C6) + Val(B1 & B2 & B3 & B4)
TextNum = "" & Num
If Len(TextNum) < 4 Then TextNum = Right(("0000" & TextNum), 4)
CD2 = 11 - (Num Mod 11)
If CD2 = 11 Then CD2 = 0
 If CD2 <> 10 Then
   Key = SoftType & TextNum & CD2
 Else
   Key = SoftType & TextNum & "A"
 End If
ActiveWorkbook.Worksheets("ComFactSheet").Range("M3").Value = Key
End Sub

Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
Dim myFSO As Object
 Application.EnableCancelKey = xlDisabled
 On Error GoTo WrongSetupFile
    Worksheets("WaitNote").Activate
    Worksheets("Notes to User").Activate
  On Error GoTo 0
If Val(Application.Version) < 12 Then
    MsgBox ("This software supports Excel versions 2007 or later. " & Chr(13) & Chr(13) & "Setup cannot be proceeded because older version Excel is detected")
    ThisWorkbook.Close (False)
    Exit Sub
End If
  If Workbooks.Count > 2 Then
    MsgBox ("There are other Excel files opened." & Chr(13) & Chr(13) & "Please close all Excel files before proceeding Setup")
    ThisWorkbook.Close (False)
    End
  ElseIf Workbooks.Count = 2 Then
   If Workbooks(1).Path = "" And Workbooks(1).Saved = True Then
     Workbooks(1).Close (False)
   Else
    MsgBox ("There are other Excel files opened " & Chr(13) & Chr(13) & "Please close all Excel files before proceeding Setup")
    ThisWorkbook.Close (False)
    End
   End If
  End If
Set myFSO = CreateObject("Scripting.FileSystemObject")
If myFSO.FileExists(ThisWorkbook.Path & "\AcctFile.xlsm") <> True Then
  MsgBox ("The required files are not found." & Chr(13) & Chr(13) & "Setup will not proceed")
  Application.Quit
  Exit Sub
End If
 FileMode = ""
Call Installation("")
Exit Sub
WrongSetupFile:
  MsgBox ("System Error !!!  File Corrupted. Setup will not proceed")
 Application.Quit
End Sub
Attribute VB_Name = "UserForm2"
Attribute VB_Base = "0{81BD715A-CF87-472E-A25A-2C5904F24F05}{BDE42F3B-A6CB-44F0-A2A1-963425FCD116}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public FileName As String
Private Sub ComboBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = ""
If ComboBox1.ListIndex < 0 Or ComboBox1.ListIndex > 11 Then
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
Label8.Caption = "                   Incorrect Year End Month"
Label8.Visible = True
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
Else
Label8.BackColor = &H4000&
Label8.ForeColor = &HFFFF&
Label8.Visible = False
End If
TextBox6.Text = ""
TextBox6.Text = FileName
End Sub
Private Sub ComboBox2_Enter()
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = ""
Label13.Visible = True
End Sub
Private Sub ComboBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim CurCode As String, I As Long, J As Long, FinalCode As String
If ComboBox2.Value = "" Then GoTo Finish
 CurCode = UCase(ComboBox2.Value)
If Left(CurCode, 1) = " " Then
 I = Len(CurCode)
 J = 1
 Do While J <= I And Mid(CurCode, J, 1) = " "
  J = J + 1
 Loop
  CurCode = Right(CurCode, I - J + 1)
End If
If Right(CurCode, 1) = " " Then
 I = Len(CurCode)
 J = I
 Do While J > 0 And Mid(CurCode, J, 1) = " "
  J = J - 1
 Loop
  CurCode = Left(CurCode, J)
End If
If Len(CurCode) <> 3 Then
 ComboBox2.Value = CurCode
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = Chr(13) & "  Incorrect Currency Code, It must be made up with 3 Alphabets"
 Label8.Visible = True
 ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
Else
 FinalCode = ""
 For I = 1 To 3
  If Asc(Mid(CurCode, I, 1)) >= 65 And Asc(Mid(CurCode, I, 1)) <= 90 Then
    FinalCode = FinalCode + Mid(CurCode, I, 1)
  End If
 Next I
 ComboBox2.Value = FinalCode
 If Len(FinalCode) <> 3 Then
  Label8.BackColor = &HC0&
  Label8.ForeColor = &HFFFF&
  Label8.Caption = Chr(13) & "  Incorrect Currency Code, It must be made up with 3 Alphabets"
  Label8.Visible = True
  ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
 Else
  Label8.BackColor = &H4000&
  Label8.ForeColor = &HFFFF&
  Label8.Visible = False
 End If
End If
Finish:
Label13.Visible = False
End Sub
Private Sub TextBox1_Exit(ByVal Cancel As MSForms.ReturnBoolean)
TextBox6.Text = ""
TextBox6.Text = FileName
End Sub
Private Sub TextBox2_Exit(ByVal Cancel As MSForms.ReturnBoolean)
TextBox6.Text = ""
TextBox6.Text = FileName
End Sub
Private Sub TextBox3_Exit(ByVal Cancel As MSForms.ReturnBoolean)
TextBox6.Text = ""
TextBox6.Text = FileName
End Sub
Private Sub TextBox4_Exit(ByVal Cancel As MSForms.ReturnBoolean)
TextBox6.Text = ""
TextBox6.Text = FileName
End Sub
Private Sub TextBox5_Exit(ByVal Cancel As MSForms.ReturnBoolean)
Dim myFSO As Object, FilePathSub As String, I As Long, J As Long
Label8.Visible = False
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = ""
If TextBox5.Text <> "" And Right(TextBox5.Text, 1) <> "\" Then TextBox5.Text = TextBox5.Text & "\"
DataFilePath = TextBox5.Text
    I = Len(DataFilePath)
    J = 3
    Do While J < I
    If Mid(DataFilePath, J, 1) = ":" Then
       DataFilePath = Left(DataFilePath, J - 1) & Right(DataFilePath, I - J)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
    J = 3
    Do While J < I
     If Mid(DataFilePath, J, 2) = "\\" Then
       DataFilePath = Left(DataFilePath, J) & Right(DataFilePath, I - J - 1)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
On Error GoTo WrongPath
 Set myFSO = CreateObject("Scripting.FileSystemObject")
  If myFSO.FolderExists(DataFilePath) = False Then
    I = Len(DataFilePath)
    If I > 2 Then
     For J = 3 To I
      If Mid(DataFilePath, J, 1) = "\" Then
       FilePathSub = Left(DataFilePath, J)
       If myFSO.FolderExists(FilePathSub) = False Then
        myFSO.CreateFolder (FilePathSub)
       End If
      End If
     Next J
    Else
     GoTo WrongPath
    End If
   End If
On Error GoTo 0
TextBox5.Text = DataFilePath
TextBox6.Text = ""
TextBox6.Text = FileName
 Exit Sub
WrongPath:
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
Label8.Caption = "Incorrect Data File Path, Please correct it before proceed"
Label8.Visible = True
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
End Sub
Private Sub TextBox6_AfterUpdate()
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = ""
TextBox6.Text = UCase(TextBox6.Text)
 If TextBox6.Text = "" Then
   Label8.BackColor = &HC0&
   Label8.ForeColor = &HFFFF&
   Label8.Caption = "Please enter the File name"
   Label8.Visible = True
   ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
 End If
 FileName = TextBox6
End Sub
Private Sub TextBox6_Change()
Dim I As Long
For I = 1 To Len(TextBox6.Text)
 If Abs(Asc(Mid(TextBox6.Text, I, 1))) > 255 Then GoTo Nocheck
 If Asc(Mid(TextBox6.Text, I, 1)) < 45 Or Asc(Mid(TextBox6.Text, I, 1)) > 122 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 90 And Asc(Mid(TextBox6.Text, I, 1)) < 95 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 95 And Asc(Mid(TextBox6.Text, I, 1)) < 97 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 57 And Asc(Mid(TextBox6.Text, I, 1)) < 65 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 45 And Asc(Mid(TextBox6.Text, I, 1)) < 48 Then GoTo WrongInput
Nocheck:
Next I
Label8.Caption = " Data File Name Prefix is recommended to contain 4 to 6 characters"
Label8.BackColor = &H4000&
Label8.ForeColor = &HFFFF&
Label8.Visible = True
Exit Sub
WrongInput:
Label8.Caption = "Wrong Data File name. No symbol is allowed except '-' and '_'"
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
End Sub
Private Sub UserForm_Initialize()
ComboBox1.AddItem "1"
ComboBox1.AddItem "2"
ComboBox1.AddItem "3"
ComboBox1.AddItem "4"
ComboBox1.AddItem "5"
ComboBox1.AddItem "6"
ComboBox1.AddItem "7"
ComboBox1.AddItem "8"
ComboBox1.AddItem "9"
ComboBox1.AddItem "10"
ComboBox1.AddItem "11"
ComboBox1.AddItem "12"
ComboBox1.Value = "3"
ComboBox2.AddItem "AUD"
ComboBox2.AddItem "CAD"
ComboBox2.AddItem "CHF"
ComboBox2.AddItem "EUR"
ComboBox2.AddItem "GBP"
ComboBox2.AddItem "HKD"
ComboBox2.AddItem "JPY"
ComboBox2.AddItem "KRW"
ComboBox2.AddItem "MOP"
ComboBox2.AddItem "MYR"
ComboBox2.AddItem "NZD"
ComboBox2.AddItem "RMB"
ComboBox2.AddItem "SGD"
ComboBox2.AddItem "THB"
ComboBox2.AddItem "TWD"
ComboBox2.AddItem "USD"
ComboBox2.Value = "HKD"
TextBox1.Text = "Mark-Motum Co. Ltd"
TextBox2.Text = "Flat F, 30/F., Florence Plaza"
TextBox3.Text = "23 Cheung Wah Street"
TextBox4.Text = "Cheung Sha Wan, Kowloon, HK"
Label8.BackColor = &H4000&
Label8.Caption = " Data File Name Prefix is recommended to contain 4 to 6 characters"
TextBox5.Text = FilePath
TextBox6.Text = "MARK"
FileName = "MARK"
Label11.Caption = "-yyyy" & DExtn
End Sub
Private Sub CommandButton1_Click()
Dim FileNamePrefix As String, I As Long
Dim myFSO As Object, FilePathSub As String, J As Long
 If ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error" Then
  ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = ""
  Exit Sub
 End If
If TextBox5.Text = "" Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = "                   Please enter the Data File Path"
 Label8.Visible = True
 ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
 TextBox5.SetFocus
  Exit Sub
End If
If TextBox6.Text = "" Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = "                   Please enter the Data File Name"
 Label8.Visible = True
 ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
 TextBox6.SetFocus
  Exit Sub
End If
If ComboBox1.ListIndex < 0 Or ComboBox1.ListIndex > 11 Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = "                   Incorrect Year End Month"
 Label8.Visible = True
 ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
 With ComboBox1
.SetFocus
.SelStart = 0
.SelLength = Len(ComboBox1.Value)
End With
  Exit Sub
End If
If ComboBox2.Value = "" Then
 Label8.BackColor = &HC0&
 Label8.ForeColor = &HFFFF&
 Label8.Caption = "                   Please enter the currency code"
 Label8.Visible = True
 ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
 ComboBox2.SetFocus
  Exit Sub
ElseIf Len(ComboBox2.Value) <> 3 Then
  Label8.BackColor = &HC0&
  Label8.ForeColor = &HFFFF&
  Label8.Caption = "       Incorrect Currency Code.  It must be made up with 3 Alphabets"
  Label8.Visible = True
  ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
  ComboBox2.SetFocus
  Exit Sub
End If
If Right(TextBox5.Text, 1) <> "\" Then TextBox5.Text = TextBox5.Text & "\"
DataFilePath = TextBox5.Text
    I = Len(DataFilePath)
    J = 3
    Do While J < I
    If Mid(DataFilePath, J, 1) = ":" Then
       DataFilePath = Left(DataFilePath, J - 1) & Right(DataFilePath, I - J)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
    J = 3
    Do While J < I
     If Mid(DataFilePath, J, 2) = "\\" Then
       DataFilePath = Left(DataFilePath, J) & Right(DataFilePath, I - J - 1)
       I = I - 1
       J = J - 1
      End If
     J = J + 1
    Loop
On Error GoTo WrongPath
 Set myFSO = CreateObject("Scripting.FileSystemObject")
  If myFSO.FolderExists(DataFilePath) = False Then
    I = Len(DataFilePath)
    If I > 2 Then
     For J = 3 To I
      If Mid(DataFilePath, J, 1) = "\" Then
       FilePathSub = Left(DataFilePath, J)
       If myFSO.FolderExists(FilePathSub) = False Then
        myFSO.CreateFolder (FilePathSub)
       End If
      End If
     Next J
    Else
     GoTo WrongPath
    End If
   End If
On Error GoTo 0
TextBox5.Text = DataFilePath
For I = 1 To Len(TextBox6.Text)
 If Abs(Asc(Mid(TextBox6.Text, I, 1))) > 255 Then GoTo Nocheck
 If Asc(Mid(TextBox6.Text, I, 1)) < 45 Or Asc(Mid(TextBox6.Text, I, 1)) > 122 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 90 And Asc(Mid(TextBox6.Text, I, 1)) < 95 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 95 And Asc(Mid(TextBox6.Text, I, 1)) < 97 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 57 And Asc(Mid(TextBox6.Text, I, 1)) < 65 Then GoTo WrongInput
 If Asc(Mid(TextBox6.Text, I, 1)) > 45 And Asc(Mid(TextBox6.Text, I, 1)) < 48 Then GoTo WrongInput
Nocheck:
Next I
ThisWorkbook.Worksheets("Notes to User").Range("C6").Value = TextBox1.Text
ThisWorkbook.Worksheets("Notes to User").Range("C7").Value = TextBox2.Text
ThisWorkbook.Worksheets("Notes to User").Range("C8").Value = TextBox3.Text
ThisWorkbook.Worksheets("Notes to User").Range("C9").Value = TextBox4.Text
ThisWorkbook.Worksheets("Notes to User").Range("C10").Value = ComboBox1.ListIndex + 1
ThisWorkbook.Worksheets("Notes to User").Range("D10").Value = ComboBox2.Value
ThisWorkbook.Worksheets("Notes to User").Range("C11").Value = TextBox5.Text
ThisWorkbook.Worksheets("Notes to User").Range("C12").Value = TextBox6.Text
 Label8.BackColor = &H40C0&
 Label8.Caption = Chr(13) & "   Request under processing.  Please wait."
 Label8.Visible = True
 DoEvents
Unload Me
Exit Sub
WrongPath:
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
Label8.Caption = "Incorrect Data File Path, Please correct it before proceed"
Label8.Visible = True
ThisWorkbook.Worksheets("Notes to User").Range("D1").Value = "Error"
With TextBox5
.SetFocus
.SelStart = 0
.SelLength = Len(TextBox5.Text)
End With
Exit Sub
WrongInput:
Label8.Caption = "Wrong Data File name. No symbol is allowed except '-' and '_'"
Label8.BackColor = &HC0&
Label8.ForeColor = &HFFFF&
With TextBox6
.SetFocus
.SelStart = 0
.SelLength = Len(TextBox6.Text)
End With
End Sub
Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
If CloseMode = 0 Then
 ThisWorkbook.Worksheets("Notes to User").Range("C13").Value = "CANCEL"
End If
End Sub


INQUEST-PP=macro
