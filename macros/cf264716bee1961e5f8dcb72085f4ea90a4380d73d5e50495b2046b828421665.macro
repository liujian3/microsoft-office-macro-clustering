Attribute VB_Name = "Module1"
Public Function ADUserQuery() As String
Dim OS As String
Dim sMyScript As String

On Error GoTo MAC
OS = Application.OperatingSystem

    If Left(OS, 3) = "Win" Then
        
        On Error GoTo PLC
        Set objAD = CreateObject("ADSystemInfo")
        Set objUser = GetObject("LDAP://" & objAD.UserName)
        strDisplayName = objUser.DisplayName
        ADUserQuery = strDisplayName
PLC:
            If ADUserQuery = "" Then
                 On Error Resume Next
                 ADUserQuery = getUserName
                 
                     If ADUserQuery = "" Then
            
                                 inputvalue = InputBox("Form was not able get your Name." & vbCrLf & "(probably you are not using MDLZ network or VPN)" & vbCrLf & "Please enter your Full name")
                                 If inputvalue = "" Then
                                     MsgBox "Name cannot be empty!"
                                     ThisWorkbook.Close False
                                 End If
                                 ADUserQuery = inputvalue
                  
                     End If
            End If
    End If
    
    
MAC:
        #If MAC Then

            'sMyScript = "set userName to short user name of (system info)" & vbNewLine & "return userName"
            'ADUserQuery = MacScript(sMyScript)
            ADUserQuery = Environ("USER")
        #End If
        
End Function
Public Function ADEmailQuery() As String
Dim inputvalue As Variant
'Dim objAD As New ActiveDs.ADSystemInfo
'Dim objUser As ActiveDs.IASsUser

#If MAC Then
    
        inputvalue = InputBox("Please enter your valid email address")
        ADEmailQuery = inputvalue
                    
#Else
    
    On Error GoTo PLB
    Set objAD = CreateObject("ADSystemInfo")
    Set objUser = GetObject("LDAP://" & objAD.UserName)
    StrEmail = objUser.mail
    ADEmailQuery = StrEmail
        
PLB:
            If ADEmailQuery = "" Then
               On Error Resume Next
               ADEmailQuery = getUserEmailAddress
    
                    If ADEmailQuery = "" Then
                    
                        
                            
                                inputvalue = InputBox("Form was not able get your email address." & vbCrLf & "(probably you are not using MDLZ network or VPN)" & vbCrLf & "Please enter your email address")
                                If inputvalue = "" Then
                                    MsgBox "Email address cannot be empty!"
                                    ThisWorkbook.Close False
                                End If
                                ADEmailQuery = inputvalue
                            
                            
                    End If
            End If


        
#End If
    
End Function

 'MsgBox "You need to use Mondelez network or VPN connection!"

Attribute VB_Name = "Module2"
Declare PtrSafe Function WNetGetUser Lib "mpr.dll" _
Alias "WNetGetUserA" (ByVal lpName As String, _
ByVal lpUserName As String, _
lpnLength As Long) As Long
Public logonID As String


Sub getNetLogonID()

Dim nSize As Long, rtn
Dim LanID$
nSize = 150
LanID$ = Space$(nSize)
rtn = WNetGetUser("", LanID$, nSize)
logonID$ = RTrim$(LanID$)
logonID$ = Left$(logonID$, Len(logonID$) - 1)
logonID$ = UCase$(logonID$)
 'MsgBox "Network logonID is " & logonID & ".", 64
End Sub


Function getUserEmailAddress() As String
Dim outApp As Object
Set outApp = CreateObject("Outlook.Application")
getUserEmailAddress = outApp.Session.Accounts.Item(1).SmtpAddress
End Function

Function getUserName() As String
Dim outApp As Object
Set outApp = CreateObject("Outlook.Application")
getUserName = outApp.Session.Accounts.Item(1).UserName
End Function
Attribute VB_Name = "Module3"
Public res As String
Sub add_CoCd()
Dim wb As Workbook
Dim rngCntr As Range
Dim rngCoCd As Range
Dim rngLBLCoCd_end As Range
Dim rngCountryCoCd As Range
Dim rngCC As Range
Dim intLr As Long
Dim intRow As Long
Dim intRow_end As Long
Dim intColumn As Long
Dim cb As Object
Set wb = ThisWorkbook
Set rngCountryCoCd = wb.Sheets("Requestor Information").Range("rngCountry_CoCd")
intLr = wb.Sheets("Data").Cells(Rows.Count, "AC").End(xlUp).Row
Set rngCoCd = wb.Sheets("Data").Range("AC2:AC" & intLr)
Set rngLBLCoCd = wb.Sheets("Requestor Information").Range("lbl_CoCd")
Set rngLBLCoCd_end = wb.Sheets("Requestor Information").Range("lblCoCd_end")
intRow = rngLBLCoCd.Row
intRow_end = rngLBLCoCd_end.Row
intColumn = 21

    For Each rngCntr In rngCountryCoCd
        If rngCntr = "" Then GoTo NC
            For Each rngCC In rngCoCd
                If Left(rngCC, 2) = Left(rngCntr, 2) Then
                    
                    If intColumn < 75 Then
                        intColumn = intColumn
                    Else
                        intRow_end = rngLBLCoCd_end.Row
                        
                        intRow = intRow + 1
                        intColumn = 21
                        
                        If intRow = intRow_end Then
                            Rows(intRow_end).Insert shift:=xlDown
                        End If
                        
                    End If
                    
                    With wb.Sheets("Requestor Information")
                               
                        With .Cells(intRow, intColumn)
                            Set cb = wb.Sheets("Requestor Information").CheckBoxes.Add(.Left, .Top, .Width, .Height)
                            'Set cb = wb.Sheets("Requestor Information").CheckBoxes.Add(.Left, .Top, 0.45, .Height)
                        End With
                        With cb
                            .Width = 170
                            .Characters.Text = rngCC
                            '.Characters.Text = Left(rngCC, 4)
                            .Value = xlOn
                            .Display3DShading = False
                            .OnAction = "addCoCdToSummary"
                        End With
                    End With
                   
                    'intColumn = intColumn + 5
                    intColumn = intColumn + 11
                End If
            Next rngCC
NC:
    Next rngCntr

End Sub

Sub CleanCoCd()
Dim ws As Worksheet
Dim rngLBLCoCd As Range
Dim rngLBLCoCd_end As Range
Dim intRow As Long
Dim intRow_end As Long
Dim strColumnA As String
Dim strColumnB As String
Dim rngCBoxes As Range
Dim cbox As CheckBox
Set ws = ThisWorkbook.Sheets("Requestor Information")
Set rngLBLCoCd = ws.Range("lbl_CoCd")
Set rngLBLCoCd_end = ws.Range("lblCoCd_end")
intRow = rngLBLCoCd.Row
intRow_end = rngLBLCoCd_end.Row
strColumnA = "T" 'start
strColumnB = "BX" 'end
Set rngCBoxes = ws.Range(strColumnA & intRow & " : " & strColumnB & intRow_end)
                                                                         
        For Each cbox In ws.CheckBoxes
            'cbox.Select
            If Not Intersect(cbox.TopLeftCell, rngCBoxes) Is Nothing Then
                cbox.Delete
            End If
        Next cbox

End Sub

Sub addCoCdToSummary()
Dim ws As Worksheet
Dim rngLBLCoCd As Range
Dim rngLBLCoCd_end As Range
Dim intRow As Long
Dim intRow_end As Long
Dim strColumnA As String
Dim strColumnB As String
Dim rngCBoxes As Range
Dim cbox As CheckBox
Dim CoCd_sum As String
Set ws = ThisWorkbook.Sheets("Requestor Information")
Set rngLBLCoCd = ws.Range("lbl_CoCd")
Set rngLBLCoCd_end = ws.Range("lblCoCd_end")
intRow = rngLBLCoCd.Row
intRow_end = rngLBLCoCd_end.Row
strColumnA = "T" 'start
strColumnB = "BX" 'end
CoCd_sum = ""
Set rngCBoxes = ws.Range(strColumnA & intRow & " : " & strColumnB & intRow_end)
                                                                         
        For Each cbox In ws.CheckBoxes
            'cbox.Select
            If Not Intersect(cbox.TopLeftCell, rngCBoxes) Is Nothing Then
                If cbox.Value = 1 Then
                    If CoCd_sum = "" Then
                        CoCd_sum = Left(cbox.Text, 4)
                    Else
                        CoCd_sum = CoCd_sum & " , " & Left(cbox.Text, 4)
                    End If
                End If
            End If
        Next cbox

    ThisWorkbook.Sheets("Summary Sheet").Range("s_CoCd") = CoCd_sum
    
End Sub

Sub IsCoCdselected()
Dim ws As Worksheet
Dim rngCoCd As Range
Dim rngCntr As Range
Dim rngLBLCoCd As Range
Dim rngLBLCoCd_end As Range
Dim intRow As Long
Dim intRow_end As Long
Dim rC As Range
Dim ISO2 As String
Dim chk As CheckBox
Dim CntrSelection As String
Set ws = ActiveSheet
Set rngLBLCoCd = ws.Range("lbl_CoCd")
Set rngLBLCoCd_end = ws.Range("lblCoCd_end")
intRow = rngLBLCoCd.Row
intRow_end = rngLBLCoCd_end.Row
Set rngCntr = ThisWorkbook.Sheets("Requestor Information").Range("rngCountry_CoCd")
Set rngCoCd = ThisWorkbook.Sheets("Requestor Information").Range("T" & intRow & ":BX" & intRow_end)
res = ""
    For Each rC In rngCntr
        CntrSelection = ""
        If rC = "" Then GoTo NN
            ISO2 = Left(rC, 2)
                For Each chk In ws.CheckBoxes
                        If Not Intersect(chk.TopLeftCell, rngCoCd) Is Nothing And _
                            Not Intersect(chk.BottomRightCell, rngCoCd) Is Nothing Then
                                If chk.Value = 1 Then
                                    If Left(chk.Caption, 2) = ISO2 Then
                                        CntrSelection = "ok"
                                            
                                    End If
                                End If
                        End If
                Next chk
        'End If
        
        
        If CntrSelection <> "ok" Then
            MsgBox "Please select at least one company code (Question 14) for country " & rC.Value
            rC.Select
            Exit Sub
        End If
NN:
    Next rC
    
    res = "ok"
    
End Sub





Attribute VB_Name = "Module4"
Sub btnPaymentBuilder_Click()
    If ThisWorkbook.Sheets("Requestor Information").Range("z_cwiipf") <> "" Then
        ActiveSheet.Range(ActiveSheet.Shapes(Application.Caller).TopLeftCell.Address).Offset(0, -5).Select
        PaymentTermsBuilder.Show
    Else
        MsgBox "You need select 'Country where invoice is paid from' first!"
        ThisWorkbook.Sheets("Requestor Information").Range("z_cwiipf").Select
    End If
End Sub
Attribute VB_Name = "PaymentTermsBuilder"
Attribute VB_Base = "0{40760FF5-98FD-491C-A936-F22AD28DE1F2}{E46EA87C-2034-4DC4-841C-A248EBCC1842}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Public rngRegion As String


Private Sub UserForm_Initialize()

Me.cmbLVL1.Visible = True
Me.cmbLVL1.Clear
Me.cmbLVL2.Visible = False
Me.Label2.Visible = False
Me.Label3.Visible = False
Me.cmbLVL3.Visible = False
Me.TextBox1.Value = ""
Me.cmdOK.Enabled = False
Call DD1

End Sub
Sub DD1()
Dim rng_DD1 As Range
Dim rng_DD1_Exception As Range
Dim ws As Worksheet
Dim rngRow As Range
Dim rngRow_Exception As Range

Set ws = ThisWorkbook.Sheets("PaymentTerms")
Set rng_DD1 = ws.Range("rngDD1")
Set rng_DD1_Exception = ws.Range("rngDD1_Exception")

 If ThisWorkbook.Sheets("Requestor Information").Range("z_cwiipf") = "FR - France" Or ThisWorkbook.Sheets("Requestor Information").Range("z_cwiipf") = "ES - Spain" Then
 
     For Each rngRow_Exception In rng_DD1_Exception.Rows
        With Me.cmbLVL1
            .AddItem rngRow_Exception.Cells(, 1).Value
            .List(.ListCount - 1, 1) = rngRow_Exception.Offset(, 2).Value
            .Locked = False
        End With
    Next rngRow_Exception

 Else
         
    For Each rngRow In rng_DD1.Rows
        With Me.cmbLVL1
            .AddItem rngRow.Cells(, 1).Value
            .List(.ListCount - 1, 1) = rngRow.Offset(, 2).Value
            .Locked = False
        End With
    Next rngRow
 End If
    
    
End Sub

Sub DD2()

Dim rng_DD2 As Range
Dim ws As Worksheet
Dim rngRow As Range
rngRegion = ThisWorkbook.Sheets("Requestor Information").Range("z_roo")
Set ws = ThisWorkbook.Sheets("PaymentTerms")
Set rng_DD2 = ws.Range("rngDD2_" & rngRegion)

         
    For Each rngRow In rng_DD2.Rows
        With Me.cmbLVL2
            .AddItem rngRow.Cells(, 1).Value
            .List(.ListCount - 1, 1) = rngRow.Offset(, 2).Value
            .Locked = False
        End With
    Next rngRow
    
Me.cmbLVL2.Visible = True
Me.Label2.Visible = True

End Sub

Sub DD3()
Dim rng_DD3 As Range
Dim ws As Worksheet
Dim rngRow As Range
rngRegion = ThisWorkbook.Sheets("Requestor Information").Range("z_roo")
Set ws = ThisWorkbook.Sheets("PaymentTerms")
Set rng_DD3 = ws.Range("rngDD3_" & rngRegion)

         
    For Each rngRow In rng_DD3.Rows
        With Me.cmbLVL3
            .AddItem rngRow.Cells(, 1).Value
            .List(.ListCount - 1, 1) = rngRow.Offset(, 2).Value
            .Locked = False
        End With
    Next rngRow
    
Me.cmbLVL3.Visible = True
Me.Label3.Visible = True

End Sub
Private Sub cmbLVL1_Change()
If Me.cmbLVL1.Value & "" <> "" Then
    If Me.cmbLVL1.Value = "Other" Then
        Call DD2
        Me.Warning.Visible = True
    Else
        Me.TextBox1.Value = Me.cmbLVL1.Value
        Me.cmdOK.Enabled = True
    End If
End If
End Sub
Private Sub cmbLVL2_Change()
If Me.cmbLVL2.Value & "" <> "" Then
    If Me.cmbLVL2.Value = "Other" Then
        Call DD3
    Else
        Me.TextBox1.Value = Me.cmbLVL2.Value
        Me.cmdOK.Enabled = True
    End If
End If
End Sub
Private Sub cmbLVL3_Change()
If Me.cmbLVL3.Value & "" <> "" Then
    
        Me.TextBox1.Value = Me.cmbLVL3.Value
        Me.cmdOK.Enabled = True
  
End If
End Sub
Private Sub cmdCancel_Click()

Unload Me
 
    ThisWorkbook.Sheets("Requestor Information").Activate
    ThisWorkbook.Sheets("Requestor Information").Range("z_payment_terms") = ""

End Sub

Private Sub cmdOK_Click()

If Me.TextBox1.Value <> "" Then
    ActiveCell.Value = Me.TextBox1.Value
    
    Unload Me

End If
End Sub
Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_activate()
    Application.GoTo (ActiveSheet.Range("A1"))
End Sub
Private Sub Worksheet_Change(ByVal Target As Range)
Dim r11 As Range
Dim r22 As Range
Application.EnableEvents = False
Application.ScreenUpdating = False

    If Target.Cells.Count > 1 Then
        Exit Sub
    End If
    On Error GoTo ErrHandler:
    If Not Application.Intersect(Me.Range("U10:BX120"), Target) Is Nothing Then
        If IsNumeric(Target.Value) = False Then
            'Application.EnableEvents = False
            'Target.Value = StrConv(Target.Text, vbLowerCase)
            'Target.Value = StrConv(Target.Text, vbUpperCase)
            'Target.Value = StrConv(Target.Text, vbProperCase)
            Target.Value = UCase(Target.Text)
            'Application.EnableEvents = True
        End If
    End If
    
     If Not Intersect(Target, Range("z_vendor_name")) Is Nothing Then
        Set r11 = ThisWorkbook.Sheets("Requestor Information").Range("z_type_of_request")
        Set r22 = ThisWorkbook.Sheets("Requestor Information").Range("rngVendorLegalName")
        If r11.Value = "Create New Vendor" Then
            r22.Value = Range("z_vendor_name").Value
        End If
     End If
     
      
     'SOE and Ind Key
     If Not Intersect(Target, Range("SOE")) Is Nothing Then
        If Range("SOE") = "YES" Then
            If ThisWorkbook.Sheets("Requestor Information").Range("rngVendorAssesmnt") = "No" Then
                ThisWorkbook.Sheets("Requestor Information").Range("z_industry_key").Value = "SOE"
                
            End If
        End If
        
        If Range("SOE") = "" Then
            ThisWorkbook.Sheets("Requestor Information").Range("z_industry_key").Formula = "=refIndKey_Classif"
        End If
    End If
    
    'IRT mandatory for INDIA and BANGLADESH
    If Not Intersect(Target, Range("SOE")) Is Nothing Then
        If (ThisWorkbook.Sheets("Requestor Information").Range("z_cwiipf") = "IN - India" Or ThisWorkbook.Sheets("Requestor Information").Range("z_cwiipf") = "BD - Bangladesh") And Range("SOE") = "YES" Then
        MsgBox "IRT (INTERMEDIARY REQUISITION TEMPLATE) is a mandatory document for GFE/SOE and it should be attached to the VRF form"
        End If
    End If
     
     
ErrHandler:
    Application.EnableEvents = True
    Application.ScreenUpdating = True
End Sub


'Private Sub CommandButton1_Click()
Sub btn_insert1()
Application.EnableEvents = True
On Error GoTo erh
Dim FileToOpen
 Dim holdvar
 FileToOpen = Application _
    .GetOpenFilename("Package (*.*), *.*")
    
Sheets("Vendor Information").Activate
Sheets("Vendor Information").Range("BB97").Select

 If FileToOpen <> False Then
 holdvar = FileToOpen
 While InStr(holdvar, "\") > 0
 holdvar = Right(holdvar, Len(holdvar) - InStr(holdvar, "\"))
 Wend


    ActiveSheet.OLEObjects.Add(FileName:=FileToOpen, Link:=False, _
        DisplayAsIcon:=True, IconFileName:="packager.exe", IconIndex:=0, _
        IconLabel:=holdvar).Select
        Selection.Locked = False
    End If
    
erh:
Application.EnableEvents = False

End Sub

'Private Sub CommandButton2_Click()
Sub btn_insert2()
Application.EnableEvents = True
On Error GoTo erh
Dim FileToOpen
 Dim holdvar
 FileToOpen = Application _
    .GetOpenFilename("Package (*.*), *.*")
    
Sheets("Vendor Information").Activate
Sheets("Vendor Information").Range("BR97").Select
    
 If FileToOpen <> False Then
 holdvar = FileToOpen
 While InStr(holdvar, "\") > 0
 holdvar = Right(holdvar, Len(holdvar) - InStr(holdvar, "\"))
 Wend


    ActiveSheet.OLEObjects.Add(FileName:=FileToOpen, Link:=False, _
        DisplayAsIcon:=True, IconFileName:="packager.exe", IconIndex:=0, _
        IconLabel:=holdvar).Select
        Selection.Locked = False
    End If
erh:
Application.EnableEvents = False
    
End Sub

'Private Sub CommandButton3_Click()
Sub btn_insert3()
Application.EnableEvents = True
On Error GoTo erh
Dim FileToOpen
 Dim holdvar
 FileToOpen = Application _
    .GetOpenFilename("Package (*.*), *.*")
    
Sheets("Vendor Information").Activate
Sheets("Vendor Information").Range("BJ100").Select
    
 If FileToOpen <> False Then
 holdvar = FileToOpen
 While InStr(holdvar, "\") > 0
 holdvar = Right(holdvar, Len(holdvar) - InStr(holdvar, "\"))
 Wend


    ActiveSheet.OLEObjects.Add(FileName:=FileToOpen, Link:=False, _
        DisplayAsIcon:=True, IconFileName:="packager.exe", IconIndex:=0, _
        IconLabel:=holdvar).Select
        Selection.Locked = False
    End If
erh:
Application.EnableEvents = False
End Sub

'Private Sub CommandButton4_Click()
Sub btn_insert4()
Application.EnableEvents = True
On Error GoTo erh
Dim FileToOpen
 Dim holdvar
 FileToOpen = Application _
    .GetOpenFilename("Package (*.*), *.*")
    
Sheets("Vendor Information").Activate
Sheets("Vendor Information").Range("BB104").Select
    
 If FileToOpen <> False Then
 holdvar = FileToOpen
 While InStr(holdvar, "\") > 0
 holdvar = Right(holdvar, Len(holdvar) - InStr(holdvar, "\"))
 Wend


    ActiveSheet.OLEObjects.Add(FileName:=FileToOpen, Link:=False, _
        DisplayAsIcon:=True, IconFileName:="packager.exe", IconIndex:=0, _
        IconLabel:=holdvar).Select
        Selection.Locked = False
    End If
erh:
Application.EnableEvents = False
End Sub

'Private Sub CommandButton5_Click()
Sub btn_insert5()
Application.EnableEvents = True
On Error GoTo erh
Dim FileToOpen
 Dim holdvar
 FileToOpen = Application _
    .GetOpenFilename("Package (*.*), *.*")
    
Sheets("Vendor Information").Activate
Sheets("Vendor Information").Range("BR104").Select
    
 If FileToOpen <> False Then
 holdvar = FileToOpen
 While InStr(holdvar, "\") > 0
 holdvar = Right(holdvar, Len(holdvar) - InStr(holdvar, "\"))
 Wend


    ActiveSheet.OLEObjects.Add(FileName:=FileToOpen, Link:=False, _
        DisplayAsIcon:=True, IconFileName:="packager.exe", IconIndex:=0, _
        IconLabel:=holdvar).Select
        Selection.Locked = False
    End If
erh:
Application.EnableEvents = False
End Sub

'Private Sub CommandButton6_Click()
Sub SendCompletedToRequestor()

' SET Outlook APPLICATION OBJECT.
    Dim objOutlook As Object
        
    ' CREATE EMAIL OBJECT.
    Dim objEmail As Object
    
    Dim txt As String
    'Colored Code added
    Dim RNG As Range
    Dim flag As Boolean
    flag = True
    
    Set RNG = ThisWorkbook.ActiveSheet.Range("U5:BX120")
    For Each Cell In RNG
        If Cell.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(Cell.Value) = "" Then
                flag = False
                Exit For
        End If

    Next Cell
    
    If flag Then
        
            boolSave = Application.Dialogs(xlDialogSaveAs).Show
            If boolSave Then
                Set objOutlook = CreateObject("Outlook.Application")
                Set objEmail = objOutlook.CreateItem(0)
                
                On Error Resume Next
                
                txt = ActiveSheet.Range("z_vendor_name") & " " & "Response"
                Dim txt1 As String
                txt1 = Worksheets("Requestor Information").Range("z_requestor_email")
                With objEmail
                    .To = txt1
                    .Subject = txt
                    .Body = ""
                    .Display        ' DISPLAY MESSAGE.
                    .Attachments.Add ActiveWorkbook.FullName
                End With
'        Else
'            MsgBox "Action Cancelled"
'
        End If
    Else
        MsgBox "Please fill all mandatory fields highlighted in Orange"
     
        
    End If
End Sub


Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Worksheet_activate()
    Application.GoTo (ActiveSheet.Range("A1"))
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
    Dim rCCCd As Range
    Dim rr As Range
    Dim rrRange As Range
    Dim cc As Range
    Dim mergR As Range
    Dim r11 As Range
    Dim r33 As Range
    Application.ScreenUpdating = False
    Application.EnableEvents = False
    ActiveSheet.Unprotect Password:="Password"
    On Error GoTo Errh
    
    Set rrRange = ThisWorkbook.Sheets("Data").Range("Change_Sel_Mandatory")
    Set mergR = ThisWorkbook.Sheets("Vendor Information").Range("z_GST_Ven_Class")
    Set mergR2 = ThisWorkbook.Sheets("Requestor Information").Range("rngVendorAssesmnt")
    Set mergR3 = ThisWorkbook.Sheets("Vendor Information").Range("SOE")
    Set mergR4 = ThisWorkbook.Sheets("Requestor Information").Range("z_subcontracting_number")
    
    If Not Intersect(Target, Range("rngVendorLegalName")) Is Nothing Then
        Set r11 = ThisWorkbook.Sheets("Requestor Information").Range("z_type_of_request")
        Set r33 = ThisWorkbook.Sheets("Vendor Information").Range("z_vendor_name")
        If r11.Value <> "Create New Vendor" Then
            r33.Value = UCase(Range("rngVendorLegalName").Value)
        End If
    End If
    
    
    If Not Intersect(Target, Range("z_type_of_request")) Is Nothing Then
        If Range("z_type_of_request") = "Block Existing Vendor" Then
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = True
            ActiveSheet.Shapes("SubmittoSAT").Visible = False
            ActiveSheet.Range("submit_text") = "SUBMIT VRF"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Send completed form to VMaaS Team' button to SAVE & SEND the Request."
         Else
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = False
            ActiveSheet.Shapes("SubmittoSAT").Visible = True
            ActiveSheet.Range("submit_text") = "Spend Area (or other Authorised party) submit the form to the VMaaS team"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Submit form to Approver' button to SAVE & SEND the Request."
        End If
    End If
    
    If Not Intersect(Target, Range("z_type_of_request")) Is Nothing Then
        If Range("z_type_of_request") <> "Change Existing Vendor" Then
            For Each rr In rrRange
                If rr.Value = True Then
                    rr.Value = False
                End If
            Next rr
        End If
    End If
    
    
    
    
    If Not Intersect(Target, Range("z_type_of_request")) Is Nothing Then
        If Range("z_type_of_request") = "Change Existing Vendor" Then
        
            
            ActiveSheet.Range("ChangeOptionRows").EntireRow.Hidden = False
            ActiveSheet.Shapes("Check Box 95").Visible = True
            ActiveSheet.Shapes("Check Box 97").Visible = True
            ActiveSheet.Shapes("Check Box 98").Visible = True
            ActiveSheet.Shapes("Check Box 99").Visible = True
            ActiveSheet.Shapes("Check Box 101").Visible = True
            ActiveSheet.Shapes("Check Box 102").Visible = True
            ActiveSheet.Shapes("Check Box 103").Visible = True
            ActiveSheet.Shapes("Check Box 130").Visible = True
            ActiveSheet.Shapes("Check Box 133").Visible = True
            Range("AW11").Interior.Color = RGB(244, 176, 132)
            
        Else
                
            ActiveSheet.Range("ChangeOptionRows").EntireRow.Hidden = True
            ActiveSheet.Shapes("Check Box 95").Visible = False
            ActiveSheet.Shapes("Check Box 97").Visible = False
            ActiveSheet.Shapes("Check Box 98").Visible = False
            ActiveSheet.Shapes("Check Box 99").Visible = False
            ActiveSheet.Shapes("Check Box 101").Visible = False
            ActiveSheet.Shapes("Check Box 102").Visible = False
            ActiveSheet.Shapes("Check Box 103").Visible = False
            ActiveSheet.Shapes("Check Box 130").Visible = False
            ActiveSheet.Shapes("Check Box 133").Visible = False
            Range("AW11").Interior.Color = RGB(255, 255, 255)
          
        End If
                
    End If
    
 
    If Not Intersect(Target, Range("z_type_of_request")) Is Nothing Then
        Range("z_cwiipf").Value = ""
        Call CleanCoCd
        Range("rngVendorAssesmnt").Value = ""
        Range("z_vendor_classification_easy_DD").Value = ""
        Range("z_vendor_classification").Value = ""
        Range("z_industry_key").Value = ""
    End If
 
    If Not Intersect(Target, Range("z_vendor_classification_easy_DD")) Is Nothing Then
        Range("z_vendor_classification").Value = ""
    End If
    
    
    'IRT mandatory for INDIA and BANGLADESH
    If Not Intersect(Target, Range("rngVendorAssesmnt")) Is Nothing Then
        If (Range("z_cwiipf") = "IN - India" Or Range("z_cwiipf") = "BD - Bangladesh") And Range("rngVendorAssesmnt") = "Yes" Then
        MsgBox "IRT (INTERMEDIARY REQUISITION TEMPLATE) is a mandatory document for GFE/SOE and it should be attached to the VRF form"
        End If
    End If
    
    'IRT mandatory for INDIA and BANGLADESH
    If Not Intersect(Target, Range("z_industry_key")) Is Nothing Then
        If (Range("z_cwiipf") = "IN - India" Or Range("z_cwiipf") = "BD - Bangladesh") And (Range("z_industry_key") = "ZINT- Govt intermediaries" Or Range("z_industry_key") = "SOE- State Owned Entity") Then
        MsgBox "IRT (INTERMEDIARY REQUISITION TEMPLATE) is a mandatory document for GFE/SOE and it should be attached to the VRF form"
        End If
    End If
    
    'z_cwpiif is INDIA for MSME
    If Not Intersect(Target, Range("z_cwiipf")) Is Nothing Then
        If (Range("z_type_of_request") = "Create New Vendor" And Range("z_cwiipf") = "IN - India") Then
                MsgBox "Please note that for all MSME vendors it is mandate to attach the registered certificate through government of India and select the industry key to link the vendor under MSME. Default payment terms for all MSME vendors is 45days."
        End If
    End If
    
    
    'z_cwpiif is Canada
    If Not Intersect(Target, Range("z_cwiipf")) Is Nothing Then
        If (Range("z_type_of_request") = "Create New Vendor" Or Range("z_type_of_request") = "Change Existing Vendor") Then
        If Range("z_cwiipf") = "CA - Canada" Then
        MsgBox "The Canada Revenue Agency requires Mondelez Canada Inc. (CA02) to withhold income taxes on certain payments made to companies and individuals not resident in Canada where such payments are made in respect of services performed while in Canada. To be compliant it is necessary for us to obtain and maintain Form NR-301 information for all of our non-Canadian vendors.  Contact Canada Tax angelika.leon@mdlz.com for further information if required."
        End If
        End If
    End If
    
    
    'z_type_of_request
    If Not Intersect(Target, Range("z_type_of_request")) Is Nothing Then
        If Range("z_type_of_request") = "Change Existing Vendor" Or Range("z_type_of_request") = "Block Existing Vendor" Then
            mergR2.MergeArea.Locked = True
            mergR3.MergeArea.Locked = True
        Else
            mergR2.MergeArea.Locked = False
            mergR3.MergeArea.Locked = False
        End If
    End If

    
    
    If Not Intersect(Target, Range("z_cwiipf")) Is Nothing Then
    
        'for LA hide button "Submit form to Approver", unhide "Send completed form to VMaaS"
        If (Range("z_type_of_request") = "Create New Vendor" Or Range("z_type_of_request") = "Unblock Existing Vendor") Then
        If Range("z_roo") = "LA" Then
        
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = True
            ActiveSheet.Shapes("SubmittoSAT").Visible = False
            ActiveSheet.Range("submit_text") = "SUBMIT VRF"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Send completed form to VMaaS Team' button to SAVE & SEND the Request."
        Else
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = False
            ActiveSheet.Shapes("SubmittoSAT").Visible = True
            ActiveSheet.Range("submit_text") = "Spend Area (or other Authorised party) submit the form to the VMaaS team"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Submit form to Approver' button to SAVE & SEND the Request."
        End If
        End If

        
        'NA or LA Sub-Contracting
        If Range("z_roo") = "NA" Or Range("z_roo") = "LA" Then
            mergR4.MergeArea.Locked = False
        Else
            mergR4.MergeArea.Locked = True
        End If

    
        On Error Resume Next
        'ind key validation
        If Range("z_type_of_request") = "Create New Vendor" And (Range("z_roo") = "NA" Or Range("z_roo") = "EE" Or Range("z_roo") = "MEA" Or Range("z_roo") = "MEU" Or Range("z_roo") = "APAC") Then
            Range("z_industry_key").Formula = "=refIndKey_Classif"
        Else
        
            With Range("z_industry_key").Validation
                   .Delete
                   .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=refIndKey"
                   .IgnoreBlank = True
                   .InCellDropdown = True
                   .InputTitle = ""
                   .ErrorTitle = ""
                   .InputMessage = ""
                   .ErrorMessage = ""
                   .ShowInput = True
                   .ShowError = True
            End With
        End If
        


        'if INdia
        If Range("z_cwiipf").Value = "IN - India" Then
            mergR.MergeArea.Locked = False
            'ThisWorkbook.Sheets("Vendor Information").Protect Password:="Password", userinterfaceonly:=True
        Else
            mergR.MergeArea.Locked = True
        End If
    End If
    
    On Error GoTo Errh
    
    If Not Intersect(Target, Range("rngVendorAssesmnt")) Is Nothing Then
        If Range("rngVendorAssesmnt") = "Yes" Then
            Range("z_industry_key").Value = "ZINT"
            'If Range("rngVendorAssesmnt") = "NO" then check if SOE (f.64) = Yes and set "SOE"
        ElseIf Range("rngVendorAssesmnt") = "No" Then
            Range("z_industry_key").Formula = "=refIndKey_Classif"
        End If
    End If
    
   
    'If Not Intersect(Target, Range("rngCHV_ext")) Is Nothing Or Not Intersect(Target, Range("rngCHV_PT")) Is Nothing Then
    If Not Intersect(Target, Range("z_cwiipf")) Is Nothing Then
        If ActiveSheet.Range("z_type_of_request") = "Change Existing Vendor" Then
        If (ActiveSheet.CheckBoxes("Check Box 130").Value = 1 And ActiveSheet.Range("rngCHV_ext") <> "Extend to Company code of the same Country" And ActiveSheet.Range("z_roo") <> "LA") Or (ActiveSheet.CheckBoxes("Check Box 103").Value = 1 And ActiveSheet.Range("rngCHV_PT") <> "" And ActiveSheet.Range("z_roo") <> "LA") Then
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = False
            ActiveSheet.Shapes("SubmittoSAT").Visible = True
            ActiveSheet.Range("submit_text") = "Spend Area (or other Authorised party) submit the form to the VMaaS team"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Submit form to Approver' button to SAVE & SEND the Request."
        Else
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = True
            ActiveSheet.Shapes("SubmittoSAT").Visible = False
            ActiveSheet.Range("submit_text") = "SUBMIT VRF"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Send completed form to VMaaS Team' button to SAVE & SEND the Request."
        End If
        End If
    End If
    
    'Change Bank details
    If Not Intersect(Target, Range("rngCHV_bank")) Is Nothing Then
        If Range("rngCHV_bank") <> "" Then
        MsgBox "when changing supplier bank, email, phone, it is an audit requirement to include the original request (letter, email) from the supplier.  Please attach the original request (in full) from the supplier to support this change request.  Failure to include this information may mean the request is rejected."
        End If
    End If
    
    'Change Phone details
    If Not Intersect(Target, Range("rngCHV_phone")) Is Nothing Then
        If Range("rngCHV_phone") <> "" Then
        MsgBox "when changing supplier bank, email, phone, it is an audit requirement to include the original request (letter, email) from the supplier.  Please attach the original request (in full) from the supplier to support this change request.  Failure to include this information may mean the request is rejected."
        End If
    End If
    
    'Change Email details
    If Not Intersect(Target, Range("rngCHV_email")) Is Nothing Then
        If Range("rngCHV_email") <> "" Then
        MsgBox "when changing supplier bank, email, phone, it is an audit requirement to include the original request (letter, email) from the supplier.  Please attach the original request (in full) from the supplier to support this change request.  Failure to include this information may mean the request is rejected."
        End If
    End If
    
    'Change Payment Terms
    If Not Intersect(Target, Range("rngCHV_PT")) Is Nothing Then
        If ActiveSheet.CheckBoxes("Check Box 103").Value = 1 And Range("rngCHV_email") <> "" Then
        ActiveSheet.Unprotect Password:="Password"
        ActiveSheet.Range("z_payment_terms") = ""
        ActiveSheet.Range("z_payment_terms").Interior.Color = RGB(244, 176, 132)
        Else
        ActiveSheet.Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA"
        ActiveSheet.Range("z_payment_terms").Interior.Color = RGB(255, 255, 255)
        ActiveSheet.Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
        End If
    End If
    
    
   If Not Intersect(Target, Range("rngCHV_bank")) Is Nothing Then
        If Range("rngCHV_bank") = "Remove and replace existing Bank details" Then
            With Range("rngCHV_bank").Validation
             .Delete
             .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=Change_Bank_Options"
             .IgnoreBlank = True
             .InCellDropdown = True
             .InputTitle = ""
             .InputMessage = "Please advise which bank account details must be removed"
             .ShowInput = True
            End With
        End If
        
        If Range("rngCHV_bank") = "Update existing Bank details" Then
            With Range("rngCHV_bank").Validation
             .Delete
             .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=Change_Bank_Options"
             .IgnoreBlank = True
             .InCellDropdown = True
             .InputTitle = ""
             .InputMessage = "Please advise which bank account needs to be updated"
             .ShowInput = True
            End With
        End If
        
        
        If Range("rngCHV_bank") = "Add new Bank details" Then
            With Range("rngCHV_bank").Validation
             .Delete
             .Add Type:=xlValidateList, AlertStyle:=xlValidAlertStop, Operator:=xlBetween, Formula1:="=Change_Bank_Options"
             .IgnoreBlank = True
             .InCellDropdown = True
             .InputTitle = ""
             .InputMessage = ""
             '.ShowInput = True
            End With
        End If
    End If
    
   
    
    
    'test if country was already selected
    If Not Intersect(Target, Range("rngCountryCoCd")) Is Nothing Then
            For Each rCCCd In Range("rngCountryCoCd")
                If Target.Address = rCCCd.Address Then GoTo VRR
                If Target.MergeCells Then
                    If Target.Cells(1).Value = "" Then
                        Call CleanCoCd
                        GoTo VRR
                    End If
                End If
                
                'On Error GoTo VRR
                
                If Target.Value = rCCCd.Value Then
                    MsgBox "Country " & Target.Value & " is already selected"
                    GoTo LetsContinue
                End If
VRR:
            Next rCCCd
    
    End If
    
    'If Not Intersect(Target, Range("z_cwiipf")) Is Nothing Then
        'If Range("z_cwiipf") <> "" Then
            'For i = 2 To 6
                'If Range("rngCountry_CoCd" & i).Value <> "" Then
                    'Range("rngCountry_CoCd" & i).Value = ""
                'End If
           'Next i
           
           'Range("z_vendor_classification_easy_DD").Value = ""
           'Range("z_vendor_classification").Value = ""
           'Range("rngVendorAssesmnt").Value = ""
           
        'End If
    'End If
    
    
    
    If Not Intersect(Target, Range("rngCountry_CoCd")) Is Nothing Then 'all countries
        
        
        If Range("z_cwiipf") = "" Then
           For i = 2 To 6
                If Range("rngCountry_CoCd" & i).Value <> "" Then
                    Range("rngCountry_CoCd" & i).Value = ""
                End If
           Next i
           
           Range("z_vendor_classification_easy_DD").Value = ""
           Range("z_vendor_classification").Value = ""
           Range("rngVendorAssesmnt").Value = ""
           Range("z_industry_key") = ""
        End If
        Call CleanCoCd
        Call add_CoCd
        Call addCoCdToSummary
    End If
    
LetsContinue:
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    
    ActiveSheet.Protect Password:="Password", userinterfaceonly:=True
    Exit Sub
    
Errh:
     MsgBox Err.Number & vbNewLine & Err.Description
     Resume LetsContinue

    
End Sub
Sub btn_SubmittoVMaaS_Click()
' SET Outlook APPLICATION OBJECT.
    Dim objOutlook As Object
        
    ' CREATE EMAIL OBJECT.
    Dim objEmail As Object
    Dim txt As String
    Dim strUsername As String
    Dim boolSave As Boolean
    'Colored Logic
    Dim RNG1, RNG2 As Range
    Dim Cell As Range
    Dim Cell2 As Range
    Dim sh As Worksheet
    
    Dim flag As Boolean
    flag = True
    
    Set sh = ThisWorkbook.Sheets("Vendor Information")
    Set RNG1 = ThisWorkbook.ActiveSheet.Range("U5:BW120")
    Set RNG2 = ThisWorkbook.Worksheets("Vendor Information").Range("U5:BX120")
    
    
    
    If ActiveSheet.Range("lbl_CoCd").DisplayFormat.Interior.Color = RGB(244, 176, 132) Then
        Call IsCoCdselected
                If res <> "ok" Then
                    Exit Sub
                End If
    End If
     
    
'    If Range("U22").Value = "" Then
'        flag = False
'        MsgBox "Please provide Vendor Email Address", vbCritical, "Error"
'        Exit Sub
'    End If
    
    For Each Cell In RNG1
        If Cell.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(Cell.Value) = "" Then
            flag = False
            
            Exit For
        End If

    Next Cell
    
    For Each Cell2 In RNG2
        If Cell2.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(Cell2.Value) = "" Then
            flag = False
            Exit For
        End If

    Next Cell2
    
    
    If flag Then
    
        ActiveSheet.Range("sa_approver_rows").EntireRow.Hidden = False
    
        If ThisWorkbook.Worksheets("Requestor Information").Range("z_sa_approver").Value = "" Then
            ThisWorkbook.Worksheets("Requestor Information").Range("z_sa_approver").Value = ADUserQuery()
        End If

        If ThisWorkbook.Worksheets("Requestor Information").Range("z_sa_approver_email").Value = "" Then
            ThisWorkbook.Worksheets("Requestor Information").Range("z_sa_approver_email").Value = ADEmailQuery()
        End If
      
        If Range("z_sa_approver").Value = "" Then
            MsgBox "Connect to MDLZ Network or VPN to Submit the VRF"
        Else
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = False
            ActiveSheet.Shapes("SendbacktoRequestor").Visible = False
            ThisWorkbook.Worksheets("Summary Sheet").Visible = True
            
            boolSave = Application.Dialogs(xlDialogSaveAs).Show
                If boolSave Then
                Set objOutlook = CreateObject("Outlook.Application")
                Set objEmail = objOutlook.CreateItem(0)
            
                On Error Resume Next
                txt = Worksheets("Requestor Information").Range("z_roo") & "_" & Worksheets("Requestor Information").Range("z_cwiipf") & "_" & Worksheets("Requestor Information").Range("z_type_of_request") & "_" & Worksheets("Requestor Information").Range("z_vendor_number") & "_" & Worksheets("Requestor Information").Range("rngVendorLegalName")
                With objEmail
                    .To = "MBSCVendorMaster@mdlz.com"
                    .Subject = txt
                    .Body = ""
                    .Display        ' DISPLAY MESSAGE.
                    .Attachments.Add ActiveWorkbook.FullName
                End With
                End If
        End If
    Else
        MsgBox "Please fill all mandatory fields highlighted in Orange in Requestor Information & Vendor Information tab(s)"
        If Not Cell Is Nothing Then
            Cell.Select
        Else
            sh.Activate
            Cell2.Select
            
        End If
        
    End If
End Sub

Sub btn_SendToVendor_Click()

' SET Outlook APPLICATION OBJECT.
    Dim objOutlook As Object
        
    ' CREATE EMAIL OBJECT.
    Dim objEmail As Object
    
    Dim txt As String
    Dim strUsername As String
    Dim RNG, Cell As Range
    Dim flag As Boolean
    Dim boolSave As Boolean
    
    flag = True
    
    If Range("z_vendor_email") = "" Then
        flag = False
'        MsgBox "Please provide Vendor Email Address", vbCritical, "Error"
'        Exit Sub
    End If
       
    Set RNG = ThisWorkbook.ActiveSheet.Range("U9:BW37")
    For Each Cell In RNG
        If Cell.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(Cell.Value) = "" Then
            flag = False
            Exit For
        End If

    Next Cell
    
    If flag Then

            boolSave = Application.Dialogs(xlDialogSaveAs).Show
            If boolSave Then
                Set objOutlook = CreateObject("Outlook.Application")
                Set objEmail = objOutlook.CreateItem(0)
            
                On Error Resume Next
            
                txt = "Response required: We need some information to create you in our vendor database"
                Dim txt1 As String
                txt1 = ActiveSheet.Range("z_vendor_email")
                With objEmail
                    .To = txt1
                    .Subject = txt
                    .Body = ""
                    .Display        ' DISPLAY MESSAGE.
                    .Attachments.Add ActiveWorkbook.FullName
                End With
'           Else
'               MsgBox "Action Cancelled"
'
            End If
        
    Else
    
    MsgBox "Please fill all mandatory fields from 1 to 3 (Step 1 section) & Supplier's Email respectively"
    
        
    End If

         
   
End Sub
Sub btn_SubmittoSAT_Click()

    ' SET Outlook APPLICATION OBJECT.

    Dim objOutlook As Object
    ' CREATE EMAIL OBJECT.
    Dim objEmail As Object
    Dim txt As String
    Dim strUsername As String
    Dim boolSave As Boolean
    'Colored Logic
    Dim RNG1, RNG2, RNG3 As Range
    Dim Cell As Range
    Dim Cell2 As Range
    Dim flag As Boolean
    Dim sh As Worksheet
    flag = True
    
    Set sh = ThisWorkbook.Sheets("Vendor Information")
    Set RNG1 = ThisWorkbook.ActiveSheet.Range("U5:BW120")
    Set RNG2 = ThisWorkbook.Worksheets("Vendor Information").Range("U5:BX120")
    Set RNG3 = ThisWorkbook.Worksheets("Vendor Information").Range("z_pay_method")
        
    If ActiveSheet.Range("lbl_CoCd").DisplayFormat.Interior.Color = RGB(244, 176, 132) Then
        Call IsCoCdselected
                If res <> "ok" Then
                    Exit Sub
                End If
    End If
    
        
        
'    If Range("U22").Value = "" Then
'        flag = False
'        MsgBox "Please provide Vendor Email Address", vbCritical, "Error"
'        Exit Sub
'    End If
    
    For Each Cell In RNG1
        If Cell.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(Cell.Value) = "" Then
            flag = False
            Exit For
        End If

    Next Cell
    
    For Each Cell2 In RNG2
        If Cell2.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(Cell2.Value) = "" Then
            flag = False
            Exit For
        End If

    Next Cell2
    
     
    If flag Then
        ActiveSheet.Range("submit_text") = "Spend Area (or other Authorised party) submit the form to the VMaaS team"
        ActiveSheet.Range("submit_info") = "Spend Area reviewer should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Send completed form to VMaaS Team' button to SAVE & SEND the Request."
        ActiveSheet.Shapes("SubmittoSAT").Visible = False
        ActiveSheet.Shapes("SubmittoVMaaS").Visible = True
        ActiveSheet.Shapes("SendbacktoRequestor").Visible = True
        ActiveSheet.Range("sa_approver_rows").EntireRow.Hidden = False
        
        ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
       If Range("z_type_of_request") = "Create New Vendor" Then
       ActiveSheet.Unprotect Password:="Password"
       
         If Range("fin_stab_check").Value = "" Then
            Range("fin_stab_check").Interior.Color = RGB(244, 176, 132)
         End If
         
         If Range("vefbp").Value = "" Then
            Range("vefbp").Interior.Color = RGB(244, 176, 132)
         End If
         
         If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
            Range("z_payment_terms").Interior.Color = RGB(244, 176, 132)
         End If
         
         
       ActiveSheet.Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
       End If
       
        ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
       If Range("z_type_of_request") = "Change Existing Vendor" And ActiveSheet.CheckBoxes("Check Box 130").Value = 1 And ActiveSheet.Range("rngCHV_ext") <> "Extend to Company code of the same Country" And ActiveSheet.Range("z_roo") <> "LA" Then
       ThisWorkbook.Sheets("Requestor Information").Unprotect Password:="Password"
       ThisWorkbook.Sheets("Vendor Information").Unprotect Password:="Password"
       
         If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
            Range("z_payment_terms").Interior.Color = RGB(244, 176, 132)
         End If
         
         If RNG3 = "" Then
            ThisWorkbook.Worksheets("Vendor Information").Range("z_pay_method").Interior.Color = RGB(244, 176, 132)
         End If
         
       ThisWorkbook.Sheets("Requestor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
       ThisWorkbook.Sheets("Vendor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
       End If
       
        
        
        boolSave = Application.Dialogs(xlDialogSaveAs).Show
        If boolSave Then
            Set objOutlook = CreateObject("Outlook.Application")
            Set objEmail = objOutlook.CreateItem(0)
            
            On Error Resume Next
            txt = Worksheets("Requestor Information").Range("z_roo") & "_" & Worksheets("Requestor Information").Range("z_cwiipf") & "_" & Worksheets("Requestor Information").Range("z_type_of_request") & "_" & Worksheets("Requestor Information").Range("z_vendor_number") & "_" & Worksheets("Requestor Information").Range("rngVendorLegalName")
            Dim txt2 As String
            txt2 = Worksheets("Data").Range("SAT")
            With objEmail
                .To = txt2
                .Subject = txt
                .Body = ""
                .Display        ' DISPLAY MESSAGE.
                .Attachments.Add ActiveWorkbook.FullName
            End With
         Else
            ActiveSheet.Range("submit_text") = "SUBMIT VRF"
            ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Submit form to Approver' button to SAVE & SEND the Request."
            ActiveSheet.Shapes("SubmittoSAT").Visible = True
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = False
            ActiveSheet.Shapes("SendbacktoRequestor").Visible = False
            ActiveSheet.Range("sa_approver_rows").EntireRow.Hidden = True
            
            
            ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
            If Range("z_type_of_request") = "Create New Vendor" Then
            ActiveSheet.Unprotect Password:="Password"
       
            If Range("fin_stab_check").Value = "" Then
            Range("fin_stab_check").Interior.Color = RGB(255, 255, 255)
            End If
         
            If Range("vefbp").Value = "" Then
            Range("vefbp").Interior.Color = RGB(255, 255, 255)
            End If
            
            If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
            Range("z_payment_terms").Interior.Color = RGB(255, 255, 255)
            End If
            
         
            ActiveSheet.Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            End If

            ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
            If Range("z_type_of_request") = "Change Existing Vendor" And ActiveSheet.CheckBoxes("Check Box 130").Value = 1 And ActiveSheet.Range("rngCHV_ext") <> "Extend to Company code of the same Country" And ActiveSheet.Range("z_roo") <> "LA" Then
            ThisWorkbook.Sheets("Requestor Information").Unprotect Password:="Password"
            ThisWorkbook.Sheets("Vendor Information").Unprotect Password:="Password"
       
            If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
            Range("z_payment_terms").Interior.Color = RGB(255, 255, 255)
            End If
         
            If RNG3 = "" Then
            ThisWorkbook.Worksheets("Vendor Information").Range("z_pay_method").Interior.Color = RGB(255, 255, 255)
            End If
         
            ThisWorkbook.Sheets("Requestor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            ThisWorkbook.Sheets("Vendor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            End If
            
            
         End If
    Else
        MsgBox "Please fill all mandatory fields highlighted in Orange in Requestor Information & Vendor Information tab(s)"
        If Not Cell Is Nothing Then
            Cell.Select
        Else
            sh.Activate
            Cell2.Select
        End If
        
    End If
   
End Sub
Sub btn_SendbacktoRequestor_Click()
' SET Outlook APPLICATION OBJECT.

    Dim objOutlook As Object
        
    ' CREATE EMAIL OBJECT.
    Dim objEmail As Object
    
    Dim txt, txt3 As String
    
    Dim boolSave As Boolean
    'Colored Logic
'    Dim RNG4, RNG2 As Range
    Dim flag As Boolean
    flag = True
    
'    Set RNG4 = ThisWorkbook.ActiveSheet.Range("U5:U56")
'    Set RNG2 = ThisWorkbook.Worksheets("Vendor Information").Range("U5:BX87")
      
'    If Range("U22").Value = "" Then
'        flag = False
'        MsgBox "Please provide Vendor Email Address", vbCritical, "Error"
'        Exit Sub
'    End If
    
'    For Each cell In RNG4
'        If cell.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(cell.Value) = "" Then
'            flag = False
'            Exit For
'        End If

'    Next cell
    
'    For Each cell In RNG2
'        If cell.DisplayFormat.Interior.Color = RGB(244, 176, 132) And Trim(cell.Value) = "" Then
'            flag = False
'            Exit For
'        End If

'    Next cell
    
     
    If flag Then
        ActiveSheet.Range("submit_text") = "SUBMIT VRF"
        ActiveSheet.Range("submit_info") = "Requestor should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Submit form to Approver' button to SAVE & SEND the Request."
        ActiveSheet.Shapes("SubmittoSAT").Visible = True
        ActiveSheet.Shapes("SubmittoVMaaS").Visible = False
        ActiveSheet.Shapes("SendbacktoRequestor").Visible = False
        ActiveSheet.Range("sa_approver_rows").EntireRow.Hidden = True
        
                    ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
            If Range("z_type_of_request") = "Create New Vendor" Then
                ActiveSheet.Unprotect Password:="Password"
       
                If Range("fin_stab_check").Value = "" Then
                Range("fin_stab_check").Interior.Color = RGB(255, 255, 255)
                End If
         
                If Range("vefbp").Value = "" Then
                Range("vefbp").Interior.Color = RGB(255, 255, 255)
                End If
                
                If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
                Range("z_payment_terms").Interior.Color = RGB(255, 255, 255)
                End If
                
         
                ActiveSheet.Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            End If
            
            ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
            If Range("z_type_of_request") = "Change Existing Vendor" And ActiveSheet.CheckBoxes("Check Box 130").Value = 1 And ActiveSheet.Range("rngCHV_ext") <> "Extend to Company code of the same Country" And ActiveSheet.Range("z_roo") <> "LA" Then
                ThisWorkbook.Sheets("Requestor Information").Unprotect Password:="Password"
                ThisWorkbook.Sheets("Vendor Information").Unprotect Password:="Password"
       
                If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
                Range("z_payment_terms").Interior.Color = RGB(255, 255, 255)
                End If
         
                If RNG3 = "" Then
                ThisWorkbook.Worksheets("Vendor Information").Range("z_pay_method").Interior.Color = RGB(255, 255, 255)
                End If
         
                ThisWorkbook.Sheets("Requestor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
                ThisWorkbook.Sheets("Vendor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            End If


        
        boolSave = Application.Dialogs(xlDialogSaveAs).Show
        If boolSave Then
            Set objOutlook = CreateObject("Outlook.Application")
            Set objEmail = objOutlook.CreateItem(0)
            
            On Error Resume Next
            txt = Worksheets("Requestor Information").Range("z_roo") & "_" & Worksheets("Requestor Information").Range("z_cwiipf") & "_" & Worksheets("Requestor Information").Range("z_type_of_request") & "_" & Worksheets("Requestor Information").Range("z_vendor_number") & "_" & Worksheets("Requestor Information").Range("rngVendorLegalName")
            txt3 = ActiveSheet.Range("z_requestor_email")
            With objEmail
                .To = txt3
                .Subject = txt
                .Body = ""
                .Display        ' DISPLAY MESSAGE.
                .Attachments.Add ActiveWorkbook.FullName
            End With
         Else
            ActiveSheet.Range("submit_text") = "Spend Area (or other Authorised party) submit the form to the VMaaS team"
            ActiveSheet.Range("submit_info") = "Spend Area reviewer should ensure all the mandatory data are completed, all required supporting documents are attached, then click on the 'Send completed form to VMaaS Team' button to SAVE & SEND the Request."
            ActiveSheet.Shapes("SubmittoSAT").Visible = False
            ActiveSheet.Shapes("SubmittoVMaaS").Visible = True
            ActiveSheet.Shapes("SendbacktoRequestor").Visible = True
            ActiveSheet.Range("sa_approver_rows").EntireRow.Hidden = False
            
            ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
            If Range("z_type_of_request") = "Create New Vendor" Then
                ActiveSheet.Unprotect Password:="Password"
       
                If Range("fin_stab_check").Value = "" Then
                Range("fin_stab_check").Interior.Color = RGB(244, 176, 132)
                End If
         
                If Range("vefbp").Value = "" Then
                Range("vefbp").Interior.Color = RGB(244, 176, 132)
                End If
                
                If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
                Range("z_payment_terms").Interior.Color = RGB(244, 176, 132)
                End If
                
         
                ActiveSheet.Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            End If
            
            ' MANDATORY FIELDS FOR SAT LEAD TO FILL IN
            If Range("z_type_of_request") = "Change Existing Vendor" And ActiveSheet.CheckBoxes("Check Box 130").Value = 1 And ActiveSheet.Range("rngCHV_ext") <> "Extend to Company code of the same Country" And ActiveSheet.Range("z_roo") <> "LA" Then
                ThisWorkbook.Sheets("Requestor Information").Unprotect Password:="Password"
                ThisWorkbook.Sheets("Vendor Information").Unprotect Password:="Password"
       
                If Range("z_payment_terms") = "MUST BE COMPLETED BY SPEND AREA" Then
                Range("z_payment_terms").Interior.Color = RGB(244, 176, 132)
                End If
         
                If RNG3 = "" Then
                ThisWorkbook.Worksheets("Vendor Information").Range("z_pay_method").Interior.Color = RGB(244, 176, 132)
                End If
         
                ThisWorkbook.Sheets("Requestor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
                ThisWorkbook.Sheets("Vendor Information").Protect Password:="Password", DrawingObjects:=False, userinterfaceonly:=True
            End If
            
            
        End If
'    Else
'        MsgBox "Please fill all mandatory fields highlighted in Orange in Requestor Information & Vendor Information tab(s)"
    End If

End Sub





Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    Application.ScreenUpdating = True
    Application.EnableEvents = True
    Application.DisplayAlerts = True
    Application.Calculation = xlCalculationAutomatic
End Sub

Private Sub Workbook_open()
 
Dim info
Dim tempWB As Workbook
Dim ShPath As String
Dim ShPath2 As String
Dim OS As String
Dim sMyScript As String
Dim wSheet As Worksheet

Application.ScreenUpdating = False
Application.EnableEvents = False
Application.DisplayAlerts = False
Application.Calculation = xlCalculationAutomatic

On Error GoTo Errh

    For Each wSheet In Worksheets
        If wSheet.Name = "Requestor Information" Or wSheet.Name = "Vendor Information" Then
            wSheet.Unprotect Password:="Password"
            wSheet.Protect Password:="Password", DrawingObjects:=True, contents:=True, Scenarios:=True, AllowFiltering:=True, userinterfaceonly:=True    'DrawingObjects:=True, contents:=True, Scenarios:=True, AllowFiltering:=True,
        End If
    Next wSheet
    
    If Range("z_requestor_name").Value = "" Then
        ThisWorkbook.Worksheets("Requestor Information").Shapes("SubmittoSAT").Visible = True
        ThisWorkbook.Worksheets("Requestor Information").Shapes("SubmittoVMaaS").Visible = False
        ThisWorkbook.Worksheets("Requestor Information").Shapes("SendbacktoRequestor").Visible = False
        'ThisWorkbook.Worksheets("Requestor Information").Range("sa_approver_rows").EntireRow.Hidden = True '(Not required as it needs the sheet to unprotect)
    End If

On Error GoTo MAC
OS = Application.OperatingSystem

If Left(OS, 3) = "Win" Then
    
    On Error Resume Next
        
      ShPath = "https://collaboration.mdlz.com/sites/STPGlobalVMaaS/Shared Documents/2. Reference Documents/VMaaS CD1 Spend Area Contacts.xlsm"
      ShPath2 = "\\collaboration.mdlz.com\sites\STPGlobalVMaaS\Shared Documents\2. Reference Documents\VMaaS CD1 Spend Area Contacts.xlsm"
        
        
        If Range("z_requestor_name").Value = "" Then
            
       
    '    info = IsWorkBookOpen(ShPath2)
    '
    '    If info = True Then
    '    MsgBox "VRF is being updated. Please download new version in a few minutes."
    '
    '    Else
    
        'Workbooks.Open FileName:="https://collaboration.mdlz.com/sites/STPGlobalVMaaS/Shared%20Documents/2.%20Reference%20Documents/VMaaS%20CD1%20Spend%20Area%20Contacts.xlsm"
        Set tempWB = Workbooks.Open(ShPath)
        
        
    '    End If
    
        tempWB.Sheets("SA Matrix").Range("A1:M1000").Copy
        ThisWorkbook.Activate
        ThisWorkbook.Worksheets("SA Matrix").Visible = True
        ThisWorkbook.Worksheets("SA Matrix").Range("A1").PasteSpecial Paste:=xlPasteValuesAndNumberFormats
        
        
        'Application.CutCopyMode = False 'Escape
        
        
        tempWB.Close savechanges:=False
        ThisWorkbook.Worksheets("SA Matrix").Visible = False
        ThisWorkbook.Worksheets("Requestor Information").Activate
        
        End If
        
        
 End If
 
 
MAC:
        On Error Resume Next
        If Application.OperatingSystem Like "*Mac*" Then
            'Application.Version >= 15
            'ShPath = "https://collaboration.mdlz.com/sites/STPGlobalVMaaS/Shared Documents/2. Reference Documents/VMaaS CD1 Spend Area Contacts.xlsm"
            ShPath = "https://collaboration.mdlz.com/sites/STPGlobalVMaaS/Shared%20Documents/2.%20Reference%20Documents/VMaaS%20CD1%20Spend%20Area%20Contacts.xlsm"
            If Val(Application.Version) > 15 Then 'excel 2016
            
            Else 'excel 2011
            
                ShPath = Replace(wbName, "/", ":")
                'ShPath = Replace(wbName, "Macintosh HD", "", Count:=1)
            End If
    
    
            If Range("z_requestor_name").Value = "" Then
                'Set tempWB = Workbooks.Open(ShPath)
                Set tempWB = Workbooks.Open(FileName:=ShPath)
                
                    tempWB.Sheets("SA Matrix").Range("A1:M1000").Copy
                    ThisWorkbook.Activate
                    ThisWorkbook.Worksheets("SA Matrix").Visible = True
                    ThisWorkbook.Worksheets("SA Matrix").Range("A1").PasteSpecial Paste:=xlPasteValuesAndNumberFormats
                    
                    
                    Application.CutCopyMode = False 'Escape
                    
                    
                    tempWB.Close savechanges:=False
                    ThisWorkbook.Worksheets("SA Matrix").Visible = False
                    ThisWorkbook.Worksheets("Requestor Information").Activate
            
            End If
    
    
    
        End If
    
On Error GoTo Errh
    
If ThisWorkbook.Worksheets("Requestor Information").Range("U7").Value = "" Then
    ThisWorkbook.Worksheets("Requestor Information").Range("U7").Value = ADUserQuery()
End If
    
If ThisWorkbook.Worksheets("Requestor Information").Range("BG7").Value = "" Then
    ThisWorkbook.Worksheets("Requestor Information").Range("BG7").Value = ADEmailQuery()
End If
    
ThisWorkbook.Worksheets("Requestor Information").Range("B4").Font.Color = RGB(0, 102, 0)
MsgBox "Please fill in all mandatory fields highlighted in orange. Always use SUBMIT TO button at the bottom of the form to send the VRF to the correct approver."
    
    
LetsContinue:
 Application.ScreenUpdating = True
 Application.EnableEvents = True
 Application.DisplayAlerts = True
 Exit Sub
 
Errh:
    MsgBox Err.Number & vbNewLine & Err.Description
    Resume LetsContinue



End Sub


Function IsWorkBookOpen(FileName As String)
Dim ff As Long, ErrNo As Long

    On Error Resume Next
    ff = FreeFile()
    Open FileName For Input Lock Read As #ff
    Close ff
    ErrNo = Err
    On Error GoTo 0

    Select Case ErrNo
    Case 0:    IsWorkBookOpen = False
    Case 70:   IsWorkBookOpen = True
    Case Else: Error ErrNo
    End Select
End Function


' InQuest injected base64 decoded content
' <ihm

INQUEST-PP=macro
