Attribute VB_Name = "List1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_BeforeDoubleClick(ByVal Target As Range, Cancel As Boolean)
'Dim radek, sloupec, hodnota
 Dim zablokovat As Boolean
 radek = ActiveCell.Row
 sloupec = ActiveCell.Column
 hodnota = ActiveCell.Cells
 zablokovat = False
 If Cells(radek, 1) = "x" Then
   If sloupec = 9 Then
     Sheets("_Cenova_nabidka").Unprotect (GpassM)
     With Cells(radek, sloupec).Font
        .Strikethrough = True
     End With
     With Cells(radek, sloupec + 1).Font
        .Strikethrough = False
     End With
     Cancel = True 'zrusi prednastavene chovani excelu
     Sheets("_Cenova_nabidka").Protect (GpassM)
   End If
   If sloupec = 10 Then
     Sheets("_Cenova_nabidka").Unprotect (GpassM)
     With Cells(radek, sloupec).Font
        .Strikethrough = True
     End With
     With Cells(radek, sloupec - 1).Font
        .Strikethrough = False
     End With
     Cancel = True 'zrusi prednastavene chovani excelu
     Sheets("_Cenova_nabidka").Protect (GpassM)
   End If
   If sloupec = 1 Then
     If MsgBox("Chcete vymazat p|fffd|e|fffd|krtnut|fffd| u t|fffd|to polo|fffd|ky?", vbYesNo Or vbQuestion, "Nab|fffd|dka HZS") = vbYes Then
       Sheets("_Cenova_nabidka").Unprotect (GpassM)
       With Cells(radek, 9).Font
          .Strikethrough = False
       End With
       With Cells(radek, 10).Font
          .Strikethrough = False
       End With
       Sheets("_Cenova_nabidka").Protect (GpassM)
     End If
     Cancel = True
   End If
 End If
End Sub

Private Sub Worksheet_Change(ByVal Target As Range)


Dim radek, sloupec, hodnota
Dim i, j

radek = ActiveCell.Row
sloupec = ActiveCell.Column
hodnota = ActiveCell.Cells
If radek = 8 And sloupec = 3 Then
  i = 1
  While Sheets("_Technici").Cells(i, 1) <> ""
    If Sheets("_Technici").Cells(i, 1) = hodnota Then
      Cells(8, 5).Select
      
      'j = Sheets("_Technici").Cells(i, 27)
      Cells(8, 5) = Sheets("_Technici").Cells(i, 5)
      'Cells(9, 3).Select
      'Cells(9, 3) = Sheets("_Technici").Cells(i, 3)
    End If
    i = i + 1
  Wend
  'MsgBox hodnota
End If
If radek = 9 And sloupec = 3 Then
  i = 1
  While Sheets("_Technici").Cells(i, 1) <> ""
    If Sheets("_Technici").Cells(i, 1) = hodnota Then
      Cells(9, 5).Select
      Cells(9, 5) = Sheets("_Technici").Cells(i, 5)
      'Cells(9, 8).Select
      'Cells(9, 8) = Sheets("_Technici").Cells(i, 3)
    End If
    i = i + 1
  Wend
End If
'MsgBox "Ahoj"
'If Cells(radek, 10) = 60 Then
'  i = 11
'  While (Cells(i, 10)) <> 440
'    i = i + 1
'  Wend
'  Cells(i, 4) = ""
'End If
'MsgBox hodnota
End Sub
        

Attribute VB_Name = "List10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List26"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List27"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List28"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List29"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CB010, 1, 0, MSForms, CheckBox"
Attribute VB_Control = "CB011, 2, 1, MSForms, CheckBox"
Attribute VB_Control = "CB020, 3, 2, MSForms, CheckBox"
Attribute VB_Control = "CB021, 4, 3, MSForms, CheckBox"
Attribute VB_Control = "CB030, 5, 4, MSForms, CheckBox"
Attribute VB_Control = "CB031, 6, 5, MSForms, CheckBox"
Attribute VB_Control = "CB040, 7, 6, MSForms, CheckBox"
Attribute VB_Control = "CB041, 8, 7, MSForms, CheckBox"
Attribute VB_Control = "CB050, 9, 8, MSForms, CheckBox"
Attribute VB_Control = "CB051, 10, 9, MSForms, CheckBox"
Attribute VB_Control = "CB070, 13, 10, MSForms, CheckBox"
Attribute VB_Control = "CB071, 14, 11, MSForms, CheckBox"
Attribute VB_Control = "CB080, 15, 12, MSForms, CheckBox"
Attribute VB_Control = "CB081, 16, 13, MSForms, CheckBox"
Attribute VB_Control = "CB090, 17, 14, MSForms, CheckBox"
Attribute VB_Control = "CB091, 18, 15, MSForms, CheckBox"
Attribute VB_Control = "CB100, 19, 16, MSForms, CheckBox"
Attribute VB_Control = "CB110, 20, 17, MSForms, CheckBox"
Attribute VB_Control = "CB120, 21, 18, MSForms, CheckBox"
Attribute VB_Control = "CB130, 22, 19, MSForms, CheckBox"
Attribute VB_Control = "CB140, 23, 20, MSForms, CheckBox"
Attribute VB_Control = "CB150, 24, 21, MSForms, CheckBox"
Attribute VB_Control = "CB160, 25, 22, MSForms, CheckBox"
Attribute VB_Control = "CB101, 26, 23, MSForms, CheckBox"
Attribute VB_Control = "CB111, 27, 24, MSForms, CheckBox"
Attribute VB_Control = "CB121, 28, 25, MSForms, CheckBox"
Attribute VB_Control = "CB131, 29, 26, MSForms, CheckBox"
Attribute VB_Control = "CB141, 30, 27, MSForms, CheckBox"
Attribute VB_Control = "CB151, 31, 28, MSForms, CheckBox"
Attribute VB_Control = "CB161, 32, 29, MSForms, CheckBox"
Attribute VB_Control = "CheckBox1, 36, 30, MSForms, CheckBox"
Attribute VB_Control = "CheckBox2, 37, 31, MSForms, CheckBox"
Attribute VB_Control = "CB060, 38, 32, MSForms, CheckBox"
Attribute VB_Control = "CB061, 39, 33, MSForms, CheckBox"
Dim sloupec0 As Integer, sloupec1 As Integer

Private Sub CB010_Click()
Call oznac(CB010.Name, CB010.Value)
If CB010.Value = False Then
   CB011.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB010.Name) Then
     CB011.Value = True
   Else
     'CB011.Value = False
   End If
End If
End Sub

Private Sub CB011_Click()
Call oznac(CB011.Name, CB011.Value)
If CB011.Value And Not CB010.Value Then
  CB010.Value = True
End If
End Sub

Private Sub CB020_Click()
Call oznac(CB020.Name, CB020.Value)
If CB020.Value = False Then
   CB021.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB020.Name) Then
     CB021.Value = True
   Else
     'CB021.Value = False
   End If
End If
End Sub

Private Sub CB021_Click()
Call oznac(CB021.Name, CB021.Value)
End Sub

Private Sub CB030_Click()
Call oznac(CB030.Name, CB030.Value)
If CB030.Value = False Then
   CB031.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB030.Name) Then
     CB031.Value = True
   Else
     'CB031.Value = False
   End If
End If
End Sub

Private Sub CB031_Click()
Call oznac(CB031.Name, CB031.Value)
End Sub

Private Sub CB040_Click()
Call oznac(CB040.Name, CB040.Value)
If CB040.Value = False Then
   CB041.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB040.Name) Then
     CB041.Value = True
   Else
     'CB041.Value = False
   End If
End If
End Sub

Private Sub CB041_Click()
Call oznac(CB041.Name, CB041.Value)
If CB041.Value And Not CB040.Value Then
  CB040.Value = True
End If
End Sub

Private Sub CB050_Click()
Call oznac(CB050.Name, CB050.Value)
If CB050.Value = False Then
   CB051.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB050.Name) Then
     CB051.Value = True
   Else
     'CB051.Value = False
   End If
End If
End Sub

Private Sub CB051_Click()
Call oznac(CB051.Name, CB051.Value)
If CB051.Value And Not CB050.Value Then
  CB050.Value = True
End If
End Sub

'Private Sub CB060_Click()
'Call oznac(CB060.Name, CB060.Value)
'If CB060.Value = False Then
'   CB061.Value = False
'Else
'  Call sloupecNast(sloupec0, sloupec1)
'' chybi overeni na "X" uz ne
'   If testProCB(sloupec1, CB060.Name) Then
'     CB061.Value = True
'   Else
'     CB061.Value = False
'   End If
'End If
'End Sub

'Private Sub CB061_Click()
'Call oznac(CB061.Name, CB061.Value)
'End Sub
Private Sub CB060_Click()
Call oznac(CB060.Name, CB060.Value)
If CB060.Value = False Then
   CB061.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB060.Name) Then
     CB061.Value = True
   Else
     'CB011.Value = False
   End If
End If
End Sub

Private Sub CB061_Click()
Call oznac(CB061.Name, CB061.Value)
If CB061.Value And Not CB060.Value Then
  CB060.Value = True
End If
End Sub

Private Sub CB070_Click()
Call oznac(CB070.Name, CB070.Value)
If CB070.Value = False Then
   CB071.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB070.Name) Then
     CB071.Value = True
   Else
     CB071.Value = False
   End If
End If
End Sub

Private Sub CB071_Click()
Call oznac(CB071.Name, CB071.Value)
End Sub

Private Sub CB080_Click()
Call oznac(CB080.Name, CB080.Value)
If CB080.Value = False Then
   CB081.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB080.Name) Then
     CB081.Value = True
   Else
     CB081.Value = False
   End If
End If
End Sub

Private Sub CB081_Click()
Call oznac(CB081.Name, CB081.Value)
End Sub

Private Sub CB090_Click()
Call oznac(CB090.Name, CB090.Value)
If CB090.Value = False Then
   CB091.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB090.Name) Then
     CB091.Value = True
   Else
     CB091.Value = False
   End If
End If
End Sub

Private Sub CB091_Click()
Call oznac(CB091.Name, CB091.Value)
End Sub

Private Sub CB100_Click()
Call oznac(CB100.Name, CB100.Value)
If CB100.Value = False Then
   CB101.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB100.Name) Then
     CB101.Value = True
   Else
     CB101.Value = False
   End If
End If
End Sub

Private Sub CB101_Click()
Call oznac(CB101.Name, CB101.Value)
End Sub
Private Sub CB110_Click()
Call oznac(CB110.Name, CB110.Value)
If CB110.Value = False Then
   CB111.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB110.Name) Then
     CB111.Value = True
   Else
     CB111.Value = False
   End If
End If
End Sub
Private Sub CB111_Click()
Call oznac(CB111.Name, CB111.Value)
End Sub

Private Sub CB120_Click()
Call oznac(CB120.Name, CB120.Value)
If CB120.Value = False Then
   CB121.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB120.Name) Then
     CB121.Value = True
   Else
     CB121.Value = False
   End If
End If
End Sub

Private Sub CB121_Click()
Call oznac(CB121.Name, CB121.Value)
End Sub

Private Sub CB130_Click()
Call oznac(CB130.Name, CB130.Value)
If CB130.Value = False Then
   CB131.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB130.Name) Then
     CB131.Value = True
   Else
     CB131.Value = False
   End If
End If
End Sub

Private Sub CB131_Click()
Call oznac(CB131.Name, CB131.Value)
End Sub

Private Sub CB140_Click()
Call oznac(CB140.Name, CB140.Value)
If CB140.Value = False Then
   CB141.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB140.Name) Then
     CB141.Value = True
   Else
     CB141.Value = False
   End If
End If
End Sub

Private Sub CB141_Click()
Call oznac(CB141.Name, CB141.Value)
End Sub

Private Sub CB150_Click()
Call oznac(CB150.Name, CB150.Value)
If CB150.Value = False Then
   CB151.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB150.Name) Then
     CB151.Value = True
   Else
     CB151.Value = False
   End If
End If
End Sub

Private Sub CB151_Click()
Call oznac(CB151.Name, CB151.Value)
End Sub

Private Sub CB160_Click()
Call oznac(CB160.Name, CB160.Value)
If CB160.Value = False Then
   CB161.Value = False
Else
  Call sloupecNast(sloupec0, sloupec1)
' chybi overeni na "X" uz ne
   If testProCB(sloupec1, CB160.Name) Then
     CB161.Value = True
   Else
     CB161.Value = False
   End If
End If
End Sub

Private Sub CB161_Click()
Call oznac(CB161.Name, CB161.Value)
End Sub
Attribute VB_Name = "List5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "MPrepocetMaterialu"
Sub PrepoctiMaterial(jmenoKros As String, jmenoakt As String)
Attribute PrepoctiMaterial.VB_ProcData.VB_Invoke_Func = " \n14"
Dim i As Long, pocet_listu As Long, ii As Long
Dim Ccena As Double, Suma As Double
Dim SAPc As String
  k = 1.1
  SAPc = Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(5, 3) ' SAP cislo
  'MsgBox SAPc
  pocet_listu = ActiveWorkbook.Sheets.Count
  'MsgBox pocet_listu
  ii = 1
  For i = 1 To pocet_listu
    'jmeno_listu = Workbooks(jmenoKros).Sheets(i).Name
    jmeno_listu = Sheets(i).Name
    
    'Uprava rekapitulace stavby
    If jmeno_listu = "Rekapitulace n|fffd|klad|fffd| stavby" Then
      Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
      
      j = 12
      While Sheets(i).Cells(j, 2) <> "Investi|fffd|n|fffd| dod|fffd|vky (SaZ + trafa)"
        j = j + 1
      Wend
      Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 3) 'zaloha puvodni hodnoty
      If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(25, 9) = "X" Then
        Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 3) * k
      End If
      
      j = 12
      While Sheets(i).Cells(j, 2) <> "Materi|fffd|ly dod|fffd|van|fffd| DSO (mimo SaZ a traf)"
        j = j + 1
      Wend
      Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 3) 'zaloha puvodni hodnoty
      If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(26, 9) = "X" Then
        Sheets(i).Cells(j, 3) = Cells(j, 3) * k
      End If
      
      j = 12
      While Sheets(i).Cells(j, 2) <> "Materi|fffd|ly dod|fffd|van|fffd| zhotovitelem"
        j = j + 1
      Wend
      Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 3) 'zaloha puvodni hodnoty
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 3) * k 'mat zhotovitele dodava vzdy zhotovitel
    End If
    
    'Uprava rekapitulaci objektu
    If Left(jmeno_listu, 14) = "Rekap. objektu" Then
      Workbooks(jmenoakt).Sheets("_konfig").Cells(ii, 1) = Workbooks(jmenoKros).Sheets(jmeno_listu).Cells(6, 3) 'Nazev objektu
      Workbooks(jmenoakt).Sheets("_konfig").Cells(ii, 3) = jmeno_listu ' zapis objektu do konfig
      ii = ii + 1
      Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
      
      j = 12
      While Sheets(i).Cells(j, 2) <> "Investi|fffd|n|fffd| dod|fffd|vky (SaZ + trafa)"
        j = j + 1
      Wend
      Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 3) 'zaloha puvodni hodnoty
      If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(25, 9) = "X" Then
        Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 3) * k
      End If
      
      j = 12
      While Sheets(i).Cells(j, 2) <> "Materi|fffd|ly dod|fffd|van|fffd| DSO (mimo SaZ a traf)"
        j = j + 1
      Wend
      Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 3) 'zaloha puvodni hodnoty
      If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(26, 9) = "X" Then
        Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 3) * k
      End If
      
      j = 12
      While Sheets(i).Cells(j, 2) <> "Materi|fffd|ly dod|fffd|van|fffd| zhotovitelem"
        j = j + 1
      Wend
      'MsgBox Sheets(i).Cells(j, 3)
      Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 3) 'zaloha puvodni hodnoty
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 3) * k
    End If
    'MsgBox jmeno_listu
  Next i
  
  'upravy sestav materialu
  For i = 1 To pocet_listu
    'jmeno_listu = Workbooks(jmenoKros).Sheets(i).Name
    jmeno_listu = Sheets(i).Name
    
    'Dod|fffd|vky zhotovitele
    If jmeno_listu = "Dod|fffd|vky zhotovitele" Then
      Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
      j = 9
      Suma = 0
      While Sheets(i).Cells(j, 3) <> "Dod|fffd|vky zhotovitele celkem:"
        If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
          Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 7) * k 'j. cena
          Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
          Sheets(i).Cells(j, 8) = Ccena
          Suma = Suma + Ccena
        End If
        j = j + 1
      Wend
      'Sheets(i).Cells(j, 8) = Suma 'neni potreba, je tam vzorec
    End If
    
    'Ostatn|fffd| dod|fffd|vky |fffd|LG
    If jmeno_listu = "Ostatn|fffd| dod|fffd|vky |fffd|LG" Then
      Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
      j = 9
      Suma = 0
      While Sheets(i).Cells(j, 3) <> "Ostatn|fffd| dod|fffd|vky I-DOD celkem:"
        Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 7) 'puvodni jedn.cena
        If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(26, 9) = "X" Or Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(25, 3) = 0 Then
          If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
            Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 7) * k 'j. cena
            Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
            Sheets(i).Cells(j, 8) = Ccena
            Suma = Suma + Ccena
          End If
        End If
        j = j + 1
      Wend
      'Sheets(i).Cells(j, 8) = Suma
    End If
    
    'Stroje a za|fffd||fffd|zen|fffd| |fffd|LG
    If jmeno_listu = "Stroje a za|fffd||fffd|zen|fffd| |fffd|LG" Then
      Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
      j = 9
      Suma = 0
      While Sheets(i).Cells(j, 3) <> "Stroje a za|fffd||fffd|zen|fffd| celkem:"
        Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 7) 'puvodni jedn.cena
        If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(25, 9) = "X" Or Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(24, 3) = 0 Then
          If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
            Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 7) * k 'j. cena
            Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
            Sheets(i).Cells(j, 8) = Ccena
            Suma = Suma + Ccena
          End If
        End If
        j = j + 1
      Wend
      'Sheets(i).Cells(j, 8) = Suma
    End If
    
    'Silov|fffd| trafa |fffd|LG
    If jmeno_listu = "Silov|fffd| trafa |fffd|LG" Then
      Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
      j = 9
      Suma = 0
      While Sheets(i).Cells(j, 3) <> "Silov|fffd| trafa celkem:"
        Sheets(i).Cells(j, 20) = Sheets(i).Cells(j, 7) 'puvodni jedn.cena
        If Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(25, 9) = "X" Or Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(24, 3) = 0 Then
          If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
            Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 7) * k 'j. cena
            Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
            Sheets(i).Cells(j, 8) = Ccena
            Suma = Suma + Ccena
          End If
        End If
        j = j + 1
      Wend
      'Sheets(i).Cells(j, 8) = Suma
    End If
  
  Next i
   
End Sub
Attribute VB_Name = "MPrepocetRekapitulaci"
Sub prepocet1(jmenoKros As String, jmenoakt As String)
Dim i As Integer, j As Integer, i0 As Integer, k As Integer
Dim SPP As String, ZN As String, NazevObj As String, CisObj As String, konec As Boolean
Dim sumy(100) As Double, jmenoListu As String
i = 1
jmenoListu = Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 3)
While jmenoListu <> ""
   For k = 40 To 42
     If Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 3)
     End If
   Next k
   For k = 44 To 46
     If Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4)
       'MsgBox Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 3)
       'MsgBox Sheets(jmenoListu).Cells(k, 4)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
   For k = 53 To 55
     If Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 3)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
   For k = 59 To 60
     If Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 3)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
   For k = 62 To 64
     If Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Workbooks(jmenoKros).Sheets(jmenoListu).Cells(k, 3)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
  i = i + 1
  jmenoListu = Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 3)
Wend


For k = 37 To 39
  Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 41 To 43
  Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 50 To 52
  Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 56 To 57
  Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 59 To 61
  Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

Calculate
End Sub
Attribute VB_Name = "MPrepocetRekapitulaci2"
Sub prepocet2()
Dim i As Integer, j As Integer, i0 As Integer, k As Double, k0 As Double
Dim HSA As Double, HSB As Double, HSC As Double, HS As Double, Suma As Double, sumaCelk As Double
Dim SPP As String, ZN As String, NazevObj As String, CisObj As String, konec As Boolean
Dim sumy(100) As Double, jmenoListu As String
Dim HZSzem As Double
Dim jmenoakt As String
k0 = 1.1
pocet_listu = ActiveWorkbook.Sheets.Count
For i = 1 To pocet_listu
  jmeno_listu = Sheets(i).Name
  'Uprava rekapitulace stavby
  If jmeno_listu = "Rekapitulace n|fffd|klad|fffd| stavby" Then
    j = 12
    While Sheets(i).Cells(j, 2) <> "Investi|fffd|n|fffd| dod|fffd|vky (SaZ + trafa)"
      j = j + 1
    Wend
    If Sheets("_Nastaveni").Cells(25, 9) = "X" Then
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20) * k0
    Else
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20)
    End If
    
    j = 12
    While Sheets(i).Cells(j, 2) <> "Materi|fffd|ly dod|fffd|van|fffd| DSO (mimo SaZ a traf)"
      j = j + 1
    Wend
    If Sheets("_Nastaveni").Cells(26, 9) = "X" Then
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20) * k0
    Else
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20)
    End If
  End If

  'Uprava rekapitulaci objektu
  If Left(jmeno_listu, 14) = "Rekap. objektu" Then
      
    j = 12
    While Sheets(i).Cells(j, 2) <> "Investi|fffd|n|fffd| dod|fffd|vky (SaZ + trafa)"
      j = j + 1
    Wend
    If Sheets("_Nastaveni").Cells(25, 9) = "X" Then
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20) * k0
    Else
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20)
    End If
      
    j = 12
    While Sheets(i).Cells(j, 2) <> "Materi|fffd|ly dod|fffd|van|fffd| DSO (mimo SaZ a traf)"
      j = j + 1
    Wend
    If Sheets("_Nastaveni").Cells(26, 9) = "X" Then
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20) * k0
    Else
      Sheets(i).Cells(j, 3) = Sheets(i).Cells(j, 20)
    End If
  End If

Next i



For i = 1 To pocet_listu
  jmeno_listu = Sheets(i).Name
  'Ostatn|fffd| dod|fffd|vky |fffd|LG
  If jmeno_listu = "Ostatn|fffd| dod|fffd|vky |fffd|LG" Then
    j = 9
    Suma = 0
    If Sheets("_Nastaveni").Cells(26, 9) = "X" Or Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(25, 3) = 0 Then
      k = k0 'navysit, kdyz je zatrzeno nebo kdyz je v KROS zatrzeno, ze vse doda zhotovitel
    Else
      k = 1
    End If
    While Sheets(i).Cells(j, 3) <> "Ostatn|fffd| dod|fffd|vky I-DOD celkem:"
      If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
        Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 20) * k 'j. cena z puvodni zalohovane v sl.20
        Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
        Sheets(i).Cells(j, 8) = Ccena
        Suma = Suma + Ccena
      End If
      j = j + 1
    Wend
    'MsgBox Suma
    'Sheets(i).Cells(j, 8) = Suma
  End If
  
  'Stroje a za|fffd||fffd|zen|fffd| |fffd|LG
  If jmeno_listu = "Stroje a za|fffd||fffd|zen|fffd| |fffd|LG" Then
    j = 9
    Suma = 0
    If Sheets("_Nastaveni").Cells(25, 9) = "X" Or Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(24, 3) = 0 Then
      k = k0 'navysit
    Else
      k = 1
    End If
    While Sheets(i).Cells(j, 3) <> "Stroje a za|fffd||fffd|zen|fffd| celkem:"
      If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
        Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 20) * k 'j. cena z puvodni zalohovane v sl.20
        Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
        Sheets(i).Cells(j, 8) = Ccena
        Suma = Suma + Ccena
      End If
      j = j + 1
    Wend
    'MsgBox Suma
    'Sheets(i).Cells(j, 8) = Suma
  End If
  
  'Silov|fffd| trafa |fffd|LG
  If jmeno_listu = "Silov|fffd| trafa |fffd|LG" Then
    j = 9
    Suma = 0
    If Sheets("_Nastaveni").Cells(25, 9) = "X" Or Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(24, 3) = 0 Then
      k = k0 'navysit
    Else
      k = 1
    End If
    While Sheets(i).Cells(j, 3) <> "Silov|fffd| trafa celkem:"
      If Not IsEmpty(Sheets(i).Cells(j, 1)) Then
        Sheets(i).Cells(j, 7) = Sheets(i).Cells(j, 20) * k 'j. cena z puvodni zalohovane v sl.20
        Ccena = Sheets(i).Cells(j, 7) * Sheets(i).Cells(j, 5)  'Celk. cena
        Sheets(i).Cells(j, 8) = Ccena
        Suma = Suma + Ccena
      End If
      j = j + 1
    Wend
    'MsgBox Suma
    'Sheets(i).Cells(j, 8) = Suma
  End If
  
Next i


'prenos do rekapitulace stavby!!!
jmenoakt = Application.ThisWorkbook.Name
Call prepocet1(jmenoakt, jmenoakt)
End Sub
Attribute VB_Name = "MUtility"
Public Declare Function EnumWindows Lib "user32" ( _
   ByVal lpEnumFunc As Long, _
   ByVal lParam As Long _
   ) _
As Long


Private Declare Function GetWindowTextLength Lib "user32" Alias "GetWindowTextLengthA" _
   (ByVal hWnd As Long) _
As Long

Private Declare Function GetWindowText Lib "user32" Alias "GetWindowTextA" _
   (ByVal hWnd As Long, _
    ByVal lpString As String, _
    ByVal cch As Long) _
As Long

Declare Function ShowWindow Lib "user32.dll" (ByVal hWnd As Long, ByVal nCmdShow As Long) As Long

Declare Function ShellExecute Lib "shell32.dll" Alias _
   "ShellExecuteA" (ByVal hWnd As Long, _
   ByVal lpOperation As String, _
   ByVal lpFile As String, _
   ByVal lpParameters As String, _
   ByVal lpDirectory As String, _
   ByVal nShowCmd As Long) _
 As Long
 
Declare Function ShellExecuteEX Lib "shell32.dll" Alias _
   "ShellExecuteEx" (ByRef SEI As SHELLEXECUTEINFO) As Long
 
Declare Function OpenProcess Lib "kernel32" _
    (ByVal dwDesiredAccess As Long, _
    ByVal bInheritHandle As Long, _
    ByVal dwProcessId As Long) As Long

Declare Function GetExitCodeProcess Lib "kernel32" _
    (ByVal hProcess As Long, _
    lpExitCode As Long) As Long
    
Declare Function SendMessage Lib "user32" Alias _
    "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, _
    ByVal wParam As Long, lParam As Any) As Long
    
Private Declare Function IsClipboardFormatAvailable _
    Lib "user32" _
    (ByVal uFormat As Long) As Long
    
Private Declare Function OpenClipboard _
    Lib "user32" _
    (ByVal hWnd As Long) As Long
    
Declare Function GetClipboardData _
    Lib "user32" _
    (ByVal uFormat As Long) As Long
    
Declare Function GlobalSize _
    Lib "kernel32" _
    (ByVal hMem As Long) As Long
    
Declare Function GlobalLock _
    Lib "kernel32" _
    (ByVal hMem As Long) As Long
    
Declare Sub MoveMemory _
    Lib "kernel32" Alias "RtlMoveMemory" _
    (ByVal strDest As Any, _
    ByVal lpSource As Any, _
    ByVal Length As Long)
    
Declare Function GlobalUnlock _
    Lib "kernel32" _
    (ByVal hMem As Long) As Long

Declare Function CloseClipboard _
    Lib "user32" () As Long

Declare Function GlobalAlloc _
    Lib "kernel32" _
    (ByVal uFlags As Long, ByVal dwBytes As Long) As Long

Declare Function EmptyClipboard _
    Lib "user32" () As Long

Declare Function SetClipboardData _
    Lib "user32" _
    (ByVal uFormat As Long, ByVal hData As Long) As Long

Declare Function GlobalFree _
    Lib "kernel32" _
    (ByVal hMem As Long) As Long

Declare Function FindWindow Lib "user32" _
Alias "FindWindowA" _
(ByVal lpClassName As String, _
ByVal lpWindowName As String) As Long

Declare Function SetTimer Lib "user32" _
(ByVal hWnd As Long, _
ByVal nIDEvent As Long, _
ByVal uElapse As Long, _
ByVal lpTimerFunc As Long) As Long

Declare Function KillTimer Lib "user32" _
(ByVal hWnd As Long, _
ByVal nIDEvent As Long) As Long

Declare Function GetCurrentVbaProject Lib "vba332.dll" _
Alias "EbGetExecutingProj" _
(hProject As Long) As Long

Declare Function GetFuncID Lib "vba332.dll" _
Alias "TipGetFunctionId" _
(ByVal hProject As Long, _
ByVal strFunctionName As String, _
ByRef strFunctionID As String) As Long

Declare Function GetAddr Lib "vba332.dll" _
Alias "TipGetLpfnOfFunctionId" _
(ByVal hProject As Long, _
ByVal strFunctionID As String, _
ByRef lpfnAddressOf As Long) As Long

Public Type SHELLEXECUTEINFO
    cbSize As Long
    fMask As Long
    hWnd As Long
    lpVerb As String
    lpFile As String
    lpParameters As String
    lpDirectory As String
    nShow As Long
    hInstApp As Long
    lpIDList As Long
    lpClass As String
    hkeyClass As Long
    dwHotKey As Long
    hIcon As Long
    hProcess As Long
End Type

Const SEE_MASK_INVOKEIDLIST = &HC
Const SEE_MASK_NOCLOSEPROCESS = &H40
Const SEE_MASK_FLAG_NO_UI = &H400

Const ACCESS_TYPE = &H400
Const STILL_ACTIVE = &H103
Const GMEM_MOVABLE = &H2&
Const GMEM_DDESHARE = &H2000&
Const CF_TEXT = 1

Const CLIPBOARDFORMATNOTAVAILABLE = 1
Const CANNOTOPENCLIPBOARD = 2
Const CANNOTGETCLIPBOARDDATA = 3
Const CANNOTGLOBALLOCK = 4
Const CANNOTCLOSECLIPBOARD = 5
Const CANNOTGLOBALALLOC = 6
Const CANNOTEMPTYCLIPBOARD = 7
Const CANNOTSETCLIPBOARDDATA = 8
Const CANNOTGLOBALFREE = 9
Public WindowsTimer As Long
Public SEI As SHELLEXECUTEINFO
Public gsTitulekOkna As String
Public ghWnd As Long
Public IDprocesu As Long

Function ExistujeSoubor(JmenoSouboru As String) As Boolean
Dim fs
Set fs = CreateObject("Scripting.FileSystemObject")
If fs.FileExists(JmenoSouboru) Then
  ExistujeSoubor = True
Else
  ExistujeSoubor = False
End If
End Function

Function VelikostSouboru(JmenoSouboru As String) As Long
Dim fs, f
  Set fs = CreateObject("Scripting.FileSystemObject")
  Set f = fs.GetFile(JmenoSouboru)
  VelikostSouboru = f.Size
End Function

Function FormatujCislo(C As Double, Oddelovac As String) As String
Dim s As String
Dim delka As Long
C = Round(C, 0)
s = Trim(Str(C))
delka = Len(s)
For i = 1 To delka
  If ((delka - i + 1) Mod 3 = 0) And (i > 1) Then
    s1 = s1 + Oddelovac
  End If
  s1 = s1 + Mid(s, i, 1)
Next i
FormatujCislo = s1
End Function

Sub VlastnostiSouboru(FileName As String)
Dim r As Long
With SEI
  .cbSize = Len(SEI)
  .fMask = SEE_MASK_NOCLOSEPROCESS Or _
    SEE_MASK_INVOKEIDLIST Or _
    SEE_MASK_FLAG_NO_UI
  .hWnd = Application.hWnd
  .lpVerb = "properties"
  .lpFile = FileName
  .lpParameters = vbNullChar
  .lpDirectory = vbNullChar
  .nShow = 0
  .hInstApp = 0
  .lpIDList = 0
End With
r = ShellExecuteEX(SEI)
End Sub

Function SpustProgram( _
  program As String, _
  windowstyle As Integer, _
  cekat As Boolean, _
  TitulekOkna As String, _
  procAkce As Integer) _
As Boolean
'windowstyle
Dim hProc As Long
Dim lExitCode As Long
Dim sTitulek As String
Dim l As Long, i As Long
gsTitulekOkna = TitulekOkna
On Error Resume Next
IDprocesu = Shell(program, windowstyle)  'vraci ID procesu
'AppActivate IDprocesu
hProc = OpenProcess(ACCESS_TYPE, False, IDprocesu) 'handle
If Err <> 0 Then
  SpustProgram = False
  Exit Function
End If
On Error GoTo 0
i = 0
If TitulekOkna <> "" Then
  ghWnd = 0
  While ghWnd = 0 And i < 20
    EnumWindows AddressOf EnumWindowsProc, 0
    Application.Wait (Now + TimeValue("0:00:01"))
    i = i + 1
  Wend
  If ghWnd <> 0 Then
  'MsgBox ghWnd
    'l = ShowWindow(ghWnd, 0)
    'l = ShowWindow(ghWnd, 1)
  End If
End If

If procAkce > 0 Then
  Call SpustProgramProc(procAkce)
End If

If cekat Then
  GetExitCodeProcess hProc, lExitCode
  While lExitCode = STILL_ACTIVE
    Application.Wait (Now + TimeValue("0:00:01"))
    GetExitCodeProcess hProc, lExitCode
    If ghWnd <> 0 Then
      'l = ShowWindow(ghWnd, 0)
      'l = ShowWindow(ghWnd, 1)
    End If
  Wend
  SpustProgram = True
End If
End Function
Sub SpustProgramProc(rez As Integer)
Dim s As String
Select Case rez
  Case 1
    
    
    s = Range("A10")
    DoSchranky (s)
    SendKeys "%l", True
    SendKeys "{ENTER}", True
    SendKeys "^v", True
    SendKeys "{ENTER}", True
    s = Range("A11")
    DoSchranky (s)
    SendKeys "%l", True
    SendKeys "{ENTER}", True
    SendKeys "^v", True
    SendKeys "{ENTER}", True
  Case 2
  
End Select
End Sub

Function EnumWindowsProc(ByVal hWnd As Long, ByVal lParam As Long) As Long
Dim sTitulek As String
sTitulek = String(GetWindowTextLength(hWnd) + 1, Chr$(0))
GetWindowText hWnd, sTitulek, Len(sTitulek)
'If sTitulek = gsTitulekOkna + Chr(0) Then
If InStr(1, sTitulek + Chr(0), gsTitulekOkna, 1) > 0 Then
  ghWnd = hWnd
  EnumWindowsProc = 0
Else
  EnumWindowsProc = 1
End If
End Function



Function DoSchranky(strText As String) As Variant
Dim varRet As Variant
Dim fSetClipboardData As Boolean
Dim hMemory As Long
Dim lpMemory As Long
Dim lngSize As Long

varRet = False
fSetClipboardData = False

' Get the length, including one extra for a CHR$(0)
' at the end.
lngSize = Len(strText) + 1
hMemory = GlobalAlloc(GMEM_MOVABLE Or _
  GMEM_DDESHARE, lngSize)
If Not CBool(hMemory) Then
  varRet = CVErr(CANNOTGLOBALALLOC)
  GoTo SetTextDone
End If

' Lock the object into memory
lpMemory = GlobalLock(hMemory)
If Not CBool(lpMemory) Then
  varRet = CVErr(CANNOTGLOBALLOCK)
  GoTo SetTextGlobalFree
End If

' Move the string into the memory we locked
Call MoveMemory(lpMemory, strText, lngSize)

' Don't send clipboard locked memory.
Call GlobalUnlock(hMemory)

' Open the clipboard
If Not CBool(OpenClipboard(0&)) Then
  varRet = CVErr(CANNOTOPENCLIPBOARD)
  GoTo SetTextGlobalFree
End If

' Remove the current contents of the clipboard
If Not CBool(EmptyClipboard()) Then
  varRet = CVErr(CANNOTEMPTYCLIPBOARD)
  GoTo SetTextCloseClipboard
End If

' Add our string to the clipboard as text
If Not CBool(SetClipboardData(CF_TEXT, hMemory)) Then
'If Not CBool(SetClipboardData(CF_UNICODETEXT, hMemory)) Then
  varRet = CVErr(CANNOTSETCLIPBOARDDATA)
  GoTo SetTextCloseClipboard
Else
  fSetClipboardData = True
End If

SetTextCloseClipboard:
' Close the clipboard
If Not CBool(CloseClipboard()) Then
  varRet = CVErr(CANNOTCLOSECLIPBOARD)
End If

SetTextGlobalFree:
If Not fSetClipboardData Then
  'If we have set the clipboard data, we no longer own
  ' the object--Windows does, so don't free it.
  If CBool(GlobalFree(hMemory)) Then
    varRet = CVErr(CANNOTGLOBALFREE)
  End If
End If

SetTextDone:
  DoSchranky = varRet
End Function

Function ZeSchranky() As Variant
    Dim hMemory As Long
    Dim lpMemory As Long
    Dim strText As String
    Dim lngSize As Long
    Dim varRet As Variant

    varRet = ""

    ' Is there text on the clipboard? If not, error out.
    If Not CBool(IsClipboardFormatAvailable _
        (CF_TEXT)) Then
        varRet = CVErr(CLIPBOARDFORMATNOTAVAILABLE)
        GoTo GetTextDone
    End If

    ' Open the clipboard
    If Not CBool(OpenClipboard(0&)) Then
        varRet = CVErr(CANNOTOPENCLIPBOARD)
        GoTo GetTextDone
    End If

    ' Get the handle to the clipboard data
    hMemory = GetClipboardData(CF_TEXT)
    If Not CBool(hMemory) Then
        varRet = CVErr(CANNOTGETCLIPBOARDDATA)
        GoTo GetTextCloseClipboard
    End If

    ' Find out how big it is and allocate enough space
    ' in a string
    lngSize = GlobalSize(hMemory)
    strText = Space$(lngSize)

    ' Lock the handle so we can use it
    lpMemory = GlobalLock(hMemory)
    If Not CBool(lpMemory) Then
        varRet = CVErr(CANNOTGLOBALLOCK)
        GoTo GetTextCloseClipboard
    End If

    ' Move the information from the clipboard memory
    ' into our string
    Call MoveMemory(strText, lpMemory, lngSize)

    ' Truncate it at the first Null character because
    ' the value reported by lngSize is erroneously large
    strText = Left$(strText, InStr(1, strText, Chr$(0)) - 1)

    ' Free the lock
    Call GlobalUnlock(hMemory)

GetTextCloseClipboard:
    ' Close the clipboard
    If Not CBool(CloseClipboard()) Then
        varRet = CVErr(CANNOTCLOSECLIPBOARD)
    End If

GetTextDone:
    If Not IsError(varRet) Then
        ZeSchranky = strText
    Else
        ZeSchranky = varRet
    End If
End Function


Function fncWindowsTimer(TimeInterval As Long) As Boolean
Dim WindowsTimer As Long
WindowsTimer = 0
WindowsTimer = SetTimer(hWnd:=FindWindow("XLMAIN", Application.Caption), _
  nIDEvent:=0, _
  uElapse:=TimeInterval, _
  lpTimerFunc:=AddrOf_cbkCustomTimer)
fncWindowsTimer = CBool(WindowsTimer)
End Function

Function fncStopWindowsTimer()
KillTimer hWnd:=FindWindow("XLMAIN", Application.Caption), _
nIDEvent:=WindowsTimer
End Function

Function cbkCustomTimer(ByVal Window_hWnd As Long, _
ByVal WindowsMessage As Long, _
ByVal EventID As Long, _
ByVal SYSTEMTIME As Long) As Long
Dim CurrentTime As String
'On Error Resume Next
Cells(2, 3) = Format(Now, "Long Time")
End Function

Function AddrOf_cbkCustomTimer() As Long
AddrOf_cbkCustomTimer = vbaPass(AddressOf cbkCustomTimer)
End Function

Function vbaPass(AddressOfFunction As Long) As Long
vbaPass = AddressOfFunction
End Function



Attribute VB_Name = "Module1"
Public Gpass As String
Public GpassM As String
Declare Function SHGetSpecialFolderPath Lib "shell32.dll" Alias _
"SHGetSpecialFolderPathA" (ByVal hwndOwner As Long, _
ByVal lpszPath As String, _
ByVal nFolder As Long, _
ByVal fCreate As Long) _
As Long '

Sub otevri()
Dim RozpocetKROSu
Dim RozpocetKROSuRekObj, k As Integer
Dim i As Integer, j As Integer, l As Integer, m As Integer, n As Integer, o As Integer
Dim fs
Dim sk As String
Dim b As Boolean
Dim AdrSit As String, AdrLocal As String
Dim AdrCfg As String, SoubCfg As String
Dim jmenoakt As String, jmenoKros As String
Dim pocet_listu As Integer
Dim jmeno_listu As String
Dim SPP As String, NazevObjektu As String
Dim radekSR As Integer
Dim HodElmon As Double, HSElmon As Double, HodZem As Double, HSZem As Double
Dim okres As String
Dim ChybStru As Boolean
Dim SumaNH As Double
Dim cena
Dim SAPc As String, lSAPc As String
Dim VerzeRekapitulace As String
Dim sVerzeNZ As String
Gpass = "CEZ praci!"
'GpassM = "NabidkaHZS"
SumaNH = 0
If Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
  'Sheets("_Nastaveni").Cells(54, 9) = "X"
  'Sheets("_Nastaveni").Cells(54, 10) = "X"
  'Uz zase objednavame manipulace my i na HZS II - prechod CDS do DSO
  Sheets("_Nastaveni").Cells(54, 9) = ""
  Sheets("_Nastaveni").Cells(54, 10) = ""
Else
  Sheets("_Nastaveni").Cells(54, 9) = ""
  Sheets("_Nastaveni").Cells(54, 10) = ""
End If
AdrCfg = cestainiNew()
'SoubCfg = AdrCfg + "Data\CestaKros.txt"
SoubCfg = AdrCfg + "CestaKros.txt"
Set fs = CreateObject("Scripting.FileSystemObject")
If Not fs.FileExists(SoubCfg) Then
    AdrLocal = ThisWorkbook.Path
  Else
    Open SoubCfg For Input As #1
    Line Input #1, AdrLocal
    Close #1
End If
GpassM = "NabidkaHZS"
Sheets("_Cenova_nabidka").Unprotect (GpassM)
'AdrSit = "\\xshare.cezdata.corp\skupinacez\cezdistribuce\Portal\TECHNICK|fffd|_STANDARDY_|fffd|EZ_DISTRIBUCE\RPKros"
'AdrSit = "\\xshare.cezdata.corp\skupinacez\cezdistribuce\Portal\TECHNICK|fffd|_STANDARDY_|fffd|EZ_DISTRIBUCE\RPKros"
AdrSit = "U:\CEZDistribuce\12_800000\12_850000\12_850300\KROS\Vr\HZS"
If fs.FolderExists(AdrLocal) Then
  ChDir AdrLocal
End If
RozpocetKROSu = Application.GetOpenFilename("Exportovan|fffd| Rozpo|fffd|ty KROSu (*.xls), *.xls")
Application.ScreenUpdating = False ' pak to obnov
If RozpocetKROSu <> False Then

  Sheets("_Pracovni").Range("A1:Z65535").ClearContents
  Sheets("_konfig").Range("A1:Z65535").ClearContents
  'If Right(RozpocetKROSu, 21) = " - rekap. objekt|fffd|.xls" Then
  '   RozpocetKROSuRekObj = RozpocetKROSu
  '   RozpocetKROSu = Left(RozpocetKROSu, Len(RozpocetKROSu) - 21) + ".xls"
  'Else
  '   RozpocetKROSuRekObj = Left(RozpocetKROSu, Len(RozpocetKROSu) - 4) + " - rekap. objekt|fffd|.xls"
  'End If
  Set f = fs.GetFile(RozpocetKROSu)
  sk = fs.BuildPath(AdrSit, fs.GetFileName(RozpocetKROSu))
  If AdrCfg <> "" Then
    Open SoubCfg For Output As #1
    Print #1, fs.GetParentFolderName(RozpocetKROSu)
    Close #1
  End If
  If Not fs.FileExists(RozpocetKROSu) Then
    MsgBox "Nelze naj|fffd|t soubor " + RozpocetKROSu + " !"
    Exit Sub
  End If
  'If Not fs.FileExists(RozpocetKROSuRekObj) Then
  '  MsgBox "Nelze naj|fffd|t soubor " + RozpocetKROSuRekObj + " !"
  '  Exit Sub
  'End If
  On Error GoTo chyba
  b = fs.CopyFile(RozpocetKROSu, sk, True)
  'sk = fs.BuildPath(AdrSit, fs.GetFileName(RozpocetKROSuRekObj))
  'b = fs.CopyFile(RozpocetKROSuRekObj, sk, True)
  On Error GoTo 0
  GoTo pokracuj
chyba:
  MsgBox "Nelze kop|fffd|rovat na disk U: !"
pokracuj:
  Sheets("_Pracovni1").Range("A1:Z65535").ClearContents
  jmenoakt = Application.ThisWorkbook.Name
    
  Call SmazListy
'==========================rozpocet==============================
  Workbooks.Open FileName:=RozpocetKROSu
  'ActiveWorkbook.Save
  jmenoKros = Application.ActiveWorkbook.Name
  ActiveWorkbook.Unprotect (Gpass)
  pocet_listu = ActiveWorkbook.Sheets.Count
  'Test struktury souboru
  ChybStru = True
  For i = 1 To pocet_listu
    jmeno_listu = Workbooks(jmenoKros).Sheets(i).Name
    If jmeno_listu = "Ocen|fffd|n|fffd| pr|fffd|ce HZS" Then
      If Sheets(jmeno_listu).Cells(8, 1) = "K|fffd|d pr|fffd|ce" Then
        If Sheets(jmeno_listu).Cells(11, 1) = "" Then
          ChybStru = False
        End If
      End If
    End If
  Next i
  
  If ChybStru Then
    Application.ScreenUpdating = True
    MsgBox "Chybn|fffd| struktura souboru !!!", vbCritical, "Nab|fffd|dka HZS I a HZS II"
    Application.DisplayAlerts = False
    ActiveWorkbook.Save
    ActiveWindow.Close
    Application.DisplayAlerts = True
    Exit Sub
  End If
  'Zvyseni ceny materialu o 10 procent
  SAPc = Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(5, 3) ' SAP cislo
  lSAPc = Left(UCase(Trim(SAPc)), 2)
  VerzeRekapitulace = Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(2, 3)
  VerzeRekapitulace = Trim(VerzeRekapitulace)
  iVerzeRekapitulace = Val(Mid(VerzeRekapitulace, 7, 2))
  If iVerzeRekapitulace < 36 Then
     'If MsgBox("Stavba obsahuje neaktu|fffd|ln|fffd| verzi rekapitulac|fffd| (rozpo|fffd|tu) !!!" + Chr(10) + Chr(10) + "Chcete pokra|fffd|ovat ?", vbYesNo Or vbExclamation, "Nab|fffd|dka HZS I a HZS II") = vbNo Then
     '  ActiveWorkbook.Saved = True
     '  ActiveWindow.Close
     '  Exit Sub
     'End If
     MsgBox "Stavba obsahuje neaktu|fffd|ln|fffd| verzi rekapitulac|fffd| (rozpo|fffd|tu) !!!" + Chr(10) + Chr(10) + "Aktualizujte rozpo|fffd|et v KROS !", vbOKOnly Or vbExclamation, "Nab|fffd|dka HZS I a HZS II"
     ActiveWorkbook.Saved = True
     ActiveWindow.Close
     Exit Sub
  End If
  
  sVerzeNZ = Workbooks(jmenoKros).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(6, 3) ' verze NZ
  If Val(sVerzeNZ) < 166 Then
    MsgBox "Stavba je v neaktu|fffd|ln|fffd| verzi normov|fffd| z|fffd|kladny !!!" + Chr(10) + Chr(10) + "Aktualizujte rozpo|fffd|et v KROS !", vbOKOnly Or vbExclamation, "Nab|fffd|dka HZS I a HZS II"
     ActiveWorkbook.Saved = True
     ActiveWindow.Close
     Exit Sub
  End If
  'If Not (lSAPc = "IZ" Or lSAPc = "EP") Then 'Pro prelozky ne
    Call PrepoctiMaterial(jmenoKros, jmenoakt)
    Call prepocet1(jmenoKros, jmenoakt)
  'End If
  Sheets(1).Select
  k = 1
  n = 1
  o = 1
  For i = 1 To pocet_listu
    jmeno_listu = Workbooks(jmenoKros).Sheets(i).Name
    'Sheets(i).Select
    Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
    
    If jmeno_listu = "Rekapitulace n|fffd|klad|fffd| stavby" Then
      'SPP = Cells(7, 3)
      'NazevObjektu = Cells(6, 3)
      For j = 1 To 100
          Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(k, 2) = Workbooks(jmenoKros).Sheets(i).Cells(j, 2) 'Nazev
          Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(k, 3) = Workbooks(jmenoKros).Sheets(i).Cells(j, 3) 'Cena
          Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(k, 4) = Workbooks(jmenoKros).Sheets(i).Cells(j, 4) 'Upravena cena
          k = k + 1
       Next j
    End If
    If Not jmeno_listu = "Z|fffd|lo|fffd|ky v SAPu" Then
      Workbooks(jmenoKros).Sheets(i).Copy Before:=Workbooks( _
      jmenoakt).Sheets(1)
    End If
    If jmeno_listu = "Ocen|fffd|n|fffd| pr|fffd|ce HZS" Then
       m = 9
       While Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 3) <> "Ocen|fffd|n|fffd| pr|fffd|ce celkem:" _
         And Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 4) <> "Ocen|fffd|n|fffd| pr|fffd|ce celkem:"
         m = m + 1
       Wend
       'MsgBox m
       If Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 4) = "Ocen|fffd|n|fffd| pr|fffd|ce celkem:" Then
         Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 3) = "Ocen|fffd|n|fffd| pr|fffd|ce celkem:"
         Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 4) = ""
       
       End If
       'Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 7) = "Ahoj"
       Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 7).FormulaR1C1 = "=SUM(R[" + Trim(Str(-m + 9)) + "]C:R[-1]C)"
       '"=SUM(R[-m+9]C:RC[-1]C)"
       With Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 7).Font
          .Name = "Arial"
          .FontStyle = "Tu|fffd|n|fffd|"
          .Size = 10
          .Strikethrough = False
          .Superscript = False
          .Subscript = False
          .OutlineFont = False
          .Shadow = False
          .Underline = xlUnderlineStyleNone
          .ColorIndex = 5
       End With
       With Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(m, 7)
          .HorizontalAlignment = xlRight
          .VerticalAlignment = xlCenter
          .WrapText = False
          .Orientation = 0
          .AddIndent = False
          .IndentLevel = 0
          .ShrinkToFit = False
          .ReadingOrder = xlContext
          .MergeCells = False
       End With
    End If
    If jmeno_listu = "Rekapitulace n|fffd|klad|fffd| stavby" Then
      'Doplneni Komentaru
      For j = 1 To 100
        sk = Sheets("_Komentare").Cells(j, 6)
        If sk <> "" Then
          Sheets(jmeno_listu).Cells(j, 3).AddComment
          Sheets(jmeno_listu).Cells(j, 3).Comment.Text Text:=sk
        End If
        
        sk = Sheets("_Komentare").Cells(j, 7)
        If sk <> "" Then
          Sheets(jmeno_listu).Cells(j, 4).AddComment
          Sheets(jmeno_listu).Cells(j, 4).Comment.Text Text:=sk
        End If
        sk = Sheets("_Komentare").Cells(j, 8)
        If sk <> "" Then
          Sheets(jmeno_listu).Cells(j, 5).AddComment
          Sheets(jmeno_listu).Cells(j, 5).Comment.Text Text:=sk
        End If
        
      Next j
      For Each MyComments In ActiveSheet.Comments
        With MyComments
          .Shape.TextFrame.AutoSize = True
          '.Shape.Height = 200
          '.Shape.TextFrame.AutoSize = True
          'If .Shape.Width > 300 Then
            'lArea = .Shape.Width * .Shape.Height
            '.Shape.Width = 200
            ' An adjustment factor of 1.1 seems to work ok.
            '.Shape.Height = (lArea / 200) * 1.1
          'End If
        End With
      Next ' comment
    End If
    
    If Left(jmeno_listu, 14) = "Rekap. objektu" Then
      'MsgBox jmeno_listu
      SPP = Cells(7, 3)
      NazevObjektu = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(6, 3)
      HodElmon = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(29, 3)
      HSElmon = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(29, 4)
      HodZem = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(30, 3)
      HSZem = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(30, 4)
      
      Workbooks(jmenoakt).Sheets("_konfig").Cells(n, 1) = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(6, 3) 'Nazev objektu
      Workbooks(jmenoakt).Sheets("_konfig").Cells(n, 2) = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(7, 3) 'SPP
      Workbooks(jmenoakt).Sheets("_konfig").Cells(n, 3) = jmeno_listu
      Workbooks(jmenoakt).Sheets("_konfig").Cells(n, 4) = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(29, 4) 'Hod.Sazba elmon
      Workbooks(jmenoakt).Sheets("_konfig").Cells(n, 5) = Workbooks(jmenoakt).Sheets(jmeno_listu).Cells(30, 4) 'Hod.Sazba zemni
      n = n + 1
      'Kontrola priplatku pro male akce
      chybaPriplatku = False
      For j = 25 To 100
        If Cells(j, 2) = "P|fffd||fffd|platek na mechanizaci pro mal|fffd| stavby" Then
           If Not (UCase(Trim(Cells(j, 4))) = "NE" Or UCase(Trim(Cells(j, 4))) = "ANO" Or Cells(j, 4) = "") Then
             'MsgBox Cells(j, 4)
             chybaPriplatku = True
             Cells(j, 4).Select
           End If
        End If
      Next j
      If chybaPriplatku = True Then
        MsgBox "Chyba rozpo|fffd|tu - P|fffd||fffd|platek na mechanizaci pro mal|fffd| stavby"
        Exit Sub
      End If
      For j = 25 To 100
        If Cells(j, 3) <> 0 Or Cells(j, 4) <> 0 Then   'Nenulova cena
        If Cells(j, 3) <> "Aut.v|fffd|po|fffd|et" Then
        If Not Cells(j, 3).EntireRow.Hidden Then
        If UCase(Trim(Cells(j, 4))) <> "NE" Then
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 1) = NazevObjektu
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 2) = SPP
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 3) = Cells(j, 2) 'Nazev
          If Cells(j, 4) = "" Or UCase(Trim(Cells(j, 4))) = "ANO" Then
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 4) = Cells(j, 3) 'Cena
          Else
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 4) = Cells(j, 4) 'Cena
          End If
          'Doplneni ostatnich udaju
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 5) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 9) 'Dodava zhotovitel
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 6) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 10) 'V pevne cene
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 7) = j 'radek
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 8) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 7) 'ID
          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 9) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 37) 'v cene stavby
          If Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 3) = "Pr|fffd|ce" Then
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 11) = HodElmon
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 12) = HSElmon
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 13) = HodZem
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 14) = HSZem
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 10) = Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4)
            Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 15) = Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4) - _
            HodElmon * HSElmon / 1000 - HodZem * HSZem / 1000
          End If
          If Left(Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 3), 12) = "Po|fffd|et hodin " Then
            SumaNH = SumaNH + Cells(j, 3)
          End If
          'Prepocet ceny
          radekSR = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 8)
          If radekSR > 0 Then 'radek v souhrnne rekapitulaci
             If Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 4) > 0 _
             Or Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 3) > 0 Then
             Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 4) = Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 4) _
             * Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 4) / Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 3) 'Cena
          End If
          End If
          o = o + 1
        End If
        End If
        End If
        End If
      Next j
      
      'Doplneni Komentaru
      For j = 1 To 100
        sk = Sheets("_Komentare").Cells(j, 2)
        If sk <> "" Then
          Sheets(jmeno_listu).Cells(j, 2).AddComment
          Sheets(jmeno_listu).Cells(j, 2).Comment.Text Text:=sk
        End If
        
        sk = Sheets("_Komentare").Cells(j, 3)
        If sk <> "" Then
          Sheets(jmeno_listu).Cells(j, 3).AddComment
          Sheets(jmeno_listu).Cells(j, 3).Comment.Text Text:=sk
        End If
        sk = Sheets("_Komentare").Cells(j, 4)
        If sk <> "" Then
          Sheets(jmeno_listu).Cells(j, 4).AddComment
          Sheets(jmeno_listu).Cells(j, 4).Comment.Text Text:=sk
        End If
        
      Next j
      For Each MyComments In ActiveSheet.Comments
        With MyComments
          .Shape.TextFrame.AutoSize = True
          '.Shape.Height = 200
          '.Shape.TextFrame.AutoSize = True
          'If .Shape.Width > 300 Then
            'lArea = .Shape.Width * .Shape.Height
            '.Shape.Width = 200
            ' An adjustment factor of 1.1 seems to work ok.
            '.Shape.Height = (lArea / 200) * 1.1
          'End If
        End With
      Next ' comment
      
    End If
    Windows(jmenoKros).Activate
  
  Next i

  Application.DisplayAlerts = False
  'ActiveWorkbook.Save
  'ActiveWindow.Close
  ActiveWorkbook.Saved = True ' Uchlacholim excel, ze uz je ulozeno, jinak se pta bez ohledu na dalsi radky
  ActiveWindow.Close SaveChanges:=False  ' zavreni bez ulozeni
  Application.DisplayAlerts = True
  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 3) = Workbooks(jmenoakt).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(5, 3) ' SAP cislo
  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 5) = Workbooks(jmenoakt).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(4, 3) ' Nazev
  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(10, 3) = "" ' Zhotovitel
  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(8, 8) = Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(6, 6) ' Projekcni firma
  okres = Workbooks(jmenoakt).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(7, 3)
  For l = 3 To 60
    If Workbooks(jmenoakt).Sheets("_Okresy").Cells(l, 2) = okres Then
      Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 10) = Workbooks(jmenoakt).Sheets("_Okresy").Cells(l, 1) _
      + " - " + Workbooks(jmenoakt).Sheets("_Okresy").Cells(l, 2) ' Okres
    End If
  Next l
  Sheets("_Pracovni").Select
  Range("A1:Z65535").Sort Key1:=Range("B1"), Key2:=Range("C1"), Order1:=xlAscending, Header:= _
  xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
  Call zpracuj
  Application.ScreenUpdating = True
'   Sheets("_Cenova_nabidka").Protect (GpassM)
   Call TechniciOkres

End If
''=======================================Rekapitulace objekt|fffd|===============================
'  Application.StatusBar = "Na|fffd||fffd|t|fffd|m rekapitulace....."
'*  Sheets("_Pracovni").Range("A1:Z65535").ClearContents
'*  Sheets("_konfig").Range("A1:Z65535").ClearContents
'  jmenoakt = Application.ThisWorkbook.Name
'  Workbooks.Open Filename:=RozpocetKROSuRekObj
'  ActiveWorkbook.Save
'  ActiveWorkbook.Unprotect (Gpass)
'  jmenoKros = Application.ActiveWorkbook.Name
'  pocet_listu = ActiveWorkbook.Sheets.Count
'  Sheets(1).Select
'*  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 3) = Cells(5, 3) ' SAP cislo
'*  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 5) = Cells(4, 3) ' Nazev
'*  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(10, 3) = "" ' Zhotovitel
'*  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(8, 8) = Workbooks(jmenoakt).Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(5, 2) ' Projekcni firma
'-  Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 10) = "" ' Okres
'-  If Workbooks(jmenoakt).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(7, 2) = "Okres:" Then
'*    okres = Workbooks(jmenoakt).Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(7, 3)
'*    For l = 3 To 60
'*      If Workbooks(jmenoakt).Sheets("_Okresy").Cells(l, 2) = okres Then
'*        Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 10) = Workbooks(jmenoakt).Sheets("_Okresy").Cells(l, 1) _
'*        + " - " + Workbooks(jmenoakt).Sheets("_Okresy").Cells(l, 2) ' Okres
'*      End If
'*    Next l
'-  Else
'-    'Workbooks(jmenoakt).Sheets("_Cenova_Nabidka").Cells(7, 10) = "" ' Okres
'-  End If
'  'Nacteni polozek z objektu
'-  k = 1
'-  For i = 1 To pocet_listu
'-    jmeno_listu = Sheets(i).Name
'    Sheets(i).Select
'    Workbooks(jmenoKros).Sheets(i).Unprotect (Gpass)
'*    SPP = Cells(7, 3)
'*    NazevObjektu = Cells(6, 3)
'*    HodElmon = Cells(29, 3)
'*    HSElmon = Cells(29, 4)
'*    HodZem = Cells(30, 3)
'*    HSZem = Cells(30, 4)
'*    Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 1) = Cells(6, 3) 'Nazev objektu
'*    Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 2) = Cells(7, 3) 'SPP
'*    Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 3) = jmeno_listu
'*    Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 4) = Cells(29, 4) 'Hod.Sazba elmon
'*    Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 5) = Cells(30, 4) 'Hod.Sazba zemni
'*    For j = 25 To 100
'*      If Cells(j, 3) <> 0 Then 'Nenulova cena
'*      If Cells(j, 3) <> "Aut.v|fffd|po|fffd|et" Then
'*      If Not Cells(j, 3).EntireRow.Hidden Then
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 1) = NazevObjektu
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 2) = SPP
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 3) = Cells(j, 2) 'Nazev
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4) = Cells(j, 3) 'Cena
'*        'Doplneni ostatnich udaju
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 5) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 9) 'Dodava zhotovitel
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 6) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 10) 'V pevne cene
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 7) = j 'radek
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 8) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 7) 'ID
'*        Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 9) = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 37) 'v cene stavby
'*        If Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 3) = "Pr|fffd|ce" Then
'*          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 11) = HodElmon
'*          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 12) = HSElmon
'*          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 13) = HodZem
'*          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 14) = HSZem
'*          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 10) = Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4)
'*          Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 15) = Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4) - _
'*          HodElmon * HSElmon / 1000 - HodZem * HSZem / 1000
'*        End If
'*        'Prepocet ceny
'*        radekSR = Workbooks(jmenoakt).Sheets("_Nastaveni").Cells(j, 8)
'*        If radekSR > 0 Then 'radek v souhrnne rekapitulaci
'*           If Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 4) > 0 Then
'*           Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4) = Workbooks(jmenoakt).Sheets("_Pracovni").Cells(k, 4) _
'*           * Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 4) / Workbooks(jmenoakt).Sheets("_Pracovni1").Cells(radekSR, 3) 'Cena
'*        End If
'*        End If
'*        k = k + 1
'*      End If
'*      End If
'*      End If
'*    Next j
'-    Workbooks(jmenoKros).Sheets(i).Copy Before:=Workbooks( _
'-    jmenoakt).Sheets(1)
'-    Windows(jmenoKros).Activate
'-  Next i
'-  Application.DisplayAlerts = False
'-  ActiveWindow.Close
'-  Application.DisplayAlerts = False
'
'  'Call OznacNastaveni 'Zakrizkuje u polozek,zda dodava zhotovitel a zda je v cene
'*  Sheets("_Pracovni").Select
'*  Range("A1:Z65535").Sort Key1:=Range("B1"), Key2:=Range("C1"), Order1:=xlAscending, Header:= _
'*  xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
'*  Call zpracuj
'End If


'*Application.ScreenUpdating = True
'*Sheets("_Cenova_nabidka").Protect
'*Call TechniciOkres

'Doplneni normohodin
ii = 1
While Sheets("_Cenova_nabidka").Cells(ii, 1) <> "x"
ii = ii + 1
Wend
Sheets("_Cenova_nabidka").Unprotect (GpassM)
Sheets("_Cenova_nabidka").Cells(ii, 11) = SumaNH
Call Skrtni
Sheets("_Cenova_nabidka").Protect (GpassM)

'Poznamka pro rozvadece dodavane zhotovitelem
pocet_listu = ActiveWorkbook.Sheets.Count
'b = False
Sheets("_PoznZhot").Range("B3:B3").ClearContents
For i = 1 To pocet_listu
  jmeno_listu = Sheets(i).Name
  If jmeno_listu = "Dod|fffd|vky zhotovitele" Then
    Sheets("Dod|fffd|vky zhotovitele").Select
    j = 9
    While Cells(j, 3) <> "Dod|fffd|vky zhotovitele celkem:"
      If Left(Cells(j, 1), 5) = "98750" Then
        Sheets("_PoznZhot").Cells(3, 2) = "Pozor:  Seznam Dod|fffd|vky zhotovitele obsahuje stroje a za|fffd||fffd|zen|fffd|" & Chr(13) & "(nap|fffd|. rozv|fffd|d|fffd||fffd| VN),   kter|fffd| zaji|fffd||fffd|uje zhotovitel stavby !"
        Cells(j, 9) = "Pou|fffd|it|fffd| p|fffd|edepsan|fffd|ho typu  rozvad|fffd||fffd|e VN v r|fffd|mci t|fffd|to zak|fffd|zky m|fffd| ze strany |fffd|EZ Distribuce, a.s. pouze doporu|fffd|uj|fffd|c|fffd| charakter. Zhotovitel|fffd| mohou pou|fffd||fffd|t i jin|fffd| typ rozvad|fffd||fffd|e VN, ale podm|fffd|nkou je, |fffd|e v takov|fffd|m p|fffd||fffd|pad|fffd| mus|fffd| Zhotovitel ve vztahu k pou|fffd|it|fffd|mu typu rozvad|fffd||fffd|e VN po|fffd||fffd|dat o ud|fffd|len|fffd| v|fffd|jimky emailem p|fffd||fffd|slu|fffd|n|fffd|ho garanta materi|fffd|l|fffd| z |fffd|EZ Distribuce, a.s., kter|fffd| n|fffd|sledn|fffd| posoud|fffd|, jestli navrhovan|fffd| pou|fffd|it|fffd| typ rozvad|fffd||fffd|e VN spl|fffd|uje legislativn|fffd| a normativn|fffd| povinnosti (nap|fffd|. dod|fffd|n|fffd| dokumentace k rozvad|fffd||fffd|i VN, protokoly o zkou|fffd|k|fffd|ch apod.)."
        Cells(j, 3).Select
        With Selection.Font
          '.Name = "Arial"
          '.FontStyle = "Oby|fffd|ejn|fffd|"
          '.Size = 10
          '.Strikethrough = False
          '.Superscript = False
          '.Subscript = False
          '.OutlineFont = False
          '.Shadow = False
          '.Underline = xlUnderlineStyleNone
          .Color = 255
          '.TintAndShade = 0
          '.ThemeFont = xlThemeFontNone
      End With
      Columns("I:I").Select
      Selection.ColumnWidth = 50
      With Selection
        '.HorizontalAlignment = xlLeft
        '.VerticalAlignment = xlTop
        .WrapText = True
        '.Orientation = 0
        '.AddIndent = False
        '.IndentLevel = 0
        '.ShrinkToFit = False
        '.ReadingOrder = xlContext
        '.MergeCells = False
      End With
      Cells(j, 3).Select
      End If
      j = j + 1
    Wend
  End If
Next i
Sheets("_Cenova_nabidka").Select
If Sheets("_PoznZhot").Cells(3, 2) <> "" Then
  MsgBox Sheets("_PoznZhot").Cells(3, 2), vbOK, "Nab|fffd|dka HZS I a HZS II"
End If

End Sub
Sub OznacNastaveni()
Dim i As Integer, j As Integer
Dim nazev As String, nazevalt As String
i = 1

nazev = Sheets("_Pracovni").Cells(i, 3)
While nazev <> ""
  For j = 25 To 100
    If Sheets("_Nastaveni").Cells(j, 4) = nazev Or Sheets("_Nastaveni").Cells(j, 18) = nazev Then
      Sheets("_Pracovni").Cells(i, 5) = Sheets("_Nastaveni").Cells(j, 9)
      Sheets("_Pracovni").Cells(i, 6) = Sheets("_Nastaveni").Cells(j, 10)
      Sheets("_Pracovni").Cells(i, 7) = j
      Sheets("_Pracovni").Cells(i, 8) = Sheets("_Nastaveni").Cells(j, 7) 'ID
      Sheets("_Pracovni").Cells(i, 9) = Sheets("_Nastaveni").Cells(j, 37) 'v cene stavby
    End If
  Next j
  i = i + 1
  nazev = Sheets("_Pracovni").Cells(i, 3)
Wend
End Sub

Sub SmazListy()
Dim pocet_listu As Integer, i As Integer, j As Integer
Dim jmeno_listu As String
pocet_listu = ActiveWorkbook.Sheets.Count
j = 1
Application.DisplayAlerts = False
For i = 1 To pocet_listu
  jmeno_listu = Sheets(j).Name
  If Left(jmeno_listu, 1) <> "_" Then
    Sheets(j).Delete
    'Application.DisplayAlerts = True
    j = j - 1
    'MsgBox jmeno_listu
  End If
  j = j + 1
Next i
Application.DisplayAlerts = True
End Sub

Sub zpracuj()
Dim i As Integer, pozSPP As Integer, pozSPPOld As Integer, j As Integer
Dim SPP As String, SPPold As String
Dim IDpol As Integer, IDPolOld As Integer
Dim nazev As String, pocet As Integer
Dim SumaPrace As Double, SumaMaterialu As Double, SumaOstatni As Double
Sheets("_Pracovni").Select
Sheets("_Cenova_nabidka").Unprotect (GpassM)
Sheets("_Cenova_Nabidka").Range("B14:H14").ClearContents
'Sheets("_Cenova_nabidka").Unprotect
Application.StatusBar = "Zpracov|fffd|v|fffd|m rekapitulace....."
i = 15
While Sheets("_Cenova_Nabidka").Cells(i, 3) <> "CELKEM"
  Sheets("_Cenova_Nabidka").Rows(i).Delete Shift:=xlUp
Wend
Sheets("_Cenova_Nabidka").Range("D15:H15").ClearContents
SumaPrace = 0
SumaMaterialu = 0
SumaOstatni = 0
pozSPP = 14
i = 1
SPP = Cells(i, 2)
While SPP <> ""
  If Cells(i, 8) = 30 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' prace kdyz dodava zhotovitel a jsou v cene
    SumaPrace = SumaPrace + (Cells(i, 4))
  End If
  If Cells(i, 8) = 20 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' materialy zhotovitele kdyz dodava zhotovitel a jsou v cene
    SumaMaterialu = SumaMaterialu + (Cells(i, 4))
  End If
  If Cells(i, 8) = 10 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' materialy logistiky, kdyz je dodava zhotovitel
    If Left(Sheets("_Cenova_nabidka").Cells(5, 2), 32) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
      SumaMaterialu = SumaMaterialu + (Cells(i, 4))
      'Pozadavek Jary a Romana, na kterej uz zapomneli
      'SumaMaterialu = SumaMaterialu + (Cells(i, 4)) * 1.036
    Else
      SumaMaterialu = SumaMaterialu + (Cells(i, 4))
    End If
  
  End If
  
  If Cells(i, 8) = 40 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' materialy zhotovitele rez.radek
    SumaMaterialu = SumaMaterialu + (Cells(i, 4))
  End If
  
  If Cells(i, 8) = 60 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' SaZ a trafa, kdyz je dodava zhotovitel
    If Sheets("_Cenova_nabidka").Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
      SumaMaterialu = SumaMaterialu + (Cells(i, 4))
      'Pozadavek Jary a Romana, na kterej uz zapomneli
      'SumaMaterialu = SumaMaterialu + (Cells(i, 4)) * 1.036
    Else
      SumaMaterialu = SumaMaterialu + (Cells(i, 4))
    End If
  End If
  
  If Cells(i, 8) = 50 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' prace zhotovitele rez radek
    SumaPrace = SumaPrace + (Cells(i, 4))
  End If
  
  
  If Cells(i, 8) > 1100 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' ostatni hlava VII
    SumaOstatni = SumaOstatni + (Cells(i, 4))
  End If
  
  'If Cells(i, 8) = 70 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' ostatni hlava VII - zal.zdroje
  '  SumaOstatni = SumaOstatni + Cells(i, 4)
  'End If
  i = i + 1
  SPPold = SPP
  SPP = Cells(i, 2)
  If SPP <> SPPold Then
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 2) = Val(Left(SPPold, 3))
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 3) = Mid(SPPold, 7, Len(SPPold) - 6)
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 4) = Round(SumaPrace * 1000, 0)
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 5) = Round(SumaMaterialu * 1000)
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 6) = Round(SumaOstatni * 1000, 0)
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 7) = Round(SumaPrace * 1000, 0) + Round(SumaMaterialu * 1000, 0) + Round(SumaOstatni * 1000, 0)
    Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 4) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 4) + Round(SumaPrace * 1000, 0)
    Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 5) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 5) + Round(SumaMaterialu * 1000, 0)
    Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 6) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 6) + Round(SumaOstatni * 1000, 0)
    Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) _
    + Round(SumaPrace * 1000, 0) + Round(SumaMaterialu * 1000, 0) + Round(SumaOstatni * 1000, 0)
    
    Sheets("_Cenova_Nabidka").Cells(pozSPP, 8).FormulaR1C1 = "=SUM(RC[1]:RC[3])"
    'Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 8) = "AHOJ"
    SumaPrace = 0
    SumaMaterialu = 0
    SumaOstatni = 0
    pozSPP = pozSPP + 1
    If SPP <> "" Then
      Sheets("_Cenova_Nabidka").Rows(pozSPP).Insert Shift:=xlDown
      ''Sheets("_Cenova_Nabidka").Cells(pozSPP, 7).Formula = Sheets("_Cenova_Nabidka").Cells(pozSPP - 1, 7).Formula
      ''Range("G14").Select
      'Sheets("_Cenova_Nabidka").Select
      'Sheets("_Cenova_Nabidka").Cells(pozSPP - 1, 7).Copy
      'Cells(pozSPP, 7).Select
      'ActiveSheet.Paste
      'Application.CutCopyMode = False
      
      'Sheets("_Pracovni").Select
    End If
  End If
Wend
Sheets("_Cenova_Nabidka").Select
'MsgBox pozSPP
'Range("G17").Select
'    ActiveCell.FormulaR1C1 = "=SUM(R[-3]C:R[-1]C)"
Cells(pozSPP, 8).FormulaR1C1 = "=SUM(R[" + Trim(Str(14 - pozSPP)) + "]C:R[-1]C)"
Cells(pozSPP, 9).FormulaR1C1 = "=SUM(R[" + Trim(Str(14 - pozSPP)) + "]C:R[-1]C)"
Cells(pozSPP, 10).FormulaR1C1 = "=SUM(R[" + Trim(Str(14 - pozSPP)) + "]C:R[-1]C)"
Cells(pozSPP, 11).FormulaR1C1 = "=SUM(R[" + Trim(Str(14 - pozSPP)) + "]C:R[-1]C)"
'Exit Sub
'==============Pevne ceny na jine SPP============================"
Sheets("_Cenova_Nabidka").Range(Cells(pozSPP + 2, 2), Cells(pozSPP + 2, 8)).ClearContents

i = pozSPP + 3
While Sheets("_Cenova_Nabidka").Cells(i, 3) <> "CELKEM"
  Sheets("_Cenova_Nabidka").Rows(i).Delete Shift:=xlUp
Wend

Sheets("_Cenova_Nabidka").Range(Cells(pozSPP + 3, 7), Cells(pozSPP + 3, 8)).ClearContents


Sheets("_Pracovni").Select
Range("A1:Z65535").Sort Key1:=Range("H1"), Order1:=xlAscending, Header:= _
xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom

pozSPP = pozSPP + 2
pozSPPOld = pozSPP
pocet = 0
i = 1
IDpol = Cells(i, 8)
nazev = Cells(i, 3)
SumaOstatni = 0
While IDpol <> 0
  If Cells(i, 8) >= 70 And Cells(i, 8) < 1100 And Cells(i, 5) = "X" And Cells(i, 6) = "X" Then ' naklady zhotivitele na jine SPP'
    SumaOstatni = SumaOstatni + Cells(i, 4)
  End If
  nazev = Cells(i, 3)
  i = i + 1
  IDPolOld = IDpol
  IDpol = Cells(i, 8)
  If IDpol <> IDPolOld Then
    If Cells(i - 1, 8) >= 70 And Cells(i - 1, 8) < 1100 And Cells(i - 1, 5) = "X" And Cells(i - 1, 6) = "X" Then
            
      Sheets("_Cenova_Nabidka").Cells(pozSPP, 3) = nazev
      'MsgBox nazev
      Sheets("_Cenova_Nabidka").Cells(pozSPP, 7) = Round(SumaOstatni * 1000, 0)
      Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) + Round(SumaOstatni * 1000, 0)
      pozSPP = pozSPP + 1
      pocet = pocet + 1
      'If IDpol <> 0 Then
        Sheets("_Cenova_Nabidka").Rows(pozSPP).Insert Shift:=xlDown
      'End If
    End If
    SumaOstatni = 0
  End If
Wend
If pocet > 0 Then
  Sheets("_Cenova_Nabidka").Rows(pozSPP).Delete Shift:=xlUp
  'Sheets("_Cenova_Nabidka").Cells(pozSPP, 8).FormulaR1C1 = "=SUM(R[" + Trim(Str(pozSPPOld - pozSPP)) + "]C:R[-1]C)"
Else
  'Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 8).FormulaR1C1 = "=SUM(R[" + Trim(Str(pozSPPOld - pozSPP + 1)) + "]C:R[-1]C)"
  pozSPP = pozSPP + 1
End If
Sheets("_Cenova_Nabidka").Cells(pozSPP, 8).FormulaR1C1 = "=SUM(R[" + Trim(Str(pozSPPOld - pozSPP)) + "]C:R[-1]C)"

'Exit Sub
'==============Predpokladane ceny============================"
Sheets("_Cenova_Nabidka").Select
Sheets("_Cenova_Nabidka").Range(Cells(pozSPP + 3, 2), Cells(pozSPP + 3, 8)).ClearContents
i = pozSPP + 4
While Sheets("_Cenova_Nabidka").Cells(i, 3) <> "CELKEM za p|fffd|edpokl|fffd|dan|fffd| ceny"
  Sheets("_Cenova_Nabidka").Rows(i).Delete Shift:=xlUp
Wend
Sheets("_Cenova_Nabidka").Cells(pozSPP + 4, 7) = ""
Sheets("_Pracovni").Select
'Range("A1:K80").Sort Key1:=Range("H1"), Order1:=xlAscending, Header:= _
'xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom

pozSPP = pozSPP + 3
pozSPPOld = pozSPP

i = 1
IDpol = Cells(i, 8)
nazev = Cells(i, 3)
pocet = 0
SumaOstatni = 0
While IDpol <> 0
  If (Cells(i, 8) >= 70 Or Cells(i, 8) = 10 Or Cells(i, 8) = 60) And Cells(i, 5) = "X" And Cells(i, 6) = "" Then ' naklady zhotivitele na jine SPP'
    SumaOstatni = SumaOstatni + Cells(i, 4)
  End If

  nazev = Cells(i, 3)
  i = i + 1
  IDPolOld = IDpol
  IDpol = Cells(i, 8)
  If IDpol <> IDPolOld Then
    If (Cells(i - 1, 8) >= 70 Or Cells(i - 1, 8) = 10 Or Cells(i - 1, 8) = 60) And Cells(i - 1, 5) = "X" And Cells(i - 1, 6) = "" Then
      Sheets("_Cenova_Nabidka").Cells(pozSPP, 3) = nazev
      Sheets("_Cenova_Nabidka").Cells(pozSPP, 7) = Round(SumaOstatni * 1000, 0)
      Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) + Round(SumaOstatni * 1000, 0)
      pozSPP = pozSPP + 1
       pocet = pocet + 1
      If IDpol <> 0 Then
        Sheets("_Cenova_Nabidka").Rows(pozSPP).Insert Shift:=xlDown
      End If
    End If
    SumaOstatni = 0
  End If
Wend
If pocet > 0 Then
  Sheets("_Cenova_Nabidka").Rows(pozSPP).Delete Shift:=xlUp
 'Sheets("_Cenova_Nabidka").Cells(pozSPP, 8).FormulaR1C1 = "=SUM(R[" + Trim(Str(pozSPPOld - pozSPP)) + "]C:R[-1]C)"
Else
  pozSPP = pozSPP + 1
End If
'Exit Sub
'===naklady DSO=======
Sheets("_Cenova_Nabidka").Select
Sheets("_Cenova_Nabidka").Range(Cells(pozSPP + 3, 2), Cells(pozSPP + 4, 8)).ClearContents


i = pozSPP + 5
While Sheets("_Cenova_Nabidka").Cells(i, 3) <> "CELKEM za ceny hrazen|fffd| objednatelem"
  Sheets("_Cenova_Nabidka").Rows(i).Delete Shift:=xlUp
Wend
Sheets("_Cenova_Nabidka").Cells(pozSPP + 5, 7) = ""
Sheets("_Cenova_Nabidka").Cells(pozSPP + 3, 3) = "Cena za zaji|fffd|t|fffd|n|fffd| PD - cel|fffd| hlava I"
i = 1
While Sheets("_Pracovni1").Cells(i, 2) <> "I. Projektov|fffd| a pr|fffd|zkumn|fffd| pr|fffd|ce"
  i = i + 1
Wend
Sheets("_Cenova_Nabidka").Cells(pozSPP + 3, 7) = Sheets("_Pracovni1").Cells(i, 3) * 1000
SumaOstatni = 0
Sheets("_Cenova_Nabidka").Cells(pozSPP + 5, 7) = Sheets("_Pracovni1").Cells(i, 3) * 1000
'Exit Sub
Sheets("_Pracovni").Select
'Range("A1:K80").Sort Key1:=Range("H1"), Order1:=xlAscending, Header:= _
'xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom

pozSPP = pozSPP + 4
pozSPPOld = pozSPP

i = 1
IDpol = Cells(i, 8)
nazev = Cells(i, 3)

While IDpol <> 0
  If Cells(i, 5) = "" And Cells(i, 9) = "X" Then  ' naklady DSO'
    SumaOstatni = SumaOstatni + Cells(i, 4)
  End If

  nazev = Cells(i, 3)
  i = i + 1
  IDPolOld = IDpol
  IDpol = Cells(i, 8)
  If IDpol <> IDPolOld Then
    If Cells(i - 1, 5) = "" And Cells(i - 1, 9) = "X" Then
      Sheets("_Cenova_Nabidka").Cells(pozSPP, 3) = nazev
      Sheets("_Cenova_Nabidka").Cells(pozSPP, 7) = Round(SumaOstatni * 1000, 0)
      Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) = Sheets("_Cenova_Nabidka").Cells(pozSPP + 1, 7) + Round(SumaOstatni * 1000, 0)
      pozSPP = pozSPP + 1
      If IDpol <> 0 Then
        Sheets("_Cenova_Nabidka").Rows(pozSPP).Insert Shift:=xlDown
      End If
    End If
    SumaOstatni = 0
  End If
Wend
'Sheets("_Cenova_Nabidka").Rows(pozSPP).Delete Shift:=xlUp

Sheets("_Cenova_Nabidka").Select
Application.StatusBar = ""
Application.StatusBar = False
Sheets("_Cenova_Nabidka").Select
Call SkryjDSO
Cells(13, 2).Select
Sheets("_Cenova_nabidka").Protect (GpassM)
End Sub
Function cestainiNew() As String
Dim cesta As String
Dim i As Integer
cesta = Space(10000)
hyperjump = SHGetSpecialFolderPath(0, cesta, 28, 0)
i = Len(cesta)
While Mid(cesta, i, 1) = Chr(32)
  i = i - 1
Wend
cesta = Left(cesta, i - 1)
cestainiNew = cesta + "\"
End Function


Function cestaini() As String
Dim cesta As String, cesta1 As String
Dim delka As Long
Dim i As Integer
Dim ini As String
cesta = Space(10000)
hyperjump = SHGetSpecialFolderPath(0, cesta, 28, 0)
i = Len(cesta)
While Mid(cesta, i, 1) = Chr(32)
  i = i - 1
Wend
If i = 1 Then
  hyperjump = SHGetSpecialFolderPath(0, cesta, 26, 0)
  i = Len(cesta)
  While Mid(cesta, i, 1) = Chr(32)
    i = i - 1
  Wend
  cesta1 = Left(cesta, i - 1)
  i = Len(cesta1)
  While Mid(cesta1, i, 1) <> "\"
    i = i - 1
  Wend
  cesta1 = Left(cesta, i)
  cesta1 = cesta1 + "M|fffd|stn|fffd| nastaven|fffd|\Data aplikac|fffd|\mat.ini"
Else
  cesta1 = Left(cesta, i - 1)
  cesta1 = cesta1 + "\mat.ini"
End If
Set fs = CreateObject("Scripting.FileSystemObject")
If Not fs.FileExists(cesta1) Then
  cestaini = ""
Else
  Open cesta1 For Binary As #1
  ini = Input(32, #1)
  ini = Input(1, #1)
  delka = Asc(ini)
  ini = Input(1, #1)
  delka = delka + Asc(ini) * 256
  ini = Input(2, #1)
  ini = Input(delka, #1)
  Close #1
  cestaini = ini
End If
End Function

Attribute VB_Name = "Module10"
Sub Skrtni()
Dim i As Integer, pocet_listu As Integer
Dim JeMaterial As Boolean
'Sheets("_Cenova_nabidka").Unprotect (GpassM)
i = 12
While Cells(i, 2) <> "Po|fffd|adavek zhotovitele na zaji|fffd|t|fffd|n|fffd| vyp|fffd|n|fffd|n|fffd| a manipulac|fffd| od f.|fffd|EZ"
  i = i + 1
Wend

If Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
  With Range(Cells(i, 2), Cells(i, 8)).Font
    '.Strikethrough = True
    ' nepreskrtavat pozadavek na manipulace od 2018
    .Strikethrough = False
  End With
Else
  With Range(Cells(i, 2), Cells(i, 8)).Font
   .Strikethrough = False
  End With
End If

pocet_listu = ActiveWorkbook.Sheets.Count
'Test zda obsahuje material DSO
JeMaterial = False
For j = 1 To pocet_listu
  jmeno_listu = Sheets(j).Name
  If (jmeno_listu = "Stroje a za|fffd||fffd|zen|fffd| |fffd|LG" And Sheets("_Nastaveni").Cells(25, 9) <> "X") Or _
    (jmeno_listu = "Ostatn|fffd| dod|fffd|vky |fffd|LG" And Sheets("_Nastaveni").Cells(26, 9) <> "X") Or _
    (jmeno_listu = "Silov|fffd| trafa |fffd|LG" And Sheets("_Nastaveni").Cells(25, 9) <> "X") Then
    JeMaterial = True
  End If
Next j
While Cells(i, 2) <> "M|fffd|sto dod|fffd|vky materi|fffd|lu (ulice .|fffd|.p):"
  i = i + 1
Wend
If JeMaterial = False Then
'If Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" And JeMaterial = False Then
  With Range(Cells(i, 2), Cells(i + 2, 11)).Font
    .Strikethrough = True
  End With
Else
  With Range(Cells(i, 2), Cells(i + 2, 11)).Font
   .Strikethrough = False
  End With
End If

End Sub
Attribute VB_Name = "Module2"
'Sub Auto_open()
  'Sheets("_Cenova_Nabidka").OnEntry = "CNzmena"
'End Sub
'Sub CNzmena()
'MsgBox "ahoj"
'End Sub
Sub oznac(jmeno As String, hodnota As Boolean)
Dim IdCB As String, IdCbi As Integer, i As Integer
'MsgBox jmeno
'MsgBox hodnota
IdCB = Right(jmeno, 3)
If Right(jmeno, 1) = "1" Then
  IdCB = Left(IdCB, 2) + "0"
End If
IdCbi = Val(IdCB)
i = 25
While Sheets("_Nastaveni").Cells(i, 7) <> IdCbi
  i = i + 1
Wend
If Right(jmeno, 1) = "0" Then
  If hodnota Then
    Sheets("_Nastaveni").Cells(i, 9) = "X"
  Else
    Sheets("_Nastaveni").Cells(i, 9) = ""
  End If
Else
  If hodnota Then
    Sheets("_Nastaveni").Cells(i, 10) = "X"
  Else
    Sheets("_Nastaveni").Cells(i, 10) = ""
  End If

End If
End Sub

Sub TypStavby()
  Sheets("_Cenova_nabidka").Unprotect (GpassM)
  frmTypStavby.Show
  Application.ScreenUpdating = False
  If Sheets("_Cenova_Nabidka").Cells(7, 3) <> "" Then 'Vybrana stavba - SAP cislo
    Call OznacNastaveni 'Zakrizkuje u polozek,zda dodava zhotovitel a zda je v cene
    Sheets("_Pracovni").Select
    Range("A1:K65535").Sort Key1:=Range("B1"), Key2:=Range("C1"), Order1:=xlAscending, Header:= _
    xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    Call zpracuj
  End If
  Application.ScreenUpdating = True
  Sheets("_Cenova_nabidka").Unprotect (GpassM)
  Call Skrtni
  Sheets("_Cenova_nabidka").Protect (GpassM)
End Sub
Sub VyberOkres()
frmOkresy.Show

End Sub

Function testProCB(sloupec1 As Integer, CBname As String)
Dim IdCB As Integer, i As Integer

IdCB = Val(Right(CBname, 3))
'MsgBox sloupec1
testProCB = False
For i = 25 To 100
  If Sheets("_Nastaveni").Cells(i, 7) = IdCB Then
    'MsgBox i
    If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
      testProCB = True
    End If
  End If
Next i
End Function
Sub sloupecNast(sloupec0 As Integer, sloupec1 As Integer)
Dim rezim As Integer
rezim = 0
If Sheets("_Cenova_Nabidka").Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS I" Then
  rezim = 1
End If
If Sheets("_Cenova_Nabidka").Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby mimo HZS" Then
  rezim = 2
End If
Select Case rezim
  Case 0
    sloupec0 = 13
    sloupec1 = 14
  Case 1
    sloupec0 = 11
    sloupec1 = 12
  Case 2
    sloupec0 = 15
    sloupec1 = 16
End Select
End Sub
Sub vsechny9()
  If Sheets("_Nastaveni").CB070.Enabled Then
    Sheets("_Nastaveni").CB070.Value = True
  End If

  If Sheets("_Nastaveni").CB080.Enabled Then
    Sheets("_Nastaveni").CB080.Value = True
  End If
  If Sheets("_Nastaveni").CB090.Enabled Then
    Sheets("_Nastaveni").CB090.Value = True
  End If
  If Sheets("_Nastaveni").CB100.Enabled Then
    Sheets("_Nastaveni").CB100.Value = True
  End If
  If Sheets("_Nastaveni").CB110.Enabled Then
    Sheets("_Nastaveni").CB110.Value = True
  End If
  If Sheets("_Nastaveni").CB120.Enabled Then
    Sheets("_Nastaveni").CB120.Value = True
  End If
  If Sheets("_Nastaveni").CB130.Enabled Then
    Sheets("_Nastaveni").CB130.Value = True
  End If
  If Sheets("_Nastaveni").CB140.Enabled Then
    Sheets("_Nastaveni").CB140.Value = True
  End If
  If Sheets("_Nastaveni").CB150.Enabled Then
    Sheets("_Nastaveni").CB150.Value = True
  End If
  If Sheets("_Nastaveni").CB160.Enabled Then
    Sheets("_Nastaveni").CB160.Value = True
  End If
End Sub
Sub zadny9()
  If Sheets("_Nastaveni").CB070.Enabled Then
    Sheets("_Nastaveni").CB070.Value = False
  End If
  If Sheets("_Nastaveni").CB080.Enabled Then
    Sheets("_Nastaveni").CB080.Value = False
  End If
  If Sheets("_Nastaveni").CB090.Enabled Then
    Sheets("_Nastaveni").CB090.Value = False
  End If
  If Sheets("_Nastaveni").CB100.Enabled Then
    Sheets("_Nastaveni").CB100.Value = False
  End If
  If Sheets("_Nastaveni").CB110.Enabled Then
    Sheets("_Nastaveni").CB110.Value = False
  End If
  If Sheets("_Nastaveni").CB120.Enabled Then
    Sheets("_Nastaveni").CB120.Value = False
  End If
  If Sheets("_Nastaveni").CB130.Enabled Then
    Sheets("_Nastaveni").CB130.Value = False
  End If
  If Sheets("_Nastaveni").CB140.Enabled Then
    Sheets("_Nastaveni").CB140.Value = False
  End If
  If Sheets("_Nastaveni").CB150.Enabled Then
    Sheets("_Nastaveni").CB150.Value = False
  End If
  If Sheets("_Nastaveni").CB160.Enabled Then
    Sheets("_Nastaveni").CB160.Value = False
  End If
End Sub

Sub NastavCheckBoxy()
Dim i As Integer, sloupec1 As Integer, sloupec0 As Integer
Call sloupecNast(sloupec0, sloupec1)
'Select Case rezim
'  Case 0
'    sloupec0 = 13
'    sloupec1 = 14
'  Case 1
'    sloupec0 = 11
'    sloupec1 = 12
'  Case 2
'    sloupec0 = 15
'    sloupec1 = 16
'End Select
For i = 25 To 100
  Select Case Sheets("_Nastaveni").Cells(i, 7)
  Case 10
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB010.Value = False
        Sheets("_Nastaveni").CB010.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB010.Value = True
        Sheets("_Nastaveni").CB010.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB010.Value = True
        Sheets("_Nastaveni").CB010.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB010.Value = False
        Sheets("_Nastaveni").CB010.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB011.Value = Sheets("_Nastaveni").CB010.Value
        Sheets("_Nastaveni").CB011.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB011.Value = Sheets("_Nastaveni").CB010.Value
        Sheets("_Nastaveni").CB011.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB011.Value = Sheets("_Nastaveni").CB010.Value
        Sheets("_Nastaveni").CB011.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB011.Value = False
        Sheets("_Nastaveni").CB011.Enabled = False
      End If
  Case 20
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB020.Value = False
        Sheets("_Nastaveni").CB020.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB020.Value = True
        Sheets("_Nastaveni").CB020.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB020.Value = True
        Sheets("_Nastaveni").CB020.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB020.Value = False
        Sheets("_Nastaveni").CB020.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB021.Value = Sheets("_Nastaveni").CB020.Value
        Sheets("_Nastaveni").CB021.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB021.Value = Sheets("_Nastaveni").CB020.Value
        Sheets("_Nastaveni").CB021.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB021.Value = Sheets("_Nastaveni").CB020.Value
        Sheets("_Nastaveni").CB021.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB021.Value = False
        Sheets("_Nastaveni").CB021.Enabled = False
      End If
  Case 30
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB030.Value = False
        Sheets("_Nastaveni").CB030.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB030.Value = True
        Sheets("_Nastaveni").CB030.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB030.Value = True
        Sheets("_Nastaveni").CB030.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB030.Value = False
        Sheets("_Nastaveni").CB030.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB031.Value = Sheets("_Nastaveni").CB030.Value
        Sheets("_Nastaveni").CB031.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB031.Value = Sheets("_Nastaveni").CB030.Value
        Sheets("_Nastaveni").CB031.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB031.Value = Sheets("_Nastaveni").CB030.Value
        Sheets("_Nastaveni").CB031.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB031.Value = False
        Sheets("_Nastaveni").CB031.Enabled = False
      End If
  Case 40
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB040.Value = False
        Sheets("_Nastaveni").CB040.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB040.Value = True
        Sheets("_Nastaveni").CB040.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB040.Value = True
        Sheets("_Nastaveni").CB040.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB040.Value = False
        Sheets("_Nastaveni").CB040.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB041.Value = Sheets("_Nastaveni").CB040.Value
        Sheets("_Nastaveni").CB041.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB041.Value = Sheets("_Nastaveni").CB040.Value
        Sheets("_Nastaveni").CB041.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB041.Value = Sheets("_Nastaveni").CB040.Value
        Sheets("_Nastaveni").CB041.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB041.Value = False
        Sheets("_Nastaveni").CB041.Enabled = False
      End If
  Case 50
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB050.Value = False
        Sheets("_Nastaveni").CB050.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB050.Value = True
        Sheets("_Nastaveni").CB050.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB050.Value = True
        Sheets("_Nastaveni").CB050.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB050.Value = False
        Sheets("_Nastaveni").CB050.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB051.Value = Sheets("_Nastaveni").CB050.Value
        Sheets("_Nastaveni").CB051.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB051.Value = Sheets("_Nastaveni").CB050.Value
        Sheets("_Nastaveni").CB051.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB051.Value = Sheets("_Nastaveni").CB050.Value
        Sheets("_Nastaveni").CB051.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB051.Value = False
        Sheets("_Nastaveni").CB051.Enabled = False
      End If
   Case 60
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB060.Value = False
        Sheets("_Nastaveni").CB060.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB060.Value = True
        Sheets("_Nastaveni").CB060.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB060.Value = True
        Sheets("_Nastaveni").CB060.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB060.Value = False
        Sheets("_Nastaveni").CB060.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB061.Value = Sheets("_Nastaveni").CB060.Value
        Sheets("_Nastaveni").CB061.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB061.Value = Sheets("_Nastaveni").CB060.Value
        Sheets("_Nastaveni").CB061.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB061.Value = Sheets("_Nastaveni").CB060.Value
        Sheets("_Nastaveni").CB061.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB061.Value = False
        Sheets("_Nastaveni").CB061.Enabled = False
      End If
  Case 70
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB070.Value = False
        Sheets("_Nastaveni").CB070.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB070.Value = True
        Sheets("_Nastaveni").CB070.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB070.Value = True
        Sheets("_Nastaveni").CB070.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB070.Value = False
        Sheets("_Nastaveni").CB070.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB071.Value = Sheets("_Nastaveni").CB070.Value
        Sheets("_Nastaveni").CB071.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB071.Value = Sheets("_Nastaveni").CB070.Value
        Sheets("_Nastaveni").CB071.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB071.Value = Sheets("_Nastaveni").CB070.Value
        Sheets("_Nastaveni").CB071.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB071.Value = False
        Sheets("_Nastaveni").CB071.Enabled = False
      End If
  Case 80
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB080.Value = False
        Sheets("_Nastaveni").CB080.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB080.Value = True
        Sheets("_Nastaveni").CB080.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB080.Value = True
        Sheets("_Nastaveni").CB080.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB080.Value = False
        Sheets("_Nastaveni").CB080.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB081.Value = Sheets("_Nastaveni").CB080.Value
        Sheets("_Nastaveni").CB081.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB081.Value = Sheets("_Nastaveni").CB080.Value
        Sheets("_Nastaveni").CB081.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB081.Value = Sheets("_Nastaveni").CB080.Value
        Sheets("_Nastaveni").CB081.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB081.Value = False
        Sheets("_Nastaveni").CB081.Enabled = False
      End If
  Case 90
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB090.Value = False
        Sheets("_Nastaveni").CB090.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB090.Value = True
        Sheets("_Nastaveni").CB090.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB090.Value = True
        Sheets("_Nastaveni").CB090.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB090.Value = False
        Sheets("_Nastaveni").CB090.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB091.Value = Sheets("_Nastaveni").CB090.Value
        Sheets("_Nastaveni").CB091.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB091.Value = Sheets("_Nastaveni").CB090.Value
        Sheets("_Nastaveni").CB091.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB091.Value = Sheets("_Nastaveni").CB090.Value
        Sheets("_Nastaveni").CB091.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB091.Value = False
        Sheets("_Nastaveni").CB091.Enabled = False
      End If
  Case 100
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB100.Value = False
        Sheets("_Nastaveni").CB100.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB100.Value = True
        Sheets("_Nastaveni").CB100.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB100.Value = True
        Sheets("_Nastaveni").CB100.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB100.Value = False
        Sheets("_Nastaveni").CB100.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB101.Value = Sheets("_Nastaveni").CB100.Value
        Sheets("_Nastaveni").CB101.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB101.Value = Sheets("_Nastaveni").CB100.Value
        Sheets("_Nastaveni").CB101.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB101.Value = Sheets("_Nastaveni").CB100.Value
        Sheets("_Nastaveni").CB101.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB101.Value = False
        Sheets("_Nastaveni").CB101.Enabled = False
      End If
   Case 110
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB110.Value = False
        Sheets("_Nastaveni").CB110.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB110.Value = True
        Sheets("_Nastaveni").CB110.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB110.Value = True
        Sheets("_Nastaveni").CB110.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB110.Value = False
        Sheets("_Nastaveni").CB110.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB111.Value = Sheets("_Nastaveni").CB110.Value
        Sheets("_Nastaveni").CB111.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB111.Value = Sheets("_Nastaveni").CB110.Value
        Sheets("_Nastaveni").CB111.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB111.Value = Sheets("_Nastaveni").CB110.Value
        Sheets("_Nastaveni").CB111.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB111.Value = False
        Sheets("_Nastaveni").CB111.Enabled = False
      End If
    Case 120
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB120.Value = False
        Sheets("_Nastaveni").CB120.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB120.Value = True
        Sheets("_Nastaveni").CB120.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB120.Value = True
        Sheets("_Nastaveni").CB120.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB120.Value = False
        Sheets("_Nastaveni").CB120.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB121.Value = Sheets("_Nastaveni").CB120.Value
        Sheets("_Nastaveni").CB121.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB121.Value = Sheets("_Nastaveni").CB120.Value
        Sheets("_Nastaveni").CB121.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB121.Value = Sheets("_Nastaveni").CB120.Value
        Sheets("_Nastaveni").CB121.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB121.Value = False
        Sheets("_Nastaveni").CB121.Enabled = False
      End If
  Case 130
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB130.Value = False
        Sheets("_Nastaveni").CB130.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB130.Value = True
        Sheets("_Nastaveni").CB130.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB130.Value = True
        Sheets("_Nastaveni").CB130.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB130.Value = False
        Sheets("_Nastaveni").CB130.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB131.Value = Sheets("_Nastaveni").CB130.Value
        Sheets("_Nastaveni").CB131.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB131.Value = Sheets("_Nastaveni").CB130.Value
        Sheets("_Nastaveni").CB131.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB131.Value = Sheets("_Nastaveni").CB130.Value
        Sheets("_Nastaveni").CB131.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB131.Value = False
        Sheets("_Nastaveni").CB131.Enabled = False
      End If
  Case 140
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB140.Value = False
        Sheets("_Nastaveni").CB140.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB140.Value = True
        Sheets("_Nastaveni").CB140.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB140.Value = True
        Sheets("_Nastaveni").CB140.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB140.Value = False
        Sheets("_Nastaveni").CB140.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB141.Value = Sheets("_Nastaveni").CB140.Value
        Sheets("_Nastaveni").CB141.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB141.Value = Sheets("_Nastaveni").CB140.Value
        Sheets("_Nastaveni").CB141.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB141.Value = Sheets("_Nastaveni").CB140.Value
        Sheets("_Nastaveni").CB141.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB141.Value = False
        Sheets("_Nastaveni").CB141.Enabled = False
      End If
  Case 150
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB150.Value = False
        Sheets("_Nastaveni").CB150.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB150.Value = True
        Sheets("_Nastaveni").CB150.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB150.Value = True
        Sheets("_Nastaveni").CB150.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB150.Value = False
        Sheets("_Nastaveni").CB150.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB151.Value = Sheets("_Nastaveni").CB150.Value
        Sheets("_Nastaveni").CB151.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB151.Value = Sheets("_Nastaveni").CB150.Value
        Sheets("_Nastaveni").CB151.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB151.Value = Sheets("_Nastaveni").CB150.Value
        Sheets("_Nastaveni").CB151.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB151.Value = False
        Sheets("_Nastaveni").CB151.Enabled = False
      End If
   Case 160
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "v" Then
        Sheets("_Nastaveni").CB160.Value = False
        Sheets("_Nastaveni").CB160.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "X" Then
        Sheets("_Nastaveni").CB160.Value = True
        Sheets("_Nastaveni").CB160.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "V" Then
        Sheets("_Nastaveni").CB160.Value = True
        Sheets("_Nastaveni").CB160.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec0) = "" Then
        Sheets("_Nastaveni").CB160.Value = False
        Sheets("_Nastaveni").CB160.Enabled = False
      End If
      
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "v" Then
        Sheets("_Nastaveni").CB161.Value = Sheets("_Nastaveni").CB160.Value
        Sheets("_Nastaveni").CB161.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "X" Then
        Sheets("_Nastaveni").CB161.Value = Sheets("_Nastaveni").CB160.Value
        Sheets("_Nastaveni").CB161.Enabled = False
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "V" Then
        Sheets("_Nastaveni").CB161.Value = Sheets("_Nastaveni").CB160.Value
        Sheets("_Nastaveni").CB161.Enabled = True
      End If
      If Sheets("_Nastaveni").Cells(i, sloupec1) = "" Then
        Sheets("_Nastaveni").CB161.Value = False
        Sheets("_Nastaveni").CB161.Enabled = False
      End If
  End Select

Next i
End Sub

Attribute VB_Name = "Module3"
Sub JdiDoNastaveni()
Sheets("_Nastaveni").Select
End Sub

Sub JdiDoNabidky()
Dim SAPc As String, lSAPc As String
Sheets("_Cenova_Nabidka").Select
  Application.ScreenUpdating = False
  If Sheets("_Cenova_Nabidka").Cells(7, 3) <> "" Then
    SAPc = Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(5, 3) ' SAP cislo
    lSAPc = Left(UCase(Trim(SAPc)), 2)
    'If Not (lSAPc = "IZ" Or lSAPc = "EP") Then 'Pro prelozky ne
      Call prepocet2
      Call otevri1
    'End If
    Call OznacNastaveni 'Zakrizkuje u polozek,zda dodava zhotovitel a zda je v cene
    Sheets("_Pracovni").Select
    Range("A1:K65535").Sort Key1:=Range("B1"), Key2:=Range("C1"), Order1:=xlAscending, Header:= _
    xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
    Call zpracuj
  End If
  Sheets("_Cenova_nabidka").Unprotect (GpassM)
  Call Skrtni
  Sheets("_Cenova_nabidka").Protect (GpassM)
  Application.ScreenUpdating = True
End Sub
Sub NastavFirmy()
Dim rezim As String
Dim okres As String
rezim = Sheets("_Cenova_nabidka").Cells(5, 2)
okres = Left(Sheets("_Cenova_nabidka").Cells(7, 10), 2)
If Not (rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS I" Or Left(rezim, 32) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II") Then
   MsgBox "V|fffd|b|fffd|r zhotovitele je mo|fffd|n|fffd| pouze v re|fffd|imu HZSI nebo HZSII!"
   Exit Sub
End If
If okres = "" Then
   MsgBox "Nen|fffd| zvolen |fffd||fffd|dn|fffd| okres!"
   Exit Sub
End If
frmZhotovitel.Show
End Sub
Sub prepocet()
Dim i As Integer, j As Integer, i0 As Integer, k As Integer
Dim HSA As Double, HSB As Double, HSC As Double, HS As Double, Suma As Double, sumaCelk As Double
Dim SPP As String, ZN As String, NazevObj As String, CisObj As String, konec As Boolean
Dim sumy(100) As Double, jmenoListu As String
Dim HSe(100) As Double, HSz(100) As Double
Dim HZSzem As Double
HSA = Sheets("_konfig").Cells(1, 31)
HSB = Sheets("_konfig").Cells(1, 33)
HSC = Sheets("_konfig").Cells(1, 35)
HZSzem = Sheets("_konfig").Cells(1, 32)
i = 1
While Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(i, 1) <> "K|fffd|d pr|fffd|ce"
  i = i + 1
Wend
i = i + 2
'MsgBox i
i0 = i
'i = 9

Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Select
For k = 1 To 100
  sumy(k) = 0
Next k
Suma = 0
sumaCelk = 0
konec = False
While Not konec
  If Cells(i, 1) = "" Then
    If i > i0 Then
      i = i + 1
    End If
    SPP = Cells(i + 1, 3)
    HSold = HS
    HS = HSC
    If SPP = "210" Then
      HS = HSA
    End If
    If SPP = "310" Then
      HS = HSB
    End If
    'Zacatek dalsiho objektu
    j = 1
    If i > i0 Then
      While Sheets("_konfig").Cells(j, 1) <> NazevObj
        j = j + 1
      Wend
      jmenoListu = Sheets("_konfig").Cells(j, 3)
      'HZSzem = Sheets(jmenoListu).Cells(30, 3)
      Sheets(jmenoListu).Cells(28, 3) = Suma / 1000
      'Oprava hod. sazby zem v rek. obj.
      Sheets(jmenoListu).Cells(30, 4) = HZSzem
      Sheets(jmenoListu).Cells(29, 4) = HSold
      sumaCelk = sumaCelk + Suma
      Calculate
      'For k = 40 To 42
      '  sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
      'Next k
      'For k = 44 To 46
      '  sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
      'Next k
      'For k = 53 To 55
      '  sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
      'Next k
      'For k = 59 To 60
      '  sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
      'Next k
      'For k = 62 To 64
      '  sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
      'Next k
      
      'MsgBox Sheets("_konfig").Cells(j, 3)
    End If
    
    If Cells(i, 3) = "Ocen|fffd|n|fffd| pr|fffd|ce celkem:" Then
      konec = True
    Else
      'CisOobj = Trim(Str(Cells(i, 3)))
      CisOobj = Trim((Cells(i, 3)))
      NazevObj = CisOobj + " - " + Cells(i, 4)
    End If
    i = i + 1
    Suma = 0
  Else 'Zpracovani polozky
    ZN = Sheets("Ocen|fffd|n|fffd| pr|fffd|ce HZS").Cells(i, 3)
    If Left(ZN, 1) <> "2" Then 'Elmont.prace
      If ZN = "" Then 'Atyp prace
        'MsgBox HZSzem
        'If Cells(i, 8) <> HZSzem Then 'Nejde o atyp zemni
        If Cells(i, 8) > 305 Then 'Nejde o atyp zemni - sazba nad305 Kc
          Cells(i, 8) = HS
          Cells(i, 9) = HS * Cells(i, 7)
        Else 'atyp zemni prace
          If Cells(i, 8) > 0 Then
            Cells(i, 8) = HZSzem
            Cells(i, 9) = HZSzem * Cells(i, 7)
          End If
        End If
        Suma = Suma + Cells(i, 9) + Cells(i, 11) + Cells(i, 13)
      Else
        Cells(i, 8) = HS
        Cells(i, 9) = HS * Cells(i, 7)
        Suma = Suma + Cells(i, 9) + Cells(i, 11) + Cells(i, 13)
      End If
    Else
      If Left(ZN, 1) = "2" And ZN <> "250" Then
        Cells(i, 8) = HZSzem
        Cells(i, 9) = HZSzem * Cells(i, 7)
      End If
      'zemni prace nebo zadlazby
      Suma = Suma + Cells(i, 9) + Cells(i, 11) + Cells(i, 13)
    End If
  End If
  i = i + 1
Wend
'Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(27, 3) = sumaCelk / 1000
'prenos souctu do rekapitulace stavby
i = 1
jmenoListu = Sheets("_konfig").Cells(i, 3)
While jmenoListu <> ""
   If Sheets(jmenoListu).Cells(28, 4) <> "" Then
     sumy(28) = sumy(28) + Sheets(jmenoListu).Cells(28, 4)
   Else
     sumy(28) = sumy(28) + Sheets(jmenoListu).Cells(28, 3)
   End If
   For k = 40 To 42
     If Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
     End If
   Next k
   For k = 44 To 46
     If Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 4)
       'MsgBox Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
       'MsgBox Sheets(jmenoListu).Cells(k, 4)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
   For k = 53 To 55
     If Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
   For k = 59 To 60
     If Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
   For k = 62 To 64
     If Sheets(jmenoListu).Cells(k, 4) <> "" Then
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 4)
     Else
       sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
     End If
     'sumy(k) = sumy(k) + Sheets(jmenoListu).Cells(k, 3)
   Next k
  i = i + 1
  jmenoListu = Sheets("_konfig").Cells(i, 3)
Wend

k = 27
Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 1)

For k = 37 To 39
  Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 41 To 43
  Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 50 To 52
  Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 56 To 57
  Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

For k = 59 To 61
  Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(k, 3) = sumy(k + 3)
Next k

Calculate
End Sub
Sub NastavFirmyOld()
Dim rezim As String
Dim region As String
Dim ireg As Integer
rezim = Sheets("_Cenova_Nabidka").Cells(5, 2)
region = Sheets("_Cenova_Nabidka").Cells(10, 3)
Select Case region
  Case "Z|fffd|pad"
    ireg = 1
  Case "St|fffd|ed"
    ireg = 2
  Case "Sever"
    ireg = 3
  Case "V|fffd|chod"
    ireg = 4
  Case "Morava"
    ireg = 5

End Select

If rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
  For i = 1 To 4
     Sheets("_Vzory").Cells(i + 65, 2) = Sheets("_Vzory").Cells(i + ireg * 4 + 33, 2)
  
  Next i
End If
End Sub


Attribute VB_Name = "Module4"
Sub SkryjDSO()
Dim i As Integer
i = 10
While Sheets("_Cenova_nabidka").Cells(i, 2) <> "Ceny hrazen|fffd| objednatelem:"
  i = i + 1
Wend
i = i - 1
While Sheets("_Cenova_nabidka").Cells(i, 2) <> "Pevn|fffd| cena celkem:"
  Rows(i).EntireRow.Hidden = True
  i = i + 1
Wend
End Sub
Sub SkryjDSO1()
Dim i As Integer
Sheets("_Cenova_nabidka").Unprotect (GpassM)
i = 10
While Sheets("_Cenova_nabidka").Cells(i, 2) <> "Ceny hrazen|fffd| objednatelem:"
  i = i + 1
Wend
i = i - 1
While Sheets("_Cenova_nabidka").Cells(i, 2) <> "Pevn|fffd| cena celkem:"
  Rows(i).EntireRow.Hidden = True
  i = i + 1
Wend
Sheets("_Cenova_nabidka").Protect (GpassM)
End Sub


Sub ZobrazDSO()
Dim i As Integer
Sheets("_Cenova_nabidka").Unprotect (GpassM)
i = 10
While Sheets("_Cenova_nabidka").Cells(i, 2) <> "Ceny hrazen|fffd| objednatelem:"
  i = i + 1
Wend
While Sheets("_Cenova_nabidka").Cells(i, 2) <> "Pevn|fffd| cena celkem:"
  Rows(i).EntireRow.Hidden = False
  i = i + 1
Wend
Sheets("_Cenova_nabidka").Protect (GpassM)
End Sub
Attribute VB_Name = "Module5"
Sub otevri1()
Dim jmeno_listu As String
Dim k As Integer, j As Integer, i As Integer
Dim SPP As String, NazevObjektu As String
Dim radekSR As Integer
Dim HodElmon As Double, HSElmon As Double, HodZem As Double, HSZem As Double
'==========================rozpocet==============================
  Sheets("_Pracovni").Range("A1:Z65535").ClearContents
  Sheets("_Pracovni1").Range("A1:Z65535").ClearContents
  k = 1
       For j = 1 To 100
          Sheets("_Pracovni1").Cells(k, 2) = Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(j, 2) 'Nazev
          Sheets("_Pracovni1").Cells(k, 3) = Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(j, 3) 'Cena
          Sheets("_Pracovni1").Cells(k, 4) = Sheets("Rekapitulace n|fffd|klad|fffd| stavby").Cells(j, 4) 'Upravena cena
          k = k + 1
       Next j
  
'=======================================Rekapitulace objekt|fffd|===============================
  'Nacteni polozek z objektu
  
  k = 1
  i = 1
  While Sheets("_konfig").Cells(i, 3) <> ""
    jmeno_listu = Sheets("_konfig").Cells(i, 3)
    Sheets(jmeno_listu).Select
    SPP = Cells(7, 3)
    NazevObjektu = Cells(6, 3)
    HodElmon = Cells(29, 3)
    HSElmon = Cells(29, 4)
    HodZem = Cells(30, 3)
    HSZem = Cells(30, 4)
    
    'Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 1) = Cells(6, 3) 'Nazev objektu
    'Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 2) = Cells(7, 3) 'SPP
    'Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 3) = jmeno_listu
    'Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 4) = Cells(29, 4) 'Hod.Sazba elmon
    'Workbooks(jmenoakt).Sheets("_konfig").Cells(i, 5) = Cells(30, 4) 'Hod.Sazba zemni
    For j = 25 To 100
      If Cells(j, 3) <> 0 Or Cells(j, 4) <> 0 Then 'Nenulova cena
      If Cells(j, 3) <> "Aut.v|fffd|po|fffd|et" Then
      If Not Cells(j, 3).EntireRow.Hidden Then
        Sheets("_Pracovni").Cells(k, 1) = NazevObjektu
        Sheets("_Pracovni").Cells(k, 2) = SPP
        Sheets("_Pracovni").Cells(k, 3) = Cells(j, 2) 'Nazev
        
          If Cells(j, 4) = "" Or UCase(Trim(Cells(j, 4))) = "ANO" Or UCase(Trim(Cells(j, 4))) = "NE" Then
            Sheets("_Pracovni").Cells(k, 4) = Cells(j, 3)
            'Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 4) = Cells(j, 3) 'Cena
          Else
            Sheets("_Pracovni").Cells(k, 4) = Cells(j, 4)
            'Workbooks(jmenoakt).Sheets("_Pracovni").Cells(o, 4) = Cells(j, 4) 'Cena
          End If
        'Sheets("_Pracovni").Cells(k, 4) = Cells(j, 3) 'Cena
        'Doplneni ostatnich udaju
        Sheets("_Pracovni").Cells(k, 5) = Sheets("_Nastaveni").Cells(j, 9) 'Dodava zhotovitel
        Sheets("_Pracovni").Cells(k, 6) = Sheets("_Nastaveni").Cells(j, 10) 'V pevne cene
        Sheets("_Pracovni").Cells(k, 7) = j 'radek
        Sheets("_Pracovni").Cells(k, 8) = Sheets("_Nastaveni").Cells(j, 7) 'ID
        Sheets("_Pracovni").Cells(k, 9) = Sheets("_Nastaveni").Cells(j, 37) 'v cene stavby
        If Sheets("_Pracovni").Cells(k, 3) = "Pr|fffd|ce" Then
          Sheets("_Pracovni").Cells(k, 11) = HodElmon
          Sheets("_Pracovni").Cells(k, 12) = HSElmon
          Sheets("_Pracovni").Cells(k, 13) = HodZem
          Sheets("_Pracovni").Cells(k, 14) = HSZem
          Sheets("_Pracovni").Cells(k, 10) = Sheets("_Pracovni").Cells(k, 4)
          Sheets("_Pracovni").Cells(k, 15) = Sheets("_Pracovni").Cells(k, 4) - _
          HodElmon * HSElmon / 1000 - HodZem * HSZem / 1000
        End If
        'Prepocet ceny
        radekSR = Sheets("_Nastaveni").Cells(j, 8)
        If radekSR > 0 Then 'radek v souhrnne rekapitulaci
           If Sheets("_Pracovni1").Cells(radekSR, 4) > 0 _
           Or Sheets("_Pracovni1").Cells(radekSR, 3) > 0 Then
           Sheets("_Pracovni").Cells(k, 4) = Sheets("_Pracovni").Cells(k, 4) _
           * Sheets("_Pracovni1").Cells(radekSR, 4) / Sheets("_Pracovni1").Cells(radekSR, 3) 'Cena
        End If
        End If
        k = k + 1
      End If
      End If
      End If
    Next j
    i = i + 1
  Wend
  Sheets("_Pracovni").Select
  Range("A1:Z65535").Sort Key1:=Range("B1"), Key2:=Range("C1"), Order1:=xlAscending, Header:= _
  xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom
End Sub
Attribute VB_Name = "Module6"
Sub TechniciOkres()
Dim i, j, k
Dim okres As String, OblastReal As String, OblastPripr As String
Dim OddPrip As String
  okres = Left(Sheets("_Cenova_Nabidka").Cells(7, 10), 2)
  i = 3
  OblastReal = ""
  OblastPripr = ""
  While Sheets("_Okresy").Cells(i, 1) <> ""
    If Sheets("_Okresy").Cells(i, 1) = okres Then
      OblastReal = Sheets("_Okresy").Cells(i, 7)
      OblastPripr = Sheets("_Okresy").Cells(i, 6)
    End If
    
    i = i + 1
  Wend
  'MsgBox OblastReal
  If OblastReal <> "" Then
    Sheets("_Technici").Range("AA2:AB100").ClearContents
    Sheets("_Technici").Range("AG2:AH100").ClearContents
    i = 2
    j = 2
    k = 2
    While Sheets("_Technici").Cells(i, 1) <> ""
      If Sheets("_Technici").Cells(i, 2) = OblastReal Then
        Sheets("_Technici").Cells(j, 28) = Sheets("_Technici").Cells(i, 1)
        Sheets("_Technici").Cells(j, 27) = Sheets("_Technici").Cells(i, 26)
        j = j + 1
      End If
      If Sheets("_Technici").Cells(i, 2) = OblastPripr Then
        Sheets("_Technici").Cells(k, 34) = Sheets("_Technici").Cells(i, 1)
        Sheets("_Technici").Cells(k, 33) = Sheets("_Technici").Cells(i, 26)
        k = k + 1
      End If
      
      i = i + 1
    Wend
  End If
  i = 3
  oddpripr = ""
  While Sheets("_Okresy").Cells(i, 1) <> ""
    If Sheets("_Okresy").Cells(i, 1) = okres Then
      OddPrip = Sheets("_Okresy").Cells(i, 6)
      'Sheets("_Cenova_nabidka").Cells(9, 8) = Sheets("_Okresy").Cells(i, 6)
    
    End If
    i = i + 1
  Wend
  If OddPrip <> "" Then
    i = 3
    While Sheets("_Oblasti_Pripravy").Cells(i, 1) <> ""
      If Sheets("_Oblasti_Pripravy").Cells(i, 1) = OddPrip Then
        Sheets("_Cenova_nabidka").Cells(9, 8) = Sheets("_Oblasti_Pripravy").Cells(i, 2)
      End If
      i = i + 1
    Wend
  End If
  'MsgBox Cells(radek, sloupec)
End Sub
Attribute VB_Name = "Module7"
Sub Poznamka()

frmPoznamka.Show

End Sub
Attribute VB_Name = "Module9"
Sub VlozDoSchranky()
Attribute VlozDoSchranky.VB_Description = "Vlo|fffd|en|fffd| aktivn|fffd| bu|fffd|ky do schr|fffd|nky"
Attribute VlozDoSchranky.VB_ProcData.VB_Invoke_Func = "C\n14"
Sheets("_Cenova_nabidka").Unprotect (GpassM)
radek = ActiveCell.Row
sloupec = ActiveCell.Column
C = Cells(radek, sloupec)
DoSchranky (C)
Cells(4, 8) = C
Sheets("_Cenova_nabidka").Protect (GpassM)
End Sub


Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()
GpassM = "NabidkaHZS"
If Sheets("_PoznZhot").Cells(3, 2) <> "" Then
frmPoznamka.Show
'Application.WindowState = xlMaximized
End If
End Sub

Attribute VB_Name = "frmOkresy"
Attribute VB_Base = "0{71C1A9C1-DE6C-4D39-A815-C03433742691}{017FCDC8-7EE4-4B26-81E9-A0DEEA3BAC25}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
'Private Sub ListBox1_Click()
'  frmOkresy.Hide
'  Unload Me
'End Sub

Private Sub CommandButton1_Click()
'MsgBox ListBox1.Value
  Sheets("_Cenova_nabidka").Unprotect (GpassM)
  Sheets("_Cenova_nabidka").Cells(7, 10) = ListBox1.Value
  Call TechniciOkres
  'MsgBox "Ahoj"
  Sheets("_Cenova_nabidka").Cells(10, 3).Select
  Sheets("_Cenova_nabidka").Cells(10, 3) = ""
  frmOkresy.Hide
  Unload Me
  Sheets("_Cenova_nabidka").Protect (GpassM)
End Sub

Private Sub CommandButton2_Click()
  frmOkresy.Hide
  Unload Me
End Sub

Private Sub ListBox1_Click()
  'MsgBox ListBox1.Value
  'Sheets("_Cenova_nabidka").Cells(9, 10) = ListBox1.Value
End Sub

Private Sub UserForm_Initialize()

Dim i As Integer, LI As Integer
Dim OkresOld As String, okres As String
i = 3
LI = 0

OkresOld = Left(Sheets("_Cenova_nabidka").Cells(7, 10), 2)

okres = Sheets("_Okresy").Cells(i, 1)
While okres <> ""
  ListBox1.AddItem (okres + " - " + Sheets("_Okresy").Cells(i, 2))
  If okres = OkresOld Then
    LI = i - 3
  End If
  i = i + 1
  okres = Sheets("_Okresy").Cells(i, 1)
Wend
  
ListBox1.ListIndex = LI
End Sub


Attribute VB_Name = "frmPoznamka"
Attribute VB_Base = "0{498A01A8-32F2-4A78-B5FC-C189634F599C}{53E42B63-6BDB-4F2A-8895-1704B9421E5E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton2_Click()
  frmPoznamka.Hide
  Unload Me
End Sub

Private Sub UserForm_Initialize()
TextBox1.Value = Sheets("_PoznZhot").Cells(3, 2)
End Sub
Private Sub CommandButton1_Click()
  Sheets("_PoznZhot").Cells(3, 2) = TextBox1.Value
  frmPoznamka.Hide
  Unload Me
End Sub
Attribute VB_Name = "frmTypStavby"
Attribute VB_Base = "0{54B99309-1A06-4731-AFFC-10547EE02BD8}{DAB972CF-82AE-4960-A7CA-CDF8D1539ABD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


'Private Sub ListBox1_Click()
'UserForm1.Hide
'End Sub
Public povoleniprekreslovat As Boolean

Private Sub CommandButton1_Click()
  Sheets("_Nastaveni").Cells(54, 9) = ""
  Sheets("_Nastaveni").Cells(54, 10) = ""
  If ListBox1.ListIndex = 0 Then
    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II (do 26.11.2018 - Star|fffd|)"
  End If
  If ListBox1.ListIndex = 1 Then
    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II"
    'Uz zase objednavame manipulace my i na HZS II - prechod CDS do DSO
    'Sheets("_Nastaveni").Cells(54, 9) = "X"
    'Sheets("_Nastaveni").Cells(54, 10) = "X"
  End If
  If ListBox1.ListIndex = 2 Then
    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS I"
  End If
  If ListBox1.ListIndex = 3 Then
    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby mimo HZS"
  End If
'  Call NastavCheckBoxy
  Sheets("_Cenova_Nabidka").Cells(10, 3) = "" ' Zhotovitel

  frmTypStavby.Hide
  Unload Me
End Sub

Private Sub CommandButton2_Click()
  frmTypStavby.Hide
  Unload Me
End Sub

Private Sub ListBox1_Click()
'If povoleniprekreslovat Then

'  If ListBox1.ListIndex = 0 Then
'    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II"
'     'Columns("H:H").Select
'    'Columns("H:H").EntireColumn.Hidden = True
'  End If
'  If ListBox1.ListIndex = 1 Then
'    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS I"
'    ''Columns("H:H").Select
'    'Columns("H:H").EntireColumn.Hidden = False
'  End If
'  If ListBox1.ListIndex = 2 Then
'    Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby nad HZS"
'    ''Columns("H:H").Select
'    'Columns("H:H").EntireColumn.Hidden = False
'  End If
'  Call NastavCheckBoxy
' frmTypStavby.Hide
'  Unload Me
'End If
End Sub

Private Sub UserForm_Initialize()
  povoleniprekreslovat = False
  ListBox1.AddItem ("Stavba v re|fffd|imu HZS II (do 26.11.2018 - Star|fffd|)")
  ListBox1.AddItem ("Stavba v re|fffd|imu HZS II")
  ListBox1.AddItem ("Stavba v re|fffd|imu HZS I")
  ListBox1.AddItem ("Stavba v re|fffd|imu mimo HZS")
  ListBox1.ListIndex = 0
  
  
  If Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS I" Then
    ListBox1.ListIndex = 2
  End If
  If Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
    ListBox1.ListIndex = 1
  End If
  If Cells(5, 2) = "Cenov|fffd| nab|fffd|dka pro stavby mimo HZS" Then
    ListBox1.ListIndex = 3
  End If
  
  povoleniprekreslovat = True
End Sub


Attribute VB_Name = "frmZhotovitel"
Attribute VB_Base = "0{34D45E31-DC88-4F2A-A95F-DF2D5EC71207}{A5FD9BFE-5149-4BFF-948A-B2B23B2D1498}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
  Dim i As Integer, j As Integer, k As Integer, l As Integer
  Dim rezim As String, NavrhZhotovitele As String
  rezim = Sheets("_Cenova_nabidka").Cells(5, 2)
  Sheets("_Cenova_nabidka").Unprotect (GpassM)
  'Sheets("_Cenova_nabidka").Cells(10, 3) = ListBox1.Value
  'i = ListBox1.ListIndex
  'MsgBox i

  ''---------------------------------------------------
  If rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS I" Then
    NavrhZhotovitele = ""
    i = -1
    For j = 0 To ListBox1.ListCount - 1
      If ListBox1.Selected(j) Then
         If i = -1 Then
           i = j
         End If
      End If
    Next j
    If i > -1 Then
      Sheets("_konfig").Range("AB1:AB100").ClearContents
      k = 1
      For j = 0 To ListBox1.ListCount - 1
        'Sheets("_konfig").Cells(j + 1, 28) = Sheets("_konfig").Cells(j + 1, 20)
        If ListBox1.Selected(j) Then
          Sheets("_konfig").Cells(k, 28) = Sheets("_konfig").Cells(j + 1, 20)
          NavrhZhotovitele = NavrhZhotovitele + ListBox1.List(j) + "// "
          k = k + 1
        End If
      Next j
      Sheets("_Cenova_nabidka").Cells(10, 3) = Left(NavrhZhotovitele, Len(NavrhZhotovitele) - 3)
      Sheets("_konfig").Cells(1, 30) = Sheets("_konfig").Cells(i + 1, 20)
      Sheets("_konfig").Cells(1, 31) = Sheets("_konfig").Cells(i + 1, 21)
      Sheets("_konfig").Cells(1, 32) = Sheets("_konfig").Cells(i + 1, 22)
      Sheets("_konfig").Cells(1, 33) = Sheets("_konfig").Cells(i + 1, 23)
      Sheets("_konfig").Cells(1, 34) = Sheets("_konfig").Cells(i + 1, 24)
      Sheets("_konfig").Cells(1, 35) = Sheets("_konfig").Cells(i + 1, 25)
      Sheets("_konfig").Cells(1, 36) = Sheets("_konfig").Cells(i + 1, 26)
    Else
      Exit Sub
    End If
  End If
  ''---------------------------------------------------
  If Left(rezim, 32) = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
    i = ListBox1.ListIndex
    If i > -1 Then
      Sheets("_konfig").Range("AB1:AB100").ClearContents
      Sheets("_konfig").Cells(1, 28) = Sheets("_konfig").Cells(i + 1, 20)
      Sheets("_Cenova_nabidka").Cells(10, 3) = ListBox1.Value
      Sheets("_konfig").Cells(1, 30) = Sheets("_konfig").Cells(i + 1, 20)
      Sheets("_konfig").Cells(1, 31) = Sheets("_konfig").Cells(i + 1, 21)
      Sheets("_konfig").Cells(1, 32) = Sheets("_konfig").Cells(i + 1, 22)
      Sheets("_konfig").Cells(1, 33) = Sheets("_konfig").Cells(i + 1, 21)
      Sheets("_konfig").Cells(1, 34) = Sheets("_konfig").Cells(i + 1, 22)
      Sheets("_konfig").Cells(1, 35) = Sheets("_konfig").Cells(i + 1, 21)
      Sheets("_konfig").Cells(1, 36) = Sheets("_konfig").Cells(i + 1, 22)
    Else
      Exit Sub
    End If
  End If
  frmZhotovitel.Hide
  Unload Me
  
  Sheets("_Cenova_nabidka").Protect (GpassM)
  Application.ScreenUpdating = False
  Call prepocet
  Call otevri1
  Call zpracuj
  Application.ScreenUpdating = True
End Sub

Private Sub CommandButton2_Click()
  frmZhotovitel.Hide
  Unload Me
End Sub

Private Sub ListBox1_Click()

End Sub

Private Sub UserForm_Initialize()
Dim okres As String
Dim rezim As String
Dim oblast1 As String
Dim oblast2 As String
Dim LI As Integer
Dim i As Integer, j As Integer, ID_Firmy As Integer, k As Integer, l As Integer
Dim FirmaOld As String
rezim = Sheets("_Cenova_nabidka").Cells(5, 2)
okres = Left(Sheets("_Cenova_nabidka").Cells(7, 10), 2)
Sheets("_konfig").Range("T1:AA100").ClearContents
'FirmaOld = Sheets("_Cenova_nabidka").Cells(10, 3)
i = 3
While Sheets("_Okresy").Cells(i, 1) <> ""
  If Sheets("_Okresy").Cells(i, 1) = okres Then
    oblast1 = Sheets("_Okresy").Cells(i, 3)
    oblast2 = Sheets("_Okresy").Cells(i, 4)
    If okres = "SM" And rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
      oblast2 = "S"
    End If
  End If
  i = i + 1
Wend
''---------------------------------------------------
If rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS I" Then
  ListBox1.MultiSelect = fmMultiSelectMulti
  i = 2
  'LI = 0
  k = 0
  While Sheets("_HOD_SAZBY_I").Cells(i, 3) <> ""
    If Sheets("_HOD_SAZBY_I").Cells(i, 3) = oblast1 Then
      ID_Firmy = Sheets("_HOD_SAZBY_I").Cells(i, 2)
      j = 3
      While Sheets("_Firmy").Cells(j, 1) <> ""
        If Sheets("_Firmy").Cells(j, 1) = ID_Firmy Then
          ListBox1.AddItem (Sheets("_Firmy").Cells(j, 2))
          l = 1
          While Sheets("_konfig").Cells(l, 28) <> ""
            If Sheets("_konfig").Cells(l, 28) = Sheets("_HOD_SAZBY_I").Cells(i, 2) Then
               ListBox1.Selected(k) = True
            End If
            l = l + 1
          Wend
          
          Sheets("_konfig").Cells(k + 1, 20) = Sheets("_HOD_SAZBY_I").Cells(i, 2)
          Sheets("_konfig").Cells(k + 1, 21) = Sheets("_HOD_SAZBY_I").Cells(i, 4)
          Sheets("_konfig").Cells(k + 1, 22) = Sheets("_HOD_SAZBY_I").Cells(i, 5)
          Sheets("_konfig").Cells(k + 1, 23) = Sheets("_HOD_SAZBY_I").Cells(i, 6)
          Sheets("_konfig").Cells(k + 1, 24) = Sheets("_HOD_SAZBY_I").Cells(i, 7)
          Sheets("_konfig").Cells(k + 1, 25) = Sheets("_HOD_SAZBY_I").Cells(i, 8)
          Sheets("_konfig").Cells(k + 1, 26) = Sheets("_HOD_SAZBY_I").Cells(i, 9)
          k = k + 1
        End If
        j = j + 1
      Wend

    End If
    i = i + 1
  Wend
  'ListBox1.ListIndex = LI
End If
''---------------------------------------------------
If rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS II" Then
  ListBox1.MultiSelect = fmMultiSelectSingle
  i = 2
  k = 0
  While Sheets("_HOD_SAZBY_II").Cells(i, 3) <> ""
    If Sheets("_HOD_SAZBY_II").Cells(i, 3) = oblast2 And Sheets("_HOD_SAZBY_II").Cells(i, 6) = "new" Then
      ID_Firmy = Sheets("_HOD_SAZBY_II").Cells(i, 2)
      j = 3
      While Sheets("_Firmy").Cells(j, 1) <> ""
        If Sheets("_Firmy").Cells(j, 1) = ID_Firmy Then
          'If Sheets("_Firmy").Cells(j, 2) = FirmaOld Then
          '  LI = k
          'End If
          ListBox1.AddItem (Sheets("_Firmy").Cells(j, 2))
          If Sheets("_konfig").Cells(1, 28) = Sheets("_HOD_SAZBY_II").Cells(i, 2) Then
             ListBox1.ListIndex = k
          End If
          Sheets("_konfig").Cells(k + 1, 20) = Sheets("_HOD_SAZBY_II").Cells(i, 2)
          Sheets("_konfig").Cells(k + 1, 21) = Sheets("_HOD_SAZBY_II").Cells(i, 4)
          Sheets("_konfig").Cells(k + 1, 22) = Sheets("_HOD_SAZBY_II").Cells(i, 5)
          k = k + 1
        End If
        j = j + 1
      Wend
    End If
    i = i + 1
  Wend
  'ListBox1.ListIndex = LI
End If
''---------------------------------------------------
If rezim = "Cenov|fffd| nab|fffd|dka pro stavby HZS II (do 26.11.2018 - Star|fffd|)" Then
  ListBox1.MultiSelect = fmMultiSelectSingle
  i = 2
  k = 0
  While Sheets("_HOD_SAZBY_II").Cells(i, 3) <> ""
    If Sheets("_HOD_SAZBY_II").Cells(i, 3) = oblast2 And Sheets("_HOD_SAZBY_II").Cells(i, 6) = "old" Then
      ID_Firmy = Sheets("_HOD_SAZBY_II").Cells(i, 2)
      j = 3
      While Sheets("_Firmy").Cells(j, 1) <> ""
        If Sheets("_Firmy").Cells(j, 1) = ID_Firmy Then
          'If Sheets("_Firmy").Cells(j, 2) = FirmaOld Then
          '  LI = k
          'End If
          ListBox1.AddItem (Sheets("_Firmy").Cells(j, 2))
          If Sheets("_konfig").Cells(1, 28) = Sheets("_HOD_SAZBY_II").Cells(i, 2) Then
             ListBox1.ListIndex = k
          End If
          Sheets("_konfig").Cells(k + 1, 20) = Sheets("_HOD_SAZBY_II").Cells(i, 2)
          Sheets("_konfig").Cells(k + 1, 21) = Sheets("_HOD_SAZBY_II").Cells(i, 4)
          Sheets("_konfig").Cells(k + 1, 22) = Sheets("_HOD_SAZBY_II").Cells(i, 5)
          k = k + 1
        End If
        j = j + 1
      Wend
    End If
    i = i + 1
  Wend
  'ListBox1.ListIndex = LI
End If


End Sub




' InQuest injected base64 decoded content
' N*Fz
' *^r&
' *^r&

INQUEST-PP=macro
