Attribute VB_Name = "MABandit"
Attribute VB_Base = "0{A7442EBD-710D-4F7D-9A4E-9A02DC82C8EB}{458FD162-2303-4B05-8AB9-0FD75001545B}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub UserForm_Activate()

Application.Wait (Now + TimeValue("0:00:02"))

Unload Me

End Sub
Attribute VB_Name = "Sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Attribute VB_Name = "Sheet13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()

    If MsgBox("Any new ones?  Let's find out.", vbOKCancel, "Update me some transfers") = vbOK Then
        ThisWorkbook.Sheets("2 Year Projection").Unprotect
        ThisWorkbook.UpdateLink Type:=xlExcelLinks

    ThisWorkbook.Sheets("Transfers").Select
        Range("S1").Select
        ActiveSheet.Range("$A$1:$S$1000").AutoFilter Field:=19, Criteria1:="<>"
        Range("A1").Select
    On Error Resume Next
    
    Else
    Exit Sub
    End If

End Sub
Attribute VB_Name = "Sheet16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet26"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet27"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "Launch2, 4, 0, MSForms, CommandButton"
Attribute VB_Control = "Launch1, 3, 1, MSForms, CommandButton"
Public Sub Launch1_Click()

'This code moves information from the Utilization Report to the Two-Year Tool

'Did you hit button without putting in a PHA code?
    
    If ThisWorkbook.Sheets("2 Year Projection").Range("I2").Value = "" And ThisWorkbook.Sheets("2 Year Projection").Range("I9").Value = "" Then
        MsgBox "I'm coming at you like a spider monkey, but first, I think we forgot to put in a PHA code.", vbOKOnly, "The fieldmouse is fast, but the owl sees at night."
        Exit Sub
    End If
    
'Declare and Set File Name (before we start bouncing between workbooks)

    Dim FileName As String
    FileName = Evaluate("=SUBSTITUTE(MID(CELL(""filename""),SEARCH(""["",CELL(""filename""))+1, SEARCH(""]"",CELL(""filename""))-SEARCH(""["",CELL(""filename""))-1), "".xlsm"", """")")
    
'Embargoed

'    If ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value = "PHA" And ThisWorkbook.Sheets("+FMCExcessCash").Range("L3").Value = "X" Then
'        MsgBox "This PHA does not yet have a finalized 12/31/2018 RNP reconciliation.  Until then, we need to wait to run a Tool.", vbOKOnly, "Embargoed"
'    Exit Sub
'
'    ElseIf ThisWorkbook.Sheets("+FMCExcessCash").Range("L3").Value = "X" Then
'        MsgBox "I'm coming at you like a spider monkey, but first, we would need reconciled reserves, which we don't have.  Let's keep going with 2018 as Year 1.  EMBARGOED!", vbOKOnly, "The fieldmouse is fast, but the owl sees at night.  EMBARGOED!"
'        Link = "http://sharepoint.hud.gov/sites/PIH2/DASFO/OFO_HQ_FO/HCV/optimization/Utilization%20Reports%20%20Goo/Historical/2018/HCV%20Utilization%20Report%20December%202018.xlsm"
'        ActiveWorkbook.FollowHyperlink Address:=Link, NewWindow:=True
'        Exit Sub
'    End If
    
'Declare and Set Variables

    Dim UtilProj As Worksheet
    Set UtilProj = ThisWorkbook.Sheets("2 Year Projection")
    
    'Make sure no other Two-Year Tools are Open
    'On Error GoTo Close2YearTool
    'Open and Set TYT
    Dim TYT As Workbook
    If UtilProj.Range("L21").Value = "PHA" Then
        Set TYT = Workbooks.Open(FileName:=TYT_LOCATION_PHA, ReadOnly:=True)
        Else
        Set TYT = Workbooks.Open(FileName:=TYT_LOCATION_HUD, ReadOnly:=True)
        'Give me FMC Data
        Call sbImportSharePointData(ThisWorkbook.Worksheets(FL3_WORKSHEET), FL3_DATA_SOURCE)
    End If

    Dim i As Integer
    
    Dim TYTVASHProj As Worksheet
    Set TYTVASHProj = TYT.Sheets("VASH Projection Analysis")
    
    Dim Util As Workbook
    Set Util = ThisWorkbook
    
    Dim AvgMonths As Integer
    AvgMonths = 12 - WorksheetFunction.CountBlank(Util.Sheets("2019 Detail Data").Range("T3:AE3"))
    
    Dim TYTMTW As Worksheet
    Set TYTMTW = TYT.Sheets("MTW Disbursements")
    
    Dim TYTPBV As Worksheet
    Set TYTPBV = TYT.Sheets("PBV.RAD")
    
    Dim TYTSEMAP As Worksheet
    Set TYTSEMAP = TYT.Sheets("Summary")
    
    Dim TYTFMC As Worksheet
    Set TYTFMC = TYT.Sheets("FMC Add'l Disbursement")
    
    Dim TYTFMCMTW As Worksheet

    Dim TYTAdmin As Worksheet
    Set TYTAdmin = TYT.Sheets("Administrative Fee Analysis")
    
    Dim TYTProj As Worksheet
    Set TYTProj = TYT.Sheets("Projection Analysis")
    
    Dim TYTGraphs As Worksheet
    Set TYTGraphs = TYT.Sheets("+Graphs")
  
    Dim PHACode As Variant
    PHACode = Evaluate("=IF('2 Year Projection'!I2="""", '2 Year Projection'!I9, '2 Year Projection'!I2)")

    Dim VASHUtilProj As Worksheet
    Set VASHUtilProj = ThisWorkbook.Sheets("VASH Projection")
    
    Application.ScreenUpdating = False
    
'Turn OFF Summary Outcomes Boxes
    TYT.Sheets("IP Input & QA Check").Unprotect
    TYT.Sheets("IP Input & QA Check").Range("Q8").Value = "No"

    'PUC Data in and cleaned up
    
'Speed up data move

    Application.Calculation = xlCalculationManual
    
'Move information to TYT from Util (TYT on left, Util on Right) - Projection Analysis Tab
    
    TYTProj.Unprotect
    
'''''PROJECTION ANALYSIS TAB'''''

    ''''MTW Adjust''''
    
        'Budget Authority Rework
        '''Funding'''
        If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
            'Change Year 2
            TYTProj.Range("D8").Formula = "='MTW Welcome'!O19"
            TYTProj.Range("D11").Formula = "=(" & UtilProj.Range("E56").Value & "+" & UtilProj.Range("E57").Value & ")"
            'Change Year 3
            TYTProj.Range("E8").Formula = "='MTW Welcome'!O19*H7"
            TYTProj.Range("E11").Formula = "=(" & UtilProj.Range("E58").Value & "+" & UtilProj.Range("E59").Value & ")"
            'Change Year 4
            TYT.Sheets("Projection Analysis - Years 3&4").Range("D8").Formula = "=" & "('MTW Welcome'!O19*H6)"
            TYT.Sheets("Projection Analysis - Years 3&4").Range("D11").Formula = "=(" & UtilProj.Range("E60").Value & "+" & UtilProj.Range("E61").Value & ")"
            'Change Year 5
            TYT.Sheets("Projection Analysis - Years 3&4").Range("E8").Formula = "=" & "('MTW Welcome'!O19*H6)"

        'MTW BA Cells Adjust (Protection and Coloring)
            'Years 1 and 2
            TYT.Sheets("Projection Analysis").Activate
            TYT.Sheets("Projection Analysis").Range("D8:E8").Select
            ActiveSheet.Unprotect
            TYT.Sheets("Projection Analysis").Range("D8:E8").Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .Color = 10092543
                .TintAndShade = 0
                .PatternTintAndShade = 0
            End With
            TYTProj.Range("F2").Select
            'Years 3 and 4
            TYT.Sheets("Projection Analysis - Years 3&4").Visible = True
            TYT.Sheets("Projection Analysis - Years 3&4").Activate
            TYT.Sheets("Projection Analysis - Years 3&4").Select
            TYT.Sheets("Projection Analysis - Years 3&4").Range("C8:E8").Select
            ActiveSheet.Unprotect
            TYT.Sheets("Projection Analysis - Years 3&4").Range("C8:E8").Select
            With Selection.Interior
                .Pattern = xlSolid
                .PatternColorIndex = xlAutomatic
                .Color = 10092543
                .TintAndShade = 0
                .PatternTintAndShade = 0
            End With
            TYT.Sheets("Projection Analysis - Years 3&4").Range("F2").Select
            TYT.Sheets("Projection Analysis - Years 3&4").Visible = False
    End If
    
    ''''Non-MTW''''
    
    'What Utilization Report created this tool?
    TYTProj.Range("J1").Value = FileName
    'Annual EOP Rate
    TYTProj.Range("M5").Value = UtilProj.Range("E11").Value
    'Update EOP Rate
    TYTProj.Range("M6").Value = UtilProj.Range("A56").Value & ": " & Format(UtilProj.Range("C56"), "Percent")
    'PHA Code
    TYTProj.Range("F2").Value = PHACode
    'Add Note (if necessary) that this is a combo tool
        If UtilProj.Range("I2").Value = "" Then _
            TYTProj.Range("G2").Value = "COMBO (" & UtilProj.Range("K9").Value & ")"
        If UtilProj.Range("I2").Value = "" Then _
            TYTProj.Range("C18").Value = "Validate BA available with FMC FA."
        If UtilProj.Range("I2").Value = "" Then _
            TYTFMC.Range("B31").Value = "Validate HHR after reserves obligated."
    'Starting ACC
    TYTProj.Range("C6").Value = UtilProj.Range("E9").Value

    '''Funding'''
    
    'Inflation - Year 2
    TYTProj.Range("M9").Value = UtilProj.Range("C61").Value
    
    'Inflation - Year 1 (for informational purposes)
        TYTProj.Range("C8").AddComment (UtilProj.Range("N82"))
        TYT.Sheets("Projection Analysis").Range("C8").Comment.Shape.TextFrame.Characters.Font.Size = 12
        TYT.Sheets("Projection Analysis").Range("C8").Comment.Shape.TextFrame.Characters.Font.Name = "Arial"
        TYT.Sheets("Projection Analysis").Range("C8").Comment.Shape.Height = TYT.Sheets("Projection Analysis").Range("C8").Comment.Shape.Height * 1.25
        TYT.Sheets("Projection Analysis").Range("C8").Comment.Shape.Width = TYT.Sheets("Projection Analysis").Range("C8").Comment.Shape.Width * 1.25
    
    'Inflation $ (for offset protection)
        TYT.Sheets("Background").Range("H92").Value = Util.Sheets("+FMRs").Range("AH3").Value
    'Inflation % (for offset protection)
        TYT.Sheets("Background").Range("F92").Value = Util.Sheets("2 Year Projection").Range("C60").Value
    'Year 1 Inflated at Year 2 (for offset protection)
        TYT.Sheets("Background").Range("H93").Value = Util.Sheets("+FMRs").Range("AI3").Value
     
    'Set-Aside Funding
    TYTProj.Range("C10").Value = UtilProj.Range("C4").Value
    
    'Set-Aside Funding - Year 2 (Reduction of Excess Shortfall)
    TYTProj.Range("D10").Value = UtilProj.Range("C62").Value
    
    'Initial BA Eligibility Funding
    TYTProj.Range("C8").Value = UtilProj.Range("C3").Value
    
        'Year 1
        TYTProj.Range("C11").Value = "=" & UtilProj.Range("C7").Value & "+('New ACC Units'!D19)-('New ACC Units'!F19)"
        'Year 2
        TYTProj.Range("D11").Value = "=(('New ACC Units'!D35)-('New ACC Units'!F35)" & "+" & UtilProj.Range("E57").Value & ")+(" & UtilProj.Range("E56").Value & "+('New ACC Units'!F19))*(1+M9)"
        'Year 3 (Years 3&4 Tab looks at 1&2 for Year 3 New BA)
        TYTProj.Range("E11").Value = "=" & UtilProj.Range("E58").Value & "+" & UtilProj.Range("E59").Value & "+('New ACC Units'!F35)"
        'Year 4
        TYT.Sheets("Projection Analysis - Years 3&4").Range("D11").Value = "=" & UtilProj.Range("E60").Value & "+" & UtilProj.Range("E61").Value

    'Offset
    TYTProj.Range("C9").Value = UtilProj.Range("C59").Value
    'Year 1 ACC (Snuck into R so as to keep formulas in C)
    TYTProj.Range("R23:R34").Value = UtilProj.Range("E14:E25").Value
    'Year 1 Actual UML and HAP
    TYTProj.Range("D23:E34").Value = UtilProj.Range("C14:D25").Value
    'Year 1 Actual UML - PBV
    TYTProj.Range("K55:K66").Value = Util.Sheets("PBV.RAD VMS Data").Range("V106:V117").Value
    'Year 1 Actual Unleased - PBV
    TYTProj.Range("R55:R66").Value = Util.Sheets("PBV.RAD VMS Data").Range("W106:W117").Value
    'Year 1 Actual UML and HAP - RAD1
    TYTProj.Range("K85:L96").Value = Util.Sheets("PBV.RAD VMS Data").Range("Q106:R118").Value
     
    
    'FO Folder Name
    TYTProj.Range("W9").Value = Util.Sheets("FO Folder").Range("D3").Value
    'Comments
    TYTProj.Range("D51").Value = UtilProj.Range("G26").Value + "  " + UtilProj.Range("G15").Value + "  " + UtilProj.Range("G34").Value + "  Most importantly, the Two-Year Tool is not a problem to be solved, but a reality to be experienced."
    'PHA Comments
    If UtilProj.Range("N80") <> "" Then
        TYTProj.Range("Q51").AddComment (UtilProj.Range("N80"))
        TYT.Sheets("Projection Analysis").Range("Q51").Comment.Shape.TextFrame.Characters.Font.Size = 12
        TYT.Sheets("Projection Analysis").Range("Q51").Comment.Shape.TextFrame.Characters.Font.Name = "Arial"
        TYT.Sheets("Projection Analysis").Range("Q51").Comment.Shape.Height = TYT.Sheets("Projection Analysis").Range("Q51").Comment.Shape.Height * 3
        TYT.Sheets("Projection Analysis").Range("Q51").Comment.Shape.Width = TYT.Sheets("Projection Analysis").Range("Q51").Comment.Shape.Width * 3
    End If
        
    'Reserve Section
    
    'Pre-Recon FMC Reserves
    TYTProj.Range("H15").Value = UtilProj.Range("C58").Value
    'FMC Excess Cash
    TYTProj.Range("H16").Value = UtilProj.Range("C57").Value
    'Beginning Year Cash (VMS)
    TYTProj.Range("I16").Value = UtilProj.Range("C6").Value
    'End of Year 1 RNP (VMS)
    TYTProj.Range("H20").Value = UtilProj.Range("C5").Value
    'Has the FMC changed the RNP?  If yes, put in explain sentence and tag so they know it changed.
    If Util.Sheets("+FMCExcessCash").Range("I4") = "Yes" Then
        TYTProj.Range("H16").AddComment (UtilProj.Range("M76"))
        TYTProj.Range("H16").Comment.Shape.Height = TYTProj.Range("H16").Comment.Shape.Height * 2
        TYTProj.Range("H16").Comment.Shape.Width = TYTProj.Range("H16").Comment.Shape.Height * 2.5
        TYTProj.Range("H16").Comment.Shape.TextFrame.Characters.Font.Size = 12
        TYTProj.Range("K20").Value = Util.Sheets("+FMCExcessCash").Range("N3").Value
        TYTProj.Activate
        TYTProj.Range("K20").Select
        Selection.Borders(xlDiagonalDown).LineStyle = xlNone
        Selection.Borders(xlDiagonalUp).LineStyle = xlNone
            With Selection.Borders(xlEdgeLeft)
                .LineStyle = xlContinuous
                .ColorIndex = 0
                .TintAndShade = 0
                .Weight = xlThin
            End With
            With Selection.Borders(xlEdgeTop)
                .LineStyle = xlContinuous
                .ColorIndex = 0
                .TintAndShade = 0
                .Weight = xlThin
            End With
            With Selection.Borders(xlEdgeBottom)
                .LineStyle = xlContinuous
                .ColorIndex = 0
                .TintAndShade = 0
                .Weight = xlThin
            End With
            With Selection.Borders(xlEdgeRight)
                .LineStyle = xlContinuous
                .ColorIndex = 0
                .TintAndShade = 0
                .Weight = xlThin
            End With
            With Selection.Borders(xlInsideVertical)
                .LineStyle = xlContinuous
                .ColorIndex = 0
                .TintAndShade = 0
                .Weight = xlThin
            End With
            With Selection.Borders(xlInsideHorizontal)
                .LineStyle = xlContinuous
                .ColorIndex = 0
                .TintAndShade = 0
                .Weight = xlThin
            End With
    End If
                    
'''''PUC.RB Tab'''''
    
    TYT.Sheets("PUC.RB Analysis").Unprotect

    'Rent Burden Chart (No good MTW RB data sets.)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        Util.Sheets("+RentBurdensTrend").Shapes("Chart 1").Copy
        TYT.Sheets("PUC.RB Analysis").Select
        TYT.Sheets("PUC.RB Analysis").Range("X2").Select
        ActiveSheet.PasteSpecial Format:="Picture (JPEG)", Link:=False, _
            DisplayAsIcon:=False
        ActiveSheet.Pictures(ActiveSheet.Pictures.Count).Name = "RBChart"
        ActiveSheet.Shapes.Range(Array("RBChart")).Select
        Selection.ShapeRange.ScaleWidth 1.4, msoFalse, msoScaleFromTopLeft
        Selection.ShapeRange.ScaleHeight 1.4, msoFalse, msoScaleFromTopLeft
        With Selection.ShapeRange.Line
            .Visible = msoTrue
            .ForeColor.RGB = RGB(0, 0, 0)
        End With
        ActiveSheet.Range("A1").Select
        Sheets("Projection Analysis").Select
    End If
    
    'VMS Comments
    TYT.Sheets("PBV.RAD").Range("F34").Value = UtilProj.Range("N85").Value
    TYT.Sheets("PBV.RAD").Range("F44").Value = UtilProj.Range("N86").Value
    TYT.Sheets("PBV.RAD").Range("F45").Value = UtilProj.Range("N87").Value
    
    'FMR Chart
    
    Util.Sheets("+FMRs").Shapes("Chart 1").Copy
    TYT.Sheets("PUC.RB Analysis").Select
    'Moves FMR chart up for MTWs, as there is not RB chart above it.
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYT.Sheets("PUC.RB Analysis").Range("X22").Select
        Else
        TYT.Sheets("PUC.RB Analysis").Range("X2").Select
    End If
    ActiveSheet.PasteSpecial Format:="Picture (JPEG)", Link:=False, _
        DisplayAsIcon:=False
    ActiveSheet.Pictures(ActiveSheet.Pictures.Count).Name = "FMRChart"
    ActiveSheet.Shapes.Range(Array("FMRChart")).Select
    Selection.ShapeRange.ScaleWidth 1.4, msoFalse, msoScaleFromTopLeft
    Selection.ShapeRange.ScaleHeight 1.4, msoFalse, msoScaleFromTopLeft
    With Selection.ShapeRange.Line
        .Visible = msoTrue
        .ForeColor.RGB = RGB(0, 0, 0)
    End With
    ActiveSheet.Range("A1").Select
    
    'Year -1 UML
    TYT.Sheets("PUC.RB Analysis").Unprotect
    TYT.Sheets("PUC.RB Analysis").Range("H4:H15").Value = UtilProj.Range("C14:C25").Value
    
    'Year 0 UML
    TYT.Sheets("PUC.RB Analysis").Range("C4:D15").Value = UtilProj.Range("C28:D39").Value
    
    'Calculate
    TYT.Sheets("PUC.RB Analysis").Calculate
    
    TYT.Sheets("PUC.RB Analysis").Protect
    Sheets("Projection Analysis").Select
    
'''''MTW Tab'''''
    'MTW Chart
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
        Util.Sheets("MTWChart").Shapes("Chart 1").Copy
        TYT.Sheets("MTW Welcome").Visible = True
        TYT.Sheets("MTW Welcome").Select
        TYT.Sheets("MTW Welcome").Unprotect
        TYT.Sheets("MTW Welcome").Range("I24").Select
        ActiveSheet.PasteSpecial Format:="Picture (JPEG)", Link:=False, _
            DisplayAsIcon:=False
        ActiveSheet.Pictures(ActiveSheet.Pictures.Count).Name = "MTWChart"
        ActiveSheet.Shapes.Range(Array("MTWChart")).Select
        Selection.ShapeRange.IncrementLeft 27.187480315
        Selection.ShapeRange.IncrementTop -8.437480315
        With Selection.ShapeRange.Line
            .Visible = msoTrue
            .ForeColor.RGB = RGB(0, 0, 0)
        End With
        ActiveSheet.Range("A1").Select
        TYT.Sheets("MTW Welcome").Protect
    End If
    
'''''New ACC Units tab'''''

    'Year 2 UMAs
    TYT.Sheets("New ACC Units").Range("C23").Value = Util.Sheets("Year 2 UMA").Range("Q19").Value
    TYT.Sheets("New ACC Units").Range("C24").Value = Util.Sheets("Year 2 UMA").Range("Q20").Value
    TYT.Sheets("New ACC Units").Range("C25").Value = Util.Sheets("Year 2 UMA").Range("Q21").Value
    TYT.Sheets("New ACC Units").Range("C26").Value = Util.Sheets("Year 2 UMA").Range("Q22").Value
    TYT.Sheets("New ACC Units").Range("C27").Value = Util.Sheets("Year 2 UMA").Range("Q23").Value
    TYT.Sheets("New ACC Units").Range("C28").Value = Util.Sheets("Year 2 UMA").Range("Q24").Value
    TYT.Sheets("New ACC Units").Range("C29").Value = Util.Sheets("Year 2 UMA").Range("Q25").Value
    TYT.Sheets("New ACC Units").Range("C30").Value = Util.Sheets("Year 2 UMA").Range("Q26").Value
    TYT.Sheets("New ACC Units").Range("C31").Value = Util.Sheets("Year 2 UMA").Range("Q27").Value
    TYT.Sheets("New ACC Units").Range("C32").Value = Util.Sheets("Year 2 UMA").Range("Q28").Value
    TYT.Sheets("New ACC Units").Range("C33").Value = Util.Sheets("Year 2 UMA").Range("Q29").Value
    TYT.Sheets("New ACC Units").Range("C34").Value = Util.Sheets("Year 2 UMA").Range("Q30").Value
    
    TYTProj.Protect
    
'''''Graph Data''''''
    
     'VOS - Year 0
     TYTGraphs.Range("B2").Value = UtilProj.Range("D42").Value
     TYTGraphs.Range("B3").Value = UtilProj.Range("D43").Value
     TYTGraphs.Range("B4").Value = UtilProj.Range("D44").Value
     TYTGraphs.Range("B5").Value = UtilProj.Range("D45").Value
     TYTGraphs.Range("B6").Value = UtilProj.Range("D46").Value
     TYTGraphs.Range("B7").Value = UtilProj.Range("D47").Value
     TYTGraphs.Range("B8").Value = UtilProj.Range("D48").Value
     TYTGraphs.Range("B9").Value = UtilProj.Range("D49").Value
     TYTGraphs.Range("B10").Value = UtilProj.Range("D50").Value
     TYTGraphs.Range("B11").Value = UtilProj.Range("D51").Value
     TYTGraphs.Range("B12").Value = UtilProj.Range("D52").Value
     TYTGraphs.Range("B13").Value = UtilProj.Range("D53").Value
     'VOS - Year 1
     TYTGraphs.Range("B14").Value = UtilProj.Range("E42").Value
     TYTGraphs.Range("B15").Value = UtilProj.Range("E43").Value
     TYTGraphs.Range("B16").Value = UtilProj.Range("E44").Value
     TYTGraphs.Range("B17").Value = UtilProj.Range("E45").Value
     TYTGraphs.Range("B18").Value = UtilProj.Range("E46").Value
     TYTGraphs.Range("B19").Value = UtilProj.Range("E47").Value
     TYTGraphs.Range("B20").Value = UtilProj.Range("E48").Value
     TYTGraphs.Range("B21").Value = UtilProj.Range("E49").Value
     TYTGraphs.Range("B22").Value = UtilProj.Range("E50").Value
     TYTGraphs.Range("B23").Value = UtilProj.Range("E51").Value
     TYTGraphs.Range("B24").Value = UtilProj.Range("E52").Value
     TYTGraphs.Range("B25").Value = UtilProj.Range("E53").Value
     'VOS - RAD1 UML Year 0
     TYTGraphs.Range("B61").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q94")
     TYTGraphs.Range("B62").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q95")
     TYTGraphs.Range("B63").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q96")
     TYTGraphs.Range("B64").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q97")
     TYTGraphs.Range("B65").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q98")
     TYTGraphs.Range("B66").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q99")
     TYTGraphs.Range("B67").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q100")
     TYTGraphs.Range("B68").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q101")
     TYTGraphs.Range("B69").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q102")
     TYTGraphs.Range("B70").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q103")
     TYTGraphs.Range("B71").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q104")
     TYTGraphs.Range("B72").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("Q105")
     'VOS - RAD1 HAP Year 0
     TYTGraphs.Range("C61").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R94")
     TYTGraphs.Range("C62").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R95")
     TYTGraphs.Range("C63").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R96")
     TYTGraphs.Range("C64").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R97")
     TYTGraphs.Range("C65").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R98")
     TYTGraphs.Range("C66").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R99")
     TYTGraphs.Range("C67").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R100")
     TYTGraphs.Range("C68").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R101")
     TYTGraphs.Range("C69").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R102")
     TYTGraphs.Range("C70").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R103")
     TYTGraphs.Range("C71").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R104")
     TYTGraphs.Range("C72").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("R105")
     'AHAP - Year 0
     TYTGraphs.Range("D61").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U94")
     TYTGraphs.Range("D62").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U95")
     TYTGraphs.Range("D63").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U96")
     TYTGraphs.Range("D64").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U97")
     TYTGraphs.Range("D65").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U98")
     TYTGraphs.Range("D66").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U99")
     TYTGraphs.Range("D67").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U100")
     TYTGraphs.Range("D68").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U101")
     TYTGraphs.Range("D69").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U102")
     TYTGraphs.Range("D70").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U103")
     TYTGraphs.Range("D71").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U104")
     TYTGraphs.Range("D72").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U105")
     'AHAP - Year 1
     TYTGraphs.Range("D73").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U106")
     TYTGraphs.Range("D74").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U107")
     TYTGraphs.Range("D75").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U108")
     TYTGraphs.Range("D76").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U109")
     TYTGraphs.Range("D77").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U110")
     TYTGraphs.Range("D78").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U111")
     TYTGraphs.Range("D79").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U112")
     TYTGraphs.Range("D80").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U113")
     TYTGraphs.Range("D81").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U114")
     TYTGraphs.Range("D82").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U115")
     TYTGraphs.Range("D83").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U116")
     TYTGraphs.Range("D84").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("U117")
     'PBV UML - Year 0
     TYTGraphs.Range("E61").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V94")
     TYTGraphs.Range("E62").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V95")
     TYTGraphs.Range("E63").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V96")
     TYTGraphs.Range("E64").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V97")
     TYTGraphs.Range("E65").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V98")
     TYTGraphs.Range("E66").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V99")
     TYTGraphs.Range("E67").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V100")
     TYTGraphs.Range("E68").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V101")
     TYTGraphs.Range("E69").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V102")
     TYTGraphs.Range("E70").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V103")
     TYTGraphs.Range("E71").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V104")
     TYTGraphs.Range("E72").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("V105")
     'PBV UML - Year 0
     TYTGraphs.Range("F61").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W94")
     TYTGraphs.Range("F62").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W95")
     TYTGraphs.Range("F63").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W96")
     TYTGraphs.Range("F64").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W97")
     TYTGraphs.Range("F65").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W98")
     TYTGraphs.Range("F66").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W99")
     TYTGraphs.Range("F67").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W100")
     TYTGraphs.Range("F68").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W101")
     TYTGraphs.Range("F69").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W102")
     TYTGraphs.Range("F70").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W103")
     TYTGraphs.Range("F71").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W104")
     TYTGraphs.Range("F72").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("W105")

'''''PBV/RAD Tab'''''
        
    'Moving PIC Work Over
    ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("BI3:BL6").Copy
    TYTPBV.Visible = True
    TYTPBV.Activate
    TYTPBV.Range("V21").Select
    Selection.PasteSpecial Paste:=xlPasteValues
    ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("BM3:BN5").Copy
    TYTPBV.Range("Z21").Select
    Selection.PasteSpecial Paste:=xlPasteValues
    TYTPBV.Range("A1").Select

    'PBV/RAD Move
    TYTPBV.Range("C3").Value = UtilProj.Range("J33").Value
    TYTPBV.Range("C4").Value = UtilProj.Range("G33").Value
    TYTPBV.Range("C5").Value = UtilProj.Range("H33").Value
    TYTPBV.Range("C6").Value = UtilProj.Range("I33").Value
    TYTPBV.Range("C7").Value = UtilProj.Range("G40").Value
    TYTPBV.Range("C8").Value = UtilProj.Range("H40").Value
    TYTPBV.Range("C9").Value = UtilProj.Range("G41").Value
    TYTPBV.Range("C10").Value = UtilProj.Range("H41").Value
    TYTPBV.Range("D7").Value = UtilProj.Range("J40").Value
    TYTPBV.Range("D9").Value = UtilProj.Range("J41").Value
    
    'Email Submissions
    TYTPBV.Range("K32").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AI8").Value
    TYTPBV.Range("K33").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AI9").Value
    TYTPBV.Range("K34").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AI10").Value
    TYTPBV.Range("K35").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AI11").Value
    TYTPBV.Range("K36").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AI12").Value
    
    TYTPBV.Range("M32").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AJ8").Value
    TYTPBV.Range("M33").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AJ9").Value
    TYTPBV.Range("M34").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AJ10").Value
    TYTPBV.Range("M35").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AJ11").Value
    TYTPBV.Range("M36").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AJ12").Value
    
    TYTPBV.Range("O32").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AK8").Value
    TYTPBV.Range("O33").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AK9").Value
    TYTPBV.Range("O34").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AK10").Value
    TYTPBV.Range("O35").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AK11").Value
    TYTPBV.Range("O36").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AK12").Value
    
    TYTPBV.Range("Q32").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AL8").Value
    TYTPBV.Range("Q33").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AL9").Value
    TYTPBV.Range("Q34").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AL10").Value
    TYTPBV.Range("Q35").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AL11").Value
    TYTPBV.Range("Q36").Value = ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AL12").Value
    
    'FMC Log
    If ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AH14").Value > 0 Then
        ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AI17:AO" & ThisWorkbook.Sheets("PBV.RAD VMS Data").Range("AH14").Value + 16).Copy
        TYTPBV.Visible = True
        TYTPBV.Activate
        TYTPBV.Range("A65").Select
        Selection.PasteSpecial Paste:=xlPasteValues
        
                With Selection.Borders(xlEdgeLeft)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlEdgeTop)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlEdgeBottom)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlEdgeRight)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlInsideVertical)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
                With Selection.Borders(xlInsideHorizontal)
                    .LineStyle = xlContinuous
                    .ColorIndex = 0
                    .TintAndShade = 0
                    .Weight = xlThin
                End With
    End If
    
    ''''Comment Work''''
    
    'I use the PBV.RAD tab as a placeholder to recreate the comments section, thus why data is moving to the PBV.RAD tab.
        
        'VASH Awards
        TYTPBV.Range("M3").Value = UtilProj.Range("I18").Value
        'VASH Leased
        TYTPBV.Range("N3").Value = UtilProj.Range("J18").Value
        'FUP Awards
        TYTPBV.Range("M4").Value = UtilProj.Range("I19").Value
        'FUP Leased
        TYTPBV.Range("N4").Value = UtilProj.Range("J19").Value
        'NED Awards
        TYTPBV.Range("M5").Value = UtilProj.Range("I20").Value
        'NED Leased
        TYTPBV.Range("N5").Value = UtilProj.Range("J20").Value
        
        'Year 1 Start RNP
        TYTPBV.Range("M7").Value = UtilProj.Range("C5").Value
        'Start UNP
        TYTPBV.Range("M8").Value = UtilProj.Range("P20").Value
        'Start Cash
        TYTPBV.Range("M9").Value = UtilProj.Range("C6").Value
        'Current RNP
        TYTPBV.Range("M11").Value = UtilProj.Range("G24").Value
        'Current UNP
        TYTPBV.Range("M12").Value = UtilProj.Range("H24").Value
        'Current C&I
        TYTPBV.Range("M13").Value = UtilProj.Range("I24").Value
        
    'PBV/RAD Check
    If UtilProj.Range("F33").Value > 0 Then
        TYTPBV.Visible = True
        TYTPBV.Activate
        TYTPBV.Range("A1").Select
    Else
        TYTPBV.Visible = False
    End If
                               
'''''Additional Disbursement Tabs'''''

    'MTW Name on Add'l Disburse Tab
    
    TYTMTW.Range("B2").Value = UtilProj.Range("G7").Value
                
    'FSS Forf/Fraud (Non-MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Unprotect
        TYTFMC.Range("F7").Value = UtilProj.Range("O27").Value + UtilProj.Range("P27").Value
        TYTFMC.Range("F8").Value = UtilProj.Range("O28").Value + UtilProj.Range("P28").Value
        TYTFMC.Range("F9").Value = UtilProj.Range("O29").Value + UtilProj.Range("P29").Value
        TYTFMC.Range("F10").Value = UtilProj.Range("O30").Value + UtilProj.Range("P30").Value
        TYTFMC.Range("F11").Value = UtilProj.Range("O31").Value + UtilProj.Range("P31").Value
        TYTFMC.Range("F12").Value = UtilProj.Range("O32").Value + UtilProj.Range("P32").Value
        TYTFMC.Range("F13").Value = UtilProj.Range("O33").Value + UtilProj.Range("P33").Value
        TYTFMC.Range("F14").Value = UtilProj.Range("O34").Value + UtilProj.Range("P34").Value
        TYTFMC.Range("F15").Value = UtilProj.Range("O35").Value + UtilProj.Range("P35").Value
        TYTFMC.Range("F16").Value = UtilProj.Range("O36").Value + UtilProj.Range("P36").Value
        TYTFMC.Range("F17").Value = UtilProj.Range("O37").Value + UtilProj.Range("P37").Value
        TYTFMC.Range("F18").Value = UtilProj.Range("O38").Value + UtilProj.Range("P38").Value
        TYTFMC.Range("F19").Value = UtilProj.Range("O40").Value + UtilProj.Range("P40").Value
        TYTFMC.Range("F20").Value = UtilProj.Range("O41").Value + UtilProj.Range("P41").Value
        TYTFMC.Range("F21").Value = UtilProj.Range("O42").Value + UtilProj.Range("P42").Value
        TYTFMC.Range("F22").Value = UtilProj.Range("O43").Value + UtilProj.Range("P43").Value
        TYTFMC.Range("F23").Value = UtilProj.Range("O44").Value + UtilProj.Range("P44").Value
        TYTFMC.Range("F24").Value = UtilProj.Range("O45").Value + UtilProj.Range("P45").Value
    End If
    
    'EOM RNP (Non-MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("H7").Value = UtilProj.Range("Q27").Value
        TYTFMC.Range("H8").Value = UtilProj.Range("Q28").Value
        TYTFMC.Range("H9").Value = UtilProj.Range("Q29").Value
        TYTFMC.Range("H10").Value = UtilProj.Range("Q30").Value
        TYTFMC.Range("H11").Value = UtilProj.Range("Q31").Value
        TYTFMC.Range("H12").Value = UtilProj.Range("Q32").Value
        TYTFMC.Range("H13").Value = UtilProj.Range("Q33").Value
        TYTFMC.Range("H14").Value = UtilProj.Range("Q34").Value
        TYTFMC.Range("H15").Value = UtilProj.Range("Q35").Value
        TYTFMC.Range("H16").Value = UtilProj.Range("Q36").Value
        TYTFMC.Range("H17").Value = UtilProj.Range("Q37").Value
        TYTFMC.Range("H18").Value = UtilProj.Range("Q38").Value
        TYTFMC.Range("H19").Value = UtilProj.Range("Q40").Value
        TYTFMC.Range("H20").Value = UtilProj.Range("Q41").Value
        TYTFMC.Range("H21").Value = UtilProj.Range("Q42").Value
        TYTFMC.Range("H22").Value = UtilProj.Range("Q43").Value
        TYTFMC.Range("H23").Value = UtilProj.Range("Q44").Value
        TYTFMC.Range("H24").Value = UtilProj.Range("Q45").Value
    End If
                
    'EOM RNP (MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
        TYTMTW.Range("P9").Value = UtilProj.Range("Q27").Value
        TYTMTW.Range("P10").Value = UtilProj.Range("Q28").Value
        TYTMTW.Range("P11").Value = UtilProj.Range("Q29").Value
        TYTMTW.Range("P12").Value = UtilProj.Range("Q30").Value
        TYTMTW.Range("P13").Value = UtilProj.Range("Q31").Value
        TYTMTW.Range("P14").Value = UtilProj.Range("Q32").Value
        TYTMTW.Range("P15").Value = UtilProj.Range("Q33").Value
        TYTMTW.Range("P16").Value = UtilProj.Range("Q34").Value
        TYTMTW.Range("P17").Value = UtilProj.Range("Q35").Value
        TYTMTW.Range("P18").Value = UtilProj.Range("Q36").Value
        TYTMTW.Range("P19").Value = UtilProj.Range("Q37").Value
        TYTMTW.Range("P20").Value = UtilProj.Range("Q38").Value
        TYTMTW.Range("P21").Value = UtilProj.Range("Q40").Value
        TYTMTW.Range("P22").Value = UtilProj.Range("Q41").Value
        TYTMTW.Range("P23").Value = UtilProj.Range("Q42").Value
        TYTMTW.Range("P24").Value = UtilProj.Range("Q43").Value
        TYTMTW.Range("P25").Value = UtilProj.Range("Q44").Value
        TYTMTW.Range("P26").Value = UtilProj.Range("Q45").Value
    End If
    
    'Obligations (Non-MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("M7").Value = UtilProj.Range("P50").Value
        TYTFMC.Range("M8").Value = UtilProj.Range("P51").Value
        TYTFMC.Range("M9").Value = UtilProj.Range("P52").Value
        TYTFMC.Range("M10").Value = UtilProj.Range("P53").Value
        TYTFMC.Range("M11").Value = UtilProj.Range("P54").Value
        TYTFMC.Range("M12").Value = UtilProj.Range("P55").Value
        TYTFMC.Range("M13").Value = UtilProj.Range("P56").Value
        TYTFMC.Range("M14").Value = UtilProj.Range("P57").Value
        TYTFMC.Range("M15").Value = UtilProj.Range("P58").Value
        TYTFMC.Range("M16").Value = UtilProj.Range("P59").Value
        TYTFMC.Range("M17").Value = UtilProj.Range("P60").Value
        TYTFMC.Range("M18").Value = UtilProj.Range("P61").Value
        TYTFMC.Range("M19").Value = UtilProj.Range("P63").Value
        TYTFMC.Range("M20").Value = UtilProj.Range("P64").Value
        TYTFMC.Range("M21").Value = UtilProj.Range("P65").Value
        TYTFMC.Range("M22").Value = UtilProj.Range("P66").Value
        TYTFMC.Range("M23").Value = UtilProj.Range("P67").Value
        TYTFMC.Range("M24").Value = UtilProj.Range("P68").Value
    End If
    
    'Obligations (MTW)
        
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
        TYTMTW.Range("S9").Value = UtilProj.Range("P50").Value + UtilProj.Range("R50").Value
        TYTMTW.Range("S10").Value = UtilProj.Range("P51").Value + UtilProj.Range("R51").Value
        TYTMTW.Range("S11").Value = UtilProj.Range("P52").Value + UtilProj.Range("R52").Value
        TYTMTW.Range("S12").Value = UtilProj.Range("P53").Value + UtilProj.Range("R53").Value
        TYTMTW.Range("S13").Value = UtilProj.Range("P54").Value + UtilProj.Range("R54").Value
        TYTMTW.Range("S14").Value = UtilProj.Range("P55").Value + UtilProj.Range("R55").Value
        TYTMTW.Range("S15").Value = UtilProj.Range("P56").Value + UtilProj.Range("R56").Value
        TYTMTW.Range("S16").Value = UtilProj.Range("P57").Value + UtilProj.Range("R57").Value
        TYTMTW.Range("S17").Value = UtilProj.Range("P58").Value + UtilProj.Range("R58").Value
        TYTMTW.Range("S18").Value = UtilProj.Range("P59").Value + UtilProj.Range("R59").Value
        TYTMTW.Range("S19").Value = UtilProj.Range("P60").Value + UtilProj.Range("R60").Value
        TYTMTW.Range("S20").Value = UtilProj.Range("P61").Value + UtilProj.Range("R61").Value
        TYTMTW.Range("S21").Value = UtilProj.Range("P63").Value + UtilProj.Range("R63").Value
        TYTMTW.Range("S22").Value = UtilProj.Range("P64").Value + UtilProj.Range("R64").Value
        TYTMTW.Range("S23").Value = UtilProj.Range("P65").Value + UtilProj.Range("R65").Value
        TYTMTW.Range("S24").Value = UtilProj.Range("P66").Value + UtilProj.Range("R66").Value
        TYTMTW.Range("S25").Value = UtilProj.Range("P67").Value + UtilProj.Range("R67").Value
        TYTMTW.Range("S26").Value = UtilProj.Range("P68").Value + UtilProj.Range("R68").Value
    End If
                
    'Disbursements (Non-MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("C7").Value = UtilProj.Range("Q50").Value
        TYTFMC.Range("C8").Value = UtilProj.Range("Q51").Value
        TYTFMC.Range("C9").Value = UtilProj.Range("Q52").Value
        TYTFMC.Range("C10").Value = UtilProj.Range("Q53").Value
        TYTFMC.Range("C11").Value = UtilProj.Range("Q54").Value
        TYTFMC.Range("C12").Value = UtilProj.Range("Q55").Value
        TYTFMC.Range("C13").Value = UtilProj.Range("Q56").Value
        TYTFMC.Range("C14").Value = UtilProj.Range("Q57").Value
        TYTFMC.Range("C15").Value = UtilProj.Range("Q58").Value
        TYTFMC.Range("C16").Value = UtilProj.Range("Q59").Value
        TYTFMC.Range("C17").Value = UtilProj.Range("Q60").Value
        TYTFMC.Range("C18").Value = UtilProj.Range("Q61").Value
        TYTFMC.Range("C19").Value = UtilProj.Range("Q63").Value
        TYTFMC.Range("C20").Value = UtilProj.Range("Q64").Value
        TYTFMC.Range("C21").Value = UtilProj.Range("Q65").Value
        TYTFMC.Range("C22").Value = UtilProj.Range("Q66").Value
        TYTFMC.Range("C23").Value = UtilProj.Range("Q67").Value
        TYTFMC.Range("C24").Value = UtilProj.Range("Q68").Value
    End If
                
    'Disbursements (MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
        TYTMTW.Range("C9").Value = UtilProj.Range("Q50").Value + UtilProj.Range("S50").Value
        TYTMTW.Range("C10").Value = UtilProj.Range("Q51").Value + UtilProj.Range("S51").Value
        TYTMTW.Range("C11").Value = UtilProj.Range("Q52").Value + UtilProj.Range("S52").Value
        TYTMTW.Range("C12").Value = UtilProj.Range("Q53").Value + UtilProj.Range("S53").Value
        TYTMTW.Range("C13").Value = UtilProj.Range("Q54").Value + UtilProj.Range("S54").Value
        TYTMTW.Range("C14").Value = UtilProj.Range("Q55").Value + UtilProj.Range("S55").Value
        TYTMTW.Range("C15").Value = UtilProj.Range("Q56").Value + UtilProj.Range("S56").Value
        TYTMTW.Range("C16").Value = UtilProj.Range("Q57").Value + UtilProj.Range("S57").Value
        TYTMTW.Range("C17").Value = UtilProj.Range("Q58").Value + UtilProj.Range("S58").Value
        TYTMTW.Range("C18").Value = UtilProj.Range("Q59").Value + UtilProj.Range("S59").Value
        TYTMTW.Range("C19").Value = UtilProj.Range("Q60").Value + UtilProj.Range("S60").Value
        TYTMTW.Range("C20").Value = UtilProj.Range("Q61").Value + UtilProj.Range("S61").Value
        TYTMTW.Range("C21").Value = UtilProj.Range("Q63").Value + UtilProj.Range("S63").Value
        TYTMTW.Range("C22").Value = UtilProj.Range("Q64").Value + UtilProj.Range("S64").Value
        TYTMTW.Range("C23").Value = UtilProj.Range("Q65").Value + UtilProj.Range("S65").Value
        TYTMTW.Range("C24").Value = UtilProj.Range("Q66").Value + UtilProj.Range("S66").Value
        TYTMTW.Range("C25").Value = UtilProj.Range("Q67").Value + UtilProj.Range("S67").Value
        TYTMTW.Range("C26").Value = UtilProj.Range("Q68").Value + UtilProj.Range("S68").Value
    End If
                
    'RFs (Non-MTW)
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("O7").Value = UtilProj.Range("W50").Value
        TYTFMC.Range("O8").Value = UtilProj.Range("W51").Value
        TYTFMC.Range("O9").Value = UtilProj.Range("W52").Value
        TYTFMC.Range("O10").Value = UtilProj.Range("W53").Value
        TYTFMC.Range("O11").Value = UtilProj.Range("W54").Value
        TYTFMC.Range("O12").Value = UtilProj.Range("W55").Value
        TYTFMC.Range("O13").Value = UtilProj.Range("W56").Value
        TYTFMC.Range("O14").Value = UtilProj.Range("W57").Value
        TYTFMC.Range("O15").Value = UtilProj.Range("W58").Value
        TYTFMC.Range("O16").Value = UtilProj.Range("W59").Value
        TYTFMC.Range("O17").Value = UtilProj.Range("W60").Value
        TYTFMC.Range("O18").Value = UtilProj.Range("W61").Value
        TYTFMC.Range("O19").Value = UtilProj.Range("W63").Value
        TYTFMC.Range("O20").Value = UtilProj.Range("W64").Value
        TYTFMC.Range("O21").Value = UtilProj.Range("W65").Value
        TYTFMC.Range("O22").Value = UtilProj.Range("W66").Value
        TYTFMC.Range("O23").Value = UtilProj.Range("W67").Value
        TYTFMC.Range("O24").Value = UtilProj.Range("W68").Value
    End If
    
    'Date of data
    
    TYTFMC.Range("A38").Value = UtilProj.Range("M48").Value
    
    'Who's running this show?
    
    TYTFMC.Range("O32").Value = UtilProj.Range("N78").Value
    
    'FMC DD Email
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("A31").Value = UtilProj.Range("Q71").Value
        Else
        TYTMTW.Range("A31").Value = UtilProj.Range("Q71").Value
    End If
    
    'FMC TL Email
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("A33").Value = UtilProj.Range("S71").Value
        Else
        TYTMTW.Range("A33").Value = UtilProj.Range("S71").Value
    End If
    
    'Carryforward reconciling items
        If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
            TYTFMC.Range("D35").Value = UtilProj.Range("O72").Value
            TYTFMC.Range("E35").Value = UtilProj.Range("N72").Value
            TYTFMC.Range("D37").Value = UtilProj.Range("O73").Value
            TYTFMC.Range("E37").Value = UtilProj.Range("N73").Value
            TYTFMC.Range("D39").Value = UtilProj.Range("O74").Value
            TYTFMC.Range("E39").Value = UtilProj.Range("N74").Value
        End If

    'Carryforward reconciling items (MTW)
        If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
            TYTMTW.Range("O31").Value = UtilProj.Range("O72").Value
            TYTMTW.Range("P31").Value = UtilProj.Range("N72").Value
            TYTMTW.Range("O33").Value = UtilProj.Range("O73").Value
            TYTMTW.Range("P33").Value = UtilProj.Range("N73").Value
            TYTMTW.Range("O35").Value = UtilProj.Range("O74").Value
            TYTMTW.Range("P35").Value = UtilProj.Range("N74").Value
        End If
        
    'FO Code - FMC
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTFMC.Range("A32").Value = UtilProj.Range("R71").Value
        TYTFMC.Protect
        Else
        TYTMTW.Range("A32").Value = UtilProj.Range("R71").Value
        TYTMTW.Protect
    End If
    
'''''Administrative Fee Analysis Tab'''''

    'Admin Fee Obligations and Disbursements
        'Year 0
            'Obligations
            TYTAdmin.Unprotect
            TYTAdmin.Range("J31").Value = UtilProj.Range("T50").Value
            TYTAdmin.Range("J32").Value = UtilProj.Range("T51").Value
            TYTAdmin.Range("J33").Value = UtilProj.Range("T52").Value
            TYTAdmin.Range("J34").Value = UtilProj.Range("T53").Value
            TYTAdmin.Range("J35").Value = UtilProj.Range("T54").Value
            TYTAdmin.Range("J36").Value = UtilProj.Range("T55").Value
            TYTAdmin.Range("J37").Value = UtilProj.Range("T56").Value
            TYTAdmin.Range("J38").Value = UtilProj.Range("T57").Value
            TYTAdmin.Range("J39").Value = UtilProj.Range("T58").Value
            TYTAdmin.Range("J40").Value = UtilProj.Range("T59").Value
            TYTAdmin.Range("J41").Value = UtilProj.Range("T60").Value
            TYTAdmin.Range("J42").Value = UtilProj.Range("T61").Value
            'Disbursements
            TYTAdmin.Range("K31").Value = UtilProj.Range("U50").Value
            TYTAdmin.Range("K32").Value = UtilProj.Range("U51").Value
            TYTAdmin.Range("K33").Value = UtilProj.Range("U52").Value
            TYTAdmin.Range("K34").Value = UtilProj.Range("U53").Value
            TYTAdmin.Range("K35").Value = UtilProj.Range("U54").Value
            TYTAdmin.Range("K36").Value = UtilProj.Range("U55").Value
            TYTAdmin.Range("K37").Value = UtilProj.Range("U56").Value
            TYTAdmin.Range("K38").Value = UtilProj.Range("U57").Value
            TYTAdmin.Range("K39").Value = UtilProj.Range("U58").Value
            TYTAdmin.Range("K40").Value = UtilProj.Range("U59").Value
            TYTAdmin.Range("K41").Value = UtilProj.Range("U60").Value
            TYTAdmin.Range("K42").Value = UtilProj.Range("U61").Value
            
        'Year 1
            'Obligations
            TYTAdmin.Range("J43").Value = UtilProj.Range("R50").Value
            TYTAdmin.Range("J44").Value = UtilProj.Range("R51").Value
            TYTAdmin.Range("J45").Value = UtilProj.Range("R52").Value
            TYTAdmin.Range("J46").Value = UtilProj.Range("R53").Value
            TYTAdmin.Range("J47").Value = UtilProj.Range("R54").Value
            TYTAdmin.Range("J48").Value = UtilProj.Range("R55").Value
            TYTAdmin.Range("J49").Value = UtilProj.Range("R56").Value
            TYTAdmin.Range("J50").Value = UtilProj.Range("R57").Value
            TYTAdmin.Range("J51").Value = UtilProj.Range("R58").Value
            TYTAdmin.Range("J52").Value = UtilProj.Range("R59").Value
            TYTAdmin.Range("J53").Value = UtilProj.Range("R60").Value
            TYTAdmin.Range("J54").Value = UtilProj.Range("R61").Value
            'Disbursements
            TYTAdmin.Range("K43").Value = UtilProj.Range("S50").Value
            TYTAdmin.Range("K44").Value = UtilProj.Range("S51").Value
            TYTAdmin.Range("K45").Value = UtilProj.Range("S52").Value
            TYTAdmin.Range("K46").Value = UtilProj.Range("S53").Value
            TYTAdmin.Range("K47").Value = UtilProj.Range("S54").Value
            TYTAdmin.Range("K48").Value = UtilProj.Range("S55").Value
            TYTAdmin.Range("K49").Value = UtilProj.Range("S56").Value
            TYTAdmin.Range("K50").Value = UtilProj.Range("S57").Value
            TYTAdmin.Range("K51").Value = UtilProj.Range("S58").Value
            TYTAdmin.Range("K52").Value = UtilProj.Range("S59").Value
            TYTAdmin.Range("K53").Value = UtilProj.Range("S60").Value
            TYTAdmin.Range("K54").Value = UtilProj.Range("S61").Value
                
        'Year 2
            'Obligations
            TYTAdmin.Range("J55").Value = UtilProj.Range("R63").Value
            TYTAdmin.Range("J56").Value = UtilProj.Range("R64").Value
            TYTAdmin.Range("J57").Value = UtilProj.Range("R65").Value
            TYTAdmin.Range("J58").Value = UtilProj.Range("R66").Value
            TYTAdmin.Range("J59").Value = UtilProj.Range("R67").Value
            TYTAdmin.Range("J60").Value = UtilProj.Range("R68").Value
            'Disbursements
            TYTAdmin.Range("K55").Value = UtilProj.Range("S63").Value
            TYTAdmin.Range("K56").Value = UtilProj.Range("S64").Value
            TYTAdmin.Range("K57").Value = UtilProj.Range("S65").Value
            TYTAdmin.Range("K58").Value = UtilProj.Range("S66").Value
            TYTAdmin.Range("K59").Value = UtilProj.Range("S67").Value
            TYTAdmin.Range("K60").Value = UtilProj.Range("S68").Value
            
            'Move information from Util to TYT (TYT on left, Util on Right) - Administrative Fee Tab
            
    'FYE
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        TYTAdmin.Range("C20").Value = UtilProj.Range("Q3").Value
        Else
        TYTMTW.Unprotect
        TYTMTW.Range("L29").Value = UtilProj.Range("Q3").Value
        TYTMTW.Protect
    End If
    
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        'PY Administrative Earnings
        TYTAdmin.Range("C21").Value = UtilProj.Range("Q5").Value
        'Cost/UML PHA
        TYTAdmin.Range("L6").Value = UtilProj.Range("O3").Value
        'Earnings/UML Peer Group Cost/UML
        TYTAdmin.Range("L8").Value = UtilProj.Range("O4").Value
        'State Peer Group Cost/UML
        TYTAdmin.Range("L10").Value = UtilProj.Range("O5").Value
        'Prior Year Admin Expenses
        TYTAdmin.Range("B31:B42").Value = UtilProj.Range("N9:N20").Value
        'Current Year Admin Expenses
        TYTAdmin.Range("B43:B" & 43 + AvgMonths - 1).Value = UtilProj.Range("O9:O" & 9 + AvgMonths - 1).Value
            
            'Declare and Set AdmExpAverage Variable (to hold Average Admin Expense of known costs)

            Dim AdmExpAverage As Long
            AdmExpAverage = Application.WorksheetFunction.Average(Worksheets("Administrative Fee Analysis").Range("B31:B" & 43 + AvgMonths - 1))

        'Set Unknown Admin Expense months to average of known
        TYTAdmin.Range("B" & 43 + AvgMonths).Value = AdmExpAverage
        'VMS-Reported Prior Year UNP
        TYTAdmin.Range("D31:D42").Value = UtilProj.Range("P9:P20").Value
        'VMS Current Year UNP
        TYTAdmin.Range("D43:D" & 43 + AvgMonths - 1).Value = UtilProj.Range("Q9:Q" & 9 + AvgMonths - 1).Value
        'Month of Data
        TYTAdmin.Range("H1").Value = Application.WorksheetFunction.Count(Util.Sheets("2019 Detail Data").Range("T3:AE3"))
        'Port-Ins
        TYTAdmin.Range("L14").Value = UtilProj.Range("O22").Value
        'Port-Outs
        TYTAdmin.Range("L15").Value = UtilProj.Range("Q22").Value
        TYTAdmin.Protect
        
    End If
            
'''''Summary Tab'''''
                
        'SEMAP Adjustments - DHAP and VASH
            TYTSEMAP.Range("N20").Value = UtilProj.Range("M77").Value
            TYTSEMAP.Range("N21").Value = UtilProj.Range("N77").Value
            TYTSEMAP.Range("N22").Value = UtilProj.Range("M78").Value
            TYTSEMAP.Range("N23").Value = UtilProj.Range("N79").Value
            TYTSEMAP.Range("N24").Value = UtilProj.Range("P79").Value
            TYTSEMAP.Range("N25").Value = UtilProj.Range("P80").Value
        
'''''VASH Projection Tab'''''

    'VASH Projection Analysis Move

        TYTVASHProj.Unprotect

        'Starting UMA
        TYTVASHProj.Range("C6").Value = VASHUtilProj.Range("W10").Value
        'PHA Number
        TYTVASHProj.Range("F2").Value = PHACode
        'Combo PHA Note
        If UtilProj.Range("I2").Value = "" Then
            TYTVASHProj.Range("G2").Value = "COMBO (" & UtilProj.Range("K9").Value & ")"
        End If
        'Year 1 UMAs
        TYTVASHProj.Range("C23:C34").Value = VASHUtilProj.Range("W10:W21").Value
        'Year 1 UMLs/HAP
        TYTVASHProj.Range("D23:E34").Value = VASHUtilProj.Range("U10:V21").Value

        'VASH* Awards
        TYTVASHProj.Range("G16").Value = VASHUtilProj.Range("T37").Value
        TYTVASHProj.Range("H16").Value = VASHUtilProj.Range("T38").Value
        TYTVASHProj.Range("I16").Value = VASHUtilProj.Range("T39").Value
        TYTVASHProj.Range("J16").Value = VASHUtilProj.Range("T40").Value
        TYTVASHProj.Range("K16").Value = VASHUtilProj.Range("T41").Value
        TYTVASHProj.Range("L16").Value = VASHUtilProj.Range("T42").Value
        TYTVASHProj.Range("M16").Value = VASHUtilProj.Range("T43").Value
        TYTVASHProj.Range("N16").Value = VASHUtilProj.Range("T44").Value

        'VASH Prior Year Leasing
        TYT.Sheets("VASH PUC Analysis").Range("H4").Value = VASHUtilProj.Range("U24").Value
        TYT.Sheets("VASH PUC Analysis").Range("H5").Value = VASHUtilProj.Range("U25").Value
        TYT.Sheets("VASH PUC Analysis").Range("H6").Value = VASHUtilProj.Range("U26").Value
        TYT.Sheets("VASH PUC Analysis").Range("H7").Value = VASHUtilProj.Range("U27").Value
        TYT.Sheets("VASH PUC Analysis").Range("H8").Value = VASHUtilProj.Range("U28").Value
        TYT.Sheets("VASH PUC Analysis").Range("H9").Value = VASHUtilProj.Range("U29").Value
        TYT.Sheets("VASH PUC Analysis").Range("H10").Value = VASHUtilProj.Range("U30").Value
        TYT.Sheets("VASH PUC Analysis").Range("H11").Value = VASHUtilProj.Range("U31").Value
        TYT.Sheets("VASH PUC Analysis").Range("H12").Value = VASHUtilProj.Range("U32").Value
        TYT.Sheets("VASH PUC Analysis").Range("H13").Value = VASHUtilProj.Range("U33").Value
        TYT.Sheets("VASH PUC Analysis").Range("H14").Value = VASHUtilProj.Range("U34").Value
        TYT.Sheets("VASH PUC Analysis").Range("H15").Value = VASHUtilProj.Range("U35").Value

        'Funding

        'Year 1 New Units
        TYTVASHProj.Range("C11").Value = VASHUtilProj.Range("V38").Value

        'Year 2 BA
        'TYTVASHProj.Range("D8").Formula = "=(('VASH Background'!C92-D9)*" & UtilProj.Range("C61").Value & ")"

        'Year 2 New Units
        TYTVASHProj.Range("D11").Value = VASHUtilProj.Range("W38").Value

        'Year 3 BA
        TYTVASHProj.Range("E8").Formula = "=('VASH Background'!C111-E9)"

        'Year 3 New Units
        TYTVASHProj.Range("E11").Value = VASHUtilProj.Range("V40").Value

''''VASH PUC Tab''''

    TYT.Sheets("VASH PUC Analysis").Unprotect
    TYT.Sheets("VASH PUC Analysis").Range("C4:D15").Value = VASHUtilProj.Range("U24:V35").Value 'Prior Year PUC
    TYT.Sheets("VASH PUC Analysis").Protect
    
'''''Funding Detail Tab'''''

    'Move Funding Detail Tab into TYT
        Util.Sheets("Funding Backup").Copy After:=TYT.Sheets("Projection Analysis")
        
'''''SPVs
    ' Move SPV Tab into TYT
        TYT.Sheets("SPVs").Range("AF4:AK244").Value = Util.Sheets("SPVs").Range("AF4:AK244").Value
        TYT.RefreshAll

'''''SEMAP Tab'''''

    'SEMAP Graphs
    TYT.Sheets("Historical SEMAP").Visible = True
        
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) <> "(MTW)" Then
        'Indicator Chart
        Util.Sheets("SEMAP").Shapes("Chart 1").Copy
        TYT.Sheets("Historical SEMAP").Select
        TYT.Sheets("Historical SEMAP").Unprotect
        TYT.Sheets("Historical SEMAP").Range("A9").Select
        ActiveSheet.PasteSpecial Format:="Picture (JPEG)", Link:=False, _
            DisplayAsIcon:=False
        'Scoring Chart
        Util.Sheets("SEMAP").Shapes("Chart 2").Copy
        TYT.Sheets("Historical SEMAP").Select
        TYT.Sheets("Historical SEMAP").Unprotect
        TYT.Sheets("Historical SEMAP").Range("A35").Select
        ActiveSheet.PasteSpecial Format:="Picture (JPEG)", Link:=False, _
            DisplayAsIcon:=False
    End If
    
    'Leasing Numbers
    TYT.Sheets("Historical SEMAP").Range("A7").Value = ThisWorkbook.Sheets("SEMAP").Range("AA67").Value
    TYT.Sheets("Historical SEMAP").Range("C7").Value = ThisWorkbook.Sheets("SEMAP").Range("AB67").Value
    TYT.Sheets("Historical SEMAP").Range("E7").Value = ThisWorkbook.Sheets("SEMAP").Range("AC67").Value
    TYT.Sheets("Historical SEMAP").Range("G7").Value = ThisWorkbook.Sheets("SEMAP").Range("AD67").Value
    TYT.Sheets("Historical SEMAP").Range("I7").Value = ThisWorkbook.Sheets("SEMAP").Range("AE67").Value
    TYT.Sheets("Historical SEMAP").Range("K7").Value = ThisWorkbook.Sheets("SEMAP").Range("AF67").Value
    TYT.Sheets("Historical SEMAP").Range("M7").Value = ThisWorkbook.Sheets("SEMAP").Range("AG67").Value
    TYT.Sheets("Historical SEMAP").Range("O7").Value = ThisWorkbook.Sheets("SEMAP").Range("AH67").Value
    TYT.Sheets("Historical SEMAP").Range("Q7").Value = ThisWorkbook.Sheets("SEMAP").Range("AI67").Value


    ActiveSheet.Range("A1").Select
    TYT.Sheets("Historical SEMAP").Visible = False
    Sheets("Projection Analysis").Select
        
'Show TYT when asking with the following boxes
    TYT.Activate
    TYT.Sheets("Projection Analysis").Activate
    TYT.Sheets("Projection Analysis").Select

'Pop box for default updates?
    If UtilProj.Range("L21").Value <> "PHA" Then
        'Last InfoPath Update date
        ufDefaultPull.VDate.Text = Util.Sheets("TYTDefConvert").Range("O11").Value
        ufDefaultPull.Show
    Else
        ufDefaultPull.Frame2.Enabled = False
        ufDefaultPull.Show
    End If

'Turn ON Summary Outcomes Boxes
    TYT.Sheets("IP Input & QA Check").Unprotect
    TYT.Sheets("IP Input & QA Check").Range("Q8").Value = "Yes"
       
'Save As for PHA
    If UtilProj.Range("L21").Value = "PHA" Then
        Dim ThisTYTFile As String
        Dim fDialog As Office.FileDialog
        
        MsgBox "To complete generating the Two-Year Tool for " & TYT.Sheets("Projection Analysis").Range("F2").Value & ", you will now be prompted to save the file to your computer." _
        & vbCrLf & vbCrLf & _
        "Please do so.", vbOKOnly, "Saving like a champion..."
    
        ThisTYTFile = "Two-Year Tool - " & TYT.Sheets("Projection Analysis").Range("F2") & " - " & Format(Now(), "dd-mmm-yyyy") & ".xlsm"
        Set fDialog = Application.FileDialog(msoFileDialogSaveAs)

            With fDialog
            .InitialFileName = ThisTYTFile
            .FilterIndex = 2
                If (.Show = -1) Then
                .Execute
                End If
            End With
    End If
    
'Open Add'l Disb Tab for External
    If UtilProj.Range("L21").Value = "PHA" Then
        TYT.Sheets("FMC Add'l Disbursement").Visible = True
    End If
    
'Show MTW tab automatically if an FMCer IDs themselves
    If ufDefaultPull.FMCer = True Then
            If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
            TYT.Sheets("Jean's Outrageous Email Tab").Activate
            TYT.Sheets("MTW Disbursements").Activate
            TYT.Sheets("MTW Disbursements").Select
            Else
            TYT.Sheets("FMC Add'l Disbursement").Activate
            TYT.Sheets("FMC Add'l Disbursement").Select
            End If
    End If

'MTW Tool?
    If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
        TYT.Sheets("MTW Welcome").Visible = True
        TYT.Sheets("Projection Analysis").Visible = False
        TYT.Sheets("IP Input & QA Check").Visible = False
        TYT.Sheets("PUC.RB Analysis").Visible = False
        TYT.Sheets("MTW Welcome").Activate
        TYT.Sheets("MTW Welcome").Select
    End If

Exit Sub
    
    'If Another Two-Year Tool is Open
    
Close2YearTool:
    i = MsgBox("I like your enthusiasm, but only one new TYT at once.", vbOKOnly, "It's rainin' Tools!")
    Application.ScreenUpdating = True
    Application.Calculation = xlCalculationAutomatic

End Sub

Private Sub MTWLaunch_Click()

Call Launch1_Click
    
End Sub

Private Sub Launch2_Click()

Call Launch1_Click

End Sub

Private Sub Worksheet_Change(ByVal Target As Range)
       
    On Error Resume Next
    
    Set KeyCells = Range("I2, I9, K9")
    
    If Not Application.Intersect(KeyCells, Range(Target.Address)) _
           Is Nothing Then
           
    'Adjust input PHA Code to capital letters
        Application.EnableEvents = False
        Target.Value = UCase(Target.Value)
        Application.EnableEvents = True
        
    'Fixes up SPV Tab in preparation for TYT Move
    Application.ScreenUpdating = False
    
    ThisWorkbook.Sheets("SPVRaw").Visible = True
    ThisWorkbook.Sheets("SPVs").Visible = True
    
    ThisWorkbook.Sheets("SPVRaw").Range("I6:N245").Copy
    ThisWorkbook.Sheets("SPVs").Range("AF5:AK244").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    ActiveWorkbook.RefreshAll
    
    ThisWorkbook.Sheets("SPVRaw").Visible = False
    ThisWorkbook.Sheets("SPVs").Visible = False
    
    'Fixes up Funding Backup in preparation for TYT Move
    ThisWorkbook.Sheets("Funding Backup").Visible = True
    ThisWorkbook.Sheets("FundingBackupFormulas").Visible = True
    
    ThisWorkbook.Sheets("FundingBackupFormulas").Range("A4:X4").Copy
    ThisWorkbook.Sheets("Funding Backup").Range("A4:X4").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    ThisWorkbook.Sheets("FundingBackupFormulas").Range("A7:F251").Copy
    ThisWorkbook.Sheets("Funding Backup").Range("A7:F251").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    ThisWorkbook.Sheets("FundingBackupFormulas").Range("G7:H251").Copy
    ThisWorkbook.Sheets("Funding Backup").Range("G7:H251").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    ThisWorkbook.Sheets("FundingBackupFormulas").Range("I7:K251").Copy
    ThisWorkbook.Sheets("Funding Backup").Range("I7:K251").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False

    ThisWorkbook.Sheets("FundingBackupFormulas").Range("M7:N7").Copy
    ThisWorkbook.Sheets("Funding Backup").Range("M7:N7").PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    'ThisWorkbook.Sheets("Funding Backup").Range("A6:V6").AutoFilter Field:=1, Criteria1:="<>"
    
    ThisWorkbook.Sheets("Funding Backup").Range("A1").Select
    
    ThisWorkbook.Sheets("Funding Backup").Visible = False
    ThisWorkbook.Sheets("FundingBackupFormulas").Visible = False
    
    Application.CutCopyMode = False
      
    'Adjust FMR Chart Y-Axis Minimum
    Dim DYMin As Integer
    DYMin = ThisWorkbook.Sheets("+FMRs").Range("O17").Value
    
    ThisWorkbook.Sheets("+FMRs").Visible = True
    ThisWorkbook.Sheets("+FMRs").ChartObjects("Chart 1").Chart.Axes(xlValue, xlPrimary).MinimumScale = DYMin
    ThisWorkbook.Sheets("+FMRs").Visible = False
    
    'Have some fun with the Boston Office
    If ThisWorkbook.ActiveSheet.Range("L21").Value <> "PHA" And Left(ThisWorkbook.ActiveSheet.Range("I2"), 2) = "MA" Then
        MABandit.Show
    Else
        Exit Sub
    End If
    
End If
    
    Application.ScreenUpdating = True
    
End Sub

Attribute VB_Name = "Sheet28"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet29"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet30"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet31"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet32"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet33"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet34"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet35"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet36"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet37"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet38"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet39"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Attribute VB_Name = "Sheet4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet40"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet41"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Attribute VB_Name = "Sheet42"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet43"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet44"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet45"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet46"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet47"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet48"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet49"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


Attribute VB_Name = "Sheet7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Sheet9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_Open()

'If PHA, ask about the survey

    If Sheets("2 Year Projection").Range("L21").Value = "PHA" Then
        ufPHASurvey.Show
        Exit Sub
    End If

'No MTW Update, but could add (it's in the PHA Convert)

'Update FMC Excess Cash from SharePoint
    Call sbImportSharePointData(ThisWorkbook.Worksheets(RNP_WORKSHEET), RNP_DATA_SOURCE)
    
'Give me SR, Time to Success, IP date for default box
    Call sbImportSharePointData(ThisWorkbook.Worksheets(SR_Worksheet), SR_DATA_SOURCE)

'Hook me up with some PBV Email Log Info
    Call sbImportSharePointData(ThisWorkbook.Worksheets(PBV_EMAIL_LOG_WORKSHEET), PBV_EMAIL_LOG_DATA)
    
'You know what else?  Let's get some FMC RAD log business, too
    Call sbImportSharePointData(ThisWorkbook.Worksheets(RAD_FMC_LOG_WORKSHEET), RAD_FMC_LOG_DATA)
    
'Drop some FMC PBV.RAD Comments on me
    Call sbImportSharePointData(ThisWorkbook.Worksheets(FMCLOGCOMMENTS_LOG_WORKSHEET), FMCLOGCOMMENTS_LOG_DATA)
    
If ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value <> "PHA" Then

'PUC/VMS broken up
    Application.Calculation = xlCalculationAutomatic
    Application.ScreenUpdating = False
    Application.DisplayAlerts = False
    
    ThisWorkbook.Sheets("TYTDefConvert").Visible = True
    ThisWorkbook.Activate
    ThisWorkbook.Sheets("TYTDefConvert").Select
    Range("P2").Select
    ActiveCell.Formula = "='+TYTDef'!H2"
    Range("Q2").Select
    ActiveCell.Formula = "='+TYTDef'!F2"
    Range("R2").Select
    ActiveCell.Formula = "='+TYTDef'!G2"
    Range("P2:R2").Select
    Selection.AutoFill Destination:=Range("P2:R2237"), Type:=xlFillDefault
    
    Range("P2:R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Range("P1").Select
    Application.CutCopyMode = False

    Range("P2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("S2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=True, OtherChar _
        :="&", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
        1), Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12 _
        , 1), Array(13, 1), Array(14, 1), Array(15, 1), Array(16, 1), Array(17, 1), Array(18, 1), _
        Array(19, 1), Array(20, 1), Array(21, 1), Array(22, 1), Array(23, 1), Array(24, 1)), _
        TrailingMinusNumbers:=True
    Range("T2231").Select
    ActiveCell.FormulaR1C1 = ""
    Range("R5").Select
    Range(Selection, Selection.End(xlDown)).Select
    Range("Q2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("AQ2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=True, OtherChar _
        :="&", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
        1), Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12 _
        , 1)), TrailingMinusNumbers:=True
    Range("R2").Select
    ActiveCell.FormulaR1C1 = "0"
    Range("T8").Select
    Range(Selection, Selection.End(xlDown)).Select
    Range("T109").Select
    ActiveCell.FormulaR1C1 = ""
    Range("R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("BC2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=True, OtherChar _
        :="&", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
        1), Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12 _
        , 1)), TrailingMinusNumbers:=True
    ThisWorkbook.Sheets("2 Year Projection").Select
    ThisWorkbook.Sheets("TYTDefConvert").Visible = False
    
Application.DisplayAlerts = True

ThisWorkbook.Sheets("2 Year Projection").Select

Application.ScreenUpdating = True
Application.EnableEvents = True

ThisWorkbook.Sheets("2 Year Projection").Protect

End If
    
'Former home of MUpdate code - moved to places to speed up opening.  When saving, run MUpdate to update all.  Otherwise:

'1: Transfer tab linked to with URLs - only runs with worksheet activation.  There shouldn't be any other ties via URL, but
'   if there are, the code that runs there also updates other urls.
'2: FL3 Worksheet - FMC input stuff.  This runs if they FMCer selects the "Yep" box when loading tool.
'3: SR Worksheet - When Tool is launched via button.
'4: MTWs - only via MUpdate Code

End Sub
Attribute VB_Name = "mConstants"
Option Explicit

Public Const FL3_DATA_SOURCE As String = "https://hudgov.sharepoint.com/sites/PIH2/HCV/_vti_bin/owssvr.dll?Cmd=Display&List={525C865B-3590-4991-92D1-3C1EE8F8C002}&View={B093CE3B-4371-4E57-AC4A-F5CA7682C4D5}&XMLDATA=TRUE"
Public Const FL3_WORKSHEET As String = "+FL3"

Public Const MTW_DATA_SOURCE As String = "https://hudgov.sharepoint.com/sites/PIH2/HCV/_vti_bin/owssvr.dll?Cmd=Display&List={5769A3F2-09AE-4B97-8C57-5439B36E2F49}&View={8995B098-36B6-4DB7-A966-965BC46AFB9A}&XMLDATA=TRUE"
Public Const MTW_WORKSHEET As String = "+MTW PHAs"

Public Const RNP_DATA_SOURCE As String = "http://sharepoint.hud.gov/sites/PIH/DASPHVP/DAS/HCVFMC/FMCShared/MasterRNPReconLog2018/_vti_bin/owssvr.dll?Cmd=Display&List={8F8E3592-73DF-4049-8A91-176E07C0AADA}&View={65B33251-7483-4981-8ED9-8307C552D8E9}&XMLDATA=TRUE"
Public Const RNP_WORKSHEET As String = "+FMCExcessCashRaw"

Public Const HQSHORTFALL_DATA_SOURCE As String = "http://sharepoint.hud.gov/sites/PIH2/DASFO/OFO_HQ_FO/HCV/Infopath/_vti_bin/owssvr.dll?Cmd=Display&List={57BEF6AC-F9F9-4996-9531-921EC774214F}&View={FF6000E1-40E4-4457-AF0A-C1F200EB0A6F}&XMLDATA=TRUE"
Public Const HQSHORTFALL_WORKSHEET As String = "+HQShortfallData"

Public Const RNPADDLDISB_DATA_SOURCE As String = "https://hudgov.sharepoint.com/sites/PIH2/HCV/_vti_bin/owssvr.dll?Cmd=Display&List={525C865B-3590-4991-92D1-3C1EE8F8C002}&View={D6DB59FB-89DC-4BC2-8385-5FE1B563F70D}&XMLDATA=TRUE"
Public Const RNPADDLDISB_WORKSHEET As String = "+RNPAddlDisb"

Public Const SR_DATA_SOURCE As String = "http://sharepoint.hud.gov/sites/PIH2/DASFO/OFO_HQ_FO/HCV/Infopath/_vti_bin/owssvr.dll?Cmd=Display&List={57BEF6AC-F9F9-4996-9531-921EC774214F}&View={ABE901CE-600F-48A6-A0DB-F042446206CE}&XMLDATA=TRUE"
Public Const SR_Worksheet As String = "+TYTDef"

Public Const ROGUE_ADDL_DISB As String = "http://sharepoint.hud.gov/sites/PIH/DASPHVP/DAS/HCVFMC/VMS%20Straight%20Face/_vti_bin/owssvr.dll?Cmd=Display&List={C17B85A5-D53D-4E18-9FF3-018DF9CFED27}&View={420DE457-C2E5-4394-B7E1-30B202412790}&XMLDATA=TRUE"
Public Const ROGUE_WORKSHEET As String = "+ROGUEDisb"

Public Const TYT_LOCATION_HUD As String = "http://www.hud.gov/sites/dfiles/PIH/documents/HurraytheTYT.xlsm"
Public Const TYT_LOCATION_PHA As String = "http://www.hud.gov/sites/dfiles/PIH/documents/HurraytheTYT.xlsm"

Public Const PBV_EMAIL_LOG_DATA As String = "http://sharepoint.hud.gov/sites/PIH2/DASFO/OFO_HQ_FO/HCV/optimization/_vti_bin/owssvr.dll?Cmd=Display&List={612BA5F2-2473-4761-839E-646C13FF5BEA}&View={ED71CA4B-E36B-450C-B49D-8C2464958457}&XMLDATA=TRUE"
Public Const PBV_EMAIL_LOG_WORKSHEET As String = "PBVEmailLog"

Public Const RAD_FMC_LOG_DATA As String = "http://sharepoint.hud.gov/sites/PIH/DASPHVP/DAS/HCVFMC/FMCShared/RAD1%20Tracking%20Master%20Pro%202018/_vti_bin/owssvr.dll?Cmd=Display&List={8F1D7310-E492-44A4-85BA-FA0C341014D4}&View={3083FBA1-DA5F-495A-9B72-F42839A89353}&XMLDATA=TRUE"
Public Const RAD_FMC_LOG_WORKSHEET As String = "FMCRADLog"

Public Const FMCLOGCOMMENTS_LOG_DATA As String = "http://sharepoint.hud.gov/sites/PIH2/DASFO/OFO_HQ_FO/HCV/Infopath/_vti_bin/owssvr.dll?Cmd=Display&List={E4D9688E-B53C-4BA7-8754-BCB84C1A4D22}&View={91EC6671-ADB5-4B3D-8457-D514E0273EF6}&XMLDATA=TRUE"
Public Const FMCLOGCOMMENTS_LOG_WORKSHEET As String = "+FMCComments"
Attribute VB_Name = "mFMCReport"
Sub GenerateRecon()


' Start
    MsgBox "Excel now needs to work very hard." & vbCrLf & vbCrLf & "You just need to sit patiently." & vbCrLf & vbCrLf & "When Excel is done working very hard, it will ask you where to save the report.  You will know, then, it's ready to rest and you can get to work.  SYNERGY!", vbOKOnly, "Excel and me - A TEAM!"
    Application.ScreenUpdating = False

'New Workbook/Worksheet
    Dim FMCReport As Workbook
    Set FMCReport = Workbooks.Add
    ActiveSheet.Name = "FMC Report BLAMO!"

'Copy from Util Report
    ThisWorkbook.Sheets("Monthly RNP Check").Visible = True
    ThisWorkbook.Sheets("Monthly RNP Check").Activate

'Pull in Shortfall Data so as to know if the SPT has it
    Call sbImportSharePointData(ActiveWorkbook.Worksheets(HQSHORTFALL_WORKSHEET), _
    HQSHORTFALL_DATA_SOURCE)
    
'Pull in Additional Disbursement Data
    Call sbImportSharePointData(ActiveWorkbook.Worksheets(RNPADDLDISB_WORKSHEET), _
    RNPADDLDISB_DATA_SOURCE)
    
'Pull in Rogue Additional Disbursement Data
    Call sbImportSharePointData(ActiveWorkbook.Worksheets(ROGUE_WORKSHEET), ROGUE_ADDL_DISB)
    
'Rerun formulas due to updates
    'Until FMC Database up and running
    Range("A2:G2").Select
    Selection.AutoFill Destination:=Range("A2:G2205"), Type:=xlFillDefault
    Range("I2:L2").Select
    Selection.AutoFill Destination:=Range("I2:L2205"), Type:=xlFillDefault
    
    'Range("A2:L2").Select
    'Selection.AutoFill Destination:=Range("A2:L2205"), Type:=xlFillDefault
    
    Range("O2:U2").Select
    Selection.AutoFill Destination:=Range("O2:U2205"), Type:=xlFillDefault
    Range("W2:AA2").Select
    Selection.AutoFill Destination:=Range("W2:AA2205"), Type:=xlFillDefault
        
'Copy
    ThisWorkbook.Sheets("Monthly RNP Check").Cells.Copy
    
'Paste into new
    FMCReport.Sheets("FMC Report BLAMO!").Activate
    FMCReport.Sheets("FMC Report BLAMO!").Select
    ActiveSheet.Paste

'Just Value Size Me
    Range("A2:K2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Application.CutCopyMode = False
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    Range("R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Application.CutCopyMode = False
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    Range("W2:X2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Application.CutCopyMode = False
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    Range("Z2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Application.CutCopyMode = False
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    Range("AD1:AE1").Select
    Application.CutCopyMode = False
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
'Fix Util
    ThisWorkbook.Sheets("Monthly RNP Check").Visible = False
    ThisWorkbook.Sheets("2 Year Projection").Activate
    FMCReport.Activate
    
'Zoom
    ActiveWindow.Zoom = 70
    
'Filter, Freeze, Slice
    Range("A1:AA1").Select
    Selection.AutoFilter
    Range("A2").Select
    ActiveWindow.FreezePanes = True
    'Selection.AutoFilter
    'ActiveWorkbook.SlicerCaches("Slicer_Team").RequireManualUpdate = False
    
    Application.ScreenUpdating = True
    
'Save new WB
    Dim strReport1 As String
    Dim strReport3 As String
    Dim fDialog As Office.FileDialog

    strReport1 = "FMC BLAMO! ("
    strReport3 = ")"
    Set fDialog = Application.FileDialog(msoFileDialogSaveAs)

    With fDialog
        .InitialFileName = strReport1 & Replace(Date, "/", ".") & strReport3
        .FilterIndex = 2
        If (.Show = -1) Then
            .Execute
        End If
    End With

End Sub
Attribute VB_Name = "mPHAConvert"
Sub ConvertToPHA()
Attribute ConvertToPHA.VB_ProcData.VB_Invoke_Func = "p\n14"
'
' Macro1 Macro

' Update external links
Call Update

'
' Keyboard Shortcut: Ctrl+p
'
    'Kills link to Transfer List
    Sheets("Transfers").Select
    ActiveSheet.Unprotect
    Range("A1:S500").Select
    Selection.Copy
    Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
    'Kills link to Recon from FMC
    ThisWorkbook.Sheets("+FMCExcessCash").Visible = True
    ThisWorkbook.Sheets("+FMCExcessCash").Select
    ActiveSheet.Unprotect
    ThisWorkbook.Sheets("+FMCExcessCash").Range("C2:D2300").Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
        
'    'Kills PBV Email Log Links
'    Sheets("PBVEmailLog").Select
'    ActiveSheet.Unprotect
'    Range("A1:F5000").Select
'    Selection.Copy
'    Range("A1").Select
'    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
'        :=False, Transpose:=False
'
'    'Kills FMD RAD Log Links
'    Sheets("FMCRADLog").Select
'    ActiveSheet.Unprotect
'    Range("A1:AD5000").Select
'    Selection.Copy
'    Range("A1").Select
'    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
'        :=False, Transpose:=False
        
    'Kills link to IP for variable updates in house
    ThisWorkbook.Sheets("+TYTDef").Visible = True
    ThisWorkbook.Sheets("+TYTDef").Select
    ActiveSheet.Unprotect
    ThisWorkbook.Sheets("+TYTDef").Range("A1:H2500").Select
    Selection.Copy
    ThisWorkbook.Sheets("+TYTDef").Range("A1").Select
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    
    Sheets("+FMCExcessCash").Visible = xlVeryHidden
    Sheets("+VMSComments").Visible = xlVeryHidden
    Sheets("Transfers").Visible = xlVeryHidden
    Sheets("Funding Backup").Visible = xlVeryHidden
    Sheets("FundingBackupFormulas").Visible = xlVeryHidden
    Sheets("Uncontracted Vouchers ").Visible = xlVeryHidden
    Sheets("Attrition Rates from PIC").Visible = xlVeryHidden
    Sheets("SPVs Report").Visible = xlVeryHidden
    Sheets("Admin Detail 2019").Visible = xlVeryHidden
    Sheets("2019 VASH Detail").Visible = xlVeryHidden
    Sheets("Summary Data").Visible = xlVeryHidden
    Sheets("2019 Detail Data").Visible = xlVeryHidden
    Sheets("2019 Funding").Visible = xlVeryHidden
    Sheets("Year 2 UMA").Visible = xlVeryHidden
    Sheets("2018 Detail Data").Visible = xlVeryHidden
    Sheets("2018 VASH Detail").Visible = xlVeryHidden
    Sheets("Admin Background").Visible = xlVeryHidden
    Sheets("+FMCExcessCash").Visible = xlVeryHidden
    Sheets("+FMCExcessCashRaw").Visible = xlVeryHidden
    Sheets("RPHA").Visible = xlVeryHidden
    Sheets("DPHA").Visible = xlVeryHidden
    Sheets("CombinedPHAs").Visible = xlVeryHidden
    Sheets("+MTW PHAs").Visible = xlVeryHidden
    Sheets("FO Folder").Visible = xlVeryHidden
    Sheets("FL1").Visible = xlVeryHidden
    Sheets("FL2").Visible = xlVeryHidden
    Sheets("+FL3").Visible = xlVeryHidden
    Sheets("VASH Projection").Visible = xlVeryHidden
    Sheets("PBV.RAD VMS Data").Visible = xlVeryHidden
    Sheets("RAD Data").Visible = xlVeryHidden
    Sheets("+TYTDef").Visible = xlVeryHidden
    Sheets("TYTDefConvert").Visible = xlVeryHidden
    Sheets("+RentBurdens").Visible = xlVeryHidden
    Sheets("+RentBurdensTrend").Visible = xlVeryHidden
    Sheets("+New Units").Visible = xlVeryHidden
    Sheets("+RNPAddlDisb").Visible = xlVeryHidden
    Sheets("Monthly RNP Check").Visible = xlVeryHidden
    Sheets("+HQShortfallData").Visible = xlVeryHidden
    Sheets("+ROGUEDisb").Visible = xlVeryHidden
    Sheets("MTWChart").Visible = xlVeryHidden
    Sheets("FMCRADLog").Visible = xlVeryHidden
    Sheets("PBVEmailLog").Visible = xlVeryHidden
    Sheets("PYSEMAPLease").Visible = xlVeryHidden
    Sheets("+FMCComments").Visible = xlVeryHidden
    Sheets("SEMAP").Visible = xlVeryHidden
    Sheets("SPVRaw").Visible = xlVeryHidden
    Sheets("SPVs").Visible = xlVeryHidden
        
    'This sets up a check so the workbook knows which TYT shell link to hit... (also, it PHA, no pop asking for
    Sheets("2 Year Projection").Range("I2").Select
    Sheets("2 Year Projection").Unprotect
    Sheets("2 Year Projection").Range("L21").Value = "PHA"
    Sheets("2 Year Projection").Protect
    
    Sheets("+FMRs").Visible = xlVeryHidden
    ActiveWorkbook.Protect Structure:=True, Windows:=True
    ActiveWorkbook.Protect Password:="lariccia"
    
End Sub

Attribute VB_Name = "mSharePointDataPull"
Option Explicit

Public Sub sbImportSharePointData(xlWorksheet As Excel.Worksheet, xmlHttpSource As String)

    Const ELEMENT_NODE As String = "s:ElementType"
    Const DATA_NODE As String = "rs:data"
    
    Dim xmlDoc As MSXML2.DOMDocument60
    Dim varColNames As Variant
    Dim rng As Excel.Range
    Dim blIsComplete As Boolean
    
    'clear contents of worksheet
    xlWorksheet.Cells.Clear
    
    'create xmlDoc
    Set xmlDoc = fCreateXmlDocument(xmlHttpSource)
    If (Not (xmlDoc Is Nothing)) Then
        'if xmlDoc creates properly, select range and set column names
        Set rng = xlWorksheet.Range("A1")
        varColNames = fGetSharePointColumns(xmlDoc.getElementsByTagName(ELEMENT_NODE).Item(0), rng)
        If (Not (IsNull(varColNames))) Then
            'if column names returns a non-null value then reset range and set data fields
            Set rng = xlWorksheet.Range("A2")
            blIsComplete = fGetSharePointData(xmlDoc.getElementsByTagName(DATA_NODE).Item(0), varColNames, rng)
        End If
    End If

ExitHandler:
    'destroy objects
    Set rng = Nothing
    Set xmlDoc = Nothing
    Exit Sub

ErrHandler:
    MsgBox Err.Number & ": " & Err.Description
    Resume ExitHandler

End Sub

'*************************************************************************************************
'*************************************************************************************************
Private Function fCreateXmlDocument(ByVal httpUrl As String) As MSXML2.DOMDocument60

    On Error GoTo ErrHandler
    
    Dim oXml As MSXML2.XMLHTTP60
    Dim xmlDoc As MSXML2.DOMDocument60
    Dim flgSuccess As Boolean
    
    'create RPC, xml document
    Set oXml = New MSXML2.XMLHTTP60
    Set xmlDoc = New MSXML2.DOMDocument60
    
    'set property to asynchronized (requires all data to load before beginning
    xmlDoc.async = False
    'set property to not validate (rely on SharePoint to provide valid xml)
    xmlDoc.validateOnParse = False
    
    With oXml
        'open RPC as GET
        .Open "GET", httpUrl, False
        'execute RPC
        .send
        'load returned xml into document, flag if successful
        flgSuccess = xmlDoc.Load(.responseXML)
    End With
    
    'set function to document if successful, nothing if not
    If flgSuccess Then
        Set fCreateXmlDocument = xmlDoc
    Else
        Set fCreateXmlDocument = Nothing
    End If
    
ExitHandler:
    'destroy objects
    Set xmlDoc = Nothing
    Set oXml = Nothing
    
    Exit Function
    
ErrHandler:
    MsgBox Err.Number & ": " & Err.Description
    Set fCreateXmlDocument = Nothing
    Resume ExitHandler
    
End Function

'*************************************************************************************************
'*************************************************************************************************
Private Function fGetSharePointColumns(ByRef xmlNode As MSXML2.IXMLDOMNode, _
    rng As Excel.Range) As Variant

    On Error GoTo ErrHandler
    
    Dim varColumns As Variant               'Array for columns
    Dim varColNames As Variant              'Array for column names
    Dim childNode As MSXML2.IXMLDOMNode     'node storing column name as attribute
    Dim attrName As MSXML2.IXMLDOMAttribute 'name
    Dim attrRsName As MSXML2.IXMLDOMAttribute 'rs:name attribute
    Dim i As Integer                        'counter
    
    varColumns = Null
     
    's:ElementType stores schema elements in SharePoint, return null if not s:ElementType
    If xmlNode.nodeName = "s:ElementType" Then
        i = 0
        'set size of column array to number of child nodes
        ReDim varColumns(xmlNode.ChildNodes.Length - 1)
        ReDim varColNames(UBound(varColumns))
        'loop through child nodes
        For Each childNode In xmlNode.ChildNodes
            'set attribute to first attribute ("name")
            Set attrName = childNode.Attributes(0)
            'set attribute to second attribute ("rs:name")
            Set attrRsName = childNode.Attributes(1)
            'get value of attribute
            varColumns(i) = attrName.Value
            varColNames(i) = attrRsName.Value
            'increase counter
            i = i + 1
        Next childNode
        rng.Resize(1, UBound(varColNames) + 1) = varColNames
    End If
    
ExitHandler:
    
    'destroy objects
    Set attrName = Nothing
    Set attrRsName = Nothing
    Set childNode = Nothing
    
    'set function to value of variant
    fGetSharePointColumns = varColumns
    Exit Function
    
ErrHandler:
    MsgBox Err.Number & ": " & Err.Description
    varColumns = Null
    Resume ExitHandler

End Function

'*************************************************************************************************
'*************************************************************************************************
Private Function fGetSharePointData(ByRef xmlNode As MSXML2.IXMLDOMNode, varColumns As Variant, _
    rng As Excel.Range) As Boolean

    On Error GoTo ErrHandler
    
    Dim varData As Variant              'array for data
    Dim childNode As MSXML2.IXMLDOMNode 'node storing data fields
    Dim nodeAttr As MSXML2.IXMLDOMAttribute 'attribute for child node
    Dim i As Integer
    Dim j As Integer
    Dim k As Integer
    
    varData = Null
    
    'rs:data is parent node to all data fields (z:row)
    If xmlNode.nodeName = "rs:data" Then
        'check if there is a child node
        If xmlNode.HasChildNodes Then
            'set array size (2d) to number of fields and number of columns
            ReDim varData(xmlNode.ChildNodes.Length - 1, UBound(varColumns))
            For i = 0 To xmlNode.ChildNodes.Length - 1
                'set child node
                Set childNode = xmlNode.ChildNodes(i)
                'set independent counter for k
                'SharePoint does not return attributes that have a null value, so this ensures
                'that all attributes match with the appropriate column name
                k = 0
                For j = 0 To UBound(varColumns)
                    'prevents occurrence of error when the kth attribute doesn't exist
                    'for example, a row may have null values for the last two columns
                    'and therefore does not return an attribute for those columns.
                    'k increases after the last non-null attribute and set nodeAttr
                    'is out of range
                    If k < childNode.Attributes.Length Then
                        'set nodeAttr to kth attribute of child node
                        Set nodeAttr = childNode.Attributes(k)
                        'check if the name of the attribute is the same as the column name
                        If nodeAttr.Name = varColumns(j) Then
                            'if so, set the jth item in the array to that value for row i
                            varData(i, j) = nodeAttr.Value
                            'increment k
                            k = k + 1
                        End If
                    End If
                Next j
            Next i
            'set the range value to varData
            rng.Resize(UBound(varData, 1) + 1, UBound(varData, 2) + 1) = varData
        End If
    End If
    
ExitHandler:
    
    'destroy objects
    Set nodeAttr = Nothing
    Set childNode = Nothing
    
    'set function to value of variant
    fGetSharePointData = IIf(Not (IsNull(varData)), True, False)
    Exit Function
    
ErrHandler:
    MsgBox Err.Number & ": " & Err.Description
    varData = Null
    Resume ExitHandler
    
End Function
Attribute VB_Name = "mShowandTellConvert"
Sub mShowandTell()
Attribute mShowandTell.VB_ProcData.VB_Invoke_Func = "h\n14"
'
' mShowandTell Macro
'
' Keyboard Shortcut: Ctrl+h
'

    Sheets("+FMCExcessCash").Visible = xlSheetHidden
    Sheets("+VMSComments").Visible = xlSheetHidden
    Sheets("Transfers").Visible = xlSheetHidden
    Sheets("Funding Backup").Visible = xlSheetHidden
    Sheets("FundingBackupFormulas").Visible = xlSheetHidden
    Sheets("Uncontracted Vouchers ").Visible = xlSheetHidden
    Sheets("Attrition Rates from PIC").Visible = xlSheetHidden
    Sheets("SPVs Report").Visible = xlSheetHidden
    Sheets("Admin Detail 2019").Visible = xlSheetHidden
    Sheets("2019 VASH Detail").Visible = xlSheetHidden
    Sheets("Summary Data").Visible = xlSheetHidden
    Sheets("2019 Detail Data").Visible = xlSheetHidden
    Sheets("2019 Funding").Visible = xlSheetHidden
    Sheets("Year 2 UMA").Visible = xlSheetHidden
    Sheets("2018 Detail Data").Visible = xlSheetHidden
    Sheets("2018 VASH Detail").Visible = xlSheetHidden
    Sheets("Admin Background").Visible = xlSheetHidden
    Sheets("+FMCExcessCash").Visible = xlSheetHidden
    Sheets("+FMCExcessCashRaw").Visible = xlSheetHidden
    Sheets("RPHA").Visible = xlSheetHidden
    Sheets("DPHA").Visible = xlSheetHidden
    Sheets("CombinedPHAs").Visible = xlSheetHidden
    Sheets("+MTW PHAs").Visible = xlSheetHidden
    Sheets("FO Folder").Visible = xlSheetHidden
    Sheets("FL1").Visible = xlSheetHidden
    Sheets("FL2").Visible = xlSheetHidden
    Sheets("+FL3").Visible = xlSheetHidden
    Sheets("VASH Projection").Visible = xlSheetHidden
    Sheets("PBV.RAD VMS Data").Visible = xlSheetHidden
    Sheets("RAD Data").Visible = xlSheetHidden
    Sheets("+TYTDef").Visible = xlSheetHidden
    Sheets("TYTDefConvert").Visible = xlSheetHidden
    Sheets("+RentBurdens").Visible = xlSheetHidden
    Sheets("+RentBurdensTrend").Visible = xlSheetHidden
    Sheets("+New Units").Visible = xlSheetHidden
    Sheets("+RNPAddlDisb").Visible = xlSheetHidden
    Sheets("Monthly RNP Check").Visible = xlSheetHidden
    Sheets("+HQShortfallData").Visible = xlSheetHidden
    Sheets("+ROGUEDisb").Visible = xlSheetHidden
    Sheets("MTWChart").Visible = xlSheetHidden
    Sheets("FMCRADLog").Visible = xlSheetHidden
    Sheets("PBVEmailLog").Visible = xlSheetHidden
    Sheets("PYSEMAPLease").Visible = xlSheetHidden
    Sheets("+FMCComments").Visible = xlSheetHidden
    Sheets("SEMAP").Visible = xlSheetHidden
End Sub
Attribute VB_Name = "mUpdate"
Public Sub Update()

    ThisWorkbook.Sheets("2 Year Projection").Unprotect
    ThisWorkbook.UpdateLink Type:=xlExcelLinks

    ThisWorkbook.Sheets("Transfers").Select
        Range("S1").Select
        ActiveSheet.Range("$A$1:$S$1000").AutoFilter Field:=19, Criteria1:="<>"
        Range("A1").Select
    On Error Resume Next
    
    Call sbImportSharePointData(ThisWorkbook.Worksheets(SR_Worksheet), SR_DATA_SOURCE)
    Call sbImportSharePointData(ThisWorkbook.Worksheets(FL3_WORKSHEET), FL3_DATA_SOURCE)
    Call sbImportSharePointData(ThisWorkbook.Worksheets(MTW_WORKSHEET), MTW_DATA_SOURCE)
    
' Updating SR, Time to Success, etc.

'Set up PUC/VMS

'PUC/VMS broken up

    Application.DisplayAlerts = False
    
    ThisWorkbook.Sheets("TYTDefConvert").Visible = True
    ThisWorkbook.Sheets("TYTDefConvert").Select
    Range("P2").Select
    ActiveCell.Formula = "='+TYTDef'!H2"
    Range("Q2").Select
    ActiveCell.Formula = "='+TYTDef'!F2"
    Range("R2").Select
    ActiveCell.Formula = "='+TYTDef'!G2"
    Range("P2:R2").Select
    Selection.AutoFill Destination:=Range("P2:R2237"), Type:=xlFillDefault
    
    Range("P2:R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.Copy
    Selection.PasteSpecial Paste:=xlPasteValues, Operation:=xlNone, SkipBlanks _
        :=False, Transpose:=False
    Range("P1").Select
    Application.CutCopyMode = False

    Range("P2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("S2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=True, OtherChar _
        :="&", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
        1), Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12 _
        , 1), Array(13, 1), Array(14, 1), Array(15, 1), Array(16, 1), Array(17, 1), Array(18, 1), _
        Array(19, 1), Array(20, 1), Array(21, 1), Array(22, 1), Array(23, 1), Array(24, 1)), _
        TrailingMinusNumbers:=True
    Range("T2231").Select
    ActiveCell.FormulaR1C1 = ""
    Range("R5").Select
    Range(Selection, Selection.End(xlDown)).Select
    Range("Q2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("AQ2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=True, OtherChar _
        :="&", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
        1), Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12 _
        , 1)), TrailingMinusNumbers:=True
    Range("R2").Select
    ActiveCell.FormulaR1C1 = "0"
    Range("T8").Select
    Range(Selection, Selection.End(xlDown)).Select
    Range("T109").Select
    ActiveCell.FormulaR1C1 = ""
    Range("R2").Select
    Range(Selection, Selection.End(xlDown)).Select
    Selection.TextToColumns Destination:=Range("BC2"), DataType:=xlDelimited, _
        TextQualifier:=xlDoubleQuote, ConsecutiveDelimiter:=False, Tab:=False, _
        Semicolon:=False, Comma:=False, Space:=False, Other:=True, OtherChar _
        :="&", FieldInfo:=Array(Array(1, 1), Array(2, 1), Array(3, 1), Array(4, 1), Array(5, _
        1), Array(6, 1), Array(7, 1), Array(8, 1), Array(9, 1), Array(10, 1), Array(11, 1), Array(12 _
        , 1)), TrailingMinusNumbers:=True
    ThisWorkbook.Sheets("TYTDefConvert").Visible = False
    
Application.DisplayAlerts = True

ThisWorkbook.Sheets("2 Year Projection").Select

Application.ScreenUpdating = True
Application.EnableEvents = True

ThisWorkbook.Sheets("2 Year Projection").Protect

End Sub
Attribute VB_Name = "mZoneFlagGuide"
Option Explicit

Sub ZoneandFlagGuide()
Attribute ZoneandFlagGuide.VB_ProcData.VB_Invoke_Func = " \n14"

' ZoneandFlagGuide Macro

ufZFG.Show

End Sub
Attribute VB_Name = "ufDefaultPull"
Attribute VB_Base = "0{663D11EC-704B-4C6A-97D4-79D970FAFE22}{AC0271C3-9FEE-4EAC-A927-7051BC657F27}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Public Sub CommandButton1_Click()

ufDefaultPull.Hide

'PBV Attrition

        If ThisWorkbook.Sheets("2 Year Projection").Range("G33").Value > 0 And ButtonOffset = True Then
            If ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value = "PHA" Then
                Application.Run ("'HurraytheTYT.xlsm'!PBVAttrition")
            Else
                Application.Run ("'HurraytheTYT.xlsm'!PBVAttrition")
            End If
        End If
        
'AutoPUC
    
        If ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value = "PHA" And ButtonTrend = True Then
            Application.Run ("'HurraytheTYT.xlsm'!GoGoPUC")
        
        ElseIf ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value = "PHA" And ButtonTrend = False Then
        
        ElseIf ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value <> "PHA" And ButtonTrend = True Then
            Application.Run ("'HurraytheTYT.xlsm'!GoGoPUC")
        
        ElseIf ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value <> "PHA" And ButtonTrend = False Then
            Application.Calculation = xlCalculationAutomatic
        End If
        
'Declare Variables
        Dim Util As Workbook
        Dim TYTProj As Worksheet
        Dim TYTName As String
        Dim TYT As Workbook
        
        'Set Variables
        Set Util = ThisWorkbook
        Set UtilProj = ThisWorkbook.Sheets("2 Year Projection")

        If ThisWorkbook.Sheets("2 Year Projection").Range("L21").Value = "PHA" Then
            TYTName = "HurraytheTYT.xlsm"
            Else
            TYTName = "HurraytheTYT.xlsm"
        End If
        
        Set TYT = Application.Workbooks(TYTName)
        Set TYTProj = TYT.Sheets("Projection Analysis")
        
        'Success Rate
        If VSR = True Then
        
        'Adjust
        ufDefaultPull.Hide
        
        TYTProj.Range("K5").Value = Util.Sheets("TYTDefConvert").Range("O4").Value
        End If
        
        'Time To Succcess
        If VTTS = True Then
        
        'Adjust
        ufDefaultPull.Hide
        
            TYTProj.Range("K8").Value = Util.Sheets("TYTDefConvert").Range("O6")
            TYTProj.Range("K9").Value = Util.Sheets("TYTDefConvert").Range("O7")
            TYTProj.Range("K10").Value = Util.Sheets("TYTDefConvert").Range("O8")
            TYTProj.Range("K11").Value = Util.Sheets("TYTDefConvert").Range("O9")
            TYTProj.Range("K12").Value = Util.Sheets("TYTDefConvert").Range("O10")
        End If
        
        'EOP
        If VAR = True Then
            ufDefaultPull.Hide
            TYTProj.Range("M5").Value = Util.Sheets("TYTDefConvert").Range("O5")
        End If
        
        'VOS
        If VVI = True Then
            
        'Adjust
        ufDefaultPull.Hide
            
            'Yr1
            TYTProj.Range("F23").Value = Util.Sheets("TYTDefConvert").Range("O36")
            TYTProj.Range("F24").Value = Util.Sheets("TYTDefConvert").Range("O37")
            TYTProj.Range("F25").Value = Util.Sheets("TYTDefConvert").Range("O38")
            TYTProj.Range("F26").Value = Util.Sheets("TYTDefConvert").Range("O39")
            TYTProj.Range("F27").Value = Util.Sheets("TYTDefConvert").Range("O40")
            TYTProj.Range("F28").Value = Util.Sheets("TYTDefConvert").Range("O41")
            TYTProj.Range("F29").Value = Util.Sheets("TYTDefConvert").Range("O42")
            TYTProj.Range("F30").Value = Util.Sheets("TYTDefConvert").Range("O43")
            TYTProj.Range("F31").Value = Util.Sheets("TYTDefConvert").Range("O44")
            TYTProj.Range("F32").Value = Util.Sheets("TYTDefConvert").Range("O45")
            TYTProj.Range("F33").Value = Util.Sheets("TYTDefConvert").Range("O46")
            TYTProj.Range("F34").Value = Util.Sheets("TYTDefConvert").Range("O47")
        
            'Yr2
            TYTProj.Range("F37").Value = Util.Sheets("TYTDefConvert").Range("O48")
            TYTProj.Range("F38").Value = Util.Sheets("TYTDefConvert").Range("O49")
            TYTProj.Range("F39").Value = Util.Sheets("TYTDefConvert").Range("O50")
            TYTProj.Range("F40").Value = Util.Sheets("TYTDefConvert").Range("O51")
            TYTProj.Range("F41").Value = Util.Sheets("TYTDefConvert").Range("O52")
            TYTProj.Range("F42").Value = Util.Sheets("TYTDefConvert").Range("O53")
            TYTProj.Range("F43").Value = Util.Sheets("TYTDefConvert").Range("O54")
            TYTProj.Range("F44").Value = Util.Sheets("TYTDefConvert").Range("O55")
            TYTProj.Range("F45").Value = Util.Sheets("TYTDefConvert").Range("O56")
            TYTProj.Range("F46").Value = Util.Sheets("TYTDefConvert").Range("O57")
            TYTProj.Range("F47").Value = Util.Sheets("TYTDefConvert").Range("O58")
            TYTProj.Range("F48").Value = Util.Sheets("TYTDefConvert").Range("O59")
        
        End If
        
        'PUC
            
        If VPUC = True Then
        
        'Adjust
        ufDefaultPull.Hide
        
        'Unprotect
        TYTProj.Unprotect
            
            'Yr1
            TYTProj.Range("M23").Value = Util.Sheets("TYTDefConvert").Range("O12")
            TYTProj.Range("M24").Value = Util.Sheets("TYTDefConvert").Range("O13")
            TYTProj.Range("M25").Value = Util.Sheets("TYTDefConvert").Range("O14")
            TYTProj.Range("M26").Value = Util.Sheets("TYTDefConvert").Range("O15")
            TYTProj.Range("M27").Value = Util.Sheets("TYTDefConvert").Range("O16")
            TYTProj.Range("M28").Value = Util.Sheets("TYTDefConvert").Range("O17")
            TYTProj.Range("M29").Value = Util.Sheets("TYTDefConvert").Range("O18")
            TYTProj.Range("M30").Value = Util.Sheets("TYTDefConvert").Range("O19")
            TYTProj.Range("M31").Value = Util.Sheets("TYTDefConvert").Range("O20")
            TYTProj.Range("M32").Value = Util.Sheets("TYTDefConvert").Range("O21")
            TYTProj.Range("M33").Value = Util.Sheets("TYTDefConvert").Range("O22")
            TYTProj.Range("M34").Value = Util.Sheets("TYTDefConvert").Range("O23")
            
            'Yr2
            TYTProj.Range("M37").Value = Util.Sheets("TYTDefConvert").Range("O24")
            TYTProj.Range("M38").Value = Util.Sheets("TYTDefConvert").Range("O25")
            TYTProj.Range("M39").Value = Util.Sheets("TYTDefConvert").Range("O26")
            TYTProj.Range("M40").Value = Util.Sheets("TYTDefConvert").Range("O27")
            TYTProj.Range("M41").Value = Util.Sheets("TYTDefConvert").Range("O28")
            TYTProj.Range("M42").Value = Util.Sheets("TYTDefConvert").Range("O29")
            TYTProj.Range("M43").Value = Util.Sheets("TYTDefConvert").Range("O30")
            TYTProj.Range("M44").Value = Util.Sheets("TYTDefConvert").Range("O31")
            TYTProj.Range("M45").Value = Util.Sheets("TYTDefConvert").Range("O32")
            TYTProj.Range("M46").Value = Util.Sheets("TYTDefConvert").Range("O33")
            TYTProj.Range("M47").Value = Util.Sheets("TYTDefConvert").Range("O34")
            TYTProj.Range("M48").Value = Util.Sheets("TYTDefConvert").Range("O35")
        End If
            
        'FMC?
            If FMCer = True Then
            ufDefaultPull.Hide
            TYT.Sheets("PUC.RB Analysis").Visible = False
            TYT.Sheets("Administrative Fee Analysis").Visible = False
            TYT.Sheets("PBV.RAD").Visible = True
            
                If Right(ThisWorkbook.Sheets("2 Year Projection").Range("G4"), 5) = "(MTW)" Then
                TYT.Sheets("MTW Disbursements").Visible = True
                TYT.Sheets("Jean's Outrageous Email Tab").Visible = True
                ufDefaultPull.Hide
                TYT.Sheets("MTW Disbursements").Activate
                TYT.Sheets("MTW Disbursements").Select
                Else
                
                TYT.Sheets("FMC Add'l Disbursement").Visible = True
                ufDefaultPull.Hide
                TYT.Sheets("FMC Add'l Disbursement").Activate
                TYT.Sheets("FMC Add'l Disbursement").Select
                End If
                
                If Util.Sheets("2 Year Projection").Range("J40") + Util.Sheets("2 Year Projection").Range("J41") <> 0 Then
                    MsgBox "Exciting news!" & vbCrLf & vbCrLf & "This PHA has PBV!" & vbCrLf & vbCrLf & "Please take a peek at the PBV.RAD Tab.", vbOKOnly, "Today is your lucky day!"
            End If
            
        End If
        
        ufDefaultPull.Hide
        
End Sub


Private Sub SelAll_Click()

If ufDefaultPull.SelAll.Value = True Then

ufDefaultPull.VSR.Value = True
ufDefaultPull.VTTS.Value = True
ufDefaultPull.VAR.Value = True
ufDefaultPull.VVI.Value = True
ufDefaultPull.VPUC.Value = True

Else

ufDefaultPull.VSR.Value = False
ufDefaultPull.VTTS.Value = False
ufDefaultPull.VAR.Value = False
ufDefaultPull.VVI.Value = False
ufDefaultPull.VPUC.Value = False

End If

End Sub
Attribute VB_Name = "ufPHASurvey"
Attribute VB_Base = "0{5F5D0F7B-911C-48A3-A6CC-FD594B1F7173}{28743BF6-299F-42C4-A632-15C47FC967AD}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()

ThisWorkbook.FollowHyperlink "https://forms.gle/zMiJv3tasL5yZNNV9"
ufPHASurvey.Hide

End Sub

Private Sub CommandButton2_Click()

ufPHASurvey.Hide

End Sub
Attribute VB_Name = "ufZFG"
Attribute VB_Base = "0{50A3F3F9-357E-4662-9D22-A283CB14E764}{09DF515C-CFAF-4A1E-AC79-C78774CCF712}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Private Sub CommandButton1_Click()
ufZFG.Hide
End Sub

Private Sub CommandButton2_Click()
ufZFG.Hide
ufZFG.Show vbModeless
End Sub


INQUEST-PP=macro
