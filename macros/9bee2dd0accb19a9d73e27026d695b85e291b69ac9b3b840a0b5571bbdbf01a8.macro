Attribute VB_Name = "ModReg"
Public Declare Function RegOpenKey Lib "advapi32.dll" Alias "RegOpenKeyA" (ByVal hKey As Long, ByVal lpSubKey As String, phkResult As Long) As Long
Public Declare Function RegQueryValueEx Lib "advapi32.dll" Alias "RegQueryValueExA" (ByVal hKey As Long, ByVal lpValueName As String, ByVal lpReserved As Long, lpType As Long, lpData As Any, lpcbData As Long) As Long         ' Note that if you declare the lpData parameter as String, you must pass it By Value.

Public Function GetRegistrValue() As String
Dim lReturn As Long
Dim shKey As String, sSubKey As String, hKey As Long
Dim hSubKeyHandle As Long
Dim sValue As String
Dim sPar As String
Dim strSetting As String
Dim lngDataLen As Long

hKey = &H80000002   'Case "HKEY_LOCAL_MACHINE"
sSubKey = "SOFTWARE\Rassvet\Aksiok\Vfp9\VSvod"
sPar = "ProgramXls"
    
lReturn = RegOpenKey(hKey, sSubKey, hSubKeyHandle)
If lReturn <> 0 Then Exit Function
strSetting = Space(255)
lngDataLen = Len(strSetting)
lReturn = RegQueryValueEx(hSubKeyHandle, sPar, ByVal 0, REG_EXPAND_SZ, ByVal strSetting, lngDataLen)
If strSetting = Space(255) Then GetRegistrValue = "": Exit Function     '"C:\Aksiok\Prg\VSvod\Xlt\"
If lngDataLen > 1 Then sValue = Left(strSetting, lngDataLen - 1)
GetRegistrValue = sValue
End Function


Attribute VB_Name = "frmAddRow"
Attribute VB_Base = "0{FD98747F-4135-47D9-BDB0-96A045C270F2}{F8CB4522-AD17-4FA2-8F18-A0FB1FEAD2EF}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False


Option Explicit
''''''''''''''''''''''''''''''''''''''''''''
'**** Version 28.07.2005 *******************
''''''''''''''''''''''''''''''''''''''''''''


Public ObjectName As String
Public IsUnload As Boolean


Public Property Set ObjectDataSprav(NewObject As Object)
        
    Dim objData As Object
    Dim i As Long
    Dim ctl As Control
    Dim obj As Object
    Dim objCol As Object
    Dim iLblLeft As Long
    Dim iLblWidth As Integer
    Dim cKodR, cNameR, cDataR As String
    Dim lEmpty As Boolean
    Dim iVal As Long
    
    On Error GoTo errHandler
    
    Me.IsUnload = False
    
    iLblLeft = 5
    iLblWidth = 65
'    cKod = "Kod_"
'    cName = "Name_"
'    cData = "Data_"
    
    Set objData = NewObject
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    For Each ctl In Me.Controls
        If TypeName(ctl) <> "CommandButton" Then
            ctl.Visible = False
        End If
    Next ctl
    
    With objData
        Me.Caption = .cName
        Me.Height = .iHeight
        Me.Width = .iWidth
        
        With .SpravCollection
            If .Count > 0 Then
                For i = 1 To .Count
                    With .Item(Val(i))
                        cDataR = cData & .cSprav
                        cKodR = cKod & .cSprav
                        cNameR = cName & .cSprav
                        
                        Select Case .cControl
                            Case "cmbBSR"
                                lblBSR.Visible = True
                                lblBSR.Caption = Trim(.cName)
                                lblBSR.Height = .iLblHeight
                                lblBSR.Width = .iLblWidth
                                lblBSR.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblBSR.Top = .iTop
                                cmbBSR.Visible = True
                                cmbBSR.Tag = Trim(.cSprav)
                                cmbBSR.Height = .iHeight
                                cmbBSR.Width = .iWidth
                                cmbBSR.Left = Me.Width - .iWidth - iLblLeft
                                cmbBSR.Top = .iTop
                                cmbBSR.RowSource = cDataR
                                cmbBSR.ColumnCount = .iColCount
                                cmbBSR.ColumnWidths = .cColWidths
                                
                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                                lEmpty = EmptySpr(cDataR)
                                If lEmpty = True Then
                                    cmbBSR.Enabled = False
                                Else
                                    cmbBSR.Enabled = True
                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        cmbBSR.ListIndex = 0
                                    Else
                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
                                        cmbBSR.ListIndex = iVal
                                    End If
                                End If
                            Case "cmbEI"
                                lblEI.Visible = True
                                lblEI.Caption = Trim(.cName)
                                lblEI.Height = .iLblHeight
                                lblEI.Width = .iLblWidth
                                lblEI.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblEI.Top = .iTop
                                cmbEI.Visible = True
                                cmbEI.Tag = Trim(.cSprav)
                                cmbEI.Height = .iHeight
                                cmbEI.Width = .iWidth
                                cmbEI.Left = Me.Width - .iWidth - iLblLeft
                                cmbEI.Top = .iTop
                                cmbEI.RowSource = cDataR
                                cmbEI.ColumnCount = .iColCount
                                cmbEI.ColumnWidths = .cColWidths
                                
                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                                lEmpty = EmptySpr(cDataR)
                                If lEmpty = True Then
                                    cmbEI.Enabled = False
                                Else
                                    cmbEI.Enabled = True
                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        cmbEI.ListIndex = 0
                                    Else
                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
                                        cmbEI.ListIndex = iVal
                                    End If
                                End If
                            Case "listORG"
                                lblORG.Visible = True
                                lblORG.Caption = Trim(.cName)
                                lblORG.Height = .iLblHeight
                                lblORG.Width = .iLblWidth
                                lblORG.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblORG.Top = .iTop
                                listORG.Visible = True
                                listORG.Tag = Trim(.cSprav)
                                listORG.Height = .iHeight
                                listORG.Width = .iWidth
                                listORG.Left = Me.Width - .iWidth - iLblLeft
                                listORG.Top = .iTop
                                listORG.RowSource = cDataR
                                listORG.ColumnCount = .iColCount
                                listORG.ColumnWidths = .cColWidths
                                
                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                                lEmpty = EmptySpr(cDataR)
                                If lEmpty = True Then
                                    listORG.Enabled = False
                                Else
                                    listORG.Enabled = True
                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listORG.ListIndex = 0
                                    Else
                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
                                        listORG.ListIndex = iVal
                                    End If
                                End If
                            Case "listFKR"
                                lblFKR.Visible = True
                                lblFKR.Caption = Trim(.cName)
                                lblFKR.Height = .iLblHeight
                                lblFKR.Width = .iLblWidth
                                lblFKR.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblFKR.Top = .iTop
                                listFKR.Visible = True
                                listFKR.Tag = Trim(.cSprav)
                                listFKR.Height = .iHeight
                                listFKR.Width = .iWidth
                                listFKR.Left = Me.Width - .iWidth - iLblLeft
                                listFKR.Top = .iTop
                                listFKR.RowSource = cDataR
                                listFKR.ColumnCount = .iColCount
                                listFKR.ColumnWidths = .cColWidths
                                
'                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'                                lEmpty = EmptySpr(cDataR)
'                                If lEmpty = True Then
'                                    listFKR.Enabled = False
'                                Else
'                                    listFKR.Enabled = True
'                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listFKR.ListIndex = 0
'                                    Else
'                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
'                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
'                                        listFKR.ListIndex = iVal
'                                    End If
'                                End If
                             Case "listPLS"
                                lblPLS.Visible = True
                                lblPLS.Caption = Trim(.cName)
                                lblPLS.Height = .iLblHeight
                                lblPLS.Width = .iLblWidth
                                lblPLS.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblPLS.Top = .iTop
                                listPLS.Visible = True
                                listPLS.Tag = Trim(.cSprav)
                                listPLS.Height = .iHeight
                                listPLS.Width = .iWidth
                                listPLS.Left = Me.Width - .iWidth - iLblLeft
                                listPLS.Top = .iTop
                                listPLS.RowSource = cDataR
                                listPLS.ColumnCount = .iColCount
                                listPLS.ColumnWidths = .cColWidths
                                
'                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'                                lEmpty = EmptySpr(cDataR)
'                                If lEmpty = True Then
'                                    listPLS.Enabled = False
'                                Else
'                                    listPLS.Enabled = True
'                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listPLS.ListIndex = 0
'                                    Else
'                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
'                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
'                                        listPLS.ListIndex = iVal
'                                    End If
'                                End If
                            Case "listSGU"
                                lblSGU.Visible = True
                                lblSGU.Caption = Trim(.cName)
                                lblSGU.Height = .iLblHeight
                                lblSGU.Width = .iLblWidth
                                lblSGU.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblSGU.Top = .iTop
                                listSGU.Visible = True
                                listSGU.Tag = Trim(.cSprav)
                                listSGU.Height = .iHeight
                                listSGU.Width = .iWidth
                                listSGU.Left = Me.Width - .iWidth - iLblLeft
                                listSGU.Top = .iTop
                                listSGU.RowSource = cDataR
                                listSGU.ColumnCount = .iColCount
                                listSGU.ColumnWidths = .cColWidths
                                
'                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'                                lEmpty = EmptySpr(cDataR)
'                                If lEmpty = True Then
'                                    listSGU.Enabled = False
'                                Else
'                                    listSGU.Enabled = True
'                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listSGU.ListIndex = 0
'                                    Else
'                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
'                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
'                                        listSGU.ListIndex = iVal
'                                    End If
'                                End If
                             Case "listKLD"
                                lblKLD.Visible = True
                                lblKLD.Caption = Trim(.cName)
                                lblKLD.Height = .iLblHeight
                                lblKLD.Width = .iLblWidth
                                lblKLD.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblKLD.Top = .iTop
                                listKLD.Visible = True
                                listKLD.Tag = Trim(.cSprav)
                                listKLD.Height = .iHeight
                                listKLD.Width = .iWidth
                                listKLD.Left = Me.Width - .iWidth - iLblLeft
                                listKLD.Top = .iTop
                                listKLD.RowSource = cDataR
                                listKLD.ColumnCount = .iColCount
                                listKLD.ColumnWidths = .cColWidths
                                
'                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'                                lEmpty = EmptySpr(cDataR)
'                                If lEmpty = True Then
'                                    listKLD.Enabled = False
'                                Else
'                                    listKLD.Enabled = True
'                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listKLD.ListIndex = 0
'                                    Else
'                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
'                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
'                                        listKLD.ListIndex = iVal
'                                    End If
'                                End If
                             Case "listIFR"
                                lblIFR.Visible = True
                                lblIFR.Caption = Trim(.cName)
                                lblIFR.Height = .iLblHeight
                                lblIFR.Width = .iLblWidth
                                lblIFR.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblIFR.Top = .iTop
                                listIFR.Visible = True
                                listIFR.Tag = Trim(.cSprav)
                                listIFR.Height = .iHeight
                                listIFR.Width = .iWidth
                                listIFR.Left = Me.Width - .iWidth - iLblLeft
                                listIFR.Top = .iTop
                                listIFR.RowSource = cDataR
                                listIFR.ColumnCount = .iColCount
                                listIFR.ColumnWidths = .cColWidths
                                
'                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'                                lEmpty = EmptySpr(cDataR)
'                                If lEmpty = True Then
'                                    listIFR.Enabled = False
'                                Else
'                                    listIFR.Enabled = True
'                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listIFR.ListIndex = 0
'                                    Else
'                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
'                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
'                                        listIFR.ListIndex = iVal
'                                    End If
'                                End If
                            Case "listIFV"
                                lblIFV.Visible = True
                                lblIFV.Caption = Trim(.cName)
                                lblIFV.Height = .iLblHeight
                                lblIFV.Width = .iLblWidth
                                lblIFV.Left = Me.Width - .iWidth - .iLblWidth - iLblLeft
                                lblIFV.Top = .iTop
                                listIFV.Visible = True
                                listIFV.Tag = Trim(.cSprav)
                                listIFV.Height = .iHeight
                                listIFV.Width = .iWidth
                                listIFV.Left = Me.Width - .iWidth - iLblLeft
                                listIFV.Top = .iTop
                                listIFV.RowSource = cDataR
                                listIFV.ColumnCount = .iColCount
                                listIFV.ColumnWidths = .cColWidths
                                
'                                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'                                lEmpty = EmptySpr(cDataR)
'                                If lEmpty = True Then
'                                    listIFV.Enabled = False
'                                Else
'                                    listIFV.Enabled = True
'                                    If Len(Trim(Application.Range(cKodR).Value)) = 0 Then
                                        listIFV.ListIndex = 0
'                                    Else
'                                        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Range(cKodR).Value |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cDataR
'                                        iVal = FoundIndex(cDataR, Trim(Range(cKodR).Value))
'                                        listIFV.ListIndex = iVal
'                                    End If
'                                End If
                             Case "optD"
                                optD.Visible = True
                                optD.Height = .iHeight
                                optD.Width = .iWidth
                                optD.Left = .iLeft
                                optD.Top = .iTop
                                optD.Tag = .cControl
                              Case "optR"
                                optR.Visible = True
                                optR.Height = .iHeight
                                optR.Width = .iWidth
                                optR.Left = .iLeft
                                optR.Top = .iTop
                                optR.Tag = .cControl
                              Case "optFR"
                                optFR.Visible = True
                                optFR.Height = .iHeight
                                optFR.Width = .iWidth
                                optFR.Left = .iLeft
                                optFR.Top = .iTop
                                optFR.Tag = .cControl
                              Case "optFV"
                                optFV.Visible = True
                                optFV.Height = .iHeight
                                optFV.Width = .iWidth
                                optFV.Left = .iLeft
                                optFV.Top = .iTop
                                optFV.Tag = .cControl
                            Case "butOK"
                                butOK.Visible = True
'                                butOK.Height = .iHeight
'                                butOK.Width = .iWidth
                                butOK.Left = Me.Width - butOK.Width - butCancel.Width - iLblLeft * 2
                                butOK.Top = Me.Height - butOK.Height * 1.5 - iLblLeft * 2
                            Case "butCancel"
                                butCancel.Visible = True
'                                butCancel.Height = .iHeight
'                                butCancel.Width = .iWidth
                                butCancel.Left = Me.Width - butCancel.Width - iLblLeft
                                butCancel.Top = Me.Height - butCancel.Height * 1.5 - iLblLeft * 2
                       End Select
                    End With
                Next i
            End If
        End With
    End With
    
    Exit Property
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (ObjectDataSprav)"
    Resume Next

End Property
Private Sub butCancel_Click()
    Set colValues = New Collection
'   Unload Me
    Me.Hide
End Sub

Private Sub butOK_Click()
    Dim ctl As Control
    Dim i As Long
    Dim cVal As String
    Dim iMax As Integer
    
    On Error GoTo errHandler
    
'    If Not (colValues Is Nothing) Then
'        For i = 1 To colValues.Count
'            colValues.Remove (Val(i))
'        Next i
'    End If
    Set colValues = New Collection
    
    For Each ctl In Me.Controls
        If TypeName(ctl) = "ComboBox" Or TypeName(ctl) = "ListBox" Then
            If ctl.Visible = True Then   ' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                iMax = Me.Controls(ctl.Name).ColumnCount
                For i = 1 To iMax
                    If Me.Controls(ctl.Name).Enabled = True Then
                        Me.Controls(ctl.Name).BoundColumn = i
                        cVal = Me.Controls(ctl.Name).Value
                    Else
                        cVal = ""
                    End If
                    Select Case i
                        Case 1
                            colValues.Add Item:=cVal, key:="Kod_" & ctl.Tag
                        Case 2
                            colValues.Add Item:=cVal, key:="Name_" & ctl.Tag
                        Case 3
                            colValues.Add Item:=cVal, key:="Col3_" & ctl.Tag
                    End Select
                Next i
            End If
        End If
        
        If TypeName(ctl) = "OptionButton" Then
            If ctl.Visible = True Then   ' |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                colValues.Add Item:=Me.Controls(ctl.Name).Value, key:=ctl.Tag
            End If
        End If
    Next ctl
    
    Me.Hide
    
    Exit Sub
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (cmdOK_Click)"
    Resume Next
End Sub

Private Sub optFR_Click()

    Me.listKLD.Enabled = False
    Me.listFKR.Enabled = False
    Me.listSGU.Enabled = False
    Me.listIFR.Enabled = True
    Me.listIFV.Enabled = False
    Me.listKLD.ListIndex = -1
    Me.listFKR.ListIndex = -1
    Me.listSGU.ListIndex = -1
    Me.listIFR.ListIndex = 0
    Me.listIFV.ListIndex = -1
    Me.Repaint
    
End Sub

Private Sub optFV_Click()

    Me.listKLD.Enabled = False
    Me.listFKR.Enabled = False
    Me.listSGU.Enabled = False
    Me.listIFR.Enabled = False
    Me.listIFV.Enabled = True
    Me.listKLD.ListIndex = -1
    Me.listFKR.ListIndex = -1
    Me.listSGU.ListIndex = -1
    Me.listIFR.ListIndex = -1
    Me.listIFV.ListIndex = 0
    Me.Repaint

End Sub

Private Sub optR125_Click()
    Me.listFKR.Enabled = True
    Me.listSGU.Enabled = True
    Me.listIFR.Enabled = False
    Me.listIFV.Enabled = False
    Me.listFKR.ListIndex = 0
    Me.listSGU.ListIndex = 0
    Me.listIFR.ListIndex = -1
    Me.listIFV.ListIndex = -1
    Me.Repaint

End Sub

Private Sub UserForm_Activate()

    If Me.ObjectName = "KBK129" Then
        Me.optD.Value = True
        Me.listKLD.Enabled = True
        Me.listFKR.Enabled = False
        Me.listSGU.Enabled = False
        Me.listIFR.Enabled = False
        Me.listIFV.Enabled = False
        Me.listKLD.ListIndex = 0
        Me.listFKR.ListIndex = -1
        Me.listSGU.ListIndex = -1
        Me.listIFR.ListIndex = -1
        Me.listIFV.ListIndex = -1
    End If

End Sub

Private Sub optD_Click()
    Me.listKLD.Enabled = True
    Me.listFKR.Enabled = False
    Me.listSGU.Enabled = False
    Me.listIFR.Enabled = False
    Me.listIFV.Enabled = False
    Me.listKLD.ListIndex = 0
    Me.listFKR.ListIndex = -1
    Me.listSGU.ListIndex = -1
    Me.listIFR.ListIndex = -1
    Me.listIFV.ListIndex = -1
    Me.Repaint
    
End Sub

Private Sub optR_Click()
    Me.listKLD.Enabled = False
    Me.listFKR.Enabled = True
    Me.listSGU.Enabled = True
    Me.listIFR.Enabled = False
    Me.listIFV.Enabled = False
    Me.listKLD.ListIndex = -1
    Me.listFKR.ListIndex = 0
    Me.listSGU.ListIndex = 0
    Me.listIFR.ListIndex = -1
    Me.listIFV.ListIndex = -1
    Me.Repaint
    
End Sub

Private Sub UserForm_Initialize()
    Me.IsUnload = False
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    If Me.IsUnload = True Then
        Cancel = 0
    Else
        Cancel = 1
        Set colValues = New Collection
        Me.Hide
    End If
End Sub
Attribute VB_Name = "mdActualForma"
Public objCreateGr As Object
Public Function InsertRangeToSheet(ByVal sNameRange As String) As Long
    
    InsertRangeToSheet = -1

End Function

'*************************** |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| 11/03/2015
'***************************             |fffd||fffd||fffd||fffd||fffd|        *******************************
Public Function HasName(sName As String) As Boolean
Dim R As Range
On Error Resume Next
Set R = Range(sName)
If R Is Nothing Then HasName = False Else HasName = True
Set R = Nothing
End Function

'*************************** |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| 11/03/2015
Public Function StrEl(ByVal sF As String, Optional n As Integer, Optional ByVal sR As String = ",") As String
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| n |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| =0 |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Dim s As String, s1$, s2$
sF = Trim$(sF)
For i = 1 To Len(sF)
    s = Mid$(sF, i, 1)
    If s = sR Then
        If Len(s1) <> 0 And Right$(s1, 1) <> sR And Len(sF) <> i Then
                             k = k + 1
                             If k = n Then s2 = s1
                             s1 = ""
        End If
    Else
        s1 = s1 & s
    End If
Next i
If k > 0 Then k = k + 1
If k = n Then s2 = s1
If k = 0 And Len(s1) > 0 Then
    k = 1
    If n = 1 Then s2 = s1
End If
If n = 0 Then StrEl = Str(k) Else StrEl = Trim$(s2)
End Function


Public Function SheetVarForm()

    Dim sprNameRange As String
    Dim MyRange As String
    Dim ColBegin As Long
    Dim vR As Range
    
    sprNameRange = "Data_Spr1"
    MyRange = "Data_Sheet1"
    ColBegin = 2
    
'  '  vR = 5 / 0
'    sNameRange = "Data_Sheet1"
    On Error Resume Next
    Set vR = ActiveWorkbook.Application.Range(sprNameRange)
''
    If Not (vR Is Nothing) Then
'        SheetVarForm = AddRowsFromRange(sprNameRange, MyRange, ColBegin)
            SheetVarForm = fRasstMain
            Application.Sheets(1).Activate
    Else
        SheetVarForm = 0    ' |fffd||fffd||fffd||fffd||fffd||fffd|
    End If
 '    SheetVarForm = -1

End Function
Public Sub CreateCells(Row As Integer, sKod As String)
' |fffd||fffd||fffd||fffd||fffd||fffd|3 |fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 12.09.2006 (Mi)
'
    
        If Application.Worksheets("|fffd||fffd||fffd||fffd|1").ProtectContents = True Then
            Application.Worksheets("|fffd||fffd||fffd||fffd|1").Unprotect Password:=objSvod.PasswordName
        End If
    
        '|fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd|
            Range("Data_Sheet01").Cells(Row - 29, 2).Value = Mid(sKod, 4, 3)
        '|fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
            Range("Data_Sheet01").Cells(Row - 29, 3).Value = Mid(sKod, 7, 10)
        '|fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd|
            Range("Data_Sheet01").Cells(Row - 29, 4).Value = Mid(sKod, 17, 4)
           
    
    End Sub
Public Sub CreateCells1(Row As Integer, sKod As String)
' |fffd||fffd||fffd||fffd||fffd||fffd|3 |fffd||fffd||fffd||fffd||fffd||fffd|
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 12.09.2006 (Mi)
'
    
        If Application.Worksheets("|fffd||fffd||fffd||fffd|1").ProtectContents = True Then
            Application.Worksheets("|fffd||fffd||fffd||fffd|1").Unprotect Password:=objSvod.PasswordName
        End If
    
        '|fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd|
            Range("Data_Sheet02").Cells(Row - 31, 2).Value = Mid(sKod, 4, 4)
        '|fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd|
            Range("Data_Sheet02").Cells(Row - 31, 3).Value = Mid(sKod, 8, 7)
        '|fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd|
            Range("Data_Sheet02").Cells(Row - 31, 4).Value = Mid(sKod, 15, 3)
           
    
    End Sub

Public Function FItogo() As Long

    On Error GoTo errHandler
    
    Dim txt As String, lCreateCurs$, lCreateGr1$, lCreateGr2$, cTitle$, cDataGr$, cDataItog$, cDataItog1$, cNamePrg$
    Dim n As Variant, i%, k%, lRows%, lCount%, j%, Row%
    Dim arr() As Variant, arrC() As Variant, arrGr() As Variant
    Dim lRange As Range, lRangeI As Range
    Dim oApp As Object
    Dim lSaved As Boolean
    
    lSaved = ActiveWorkbook.Saved
    Set objCreateGr = CreateObject("rascrtgr.clsCreateGroup")

    'Application.Run (ActiveWorkbook.Name!fItogoGr)
        
    cTitle = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
'    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'    fUnProtect True
'    n = fCreateCurs
'    fUnProtect False
    If Application.Visible Then
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        If Not HasName("DSItog1") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| DSItog1"): Exit Function
        If Not HasName("DSItog2") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| DSItog2"): Exit Function
        If Not HasName("DSItog3") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| DSItog3"): Exit Function
        If Not HasName("DSItog4") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| DSItog4"): Exit Function
        If Not HasName("DSItog5") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| DSItog5"): Exit Function
        If Not HasName("Itog1") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Itog1"): Exit Function
        If Not HasName("Itog2") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Itog2"): Exit Function
        If Not HasName("Itog3") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Itog3"): Exit Function
        If Not HasName("Itog4") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Itog4"): Exit Function
        If Not HasName("Itog5") Then MsgBox ("|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Itog5"): Exit Function
    End If
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      cDataGr = "Data_Group"
      
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    For j = 1 To 5
    
      If j = 1 Then
        cDataItog = "DSItog1"
        cDataItog1 = "Itog1"
        cNamePrg = "fGetItog1"
        lCreateGr1 = "SELECT SUM(s2) as s2, '130200' as s1,'' as s3, SUM(s4) as s4, SUM(s5) as s5, '' as s6, '' as s7, SUM(s8) as s8, SUM(s9) as s9 FROM curItog  WHERE  SUBSTR(s1, 2, 3)='302' INTO CURSOR curItog1 "
        lCreateGr2 = "SELECT s1,s2,s3,s4,s5,s6,s7,s8,s9 FROM curItog1  INTO ARRAY this.arrGr"
      End If
      If j = 2 Then
        cDataItog = "DSItog2"
        cDataItog1 = "Itog2"
        cNamePrg = "fGetItog2"
        lCreateGr1 = "SELECT SUM(s2) as s2, '130300' as s1,'' as s3, SUM(s4) as s4, SUM(s5) as s5, '' as s6, '' as s7, SUM(s8) as s8, SUM(s9) as s9 FROM curItog  WHERE  SUBSTR(s1, 2, 3)='303' INTO CURSOR curItog1 "
        lCreateGr2 = "SELECT s1,s2,s3,s4,s5,s6,s7,s8,s9 FROM curItog1  INTO ARRAY this.arrGr"
      End If
      If j = 3 Then
        cDataItog = "DSItog3"
        cDataItog1 = "Itog3"
        cNamePrg = "fGetItog3"
        lCreateGr1 = "SELECT SUM(s2) as s2, '130400' as s1,'' as s3, SUM(s4) as s4, SUM(s5) as s5, '' as s6, '' as s7, SUM(s8) as s8, SUM(s9) as s9 FROM curItog  WHERE  SUBSTR(s1, 2, 3)='304' INTO CURSOR curItog1 "
        lCreateGr2 = "SELECT s1,s2,s3,s4,s5,s6,s7,s8,s9 FROM curItog1  INTO ARRAY this.arrGr"
      End If
      If j = 4 Then
        cDataItog = "DSItog4"
        cDataItog1 = "Itog4"
        cNamePrg = "fGetItog4"
        lCreateGr1 = "SELECT SUM(s2) as s2, '120500' as s1,'' as s3, SUM(s4) as s4, SUM(s5) as s5, '' as s6, '' as s7, SUM(s8) as s8, SUM(s9) as s9 FROM curItog  WHERE  SUBSTR(s1, 2, 3)='205' INTO CURSOR curItog1 "
        lCreateGr2 = "SELECT s1,s2,s3,s4,s5,s6,s7,s8,s9 FROM curItog1  INTO ARRAY this.arrGr"
      End If
      If j = 5 Then
        cDataItog = "DSItog5"
        cDataItog1 = "Itog5"
        cNamePrg = "fGetItog5"
        lCreateGr1 = "SELECT SUM(s2) as s2, '120800' as s1,'' as s3, SUM(s4) as s4, SUM(s5) as s5, '' as s6, '' as s7, SUM(s8) as s8, SUM(s9) as s9 FROM curItog  WHERE  SUBSTR(s1, 2, 3)='208' INTO CURSOR curItog1 "
        lCreateGr2 = "SELECT s1,s2,s3,s4,s5,s6,s7,s8,s9 FROM curItog1  INTO ARRAY this.arrGr"
      End If
      
'      cDataGr = sGetINI(cDataItog & ".DataGr", "?")
'      If cDataGr = "?" Then
'          n = MsgBox("|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| lnc2.ini (DataGr)", vbOKOnly, cTitle)
'          GoTo errHandler
'      End If
      
      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
      lCreateCurs = "create cursor curItog (s1 C(5),s2 F(16,2),s3 C(7),s4 F(16,2),s5 F(16,2),s6 C(200),s7 C(200),s8 F(16,2),s9 F(16,2) )"
'      lCreateCurs = sGetINI(cDataItog & ".CreateCurs", "?")
'      If lCreateCurs <> "?" Then
          n = objCreateGr.CreateCursor(lCreateCurs)
          If Not IsNumeric(n) And Application.Visible Then
              n = MsgBox(objCreateGr.cErrorTextMessage, vbOKOnly, cTitle)
              GoTo errHandler
          End If
'      End If
    
      lCreateCurs = "1,2,3,4,5,6,7,8,9"

'      lCreateCurs = sGetINI(cDataItog & ".CreateArray", "?")   '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
      If lCreateCurs <> "?" Then
          n = Val(StrEl(lCreateCurs))
          'ReDim arr(0, 1 To n)
          
          ' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
          ReDim arrC(n)
          For i = 1 To n
              arrC(i) = Val(StrEl(lCreateCurs, i))
          Next i
          
          Set lRange = ActiveWorkbook.Application.Range(cDataGr)
          lRows = lRange.Rows.Count
          '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          lCount = 0
          For i = 1 To lRows   '|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
              If Trim(Len(lRange.Cells(i, 1))) <> 0 Then
                  lCount = lCount + 1
              End If
          Next i
          ReDim arr(1 To lCount, 1 To n)
          'Dim arr(1 To lCount, 1 To n)
         
          ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|  |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          lCount = 0
          For i = 1 To lRows   '|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
              If Trim(Len(lRange.Cells(i, 1))) <> 0 Then
                  lCount = lCount + 1
                  For k = 1 To n  '|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                      If IsEmpty(lRange.Cells(i, arrC(k))) Then
                        arr(lCount, k) = 0 '25.01.2011
                     Else
                        arr(lCount, k) = lRange.Cells(i, arrC(k)) '25.01.2011
                      End If
                  Next k
              End If
          Next i
      End If
      
      ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|c|fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
      If lCount > 0 Then
          n = objCreateGr.GetArrayToCursor(arr)
          If Not IsNumeric(n) And Application.Visible Then
              n = MsgBox(objCreateGr.cErrorTextMessage, vbOKOnly, cTitle)
              GoTo errHandler
          End If
      End If
      
'      lCreateGr1 = sGetINI(cDataItog & ".CreateGroup1", "?")
'      If lCreateGr1 = "?" Then
'          GoTo errHandler
'      End If
'      lCreateGr2 = sGetINI(cDataItog & ".CreateGroup2", "?")
'      If lCreateGr2 = "?" Then
'          GoTo errHandler
'      End If
      
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      n = objCreateGr.CreateGroupCursor169(lCreateGr1, lCreateGr2)
      If Not IsNumeric(n) And Application.Visible Then
          n = MsgBox(objCreateGr.cErrorTextMessage, vbOKOnly, cTitle)
          GoTo errHandler
      End If
      
      'Call objCreateGr.SetArray(byref arr)
      
'      If IsArray(objCreateGr.arrGr) Then
'          n = 10
'      End If
      
     fUnProtect True
     Application.ScreenUpdating = False
      
    '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
      'Set lRangeI = ActiveWorkbook.Application.Range(cDataItog)
      Set lRangeI = Range(cDataItog1)
     lRangeI.Cells(1, 1) = ""
     lRangeI.Cells(1, 2) = 0
     
'    'Set r = Range("DSItog1")
'      If lRangeI.Rows.Count > 2 Then
'         Row = lRangeI.Row '1-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'         i = Row + lRangeI.Rows.Count - 1 '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'         Rows(Row + 1 & ":" & i - 1).Delete Shift:=xlUp
'      End If
        
'     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'       'Set lRangeI = ActiveWorkbook.Application.Range(cDataItog)
'       For i = 1 To n - 2
'            lCount = lRangeI.Rows.Count
'            lRangeI.Cells(lCount, 1).EntireRow.Insert Shift:=xlShiftDown
'        Next i
      
      ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
      Set oApp = ActiveWorkbook.Application
      Call objCreateGr.GetObjectApp(oApp, "!" & cNamePrg, cDataItog1)
      If Not IsNumeric(objCreateGr.vReturt) And Application.Visible Then
          n = MsgBox(objCreateGr.cErrorTextMessage, vbOKOnly, cTitle)
          GoTo errHandler
      End If
      
      Application.ScreenUpdating = True
      fUnProtect False
      ActiveWorkbook.Saved = lSaved
      
  Next j
    
    
Exit Function

errHandler:
    'F169ItogoN = objCreateGr.cErrorTextMessage
    FItogo = 0
End Function


Public Function fGetItog1() As Variant

Dim i%, j%, nRows%, nRowDS%
Dim RangeItog As Range, RangeItog1 As Range
Dim cKod$
Dim lPrint As Boolean
    
     Set RangeItog = Range("DSItog1")
     Set RangeItog1 = Range("Itog1")
     
     '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
     RangeItog(1, 1) = 0
     RangeItog(1, 2) = ""
     RangeItog(1, 3) = 0
     RangeItog(1, 4) = 0
     RangeItog(1, 5) = ""
     RangeItog(1, 6) = ""
     RangeItog(1, 7) = 0
     If IsNumeric(RangeItog1.Cells(1, 2)) Then
        RangeItog(1, 1) = RangeItog1.Cells(1, 2)
        Range("ss1302a").Value = RangeItog1.Cells(1, 2)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 3) = RangeItog1.Cells(1, 4)
        Range("ss1302c").Value = RangeItog1.Cells(1, 4)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 4) = RangeItog1.Cells(1, 5)
        Range("ss1302d").Value = RangeItog1.Cells(1, 5)
     End If
     If IsNumeric(RangeItog1.Cells(1, 8)) Then
        RangeItog(1, 7) = RangeItog1.Cells(1, 8)
        Range("ss1302g").Value = RangeItog1.Cells(1, 8)
     End If
     If IsNumeric(RangeItog1.Cells(1, 9)) Then
        RangeItog(1, 8) = RangeItog1.Cells(1, 9)
        Range("ss1302h").Value = RangeItog1.Cells(1, 9)
     End If
    
End Function

Public Function fGetItog2() As Variant

Dim i%, j%, nRows%, nRowDS%
Dim RangeItog As Range, RangeItog1 As Range
Dim cKod$
Dim lPrint As Boolean
    
     Set RangeItog = Range("DSItog2")
     Set RangeItog1 = Range("Itog2")
     
     '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
     RangeItog(1, 1) = 0
     RangeItog(1, 2) = ""
     RangeItog(1, 3) = 0
     RangeItog(1, 4) = 0
     RangeItog(1, 5) = ""
     RangeItog(1, 6) = ""
     RangeItog(1, 7) = 0
     If IsNumeric(RangeItog1.Cells(1, 2)) Then
        RangeItog(1, 1) = RangeItog1.Cells(1, 2)
        Range("ss1303a").Value = RangeItog1.Cells(1, 2)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 3) = RangeItog1.Cells(1, 4)
        Range("ss1303c").Value = RangeItog1.Cells(1, 4)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 4) = RangeItog1.Cells(1, 5)
        Range("ss1303d").Value = RangeItog1.Cells(1, 5)
     End If
     If IsNumeric(RangeItog1.Cells(1, 8)) Then
        RangeItog(1, 7) = RangeItog1.Cells(1, 8)
        Range("ss1303g").Value = RangeItog1.Cells(1, 8)
     End If
     If IsNumeric(RangeItog1.Cells(1, 9)) Then
        RangeItog(1, 8) = RangeItog1.Cells(1, 9)
        Range("ss1303h").Value = RangeItog1.Cells(1, 9)
     End If

End Function

Public Function fGetItog3() As Variant

Dim i%, j%, nRows%, nRowDS%
Dim RangeItog As Range, RangeItog1 As Range
Dim cKod$
Dim lPrint As Boolean
    
     Set RangeItog = Range("DSItog3")
     Set RangeItog1 = Range("Itog3")
     
     '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
     RangeItog(1, 1) = 0
     RangeItog(1, 2) = ""
     RangeItog(1, 3) = 0
     RangeItog(1, 4) = 0
     RangeItog(1, 5) = ""
     RangeItog(1, 6) = ""
     RangeItog(1, 7) = 0
     If IsNumeric(RangeItog1.Cells(1, 2)) Then
        RangeItog(1, 1) = RangeItog1.Cells(1, 2)
        Range("ss1304a").Value = RangeItog1.Cells(1, 2)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 3) = RangeItog1.Cells(1, 4)
        Range("ss1304c").Value = RangeItog1.Cells(1, 4)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 4) = RangeItog1.Cells(1, 5)
        Range("ss1304d").Value = RangeItog1.Cells(1, 5)
     End If
     If IsNumeric(RangeItog1.Cells(1, 8)) Then
        RangeItog(1, 7) = RangeItog1.Cells(1, 8)
        Range("ss1304g").Value = RangeItog1.Cells(1, 8)
     End If
     If IsNumeric(RangeItog1.Cells(1, 9)) Then
        RangeItog(1, 8) = RangeItog1.Cells(1, 9)
        Range("ss1304h").Value = RangeItog1.Cells(1, 9)
     End If
     
End Function
Public Function fGetItog4() As Variant

Dim i%, j%, nRows%, nRowDS%
Dim RangeItog As Range, RangeItog1 As Range
Dim cKod$
Dim lPrint As Boolean
    
     Set RangeItog = Range("DSItog4")
     Set RangeItog1 = Range("Itog4")
     
     '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
     RangeItog(1, 1) = 0
     RangeItog(1, 2) = ""
     RangeItog(1, 3) = 0
     RangeItog(1, 4) = 0
     RangeItog(1, 5) = ""
     RangeItog(1, 6) = ""
     RangeItog(1, 7) = 0
     If IsNumeric(RangeItog1.Cells(1, 2)) Then
        RangeItog(1, 1) = RangeItog1.Cells(1, 2)
        Range("ss1205a").Value = RangeItog1.Cells(1, 2)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 3) = RangeItog1.Cells(1, 4)
        Range("ss1205c").Value = RangeItog1.Cells(1, 4)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 4) = RangeItog1.Cells(1, 5)
        Range("ss1205d").Value = RangeItog1.Cells(1, 5)
     End If
     If IsNumeric(RangeItog1.Cells(1, 8)) Then
        RangeItog(1, 7) = RangeItog1.Cells(1, 8)
        Range("ss1205g").Value = RangeItog1.Cells(1, 8)
     End If
     If IsNumeric(RangeItog1.Cells(1, 9)) Then
        RangeItog(1, 8) = RangeItog1.Cells(1, 9)
        Range("ss1205h").Value = RangeItog1.Cells(1, 9)
     End If
     
End Function

Public Function fGetItog5() As Variant

Dim i%, j%, nRows%, nRowDS%
Dim RangeItog As Range, RangeItog1 As Range
Dim cKod$
Dim lPrint As Boolean
    
     Set RangeItog = Range("DSItog5")
     Set RangeItog1 = Range("Itog5")
     
     '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
     RangeItog(1, 1) = 0
     RangeItog(1, 2) = ""
     RangeItog(1, 3) = 0
     RangeItog(1, 4) = 0
     RangeItog(1, 5) = ""
     RangeItog(1, 6) = ""
     RangeItog(1, 7) = 0
     If IsNumeric(RangeItog1.Cells(1, 2)) Then
        RangeItog(1, 1) = RangeItog1.Cells(1, 2)
        Range("ss1208a").Value = RangeItog1.Cells(1, 2)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 3) = RangeItog1.Cells(1, 4)
        Range("ss1208c").Value = RangeItog1.Cells(1, 4)
     End If
     If IsNumeric(RangeItog1.Cells(1, 4)) Then
        RangeItog(1, 4) = RangeItog1.Cells(1, 5)
        Range("ss1208d").Value = RangeItog1.Cells(1, 5)
     End If
     If IsNumeric(RangeItog1.Cells(1, 8)) Then
        RangeItog(1, 7) = RangeItog1.Cells(1, 8)
        Range("ss1208g").Value = RangeItog1.Cells(1, 8)
     End If
     If IsNumeric(RangeItog1.Cells(1, 9)) Then
        RangeItog(1, 8) = RangeItog1.Cells(1, 9)
        Range("ss1208h").Value = RangeItog1.Cells(1, 9)
     End If
     
End Function


Public Sub fUnProtect(fl As Boolean, Optional id As Integer = 0)
On Error Resume Next
If id = 0 Then id = ActiveSheet.Index
With ActiveWorkbook.Worksheets(id)
If .ProtectContents = True And fl = True Then .Unprotect "rassvet"
If .ProtectContents = False And fl = False Then
    If Val(Application.Version) < 10 Then
        .Protect "rassvet"
    Else
        .Protect "rassvet", AllowFormattingColumns:=True
    End If
End If
End With
End Sub


Attribute VB_Name = "mdLib"
''''''''''''''''''''''''''''''''''''''''''''
'**** Version 28.07.2005 *******************
''''''''''''''''''''''''''''''''''''''''''''
Option Explicit

Public objSvod As Object
Public objSprForms As Object
Public Const RangeRek As String = "Data_Cells"
Public strNameCell As String
Public colValues As Collection
Public FormSpr As Object
Public Const cKod = "Kod_"
Public Const cName = "Name_"
Public Const cData = "Data_"


Public Function IsSvod() As Boolean
    IsSvod = True
End Function

Public Sub ConstForm()
Attribute ConstForm.VB_Description = "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 17.05.2004 (nekrasova)"
Attribute ConstForm.VB_ProcData.VB_Invoke_Func = " \n14"
    Dim tRange As Range
    Dim strTemp As String
    Dim strSheet As String
    Dim i As Long
    Dim j, n As Long
    
'
' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 02.06.2004 |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| (BALANS)
'
'   |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| Excel |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|:
'               1. |fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'               2. |fffd||fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'
'   |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "ss"+|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|+"|fffd|"..."|fffd|"
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| (|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
'

' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    Set tRange = Application.Selection
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    strSheet = Application.ActiveSheet.Name
'
'   tRange.Rows.Count- |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'   tRange.Columns.Count |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'
    For i = 1 To tRange.Rows.Count
        For j = 2 To tRange.Columns.Count
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| "ss"+|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|+"a"
            strTemp = Mid$(tRange.Cells(i, j).Address, 2, 1)
            Range(strTemp & (i + tRange.Row - 1) & ":" & strTemp & (i + tRange.Row - 1)).Select
            ActiveWorkbook.Names.Add Name:="ss" & tRange.Cells(i, 1) & Chr(95 + j), RefersToR1C1:="=" & strSheet & "!R" & Selection.Row & "C" & Selection.Column
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
                   n = Range("Data_Cells").Rows.Count
                   Range("Data_Cells").Cells(n, 1).EntireRow.Insert Shift:=xlShiftDown
                   Range("Data_Cells").Cells(n, 1).Value = "ss" & tRange.Cells(i, 1) & Chr(95 + j)
                   Range("Data_Cells").Cells(n, 2).Value = "F"
         Next
    Next
    
    
'    Range("G3:G4").Select
'    ActiveWorkbook.Names.Add Name:="ss0630a", RefersToR1C1:="=|fffd||fffd||fffd||fffd|2!R3C7"
End Sub
Public Function VarForm() As Long
'' |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 15.07.2005

'    Dim sNameRange As String, sNameSpr As String
'    Dim vR As Range
'  '  vR = 5 / 0
'    sNameRange = "Data_Sheet1"
   On Error Resume Next
'    Set vR = ActiveWorkbook.Application.Range(sNameRange)
'
'     If vR Is Nothing Then
'        VarForm = -1
'     Else
'        VarForm = InsertRangeToSheet(sNameRange)
'     End If
     VarForm = SheetVarForm()
     SetFormula
     FItogo

'    Application.Calculate
End Function
     
Private Sub SetFormula()
    Range("Naim_STOPdata").FormulaLocal = "=SetStrData(A2;Kod_STOPdata)"
    Range("Naim_STOPdata").Calculate
    
    Range("Naim_MODdata").FormulaLocal = "=SetStrData(A2;Kod_MODdata)"
    Range("Naim_MODdata").Calculate
'    ActiveCell.FormulaLocal = "=SetStrData(B5;Kod_STOPdata)"
End Sub

Public Sub ChangeFormatCells(ByVal NameRange As String, ByVal SpravEI As Integer, ByVal Col As Integer)
 '
    Dim nRows, i As Integer
    Dim strFormat As String
    Dim strNameCell As String
    Dim strNameList As String
    
    Application.ScreenUpdating = False
  
      Select Case Col
          Case 0
            strFormat = "0"
          Case 1
            strFormat = "0.0"
          Case 2
            strFormat = "0.00"
          Case 3
           strFormat = "0.000"
          Case 4
           strFormat = "0.0000"
     End Select
'   nrows - |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
    nRows = Range(NameRange).Rows.Count
'
    For i = 1 To nRows
        strNameCell = Range(NameRange).Cells(i, 1)
        If Range(NameRange).Cells(i, 5) = SpravEI And _
           Left(Range(NameRange).Cells(i, 1).Value, 2) = "ss" Then
           If Range(NameRange).Cells(i, 3) <> Col Then
             Range(NameRange).Cells(i, 3) = Col
              strNameList = ActiveSheet.Name
              Sheets(Range(strNameCell).Worksheet.Name).Select
              Range(strNameCell).Select
              Selection.NumberFormat = strFormat
'              Range(strNameCell) = Round(Range(strNameCell))
'                Call RoundCells(strNameCell)
              Sheets(strNameList).Activate
           End If
           
       End If
    Next i
        Range("Name_OTD").Activate
        Application.ScreenUpdating = True
End Sub



Public Function SetStrData(ByVal sVoise As Range, ByVal sNameRange As Range) As String

'    Dim objSvod As Object
'    Set objSvod = CreateObject("rasExRng.clsWork")
    If Application.ScreenUpdating Then
        SetStrData = objSvod.setdataname(CStr(sVoise), CDate(sNameRange))
    End If
'    Set objSvod = Nothing

End Function
 Public Sub ProtectXlt()
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim Sheet As Object
    
'    On Error Resume Next
    Application.ScreenUpdating = False
    
    For Each Sheet In Worksheets
        If Sheet.ProtectContents = False Then
            If Val(Application.Version) > 9 Then
                Sheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True _
                , AllowFormattingColumns:=True, AllowFormattingRows:=True, Password:=objSvod.PasswordName
            Else
                Sheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True, Password:=objSvod.PasswordName
            End If
        End If
    Next Sheet
    
   If ActiveWorkbook.ProtectStructure = False Then
        ActiveWorkbook.Protect Structure:=True, Windows:=False, Password:=objSvod.PasswordName
    End If
    
    Application.ScreenUpdating = True

End Sub
 Public Sub UnProtectXlt()
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim Sheet As Worksheet
    
    On Error Resume Next
    Application.ScreenUpdating = False
    
    ActiveWorkbook.Unprotect Password:=objSvod.PasswordName
    
    For Each Sheet In Worksheets
        If Sheet.ProtectContents = True Then
            Sheet.Unprotect Password:=objSvod.PasswordName
        End If
    Next Sheet
    
    Application.ScreenUpdating = True
    
End Sub
                               
Public Function OpenWorkbook() As Long

    On Error GoTo errHandler
    
    Set objSvod = CreateObject("rasExRng.clsWork")
    Set objSprForms = CreateObject("rasDS.DataSpravs")
    If objSprForms.iCodeError <> 0 Then
       MsgBox (objSprForms.cErrorTextMessage)
    End If
     
     Set FormSpr = New frmAddRow
     Load FormSpr
    
    If objSvod Is Nothing Or objSprForms.iCodeError <> 0 Then
        OpenWorkbook = 0    ' |fffd||fffd||fffd||fffd||fffd||fffd| OpenWorkbook
    Else
        OpenWorkbook = -1   ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    End If
    
    Exit Function
    
errHandler:
    OpenWorkbook = Err.Number
'    Application.Calculate
End Function
Public Sub CloseWorkbook()

    FormSpr.IsUnload = True
    Unload FormSpr
    Set objSvod = Nothing
    Set objSprForms = Nothing
    
End Sub
Public Function EmptySpr(ByVal NameSpr As String) As Boolean
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| True, |fffd||fffd||fffd||fffd| NameSpr |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| False

    If Range(NameSpr).Rows.Count <= 2 Then
        If IsEmpty(Range(NameSpr).Cells(1, 1)) Then
            EmptySpr = True
        Else
            EmptySpr = False
        End If
    Else
        EmptySpr = False
    End If
    
End Function
Public Function FoundIndex(ByVal NameSpr As String, ByVal cVal As String) As Long
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cVal |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| NameSpr,
'   |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 0

    Dim i As Long
    
    FoundIndex = 0
    For i = 1 To Range(NameSpr).Rows.Count
        If Trim(Range(NameSpr).Cells(i, 1).Value) = cVal Then
            FoundIndex = i - 1
            Exit For
        End If
    Next i
    
End Function

Public Sub IzmenEI(ByVal Old_izm As String, ByVal New_izm As String, ByVal sCol As String)

'
'  382 - |fffd||fffd||fffd||fffd||fffd|
'  383 - |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  384 - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'  385 - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|

            Select Case Old_izm
                Case 383  '  - |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                    Select Case New_izm
                        Case 382  '  - |fffd||fffd||fffd||fffd||fffd|
                            Call RoundCells("1", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                        Case 384, 385
                            Call RoundCells("1000", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
                Case 382
                    Select Case New_izm
                        Case 383
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                        Case 384, 385
                            Call RoundCells("1000", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
                Case 384
                    Select Case New_izm
                        Case 382, 383, 385
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
                 Case 385
                    Select Case New_izm
                        Case 384
                            Call RoundCells("1", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                        Case 383, 382
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
               Case Else
            End Select
   

End Sub
Public Sub RoundCells(ByVal sDel As String, ByVal sCol As String)
Dim Msg, Response, MyString, Style

    Dim nRows, i As Integer
    Dim strFormat As String
    Dim sNameCell As String
    Dim strNameList As String
    
'   nrows - |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
    nRows = Range(RangeRek).Rows.Count

    Application.ScreenUpdating = False
  
    Msg = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ?"
    Style = vbYesNo + vbCritical + vbDefaultButton2

     Response = MsgBox(Msg, Style)
        If Response = vbYes Then
            MyString = "Yes"
    For i = 1 To nRows
            sNameCell = Range(RangeRek).Cells(i, 1)
        If Left(Range(RangeRek).Cells(i, 1).Value, 2) = "ss" Then
              strNameList = ActiveSheet.Name
              Sheets(Range(sNameCell).Worksheet.Name).Select
              Range(sNameCell).Select
'
            If Left((Range(sNameCell).FormulaR1C1), 1) <> "=" Then
                  Range(sNameCell) = Round(Range(sNameCell) / sDel, sCol)
            End If
'
        End If
    Next i

        Else
            MyString = "No"
        End If
'
        Application.ScreenUpdating = True

End Sub


Public Sub VisibleNullStr(ByVal IsVisible As Boolean, _
                            ByRef objRange As Range, _
                            Optional ByVal lngColBeg As Long, _
                            Optional ByVal lngColEnd As Long)
                            
' |fffd| |fffd||fffd|.|fffd||fffd||fffd|. objRange |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| lngColBeg |fffd||fffd| lngColEnd

    Dim i As Long
    Dim j As Long
    
    Application.ScreenUpdating = False
   
    On Error GoTo errHandler
    
    With objRange
        If IsVisible Then
            For i = 1 To .Rows.Count
                Rows(i + .Row - 1).EntireRow.Hidden = False
'                Selection.
            Next
        Else
            For i = 1 To .Rows.Count
                For j = lngColBeg To lngColEnd
                    If .Cells(i, j) <> 0 Then
                        Exit For
                    End If
                Next
                If j > lngColEnd Then
                    Rows(i + .Row - 1).EntireRow.Hidden = True
              End If
            Next
        End If
    End With
    
    Exit Sub
    
errHandler:
    MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & vbCrLf & _
            "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|: " & Err.Number, vbOKOnly + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd|"
            
        Application.ScreenUpdating = True
End Sub

Public Sub AddRekv(ByVal ObjRekvs As Object)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim i As Long
    Dim sSprav As String
    Dim cKodR, cNameR, cCol3R As String
    Dim Old_EI, New_EI As String
    
    On Error GoTo errHandler
    
    Old_EI = Application.Range("Kod_EI").Cells(1, 1)
    
'    Set FormSpr = New frmAddRow
'    Load FormSpr
    Set FormSpr.ObjectDataSprav = ObjRekvs
    FormSpr.Repaint

    FormSpr.Show
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If colValues.Count <> 0 Then
       With ObjRekvs.SpravCollection
           If .Count > 0 Then
               For i = 1 To .Count
                   With .Item(Val(i))
                       If Not (.cControl Like "but*") Then
                           cKodR = cKod & .cSprav
                           cNameR = cName & .cSprav
                           Range(cKodR).Value = colValues.Item(cKodR)
                           Range(cNameR).Value = colValues.Item(cNameR)
                        End If
                        If .cSprav = "EI" Then
                            New_EI = Application.Range("Kod_EI").Cells(1, 1)
                            Call IzmenEI(Old_EI, New_EI, colValues.Item("Col3_EI"))
                        End If
                  End With
               Next i
           End If
       End With
     
    End If
 
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRekv)"
    Resume Next

End Sub

Public Sub AddRow(ByVal ObjRekvs As Object)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim i As Long
    Dim sSprav As String
    Dim cKodR, cNameR, cCol3R As String
    Dim Old_EI, New_EI As String
    
    On Error GoTo errHandler
    
    
'    Set FormSpr = New frmAddRow
'    Load FormSpr
    Set FormSpr.ObjectDataSprav = ObjRekvs
    
    FormSpr.Show
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If colValues.Count <> 0 Then
       With ObjRekvs.SpravCollection
           If .Count > 0 Then
               For i = 1 To .Count
                   With .Item(Val(i))
                       If Not (.cControl Like "but*") Then
                           cKodR = cKod & .cSprav
                           cNameR = cName & .cSprav
                           Range(cKodR).Value = colValues.Item(cKodR)
                           Range(cNameR).Value = colValues.Item(cNameR)
                        End If
                  End With
               Next i
           End If
       End With
     
    End If
 
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRekv)"
    Resume Next

End Sub

Public Sub AddRowToRange(ByVal KodRow As String, ByVal MyRange As String, ByVal ColBegin As Long)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ColBegin |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| KodRow
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Cells"

    Dim nRows As Integer
    Dim kod As String
    Dim sSheet As String
    Dim nColRange, nCountRange As Long
    Dim i As Long
    Dim j As Long
    Dim nRowRange As Integer
   
    On Error GoTo errHandler
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    sSheet = Application.ActiveSheet.Name
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange
    nColRange = Range(MyRange).Columns.Count
    nCountRange = Range(MyRange).Rows.Count
    
 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange
    For i = 1 To nCountRange
        If KodRow = Trim(Range(MyRange).Cells(i, ColBegin).Value) Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| " & KodRow & " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            Exit Sub
        End If
    Next i
     
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Range(MyRange).Cells(nCountRange, 1).EntireRow.Insert Shift:=xlShiftDown
    Range(MyRange).Cells(nCountRange, ColBegin).Value = KodRow
    i = 0
    For j = ColBegin + 1 To nColRange
       Range(MyRange).Cells(nCountRange, j).Select
       ActiveWorkbook.Names.Add Name:="ss" & KodRow & Chr(97 + i), RefersToR1C1:="=" & sSheet & "!R" & Selection.Row & "C" & Selection.Column
         
'    '  |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| j
'       objSvod.AutoFillColumn ActiveWorkbook, MyRange, j
                     
    '   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
    '   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
        nRowRange = Range("Data_Cells").Rows.Count
        Range("Data_Cells").Cells(nRowRange, 1).EntireRow.Insert Shift:=xlShiftDown
        Range("Data_Cells").Cells(nRowRange, 1).Value = "ss" & KodRow & Chr(97 + i)
        Range("Data_Cells").Cells(nRowRange, 2).Value = "F"
        Range("Data_Cells").Cells(nRowRange, 3).Value = "2"
        i = i + 1
    Next j
    
    Range(MyRange).Cells(nCountRange, ColBegin + 1).Select
    
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRowToRange)"
    Resume Next

End Sub
Public Sub RemoveNamesSS()
    Dim i As Long
    
    With ActiveWorkbook.Names
        For i = .Count To 1 Step -1
            If Left$(.Item(i).Name, 2) = "ss" Then
                .Item(i).Delete
            End If
        Next
    End With
End Sub

Attribute VB_Name = "|fffd||fffd||fffd||fffd|1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub cmbSaveAs_Click()
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    
    Dim NameFile As Variant
   
    NameFile = Application.GetSaveAsFilename(Application.ActiveWorkbook.Name, _
            "|fffd||fffd||fffd||fffd||fffd| Microsoft Ecxel (*.xls), *.xls", , _
            "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
    If NameFile <> False Then
        Application.ActiveWorkbook.SaveCopyAs Filename:=NameFile
    End If

End Sub

Private Sub cmbSelectRekvizit_Click()

    On Error GoTo errHandler
    
    Call UnProtectXlt
    
    Call AddRekv(objSprForms.Item("REKV1"))
    
    Call ProtectXlt
    
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (cmbSelectRekvizit_Click)"
    Resume Next
    
End Sub


Private Sub Worksheet_Activate()
On Error Resume Next
cmdBarsShow
End Sub

Attribute VB_Name = "|fffd||fffd||fffd||fffd|2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd|3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Workbook_BeforeSave(ByVal SaveAsUI As Boolean, Cancel As Boolean)
    
    FItogo
    
End Sub

Private Sub Workbook_Open()
On Error Resume Next
s = GetRegistrValue & "lnc2.xla"
Application.VBE.ActiveVBProject.References.AddFromFile s
Application.Run "lnc2.xla!fOpen"
Application.Run "lnc2.xla!cmdBarsShow"

Set CB = Application.CommandBars("|fffd||fffd||fffd||fffd|")
Set NB = CB.Controls.Add(msoControlButton)
NB.Caption = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|" 'Caption
NB.FaceId = 6 'FaceId
NB.Style = msoButtonIconAndCaption
NB.TooltipText = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|" 'IIf(Len(TooltipText) = 0, Caption, TooltipText)
NB.OnAction = "FItogo" 'OnAction

End Sub

Private Sub Workbook_BeforeClose(Cancel As Boolean)
    Dim i As Long
    
    FItogo
    
    
    With Application.VBE.ActiveVBProject.References
        For i = .Count To 1 Step -1
            If Right$(.Item(i).Name, 4) = "lnc2" Then
                Application.DisplayAlerts = True
                .Remove .Item(i)
                Exit For
            End If
        Next
    End With
End Sub

Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    On Error Resume Next
    
    Dim strName As String
    Dim strNameRange As String
    Dim i As Long
    Dim kodRekv As String
    Dim kodFKR As String
    
    Static blnChange As Boolean

    If blnChange Then
        blnChange = False
        Exit Sub
    End If
    strName = Target.Name
    If Len(strName) > 0 Then
        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        strNameRange = Application.Names(, , CStr(strName)).Name
        If Len(strNameRange) > 0 Then
            With Range("Data_Cells")
                For i = 1 To .Rows.Count
                    If .Cells(i, 1) = strNameRange Then
                        If .Cells(i, 2) = "F" Then
                            If (Len(CStr(CCur(Target) - Int(CCur(Target)))) - 2) > .Cells(i, 3) Then
                                MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & .Cells(i, 3) & " |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| ", vbOKOnly + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd|"
                            End If
                            blnChange = True
                            Target = Round(Target, .Cells(i, 3))
'                            Target.Activate
'                            Beep
                        End If
                        Exit For
                    End If
                Next
            End With
            '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| Spir 10/09/2015
'            If Right(strNameRange, 1) = "d" And (Mid(strNameRange, 3, 2) = "01" Or Mid(strNameRange, 3, 2) = "02") Then
            If Right(strNameRange, 1) = "e" Then

                If Not IsDate(Target.Value) Then
'                    blnChange1 = True
'                    Range(Left(strNameRange, Len(strNameRange) - 1) & "i").Value = 0
                    MsgBox "|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|.|fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|", vbCritical + vbOKOnly, "|fffd||fffd||fffd||fffd||fffd||fffd|"
                    blnChange = True
                    Target.Value = ""
                    Target.Select
                Else
                    blnChange = True
                    kodFKR = Format(Target.Value, "DD.MM.YYYY")
                    Target.Value = Mid(kodFKR, 4, 7)
                End If
             End If
        End If
        
        ''
    
    End If
End Sub


Private Sub Workbook_SheetSelectionChange(ByVal Sh As Object, ByVal Target As Range)
    Dim lcNameCell As String
    
    On Error Resume Next
    
'    lcNameCell = Target.Name
'    If Len(lcNameCell) > 0 Then
    If IsObject(goSvod) Then
         fStartFox
    End If
'     Else
'         fInitGrid
'     End If
End Sub




INQUEST-PP=macro
