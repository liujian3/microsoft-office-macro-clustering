Attribute VB_Name = "EstaPasta_de_trabalho"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True















Attribute VB_Name = "M|fffd|d1Calculadora"
'Declara|fffd||fffd|es API
Public Const MAX_STRING As Long = 128
Public Const REG_BINARY = 3&
Public Const REG_DWORD = 4&
Declare Function RegOpenKeyA Lib "ADVAPI32.DLL" (ByVal hkey As Long, ByVal sKey As String, ByRef plKeyReturn As Long) As Long
Declare Function RegQueryValueExA Lib "ADVAPI32.DLL" (ByVal hkey As Long, ByVal sValueName As String, ByVal dwReserved As Long, ByRef lValueType As Long, ByVal sValue As String, ByRef lResultLen As Long) As Long
Declare Function RegCloseKey Lib "ADVAPI32.DLL" (ByVal hkey As Long) As Long
Public Const HKEY_CLASSES_ROOT = &H80000000
Public Const HKEY_CURRENT_USER = &H80000001
Public Const HKEY_LOCAL_MACHINE = &H80000002

Declare Function apiGetSys Lib "user32" Alias "GetSystemMetrics" (ByVal nIndex As Long) As Long
Public Const SM_CXSCREEN = 0
Public Const SM_CYSCREEN = 1

Declare Function GetCursorPos Lib "user32" (lpPoint As POINTAPI) As Long
Type POINTAPI
   X As Long
   Y As Long
End Type

Declare Function sndPlaySound32 Lib "winmm.dll" Alias "sndPlaySoundA" (ByVal lpszSoundName As String, ByVal uFlags As Long) As Long
'uFlags can be one these value or a sum:
'&H0 - SND_SYNC - played synchronously (Not return until the sound ends)
'&H1 - SND_ASYNC - played asynchronously.
'&H2 - SND_NODEFAULT - if the sound cannot be found, the function returns silently without playing the default sound.
'&H8 - SND_LOOP - continue to play continuously until sndPlaySound is called again with the lpszSoundName$ parameter set to null. You must also specify the SND_ASYNC flag to loop sounds.
'&H10 - SND_NOSTOP - if a sound is currently playing, the function will immediately return False without playing the requested sound.

Public Const LOCALE_USER_DEFAULT& = &H400
Public Const LOCALE_SENGLANGUAGE = &H1001   'English name of language
Public Const LOCALE_SLANGUAGE = &H2   'localized name of language
Public Declare Function apiGetLocaleInfo Lib "kernel32" _
      Alias "GetLocaleInfoA" (ByVal Locale As Long, _
      ByVal LCType As Long, ByVal lpLCData As String, _
      ByVal cchData As Long) As Long

Public vEnableEvents As Boolean
Public vCloseMode As Integer

'Declara|fffd||fffd|es p|fffd|blicas para a calculadora
Public CalculadoraPosTop, CalculadoraPosLeft As Long
Public CalculadoraValorIni, CalculadoraValorAtu As String
Public CalculadoraNumDecim As Integer
Public CalculadoraPapel As Boolean   'Exibindo Papel
Public FitaPapel() As String
Public ValorNaMem As Double

Sub Calculadora()
   Rx = apiGetSys(SM_CXSCREEN)
   Ry = apiGetSys(SM_CYSCREEN)
   Dim Point As POINTAPI
   Result = GetCursorPos(Point)
   If Result <> 0 Then
      CalculadoraPosLeft = Point.X * 0.75 - 3
      RxM = Choose(-1 * (Rx < 800) - 2 * (Rx = 800) - 3 * (Rx > 800), 375, 495, 665)
      If CalculadoraPosLeft > RxM Then CalculadoraPosLeft = RxM
      CalculadoraPosTop = Point.Y * 0.75 - 127
      RyM = Choose(-1 * (Ry < 600) - 2 * (Ry = 600) - 3 * (Ry > 600), 140, 230, 360)
      If CalculadoraPosTop > RyM Then CalculadoraPosTop = RyM
   Else
      CalculadoraPosTop = 0
      CalculadoraPosLeft = 20
   End If
   CalculadoraValorIni = Workbooks("cpap_pri.mac").Sheets(1).Range("CalcVal").Value
   'CalculadoraNumDecim = Workbooks("cpap_pri.mac").Sheets(1).Range("CalcDec").Value
   CalculadoraNumDecim = 5   'Iniciar sempre com precis|fffd|o m|fffd|xima F, deixando quem chamou que resolva no retorno
   vCloseMode = 1
   UserFormCalculadora.Show
   'Unload |fffd| necess|fffd|rio para acionar evento_initialize no pr|fffd|xmimo show
   If vCloseMode = 1 Then Unload UserFormCalculadora
   If vCloseMode = 1 And CalculadoraValorAtu * 1 <> CalculadoraValorIni * 1 Then
      CalculadoraNumDecimRet = Workbooks("cpap_pri.mac").Sheets(1).Range("CalcDec").Value
      Workbooks("cpap_pri.mac").Sheets(1).Range("CalcVal").Value = Application.WorksheetFunction.Round(CalculadoraValorAtu, CalculadoraNumDecimRet)
      'Workbooks("cpap_pri.mac").Sheets(1).Range("CalcDec").Value = CalculadoraNumDecim
      Workbooks("cpap_pri.mac").Sheets(1).Range("CalcOK").Value = True
   End If
End Sub



'EVENTOS DE CAIXA DE TEXTO PARA VALOR FINANCEIRO

Sub EvValor_Cb_MouseMove(Valor_Cb As Control, ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
   Valor_Cb.Locked = False
End Sub

Sub EvValor_Cb_KeyDown(Valor_Cb As Control, ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
   sd = Application.International(xlDecimalSeparator)
   vKeyCode = IIf(sd = ",", 188, 190)
   Valor_Cb.Locked = False
   If KeyCode = 37 Or (Shift = 2 And KeyCode = 86) Or (Shift = 1 And KeyCode = 45) Or (Shift = 2 And KeyCode = 88) Then Exit Sub   'Seta Esquerda e teclas do clipboard
   If KeyCode = 110 Or KeyCode = 190 Then KeyCode = vKeyCode
   If KeyCode = 188 Then If InStr(1, Valor_Cb.Value, sd) > 0 Then Valor_Cb.Locked = True
   If (KeyCode >= 96 And KeyCode <= 105) Or (KeyCode >= 48 And KeyCode <= 57) Or KeyCode = 188 Or KeyCode = 8 Or KeyCode = 46 Then Else Valor_Cb.Locked = True
End Sub

Sub EvValor_Cb_Change(Valor_Cb As Control)
   I = Valor_Cb.Value
   j = Valor_Cb.SelStart
   PartInt = I
   sd = Application.International(xlDecimalSeparator)
   sm = Application.International(xlThousandsSeparator)
   k = InStr(1, Valor_Cb.Value, sd)
   If k > 0 Then
      PartFrac = Mid(I, k + 1, 100)
      PartFrac = Application.WorksheetFunction.Substitute(PartFrac, sm, "")
      PartInt = Mid(I, 1, k - 1)
      If PartInt = "" Then PartInt = "0"
   End If
   TamPartInt = Len(PartInt)
   PartInt = Application.WorksheetFunction.Substitute(PartInt, sm, "")
   PartInt = Format(PartInt, "#,##0")
   RepCurs = Len(PartInt) - TamPartInt
   Valor_Cb.Value = PartInt & IIf(PartInt = "" Or k = 0, "", sd) & PartFrac
   j = -(j + RepCurs) * (j + RepCurs >= 0)
   If Left(Valor_Cb.Value, 2) = "0" & sd And j < 3 Then j = 2
   Valor_Cb.SelStart = j

   'Evita colar texto
   Static ValorOld
   If Valor_Cb.Value <> "" And Not (IsNumeric(Valor_Cb.Value)) Then
      MsgBox Valor_Cb.Value, vbCritical, "Valor Inv|fffd|lido!"
      Valor_Cb.Value = ValorOld
   Else
      ValorOld = Valor_Cb.Value
   End If
End Sub

Sub EvValor_Cb_Exit(Valor_Cb As Control, Cancel As MSForms.ReturnBoolean, Formato As String)
   If Valor_Cb.Value = "" Then Valor_Cb.Value = 0
   If IsNumeric(Valor_Cb.Value) Then
      If Valor_Cb.Value <> Format(Valor_Cb.Value, Formato) Then Valor_Cb.Value = Format(Valor_Cb.Value, Formato)
   Else
      MsgBox "Data inv|fffd|lida!", vbCritical
      Cancel = True
   End If
End Sub
Attribute VB_Name = "M|fffd|d2Calend"
'Declara|fffd||fffd|es p|fffd|blicas para o calend|fffd|rio
Public CalendPosTop As Long, CalendPosLeft As Long
Public CalendDataIni
Public CalendDataAtu As Date
'Public CalendFecharArq As Boolean Parece n|fffd|o ser mais necess|fffd|rio

Public IsPortg As Boolean
Public WavFile As String

Sub Calend()

   IsPortg = True   'Application.International(xlCountryCode) = 55
   WavFile = ThisWorkbook.Path & "\SomMqCal.wav"

   Rx = apiGetSys(SM_CXSCREEN)
   Ry = apiGetSys(SM_CYSCREEN)
   Dim Point As POINTAPI
   Result = GetCursorPos(Point)
   If Result <> 0 Then
      CalendPosLeft = Point.X * 0.75
      RxM = Choose(-1 * (Rx < 800) - 2 * (Rx = 800) - 3 * (Rx > 800), 355, 475, 645)
      If CalendPosLeft > RxM Then CalendPosLeft = RxM
      CalendPosTop = Point.Y * 0.75 - 65
      RyM = Choose(-1 * (Ry < 600) - 2 * (Ry = 600) - 3 * (Ry > 600), 210, 300, 420)
      If CalendPosTop > RyM Then CalendPosTop = RyM
   Else
      CalendPosTop = 0
      CalendPosLeft = 20
   End If
   CalendDataIni = Workbooks("cpap_pri.mac").Sheets(1).Range("CalendVal").Value
   If CalendDataIni = Empty Then CalendDataIni = 0 'Date
   If IsDate(CalendDataIni) Then CalendDataIni = DateValue(CalendDataIni) Else CalendDataIni = 0 'Date

   vCloseMode = 1
   UserFormCalend.Show
   'Unload |fffd| necess|fffd|rio para acionar evento_initialize no pr|fffd|xmimo show
   If vCloseMode = 1 Then Unload UserFormCalend
   If vCloseMode = 1 And CalendDataAtu <> CalendDataIni Then
      Workbooks("cpap_pri.mac").Sheets(1).Range("CalendVal").Value = Format(CalendDataAtu, "dd/mm/yyyy")
      Workbooks("cpap_pri.mac").Sheets(1).Range("CalcOK").Value = True
   End If
End Sub

Function gLocInfo(vType As Long) As String
   Dim vLoc As Long
   Dim vStr As String, vLng As Long
   Dim Ret As Long
   vStr = String$(255, 0)
   vLng = 255 - 1
   Ret = apiGetLocaleInfo(LOCALE_USER_DEFAULT, vType, vStr, vLng)
   If Ret <> 0 Then
      gLocInfo = Left$(vStr, Ret - 1)
      If Len(gLocInfo) > 0 Then gLocInfo = UCase(Left(gLocInfo, 1)) & Mid(gLocInfo, 2, 254)
   End If
End Function

Attribute VB_Name = "M|fffd|d4Editada"
Sub Editada()
   Dim WbEditada As Workbook
   Set WbEditada = ThisWorkbook
   Windows(WbEditada.Windows(1).Caption).Visible = True
   WbEditada.Activate

   For Each Sh In WbEditada.Sheets
      'Este loop |fffd| usado s|fffd| onde houver planilha de hist|fffd|rico
      If Right(Sh.Name, 4) = ".hst" Then
         Sh.Activate
         NumCampos = Range("A1").CurrentRegion.Columns.Count
         NumSugPadr = Range("A1").CurrentRegion.Rows.Count
         Set Campos = Range(Cells(1, 1), Cells(1, NumCampos))

         'Limpando
         Range("DadosFixos").CurrentRegion.Clear
         Range("DadosHist").CurrentRegion.Clear
         For Each Nome In ActiveWorkbook.ActiveSheet.Names
            Nome.Delete
         Next
         With ActiveWindow
            .SplitColumn = 0
            .SplitRow = 12
         End With

         'Redefinindo
         LFix = 4 + 100   'N|fffd|m de linhas reservadas para sug. fixas. Pode ser alterado o c|fffd|digo |fffd| flex|fffd|vel
         With ActiveWorkbook.ActiveSheet.Names
            Ref = "=" & ActiveWorkbook.ActiveSheet.Name & "!" & Cells(NumSugPadr + 4, 1).Address(ReferenceStyle:=xlR1C1)
            .Add Name:="DadosFixos", RefersToR1C1:=Ref
            Ref = "=" & ActiveWorkbook.ActiveSheet.Name & "!" & Cells(NumSugPadr + 4 + LFix + 1, 1).Address(ReferenceStyle:=xlR1C1)
            .Add Name:="DadosHist", RefersToR1C1:=Ref


            For Each C In Campos
               .Add Name:=C.Value, RefersToR1C1:=Cells(NumSugPadr + 4, C.Column)
               .Add Name:=C.Value & "Hist", RefersToR1C1:=Cells(NumSugPadr + 4 + LFix + 2, C.Column)
               C.Offset(NumSugPadr + 4 + LFix, 0).Value = 15
               C.Offset(NumSugPadr + 4 + LFix + 1, 0).Value = C.Value & "Hist"
            Next
         End With
         Range("A1").CurrentRegion.Copy
         Range("DadosFixos").PasteSpecial xlPasteValues
         Application.CutCopyMode = False

         ActiveWindow.Panes(1).Activate
         Application.Goto Reference:="DadosFixos", Scroll:=True
         ActiveWindow.Panes(3).Activate
         Application.Goto Reference:="DadosHist", Scroll:=True
      End If
   Next

   If WbEditada.ReadOnly Then WbEditada.ChangeFileAccess xlReadWrite
   If Val(Application.Version) < 9 Then If MsgBox(WbEditada.Name & ".  Indenter? (Distanciar margens)", vbOKCancel) = vbOK Then Run "Indenter97.xla!IndentProject"
   WbEditada.Sheets(1).Select
   If MsgBox(WbEditada.Name & ".  Limpar C|fffd|digo?", vbOKCancel) = vbOK Then
      Application.OnTime Now, "VBACodeCleaner.xla!CodeCleanerMain"
   Else
      WbEditada.Save
   End If
End Sub
Attribute VB_Name = "Plan1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True















Attribute VB_Name = "UserFormCalculadora"
Attribute VB_Base = "0{ACC20050-7F58-42FB-9EF3-66EEB5A3FED1}{06566352-DF77-4DFC-A674-8139965F3745}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim ValorPrev
Dim Somando As Boolean
Dim Subtraindo As Boolean
Dim Multiplicando As Boolean
Dim Dividindo As Boolean
Dim NovoNum As Boolean
Dim TeclouNum As Boolean
Dim |fffd|ltimaOper As Integer
Dim AprovSubTotal As Boolean
Dim ConstNum
Dim ConstOper As Integer
Dim ConstAtivada As Boolean
Dim TeclaEnter As Boolean
Dim DadosTransf As DataObject
Option Base 1
'Dim FitaPapel() As String
Dim PosPapel As Integer

Private Sub LabelLedConst_Click()
   ConstAtivada = False
   ConstOper = 0
   Leds
End Sub

Private Sub LabelLedImp_Click()
   LinFin = UBound(FitaPapel)
   LinIni = InputBox("H|fffd| " & LinFin & " linhas na fita. Imprimir as |fffd|ltimas:", "Imprimir Papel", LinFin)
   If Not (IsNumeric(LinIni)) Then Exit Sub
   If LinIni < 1 Then Exit Sub
   If LinIni > LinFin Then LinIni = LinFin
   LinIni = LinFin - LinIni + 1
   Application.ScreenUpdating = False
   Workbooks.Add
   LinPag = 45
   ColPag = 4
   Col = 1
   Pag = 1
   For I = LinIni To LinFin
      Lin = I - (Col - 1) * LinPag - (Pag - 1) * LinPag * ColPag + LinPag * (Pag - 1) - LinIni + 1
      Cells(Lin, Col).Value = FitaPapel(I)
      j = Col
      If I Mod LinPag = 0 Then Col = Col + 1
      If I Mod ColPag * LinPag = 0 Then
         ActiveWindow.SelectedSheets.HPageBreaks.Add Before:=Cells(Lin + 1, j)
         Col = 1
         Pag = Pag + 1
      End If
   Next

   Range(Range("A1"), Range("A1").SpecialCells(xlCellTypeLastCell)).Select
   Selection.Font.Size = 12
   Selection.Columns.AutoFit
   Selection.Font.Size = 10
   I = Selection.Columns.Width
   If I < 450 Then
      For Each C In Selection.Columns
         If C.Column = 1 Then Lar1 = C.Width
         If C.Column > 1 Then C.ColumnWidth = C.ColumnWidth * (450 - Lar1) / (I - Lar1)
      Next
   Else
      ActiveWorkbook.ActiveSheet.PageSetup.Zoom = Int((450 - Lar1) / (I - Lar1) * 100)
   End If
   Selection.HorizontalAlignment = xlRight
   Err.Clear
   On Error Resume Next
   ActiveWindow.SelectedSheets.PrintOut Copies:=1
   If Err.Number <> 0 Then MsgBox "Erro # " & Str(Err.Number) & " foi gerado por " _
         & Err.Source & Chr(13) & Err.Description
   On Error GoTo 0
   ActiveWorkbook.Close False
   Application.ScreenUpdating = True
End Sub

Private Sub LabelLedMem_Click()
   If ValorNaMem = 0 Then
      MsgBox "Para trabalhar com a mem|fffd|ria, use os tradicionais bot|fffd|es azuis M+, M- e MR.", vbOKOnly, "Valor na Mem|fffd|ria: " & Format(ValorNaMem, "#,##0.##############")
   Else
      Select Case MsgBox("Para trabalhar com a mem|fffd|ria, use os tradicionais bot|fffd|es azuis M+, M- e MR. Mas acione:" & Chr(10) & Chr(10) & "Sim - Para enviar o valor para o visor" & Chr(10) & Chr(10) & "N|fffd|o - Limpar mem|fffd|ria", vbYesNoCancel + vbQuestion, "Valor na Mem|fffd|ria: " & Format(ValorNaMem, "#,##0.##############"))
      Case vbYes
         LbMemExt_Click
      Case vbNo
         ValorNaMem = 0
         Leds
      End Select
   End If
End Sub

Private Sub LabelMaisMenos_Click()
   vEnableEvents = False
   If IsNumeric(ValorPrev) And NovoNum Then ValorPrev = -1 * ValorPrev
   If InStr(1, TbVisor.Value, "-") = 0 Then
      If Left(TbVisor.Value, 1) <> "0" Then TbVisor.Value = "-" & TbVisor.Value
   Else
      TbVisor.Value = Application.WorksheetFunction.Substitute(TbVisor.Value, "-", "")
   End If
   vEnableEvents = True
End Sub

Private Sub LbColar_Click()
   DadosTransf.GetFromClipboard
   z = 0
   On Error GoTo Fim
   I = DadosTransf.GetText(1)
   If IsNumeric(I) Then
      TbVisor.Value = I
      z = 1
      NovoNum = False
   End If
Fim:
   If z = 0 Then MsgBox "A |fffd|rea de Tranfer|fffd|ncia do Windows n|fffd|o cont|fffd|m valor num|fffd|rico!", vbCritical + vbOKOnly, "Valor Inv|fffd|lido"
   TbVisor.SetFocus
End Sub

Private Sub LbCopiar_Click()
   j = TbVisor.SelStart
   TbVisor.SelStart = 0
   TbVisor.SelLength = TbVisor.TextLength
   TbVisor.Copy
   TbVisor.SelStart = j
   TbVisor.SetFocus
End Sub

Private Sub LbOK_Click()
   If Somando Or Subtraindo Or Multiplicando Or Dividindo Then LbIgual_Click
   CalculadoraValorAtu = TbVisor.Value
   UserFormCalculadora.Hide
End Sub

Private Sub ScrollBarDecimal_Change()
   CalculadoraNumDecim = ScrollBarDecimal.Value
   LabelDecimal.Caption = IIf(CalculadoraNumDecim = 5, "F", CalculadoraNumDecim)
   TbVisor.SetFocus
   ScrollBarDecimal.SetFocus
   TbVisor.SetFocus
End Sub

Private Sub ScrollBarPapel_Change()
   I = ScrollBarPapel.Value
   If I < 9 Then
      ScrollBarPapel.Value = 9
      I = 9
      Beep
   End If
   If I > UBound(FitaPapel()) Then
      ScrollBarPapel.Value = UBound(FitaPapel())
      I = UBound(FitaPapel())
      Beep
   End If
   LabelPapel1.Caption = FitaPapel(I)
   LabelPapel2.Caption = FitaPapel(I - 1)
   LabelPapel3.Caption = FitaPapel(I - 2)
   LabelPapel4.Caption = FitaPapel(I - 3)
   LabelPapel5.Caption = FitaPapel(I - 4)
   LabelPapel6.Caption = FitaPapel(I - 5)
   LabelPapel7.Caption = FitaPapel(I - 6)
   LabelPapel8.Caption = FitaPapel(I - 7)
   LabelPapel9.Caption = FitaPapel(I - 8)
   TbVisor.SetFocus
End Sub

Private Sub TbVisor_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
   CalculadoraValorAtu = TbVisor.Value
   UserFormCalculadora.Hide
End Sub

Private Sub UserForm_Initialize()
   With UserFormCalculadora
      .StartUpPosition = 0
      .Top = CalculadoraPosTop
      .Left = CalculadoraPosLeft
   End With

   vEnableEvents = True
   '   ValorNaMem = 0
   Leds
   Set DadosTransf = New DataObject
   ScrollBarDecimal.Value = CalculadoraNumDecim
   LabelDecimal.Caption = IIf(CalculadoraNumDecim = 5, "F", CalculadoraNumDecim)

   'Static FitaPapel()
   If CalculadoraPapel = False Then
      ReDim FitaPapel(9)
      FitaPapel(2) = "Fita Papel"
      FitaPapel(3) = "Calculadora"
      FitaPapel(4) = "CPAP|fffd|"
      FitaPapel(5) = "http://cpap.com.br"
      FitaPapel(7) = "Licenciado:"
      FitaPapel(8) = Workbooks("cpap_pri.mac").Sheets(1).Range("NomRed").Value
   End If
   LbAC_Click
   vEnableEvents = False
   UserFormCalculadora.TbVisor.Value = CalculadoraValorIni
   vEnableEvents = True
   If CalculadoraPapel = False Then LabelLedPapel_Click
   TbVisor.SetFocus
   '   SendKeys "~~" 'Resolver bug do SetFocus no Ex2k
End Sub

Private Sub UserForm_Activate()
   'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k. Isto foi resolvido com SendKeys tamb|fffd|m
   ScrollBarDecimal.SetFocus
   UserFormCalculadora.TbVisor.SetFocus
End Sub


Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
   vCloseMode = CloseMode
   If CloseMode = 1 Then Exit Sub
   CalculadoraValorAtu = CalculadoraValorIni
End Sub

Private Sub LbIgual_Click()
   If Not (IsNumeric(TbVisor.Value)) Then ValorPrev = 0
   'Verificando n|fffd|mero constante
   If NovoNum And Somando = False And Subtraindo = False And Multiplicando = False And Dividindo = False And ConstOper <> 0 Then
      ValorPrev = TbVisor.Value
      vEnableEvents = False
      TbVisor.Value = CStr(ConstNum)
      vEnableEvents = True
      NovoNum = False
      Somando = ConstOper = 1
      Subtraindo = ConstOper = 2
      Multiplicando = ConstOper = 3
      Dividindo = ConstOper = 4
      ConstAtivada = True
      AprovSubTotal = True
      Leds
   End If


   If NovoNum Then
      TbVisor.Value = CStr(ValorPrev)
   Else
      If Not (IsNumeric(TbVisor.Value)) Then TbVisor.Value = 0
      If Somando Then
         ConstNum = TbVisor.Value
         ConstOper = 1
         TbVisor.Value = CStr(ValorPrev * 1 + TbVisor.Value * 1)
         PrintPapel "+", "="
      End If
      If Subtraindo Then
         ConstNum = TbVisor.Value
         ConstOper = 2
         TbVisor.Value = CStr(ValorPrev * 1 - TbVisor.Value * 1)
         PrintPapel "-", "="
      End If
      If Multiplicando Then
         ConstNum = TbVisor.Value
         ConstOper = 3
         TbVisor.Value = CStr(ValorPrev * TbVisor.Value)
         PrintPapel "|fffd|", "="
      End If
      If Dividindo Then
         If TbVisor.Value * 1 <> 0 Then
            ConstNum = TbVisor.Value
            ConstOper = 4
            TbVisor.Value = CStr(ValorPrev / TbVisor.Value)
            PrintPapel "|fffd|", "="
         Else
            TbVisor.Value = "Erro"
         End If
      End If
      ValorPrev = TbVisor.Value
      Somando = False
      Subtraindo = False
      Multiplicando = False
      Dividindo = False
      NovoNum = True
      TeclouNum = False
   End If
   Leds
   TbVisor.SetFocus
   ScrollBarDecimal.SetFocus
   TbVisor.SetFocus
End Sub

Private Sub Lb1_Click()
   TbVisor.SetFocus
   SendKeys "1"
End Sub

Private Sub Lb2_Click()
   TbVisor.SetFocus
   SendKeys "2"
End Sub

Private Sub Lb3_Click()
   TbVisor.SetFocus
   SendKeys "3"
End Sub

Private Sub Lb4_Click()
   TbVisor.SetFocus
   SendKeys "4"
End Sub

Private Sub Lb5_Click()
   TbVisor.SetFocus
   SendKeys "5"
End Sub

Private Sub Lb6_Click()
   TbVisor.SetFocus
   SendKeys "6"
End Sub

Private Sub Lb7_Click()
   TbVisor.SetFocus
   SendKeys "7"
End Sub

Private Sub Lb8_Click()
   TbVisor.SetFocus
   SendKeys "8"
End Sub

Private Sub Lb9_Click()
   TbVisor.SetFocus
   SendKeys "9"
End Sub

Private Sub Lb0_Click()
   TbVisor.SetFocus
   SendKeys "0"
End Sub

Private Sub LbPt_Click()
   TbVisor.SetFocus
   SendKeys "."
End Sub

Private Sub LbC_Click()
   vEnableEvents = False
   TbVisor.Value = 0
   vEnableEvents = True
End Sub

Private Sub LbAC_Click()
   vEnableEvents = False
   TbVisor.Value = 0
   vEnableEvents = True
   Somando = False
   Subtraindo = False
   Multiplicando = False
   Dividindo = False
   ValorPrev = ""
   ConstOper = 0
   |fffd|ltimaOper = 0
   ConstAtivada = False
   Leds
   TbVisor.SetFocus
   I = UBound(FitaPapel())
   ReDim Preserve FitaPapel(I + 1)
   FitaPapel(I + 1) = Format(0, Formato) & "|fffd|"
   ScrollBarPapel.Value = I + 1
   If TbVisor.Top > 20 And Application.CanPlaySounds Then Call sndPlaySound32(ThisWorkbook.Path & "\SomMqCal.wav", &H1)
End Sub

Private Sub LbPerc_Click()
   If Somando Or Subtraindo Or Multiplicando Or Dividindo Then
      If Not (IsNumeric(TbVisor.Value)) Then TbVisor.Value = 0
      vEnableEvents = False
      ConstNum = TbVisor.Value
      If Somando Then
         TbVisor.Value = CStr(ValorPrev + ValorPrev * TbVisor.Value / 100)
         PrintPapel "+", "%"
      End If
      If Subtraindo Then
         TbVisor.Value = CStr(ValorPrev - ValorPrev * TbVisor.Value / 100)
         PrintPapel "-", "%"
      End If
      If Multiplicando Then
         TbVisor.Value = CStr(ValorPrev * TbVisor.Value / 100)
         PrintPapel "|fffd|", "%"
      End If
      If Dividindo Then
         If TbVisor.Value * 1 <> 0 Then
            TbVisor.Value = CStr(ValorPrev / (TbVisor.Value / 100))
            PrintPapel "|fffd|", "%"
         Else
            TbVisor.Value = "Div/0!"
         End If
      End If
      vEnableEvents = True
      ValorPrev = TbVisor.Value
      Somando = False
      Subtraindo = False
      Multiplicando = False
      Dividindo = False
      NovoNum = True
      Leds
   End If
   TbVisor.SetFocus
   ScrollBarDecimal.SetFocus
   TbVisor.SetFocus
End Sub

Private Sub LbRaiz_Click()
   If Not (IsNumeric(TbVisor.Value)) Then TbVisor.Value = 0
   TbVisor.Value = CStr(Abs(TbVisor.Value) ^ (1 / 2))
   TbVisor.SetFocus
End Sub

Private Sub LbMais_Click()
   ConstOper = 0
   ConstAtivada = False
   LbIgual_Click
   '   If ConstAtivada = False And (Somando Or Multiplicando Or Dividindo) Then LbIgual_Click
   Somando = True
   Subtraindo = False
   NovoNum = True
   If Not TeclouNum And (|fffd|ltimaOper = 1 Or |fffd|ltimaOper = 2) Then AprovSubTotal = True
   ValorPrev = TbVisor.Value
   TbVisor.SetFocus
End Sub

Private Sub LbMenos_Click()
   ConstOper = 0
   ConstAtivada = False
   LbIgual_Click
   '   If ConstAtivada = False And (Subtraindo Or Multiplicando Or Dividindo) Then LbIgual_Click
   Somando = False
   Subtraindo = True
   NovoNum = True
   If Not TeclouNum And (|fffd|ltimaOper = 1 Or |fffd|ltimaOper = 2) Then AprovSubTotal = True
   ValorPrev = TbVisor.Value
   TbVisor.SetFocus
End Sub


Private Sub LbX_Click()
   ConstOper = 0
   ConstAtivada = False
   LbIgual_Click
   Multiplicando = True
   NovoNum = True
   If Not TeclouNum And |fffd|ltimaOper = 3 Then AprovSubTotal = True
   ValorPrev = TbVisor.Value
   TbVisor.SetFocus
End Sub

Private Sub LbDiv_Click()
   ConstOper = 0
   ConstAtivada = False
   LbIgual_Click
   Dividindo = True
   NovoNum = True
   If Not TeclouNum And |fffd|ltimaOper = 4 Then AprovSubTotal = True
   ValorPrev = TbVisor.Value
   TbVisor.SetFocus
End Sub



Public Sub TeclandoNum()
   If NovoNum Then
      vEnableEvents = False
      TbVisor.Value = "0"
      vEnableEvents = True
      NovoNum = False
      TeclouNum = True
   End If
End Sub


Private Sub LbMemMais_Click()
   If Somando Or Subtraindo Or Multiplicando Or Dividindo Then LbIgual_Click
   ValorNaMem = ValorNaMem + TbVisor.Value
   NovoNum = True
   Leds
   TbVisor.SetFocus
End Sub
Private Sub LbMemMenos_Click()
   If Somando Or Subtraindo Or Multiplicando Or Dividindo Then LbIgual_Click
   ValorNaMem = ValorNaMem - TbVisor.Value
   NovoNum = True
   Leds
   TbVisor.SetFocus
End Sub
Private Sub LbMemExt_Click()
   If Not (IsNumeric(TbVisor.Value)) Then TbVisor.Value = 0
   If TbVisor.Value * 1 = ValorNaMem And Somando = False And Subtraindo = False And Multiplicando = False And Dividindo = False Then
      ValorNaMem = 0
   Else
      ValorPrev = TbVisor.Value
      vEnableEvents = False
      TbVisor.Value = CStr(ValorNaMem)
      vEnableEvents = True
      NovoNum = False
   End If
   Leds
   TbVisor.SetFocus
End Sub






Private Sub TbVisor_MouseMove(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
   EvValor_Cb_MouseMove TbVisor, Button, Shift, X, Y
End Sub
Private Sub TbVisor_KeyDown(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
   If KeyCode = 27 Then   'ESC
      CalculadoraValorAtu = CalculadoraValorIni
      UserFormCalculadora.Hide
   End If
   If KeyCode = 38 Or KeyCode = 40 Or KeyCode = 9 Then LbOK_Click
   If KeyCode = 65 Then LbAC_Click   'O
   If KeyCode = 67 And Shift = 0 Then LbC_Click   'O
   If KeyCode = 79 Then LbOK_Click   'O
   If KeyCode = 13 Or (KeyCode = 187 And Shift = 0) Then LbIgual_Click   '=
   If KeyCode = 107 Or (KeyCode = 187 And Shift = 1) Then LbMais_Click   '+
   If KeyCode = 109 Or KeyCode = 189 Then LbMenos_Click   '-
   If KeyCode = 106 Or (KeyCode = 56 And Shift = 1) Then LbX_Click   ' X
   If KeyCode = 111 Or KeyCode = 191 Then LbDiv_Click   ' /
   If KeyCode = 80 Or (KeyCode = 53 And Shift = 1) Then LbPerc_Click   ' %
   If KeyCode = 82 Then LbRaiz_Click   ' Rquad
   If KeyCode = 96 Or KeyCode = 48 Then TeclandoNum   '0
   If KeyCode = 97 Or KeyCode = 49 Then TeclandoNum   '1
   If KeyCode = 98 Or KeyCode = 50 Then TeclandoNum   '2
   If KeyCode = 99 Or KeyCode = 51 Then TeclandoNum   '3
   If KeyCode = 100 Or KeyCode = 52 Then TeclandoNum   '4
   If KeyCode = 101 Or (KeyCode = 53 And Shift = 0) Then TeclandoNum   '5
   If KeyCode = 102 Or KeyCode = 54 Then TeclandoNum   '6
   If KeyCode = 103 Or KeyCode = 55 Then TeclandoNum   '7
   If KeyCode = 104 Or (KeyCode = 56 And Shift = 0) Then TeclandoNum   '8
   If KeyCode = 105 Or KeyCode = 57 Then TeclandoNum   '9
   If KeyCode = 110 Or KeyCode = 188 Or KeyCode = 190 Then TeclandoNum   '.
   TeclaEnter = KeyCode = 13
   EvValor_Cb_KeyDown TbVisor, KeyCode, Shift
   TbVisor.SetFocus
End Sub
Private Sub TbVisor_Change()
   If vEnableEvents = False Then Exit Sub
   If Not (IsNumeric(TbVisor.Value)) Then TbVisor.Value = 0
   EvValor_Cb_Change TbVisor
   TbVisor.ControlTipText = IIf(Len(TbVisor.Text) > 16, TbVisor.Text, "")
End Sub
Private Sub TbVisor_Exit(ByVal Cancel As MSForms.ReturnBoolean)
   If TbVisor.Value * 1 <> 0 Then
      EvValor_Cb_Exit TbVisor, Cancel, Formato
   Else
      vEnableEvents = False
      TbVisor.Value = 0
      vEnableEvents = True
   End If
   Cancel = TeclaEnter
   TeclaEnter = False
End Sub

Sub PrintPapel(Oper As String, Igual As String)
   I = UBound(FitaPapel())
   '   AprovSubTotal = False  'Ativando exibe cada opera|fffd||fffd|o no papel, caso contr|fffd|rio condensa
   If AprovSubTotal Then
      ReDim Preserve FitaPapel(I + 1)
      FitaPapel(I - 1) = Left(FitaPapel(I - 1), Len(FitaPapel(I - 1)) - 1) & Oper
      FitaPapel(I) = Format(ConstNum, Formato & "############") & Igual
      FitaPapel(I + 1) = Format(TbVisor.Value, Formato) & "|fffd|"
      ScrollBarPapel.Value = I + 1
      AprovSubTotal = False
   Else
      ReDim Preserve FitaPapel(I + 4)
      FitaPapel(I + 1) = ""
      FitaPapel(I + 2) = Format(ValorPrev, Formato & "############") & Oper
      FitaPapel(I + 3) = Format(ConstNum, Formato & "############") & Igual
      FitaPapel(I + 4) = Format(TbVisor.Value, Formato) & "|fffd|"
      ScrollBarPapel.Value = I + 4
   End If
   |fffd|ltimaOper = Abs(1 * Somando + 2 * Subtraindo + 3 * Multiplicando + 4 * Dividindo)
   If TbVisor.Top > 20 And Application.CanPlaySounds Then Call sndPlaySound32(ThisWorkbook.Path & "\SomMqCal.wav", &H0)
   If TbVisor.Top > 20 And Application.CanPlaySounds Then Call sndPlaySound32(ThisWorkbook.Path & "\SomMqCal.wav", &H1)
End Sub
Private Sub LabelPapel1_Click()
   EvLabelPapel_Click (LabelPapel1.Caption)
End Sub
Private Sub LabelPapel2_Click()
   EvLabelPapel_Click (LabelPapel2.Caption)
End Sub
Private Sub LabelPapel3_Click()
   EvLabelPapel_Click (LabelPapel3.Caption)
End Sub
Private Sub LabelPapel4_Click()
   EvLabelPapel_Click (LabelPapel4.Caption)
End Sub
Private Sub LabelPapel5_Click()
   EvLabelPapel_Click (LabelPapel5.Caption)
End Sub
Private Sub LabelPapel6_Click()
   EvLabelPapel_Click (LabelPapel6.Caption)
End Sub
Private Sub LabelPapel7_Click()
   EvLabelPapel_Click (LabelPapel7.Caption)
End Sub
Private Sub LabelPapel8_Click()
   EvLabelPapel_Click (LabelPapel8.Caption)
End Sub
Private Sub LabelPapel9_Click()
   EvLabelPapel_Click (LabelPapel9.Caption)
End Sub

Private Sub EvLabelPapel_Click(I As String)
   If I <> "" Then
      I = Left(I, Len(I) - 1)
      If IsNumeric(I) Then TbVisor.Value = I
   End If
   TbVisor.SetFocus
   ScrollBarPapel.SetFocus
   TbVisor.SetFocus
End Sub

Function Formato() As String
   '   Formato = Choose(-1 * (CalculadoraNumDecim <= 0) + 2 * (CalculadoraNumDecim > 0) * (CalculadoraNumDecim < 5) - 3 * (CalculadoraNumDecim > 4), "#,##0", "#,##0." & Application.WorksheetFunction.Rept("0", CalculadoraNumDecim), "#,##0.#######")
   Formato = IIf(CalculadoraNumDecim < 5, "#,##0." & Application.WorksheetFunction.Rept("0", CalculadoraNumDecim), "#,##0.#######")
End Function

Private Sub LabelLedPapel_Click()
   I = IIf(TbVisor.Top < 20, 95, -95)
   For Each C In UserFormCalculadora.Controls
      C.Top = C.Top + I
   Next
   If I > 0 Then
      UserFormCalculadora.Top = UserFormCalculadora.Top - I
      UserFormCalculadora.Height = UserFormCalculadora.Height + I
   Else
      UserFormCalculadora.Height = UserFormCalculadora.Height + I
      UserFormCalculadora.Top = UserFormCalculadora.Top - I
   End If
   CalculadoraPapel = TbVisor.Top > 20
   Leds
End Sub


Sub Leds()
   LabelLedMem.ControlTipText = "Mem|fffd|ria: " & Format(ValorNaMem, "#,##0.##############")
   LbMemExt.ControlTipText = "Mem|fffd|ria (" & Format(ValorNaMem, "#,##0.##############") & "), 1|fffd| clique extrai e no 2|fffd| limpa"
   LabelLedConst.ControlTipText = IIf(Not (ConstAtivada), "", "Constante: " & Choose(ConstOper, "+", "-", "|fffd|", "|fffd|") & ConstNum)
   LabelLedMem.ForeColor = IIf(ValorNaMem = 0, &HC0C0C0, &HFF&)
   LabelLedConst.ForeColor = IIf(Not (ConstAtivada), &HC0C0C0, &HFF&)
   '   LabelLedPapel.ForeColor = IIf(TbVisor.Top > 20, &HC0C0C0, &HFF&)
   LabelLedPapel.ControlTipText = IIf(TbVisor.Top > 20, "Ocultar Papel", "Exibir Papel")
   LabelLedImp.ControlTipText = IIf(TbVisor.Top > 20, "Imprimir Papel", "")
   LabelLedImp.Enabled = TbVisor.Top > 20
End Sub

Private Sub Lb0_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb0.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb0_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb0.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb1_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb1.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb1_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb1.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb2_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb2.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb2_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb2.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb3_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb3.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb3_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb3.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb4_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb4.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb4_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb4.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb5_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb5.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb5_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb5.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb6_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb6.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb6_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb6.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb7_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb7.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb7_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb7.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb8_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb8.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb8_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb8.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub Lb9_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb9.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub Lb9_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): Lb9.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbAC_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbAC.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbAC_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbAC.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbC_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbC.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbC_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbC.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbColar_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbColar.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbColar_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbColar.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbCopiar_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbCopiar.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbCopiar_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbCopiar.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbDiv_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbDiv.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbDiv_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbDiv.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbIgual_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbIgual.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbIgual_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbIgual.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbMais_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMais.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbMais_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMais.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbMemExt_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMemExt.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbMemExt_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMemExt.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbMemMais_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMemMais.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbMemMais_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMemMais.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbMemMenos_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMemMenos.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbMemMenos_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMemMenos.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbMenos_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMenos.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbMenos_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbMenos.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbOK_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbOK.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbOK_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbOK.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbPerc_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbPerc.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbPerc_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbPerc.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbPt_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbPt.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbPt_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbPt.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbRaiz_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbRaiz.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbRaiz_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbRaiz.SpecialEffect = fmSpecialEffectEtched: End Sub
Private Sub LbX_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbX.SpecialEffect = fmSpecialEffectSunken: End Sub
Private Sub LbX_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single): LbX.SpecialEffect = fmSpecialEffectEtched: End Sub
Attribute VB_Name = "UserFormCalend"
Attribute VB_Base = "0{C706B9F9-9391-44A4-8D41-D4AD9238C74F}{D1F41C15-423A-488D-B677-B021D7F6EAB0}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Dim DaysLb(42)
Dim DataRef As Date
Dim wPos As Single

Private Sub Modal_Lb_Click()
   If Val(Application.Version) > 8 Then
      If vModal = 1 Then vModal = 0 Else vModal = 1
      vModalChange = True
      vShowingModeless = False
      Modal_Lb.Caption = IIf(vModal = 1, "|fffd|", "|fffd|")
      Hide
   Else
      'MyMsgBox IIf(IsPortg, "Excel 97 n|fffd|o suporta calend|fffd|rio n|fffd|o modal!", "Excel 97 doesn't suport modeless calendar!"), 1, IIf(IsPortg, "Calend|fffd|rio do Orlando", "Orlando's Calendar")
   End If
End Sub

Private Sub UserForm_Activate()
   'Necess|fffd|rio, devido bug Setfocus em textbox do Excel2k
   Modal_Lb.Visible = False
   BotOK.SetFocus
   BotOk2.SetFocus
End Sub

Private Sub UserForm_Initialize()
   DiasSeman_Lb.Caption = gLocInfo(&H37) & " " & gLocInfo(&H31) & " " & gLocInfo(&H32) & " " & gLocInfo(&H33) & " " & gLocInfo(&H34) & " " & gLocInfo(&H35) & " " & gLocInfo(&H36)
   If IsPortg Then
      Caption = "Calend|fffd|rio"
      LabelSem.Caption = "S"
      LabelAno.Caption = "A"
      Modal_Lb.ControlTipText = "|fffd| Modal | |fffd| N|fffd|o Modal"
      SetaEsq_Sb.ControlTipText = "M|fffd|s Anterior"
      SetaDir_Sb.ControlTipText = "Pr|fffd|ximo M|fffd|s"
      SpinMeDia.ControlTipText = "Dia Anterior"
      LabelDia.ControlTipText = "Incrementar Dias"
      SpinMaDia.ControlTipText = "Pr|fffd|ximo Dia"
      SpinMeSem.ControlTipText = "Semana Anterior"
      LabelSem.ControlTipText = "Incrementar Semanas"
      SpinMaSem.ControlTipText = "Pr|fffd|xima Semana"
      SpinMeM|fffd|s.ControlTipText = "M|fffd|s Anterior"
      LabelM|fffd|s.ControlTipText = "Incrementar Meses"
      SpinMaM|fffd|s.ControlTipText = "Pr|fffd|ximo M|fffd|s"
      SpinMeAno.ControlTipText = "Ano Anterior"
      LabelAno.ControlTipText = "Incrementar Anos"
      SpinMaAno.ControlTipText = "Pr|fffd|ximo Ano"
   Else
      Caption = "Calendar"
      LabelSem.Caption = "W"
      LabelAno.Caption = "Y"
      Modal_Lb.ControlTipText = "|fffd| Modal | |fffd| Modeless"
      SetaEsq_Sb.ControlTipText = "Previous Month"
      SetaDir_Sb.ControlTipText = "Next Month"
      SpinMeDia.ControlTipText = "Previous Day"
      LabelDia.ControlTipText = "Increase Days"
      SpinMaDia.ControlTipText = "Next Day"
      SpinMeSem.ControlTipText = "Previous Week"
      LabelSem.ControlTipText = "Increase Weeks"
      SpinMaSem.ControlTipText = "Next Week"
      SpinMeM|fffd|s.ControlTipText = "Previous Month"
      LabelM|fffd|s.ControlTipText = "Increase Months"
      SpinMaM|fffd|s.ControlTipText = "Next Month"
      SpinMeAno.ControlTipText = "Previous Year"
      LabelAno.ControlTipText = "Increase Years"
      SpinMaAno.ControlTipText = "Next Year"
   End If

   StartUpPosition = 0
   Top = CalendPosTop
   Left = CalendPosLeft

   Modal_Lb.Caption = IIf(vModal = 1, "|fffd|", "|fffd|")

   CalendDataAtu = IIf(CalendDataIni = 0, Date, CalendDataIni)
   DataRef = Date
   AtualR|fffd|tulos
End Sub

Private Sub LabelDataRef_Click()
   DataRef = CalendDataAtu
   AtualR|fffd|tulos
End Sub

Private Sub AtualR|fffd|tulos()
   '   Caption = Format(CalendDataAtu, "mm/yy") & " (" & Format(CalendDataAtu, "MMMM yyyy") & ")"
   Caption = Format(CalendDataAtu, "MMMM yyyy")
   Caption = String(20 - Len(Caption), " ") & Caption   'Centralizar
   Caption = Application.WorksheetFunction.Proper(Caption)
   IrHoje_Lb.Caption = IIf(IsPortg, "Ir" & Chr(10) & "H", "G" & Chr(10) & "T")
   IrHoje2_Lb.Caption = IrHoje_Lb.Caption
   IrHoje_Lb.ControlTipText = IIf(IsPortg, "Ir Hoje, click aqui para " & Format(Date, "dd/mm/yyyy"), "Go Today, click here to " & Format(Date, "mm/dd/yyyy"))
   IrHoje2_Lb.ControlTipText = IrHoje_Lb.ControlTipText
   LabelDataRef.Caption = "Ref.: " & DataRef
   LabelDataRef.ControlTipText = IIf(IsPortg, "Click aqui para configurar " & CalendDataAtu & " como refer|fffd|ncia de contagem", "Click here to set " & CalendDataAtu & " as count reference")

   If DataRef <= CalendDataAtu Then
      Data1 = DataRef
      Data2 = CalendDataAtu
      Sinal = 1
      CorDaFonte = RGB(0, 0, 255)
   Else
      Data1 = CalendDataAtu
      Data2 = DataRef
      Sinal = -1
      CorDaFonte = RGB(255, 0, 0)
   End If
   LabelDataRef.ForeColor = CorDaFonte
   LabelDia.ForeColor = CorDaFonte
   LabelSem.ForeColor = CorDaFonte
   LabelM|fffd|s.ForeColor = CorDaFonte
   LabelAno.ForeColor = CorDaFonte
   LabelContDia.ForeColor = CorDaFonte
   LabelContSem.ForeColor = CorDaFonte
   LabelContM|fffd|s.ForeColor = CorDaFonte
   LabelContM|fffd|sDia.ForeColor = CorDaFonte
   LabelContAno.ForeColor = CorDaFonte

   'Contagem de dias
   Interv = " (" & DataRef & IIf(IsPortg, " a ", " to ") & CalendDataAtu & ")"
   C = Application.WorksheetFunction.Round(Sinal * DateDiff("d", Data1, Data2), 2)
   LabelContDia.Caption = C
   LabelContDia.ControlTipText = C & IIf(Abs(C) = 1, IIf(IsPortg, " dia", " day"), IIf(IsPortg, " dias", " days")) & Interv

   'Contagem de semanas
   NumFechad = DateDiff("w", Data1, Data2)
   |fffd|ltFechad = DateAdd("ww", NumFechad, Data1)
   Quebra = DateDiff("d", |fffd|ltFechad, Data2)
   C = Application.WorksheetFunction.Round(Sinal * (NumFechad + Quebra / 7), 2)
   LabelContSem.Caption = C
   LabelContSem.ControlTipText = C & IIf(Abs(C) = 1, IIf(IsPortg, " semana", " week"), IIf(IsPortg, " semanas", " weeks")) & Interv

   'Contagem de meses
   NumFechad = DateDiff("m", Data1, Data2)
   |fffd|ltFechad = DateAdd("m", NumFechad, Data1)
   Quebra = DateDiff("d", |fffd|ltFechad, Data2)
   DiasM|fffd|s = 30
   If Quebra < 0 Then
      NumFechad = NumFechad - 1
      |fffd|ltFechad = DateAdd("m", NumFechad, Data1)
      Quebra = DateDiff("d", |fffd|ltFechad, Data2)
      If Quebra = 30 Then DiasM|fffd|s = 31
   End If
   C = Application.WorksheetFunction.Round(Sinal * (NumFechad + Quebra / DiasM|fffd|s), 2)
   LabelContM|fffd|s.Caption = C
   LabelContM|fffd|s.ControlTipText = C & IIf(Abs(C) = 1, IIf(IsPortg, " m|fffd|s", " month"), IIf(IsPortg, " meses", " months")) & Interv
   LabelContM|fffd|sDia.Caption = Sinal * NumFechad & "m " & Sinal * Quebra & "d"
   LabelContM|fffd|sDia.ControlTipText = Sinal * NumFechad & IIf(NumFechad = 1, IIf(IsPortg, " m|fffd|s e ", " month and "), IIf(IsPortg, " meses e ", " months and ")) & Sinal * Quebra & IIf(Quebra = 1, IIf(IsPortg, " dia", " day"), IIf(IsPortg, " dias", " days")) & Interv

   'Contagem de anos
   NumFechad = DateDiff("yyyy", Data1, Data2)
   |fffd|ltFechad = DateAdd("yyyy", NumFechad, Data1)
   Quebra = DateDiff("d", |fffd|ltFechad, Data2)
   C = Application.WorksheetFunction.Round(Sinal * (NumFechad + Quebra / 365), 2)
   LabelContAno.Caption = C
   LabelContAno.ControlTipText = C & IIf(Abs(C) = 1, IIf(IsPortg, " ano", " year"), IIf(IsPortg, " anos", " years")) & Interv
   SetDisplay
   BotOK.SetFocus
   BotOk2.SetFocus
End Sub

Sub SetDisplay()
   Y = Year(CalendDataAtu)
   m = Month(CalendDataAtu)
   FirstDateMonth = DateSerial(Y, m, 1)
   LastDateMonth = DateSerial(Y, m + 1, 1) - 1
   FirstDayDisp = Weekday(FirstDateMonth)
   FirstDayDisp = FirstDayDisp - 7 * (FirstDayDisp = 1)
   LastDayMonth = Day(DateSerial(Y, m + 1, 1) - 1)
   LastDayDisp = LastDayMonth + FirstDayDisp - 1

   'Complete display with previous month
   For I = 1 To FirstDayDisp - 1
      DaysLb(I) = Day(FirstDateMonth - (FirstDayDisp - I))
      With Me.Controls("Lb" & Format(I, "00"))
         .Caption = DaysLb(I)
         .ForeColor = &H8080&
         .BackColor = &H8000000E
         .Font.Bold = False
      End With
   Next
   'Insert the days of active month in display
   d = 0
   For I = FirstDayDisp To LastDayDisp
      d = d + 1
      DaysLb(I) = d
      With Me.Controls("Lb" & Format(I, "00"))
         .Caption = DaysLb(I)
         .ForeColor = &HFF0000
         .BackColor = &H8000000E
         .Font.Bold = True
         If d = Day(CalendDataAtu) Then
            .ForeColor = &H8000000E
            .BackColor = &HFF0000
         End If
      End With
   Next
   'Complete display with next month
   For I = LastDayDisp + 1 To 42
      DaysLb(I) = Day(LastDateMonth + I - LastDayDisp)
      With Me.Controls("Lb" & Format(I, "00"))
         .Caption = DaysLb(I)
         .ForeColor = &H8080&
         .BackColor = &H8000000E
         .Font.Bold = False
      End With
   Next
End Sub

Private Sub IrHoje_Lb_Click()
   FlashCtrl IrHoje2_Lb
   FlashCtrl IrHoje_Lb
   CalendDataAtu = Date
   AtualR|fffd|tulos
End Sub
Private Sub IrHoje2_Lb_Click()
   IrHoje_Lb_Click
End Sub

Private Sub IrHoje_Lb_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
   IrHoje_Lb_Click
   BotOK_Click
End Sub
Private Sub IrHoje2_Lb_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
   IrHoje_Lb_Click
   BotOK_Click
End Sub

Private Sub SetaDir_Sb_Change()
   'NextMonth
   FlashCtrl SetaDir_Sb
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu) + 1, Day(CalendDataAtu))
   AtualR|fffd|tulos
End Sub

Private Sub SetaEsq_Sb_Change()
   'PreviousMonth
   FlashCtrl SetaEsq_Sb
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu) - 1, Day(CalendDataAtu))
   AtualR|fffd|tulos
End Sub

Private Sub DiasSeman_Lb_Click()
   FlashCtrl DiasSeman_Lb
   CalendDataAtu = CalendDataAtu + _
         Int(CDec(wPos / (DiasSeman_Lb.Width / 7))) + 1 - Weekday(CalendDataAtu)
   AtualR|fffd|tulos
End Sub
Private Sub DiasSeman_Lb_MouseDown(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)
   wPos = X
End Sub


'Procedimentos referentes |fffd| contagem

Private Sub SpinMeDia_Change()
   'PreviousDay
   FlashCtrl SpinMeDia
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu), Day(CalendDataAtu) - 1)
   AtualR|fffd|tulos
End Sub

Private Sub SpinMaDia_Change()
   'NextDay
   FlashCtrl SpinMaDia
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu), Day(CalendDataAtu) + 1)
   AtualR|fffd|tulos
End Sub

Private Sub SpinMeSem_Change()
   'PreviousWeek
   FlashCtrl SpinMeSem
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu), Day(CalendDataAtu) - 7)
   AtualR|fffd|tulos
End Sub

Private Sub SpinMaSem_Change()
   'NextWeek
   FlashCtrl SpinMaSem
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu), Day(CalendDataAtu) + 7)
   AtualR|fffd|tulos
End Sub

Private Sub SpinMeM|fffd|s_Change()
   'PreviousMonth
   FlashCtrl SpinMeM|fffd|s
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu) - 1, Day(CalendDataAtu))
   AtualR|fffd|tulos
End Sub

Private Sub SpinMaM|fffd|s_Change()
   'NextMonth
   FlashCtrl SpinMaM|fffd|s
   CalendDataAtu = DateSerial(Year(CalendDataAtu), Month(CalendDataAtu) + 1, Day(CalendDataAtu))
   AtualR|fffd|tulos
End Sub

Private Sub SpinMeAno_Change()
   'PreviousYear
   FlashCtrl SpinMeAno
   CalendDataAtu = DateSerial(Year(CalendDataAtu) - 1, Month(CalendDataAtu), Day(CalendDataAtu))
   AtualR|fffd|tulos
End Sub

Private Sub SpinMaAno_Change()
   'NextYear
   FlashCtrl SpinMaAno
   CalendDataAtu = DateSerial(Year(CalendDataAtu) + 1, Month(CalendDataAtu), Day(CalendDataAtu))
   AtualR|fffd|tulos
End Sub

Sub FlashCtrl(Ctrl As Control)
   Ctrl.Visible = False
   DoEvents
   If Application.CanPlaySounds Then Call sndPlaySound32(WavFile, &H1)
   Ctrl.Visible = True
End Sub

Private Sub BotOK_Click()
   vCloseMode = 1
   vShowingModeless = False
   Hide
End Sub
Private Sub BotOk2_Click()
   'Bot|fffd|o Ok2 evita o foco no outro para n|fffd|o distorcer o label
   BotOK_Click
End Sub

Private Sub BotOk2_KeyUp(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
   Select Case Shift
   Case 0
      If KeyCode = 37 Then SpinMeDia_Change
      If KeyCode = 38 Then SpinMeSem_Change
      If KeyCode = 39 Then SpinMaDia_Change
      If KeyCode = 40 Then SpinMaSem_Change
   Case 1, 2   'Ctrl or Shift
      If KeyCode = 37 Then SpinMeM|fffd|s_Change
      If KeyCode = 38 Then SpinMeM|fffd|s_Change
      If KeyCode = 39 Then SpinMaM|fffd|s_Change
      If KeyCode = 40 Then SpinMaM|fffd|s_Change
   Case 3   'Ctrl and Shift
      If KeyCode = 37 Then SpinMeAno_Change
      If KeyCode = 38 Then SpinMeAno_Change
      If KeyCode = 39 Then SpinMaAno_Change
      If KeyCode = 40 Then SpinMaAno_Change
   End Select
End Sub

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
   vCloseMode = CloseMode
   If CloseMode = 1 Then Exit Sub
   CalendDataAtu = CalendDataIni
End Sub

Private Sub Cancel_Bt_Click()
   CalendDataAtu = CalendDataIni
   Hide
End Sub

Sub Calendar_Click(Lb As Integer)
   m = Month(CalendDataAtu) + 1 * (DaysLb(Lb) > Lb) - 1 * (DaysLb(Lb) + 27 < Lb)
   CalendDataAtu = DateSerial(Year(CalendDataAtu), m, DaysLb(Lb))
   BotOK_Click
End Sub
Private Sub Lb01_Click(): Calendar_Click 1: End Sub
Private Sub Lb02_Click(): Calendar_Click 2: End Sub
Private Sub Lb03_Click(): Calendar_Click 3: End Sub
Private Sub Lb04_Click(): Calendar_Click 4: End Sub
Private Sub Lb05_Click(): Calendar_Click 5: End Sub
Private Sub Lb06_Click(): Calendar_Click 6: End Sub
Private Sub Lb07_Click(): Calendar_Click 7: End Sub
Private Sub Lb08_Click(): Calendar_Click 8: End Sub
Private Sub Lb09_Click(): Calendar_Click 9: End Sub
Private Sub Lb10_Click(): Calendar_Click 10: End Sub
Private Sub Lb11_Click(): Calendar_Click 11: End Sub
Private Sub Lb12_Click(): Calendar_Click 12: End Sub
Private Sub Lb13_Click(): Calendar_Click 13: End Sub
Private Sub Lb14_Click(): Calendar_Click 14: End Sub
Private Sub Lb15_Click(): Calendar_Click 15: End Sub
Private Sub Lb16_Click(): Calendar_Click 16: End Sub
Private Sub Lb17_Click(): Calendar_Click 17: End Sub
Private Sub Lb18_Click(): Calendar_Click 18: End Sub
Private Sub Lb19_Click(): Calendar_Click 19: End Sub
Private Sub Lb20_Click(): Calendar_Click 20: End Sub
Private Sub Lb21_Click(): Calendar_Click 21: End Sub
Private Sub Lb22_Click(): Calendar_Click 22: End Sub
Private Sub Lb23_Click(): Calendar_Click 23: End Sub
Private Sub Lb24_Click(): Calendar_Click 24: End Sub
Private Sub Lb25_Click(): Calendar_Click 25: End Sub
Private Sub Lb26_Click(): Calendar_Click 26: End Sub
Private Sub Lb27_Click(): Calendar_Click 27: End Sub
Private Sub Lb28_Click(): Calendar_Click 28: End Sub
Private Sub Lb29_Click(): Calendar_Click 29: End Sub
Private Sub Lb30_Click(): Calendar_Click 30: End Sub
Private Sub Lb31_Click(): Calendar_Click 31: End Sub
Private Sub Lb32_Click(): Calendar_Click 32: End Sub
Private Sub Lb33_Click(): Calendar_Click 33: End Sub
Private Sub Lb34_Click(): Calendar_Click 34: End Sub
Private Sub Lb35_Click(): Calendar_Click 35: End Sub
Private Sub Lb36_Click(): Calendar_Click 36: End Sub
Private Sub Lb37_Click(): Calendar_Click 37: End Sub
Private Sub Lb38_Click(): Calendar_Click 38: End Sub
Private Sub Lb39_Click(): Calendar_Click 39: End Sub
Private Sub Lb40_Click(): Calendar_Click 40: End Sub
Private Sub Lb41_Click(): Calendar_Click 41: End Sub
Private Sub Lb42_Click(): Calendar_Click 42: End Sub



INQUEST-PP=macro
