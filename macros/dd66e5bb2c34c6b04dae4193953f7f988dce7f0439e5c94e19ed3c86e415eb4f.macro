Attribute VB_Name = "ModReg"
Public Declare Function RegOpenKey Lib "advapi32.dll" Alias "RegOpenKeyA" (ByVal hKey As Long, ByVal lpSubKey As String, phkResult As Long) As Long
Public Declare Function RegQueryValueEx Lib "advapi32.dll" Alias "RegQueryValueExA" (ByVal hKey As Long, ByVal lpValueName As String, ByVal lpReserved As Long, lpType As Long, lpData As Any, lpcbData As Long) As Long         ' Note that if you declare the lpData parameter as String, you must pass it By Value.

Public Function GetRegistrValue() As String
Dim lReturn As Long
Dim shKey As String, sSubKey As String, hKey As Long
Dim hSubKeyHandle As Long
Dim sValue As String
Dim sPar As String
Dim strSetting As String
Dim lngDataLen As Long

hKey = &H80000002   'Case "HKEY_LOCAL_MACHINE"
sSubKey = "SOFTWARE\Rassvet\Aksiok\Vfp9\VSvod"
sPar = "ProgramXls"
    
lReturn = RegOpenKey(hKey, sSubKey, hSubKeyHandle)
If lReturn <> 0 Then Exit Function
strSetting = Space(255)
lngDataLen = Len(strSetting)
lReturn = RegQueryValueEx(hSubKeyHandle, sPar, ByVal 0, REG_EXPAND_SZ, ByVal strSetting, lngDataLen)
If strSetting = Space(255) Then GetRegistrValue = "": Exit Function     '"C:\Aksiok\Prg\VSvod\Xlt\"
If lngDataLen > 1 Then sValue = Left(strSetting, lngDataLen - 1)
GetRegistrValue = sValue
End Function


Attribute VB_Name = "frmAddRow1"
Attribute VB_Base = "0{A4399F0C-881E-4B7F-94F6-87A67BDDD829}{65FCA731-8472-462B-B6EB-8EB6B938A7F6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
''<Spir>01.10.2019
Public iArrOrg As Variant
Public iArrFKR As Variant
Public iArrKLD As Variant
Public iArrPLS0 As Variant
''<Spir>01.10.2019 |fffd||fffd||fffd| |fffd||fffd||fffd||fffd| combobox  |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Style = fmStyleDropDownCombo

Option Explicit
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|(|fffd||fffd||fffd||fffd||fffd|) |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
Dim flg128 As Integer

''<Spir> 04.09.2019 ~8639 |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| EnabledOKTMO  (|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| EnabledVB)
Public Sub SelEnabled()
Dim n As Integer
Dim i  As Long, s As String
Dim s1 As String, s2 As String, j   As Long, nn  As Long, nn1  As Long

    bSelEnabled = True    '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    
    s = sGetINI("EnabledOKTMO\" & Range("Kod_Account").Value & "\", "?")
    If s <> "?" Then
        bEnabledOKATO = True
        bEnabledVB = True
        s1 = ","
        s2 = s
        n = UBound(Split(s2, s1)) '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        ReDim arrSprKod1(1 To n + 1)
        For nn = 1 To n + 1
          s1 = StrEl(s, nn)
          arrSprKod1(nn) = s1
        Next nn
    End If
    
'    s = sGetINI("EnabledVB\" & Range("Kod_Account").Value & "\", "?")
'    If s <> "?" Then
'        bEnabledVB = True
'        s1 = ","
'        s2 = s
'        n = UBound(Split(s2, s1)) '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'        ReDim arrSprKod2(1 To n + 1)
'        For nn = 1 To n + 1
'          s1 = StrEl(s, nn)
'          arrSprKod2(nn) = s1
'        Next nn
'    End If
    
End Sub

'' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Public Sub CountStr(s1$, s2$)
Dim n As Integer
    n = UBound(Split(s2, s1)) '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
End Sub


Public Sub addRowF1251_128(sKod$, r As Range, Optional newNameOrg$, Optional rw As Integer)
'arr-|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| r ,|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
Dim Row As Integer, s$, iAK% ','sValue$
Dim arr()
Dim i As Integer
Dim k As Integer
Dim sKodAcc As String
Dim sKodBU As String
Dim s1 As String, s2 As String, n As Integer

i = -1
k = 0
addNewRow r
Row = r.Rows.Count - 1

sKodAcc = Range("Kod_Account").Cells(1, 1)
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
s = Mid$(sKod, 4, 6)
'r.Cells(row, 1) = s

If Left$(s, 1) = "1" Then
    r.Cells(Row, 2) = NameinSpr(Right$(s, 5), "Data_Org")
Else
    If frmAddRow1.Visible And Len(newNameOrg) = 0 Then r.Cells(Row, 2) = Data_ORG.Value Else r.Cells(Row, 2) = newNameOrg
End If

ReDim Preserve arr(i + 1)
i = i + 1
arr(i) = 1


'|fffd||fffd||fffd|
If r.Cells(1, 4) <> "X" Then
   r.Cells(Row, 4) = Mid$(sKod, 10, 3)
   k = k + 3
Else
  r.Cells(Row, 4) = "X"
  ReDim Preserve arr(i + 1)
  i = i + 1
  arr(i) = 4
End If

'O|fffd||fffd||fffd||fffd|
iAK = Val(sGetINI("OKATO\" & sKodAcc & "\", "8"))
If r.Cells(1, 5) <> "X" Then
  r.Cells(Row, 5) = Mid$(sKod, 13, iAK)
  k = k + CInt(iAK)
Else
  ''<Spir> 04.09.2019 ~8639
  If bEnabledOKATO Then
'  If Left(Range("Kod_Type").Cells(1, 1), 2) = "SS" And (Range("Kod_Account").Cells(1, 1) = "140110191" Or Range("Kod_Account").Cells(1, 1) = "140110195") Then
    r.Cells(Row, 5) = Mid$(sKod, 13, iAK)
    k = k + CInt(iAK)
  Else
    r.Cells(Row, 5) = "X"
    ReDim Preserve arr(i + 1)
    i = i + 1
    arr(i) = 5
  End If
End If
'|fffd||fffd|-|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If r.Cells(1, 6) <> "X" Then
   r.Cells(Row, 6) = Mid$(sKod, 13 + iAK, 2)
   k = k + 2
Else
  ''<Spir> 04.09.2019 ~8639
  If Left(Range("Kod_Type").Cells(1, 1), 2) = "SS" And (Range("Kod_Account").Cells(1, 1) = "140110191" Or Range("Kod_Account").Cells(1, 1) = "140110195") Then
    r.Cells(Row, 6) = Mid$(sKod, 13 + iAK, 2)
    k = k + 2
  Else
    r.Cells(Row, 6) = "X"
    ReDim Preserve arr(i + 1)
    i = i + 1
    arr(i) = 6
  End If
End If
'|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
sKodBU = Mid$(sKod, 23, 17) & Left$(Range("Kod_Account").Cells(1, 1).Value, 6) & Mid$(sKod, 40, 3)
s1 = "N"
n = UBound(Split(sKodBU, s1)) '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If n > 0 Then
    sKodBU = Replace$(sKodBU, s1, "")
End If
r.Cells(Row, 7) = sKodBU
'r.Cells(row, 7) = Mid$(sKod, 10 + k, 17) & Left$(Range("Kod_Account").Cells(1, 1).Value, 6) & Mid$(sKod, 27 + k, 3)

If r.Cells(1, 10) <> "X" Then
   r.Cells(Row, 10) = Right$(sKod, 9)
Else
  r.Cells(Row, 10) = "X"
  ReDim Preserve arr(i + 1)
  i = i + 1
  arr(i) = 10
End If
fInsertNameStr r.Name.Name, sKod, , , arr()

If Not plGR Then
    r.Cells(Row, 15) = "X"
    r.Cells(Row, 14) = "X"
    ' <Spir>20.04.2018 ~6314
'    r.Cells(row, 13) = "X"
End If

'' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| INN Spir 25/03/2015
r.Cells(Row, 16) = 1

End Sub

''<Spir>01.10.2019
Private Sub BK_Change()
    With BK
         If obDoh.Value = True Then .List = FilterToArr(iArrKLD, .Value)
         If obRash.Value = True Then .List = FilterToArr(iArrFKR, .Value)
         If .ListCount > 0 Then .DropDown
    End With
End Sub

Private Sub cmdCancel_Click()
ShowRekv
Unload Me
End Sub

''<Spir>01.10.2019
Private Sub Data_ORG_Change()
    If opListOrg.Enabled = True And opListOrg.Value = True Then
        With Data_ORG
             .List = FilterToArr(iArrOrg, .Value)
             If .ListCount > 0 Then .DropDown
        End With
    End If
End Sub
''<Spir>01.10.2019
Private Sub Data_PLS0_Change()
    With Data_PLS0
         .List = FilterToArr(iArrPLS0, .Value)
         If .ListCount > 0 Then .DropDown
    End With
End Sub

Private Sub obDoh_Click()
'|fffd||fffd||fffd||fffd||fffd||fffd|
''<Spir>01.10.2019
If IsEmpty(iArrKLD) Then iArrKLD = Application.Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("Data_KLD")
BK.RowSource = ""
BK.List = iArrKLD
'BK.RowSource = "Data_KLD"
BK.Value = ""
flg128 = 1
End Sub

Private Sub obinFin_Click()
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
BK.RowSource = "Data_IFR"
BK.Value = ""
flg128 = 3
End Sub

Private Sub obOutFin_Click()
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
BK.RowSource = "Data_IFV"
BK.Value = ""
flg128 = 4
End Sub

Private Sub obRash_Click()
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd|
''<Spir>01.10.2019
If IsEmpty(iArrFKR) Then iArrFKR = Application.Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("Data_FKR")
BK.RowSource = ""
BK.List = iArrFKR
'BK.RowSource = "Data_FKR"
BK.Value = ""
flg128 = 2
End Sub

Private Sub obTxtOrg_Click()
    Data_ORG.Style = fmStyleDropDownCombo
    Data_ORG.ShowDropButtonWhen = fmShowDropButtonWhenNever
    Data_ORG.Text = ""
    Data_ORG.Enabled = True
End Sub

Private Sub opTxtGL_Click()
    Data_GL.Style = fmStyleDropDownCombo
    Data_GL.Text = ""
    Data_GL.ShowDropButtonWhen = fmShowDropButtonWhenNever
    Data_GL.Enabled = True
End Sub

Private Sub opListGL_Click()
    Data_GL.Style = fmStyleDropDownList
    Data_GL.ShowDropButtonWhen = fmShowDropButtonWhenAlways
End Sub

Private Sub opListOrg_Click()
    Data_ORG.Style = fmStyleDropDownCombo   ''<Spir>01.10.2019
    Data_ORG.ShowDropButtonWhen = fmShowDropButtonWhenAlways
End Sub


Private Sub UserForm_Activate()
Dim s$, r As Range, sfl$
Dim NumDs As String
Dim TArr
Dim i As Integer
Dim sKodAcc As String

opListOrg.SetFocus
If sEmptyName("Data_IFV") < 2 Then obOutFin.Enabled = False Else BK.Enabled = True: obOutFin.Value = True: BK.RowSource = "Data_IFV"
If sEmptyName("Data_IFR") < 2 Then obinFin.Enabled = False Else BK.Enabled = True: obinFin.Value = True: BK.RowSource = "Data_IFR"
If sEmptyName("Data_FKR") < 2 Then obRash.Enabled = False Else BK.Enabled = True: obRash.Value = True: BK.RowSource = "Data_FKR"
If sEmptyName("Data_KLD") < 2 Then obDoh.Enabled = False Else BK.Enabled = True: obDoh.Value = True: BK.RowSource = "Data_KLD"

If flgUseDataSheetInCodName = True Then
  sKodAcc = Range("Kod_Account").Cells(1, 1)
  s = sGetINI("IdForm", "?")
  If s = "125_1" Then
    s = sGetINI("flKod\" & sKodAcc & "\", "?")
    If s <> "?" Then
      s = Trim(s)
      obOutFin.Enabled = False
      obinFin.Enabled = False
      obRash.Enabled = False
      obDoh.Enabled = False
       
        TArr = DelimitedLineToArray(s, ",")
        For i = LBound(TArr) To UBound(TArr)
          Select Case TArr(i)
           Case "1" '|fffd||fffd||fffd|
             obDoh.Enabled = True
             ''<Spir>01.10.2019
             iArrKLD = Application.Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("Data_KLD")
             BK.RowSource = ""
             BK.List = iArrKLD
          Case "2" '|fffd||fffd||fffd||fffd|
            obRash.Enabled = True
             ''<Spir>01.10.2019
             iArrFKR = Application.Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("Data_FKR")
             BK.RowSource = ""
             BK.List = iArrFKR
          Case "3" '|fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd|
            obinFin.Enabled = True
          Case "4" '|fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd|
            obOutFin.Enabled = True
          End Select
        Next i
         Select Case TArr(LBound(TArr))  '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
          Case "1"
            obDoh.Value = True
          Case "2"
            obRash.Value = True
          Case "3"
            obinFin.Value = True
          Case "4"
            obOutFin.Value = True
         End Select

    End If
  End If
End If
NumDs = fGetNumberDataSheet("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
'Set r = Range("Data_Sheet" & NumDs).Cells(1, 4)
's = Trim$(r.Value)

'|fffd||fffd||fffd||fffd||fffd|
Set r = Range("Data_Sheet" & NumDs).Cells(1, 5)
s = Trim$(r.Value)
If s = "X" Then
    txtAKATO.Enabled = False
    LabelAKATO.Enabled = False
    Data_OKATO.Enabled = False
Else
    LabelAKATO.Enabled = True
    If IniCombo("Data_OKATO") = True Then
       Data_OKATO.Enabled = True
       Data_OKATO.Visible = True
       txtAKATO.Enabled = False
       txtAKATO.Visible = False
    Else
        txtAKATO.MaxLength = Val(sGetINI("OKATO\" & sKodAcc & "\", "8"))
        txtAKATO.Enabled = True
        txtAKATO.Visible = True
        Data_OKATO.Enabled = False
        Data_OKATO.Visible = False
    End If
End If
'If s = "X" Then Data_OKATO.Enabled = False: LabelAKATO.Enabled = False Else LabelAKATO.Enabled = IniCombo("Data_OKATO")
'If s = "X" Then
'    txtAKATO.Enabled = False
'    LabelAKATO.Enabled = False
'Else
'    txtAKATO.MaxLength = Val(sGetINI("OKATO\" & sKodAcc & "\", "8"))
'End If

Set r = Range("Data_Sheet" & NumDs).Cells(1, 6)
s = Trim$(r.Value)
If s = "X" Then Data_VB.Enabled = False: LabelVB.Enabled = False Else LabelVB.Enabled = IniCombo("Data_VB")
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
sfl = sGetINI("HasOrg\" & sKodAcc & "\", "?")
''<Spir>01.10.2019
If sfl <> "2" Then
    iArrOrg = Application.Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("Data_ORG")
    With Data_ORG
        .ColumnCount = 2
        .ColumnWidths = "50;400"
        .List = iArrOrg
        .Enabled = True
    End With
    opListOrg.Enabled = True
End If
'If sfl <> "2" Then opListOrg.Enabled = IniCombo("Data_ORG")
If sfl = "1" Then obTxtOrg.Enabled = False '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
If sfl = "2" Then opListOrg.Enabled = False: obTxtOrg.Value = True   '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
If sfl = "?" Then obTxtOrg.Enabled = True: opListOrg.Value = True: opListOrg.Enabled = True   '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'|fffd||fffd||fffd||fffd||fffd|
Set r = Range("Data_Sheet" & NumDs).Cells(1, 4) '31.10.2008
s = Trim$(r.Value)
If s = "X" Then
    opListGL.Enabled = False: opTxtGL.Enabled = False
    Data_GL.Enabled = False: Frame3.Enabled = False
Else
    sfl = sGetINI("HasGL\" & sKodAcc & "\", "?")
    If sfl <> "2" Then opListGL.Enabled = IniCombo("Data_GL")
    If sfl = "1" Then opTxtGL.Enabled = False '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If sfl = "2" Then opListGL.Enabled = False: opTxtGL.Value = True   '|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If sfl = "?" Then opTxtGL.Enabled = True: opListGL.Value = True: opListGL.Enabled = True   '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
End If
''<Spir>01.10.2019
iArrPLS0 = Application.Sheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|").Range("Data_PLS0")
With Data_PLS0
    .ColumnCount = 2
    .ColumnWidths = "50;400"
    .List = iArrPLS0
    .Enabled = True
End With
LabelPLS0.Enabled = True
'LabelPLS0.Enabled = IniCombo("Data_PLS0")
Set r = Range("Kod_Account")
s = Trim$(r.Cells(1, 1).Value)
If Right$(s, 3) = "000" Then
    LabelSGU.Enabled = IniCombo("Data_SGU")
Else
    Data_SGU.Enabled = False: LabelSGU.Enabled = False
    Data_SGU.Value = Right$(s, 3)
End If

''<Spir> 04.09.2019 ~8639
If bSelEnabled = False Then SelEnabled

''<Spir>01.10.2019
If obRash.Enabled = True Then obRash.Value = True
If obDoh.Enabled = True Then obDoh.Value = True

End Sub


Public Function IniCombo(Name$) As Boolean
Dim A As ComboBox, fl As Boolean
Set A = Me.Controls.Item(Name)
If sEmptyName(Name) > 1 Then
    A.ColumnCount = 2
    A.ColumnWidths = "100;400"
    A.BoundColumn = 1
    A.RowSource = Name
    fl = True
End If
    A.Enabled = fl
    IniCombo = fl
    Set A = Nothing
End Function
Private Sub cmdOk_Click()
Dim sKod$, r As Range
Dim i As Integer
'----------------------------------------------------------31.10.2008
Dim NumDs As String
Dim dsName As String
Dim sKodAcc As String
    
NumDs = fGetNumberDataSheet("|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
   
  If NumDs = "" Then
'    MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| Data_Sheet |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!", vbOKOnly, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!"
'    Exit Sub
     NumDs = "1"
  End If

'----------------------------------------------------------31.10.2008
   sKod = KodF1251
   If Len(sKod) = 0 Then Exit Sub
   If flg128 > 0 Then
     sKod = CStr(flg128) & sKod
   End If
   sKod = Format(NumDs, "00") & sKod  '31.10.2008
   
   dsName = "DATA_SHEET" & NumDs '31.10.2008
   If sEmptyName(dsName) = 0 Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": Exit Sub '31.10.2008
   
   If sEmptyName("ss" & sKod & "a") > 0 Then MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & sKod & " |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|": Exit Sub
   Set r = Range(dsName) '31.10.2008
   UnProt
   If flg128 > 0 Then
     addRowF1251_128 sKod, r
     
     sKodAcc = Range("Kod_Account").Cells(1, 1).Value
     
    ''<Spir> 05.09.2019 ~8639
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd|
    Range("ss" + sKod + "m").Value = "001" + Range("Kod_OTD").Cells(1, 1).Value
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    Range("ss" + sKod + "o").Value = Range("Kod_OKATO").Cells(1, 1).Value
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    Range("ss" + sKod + "n").Value = Range("Kod_GL").Cells(1, 1).Value

    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd| (2 |fffd||fffd||fffd||fffd||fffd||fffd||fffd|)
    If opListOrg.Enabled = True And opListOrg.Value = True Then
        Range("ss" + sKod + "c").Value = "001" + Mid(sKod, 5, 5)
    End If
    
'    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd| <Spir> 03.07.2019
'        If sKodAcc = "130404000" Or sKodAcc = "140110151" Or sKodAcc = "140110189" Or sKodAcc = "140120241" Or sKodAcc = "140120251" Then
'           Range("ss" + sKod + "m").Value = "001" + Range("Kod_OTD").Cells(1, 1).Value
'        End If
'     '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'        If sKodAcc = "130404000" Or sKodAcc = "140110151" Or sKodAcc = "140110189" Or sKodAcc = "140120241" Or sKodAcc = "140120251" Then
'           Range("ss" + sKod + "o").Value = Range("Kod_OKATO").Cells(1, 1).Value
'        End If
'
'      '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'        If sKodAcc = "130404000" Or sKodAcc = "140110151" Or sKodAcc = "140110189" Or sKodAcc = "140120241" Or sKodAcc = "140120251" Then
'           Range("ss" + sKod + "n").Value = Range("Kod_GL").Cells(1, 1).Value
'        End If
'
'    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd| (2 |fffd||fffd||fffd||fffd||fffd||fffd||fffd|) <Spir> 03.07.2019
'        If sKodAcc = "130404000" Then
'           Range("ss" + sKod + "c").Value = "001" + Mid(sKod, 5, 5)
'        End If

   Else
     addRowF1251 sKod, r
   End If
   
   
'  Print '|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   'F1251Itogo
   If HasName("Total_Debet") = False Then
     F1251Itogo
   End If
   
   fShowCmdInsDelRow True
   fExecProc , r.Row + r.Rows.Count - 1, sKod '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
   UnProt False
   Set r = Nothing

End Sub

Public Function KodF1251() As String
'|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ListBox |fffd| ComboBox |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd| = ""
'Dim A As Control
Dim sKod$, sValue$, r As Range, sFormat$, sN$
Dim sKodAcc As String
Dim bVisibleOKATO As Boolean, bVisibleVB As Boolean, bChangeOKATO As Boolean, bChangeVB As Boolean, n As Long ''<Spir> 04.09.2019 ~8639

sKodAcc = Range("Kod_Account").Cells(1, 1)

''<Spir> 04.09.2019 ~8639
If bEnabledOKATO Then
    For n = 1 To UBound(arrSprKod1)
        If arrSprKod1(n) = BK.Value Then
            bChangeOKATO = True
            Data_OKATO.Enabled = False
            bChangeVB = True
            Data_VB.Enabled = False
            Exit For
        End If
    Next n
    If bChangeOKATO = False Then
        If Data_OKATO.Enabled = False Then
            Data_OKATO.Enabled = True
            LabelAKATO.Enabled = IniCombo("Data_OKATO")
            Data_VB.Enabled = True
            LabelVB.Enabled = IniCombo("Data_VB")
        End If
    End If
End If
'If bEnabledVB Then
'    For n = 1 To UBound(arrSprKod2)
'        If arrSprKod2(n) = BK.Value Then
'            bChangeVB = True
'            Data_VB.Enabled = False
'            Exit For
'        End If
'    Next n
'    If bChangeVB = False Then
'        If Data_VB.Enabled = False Then
'            Data_VB.Enabled = True
'            LabelVB.Enabled = IniCombo("Data_VB")
'        End If
'    End If
'End If
'If bEnabledOKTMO Then
''If Left(Range("Kod_Type").Cells(1, 1), 2) = "SS" And (Range("Kod_Account").Cells(1, 1) = "140110191" Or Range("Kod_Account").Cells(1, 1) = "140110195") Then
'    If BK.Value = "20701020016000180" Then
'        '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| BK.Value = 20701020016000150 (|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| N |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 3, 4 |fffd| 5 |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|)
'        bChangeKod = True
'    Else
'        '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd|
'        bVisible = True
'        If Data_VB.Enabled = False Then
'            Data_VB.Enabled = True
'            Data_OKATO.Enabled = True
'            LabelAKATO.Enabled = IniCombo("Data_OKATO")
'            LabelVB.Enabled = IniCombo("Data_VB")
'        End If
'    End If
'End If
''<Spir> 04.09.2019 ~8639

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If opListOrg.Value = True Then
    Data_ORG.BoundColumn = 1
    sValue = Data_ORG.Value
    If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!": GoTo A1
    sValue = "1" & Format(sValue, "00000")
End If
If obTxtOrg.Value = True Then
    sValue = Data_ORG.Value
    If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!": GoTo A1
    sValue = NextIdOrg
End If
sKod = sKod & sValue
'|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'Data_GL.BoundColumn = 1
'If Data_GL.Enabled = False Then sValue = "000" Else sValue = Format(Data_GL.Value, "000")
'If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
If Data_GL.Enabled = True Then
    If opListGL.Value = True Then
        Data_GL.BoundColumn = 1
        sValue = Data_GL.Value
        If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
    End If
    If opTxtGL.Value = True Then
    '    sValue = Format(Data_GL.Value, "000")
        sValue = Data_GL.Value
        If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|  |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
        If Len(sValue) <> 3 Then MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| - 3 |fffd||fffd||fffd||fffd||fffd||fffd||fffd|!": GoTo A1
    End If
Else
    '|fffd||fffd||fffd||fffd||fffd| NNN,|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| "X" 12.12.2014
'     sValue = ""
     sValue = "NNN"
End If
sKod = sKod & sValue

'O|fffd||fffd||fffd||fffd|
sN = sGetINI("OKATO\" & sKodAcc & "\", "8")
sFormat = String$(Val(sN), "0")
Data_OKATO.BoundColumn = 1
'sValue = Trim$(txtAKATO.Text)
If txtAKATO.Enabled = False And Data_OKATO.Enabled = False Then
    If bChangeOKATO Then
        sValue = "00000000"
    Else
        sValue = "NNNNNNNN"
    End If
'    '|fffd||fffd||fffd||fffd||fffd| N,|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| "X" 12.12.2014
'    sValue = "NNNNNNNN"
'    sValue = ""
Else
    If txtAKATO.Enabled = True Then
        If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
        If Len(sValue) <> Val(sN) Then MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd|.|fffd|. " & sN & "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!": GoTo A1
        sValue = Format(sValue, sFormat)
    End If
    If Data_OKATO.Enabled = True Then
     If bChangeOKATO Then
        sValue = "00000000"
     Else
        sValue = Format(Data_OKATO.Value, sFormat)
        If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
     End If
    End If
End If
sN = sGetINI("HasOKATO\" & sKodAcc & "\", "?")
If sN = "1" And Len(sValue) = 0 Then
   MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
End If
sKod = sKod & sValue

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Data_VB.BoundColumn = 1
If Data_VB.Enabled = False Then
    If bChangeVB Then
        sValue = "00"
    Else
        sValue = "NN"
    End If
'  '|fffd||fffd||fffd||fffd||fffd| N,|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| "X" 12.12.2014
'  sValue = "NN"
Else
    If bChangeVB Then
       sValue = "00"
    Else
        sValue = Format(Data_VB.Value, "00")
        If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|!": GoTo A1
    End If
End If

sKod = sKod & sValue
'BK
BK.BoundColumn = 1
'sValue = BK.Value
sValue = Format(BK.Value, "00000000000000000")
If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|!": GoTo A1
sKod = sKod & sValue
''|fffd||fffd||fffd||fffd|
'sValue = Left(Range("Kod_Account").Cells(1, 1).Value, 6)
'sKod = sKod & sValue
'|fffd||fffd||fffd||fffd||fffd|
Data_SGU.BoundColumn = 1
sValue = Data_SGU.Value
If Data_SGU.Enabled = True Then
    If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!": GoTo A1
End If
sValue = IIf(Len(sValue) = 0, "000", Format(sValue, "000"))
sKod = sKod & sValue
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
Data_PLS0.BoundColumn = 1
'sValue = Data_PLS0.Value
sValue = Format(Data_PLS0.Value, "000000000")
If Len(sValue) = 0 Then MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|!": GoTo A1
sKod = sKod & sValue
KodF1251 = sKod
Exit Function
A1:
KodF1251 = ""
End Function




Public Function NextIdOrg() As String
Dim r As Range, Value As Long, s$, sAD$, i%, j%
Set r = Range("Data_Sheet01")
i = r.Row
j = r.Row + r.Rows.Count - 1
sAD = "='" & "|fffd||fffd||fffd||fffd|1" & "'!" & Range(Cells(i, 1), Cells(j, 1)).Address
Set r = Range(sAD)

Value = MaxValueSpr(r) + 1
s = Format(Value, "000000")
If Left$(s, 1) = "1" Then s = "2" & Mid(Value, 2)
NextIdOrg = s
End Function

'Public Sub addNewRow(r As Range)
'Dim row%
'row = r.row + r.Rows.Count - 1
'Rows(row).Insert Shift:=xlDown
'End Sub

'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| fRasstMain - |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Spr1
Public Function fRasstF1251() As Integer
'On Error Resume Next
Dim r As Range, i%, sKod$, sKod1$, n% ' - |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| ss |fffd| |fffd|..
Dim vd$, RDS As Range, k%

'--------------------------------------------------------------------------------
'07.07.2008
Dim sKodNew As String
'07.07.2008
'--------------------------------------------------------------------------------

'On Error GoTo err1251



If sEmptyName("Data_Spr1") < 2 Then fRasstF1251 = 0: Exit Function  '|fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
Application.Calculation = xlManual
Application.EnableEvents = False

'--------------------------------------------------------------------------------
'07.07.2008
Call UnProt
'07.07.2008
'--------------------------------------------------------------------------------


Set r = Range("Data_Spr1")
Set RDS = Range("Data_Sheet01")
r.Sort Key1:=r.Cells(1, 1), Order1:=xlAscending
'N = Len(Trim$(R.Cells(1, 1))) - 3 '07.07.2008
For i = 1 To r.Rows.Count
    sKod = Trim$(r.Cells(i, 1))   '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    sKodNew = sKod
'--------------------------------------------------------------------------------
'07.07.2008
    n = Len(Trim$(sKodNew)) - 3
'07.07.2008
'--------------------------------------------------------------------------------
    

    
    If sEmptyName(sKod) > 0 Then GoTo A1    '|fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    If Left$(sKod, 2) <> "ss" And Not (sKod Like "*[!a-z][a-z]") Then GoTo A1
    sKod = Mid$(sKod, 3, n)
    If sKod <> sKod1 Then
        
        sKod1 = sKod
        addRowF1251 sKod, RDS, " "
        '-----------------------------------------07.07.2008
        '''''F1251Itogo
        '-----------------------------------------07.07.2008
        'addNewRow RDS
        'fInsertKodstr RDS, sKod
        'fInsertNameStr "Data_Sheet1", sKod
    End If
A1:


'--------------------------------------------------------------------------------
'07.07.2008
If Not IsEmpty(r.Cells(i, 2)) Or Trim(r.Cells(i, 2)) <> "" Then
   If sEmptyName(sKodNew) > 0 Then
     On Error GoTo B
    If Range(sKodNew).HasFormula = False Then
      Range(sKodNew).Value = Trim(r.Cells(i, 2)) '|fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| Data_spr1
    End If
B:
      If Err <> 0 Then
        Err.Clear
      End If
    End If
 End If
 '07.07.2008
'--------------------------------------------------------------------------------


Next i

'--------------------------------------------------------------------------------
'07.07.2008

Call UnProt(False)
 '07.07.2008
'--------------------------------------------------------------------------------


fShowCmdInsDelRow True
Set r = Nothing
Set RDS = Nothing
Application.EnableEvents = True
Application.Calculation = xlAutomatic
fRasstF1251 = -1

'Exit Function
'err1251:
'MsgBox Error
'Resume

End Function

Public Sub UnProt(Optional fl As Boolean = True)
'Application.Calculation = IIf(fl = False, xlManual, xlAutomatic)
'Application.EnableEvents = fl
    Application.ScreenUpdating = Not fl
    fUnProtect fl
    fUnProtect fl, Worksheets("|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|").Index
End Sub


Public Sub addRowF1251(sKod$, r As Range, Optional newNameOrg$, Optional rw As Integer)
'arr-|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| r ,|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
Dim Row As Integer, s$, iAK% ','sValue$
Dim arr()
Dim i As Integer
Dim sKodAcc As String

i = -1
addNewRow r
Row = r.Rows.Count - 1

sKodAcc = Range("Kod_Account").Cells(1, 1)
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
 s = Mid$(sKod, 3, 6)
'r.Cells(row, 1) = s

If Left$(s, 1) = "1" Then
    r.Cells(Row, 2) = NameinSpr(Right$(s, 5), "Data_Org")
Else
    If frmAddRow1.Visible And Len(newNameOrg) = 0 Then r.Cells(Row, 2) = Data_ORG.Value Else r.Cells(Row, 2) = newNameOrg
End If

ReDim Preserve arr(i + 1)
i = i + 1
arr(i) = 1


'|fffd||fffd||fffd|
If r.Cells(1, 4) <> "X" Then
  r.Cells(Row, 4) = Mid$(sKod, 9, 3)
Else
  r.Cells(Row, 4) = "X"
  ReDim Preserve arr(i + 1)
  i = i + 1
  arr(i) = 4
End If

'|fffd||fffd||fffd||fffd||fffd|
iAK = Val(sGetINI("OKATO\" & sKodAcc & "\", "8"))
If r.Cells(1, 5) <> "X" Then
  r.Cells(Row, 5) = Mid$(sKod, 12, iAK)
Else
  r.Cells(Row, 5) = "X"
  ReDim Preserve arr(i + 1)
  i = i + 1
  arr(i) = 5
End If
'|fffd||fffd|-|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
If r.Cells(1, 6) <> "X" Then
  r.Cells(Row, 6) = Mid$(sKod, 12 + iAK, 2)
Else
  r.Cells(Row, 6) = "X"
  ReDim Preserve arr(i + 1)
  i = i + 1
  arr(i) = 6
End If
'|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|

r.Cells(Row, 7) = Mid$(sKod, 22, 17) & Left$(Range("Kod_Account").Cells(1, 1).Value, 6) & Mid$(sKod, 39, 3)
If r.Cells(1, 10) <> "X" Then
   r.Cells(Row, 10) = Right$(sKod, 9)
Else
  r.Cells(Row, 10) = "X"
  ReDim Preserve arr(i + 1)
  i = i + 1
  arr(i) = 10
End If
fInsertNameStr r.Name.Name, sKod, , , arr()

If Not plGR Then
    r.Cells(Row, 15) = "X"
    r.Cells(Row, 14) = "X"
    r.Cells(Row, 13) = "X"
End If

'' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| INN Spir 25/03/2015
r.Cells(Row, 16) = 1

End Sub
''<Spir>01.10.2019
Public Function FilterToArr(ByRef arr As Variant, StringToFind As String) As Variant
'|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|

    Dim i As Long
    Dim j As Long
    Dim k As Long
    Dim iCount As Long
    Dim arrT As Variant
    Dim strTempFind As String
    
    ReDim arrT(LBound(arr, 1) To UBound(arr, 1), LBound(arr, 2) To UBound(arr, 2))
    strTempFind = UCase(StringToFind)
    iCount = LBound(arr, 1)
    
    For i = LBound(arr, 1) To UBound(arr, 1)
        For j = LBound(arr, 2) To UBound(arr, 2)
            If InStr(1, UCase(arr(i, j)), strTempFind, vbTextCompare) > 0 Then
                For k = LBound(arr, 2) To UBound(arr, 2)
                    arrT(iCount, k) = arr(i, k)
                Next
                iCount = iCount + 1
                Exit For
            End If
        Next
    Next
    ReDim Preserve arrT(LBound(arr, 1) To UBound(arr, 1), LBound(arr, 2) To iCount)
    FilterToArr = arrT
End Function


Attribute VB_Name = "mdActualForma"
Public Function InsertRangeToSheet(ByVal sNameRange As String) As Long
Dim nRowsSpr1 As Long
Dim nRowsSpr2 As Long
Dim nRowsSpr3 As Long
'Dim sNameSprL2 As String
Dim i As Long
Dim n As Long
Dim k As Long
Dim m As Long
Dim j As Long
Dim y As Long
Dim nNoNullSpr1 As Long
Dim nNoNullSpr2 As Long

' nColR |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| sNameRange ("Data_Sheet1")
Dim nColR As Long

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "data_RPS" |fffd||fffd| "|fffd||fffd||fffd||fffd| 2" |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd||fffd| "FKR"+"PLS" (+"SGU")
    sNameSpr = "RPS"
    sNameSprL2 = "Data_RPS"
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|

    sNameSpr1 = "Data_FKR"
    sNameSpr2 = "Data_PLS"
'    sNameSpr3 = "Data_SGU"
    
    Dim lngCount As Long
    lngCount = 0
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "FKR" |fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If IsEmpty(Range(sNameSpr1).Cells(1, 1)) And IsEmpty(Range(sNameSpr1).Cells(2, 1)) Then
        InsertRangeToSheet = -2
        Exit Function
    End If
' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "PLS" |fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If IsEmpty(Range(sNameSpr2).Cells(1, 1)) And IsEmpty(Range(sNameSpr2).Cells(2, 1)) Then
        InsertRangeToSheet = -3
        Exit Function
    End If
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| sNameSpr1
    nRowsSpr1 = Range(sNameSpr1).Rows.Count
    nNoNullSpr1 = 0
    For j = 1 To nRowsSpr1
            If Len(Trim(Range(sNameSpr1).Cells(j, 1))) <> 0 Then
                nNoNullSpr1 = nNoNullSpr1 + 1
            End If
    Next j
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| sNameSpr2
    nRowsSpr2 = Range(sNameSpr2).Rows.Count
    nNoNullSpr2 = 0

    For y = 1 To nRowsSpr2
            If Len(Trim(Range(sNameSpr2).Cells(y, 1))) <> 0 Then
                nNoNullSpr2 = nNoNullSpr2 + 1
            End If
    Next y
    
'    nRowsSpr3 = Range(sNameSpr3).Rows.Count
    m = nNoNullSpr1 * nNoNullSpr2 '* nRowsSpr3
    
'   |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| "data_RPS" |fffd||fffd||fffd||fffd||fffd||fffd| 60000, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If m >= 60000 Then
        InsertRangeToSheet = -4
        Exit Function
    End If
    
    'Debug.Print "1=", Time
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    
    For i = 1 To m - 1
        Range("Data_RPS").Cells(i + 1, 1).EntireRow.Insert Shift:=xlShiftDown
    Next
    
    'Debug.Print "1=", Timer
    
    For i = 1 To nRowsSpr1
        If Len(Trim(Range(sNameSpr1).Cells(i, 1))) <> 0 Then
            For n = 1 To nRowsSpr2
    '            For k = 1 To nRowsSpr3
    '                If lngCount < m - 1 Then
    '                Range("Data_RPS").Cells(lngCount + 1, 1).EntireRow.Insert Shift:=xlShiftDown
    '                End If
                     If Len(Trim(Range(sNameSpr2).Cells(n, 1))) <> 0 Then
                      lngCount = lngCount + 1
                       Range("Data_RPS").Cells(lngCount, 1).Value = Range(sNameSpr1).Cells(i, 1) _
                                                        & Range(sNameSpr2).Cells(n, 1) '_
                                                        '+ Range(sNameSpr3).Cells(k, 1)
                    End If
    '            Next k
            Next n
         End If
    Next i
    'Debug.Print "1=", Timer
    Range("Data_RPS").Cells(lngCount + 1, 1).EntireRow.Delete
    
    ' |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd|. |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_BSR"
    ' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Sheet1"
    
    ' "0,1,0" - |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"BSR" |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    ' |fffd| |fffd||fffd||fffd|.1 |fffd| "Data_Sheet1" |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| ("0")
    ' |fffd| |fffd||fffd||fffd|.2 |fffd| "Data_Sheet1" |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|.1 |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "RPS"("1")
    ' |fffd| |fffd||fffd||fffd|.3 |fffd| "Data_Sheet1" |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| ("0")
    ' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| "RPS" |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd|. "Data_Sheet1"
    
  'l = objSvod.InsertSprToSheet(ActiveWorkbook, sNameRange, sNameSpr, "2,0,0")
    'Debug.Print "1=", Timer
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| sNameRange ("Data_Sheet1") |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd|
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| sNameSpr ("RPS")
    ' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| nColR(=2) |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Sheet1" |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "RPS"|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "a"
    
    nColR = Range(sNameRange).Columns.Count
    For i = 3 To nColR
        objSvod.AddNewNames ActiveWorkbook, sNameSpr, 1, sNameRange, i, Chr(94 + i)
    Next
    'Debug.Print "1=", Timer
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Sheet1" |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 1 |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 2
'    objSvod.MergeCellsOfRange ActiveWorkbook, sNameRange, 1, 2
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Sheet1" |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 9
'    objSvod.AutoFillColumn ActiveWorkbook, sNameRange, 3
    
    InsertRangeToSheet = -1

End Function

Public Function SheetVarForm()

On Error Resume Next
DoEvents
If HasName("Total_Debet") = False Then
  frmAddRow1.fRasstF1251
End If
SheetVarForm = -1

End Function

Public Function AddRowsFromRange(ByVal sprNameRange As String, ByVal MyRange As String, ByVal ColBegin As Long) As Long
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd| Range("Data_Sheet1") |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| sprNameRange
    Dim nrows As Integer
    Dim i As Integer
    Dim j As Integer
    Dim n As Integer
    Dim kod As String
    Dim nRowsSpr As Integer
    Dim lNameCell As Integer
    Dim nColRange As Integer
    Dim sTemp As String
    Dim sSheet As String
    Dim nCountRange As Integer
    Dim sOldKod  As String
    Dim nRowRange As Integer
    Dim KodSpr As String, k As Integer
    Dim lYes As Boolean, Sprav As String
    
    On Error GoTo errHandler

''   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    sSheet = Application.ActiveSheet.Name

' |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| sNameSpr2
    nRowsSpr = Range(sprNameRange).Rows.Count
    lNameCell = Len(Trim(Range(sprNameRange).Cells(1, 1)))
    
    nColRange = Range(MyRange).Columns.Count

    If Len(Trim(Range(sprNameRange).Cells(1, 1))) <> 0 Then
        sOldKod = ""
        For i = 1 To nRowsSpr
    
            kod = Mid(Range(sprNameRange).Cells(i, 1), 3, lNameCell - 3)
            If kod = sOldKod Then
            Else
                If Not (Trim(kod) = "") Then
                    sOldKod = kod
                    nCountRange = Range(MyRange).Rows.Count
                
                    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                    Range(MyRange).Cells(nCountRange, 1).EntireRow.Insert Shift:=xlShiftDown
                    Range(MyRange).Cells(nCountRange, ColBegin).Value = kod
                    n = 0
                    For j = ColBegin + 1 To nColRange
                        Range(MyRange).Cells(nCountRange, j).Select
                        
                        ' ' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
                        Set tRange = Application.Selection
                        
                         ActiveWorkbook.Names.Add Name:="ss" & kod & Chr(97 + n), RefersToR1C1:="=" & sSheet & "!R" & Selection.Row & "C" & Selection.Column
                         
        '   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
        '   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
                        nRowRange = Range("Data_Cells").Rows.Count
                        Range("Data_Cells").Cells(nRowRange, 1).EntireRow.Insert Shift:=xlShiftDown
                        Range("Data_Cells").Cells(nRowRange, 1).Value = "ss" & kod & Chr(97 + n)
                        Range("Data_Cells").Cells(nRowRange, 2).Value = "F"
                        Range("Data_Cells").Cells(nRowRange, 3).Value = "2"
                        n = n + 1
                        
                    Next j
                    
                    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| (129)
                    lYes = False
                    KodSpr = Left(kod, 17)
                    For k = 1 To Range("Data_FKR").Rows.Count
                        If Range("Data_FKR").Cells(k, 1).Value = KodSpr Then
                             Range(MyRange).Cells(nCountRange, 1).Value = Range("Data_FKR").Cells(k, 2).Value
                             lYes = True
                             Exit For
                        End If
                    Next
                    For m = 1 To 3
                        KodSpr = Left(kod, 20)
                        Select Case m
                            Case 1
                                Sprav = "Data_KLD"
                            Case 2
                                Sprav = "Data_IFR"
                            Case 3
                                Sprav = "Data_IFV"
                        End Select
                        If lYes = False Then
                            For k = 1 To Range(Sprav).Rows.Count
                                If Range(Sprav).Cells(k, 1).Value = KodSpr Then
                                     Range(MyRange).Cells(nCountRange, 1).Value = Range(Sprav).Cells(k, 2).Value
                                     lYes = True
                                     Exit For
                                End If
                            Next k
                        End If
                    Next m
                End If
              End If
          Next i
    End If
          
    AddRowsFromRange = -1
          
    Exit Function
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRowsFromRange)"
    AddRowsFromRange = -8
End Function







Attribute VB_Name = "mdLib"
''''''''''''''''''''''''''''''''''''''''''''
'**** Version 28.07.2005 *******************
''''''''''''''''''''''''''''''''''''''''''''
Option Explicit

Public objSvod As Object
Public objSprForms As Object
Public Const RangeRek As String = "Data_Cells"
Public strNameCell As String
Public colValues As Collection
'Public FormSpr As Object
Public Const cKod = "Kod_"
Public Const cName = "Name_"
Public Const cData = "Data_"
Public bEnabledOKATO As Boolean ''<Spir> 04.09.2019 ~8639
Public bEnabledVB  As Boolean   ''<Spir> 04.09.2019 ~8639
Public bSelEnabled As Boolean   ''<Spir> 04.09.2019 ~8639
Public arrSprKod1   ''<Spir> 04.09.2019 ~8639
Public arrSprKod2   ''<Spir> 04.09.2019 ~8639



Public Function IsSvod() As Boolean
    IsSvod = True
End Function

Public Function VarForm() As Long


'      vR = 5 / 0
     VarForm = SheetVarForm()
 '   fAvteZapolnenie
     SetFormula
'    Application.Calculate
End Function
     
Private Sub SetFormula()
On Error Resume Next
fUnProtect True
Range("Naim_STOPdata").FormulaLocal = "=SetStrData(A1;Kod_STOPdata)"
    Range("Naim_STOPdata").Calculate
    
    Range("Naim_MODdata").FormulaLocal = "=SetStrData(A2;Kod_MODdata)"
    Range("Naim_MODdata").Calculate
'    ActiveCell.FormulaLocal = "=SetStrData(B5;Kod_STOPdata)"
End Sub

Public Sub ChangeFormatCells(ByVal NameRange As String, ByVal SpravEI As Integer, ByVal Col As Integer)
 '
    Dim nrows, i As Integer
    Dim strFormat As String
    Dim strNameCell As String
    Dim strNameList As String
    
    Application.ScreenUpdating = False
  
      Select Case Col
          Case 0
            strFormat = "0"
          Case 1
            strFormat = "0.0"
          Case 2
            strFormat = "0.00"
          Case 3
           strFormat = "0.000"
          Case 4
           strFormat = "0.0000"
     End Select
'   nrows - |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
    nrows = Range(NameRange).Rows.Count
'
    For i = 1 To nrows
        strNameCell = Range(NameRange).Cells(i, 1)
        If Range(NameRange).Cells(i, 5) = SpravEI And _
           Left(Range(NameRange).Cells(i, 1).Value, 2) = "ss" Then
           If Range(NameRange).Cells(i, 3) <> Col Then
             Range(NameRange).Cells(i, 3) = Col
              strNameList = ActiveSheet.Name
              Sheets(Range(strNameCell).Worksheet.Name).Select
              Range(strNameCell).Select
              Selection.NumberFormat = strFormat
'              Range(strNameCell) = Round(Range(strNameCell))
'                Call RoundCells(strNameCell)
              Sheets(strNameList).Activate
           End If
           
       End If
    Next i
        Range("Name_OTD").Activate
        Application.ScreenUpdating = True
End Sub



Public Function SetStrData(ByVal sVoise As Range, ByVal sNameRange As Range) As String

'    Dim objSvod As Object
'    Set objSvod = CreateObject("rasExRng.clsWork")
   ' If Application.ScreenUpdating Then
        SetStrData = objSvod.setdataname(CStr(sVoise), CDate(sNameRange))
  '  End If
'    Set objSvod = Nothing

End Function
 Public Sub ProtectXlt()
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim Sheet As Object
    
'    On Error Resume Next
    Application.ScreenUpdating = False
    
    For Each Sheet In Worksheets
        If Sheet.ProtectContents = False Then
            If Val(Application.Version) > 9 Then
                Sheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True _
                , AllowFormattingColumns:=True, AllowFormattingRows:=True, password:=objSvod.PasswordName
            Else
                Sheet.Protect DrawingObjects:=True, Contents:=True, Scenarios:=True, password:=objSvod.PasswordName
            End If
        End If
    Next Sheet
    
   If ActiveWorkbook.ProtectStructure = False Then
        ActiveWorkbook.Protect Structure:=True, Windows:=False, password:=objSvod.PasswordName
    End If
    
    Application.ScreenUpdating = True

End Sub
 Public Sub UnProtectXlt()
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim Sheet As Worksheet
    
    On Error Resume Next
    Application.ScreenUpdating = False
    
    ActiveWorkbook.Unprotect password:=objSvod.PasswordName
    
    For Each Sheet In Worksheets
        If Sheet.ProtectContents = True Then
            Sheet.Unprotect password:=objSvod.PasswordName
        End If
    Next Sheet
    
    Application.ScreenUpdating = True
    
End Sub
                               
Public Function OpenWorkbook() As Long

    On Error GoTo errHandler
    
    Set objSvod = CreateObject("rasExRng.clsWork")
    Set objSprForms = CreateObject("rasDS.DataSpravs")
    If objSprForms.iCodeError <> 0 Then
       MsgBox (objSprForms.cErrorTextMessage)
    End If
     
'     Set FormSpr = New frmAddRow
'     Load FormSpr
    
    If objSvod Is Nothing Or objSprForms.iCodeError <> 0 Then
        OpenWorkbook = 0    ' |fffd||fffd||fffd||fffd||fffd||fffd| OpenWorkbook
    Else
        OpenWorkbook = -1   ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
    End If
    
    Exit Function
    
errHandler:
    OpenWorkbook = Err.Number
'    Application.Calculate
End Function
Public Sub CloseWorkbook()

'    FormSpr.IsUnload = True
'    Unload FormSpr
    Set objSvod = Nothing
    Set objSprForms = Nothing
    
End Sub
Public Function EmptySpr(ByVal NameSpr As String) As Boolean
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| True, |fffd||fffd||fffd||fffd| NameSpr |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd|,|fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| False

    If Range(NameSpr).Rows.Count <= 2 Then
        If IsEmpty(Range(NameSpr).Cells(1, 1)) Then
            EmptySpr = True
        Else
            EmptySpr = False
        End If
    Else
        EmptySpr = False
    End If
    
End Function
Public Function FoundIndex(ByVal NameSpr As String, ByVal cVal As String) As Long
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| cVal |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| NameSpr,
'   |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| 0

    Dim i As Long
    
    FoundIndex = 0
    For i = 1 To Range(NameSpr).Rows.Count
        If Trim(Range(NameSpr).Cells(i, 1).Value) = cVal Then
            FoundIndex = i - 1
            Exit For
        End If
    Next i
    
End Function

Public Sub IzmenEI(ByVal Old_izm As String, ByVal New_izm As String, ByVal sCol As String)

'
'  382 - |fffd||fffd||fffd||fffd||fffd|
'  383 - |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'  384 - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
'  385 - |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|

            Select Case Old_izm
                Case 383  '  - |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
                    Select Case New_izm
                        Case 382  '  - |fffd||fffd||fffd||fffd||fffd|
                            Call RoundCells("1", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                        Case 384, 385
                            Call RoundCells("1000", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
                Case 382
                    Select Case New_izm
                        Case 383
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                        Case 384, 385
                            Call RoundCells("1000", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
                Case 384
                    Select Case New_izm
                        Case 382, 383, 385
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
                 Case 385
                    Select Case New_izm
                        Case 384
                            Call RoundCells("1", sCol)
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                        Case 383, 382
                            Call ChangeFormatCells(RangeRek, "0", sCol)
                    Case Else
                    End Select
               Case Else
            End Select
   

End Sub
Public Sub RoundCells(ByVal sDel As String, ByVal sCol As String)
Dim Msg, Response, MyString, Style

    Dim nrows, i As Integer
    Dim strFormat As String
    Dim sNameCell As String
    Dim strNameList As String
    
'   nrows - |fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
    nrows = Range(RangeRek).Rows.Count

    Application.ScreenUpdating = False
  
    Msg = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| ?"
    Style = vbYesNo + vbCritical + vbDefaultButton2

     Response = MsgBox(Msg, Style)
        If Response = vbYes Then
            MyString = "Yes"
    For i = 1 To nrows
            sNameCell = Range(RangeRek).Cells(i, 1)
        If Left(Range(RangeRek).Cells(i, 1).Value, 2) = "ss" Then
              strNameList = ActiveSheet.Name
              Sheets(Range(sNameCell).Worksheet.Name).Select
              Range(sNameCell).Select
'
            If Left((Range(sNameCell).FormulaR1C1), 1) <> "=" Then
                  Range(sNameCell) = Round(Range(sNameCell) / sDel, sCol)
            End If
'
        End If
    Next i

        Else
            MyString = "No"
        End If
'
        Application.ScreenUpdating = True

End Sub


Public Sub VisibleNullStr(ByVal IsVisible As Boolean, _
                            ByRef objRange As Range, _
                            Optional ByVal lngColBeg As Long, _
                            Optional ByVal lngColEnd As Long)
                            
' |fffd| |fffd||fffd|.|fffd||fffd||fffd|. objRange |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| lngColBeg |fffd||fffd| lngColEnd

    Dim i As Long
    Dim j As Long
    
    Application.ScreenUpdating = False
   
    On Error GoTo errHandler
    
    With objRange
        If IsVisible Then
            For i = 1 To .Rows.Count
                Rows(i + .Row - 1).EntireRow.Hidden = False
'                Selection.
            Next
        Else
            For i = 1 To .Rows.Count
                For j = lngColBeg To lngColEnd
                    If .Cells(i, j) <> 0 Then
                        Exit For
                    End If
                Next
                If j > lngColEnd Then
                    Rows(i + .Row - 1).EntireRow.Hidden = True
              End If
            Next
        End If
    End With
    
    Exit Sub
    
errHandler:
    MsgBox "|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|" & vbCrLf & _
            "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|: " & Err.Number, vbOKOnly + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd|"
            
        Application.ScreenUpdating = True
End Sub

Public Sub AddRekv(ByVal ObjRekvs As Object)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim i As Long
    Dim sSprav As String
    Dim cKodR, cNameR, cCol3R As String
    Dim Old_EI, New_EI As String
    
    On Error GoTo errHandler
    
    Old_EI = Application.Range("Kod_EI").Cells(1, 1)
    
'    Set FormSpr = New frmAddRow
'    Load FormSpr
'    Set FormSpr.ObjectDataSprav = ObjRekvs
'    FormSpr.Repaint

'    FormSpr.Show
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If colValues.Count <> 0 Then
       With ObjRekvs.SpravCollection
           If .Count > 0 Then
               For i = 1 To .Count
                   With .Item(Val(i))
                       If Not (.cControl Like "but*") Then
                           cKodR = cKod & .cSprav
                           cNameR = cName & .cSprav
                           Range(cKodR).Value = colValues.Item(cKodR)
                           Range(cNameR).Value = colValues.Item(cNameR)
                        End If
                        If .cSprav = "EI" Then
                            New_EI = Application.Range("Kod_EI").Cells(1, 1)
                            Call IzmenEI(Old_EI, New_EI, colValues.Item("Col3_EI"))
                        End If
                  End With
               Next i
           End If
       End With
     
    End If
 
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRekv)"
    Resume Next

End Sub

Public Sub AddRow(ByVal ObjRekvs As Object)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Dim i As Long
    Dim sSprav As String
    Dim cKodR, cNameR, cCol3R As String
    Dim Old_EI, New_EI As String
    
    On Error GoTo errHandler
    
    
'    Set FormSpr = New frmAddRow
'    Load FormSpr
'    Set FormSpr.ObjectDataSprav = ObjRekvs
    
'    FormSpr.Show
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    If colValues.Count <> 0 Then
       With ObjRekvs.SpravCollection
           If .Count > 0 Then
               For i = 1 To .Count
                   With .Item(Val(i))
                       If Not (.cControl Like "but*") Then
                           cKodR = cKod & .cSprav
                           cNameR = cName & .cSprav
                           Range(cKodR).Value = colValues.Item(cKodR)
                           Range(cNameR).Value = colValues.Item(cNameR)
                        End If
                  End With
               Next i
           End If
       End With
     
    End If
 
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRekv)"
    Resume Next

End Sub

Public Sub AddRowToRange(ByVal KodRow As String, ByVal MyRange As String, ByVal ColBegin As Long)
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange
' |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| ColBegin |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| KodRow
' |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Cells"

    Dim nrows As Integer
    Dim kod As String
    Dim sSheet As String
    Dim nColRange, nCountRange As Long
    Dim i As Long
    Dim j As Long
    Dim nRowRange As Integer
   
    On Error GoTo errHandler
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    sSheet = Application.ActiveSheet.Name
    
'   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange
    nColRange = Range(MyRange).Columns.Count
    nCountRange = Range(MyRange).Rows.Count
    
 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange
    For i = 1 To nCountRange
        If KodRow = Trim(Range(MyRange).Cells(i, ColBegin).Value) Then
            MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd| " & KodRow & " |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
            Exit Sub
        End If
    Next i
     
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
    Range(MyRange).Cells(nCountRange, 1).EntireRow.Insert Shift:=xlShiftDown
    Range(MyRange).Cells(nCountRange, ColBegin).Value = KodRow
    i = 0
    For j = ColBegin + 1 To nColRange
       Range(MyRange).Cells(nCountRange, j).Select
       ActiveWorkbook.Names.Add Name:="ss" & KodRow & Chr(97 + i), RefersToR1C1:="=" & sSheet & "!R" & Selection.Row & "C" & Selection.Column
         
'    '  |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| MyRange |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| j
'       objSvod.AutoFillColumn ActiveWorkbook, MyRange, j
                     
    '   |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|. |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd| "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|"
    '   |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|-|fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| Data_Cells
        nRowRange = Range("Data_Cells").Rows.Count
        Range("Data_Cells").Cells(nRowRange, 1).EntireRow.Insert Shift:=xlShiftDown
        Range("Data_Cells").Cells(nRowRange, 1).Value = "ss" & KodRow & Chr(97 + i)
        Range("Data_Cells").Cells(nRowRange, 2).Value = "F"
        Range("Data_Cells").Cells(nRowRange, 3).Value = "2"
        i = i + 1
    Next j
    
    Range(MyRange).Cells(nCountRange, ColBegin + 1).Select
    
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (AddRowToRange)"
    Resume Next

End Sub


Attribute VB_Name = "|fffd||fffd||fffd||fffd|1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub cmbSaveAs_Click()
' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd|
    
    Dim NameFile As Variant
   
    NameFile = Application.GetSaveAsFilename(Application.ActiveWorkbook.Name, _
            "|fffd||fffd||fffd||fffd||fffd| Microsoft Ecxel (*.xls), *.xls", , _
            "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|")
    If NameFile <> False Then
        Application.ActiveWorkbook.SaveCopyAs Filename:=NameFile
    End If

End Sub





'Private Sub cmbSelectRekvizit_Click()
'
'    On Error GoTo errHandler
'
'    Call UnProtectXlt
'
'    Call AddRekv(objSprForms.Item("REKV125FK"))
'
'    Call ProtectXlt
'
'    Exit Sub
'
'errHandler:
'    MsgBox Err.Number & " - " & Err.Description & ". (cmbSelectRekvizit_Click)"
'    Resume Next
'
'End Sub

Private Sub cmbAddRow_Click()
 ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| ("KBK129")
   
    Dim i As Long
    Dim cDataR As String
    Dim lEmpty As Boolean
    Dim cMSG As String
    Dim cKodStr As String
    Dim cNameStr As String
    
    On Error GoTo errHandler
    
    ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'    With objSprForms.Item("KBK129").SpravCollection
'        If .Count > 0 Then
'            For i = 1 To .Count
'                If Len(Trim(.Item(Val(i)).cName)) <> 0 Then
'                    cDataR = cData & .Item(Val(i)).cSprav
'                    lEmpty = EmptySpr(cDataR)
'                    If lEmpty = True Then
'                        cMSG = cMSG & .Item(Val(i)).cName & ", "
'                    End If
'                End If
'            Next i
'        End If
'    End With
'    If Len(cMSG) > 0 Then
'       MsgBox "|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| " & vbCrLf & cMSG & vbCrLf & _
'            "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|", , "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|"
'    Else
        Call UnProtectXlt
        
        Set FormSpr.ObjectDataSprav = objSprForms.Item("KBK129")
        FormSpr.ObjectName = "KBK129"

        FormSpr.Show
        
        ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
        If colValues.Count <> 0 Then
           If colValues.Item("optD") = True Then
                cKodStr = colValues.Item("Kod_KLD")
                cNameStr = colValues.Item("Name_KLD")
           End If
           If colValues.Item("optR") = True Then
                cKodStr = colValues.Item("Kod_FKR") & colValues.Item("Kod_SGU")
                cNameStr = colValues.Item("Name_FKR")
           End If
           If colValues.Item("optFR") = True Then
                cKodStr = colValues.Item("Kod_IFR")
                cNameStr = colValues.Item("Name_IFR")
           End If
           If colValues.Item("optFV") = True Then
                cKodStr = colValues.Item("Kod_IFV")
                cNameStr = colValues.Item("Name_IFV")
           End If
           
           If Len(Trim(cKodStr)) > 0 Then
                Call AddRowToRange(cKodStr, "Data_Sheet1", 2)
                
                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|
                 Cells(ActiveCell.Row, 1).Value = cNameStr

'                ' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| "Data_Sheet1" |fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 1 |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| 3
'                  objSvod.MergeCellsOfRange ActiveWorkbook, "Data_Sheet1", 1, 3

           End If
        End If
       
        Call ProtectXlt
'    End If
    
    Exit Sub
    
errHandler:
    MsgBox Err.Number & " - " & Err.Description & ". (cmbAddRow_Click)"
    Resume Next
    
End Sub






Private Sub Worksheet_Activate()
On Error Resume Next
cmdBarsShow
'ActiveSheet.OLEObjects("CmdRecalcItog").Object.Enabled = False

End Sub

Attribute VB_Name = "|fffd||fffd||fffd||fffd|2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub


Attribute VB_Name = "|fffd||fffd||fffd||fffd|6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_SelectionChange(ByVal Target As Range)

End Sub


Attribute VB_Name = "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Workbook_Open()
On Error Resume Next
s = GetRegistrValue & "lnc2.xla"
Application.VBE.ActiveVBProject.References.AddFromFile s
Application.Run "lnc2.xla!fOpen"
Application.Run "lnc2.xla!cmdBarsShow"
ActiveWorkbook.Saved = True
End Sub

Public Sub CallFormAdd()
Dim s$, r As Range
Set r = Range("Kod_Account")
s = Trim$(r.Cells(1, 1).Value)
If Len(s) = 0 Then
    MsgBox "|fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|!"
    Exit Sub
End If

'    s = sGetINI("|fffd||fffd||fffd||fffd|1!|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd|", "?")
'    If s = "?" Or fNullspr(s) = False Then Exit Sub
    frmAddRow1.Show
End Sub



Private Sub Workbook_BeforeClose(Cancel As Boolean)
'    Dim i As Long
'
'    If ActiveSheet.OLEObjects("CmdRecalcItog").Object.Enabled = True Then
'       i = MsgBox("|fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|.|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|?", vbYesNo, "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd|!")
'       If i = vbYes Then
'         Application.Run "lnc2.xla!F1251_newItogo"
'       End If
'    End If
   
    
    With Application.VBE.ActiveVBProject.References
        For i = .Count To 1 Step -1
            If Right$(.Item(i).Name, 4) = "lnc2" Then
                Application.DisplayAlerts = True
                .Remove .Item(i)
                Exit For
            End If
        Next
    End With



End Sub


Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
    On Error Resume Next
    
    Dim strName As String
    Dim strNameRange As String
    Dim i As Long
    Dim kodRekv As String
    Dim kodFKR As String
    
    Static blnChange As Boolean

    If blnChange Then
        blnChange = False
        Exit Sub
    End If
    strName = Target.Name
    If Len(strName) > 0 Then
        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
        strNameRange = Application.Names(, , CStr(strName)).Name
        If Len(strNameRange) > 0 Then
            If (Left(strNameRange, 2) = "ss" And Left(strNameRange, 6) <> "ss5000" And Left(strNameRange, 6) <> "ss3000") Then
                With Range("Data_Cells")
                    For i = 1 To .Rows.Count
                        If .Cells(i, 1) = strNameRange Then
                            If .Cells(i, 2) = "F" Then
                                If (Len(CStr(CCur(Target) - Int(CCur(Target)))) - 2) > .Cells(i, 3) Then
                                    MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & .Cells(i, 3) & " |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| ", vbOKOnly + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd|"
                                End If
                                blnChange = True
                                Target = Round(Target, .Cells(i, 3))
                            End If
                            Exit For
                        End If
                    Next
                End With
            End If
            
            '' |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| INN (|fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|) Spir 25/03/2015
            If Right(strNameRange, 1) = "c" And Left(strNameRange, 2) = "ss" And Len(Trim(Range(strNameRange).Cells(1, 1).Value)) = 8 Then
                blnChange1 = True
                Range(Left(strNameRange, Len(strNameRange) - 1) & "p").Value = 0
            End If
            If Right(strNameRange, 1) = "c" And Left(strNameRange, 2) = "ss" And Len(Trim(Range(strNameRange).Cells(1, 1).Value)) <> 8 Then
                blnChange1 = True
                Range(Left(strNameRange, Len(strNameRange) - 1) & "p").Value = 1
            End If
            
        End If
        
        ''
    
    End If
End Sub

'Private Sub Workbook_SheetChange(ByVal Sh As Object, ByVal Target As Range)
'    '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd|
'    On Error Resume Next
'
'    Dim strName As String
'    Dim strNameRange As String
'    Dim i As Long
'    Dim kodRekv As String
'    Dim kodFKR As String
'
'    Static blnChange As Boolean
'
'    If blnChange Then
'        blnChange = False
'        Exit Sub
'    End If
'    strName = Target.Name
'    If Len(strName) > 0 Then
'        '|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd| |fffd| |fffd||fffd||fffd||fffd||fffd||fffd|, |fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd||fffd|
'        strNameRange = Application.Names(, , CStr(strName)).Name
'        If Len(strNameRange) > 0 Then
'            With Range("Data_Cells")
'                For i = 1 To .Rows.Count
'                    If .Cells(i, 1) = strNameRange Then
'                        If .Cells(i, 2) = "F" Then
'                            If (Len(CStr(CCur(Target) - Int(CCur(Target)))) - 2) > .Cells(i, 3) Then
'                                MsgBox "|fffd||fffd||fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd||fffd| |fffd| " & .Cells(i, 3) & " |fffd||fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| |fffd||fffd||fffd||fffd||fffd| ", vbOKOnly + vbCritical, "|fffd||fffd||fffd||fffd||fffd||fffd|"
'                            End If
'                            blnChange = True
'                            Target = Round(Target, .Cells(i, 3))
' '                           Target.Activate
' '                           Beep
'                        End If
'                        Exit For
'                    End If
'                Next
'            End With
'        End If
'
'        ''
'
'    End If
'End Sub



INQUEST-PP=macro
