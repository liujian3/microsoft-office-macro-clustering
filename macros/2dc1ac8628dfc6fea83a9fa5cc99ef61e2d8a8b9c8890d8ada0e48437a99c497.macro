Attribute VB_Name = "List1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "ComboBox1, 18, 0, MSForms, ComboBox"
Attribute VB_Control = "ComboBox2, 19, 1, MSForms, ComboBox"
Option Explicit

Private Sub ComboBox1_Change()
    Dim vrednost
    Dim izvor As Range
10  Set izvor = Range(ComboBox1.ListFillRange)
20  vrednost = izvor.Offset(ComboBox1.ListIndex, 0).Resize(1, 1).Value
30  Worksheets("Osnovni podatki").Range("c36").Value = vrednost

End Sub

Private Sub ComboBox2_Change()
    Dim vrednost
    Dim izvor As Range
10  Set izvor = Range(ComboBox2.ListFillRange)
20  vrednost = izvor.Offset(ComboBox2.ListIndex, 0).Resize(1, 1).Value
30  Worksheets("Osnovni podatki").Range("enostavno_knjigovodstvo").Value = vrednost
End Sub

Private Sub worksheet_change(ByVal Target As Excel.Range)
    Dim VRange As Range, cell, celica As Range
    Dim obmocje As Range, obr_velikost As Range

    Dim Msg As String
    Dim ValidateCode As Variant
10  On Error GoTo worksheet_change_Error

20  Set VRange = Range("m")
30  Set obmocje = Range("Velikost")
40  Set obr_velikost = Range("Obr_velikost")
50  For Each cell In Target
60      If Union(cell, VRange).Address = VRange.Address And Len(VRange.Value) = 7 And IsNumeric(VRange) Then
70          Application.EnableEvents = False
80          VRange.Value = VRange.Value * 1000
90          Application.EnableEvents = True
100     End If

110 Next cell
120 For Each celica In Target
130     If Union(celica, obmocje).Address = obmocje.Address Then
140         If Not IsEmpty(obmocje) Then
150             If obmocje.Value <> obr_velikost.Value Then
160                 Worksheets("Osnovni podatki").Unprotect Password:="nuladva"
170                 Range("a25").EntireRow.Hidden = False
180                 Worksheets("Osnovni podatki").Protect Password:="nuladva"
190                 obmocje.Select
200             Else
210                 Worksheets("Osnovni podatki").Unprotect Password:="nuladva"
220                 Range("a25").EntireRow.Hidden = True
230                 Worksheets("Osnovni podatki").Protect Password:="nuladva"
240                 Range("c33").Select
250             End If
260         End If
270     End If
280 Next celica

290 On Error GoTo 0
300 Exit Sub

worksheet_change_Error:

310 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri worksheet_change v VBA Document List1"

End Sub

Attribute VB_Name = "List2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Option Explicit

Private Sub worksheet_change(ByVal Target As Excel.Range)
    Dim VRange As Range, cell As Range, celica As Range, celica1 As Range, sredstva_tek As Range, sredstva_pret As Range
    Dim Msg As String, meseci_sredstva As Range
    Dim ValidateCode As Variant, sred_tek_vred As Variant, sred_pret_vred As Variant, sporocilo As Variant
    Dim rezultat, rezultat1, kontrola_mes_sred As Boolean, sht As Worksheet
10  On Error GoTo worksheet_change_Error

20  Set VRange = Range("vnos_bs")
    'Set sredstva_tek = Range("T001_")
    'Set sredstva_pret = Range("P001_")
    'Set meseci_sredstva = Range("kontrola_mes_sredstva")
    'sred_tek_vred = sredstva_tek.Value
    'sred_pret_vred = sredstva_pret.Value
    'kontrola_mes_sred = meseci_sredstva.Value
30  Set sht = Worksheets("Osnovni podatki")
    '    Debug.Print rezultat
    '    sporocilo = "Podatek AOP 001, ki ste ga vpisali v stolpec za teko|fffd|e leto," & vbCrLf _
         '              & "se razlikuje za ve|fffd| kot 500 % od podatka za preteklo leto."
40  For Each cell In Target
50      If Union(cell, VRange).Address = VRange.Address Then
60          ValidateCode = EntryIsValid(cell)
70          If Not ValidateCode = True Then
80              Msg = "V celici(o) " & cell.Address(False, False) & " z vrednostjo " & cell.Value
90              Msg = Msg & vbCrLf & ValidateCode
100             MsgBox Msg, vbCritical, "Napa|fffd|en vnos"
110             Application.EnableEvents = False
120             cell.Value = 0
130             cell.Activate
140             Application.EnableEvents = True
150         End If
160     End If
170 Next cell

180 On Error GoTo 0
190 Exit Sub

worksheet_change_Error:

200 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri worksheet_change v VBA Document List2"
End Sub

Private Function EntryIsValid(cell) As Variant
'   Blank
10  If cell = "" Then
20      EntryIsValid = True
30      Exit Function
40  End If
    '  Numeric
50  If Not IsNumeric(cell) Then
60      EntryIsValid = "morate vnesti |fffd|tevilo!"
70      Exit Function
80  End If
    '   Integer?
    ' If CInt(cell) <> cell Then
    '    EntryIsValid = "Integer required."
    '   Exit Function
    'End If

    ' Manjse od nic
    'If cell < 0 Then
    '   EntryIsValid = "Vnos negativnih |fffd|tevil v tem obrazcu ni dovoljen!"
    '  Exit Function
    'End If
    'If cell.Value <> Int(cell.Value) Then
    '  EntryIsValid = "vnos decimalnih |fffd|tevil ni dovoljen."
    '  Exit Function
    'End If
    '   It passed all the tests
90  EntryIsValid = True
End Function





Attribute VB_Name = "List3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Option Explicit

Private Sub worksheet_change(ByVal Target As Excel.Range)
    Dim VRange As Range, cell As Range, celica As Range, celica1 As Range, celica2 As Range, obmocje As Range, obmocje_izj As Range
    Dim Msg As String, meseci_prih As Range, vrednost
    Dim ValidateCode As Variant, prih_tek As Range, prih_pret As Range, sht As Worksheet, sht1 As Worksheet
    Dim str_plac As Variant, str_pok_zav As Variant, str_soc_zav As Variant
    Dim str_plac_pret As Variant, str_pok_pret As Variant, str_soc_pret As Variant
    Dim prih_tek_vred As Variant, prih_pret_vred As Variant, sred_tek_vred As Variant
    Dim rezultat As Variant, rezultat1 As Variant, sporocilo As Variant, kontrola_mes_prih As Boolean
    '    Dim povprecna_placa As Double
    '    Dim napaka As Boolean
10  On Error GoTo worksheet_change_Error

20  Set VRange = Range("vnos_ipi")
30  Set obmocje = Range("vnos_zav_tek")    'aop 140 - 142 tekoce in preteklo
40  str_plac = Range("e37").Value
50  str_pok_zav = Range("e38").Value
60  str_soc_zav = Range("e39").Value
70  str_plac_pret = Range("f37").Value
80  str_pok_pret = Range("f38").Value
90  str_soc_pret = Range("f39").Value
100 Set sht = Worksheets("Osnovni podatki")
110 Set sht1 = Worksheets("Izjava")
120 Set obmocje_izj = sht1.Range("izjava_opredelitev")
130 vrednost = Range("a111").Value    'obravnavana velikost 1 ali 2 in podatek za racunovodimo SRS
    '    Debug.Print rezultat
    'sporocilo = "Podatek AOP 050, ki ste ga vpisali v stolpec za teko|fffd|e leto," & vbCrLf _
     '        & "se razlikuje za ve|fffd| kot 500 % od podatka za preteklo leto."
140 For Each cell In Target
150     If Union(cell, VRange).Address = VRange.Address Then
160         ValidateCode = EntryIsValid(cell)
170         If Not ValidateCode = True Then
180             Msg = "V celici(o) " & cell.Address(False, False) & " z vrednostjo " & cell.Value
190             Msg = Msg & vbCrLf & ValidateCode
200             MsgBox Msg, vbCritical, "Napa|fffd|en vnos"
210             Application.EnableEvents = False
220             cell.Value = 0
230             cell.Activate
240             Application.EnableEvents = True
250         End If
260     End If
270 Next cell
280 For Each celica1 In Target
290     If Union(celica1, VRange).Address = VRange.Address Then
300         Application.ScreenUpdating = False
310         If vrednost = 1 Then
320             Application.EnableEvents = False
330             sht1.Unprotect Password:="nuladva"
340             obmocje_izj.Value = "DA"
350             obmocje_izj.Locked = False
360             sht1.Protect Password:="nuladva"
370             Application.EnableEvents = True
380         Else
390             Application.EnableEvents = False
400             sht1.Unprotect Password:="nuladva"
410             obmocje_izj.Value = "NE"
420             obmocje_izj.Locked = True
430             sht1.Protect Password:="nuladva"
440             Application.EnableEvents = True
450         End If
460         Application.ScreenUpdating = True
470     End If
480 Next celica1
490 For Each celica In Target
500     If Union(celica, obmocje).Address = obmocje.Address Then
510         If Application.WorksheetFunction.IsNumber(str_plac) Then
520             If str_plac > 0 Then
530                 If str_pok_zav <= 0 Then
540                     MsgBox ("AOP 140 (teko|fffd|e leto) je > 0, zato mora biti tudi AOP 141 (teko|fffd|e leto) > 0.")
550                 End If
560             End If
570         End If
580         If Application.WorksheetFunction.IsNumber(str_pok_zav) Then
590             If str_pok_zav > 0 Then
600                 If str_soc_zav <= 0 Then
610                     MsgBox ("AOP 141 (teko|fffd|e leto) je > 0, zato mora biti tudi AOP 142 (teko|fffd|e leto) > 0.")
620                 End If
630             End If
640         End If
650         If Application.WorksheetFunction.IsNumber(str_soc_zav) Then
660             If str_soc_zav > 0 Then
670                 If str_pok_zav <= 0 Then
680                     MsgBox ("AOP 142 (teko|fffd|e leto) je > 0, zato mora biti tudi AOP 141 (teko|fffd|e leto) > 0.")
690                 End If
700             End If
710         End If
720         If Application.WorksheetFunction.IsNumber(str_plac_pret) Then
730             If str_plac_pret > 0 Then
740                 If str_pok_pret <= 0 Then
750                     MsgBox ("AOP 140 (preteklo leto) je > 0, zato mora biti tudi AOP 141 (preteklo leto) > 0.")
760                 End If
770             End If
780         End If
790         If Application.WorksheetFunction.IsNumber(str_pok_pret) Then
800             If str_pok_pret > 0 Then
810                 If str_soc_pret <= 0 Then
820                     MsgBox ("AOP 141 (preteklo leto) je > 0, zato mora biti tudi AOP 142 (preteklo leto) > 0.")
830                 End If
840             End If
850         End If
860         If Application.WorksheetFunction.IsNumber(str_soc_pret) Then
870             If str_soc_pret > 0 Then
880                 If str_pok_pret <= 0 Then
890                     MsgBox ("AOP 142 (preteklo leto) je > 0, zato mora biti tudi AOP 141 (preteklo leto) > 0.")
900                 End If
910             End If
920         End If
930     End If
940 Next celica

950 On Error GoTo 0
960 Exit Sub

worksheet_change_Error:

970 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri worksheet_change v VBA Document List3"
End Sub

Private Function EntryIsValid(cell) As Variant
'   Blank
10  If cell = "" Then
20      EntryIsValid = True
30      Exit Function
40  End If
    '  Numeric
50  If Not IsNumeric(cell) Then
60      EntryIsValid = "morate vnesti |fffd|tevilo!"
70      Exit Function
80  End If
    '   Integer?
    ' If CInt(cell) <> cell Then
    '    EntryIsValid = "Integer required."
    '   Exit Function
    'End If
    ' Manjse od nic
    'If cell < 0 Then
    '   EntryIsValid = "Vnos negativnih |fffd|tevil v tem obrazcu ni dovoljen!"
    '  Exit Function
    'End If
    'If cell.Value <> Int(cell.Value) Then
    '  EntryIsValid = "vnos decimalnih |fffd|tevil ni dovoljen."
    '  Exit Function
    'End If
    '   It passed all the tests
90  EntryIsValid = True
End Function





Attribute VB_Name = "List4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "List8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Private Sub Worksheet_Activate()
    Dim sht As Worksheet, sht1 As Worksheet
10  On Error GoTo Worksheet_Activate_Error

20  Set sht = Worksheets("IPI")
30  Set sht1 = Worksheets("Izjava")
40  Application.ScreenUpdating = False
50  If sht.Range("A111").Value = 1 Then
60      Application.EnableEvents = False
70      sht1.Unprotect Password:="nuladva"
80      sht1.Range("Izjava_opredelitev").Value = "DA"
90      sht1.Range("Izjava_opredelitev").Locked = False
100     sht1.Protect Password:="nuladva"
110     Application.EnableEvents = True
120 Else
130     Application.EnableEvents = False
140     sht1.Unprotect Password:="nuladva"
150     sht1.Range("Izjava_opredelitev").Value = "NE"
160     sht1.Range("Izjava_opredelitev").Locked = True
170     sht1.Protect Password:="nuladva"
180     Application.EnableEvents = True
190 End If
200 Application.ScreenUpdating = True

210 On Error GoTo 0
220 Exit Sub

Worksheet_Activate_Error:

230 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri worksheet_change v VBA Document List8"
End Sub

Attribute VB_Name = "Module1"
Option Explicit
Public Sub izpis_napak_bs()
    Dim sht As Worksheet, sht1 As Worksheet
    Dim obmocje As Range, obmocje1 As Range, obmocje2 As Range, obmocje3 As Range
    Dim stevec As Integer
10  On Error GoTo izpis_napak_bs_Error

20  Set sht = ActiveSheet
30  Application.ScreenUpdating = False
40  Set sht1 = Worksheets.Add
50  Set obmocje = sht1.Range("c21")
60  Set obmocje1 = sht1.Range("d21")
70  Set obmocje2 = sht1.Range("e21")
80  Set obmocje3 = sht1.Range("c19")
90  Worksheets("bs").Range("a1:f17").Copy sht1.Range("A1")
100 Worksheets("bs").Range("d25:d71").Copy
110 sht1.Range("c22").PasteSpecial Paste:=xlPasteValues
120 Worksheets("bs").Range("h25:h71").Copy
130 sht1.Range("d22").PasteSpecial Paste:=xlPasteValues
140 Worksheets("bs").Range("j25:j71").Copy
150 sht1.Range("e22").PasteSpecial Paste:=xlPasteValues
160 sht1.Columns("e").ColumnWidth = 24
170 sht1.Columns("f").ColumnWidth = 11
180 sht1.Columns("b").ColumnWidth = 14
190 With sht1.Range("a9:c10")
200     .MergeCells = True
210     .WrapText = True
220 End With
230 With sht1.Range("a8:d8")
240     .MergeCells = True
250     .Font.Name = "Arial"
260     .Font.Size = 11
270     .Font.Bold = True
280 End With
290 obmocje.Value = "AOP"
300 obmocje1.Value = "Teko|fffd|e leto "
310 obmocje2.Value = "Preteklo leto"
320 obmocje3.Value = "Izpis napak"
330 sht1.Range("a19:f19").MergeCells = True
340 sht1.Range("a19:f19").VerticalAlignment = xlVAlignCenter
350 sht1.Range("a19:f19").HorizontalAlignment = xlHAlignCenter
360 Application.ScreenUpdating = False
370 sht1.Range("a19:e69").WrapText = True
380 sht1.Range("a19:e69").VerticalAlignment = xlVAlignCenter
390 sht1.Range("a19:e69").HorizontalAlignment = xlHAlignCenter
400 With sht1.Range("a19:e21").Font
410     .Name = "Arial"
420     .Size = 11
430     .Bold = True
440 End With
450 With sht1.Range("a22:e68").Font
460     .Name = "Arial"
470     .Size = 10
480 End With
490 sht1.Range("c21:e68").BorderAround LineStyle:=xlContinuous, Weight:=xlThin
500 With sht1.Range("c21:e68").Borders(xlInsideVertical)
510     .LineStyle = xlContinuous
520     .Weight = xlThin
530 End With
540 With sht1.Range("c21:e68").Borders(xlInsideHorizontal)
550     .LineStyle = xlContinuous
560     .Weight = xlThin
570 End With
580 For stevec = 68 To 22 Step -1
590     If sht1.Range("d" & stevec).Value = "V redu" And sht1.Range("e" & stevec).Value = "V redu" Then
600         sht1.Range("a" & stevec).EntireRow.Delete
610     End If
620 Next stevec
630 With sht1.PageSetup
640     .PrintTitleRows = "$1:$22"
650     .CenterFooter = "&P"
660     .Zoom = False
670     .FitToPagesTall = 1
680     .FitToPagesWide = 1
690 End With
700 sht1.PrintOut
710 Application.DisplayAlerts = False
720 sht1.Delete
730 Application.DisplayAlerts = True
740 Application.ScreenUpdating = True

750 On Error GoTo 0
760 Exit Sub

izpis_napak_bs_Error:

770 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri izpis_napak_bs v Module Module2"
End Sub
Public Sub izpis_napak_ipiz()
    Dim sht As Worksheet, sht1 As Worksheet
    Dim obmocje As Range, obmocje1, obmocje2, obmocje3 As Range
    Dim stevec As Integer
10  On Error GoTo izpis_napak_ipiz_Error

20  Set sht = ActiveSheet
30  Application.ScreenUpdating = False
40  Set sht1 = Worksheets.Add
50  Set obmocje = sht1.Range("b20")
60  Set obmocje1 = sht1.Range("c20")
70  Set obmocje2 = sht1.Range("d20")
80  Set obmocje3 = sht1.Range("c17")
90  Worksheets("IPI").Range("a1:f14").Copy sht1.Range("A1")
100 Worksheets("IPI").Range("d21:d66").Copy
110 sht1.Range("b21").PasteSpecial Paste:=xlPasteValues
120 Worksheets("IPI").Range("h21:h66").Copy
130 sht1.Range("c21").PasteSpecial Paste:=xlPasteValues
140 Worksheets("IPI").Range("j21:j66").Copy
150 sht1.Range("d21").PasteSpecial Paste:=xlPasteValues
160 sht1.Columns("a").ColumnWidth = 4
170 sht1.Columns("d").ColumnWidth = 31
180 sht1.Columns("c").ColumnWidth = 31
190 sht1.Columns("f").ColumnWidth = 11
200 obmocje.Value = "AOP"
210 obmocje1.Value = "Teko|fffd|e leto"
220 obmocje2.Value = "Preteklo leto"
230 obmocje3.Value = "Izpis napak"
240 sht1.Range("a17:f17").MergeCells = True
250 sht1.Range("a17:f17").VerticalAlignment = xlVAlignCenter
260 sht1.Range("a17:f17").HorizontalAlignment = xlHAlignCenter
270 Application.ScreenUpdating = False
280 sht1.Range("a17:d66").WrapText = True
290 sht1.Range("a17:d66").VerticalAlignment = xlVAlignCenter
300 sht1.Range("a17:d66").HorizontalAlignment = xlHAlignCenter
310 With sht1.Range("a17:d20").Font
320     .Name = "Arial"
330     .Size = 11
340     .Bold = True
350 End With
360 With sht1.Range("a20:d66").Font
370     .Name = "Arial"
380     .Size = 10
390 End With
400 sht1.Range("b20:d66").BorderAround LineStyle:=xlContinuous, Weight:=xlThin
410 With sht1.Range("b20:d66").Borders(xlInsideVertical)
420     .LineStyle = xlContinuous
430     .Weight = xlThin
440 End With
450 With sht1.Range("b20:d66").Borders(xlInsideHorizontal)
460     .LineStyle = xlContinuous
470     .Weight = xlThin
480 End With
490 For stevec = 66 To 21 Step -1
500     If sht1.Range("c" & stevec).Value = "V redu" And sht1.Range("d" & stevec).Value = "V redu" Then
510         sht1.Range("B" & stevec).EntireRow.Delete
520     End If
530 Next stevec
540 With sht1.PageSetup
550     .PrintTitleRows = "$1:$19"
560     .CenterFooter = "&P"
570     .Zoom = False
580     .FitToPagesTall = 1
590     .FitToPagesWide = 1
600 End With
610 sht1.PrintOut
620 Application.DisplayAlerts = False
630 sht1.Delete
640 Application.DisplayAlerts = True
650 Application.ScreenUpdating = True

660 On Error GoTo 0
670 Exit Sub

izpis_napak_ipiz_Error:

680 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri izpis_napak_ipiz v Module Module2"
End Sub

Attribute VB_Name = "Module2"
Option Explicit
Option Base 1



Public Function naredi_xml(ImeIzhodneDatoteke As Variant) As Boolean
10  On Error GoTo naredi_xml_Error


    Dim xmldoc As DOMDocument
    Dim obj_pi As IXMLDOMProcessingInstruction
    Dim obj_root As IXMLDOMElement    ' root element
    Dim obj_nmspace As IXMLDOMAttribute    ' atribut za nonamespace
    Dim obj_ident As IXMLDOMElement    ' node IDENT
    Dim ident_atribut As IXMLDOMAttribute    ' atribut za node IDENT
    Dim ident_ura As IXMLDOMElement    ' element ura
    Dim ident_datum As IXMLDOMElement    ' element datum
    Dim ident_nacin As IXMLDOMElement    ' element nacin_predlozitve
    Dim ident_pravice As IXMLDOMElement    ' element vse_pravice_ajpes
    Dim obj_osnovni As IXMLDOMElement    ' node Osnovni podatki
    Dim osnovni_element As IXMLDOMElement
    Dim osnovni_atribut As IXMLDOMAttribute    'atribut za node osnovni in sicer vrstaPoslovnegaSubjekta
    Dim obj_podatki As IXMLDOMElement    ' node Podatki
    '    Dim obj_obrazec As IXMLDOMElement    ' node obrazec
    '    Dim obrazec_atribut As IXMLDOMAttribute    ' atribut id za element obrazec
    Dim obj_aop As IXMLDOMElement    ' element aop
    Dim aop_atribut As IXMLDOMAttribute    ' atribut ID od aop
    Dim obj_podatek As IXMLDOMElement    ' element podatek
    Dim podatek_atribut As IXMLDOMAttribute    ' atribut tip od el. podatek
    Dim bs_atributi As IXMLDOMNodeList
    Dim bs_atribut As IXMLDOMAttribute
    Dim sht As Worksheet
    Dim sht1 As Worksheet
    Dim sht2 As Worksheet
    Dim sht3 As Worksheet
    Dim sht4 As Worksheet
20  Set sht4 = Worksheets("Izjava")
30  Set sht2 = Worksheets("BS")
40  Set sht3 = Worksheets("IPI")
50  Set sht1 = Worksheets("xml")
    Dim o_osnovni As Range
60  Set o_osnovni = sht1.Range("b10:b30")
    Dim o_podatki_tekoce As Range
70  Set o_podatki_tekoce = sht1.Range("b33:b125")
    Dim o_podatki_pret As Range
80  Set o_podatki_pret = sht1.Range("D33:d125")
    Dim podatki_tekoce As Variant, podatki_pret As Variant    ' polji za aop-je tekoce in preteklo leto
90  podatki_tekoce = Application.WorksheetFunction.Transpose(o_podatki_tekoce)
100 podatki_pret = Application.WorksheetFunction.Transpose(o_podatki_pret)
    Dim podatki_tekoce_polje, podatki_pret_polje, aop_elem
    Dim o_aop As Range
110 Set o_aop = sht1.Range("g33:g125")
    Dim aop_polje As Variant
120 aop_polje = Application.WorksheetFunction.Transpose(o_aop)
130 Set sht = Worksheets("Osnovni podatki")
    Dim imena_tipov As Variant
    Dim ime_tipa As Variant
140 imena_tipov = Array("T", "P")
    Dim osn_excel As Variant    ' polja osnovnih pod. excel
    Dim osn_xml As Variant    ' polja v nodu osnovni_podatki
    Dim osn_excel_polje As Variant    'posaz. el
    Dim osn_xml_polje As Variant   ' posamezen  el.
150 osn_excel = Application.WorksheetFunction.Transpose(o_osnovni)
160 osn_xml = Array("OSN_Maticna_stevilka", "OSN_Davcna_stevilka", "OSN_Ime", "OSN_Sedez", "OSN_Odgovorna_oseba_za_bilanco", "OSN_Telefonska_stevilka", _
                    "OSN_Enaslov_kontaktne_osebe", "OSN_Enaslov_za_obvestila_eracune", "OSN_Vodja_podjetja", "OSN_Datum_sestave_bilance", "OSN_Kraj_sestave_bilance", _
                    "OSN_Datum_posl_zacetek", "OSN_Datum_posl_konec", "OSN_Racunovodimo", "OSN_Poslovne_knjige_vodimo_po_nacelu_enostavnega_knjigovodstva", "OSN_Velikost", "OSN_Velikost_izracunana_preteklo", "OSN_Velikost_izracunana_tekoce", _
                    "OSN_Velikost_obravnavana_preteklo", "OSN_Velikost_obravnavana_tekoce", "IZJ_Oddal_izjavo")
    Dim stevec, x, i, j, k, l, m As Integer
170 x = 0
180 Set xmldoc = New DOMDocument    ' kreiram dom dokument
190 Set obj_pi = xmldoc.createProcessingInstruction("xml", "version=""1.0"" encoding=""UTF-8""")    ' sprememba
200 xmldoc.appendChild obj_pi
210 Set obj_root = xmldoc.createElement("AjpesDokument")
220 xmldoc.appendChild obj_root
230 Set obj_nmspace = xmldoc.createNode(NODE_ATTRIBUTE, _
                                        "xsi:noNamespaceSchemaLocation", _
                                        "http://www.w3.org/2001/XMLSchema-instance")
240 obj_nmspace.Value = "http://www.ajpes.si/XML_Sheme/LP_V1_0.xsd"    'sprememba
250 xmldoc.documentElement.Attributes.setNamedItem obj_nmspace
260 Set obj_ident = xmldoc.createElement("Ident")
270 obj_root.appendChild obj_ident
280 Set ident_atribut = xmldoc.createAttribute("Vrsta")
290 obj_ident.setAttributeNode ident_atribut
300 ident_atribut.Value = "LP"    'spremenjeno
310 Set ident_datum = xmldoc.createElement("Datum")
320 obj_ident.appendChild ident_datum
330 ident_datum.Text = Format(Date, "yyyy-mm-dd")
340 Set ident_ura = xmldoc.createElement("Ura")
350 obj_ident.appendChild ident_ura
360 ident_ura.Text = Format(Time, "hh:mm:ss")
370 Set ident_nacin = xmldoc.createElement("Nacin_predlozitve")
380 obj_ident.appendChild ident_nacin
390 ident_nacin.Text = "Excel_XML"
400 Set ident_pravice = xmldoc.createElement("Vse_pravice")
410 obj_ident.appendChild ident_pravice
420 ident_pravice.Text = "Vse pravice AJPES 2018"
430 Set obj_osnovni = xmldoc.createElement("Osnovni_podatki")
440 obj_root.appendChild obj_osnovni
450 Set osnovni_atribut = xmldoc.createAttribute("vrstaPoslovnegaSubjekta")
460 obj_osnovni.setAttributeNode osnovni_atribut
470 osnovni_atribut.Value = "SP"
480 For stevec = 1 To 21
490     osn_excel_polje = osn_excel(stevec)
500     osn_xml_polje = osn_xml(stevec)
510     Set osnovni_element = xmldoc.createElement(osn_xml_polje)
520     obj_osnovni.appendChild osnovni_element
        'osnovni_element.text = zacetek.Offset(x, 0).value
        '        If stevec > 20 Then
        '            osnovni_element.Text = Application.WorksheetFunction.Substitute(Format(osn_excel_polje, "###0.00"), ",", ".")
        '        Else
530     osnovni_element.Text = osn_excel_polje
        '        End If
540     If osnovni_element.Text = "" Then
550         obj_osnovni.removeChild osnovni_element
560     End If
570     x = x + 1
580 Next stevec
590 Set obj_podatki = xmldoc.createElement("Podatki")
600 obj_root.appendChild obj_podatki
610 For k = 1 To 93
620     Set obj_aop = xmldoc.createElement("AOP")
630     obj_podatki.appendChild obj_aop
640     Set aop_atribut = xmldoc.createAttribute("ID")
650     obj_aop.setAttributeNode aop_atribut
660     aop_elem = aop_polje(k)
670     aop_atribut.Value = aop_elem
680     For l = 1 To 2
690         ime_tipa = imena_tipov(l)
700         Set obj_podatek = xmldoc.createElement("PODATEK")
710         obj_aop.appendChild obj_podatek
720         Set podatek_atribut = xmldoc.createAttribute("TIP")
730         obj_podatek.setAttributeNode podatek_atribut
740         podatek_atribut.Value = ime_tipa
750         If ime_tipa = "T" Then
760             If podatki_tekoce(k) = "" Then
770                 podatki_tekoce(k) = 0
780             End If
790             obj_podatek.Text = Application.WorksheetFunction.Substitute(Format(podatki_tekoce(k), "###0.00"), ",", ".")
800         ElseIf ime_tipa = "P" Then
810             If podatki_pret(k) = "" Then
820                 podatki_pret(k) = 0
830             End If
840             obj_podatek.Text = Application.WorksheetFunction.Substitute(Format(podatki_pret(k), "###0.00"), ",", ".")
850         End If
860     Next l
870 Next k
    '    Next i
880 Call FormatXmlDocument(xmldoc)
890 xmldoc.Save (ImeIzhodneDatoteke)
900 Set osn_excel = Nothing
910 Set osn_xml = Nothing
920 Set imena_tipov = Nothing
930 Set podatki_tekoce = Nothing
940 Set podatki_pret = Nothing
950 Set aop_polje = Nothing
960 naredi_xml = True
970 On Error GoTo 0
980 Exit Function

naredi_xml_Error:
990 naredi_xml = False
1000 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v funkciji naredi_xml v Module Module3"
End Function
Private Sub FormatXmlDocument(ByVal xmldoc As DOMDocument)
10  FormatXmlNode xmldoc.documentElement, 0
End Sub
Private Sub FormatXmlNode(ByVal node As IXMLDOMNode, ByVal indent As Integer)

    Dim child As IXMLDOMNode
    Dim text_only As Boolean

    ' Do nothing if this is a text node.
10  If TypeOf node Is IXMLDOMText Then Exit Sub

    ' See if this node contains only text.
20  text_only = True
30  If node.hasChildNodes Then
40      For Each child In node.childNodes
50          If Not (TypeOf child Is IXMLDOMText) Then
60              text_only = False
70              Exit For
80          End If
90      Next child
100 End If

    ' Process child nodes.
110 If node.hasChildNodes Then
        ' Add a carriage return before the children.
120     If Not text_only Then
130         node.insertBefore _
                    node.ownerDocument.createTextNode(vbCrLf), _
                    node.FirstChild
140     End If

        ' Format the children.
150     For Each child In node.childNodes
160         FormatXmlNode child, indent + 2
170     Next child
180 End If

    ' Format this element.
190 If indent > 0 Then
        ' Indent before this element.
200     node.parentNode.insertBefore _
                node.ownerDocument.createTextNode(Space$(indent)), _
 _
        node

        ' Indent after the last child node.
210     If Not text_only Then _
           node.appendChild _
           node.ownerDocument.createTextNode(Space$(indent))

        ' Add a carriage return after this node.
220     If node.nextSibling Is Nothing Then
230         node.parentNode.appendChild _
                    node.ownerDocument.createTextNode(vbCrLf)
240     Else
250         node.parentNode.insertBefore _
                    node.ownerDocument.createTextNode(vbCrLf), _
                    node.nextSibling
260     End If
270 End If
End Sub



Attribute VB_Name = "Module3"
Option Explicit

Public Function stejdec(num)
    Dim d
10  d = InStr(1, num, ",")
20  If d = 0 Then
30      stejdec = 0
40  Else
50      stejdec = Len(num) - d
60  End If
End Function
Public Function testtelst(vrednost As String) As Boolean
    Dim dolzina As Integer
    Dim pozicija As Integer
    Dim znak As String
    Dim vzorec
10  dolzina = Len(vrednost)
20  For pozicija = 1 To dolzina
30      znak = Mid(vrednost, pozicija, 1)
40      vzorec = znak Like "[0-9()/, -]"
50      If vzorec = True Then
60          testtelst = True
70      Else
80          testtelst = False
90          Exit Function
100     End If

110 Next pozicija

End Function
Sub Uvozpodatkov()

'Uvoz podatkov iz preglednice,ki jo izbere uporabnik
    Dim ime_datoteke, wb1 As Workbook, wb2 As Workbook
    Dim sht As Worksheet, sht1 As Worksheet, sht2 As Worksheet, sht3 As Worksheet
    Dim sht4 As Worksheet, sht5 As Worksheet
    Dim i As Long, j As Long, k As Long, l As Long, m As Long, n As Long, o As Long, p As Long
    Dim maticna, maticna1, test, TEST1 As String, xml_pret_obmocje As String, test_pret_preglednica As Boolean
    Dim vred_bs As Double, vred_ipi As Double, obravn_velikost_pret As Long, enostavno_knjig, pog_aop_056 As Boolean, enostavno_knjig_pret
10  On Error GoTo Uvozpodatkov_Error
    '    MsgBox "Uvoz podatkov preteklega leta vam za letno poro|fffd|ilo 2017 omogo|fffd|a" & vbCrLf & _
         '           "le spletna aplikacija. Tovrsten uvoz vam bo ponovno omogo|fffd|en prihodnje leto."
20  MsgBox "Izberite lanskoletno Excelovo preglednico LPSP_2017." & vbCrLf _
         & "|fffd|e te preglednice nimate, uvoz podatkov za preteklo leto v to preglednico ni mo|fffd|en."
30  ime_datoteke = Application.GetOpenFilename("Vse datoteke (*.*),*.*")    'popravek 12.2.2015 prej filter samo na xls datoteke
40  If ime_datoteke = False Then
50      MsgBox "Izbrali ste gumb prekli|fffd|i, zato podatki preteklega leta niso bili uvo|fffd|eni."
60      Exit Sub
70  End If
80  Application.ScreenUpdating = False
90  Set wb2 = ActiveWorkbook
100 Set wb1 = Workbooks.Open(ime_datoteke)
110 xml_pret_obmocje = "vrsta_sub_leto_oddaje"
120 test_pret_preglednica = NameExist(wb1, xml_pret_obmocje)
130 If test_pret_preglednica = True Then
140     If DoesWorkSheetExist("BS", wb1) = True And DoesWorkSheetExist("IPI", wb1) = True And wb1.Worksheets("xml").Range(xml_pret_obmocje).Value = "LPSP_2017" Then
150         Set sht = wb1.Worksheets("BS")
160         Set sht1 = wb2.Worksheets("BS")
170         Set sht2 = wb1.Worksheets("IPI")
180         Set sht3 = wb2.Worksheets("IPI")
190         Set sht4 = wb2.Worksheets("Status_vnosa")
200         Set sht5 = wb2.Worksheets("Osnovni podatki")
210         enostavno_knjig = sht5.Range("enostavno_knjigovodstvo").Value
220         enostavno_knjig_pret = wb1.Worksheets("xml").Range("b24").Value
230         pog_aop_056 = wb2.Worksheets("BS").Range("aop_056_pog_mikro").Value
            'MsgBox ("OBSTAJA")
240         test = wb1.Worksheets("xml").Range("a3").Value
            'Debug.Print test
250         maticna = wb2.Worksheets("xml").Range("b10").Value
260         maticna1 = wb1.Worksheets("xml").Range("b10").Value
270         If Mid(test, 15, 2) = "LP" Then
280             If CStr(Left(maticna, 7)) = CStr(Left(maticna1, 7)) Then
290                 Application.EnableEvents = False
300                 For i = 28 To 50
310                     vred_bs = sht.Range("E" & i).Value
320                     If Not sht1.Range("F" & i).HasFormula = True Then
330                         sht1.Range("F" & i).Value = vred_bs
340                     End If
350                 Next i
360                 For j = 53 To 59
370                     vred_bs = sht.Range("E" & j).Value
380                     If pog_aop_056 = False Then
390                         sht1.Range("F" & j).Value = vred_bs
400                     End If
410                 Next j
420                 For k = 61 To 71
430                     vred_bs = sht.Range("E" & k).Value
440                     If Not sht1.Range("F" & k).HasFormula = True Then
450                         sht1.Range("F" & k).Value = vred_bs
460                     End If
470                 Next k
480                 For l = 21 To 66
490                     vred_ipi = sht2.Range("E" & l).Value
500                     If Not sht3.Range("F" & l).HasFormula = True Then
510                         sht3.Range("F" & l).Value = vred_ipi
520                     End If
530                 Next l
540                 obravn_velikost_pret = wb1.Worksheets("Osnovni podatki").Range("c26").Value
550                 sht4.Range("f69").Value = obravn_velikost_pret
560                 Application.EnableEvents = True
570                 MsgBox ("Uvoz podatkov je kon|fffd|an!")
580                 wb1.Close False

590             Else: MsgBox ("Mati|fffd|na |fffd|tevilka " & Left(maticna, 7) & "," & " ki je vne|fffd|ena v tej preglednici," _
                            & "se ne ujema z mati|fffd|no |fffd|tevilko " & maticna1 & ", ki je v preglednici " & ime_datoteke & "." & vbCrLf & _
                              "Uvoz ni mo|fffd|en.")
600                 wb1.Close False
610                 Set wb1 = Nothing
620                 Set wb2 = Nothing
630                 Exit Sub
640             End If
650         Else: TEST1 = Mid(test, 15, 2)
660             MsgBox (ime_datoteke & " (" & TEST1 & ") " & "ni Excelova preglednica s podatki, ki ste jih predlo|fffd|ili AJPES v lanskem letu.")
670             wb1.Close False
680             Set wb1 = Nothing
690             Set wb2 = Nothing
700             Exit Sub
710         End If
720     Else: MsgBox (ime_datoteke & " ni Excelova preglednica s podatki, ki ste jih predlo|fffd|ili AJPES v lanskem letu.")
730         wb1.Close False
740         Set wb1 = Nothing
750         Set wb2 = Nothing
760         Exit Sub
770     End If
780 Else: MsgBox (ime_datoteke & " ni Excelova preglednica s podatki, ki ste jih predlo|fffd|ili AJPES v lanskem letu.")
790     wb1.Close False
800     Set wb1 = Nothing
810     Set wb2 = Nothing
820     Exit Sub
830 End If
840 Set wb2 = Nothing
850 Set wb1 = Nothing
    'Application.EnableEvents = True  dano v opombo 14.12.04
860 Application.ScreenUpdating = True
870 On Error GoTo 0
880 Exit Sub

Uvozpodatkov_Error:

890 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri Uvozpodatkov v modulu Module3"

End Sub

'Function WorksheetExists(SheetName As String, _
 '                         Optional WhichBook As Workbook) As Boolean
'    Dim WB As Workbook
'10  Set WB = IIf(WhichBook Is Nothing, ThisWorkbook, WhichBook)
'20  On Error Resume Next
'30  WorksheetExists = Len(WB.Worksheets(SheetName).Name) > 0
'End Function

Public Function DoesWorkSheetExist(WorkSheetName As String, Optional WorkBookName As Variant)
    Dim WS As Worksheet
10  On Error Resume Next
20  If WorkBookName = vbNullString Then
30      Set WS = Sheets(WorkSheetName)
40  Else
50      Set WS = Workbooks(WorkBookName).Sheets(WorkSheetName)
60  End If
70  On Error GoTo 0
80  DoesWorkSheetExist = Not WS Is Nothing
End Function

Attribute VB_Name = "Module4"
Option Explicit
Public Function RDB_Create_PDF(Myvar As Object, FixedFilePathName As String, _
                               OverwriteIfFileExist As Boolean, OpenPDFAfterPublish As Boolean) As String
          Dim FileFormatstr As String
          Dim Fname As Variant
          'Test to see if the Microsoft Create/Send add-in is installed.
      '    If Dir(Environ("commonprogramfiles") & "\Microsoft Shared\OFFICE" _
      '         & Format(Val(Application.Version), "00") & "\EXP_PDF.DLL") <> "" Then
10            If FixedFilePathName = "" Then
                  'Open the GetSaveAsFilename dialog to enter a file name for the PDF file.
20                FileFormatstr = "PDF Files (*.pdf), *.pdf"
30                Fname = Application.GetSaveAsFilename("", filefilter:=FileFormatstr, _
                                                        Title:="Ustvari PDF")
                  'If you cancel this dialog, exit the function.
40                If Fname = False Then Exit Function
50            Else
60                Fname = FixedFilePathName
70            End If
              'If OverwriteIfFileExist = False then test to see if the PDF
              'already exists in the folder and exit the function if it does.
80            If OverwriteIfFileExist = False Then
90                If Dir(Fname) <> "" Then Exit Function
100           End If
              'Now export the PDF file.
110           On Error Resume Next
120           Myvar.ExportAsFixedFormat _
                      Type:=xlTypePDF, _
                      FileName:=Fname, _
                      Quality:=xlQualityStandard, _
                      IncludeDocProperties:=True, _
                      IgnorePrintAreas:=False, _
                      OpenAfterPublish:=OpenPDFAfterPublish
130           On Error GoTo 0
              'If the export is successful, return the file name.
140           If Dir(Fname) <> "" Then RDB_Create_PDF = Fname
      '    End If
End Function
Public Sub shrani_pdf()
    Dim sht As Worksheet, sht1 As Worksheet, bs156gumb As Shape, bs159gumb As Shape, ipi89gumb As Shape
    Dim izp_napak_h, izp_napak_w, izp_napak_top, izp_napak_left, uvoz_h, uvoz_w, uvoz_top, uvoz_left
    Dim ipi_gumb_h, ipi_gumb_w, ipi_gumb_left, ipi_gumb_top, cb_h, cb_w, cb_l, cb_t, cb1_h, cb1_w, cb1_l, cb1_t
    Dim objole As Excel.OLEObject, objole1 As Excel.OLEObject, sht2 As Worksheet
10  On Error GoTo shrani_pdf_Error

20  Set sht = Worksheets("Bs")
30  Set sht1 = Worksheets("IPI")
40  Set sht2 = Worksheets("Osnovni podatki")
50  Set objole = sht2.OLEObjects("ComboBox1")
60  Set objole1 = sht2.OLEObjects("Combobox2")
    '    Set bs156gumb = sht.Shapes("Button 156")
    '    Set bs159gumb = sht.Shapes("Button 159")
    '    Set ipi89gumb = sht1.Shapes("Button 89")
    '    With bs156gumb
    '        izp_napak_h = .Height
    '        izp_napak_w = .Width
    '        izp_napak_left = .Left
    '        izp_napak_top = .Top
    '    End With
    '    With bs159gumb
    '        uvoz_h = .Height
    '        uvoz_w = .Width
    '        uvoz_left = .Left
    '        uvoz_top = .Top
    '    End With
    '    With ipi89gumb
    '        ipi_gumb_h = .Height
    '        ipi_gumb_w = .Width
    '        ipi_gumb_left = .Left
    '        ipi_gumb_top = .Top
    '    End With
70  With objole
80      cb_w = .Width
90      cb_h = .Height
100     cb_l = .Left
110     cb_t = .Top
120 End With
130 With objole1
140     cb1_w = .Width
150     cb1_h = .Height
160     cb1_l = .Left
170     cb1_t = .Top
180 End With
190 If Val(Application.Version) > 11 Then
200     Application.ScreenUpdating = False
210     Sheets(Array("Osnovni podatki", "BS", "IPI", "Izjava")).Select
220     Sheets("Osnovni podatki").Activate
        Dim FileName As String
        '    If ActiveWindow.SelectedSheets.Count > 1 Then
        '        MsgBox "There is more than one sheet selected," & vbNewLine & _
                 '               "and every selected sheet will be published."
        '    End If
        'Call the function with the correct arguments.
        'You can also use Sheets("Sheet3") instead of ActiveSheet in the code(the sheet does not need to be active then).
230     FileName = RDB_Create_PDF(ActiveSheet, "", False, True)
        'For a fixed file name and to overwrite it each time you run the macro, use the following statement.
        'RDB_Create_PDF(ActiveSheet, "C:\Users\Ron\Test\YourPdfFile.pdf", True, True)
240     If FileName <> "" Then
            'Uncomment the following statement if you want to send the PDF by e-mail.
            'RDB_Mail_PDF_Outlook FileName, "ron@debruin.nl", "This is the subject", _
             "See the attached PDF file with the last figures" _
             & vbNewLine & vbNewLine & "Regards Ron de bruin", False
250     Else
260         Application.ScreenUpdating = True
270         MsgBox "Ni mo|fffd|no ustvariti PDF datoteke. Mo|fffd|ni vzroki:" & vbNewLine & _
                   "Dodatek Microsoft Save as PDF ni name|fffd||fffd|en (za Microsoft Office 2007)." & vbNewLine & _
                   "Prekinili ste Shrani kot dialog." & vbNewLine & _
                   "Datoteka z istim imenom |fffd|e obstaja."
280     End If
290     If Val(Application.Version) = 14 Or Val(Application.Version) = 15 Then
300         Sheets("BS").Activate
310         Sheets("Bs").Range("e27").Select
320         ActiveWindow.View = xlPageBreakPreview
330         ActiveWindow.View = xlNormalView
340         Sheets("IPI").Activate
350         Sheets("IPI").Range("e22").Select
360         ActiveWindow.View = xlPageBreakPreview
370         ActiveWindow.View = xlNormalView
380     End If
390     Sheets("Status_vnosa").Activate
400     Sheets("Status_vnosa").Range("a15").Select
410     Application.ScreenUpdating = True
420     With objole
430         .Height = cb_h
440         .Width = cb_w
450         .Top = cb_t
460         .Left = cb_l
470     End With
480     With objole1
490         .Height = cb1_h
500         .Width = cb1_w
510         .Top = cb1_t
520         .Left = cb1_l
530     End With
        '        With bs156gumb
        '            .Height = izp_napak_h
        '            .Width = izp_napak_w
        '            .Left = izp_napak_left
        '            .Top = izp_napak_top
        '        End With
        '        With bs159gumb
        '            .Height = uvoz_h
        '            .Width = uvoz_w
        '            .Left = uvoz_left
        '            .Top = uvoz_top
        '        End With
        '        With ipi89gumb
        '            .Height = ipi_gumb_h
        '            .Width = ipi_gumb_w
        '            .Left = ipi_gumb_left
        '            .Top = ipi_gumb_top
        '        End With
540 Else
550     Sheets("Status_vnosa").Activate
560     Sheets("Status_vnosa").Range("a15").Select
570     MsgBox "Va|fffd|a verzija Excela ne podpira shranjevanja v PDF datoteko."
580     Exit Sub
590 End If

600 On Error GoTo 0
610 Exit Sub

shrani_pdf_Error:

620 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri shrani_pdf v Modulu Module4"
End Sub
Private Sub SaveWsOnFile(IzbranoImeIzhodneDatoteke As String)

    Dim Str, Fmt, FmtStr, TmpStr
    Dim LineCnt As Integer
    Dim ColCnt As Integer
    Dim LineOut

10  On Error GoTo SaveWsOnFile_Error

20  Open UCase(IzbranoImeIzhodneDatoteke) For Output As #1
30  LineCnt = 0
40  ColCnt = 0
50  LineOut = ""
60  Do While Not (IsEmpty(Range("A1").Offset(LineCnt, 0)))
70      TmpStr = Range("A1").Offset(LineCnt, ColCnt).Value
80      Str = Trim(Range("A1").Offset(LineCnt, ColCnt).Value)
90      Fmt = Range("A1").Offset(LineCnt, ColCnt).NumberFormat
100     FmtStr = ""
110     If Str <> "" Then
120         If Left(Fmt, 2) = "h:" Or Left(Fmt, 3) = "hh:" _
               Then
130             FmtStr = Format(Str, "hh:mm:ss")
                '            Else
                '                 If Left(Fmt, 10) = "dd/mm/yyyy" _
                                  '                 Then
                '                    If Str = "0:00:00" Then
                '                        FmtStr = "0"
                '                    Else
                '                        FmtStr = Format(Str, "dd.mm.yyyy")
                '                    End If
                '                 End If
140         Else
150             If LineCnt = 81 Then
160                 FmtStr = Application.WorksheetFunction.Substitute(Str, ",", ".")
170             End If
180         End If

190         If (FmtStr <> "") Then
200             LineOut = LineOut + FmtStr
210         Else
220             LineOut = LineOut + Str
230         End If
240     End If
250     If (ColCnt < 5) Then
260         ColCnt = ColCnt + 1
270     Else
280         Print #1, LineOut
290         ColCnt = 0
300         LineCnt = LineCnt + 1
310         LineOut = ""
320     End If
330 Loop
340 Close #1


350 On Error GoTo 0
360 Exit Sub

SaveWsOnFile_Error:

370 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri SaveWsOnFile v VBA Document ThisWorkbook"
End Sub


Public Sub Shrani_Klikni()
    Dim ImeXlsDatoteke
    Dim ImeIzhodneDatoteke, IzbranoImeIzhodneDatoteke, filter
    Dim MatStr
    Dim DateTimeStr As String
    Dim AkcijaStr
    Dim Msg, Style, Title, Help, Ctxt, Response, MyString
10  On Error GoTo Shrani_Klikni_Error
20  filter = "XML datoteke (*.xml),*.xml)"
    ' Define message
30  Msg = "Izvedene bodo naslednje akcije:" & vbCrLf & vbCrLf _
        & "1. Shranjevanje preglednice (XLS datoteke)" & vbCrLf _
        & "2. Priprava in shranjevanje datoteke za AJPES (XML datoteke)" & vbCrLf _
        & "3. Vrnitev na trenutni list preglednice" & vbCrLf & vbCrLf _
        & "|fffd|elite nadaljevati ?"
40  Style = vbYesNo + vbQuestion            ' Define buttons.
50  Title = "Shranjevanje preglednice ...."    ' Define title.
60  Help = ""    ' Define Help file.
70  Ctxt = 1000    ' Define topic
    ' context.
    ' Display message.
80  If Left(Sheets("Status_vnosa").Range("NAPAKE_SKUPAJ").Value, 5) <> "NAPAK" Or _
       (StrConv(Sheets("Status_vnosa").Range("FORSIRAJ").Value, vbUpperCase) = "Z NAPAKAMI") _
       Then
        '
        '       Najprej shranimo XLS datoteko
        '
90      Response = MsgBox(Msg, Style, Title, Help, Ctxt)
100     If Response = vbYes Then    ' User chose Yes.
110         ImeXlsDatoteke = ActiveWorkbook.FullName
            '        MsgBox ImeDatoteke
120         ActiveWorkbook.Save
            '
            '       Sestavimo ime izhodne datoteke
            '
130         MatStr = Sheets("Osnovni podatki").Range("m").Value
140         DateTimeStr = Format(Now(), "_yyyymmdd_hhmmss")
150         If Left(Sheets("Status_vnosa").Range("NAPAKE_SKUPAJ").Value, 5) = "NAPAK" _
               Then
160             ImeIzhodneDatoteke = "LPSP_" & MatStr & DateTimeStr & "_NAPAKE" & ".xml"
170         Else
180             ImeIzhodneDatoteke = "LPSP_" & MatStr & DateTimeStr & ".xml"
190         End If
200         Msg = "Ime XML datoteke se kreira avtomati|fffd|no. Prosimo,da ga ne spreminjate!"
210         Style = vbInformation    ' Define buttons.
220         Title = "Shranjevanje XML datoteke.."    ' Define title.
230         Response = MsgBox(Msg, Style, Title, Help, Ctxt)
240         IzbranoImeIzhodneDatoteke = Application.GetSaveAsFilename(ImeIzhodneDatoteke, filter)
250         If (IzbranoImeIzhodneDatoteke <> False) Then
                '          If Not Sheets("Status_vnosa").Range("b72").Value > 2 Then
260             Application.ScreenUpdating = False     ' Disable screen flickering
270             Sheets("XML").Select
280             If Not naredi_xml(IzbranoImeIzhodneDatoteke) = False Then
290                 Sheets("Status_vnosa").Select
300                 Range("A14").Select
310                 Msg = "Datoteka:" & IzbranoImeIzhodneDatoteke & " je bila shranjena! To je datoteka za prenos na AJPES!"
320                 Style = vbInformation    ' Define buttons.
330                 Title = "Datoteka shranjena"    ' Define title.
340                 Response = MsgBox(Msg, Style, Title, Help, Ctxt)
350             Else
360                 Sheets("Status_vnosa").Select
370                 Range("A14").Select
380                 Msg = "Priprava XML datoteke ni bila uspe|fffd|na!"
390                 Style = vbCritical    ' Define buttons.
400                 Title = "Priprava ni mo|fffd|na"    ' Define title.
410                 Response = MsgBox(Msg, Style, Title, Help, Ctxt)
420                 Exit Sub
430             End If
440             Application.ScreenUpdating = True     ' Enable refreshing
                '          Else
                '              Msg = "Priprava in shranjevanje datoteke za AJPES" & vbCrLf _
                               '                  & "NI mo|fffd|no, ker je obravnavana velikost ve|fffd|ja od 2!"
                '              Style = vbCritical    ' Define buttons.
                '              Title = "Priprava ni mo|fffd|na"    ' Define title.
                '              Response = MsgBox(Msg, Style, Title, Help, Ctxt)
                '          End If
450         End If
460     Else    ' User chose No.
470         Msg = "Preglednica NI shranjena in datoteka za AJPES NI pripravljena!"
480         Style = vbExclamation    ' Define buttons.
490         Title = "Preglednica ni shranjena"    ' Define title.
500         Response = MsgBox(Msg, Style, Title, Help, Ctxt)
510     End If
520 Else
530     Msg = "Priprava in shranjevanje datoteke za AJPES NI mo|fffd|no, ker so v podatkih napake!"
540     Style = vbCritical    ' Define buttons.
550     Title = "Priprava ni mo|fffd|na"    ' Define title.
560     Response = MsgBox(Msg, Style, Title, Help, Ctxt)
570 End If

580 On Error GoTo 0
590 Exit Sub

Shrani_Klikni_Error:

600 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri Shrani_Klikni v modulu Module4"

End Sub

Sub PosljiPoEposti_Klikni()
'
' PosljiPoEposti_Klikni
' Makro ustvaril: Marjan, dne 07/10/2002
'
    Dim ImeXlsDatoteke
    Dim ImeIzhodneDatoteke, IzbranoImeIzhodneDatoteke
    Dim TmpStr
    Dim MatStr
    Dim DateTimeStr As String
    Dim AkcijaStr
    Dim Fs

    Dim Msg, Style, Title, Help, Ctxt, Response, MyString

    ' Define message
10  Msg = "Izvedene bodo naslednje akcije:" & vbCrLf & vbCrLf _
        & "1. Shranjevanje preglednice (XLS datoteke)" & vbCrLf _
        & "2. Priprava in shranjevanje datoteke za AJPES (XML datoteke)" & vbCrLf _
        & "3. Po|fffd|iljanje datoteke po e-po|fffd|ti" & vbCrLf _
        & "4. Vrnitev na trenutni list preglednice" & vbCrLf & vbCrLf _
        & "POZOR: " & vbCrLf _
        & "V primeru, da se vam po shranjevanju datoteke izpi|fffd|e opozorilo," & vbCrLf _
        & "da |fffd|eli program poslati po|fffd|to v va|fffd|em imenu, mu morate" & vbCrLf _
        & "le-to dovoliti, sicer datoteka ne bo poslana!" & vbCrLf & vbCrLf _
        & "|fffd|elite nadaljevati ?"
20  Style = vbYesNo + vbQuestion + vbDefaultButton2    ' Define buttons.
30  Title = "Shranjevanje preglednice ...."    ' Define title.
40  Help = ""    ' Define Help file.
50  Ctxt = 1000    ' Define topic
    ' context.
    ' Display message.


60  If Left(Sheets("Status_vnosa").Range("NAPAKE_SKUPAJ").Value, 5) <> "NAPAK" Or _
       (StrConv(Sheets("Status_vnosa").Range("FORSIRAJ").Value, vbUpperCase) = "Z NAPAKAMI") _
       Then
        '
        '       Najprej shranimo XLS datoteko
        '
70      Response = MsgBox(Msg, Style, Title, Help, Ctxt)
80      If Response = vbYes Then    ' User chose Yes.

90          ImeXlsDatoteke = ActiveWorkbook.FullName
            '        MsgBox ImeDatoteke
100         ActiveWorkbook.Save
            '
            '       Sestavimo ime izhodne datoteke
            '
110         MatStr = Sheets("Osnovni podatki").Range("Mati|fffd|na_|fffd|tevilka").Value
120         DateTimeStr = Format(Now(), "_yyyymmdd_hhmmss")

130         If Left(Sheets("Status_vnosa").Range("NAPAKE_SKUPAJ").Value, 5) = "NAPAK" _
               Then
140             ImeIzhodneDatoteke = "ZRSP_" & MatStr & DateTimeStr & "_NAPAKE" & ".xml"
150         Else
160             ImeIzhodneDatoteke = "ZRSP_" & MatStr & DateTimeStr & ".xml"
170         End If
180         IzbranoImeIzhodneDatoteke = Application.GetSaveAsFilename(ImeIzhodneDatoteke)

190         If (IzbranoImeIzhodneDatoteke <> False) Then
200             Application.ScreenUpdating = False     ' Disable screen flickering
210             Sheets("XML").Select

220             SaveWsOnFile (IzbranoImeIzhodneDatoteke)

230             Sheets("Status_vnosa").Select
240             Range("A14").Select
250             Application.ScreenUpdating = True     ' Enable refreshing

                '
                ' Po|fffd|lji po e-po|fffd|ti
                '
260             Set Fs = CreateObject("Scripting.FileSystemObject")
270             TmpStr = Fs.GetFileName(IzbranoImeIzhodneDatoteke)
280             Set Fs = Nothing

                ' check mail system
290             If (Application.MailSystem = xlNoMailSystem) Then
300                 Msg = "MS Excel javlja, da mail sistem ni name|fffd||fffd|en, zato po|fffd|iljanje ni mo|fffd|no!" & vbCrLf & vbCrLf _
                        & "Po|fffd|iljanje lahko izvedete na drugem ra|fffd|unalniku z name|fffd||fffd|enim " & vbCrLf _
                        & "mail sistemom ali datoteko '" & TmpStr & "' posredujete na mediju" & vbCrLf _
                        & "direktno na izpostavi AJPES."
310                 Style = vbCritical    ' Define buttons.
320                 Title = "Ni mail sistema"    ' Define title.
330                 Help = ""    ' Define Help file.
340                 Ctxt = 1000    ' Define topic
350                 Response = MsgBox(Msg, Style, Title, Help, Ctxt)
360             Else
                    '
                    ' Po|fffd|iljanje odprte datoteke (ime ni mo|fffd|no stremeniti!)
                    '
                    '                    ActiveWorkbook.SendMail Recipients:="marjan.babic@ajpes.si", _
                                         '                          Subject:="E-AJPES[ZRSP]: " & TmpStr

                    ' Po|fffd|iljanje prek IE (Ni priloge)
                    ' ActiveWorkbook.FollowHyperlink Address:="mailto:marjan.babic@ajpes.si", ExtraInfo:="E-AJPES[ZRSP]: ", Method:=msoMethodPost

370                 Application.Dialogs(xlDialogSendMail).Show



380             End If

                '                ActiveWorkbook.Close SaveChanges:=False
390         End If

400         If (Application.MailSystem = xlNoMailSystem) Then
410             Msg = "POZOR: Datoteka " & vbCrLf & vbCrLf & _
                    "   " & IzbranoImeIzhodneDatoteke & vbCrLf & vbCrLf _
                    & "NI BILA poslana na AJPES!"
420             Style = vbCritical    ' Define buttons.
430             Title = "Po|fffd|iljanje datoteke"    ' Define title.
440         Else
450             Msg = "Datoteka:" & vbCrLf & vbCrLf & _
                    "   " & IzbranoImeIzhodneDatoteke & vbCrLf & vbCrLf _
                    & "je bila poslana na AJPES po e-po|fffd|ti!"
460             Style = vbInformation    ' Define buttons.
470             Title = "Po|fffd|iljanje datoteke"    ' Define title.
480         End If
490         Response = MsgBox(Msg, Style, Title, Help, Ctxt)
500     Else    ' User chose No.
510         Msg = "Preglednica NI shranjena in datoteka za AJPES NI pripravljena!"
520         Style = vbExclamation    ' Define buttons.
530         Title = "Preglednica ni shranjena"    ' Define title.
540         Response = MsgBox(Msg, Style, Title, Help, Ctxt)
550     End If
560 Else
570     Msg = "Priprava in shranjevanje datoteke za AJPES NI mo|fffd|no, ker so v podatkih napake!"
580     Style = vbCritical    ' Define buttons.
590     Title = "Priprava ni mo|fffd|na"    ' Define title.
600     Response = MsgBox(Msg, Style, Title, Help, Ctxt)
610 End If
End Sub

Public Sub TiskajObrazce()
'
' TiskajObrazce Makro
' Makro ustvaril: Marjan, dne 24.11.2002
'
' Bli|fffd|njica: Ctrl+Shift+P
'
    Dim Help, Ctxt, Style, Title, Response, sht As Worksheet
    Dim Msg, cb_h, cb_w, cb_l, cb_t, cb1_h, cb1_w, cb1_l, cb1_t, objole As Excel.OLEObject, objole1 As Excel.OLEObject
10  On Error GoTo TiskajObrazce_Error
20  Help = ""    ' Define Help file.
30  Ctxt = 1000    ' Define topic
40  Set sht = Worksheets("Osnovni podatki")
50  Set objole = sht.OLEObjects("ComboBox1")
60  Set objole1 = sht.OLEObjects("ComboBox2")
70  With objole
80      cb_h = .Height
90      cb_w = .Width
100     cb_l = .Left
110     cb_t = .Top
120 End With
130 With objole1
140     cb1_h = .Height
150     cb1_w = .Width
160     cb1_l = .Left
170     cb1_t = .Top
180 End With
190 If (Sheets("Status_vnosa").Range("NAPAKE_SKUPAJ").Value = "NAPAKA(E)") Then
200     Msg = "Obrazci |fffd|e vedno vsebujejo napake." & vbCrLf & _
              "Nadaljujem s tiskanjem vseh izpolnjenih obrazcev?"
210 Else
220     Msg = "Nadaljujem?"
230 End If
240 Style = vbYesNo + vbInformation + vbDefaultButton2    ' Define buttons.
250 Title = "Izpis obrazcev"    ' Define title.
260 Response = MsgBox(Msg, Style, Title, Help, Ctxt)
270 If Response = vbYes Then    ' User chose Yes.
        '  If Val(Application.Version) > 8 Then
        '      Call izpis_md5
        '  End If
280     Application.ScreenUpdating = False     ' Disable screen flickering
        ' izpi|fffd|i obrazce
290     Worksheets("Osnovni podatki").Activate
300     ActiveSheet.PrintOut
310     Worksheets("BS").Activate
320     ActiveSheet.PrintOut
330     Worksheets("IPI").Activate
340     ActiveSheet.PrintOut
350     Worksheets("Izjava").Activate
360     If (Left(StrConv(ActiveSheet.Range("Izjava_opredelitev").Value, vbUpperCase), 2) = "DA" And _
            ActiveSheet.Range("F25").Value <> "<- Vrednost NI DA ali NE") _
            Then
370         ActiveSheet.PrintOut
380     End If
        ' Worksheets("Soglasje").Activate
        'If (Left(StrConv(ActiveSheet.Range("Soglasje_opredelitev").Value, vbUpperCase), 2) = "DA" And _
         '  ActiveSheet.Range("Soglasje_status").Value = "V redu") _
         'Then
        '  ActiveSheet.PrintOut
        'End If
390     Worksheets("Status_vnosa").Activate
400     Worksheets("Status_vnosa").Range("a17").Select
410     Application.ScreenUpdating = True
420 End If
430 With objole
440     .Height = cb_h
450     .Width = cb_w
460     .Top = cb_t
470     .Left = cb_l
480 End With
490 With objole1
500     .Height = cb1_h
510     .Width = cb1_w
520     .Top = cb1_t
530     .Left = cb1_l
540 End With
550 On Error GoTo 0
560 Exit Sub

TiskajObrazce_Error:

570 MsgBox "Napaka " & Err.Number & " v vrstici:" & Erl & " (" & Err.Description & ") v proceduri TiskajObrazce v modulu Module4"
End Sub
Public Sub velikost_gumbov()
    Dim btn As Shape, btn1 As Shape, btn2 As Shape
    Dim sht As Worksheet, sht1 As Worksheet
10  On Error GoTo velikost_gumbov_Error

20  Set sht = Worksheets("BS")
30  Set sht1 = Worksheets("IPI")
40  Set btn = sht.Shapes("Button 156")    'bs list izpis napak
50  Set btn1 = sht.Shapes("Button 159")    'bs list uvoz podatkov
60  Set btn2 = sht1.Shapes("Button 89")    'ipi list izpis napak
70  If Not btn.Top = 201 Then
80      With btn
90          .Height = 35.25
100         .Width = 168.75
110         .Top = 201
120         .Left = 744.75
130     End With
140     With btn1
150         .Height = 35.25
160         .Width = 168.75
170         .Top = 248.25
180         .Left = 744.75
190     End With
200     With btn2
210         .Height = 30
220         .Width = 168.75
230         .Top = 195.75
240         .Left = 763.5
250     End With
260 End If

270 On Error GoTo 0
280 Exit Sub

velikost_gumbov_Error:

290 MsgBox "Error " & Err.Number & " (" & Err.Description & ") v proceduri velikost_gumbov v modulu Module4"

End Sub
Public Function NameExist(wb As Workbook, StringName As String) As Boolean
    Dim errTest As String
10  On Error Resume Next
20  errTest = wb.Names(StringName).Value
30  NameExist = CBool(Err.Number = 0)
40  On Error GoTo 0
End Function


Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Option Explicit



Private Sub Workbook_Open()
    Call velikost_gumbov
End Sub


INQUEST-PP=macro
