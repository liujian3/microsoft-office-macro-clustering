Attribute VB_Name = "DieseArbeitsmappe"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'*******************************************************************************************
'Seitenname:                Diese Arbeitsmappe
'Zweck:                     Start des Workbooks
'Autor:                     T.Heldstab
'Datum Start:               26.9.2017
'Datum letzter Update:      26.9.2017
'*******************************************************************************************'

Option Explicit

'-------------------------------------------------------------------------------------------
'Zweck: Schutz
'-------------------------------------------------------------------------------------------

Private Sub Workbook_BeforeClose(Cancel As Boolean)
On Error Resume Next

    Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, False)
    Call EinblendenAusblendenArbeitsbl|fffd|tter(False, , , , , , , , , , , "tblLizenzieren")
    Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, True)

    Application.EnableCancelKey = xlInterrupt 'Schutz vor Einsicht in Quellcode Unterbrechung mit ESC wird aufgehoben
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Schutz, Navigation
'-------------------------------------------------------------------------------------------
Private Sub Workbook_Open()
On Error Resume Next

'-------------------------------------------------------------------------------------------
    'LCA 29.09.2017 f|fffd|r Sprach|fffd|nderung
    Sprachindex = Tabelle1.Range("G2").Value
'-------------------------------------------------------------------------------------------

    Application.EnableCancelKey = xlDisabled 'Schutz vor Einsicht in Quellcode Unterbrechung mit ESC
    
    Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, False)
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, False)
    
    'Tool ist abgelaufen (f|fffd|r die entsprechende Jahresperiode)
    If tblLizenzieren.Range("D6").Value <> "" Then 'nur wenn bereits eine Lizenierung erfolgt ist...)
        If CInt(BerechnenVerbleibendeTage) <= 0 Or CInt(BerechnenVerbleibendeTage) > 366 Then
'        If -1 <= 0 Then 'Test
            Call Zur|fffd|cksetzenAnfangszustand
            tblLizenzieren.Range("B6").Value = "Die Lizenz ist abgelaufen. Die Relizenzierung mit den vorhandenen Daten kann untenstehend erfolgen."
            Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, True)
            Exit Sub
        End If
    End If
    
    If tblLizenzieren.txtFreigabeschluessel.Text <> "" Then
        If CheckenFreigabe(UCase(Trim(tblLizenzieren.txtFreigabeschluessel))) = True Then
            Call EinblendenAusblendenArbeitsbl|fffd|tter(True)
            tblLizenzieren.Range("D5").Value = Date 'schreibt bei jedem |fffd|ffnen das aktuelle Datum
            Call Blattstatus(True)
        End If
    Else 'Lizenzierung noch nicht erfolgt
        Call EinblendenAusblendenArbeitsbl|fffd|tter(False, , , , , , , , , , , "tblLizenzieren")
        Call Blattstatus(False)
    End If
    
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, True)
    Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, True)
    tblLizenzieren.Range("B6").Select 'Selektierung der Statusmeldung
End Sub


Attribute VB_Name = "Sprach|fffd|nderung"
'Variable f|fffd|r Sprachindex/|fffd|nderung der Sprachauswahl im Blatt "Anleitung"
'f|fffd|r Anpassung der Auswahl in den gr|fffd|nen Dropdownfeldern
Public Sprachindex As Variant


'---------------------------------------------------------------------------------------
' Aktualisiert: 10.07.2017 /LCA
' Zweck: |fffd|ndert die Arbeitsblatt-Namen je nach Sprachauswahl
' Blattnamen wird ausgef|fffd|hrt, wenn im Blatt Anleitung die Sprache im Auswahlmenu ge|fffd|ndert wird
' Das Auswahlfeld ist mit diesem Makro verkn|fffd|pft.
'---------------------------------------------------------------------------------------
Sub Blattnamen()
Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, False)
    Tabelle1.Name = tblBegriffe.Range("F7").Value 'Anleitung
    Tabelle2.Name = tblBegriffe.Range("F8").Value 'Eingaben
    Tabelle3.Name = tblBegriffe.Range("F9").Value 'Erstellung
    Tabelle4.Name = tblBegriffe.Range("F10").Value 'Betrieb
    Tabelle5.Name = tblBegriffe.Range("F11").Value 'Mobilit|fffd|t
    Tabelle6.Name = tblBegriffe.Range("F12").Value 'Auswertung
    Tabelle14.Name = tblBegriffe.Range("F13").Value 'Integrierter Rechner
    Tabelle15.Name = tblBegriffe.Range("F14").Value 'Bauprojekt
Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, True)
End Sub

'---------------------------------------------------------------------------------------
' Aktualisiert: 29.09.2017 /LCA
' Zweck: Passt die Auswahl in den gr|fffd|nen Dropdownlisten an die Sprachauswahl an
' Aufruf siehe Blatt "Anleitung"
'---------------------------------------------------------------------------------------
Sub Greenfields()
' Tabelle2: Eingaben -> 6 Auswahlfelder
For Each c In Tabelle2.Range("B17:B19").Cells
If c.Value <> "..." Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

For Each c In Tabelle2.Range("D17:D19").Cells
If c.Value <> "..." Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

' Tabelle3: Erstellung -> 17 Auswahlfelder
For Each c In Tabelle3.Range("F13:F32").Cells
If Not IsEmpty(c) Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next
Tabelle3.Range("F34").Value = tblBegriffe.Range("F" & RowNumber(Tabelle3.Range("F34").Value2)).Value
Tabelle3.Range("F39").Value = tblBegriffe.Range("F" & RowNumber(Tabelle3.Range("F39").Value2)).Value

' Tabelle4: Betrieb -> 15 Auswahlfelder
For Each c In Tabelle4.Range("M14:M19").Cells
If Not IsEmpty(c) Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

For Each c In Tabelle4.Range("M21:M27").Cells
If Not IsEmpty(c) Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

Tabelle4.Range("M31").Value = tblBegriffe.Range("F" & RowNumber(Tabelle4.Range("M31").Value2)).Value
Tabelle4.Range("C44").Value = tblBegriffe.Range("F" & RowNumber(Tabelle4.Range("C44").Value2)).Value

' Tabelle5: Mobilit|fffd|t -> 9 Auswahlfelder
For Each c In Tabelle5.Range("M9:M17").Cells
If Not IsNumeric(c) Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

For Each c In Tabelle5.Range("M20:M24").Cells
If Not IsNumeric(c) Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

Tabelle5.Range("M27").Value = tblBegriffe.Range("F" & RowNumber(Tabelle5.Range("M27").Value2)).Value
Tabelle5.Range("G35").Value = tblBegriffe.Range("F" & RowNumber(Tabelle5.Range("G35").Value2)).Value
Tabelle5.Range("G38").Value = tblBegriffe.Range("F" & RowNumber(Tabelle5.Range("G38").Value2)).Value
Tabelle5.Range("G41").Value = tblBegriffe.Range("F" & RowNumber(Tabelle5.Range("G41").Value2)).Value

' Tabelle15: Bauprojekt -> 17 Auswahlfelder
Tabelle15.Range("D15").Value = tblBegriffe.Range("F" & RowNumber(Tabelle15.Range("D15").Value2)).Value

For Each c In Tabelle15.Range("F5:I5").Cells
If c.Value <> "..." Then
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
End If
Next

For Each c In Tabelle15.Range("F6:I6").Cells
If c.Value <> "..." Then
c.Value = tblBegriffe.Range("F" & RowNumber2(c.Value2)).Value
End If
Next

For Each c In Tabelle15.Range("D24:D26").Cells
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
Next

For Each c In Tabelle15.Range("D29:D31").Cells
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
Next

For Each c In Tabelle15.Range("D34:D35").Cells
c.Value = tblBegriffe.Range("F" & RowNumber(c.Value2)).Value
Next

End Sub



'---------------------------------------------------------------------------------------
' Aktualisiert: 29.09.2017 /LCA
' Zweck: Findet die Zeilennummer eines gesuchten Wortes in der Tabelle "Begriffe"
' und gibt diese als RowNumber zur|fffd|ck
'---------------------------------------------------------------------------------------
Function RowNumber(WasSuchen As String) As Long
Dim Gefunden As Range
Set Gefunden = tblBegriffe.Range("C6:E500").Find(WasSuchen, LookAt:=xlWhole) ' xlWhole bedeutet, dass |fffd|bereinstimmung exakt sein muss
If Not Gefunden Is Nothing Then RowNumber = Gefunden.Row
End Function

Function RowNumber2(WasSuchen As String) As Long ' Nur f|fffd|r Bauprojekt
Dim Gefunden As Range
Set Gefunden = tblBegriffe.Range("C58:E61").Find(WasSuchen, LookAt:=xlWhole) ' xlWhole bedeutet, dass |fffd|bereinstimmung exakt sein muss
If Not Gefunden Is Nothing Then RowNumber2 = Gefunden.Row
End Function
Attribute VB_Name = "Tabelle1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
'---------------------------------------------------------------------------------------
' Aktualisiert: 29.09.2017 /LCA
' Zweck: Wenn sich der Wert des Sprachindex in der Zelle G2 |fffd|ndert, f|fffd|hre folgende |fffd|nderungen aus:
'---------------------------------------------------------------------------------------
Private Sub Worksheet_Calculate()
    If Range("G2").Value <> Sprachindex Then
        MsgBox "Language changed"
        Call Greenfields ' Siehe Modul "Sprach|fffd|nderung"
        Sprachindex = Range("G2").Value 'Aktualisiert den Sprachindex auf die gew|fffd|hlte Sprache NACH der |fffd|nderung
    End If
End Sub


Attribute VB_Name = "Tabelle10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


' Damit die Eingeblendeten resp. Ausgeblendeten Zellen bei Auswahl der Geb|fffd|udekategorie Wohnen mit Belegungsvorschriften
' tats|fffd|chlich funktioniert
Private Sub Worksheet_Change(ByVal Target As Range)
Application.ScreenUpdating = True
End Sub

Attribute VB_Name = "Tabelle3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Tabelle9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "basLizenzieren"
'
'*******************************************************************************************
'Seitenname:                basLizenzieren (Standardmodul)
'Zweck:                     Globale Deklarationen, globale Prozeduren und Funktionen
'Autor:                     T.Heldstab
'Datum Start:               5.11.2015
'Datum letzter Update:      26.9.2017
'*******************************************************************************************'

Option Explicit

Public Const cgstrPasswortBlattschutz As String = "AWOUZTRF"
Public Const cgstrPasswortStrukturArbeitsmappe As String = "SIA2040"
Public gstrJahresinformation As String
Public gstrMonatsinformation As String

'-------------------------------------------------------------------------------------------
'Zweck: Zeichensatz Tool setzen, Check auf Freigabe, Jahres- und Monatsinformation auslesen
'-------------------------------------------------------------------------------------------

Public Function CheckenFreigabe(ByVal Freigabeschluessel As String) As Boolean
On Error Resume Next
    
    '*********************Zeichensatz Tool setzen*********************
    
    Dim strZeichensatz As String 'siehe Webapplikation
    Const cstrZeichensatz1 As String = "HIMYQGEDXTBCSOFAPZULKJNRVW"
    Const cstrZeichensatz2 As String = "RVULEDGXFNOATYKMHQSWIJBCPZ"
    Const cstrZeichensatz3 As String = "HIJVZKDXULREQGBCTPFSMNOWAY"
    Const cstrZeichensatz4 As String = "HNOPZULBJATSMWCXFVIYKGQEDR"
    Const cstrZeichensatz5 As String = "WFLPOYQSMDXKGRVBZUANTEHIJC"
    Const cstrZeichensatz6 As String = "XFSIJBCKQMNPZUTEDLRVGHAWOY"
    Const cstrZeichensatz7 As String = "FBCNEKHGOYPZULRVQSTIJMWADX"
    Const cstrZeichensatz8 As String = "HNLRMGBCXOYUPZAIJQSFTEDVWK"
    Const cstrZeichensatz9 As String = "NKHIJPFCWAOBGEXDRVLQSTMYZU"
        
    Dim strTeilFreigabeschluessel As String
    Dim i As Integer
    Dim intASCIISumme As Integer
    Dim strA As String
    Dim strA1 As String
    Dim strA2 As String
    Dim strK As String
    Dim strKZufall As String
    Dim strKTeil(9) As String
    Dim strC As String

    strTeilFreigabeschluessel = Right(Freigabeschluessel, 6)
    strA = Right(tblLizenzieren.Range("B30"), 6)
    
    Select Case Left(Freigabeschluessel, 1)
        Case "1"
            strZeichensatz = cstrZeichensatz1
            gstrJahresinformation = "2015"
            If CStr(Year(Now)) = "2024" Then gstrJahresinformation = "2024"
        Case "2"
            strZeichensatz = cstrZeichensatz2
            gstrJahresinformation = "2016"
            If CStr(Year(Now)) = "2025" Then gstrJahresinformation = "2025"
        Case "3"
            strZeichensatz = cstrZeichensatz3
            gstrJahresinformation = "2017"
            If CStr(Year(Now)) = "2026" Then gstrJahresinformation = "2026"
        Case "4"
            strZeichensatz = cstrZeichensatz4
            gstrJahresinformation = "2018"
            If CStr(Year(Now)) = "2027" Then gstrJahresinformation = "2027"
        Case "5"
            strZeichensatz = cstrZeichensatz5
            gstrJahresinformation = "2019"
            If CStr(Year(Now)) = "2028" Then gstrJahresinformation = "2028"
        Case "6"
            strZeichensatz = cstrZeichensatz6
            gstrJahresinformation = "2020"
            If CStr(Year(Now)) = "2029" Then gstrJahresinformation = "2029"
        Case "7"
            strZeichensatz = cstrZeichensatz7
            gstrJahresinformation = "2021"
            If CStr(Year(Now)) = "2030" Then gstrJahresinformation = "2030"
        Case "8"
            strZeichensatz = cstrZeichensatz8
            gstrJahresinformation = "2022"
            If CStr(Year(Now)) = "2031" Then gstrJahresinformation = "2031"
        Case "9"
            strZeichensatz = cstrZeichensatz9
            gstrJahresinformation = "2023"
            If CStr(Year(Now)) = "2032" Then gstrJahresinformation = "2032"
        Case Else
            'mache nichts
    End Select
    
    'Monatsinformation auslesen
    Select Case Mid(Freigabeschluessel, 2, 1)
        Case "A"
            gstrMonatsinformation = "1"
        Case "B"
            gstrMonatsinformation = "2"
        Case "C"
            gstrMonatsinformation = "3"
        Case "D"
            gstrMonatsinformation = "4"
        Case "E"
            gstrMonatsinformation = "5"
        Case "F"
            gstrMonatsinformation = "6"
        Case "G"
            gstrMonatsinformation = "7"
        Case "H"
            gstrMonatsinformation = "8"
        Case "I"
            gstrMonatsinformation = "9"
        Case "J"
            gstrMonatsinformation = "10"
        Case "K"
            gstrMonatsinformation = "11"
        Case "L"
            gstrMonatsinformation = "12"
        Case Else
            'mache nichts
    End Select
    
    strKTeil(0) = Mid(strZeichensatz, 1, 3)
    strKTeil(1) = Mid(strZeichensatz, 4, 3)
    strKTeil(2) = Mid(strZeichensatz, 7, 3)
    strKTeil(3) = Mid(strZeichensatz, 10, 3)
    strKTeil(4) = Mid(strZeichensatz, 13, 3)
    strKTeil(5) = Mid(strZeichensatz, 16, 2)
    strKTeil(6) = Mid(strZeichensatz, 18, 2)
    strKTeil(7) = Mid(strZeichensatz, 20, 2)
    strKTeil(8) = Mid(strZeichensatz, 22, 2)
    strKTeil(9) = Mid(strZeichensatz, 24, 3)
   
    intASCIISumme = 0
    For i = 1 To Len(strA)
        intASCIISumme = intASCIISumme + Asc(Mid(strA, i, 1))
    Next i
    
    intASCIISumme = intASCIISumme Mod 10 + 1
    strKZufall = Choose(intASCIISumme, "1243576890", "2345768901", "3456879012", "4567980123", "5687901234", "6780912345", "7890132456", "8901243567", "9013245678", "9235467801")
    
    strK = ""
    For i = 1 To 10
        strK = strK & strKTeil(CLng(Mid(strKZufall, i, 1)))
    Next i
   
    strC = ""
    For i = 1 To Len(Left(strTeilFreigabeschluessel, 6))
        strC = strC & Mid(strZeichensatz, InStr(1, strK, Mid(strTeilFreigabeschluessel, i, 1)), 1)
    Next i
    
    If strC = strA Then
        CheckenFreigabe = True
    Else
        CheckenFreigabe = False
    End If
End Function

'-------------------------------------------------------------------------------------------
'Zweck: bestimmt Anzahl verbleibende Tage (vor- und nach Lizenzierung)
'-------------------------------------------------------------------------------------------

Public Function BerechnenVerbleibendeTage() As String
On Error Resume Next
    
    Dim strTagLizenzierung As String
    Dim strMonatLizenzierung As String
    Dim strJahrLizenzierung As String
    Dim strLizenzierungsdatum As String
    Dim dtmEnddatum As Date
    
    strTagLizenzierung = Day(tblLizenzieren.Range("D6").Value)
    strMonatLizenzierung = tblLizenzieren.Range("E6").Value
    strJahrLizenzierung = tblLizenzieren.Range("F6").Value
   
    strLizenzierungsdatum = strTagLizenzierung & "." & strMonatLizenzierung & "." & strJahrLizenzierung
    If tblLizenzieren.Range("D5").Value <> "" And tblLizenzieren.Range("D5").Value < CDate(strLizenzierungsdatum) Then 'untr|fffd|gliches Zeichen, dass die Computerzeit zur|fffd|ckgestellt worden ist
        BerechnenVerbleibendeTage = "0"
    Else
        dtmEnddatum = DateAdd("yyyy", 1, CDate(strLizenzierungsdatum)) 'Enddatum
        BerechnenVerbleibendeTage = CStr(DateDiff("d", Date, dtmEnddatum))
    End If
End Function

'-------------------------------------------------------------------------------------------
'Zweck: In den Anfangszustand zur|fffd|cksetzen
'-------------------------------------------------------------------------------------------

Public Sub Zur|fffd|cksetzenAnfangszustand()
On Error Resume Next

    tblLizenzieren.Range("D5").Value = "" 'Anfangsdatum Lizenzierung zur|fffd|ckstellen (entscheidendes Feld)
    tblLizenzieren.Range("D6").Value = "" 'Datum zur|fffd|ckstellen
    tblLizenzieren.Range("E6").Value = "" 'Monat zur|fffd|ckstellen
    tblLizenzieren.Range("F6").Value = "" 'Jahr zur|fffd|ckstellen

    tblLizenzieren.Range("B6").Value = "" 'Statusinformation 1
    tblLizenzieren.Range("B25").Value = "" 'Statusinformation 2
    tblLizenzieren.Range("B30").Value = "" 'Tool-Code
    
    tblLizenzieren.txtFirmenname.Text = ""
    tblLizenzieren.txtFreigabeschluessel = ""
    tblLizenzieren.cboSprachwahl.Enabled = True
        
    Call Blattstatus(False)
    
    Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, False)
    Call EinblendenAusblendenArbeitsbl|fffd|tter(False, , , , , , , , , , , "tblLizenzieren")
    Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, True)
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: bestimmt den Blattstatus
'-------------------------------------------------------------------------------------------

Public Sub Blattstatus(ByVal Eingabe As Boolean)
On Error Resume Next

    If Eingabe = True Then
        If tblLizenzieren.cboSprachwahl.ListIndex = 0 Then
            tblLizenzieren.Range("B6").Value = "Die verbleibende Lizenzdauer betr|fffd|gt noch " & BerechnenVerbleibendeTage & " Tage."
        Else
            tblLizenzieren.Range("B6").Value = "La dur|fffd|e restante de la licence est de " & BerechnenVerbleibendeTage & " jours."
        End If
        tblLizenzieren.txtFirmenname.Enabled = False
        tblLizenzieren.txtFreigabeschluessel.Enabled = False
        tblLizenzieren.cmdLizenzBestellen.Enabled = False
        tblLizenzieren.cmdLizenzieren.Enabled = False
        tblLizenzieren.cmdStart.Enabled = True
    Else
        If tblLizenzieren.cboSprachwahl.ListIndex = 0 Then
            tblLizenzieren.Range("B6").Value = "Die Rechenhilfe ist nicht lizenziert."
        Else
            tblLizenzieren.Range("B6").Value = "Vous ne disposez pas de licence pour utiliser cet outil."
        End If
        tblLizenzieren.txtFirmenname.Enabled = True
        tblLizenzieren.txtFreigabeschluessel.Enabled = True
        tblLizenzieren.cmdLizenzBestellen.Enabled = True
        tblLizenzieren.cmdLizenzieren.Enabled = True
        tblLizenzieren.cmdStart.Enabled = False
    End If
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Schutz Struktur Arbeitsmappe setzen/aufheben
'-------------------------------------------------------------------------------------------

Public Sub SetzenAufhebenStrukturArbeitsmappe(Passwort As String, SetzenJa As Boolean)
On Error Resume Next

    If SetzenJa = True Then
        ActiveWorkbook.Protect Passwort, True
    Else
        ActiveWorkbook.Protect Passwort, False
    End If
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Blattschutz setzen/aufheben
'-------------------------------------------------------------------------------------------

Public Sub SetzenAufhebenBlattschutz(Tabellenblatt As String, Passwort As String, SetzenJa As Boolean)
On Error Resume Next

    If SetzenJa = True Then
        Worksheets.Item(Tabellenblatt).Protect Passwort, True, True, True 'Blattschutz setzen
    Else
        Worksheets.Item(Tabellenblatt).Unprotect Passwort 'Blattschutz aufheben
    End If
End Sub
    
'-------------------------------------------------------------------------------------------
'Zweck: blendet alle Arbeitsbl|fffd|tter mit definierten Ausnahmen ein oder aus
'versteckte Tabellenbl|fffd|tter des Entwicklers werden defaultm|fffd|ssig nicht eingeblendet
'-------------------------------------------------------------------------------------------

Public Sub EinblendenAusblendenArbeitsbl|fffd|tter(ByVal EinAus As Boolean, Optional ByVal NichtEinblenden1 As String, Optional ByVal NichtEinblenden2 As String, Optional ByVal NichtEinblenden3 As String, Optional ByVal NichtEinblenden4 As String, Optional ByVal NichtEinblenden5 As String, Optional ByVal NichtEinblenden6 As String, Optional ByVal NichtEinblenden7 As String, Optional ByVal NichtEinblenden8 As String, Optional ByVal NichtEinblenden9 As String, Optional ByVal NichtEinblenden10 As String, Optional ByVal NichtAusblenden1 As String, Optional ByVal NichtAusblenden2 As String, Optional ByVal NichtAusblenden3 As String, Optional ByVal NichtAusblenden4 As String, Optional ByVal NichtAusblenden5 As String)

    Dim i As Integer
    
    Application.ScreenUpdating = False
    
    For i = 1 To Worksheets.Count
        If EinAus = True Then
            If Worksheets.Item(i).CodeName = NichtEinblenden1 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden2 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden3 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden4 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden5 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden6 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden7 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden8 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden9 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtEinblenden10 Then
                'mache nichts
            Else
                If Not Worksheets.Item(i).Visible = xlSheetHidden Then 'versteckte Tabellenbl|fffd|tter des Entwicklers nicht einblenden
                    Worksheets.Item(i).Visible = xlSheetVisible 'Einblenden
                End If
            End If
        Else
            If Worksheets.Item(i).CodeName = NichtAusblenden1 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtAusblenden2 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtAusblenden3 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtAusblenden4 Then
                'mache nichts
            ElseIf Worksheets.Item(i).CodeName = NichtAusblenden5 Then
                'mache nichts
            Else
                If Not Worksheets.Item(i).Visible = xlSheetHidden Then 'versteckte Tabellenbl|fffd|tter des Entwicklers nicht einblenden
                    Worksheets.Item(i).Visible = xlSheetVeryHidden 'Ausblenden
                End If
            End If
        End If
    Next i
    
    Application.ScreenUpdating = True
End Sub

Attribute VB_Name = "tblBegriffe"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "tblLizenzieren"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "lblAnfangsbedingungen, 7, 0, MSForms, Label"
Attribute VB_Control = "txtFirmenname, 6, 1, MSForms, TextBox"
Attribute VB_Control = "cboSprachwahl, 5, 2, MSForms, ComboBox"
Attribute VB_Control = "cmdStart, 4, 3, MSForms, CommandButton"
Attribute VB_Control = "txtFreigabeschluessel, 3, 4, MSForms, TextBox"
Attribute VB_Control = "cmdLizenzieren, 2, 5, MSForms, CommandButton"
Attribute VB_Control = "cmdLizenzBestellen, 1, 6, MSForms, CommandButton"
'
'*******************************************************************************************
'Seitenname:                Lizenzieren
'Zweck:                     Lizenzieren
'Autor:                     T.Heldstab
'Datum Start:               5.11.2015
'Datum letzter Update:      26.9.2017
'*******************************************************************************************'

Option Explicit

Private Const mcstrHyperlinkDeutsch As String = "http://siatools.energycodes.ch/index.htm?lizenzieren.aspx"
Private Const mcstrHyperlinkFranzoesisch As String = "http://siatools.energycodes.ch/index.htm?lizenzierenf.aspx"
'Private Const mcstrHyperlinkDeutsch As String = "http://localhost:51086/SIAVertriebTools/lizenzieren.aspx" 'Test lokal
'Private Const mcstrHyperlinkFranzoesisch As String = "http://localhost:51086/SIAVertriebTools/lizenzierenf.aspx"  'Test lokal

'-------------------------------------------------------------------------------------------
'Zweck: Lizenz bestellen: Definition Typ Tool, Bestimmung Tool-Code und Navigation zur Bestellwebsite
'-------------------------------------------------------------------------------------------

Private Sub cmdLizenzBestellen_Click()
On Error Resume Next
   
    Dim strEingabe As String
    Dim i As Integer
    Dim intASCIISumme As Integer
    Dim strA As String
    Dim strA1 As String
    Dim strA2 As String
    Dim hyp As Hyperlink
    
    '*********************Definition Tool*********************'
    Const cstrTypTool As String = "22" 'SIA-Tool 2040 Effizienzpfad Energie
    
   
    'Validierung
    If Len(Trim(txtFirmenname.Text)) = 0 Then
        If tblLizenzieren.cboSprachwahl.ListIndex = 0 Then
            MsgBox "Eingabe Firmenname erforderlich", vbExclamation, "Benutzerf|fffd|hrung"
        Else
            MsgBox "La saisie du nom de l'entreprise est obligatoire.", vbExclamation, "Guide de l'utilisateur"
        End If
        Exit Sub
    End If
   
    strEingabe = Soundex(UCase(Trim(txtFirmenname.Text)))
   
    intASCIISumme = 0
    For i = 1 To Len(strEingabe)
        If Asc(Mid(strEingabe, i, 1)) <> 32 Then
            intASCIISumme = intASCIISumme + Asc(Mid(strEingabe, i, 1))
        End If
    Next i
    
    strA = ""
    strA1 = ""
    strA2 = ""
    
    For i = 1 To Len(CStr(intASCIISumme))
        strA1 = strA1 + CStr(Chr(CInt(Mid(CStr(intASCIISumme), i, 1) + 65)))
        strA2 = strA2 + CStr(Chr(CInt(Mid(CStr(intASCIISumme), i, 1) + 75)))
    Next i

    strA = cstrTypTool & Left(strA1, 3) & Right(strA2, 3)
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, False)
    For Each hyp In Hyperlinks 'Bereinigen
        hyp.Delete
    Next
    With Me
        .Hyperlinks.Add .Range("A40"), ""
    End With
    
    Set hyp = Hyperlinks(1)
    If cboSprachwahl.ListIndex = 0 Then
        hyp.Address = mcstrHyperlinkDeutsch & "?C=" & strA
    Else
        hyp.Address = mcstrHyperlinkFranzoesisch & "?C=" & strA
    End If
    hyp.Follow NewWindow:=True
        
    tblLizenzieren.Range("B30") = strA
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, True)
    ActiveWorkbook.Save
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Lizenzieren
'-------------------------------------------------------------------------------------------

Private Sub cmdLizenzieren_Click()
On Error Resume Next

    'Validierung
    If Len(Trim(txtFreigabeschluessel.Text)) = 0 Then
        If tblLizenzieren.cboSprachwahl.ListIndex = 0 Then
            MsgBox "Eingabe Freigabeschl|fffd|ssel erforderlich", vbExclamation, "Benutzerf|fffd|hrung"
        Else
            MsgBox "La saisie de la cl|fffd| de validation est obligatoire.", vbExclamation, "Guide de l'utilisateur"
        End If
        Exit Sub
    End If

    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, False)

    If CheckenFreigabe(UCase(Trim(tblLizenzieren.txtFreigabeschluessel.Text))) = True Then
        If tblLizenzieren.cboSprachwahl.ListIndex = 0 Then
            tblLizenzieren.Range("B25").Value = "Das Tool wurde erfolgreich lizenziert."
        Else
            tblLizenzieren.Range("B25").Value = "La licence de l'outil a |fffd|t|fffd| activ|fffd|e."
        End If
        tblLizenzieren.Range("D6").Value = Date 'entsprechendes Datum setzen
        tblLizenzieren.Range("E6").Value = gstrMonatsinformation 'entsprechenden Monat setzen
        tblLizenzieren.Range("F6").Value = gstrJahresinformation 'entsprechendes Jahr setzen
        Call Blattstatus(True)
        Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, False)
        Call EinblendenAusblendenArbeitsbl|fffd|tter(True)
        Call SetzenAufhebenStrukturArbeitsmappe(cgstrPasswortStrukturArbeitsmappe, True)
        cboSprachwahl.Enabled = False
        ActiveWorkbook.Save
    Else
        If tblLizenzieren.cboSprachwahl.ListIndex = 0 Then
            tblLizenzieren.Range("B25").Value = "Die Eingabe des Freischalteschl|fffd|ssel ist nicht korrekt. Bitte versuchen Sie es erneut."
        Else
            tblLizenzieren.Range("B25").Value = "La cl|fffd| de validation saisie est incorrecte, veuillez r|fffd|essayer."
        End If
    End If
    
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, True)
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Anfangszustand
'-------------------------------------------------------------------------------------------

Private Sub lblAnfangsbedingungen_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
On Error Resume Next

    Dim strInput As String
    strInput = InputBox("Bitte geben Sie den notwendigen Code ein!", "Benutzerf|fffd|hrung")
    
    If strInput <> "AWOUZTRF" Then Exit Sub
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, False)
    Call Zur|fffd|cksetzenAnfangszustand
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, True)
    ActiveWorkbook.Save
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Start
'-------------------------------------------------------------------------------------------

Private Sub cmdStart_Click()
On Error Resume Next

    Tabelle1.Select
End Sub

'-------------------------------------------------------------------------------------------
'Zweck: Soundex-Algorithmus (Erh|fffd|hung Fehlertoleranz bei der Eingabe)
'hematik, hematick, hematikk ergibt H532, H532, H532
'-------------------------------------------------------------------------------------------

Private Function Soundex(ByVal Name As String) As String
On Error Resume Next

    Dim strCode1 As String
    Dim strCode2 As String
    Dim strName As String
    Dim i As Integer

    'AB
    strCode1 = ""
    strCode2 = ""

    strName = UCase(Name) 'Originalwort in Grossbuchstaben umwandeln
    'der erster Buchstabe wird beibehalten
    strCode1 = Left(strName, 1)

    'Jedem weiteren Buchstaben wird ein numerischer Wert zugewiesen,
    'alle anderen Buchstaben, Satzzeichen und Zahlen werden ignoriert
    For i = 2 To Len(strName)
        Select Case Mid(strName, i, 1)
            Case "B", "F", "P", "V"
                strCode1 = strCode1 + "1"
            Case "C", "G", "J", "K", "Q", "S", "X", "Z"
                strCode1 = strCode1 + "2"
            Case "D", "T"
                strCode1 = strCode1 + "3"
            Case "L"
                strCode1 = strCode1 + "4"
            Case "M", "N"
                strCode1 = strCode1 + "5"
            Case "R"
                strCode1 = strCode1 + "6"
            Case "|fffd|" 'f|fffd|r den deutschsprachigen Raum
                strCode1 = strCode1 + "22"
        End Select
        'If Len(strCode1) = 4 Then Exit For
    Next i

    strCode2 = Left(strName, 1)

    'alle sich direkt wiederholenden numerische Werte werden entfernt
    For i = 2 To Len(strCode1)
        If Mid(strCode1, i - 1, 1) <> Mid(strCode1, i, 1) Then
            strCode2 = strCode2 + Mid(strCode1, i, 1)
        End If
    Next

    'Beschr|fffd|nkung auf max. 4 Zeichen
    strCode2 = Left(strCode2, 4)

    'gegebenenfalls mit Nullen f|fffd|llen, bis String 4 Zeichen umfasst
    Do While Len(strCode2) < 4
        strCode2 = strCode2 + "0"
    Loop
    Soundex = strCode2
End Function

'-------------------------------------------------------------------------------------------
'Zweck: Sprachwahl Maske
'-------------------------------------------------------------------------------------------

Private Sub cboSprachwahl_Change()
On Error Resume Next

    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, False)

    If cboSprachwahl.ListIndex = 0 Then 'deutsch
        tblLizenzieren.Range("B4").Value = "Status"
        tblLizenzieren.Range("B6").Value = "Die Rechenhilfe ist nicht lizenziert."
        tblLizenzieren.Range("B8").Value = "Lizenzierung"
        tblLizenzieren.Range("B10").Value = "Bevor Sie mit diesem Tool arbeiten k|fffd|nnen, m|fffd|ssen Sie eine Lizenz erwerben. Geben Sie Ihren Firmennamen ein und klicken Sie auf |fffd|Lizenz bestellen|fffd|. Sie gelangen zum Bestellformular. Sobald Sie dieses ausgef|fffd|llt haben, erhalten Sie den Freigabeschl|fffd|ssel per E-Mail. Bitte geben Sie diesen unten ein und klicken |fffd|Lizenzieren|fffd|."
        tblLizenzieren.Range("B12").Value = "Firmenname"
        tblLizenzieren.Range("B17").Value = "Bitte geben Sie den per E-Mail erhaltenen Freigabeschl|fffd|ssel ein und klicken auf |fffd|Lizenzieren|fffd|."
        tblLizenzieren.Range("B19").Value = "Freigabeschl|fffd|ssel"
        tblLizenzieren.Range("B27").Value = "Hinweis: Das Tool wird weiterentwickelt. Updates sind auf der Website www.energytools.ch erh|fffd|ltlich."
        cmdStart.Caption = "Start"
        cmdLizenzBestellen.Caption = "Lizenz bestellen"
        cmdLizenzieren.Caption = "Lizenzieren"
    Else 'franz|fffd|sisch
        tblLizenzieren.Range("B4").Value = "Etat"
        tblLizenzieren.Range("B6").Value = "Vous ne disposez pas de licence pour utiliser cet outil."
        tblLizenzieren.Range("B8").Value = "Concession de licence"
        tblLizenzieren.Range("B10").Value = "Avant de pouvoir travailler avec cet outil, vous devez acqu|fffd|rir une licence. Saisissez le nom de votre entreprise et cliquez sur |fffd|Commander la licence|fffd|. Compl|fffd|tez le formulaire de commande. Vous recevrez ensuite la cl|fffd| de validation par e-mail. Saisissez la cl|fffd| de validation ci-dessous et cliquez sur |fffd|Activer la licence|fffd|."
        tblLizenzieren.Range("B12").Value = "Nom de l'entreprise"
        tblLizenzieren.Range("B17").Value = "Saisissez la cl|fffd| de validation que vous avez re|fffd|ue par e-mail et cliquez sur |fffd|Activer la licence|fffd|."
        tblLizenzieren.Range("B19").Value = "Cl|fffd| de validation"
        tblLizenzieren.Range("B27").Value = "Remarque: cet outil continue d'|fffd|voluer r|fffd|guli|fffd|rement. Des mises |fffd| jour sont disponibles sur le site internet www.energytools.ch."
        cmdStart.Caption = "Start"
        cmdLizenzBestellen.Caption = "Commander la licence"
        cmdLizenzieren.Caption = "Activer la licence"
    End If
    
    Call SetzenAufhebenBlattschutz("Lizenzieren", cgstrPasswortBlattschutz, True)
End Sub

' InQuest injected base64 decoded content
' szp.~
' ]0BH
' D@`BL
' 0`B\
' Akj|

INQUEST-PP=macro
