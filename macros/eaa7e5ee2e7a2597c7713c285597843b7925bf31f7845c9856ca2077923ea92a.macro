Attribute VB_Name = "Foglio1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio10"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio11"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio12"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio13"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio14"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio15"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio16"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio17"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio18"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio19"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio2"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio20"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio21"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio22"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio23"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio233"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio24"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio25"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio26"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio27"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio28"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio29"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Control = "CommandButton1, 1, 0, MSForms, CommandButton"
Private Sub CommandButton1_Click()
Call Call1
End Sub

Attribute VB_Name = "Foglio3"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio30"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio31"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio32"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio4"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio5"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio6"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio7"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio8"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Foglio9"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "Module1"
Sub OpenNewBox()
Dim xFilePath As String
Dim xObjFD As FileDialog
Set xObjFD = Application.FileDialog(msoFileDialogFilePicker)
  With xObjFD
        .AllowMultiSelect = False
        .Filters.Add "Excel Files", "*.xls; *.xlsx; *.xlsm; *.xlsb", 1
'        .Show
xFilePath = "Archivio_Un_Ov.xlsb"
'        If .SelectedItems.Count > 0 Then
            xFilePath = "Archivio_Un_Ov.xlsb" 'xFilePath
'        Else
'            Exit Sub
'        End If
    End With
    On Error GoTo 10
   
    Workbooks.Open xFilePath
10:
End Sub

Attribute VB_Name = "Modulo1"
Sub importarisultati()

Application.ScreenUpdating = False

Sheets("CAMP").Select
son = Cells(4, 15)
Sheets("RIS").Select



naz = Cells(1, 1)
lega = Cells(1, 2)

stato = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(stato) > 31 Then stato = Left(stato, 31)

Application.StatusBar = "Cerco dati per: " & naz & "  " & lega

' carico pagina con risultati

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracsByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/results/"
Set http1 = CreateObject("MSXML2.XMLHTTP")
'Set http1 = CreateObject("MSXML2.ServerXMLHTTP")
http1.Open "POST", url1, False
''http1.send
'text1 = http1.responseText
http1.send
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")

Sheets("RIS").Select

' cancello foglio


For Each foglio In Worksheets
If foglio.Name = "" & stato & "" Then
GoTo 10
End If
Next foglio
Sheets.Add after:=Worksheets(Worksheets.Count)
ActiveSheet.Name = stato

10 Sheets(stato).Select

fin = Range("A" & Rows.Count).End(xlUp).Row


If son = "S" Then
    For y = 1 To fin
       If Cells(y, 8) = "" Then
        Cells.Select
        Selection.ClearContents
        Exit For
        End If
    Next y
End If
        ' prendo l'ultimo incontro

        sq11 = Cells(1, 1): sq21 = Cells(1, 2)
        If Cells(1, 1) = "" Then GoTo 2
        controlloinc1 = "<span>" & sq11 & "</span> - <span>" & sq21 & "</span>"
        controlloinc2 = "<span><strong>" & sq11 & "</strong></span> - <span>" & sq21 & "</span>"
        controlloinc3 = "<span>" & sq11 & "</span> - <span><strong>" & sq21 & "</strong></span>"
        
         posizinc1 = InStr(1, text1, controlloinc1) - 20
         posizinc2 = InStr(1, text1, controlloinc2) - 20
         posizinc3 = InStr(1, text1, controlloinc3) - 20
         
         If posizinc1 = -20 Then posizinc1 = 1000000
         If posizinc2 = -20 Then posizinc2 = 1000000
         If posizinc3 = -20 Then posizinc3 = 1000000
         
         
         If posizinc1 > 0 And posizinc1 < posizinc2 And posizinc1 < posizinc3 Then
         posizinc2 = -20
         posizinc3 = -20
         End If
         If posizinc2 > 0 And posizinc2 < posizinc1 And posizinc2 < posizinc3 Then
         posizinc1 = -20
         posizinc3 = -20
         End If
         If posizinc3 > 0 And posizinc3 < posizinc2 And posizinc3 < posizinc1 Then
         posizinc2 = -20
         posizinc1 = -20
         End If
         
         
                        
         If posizinc1 <> -20 Then
         posizinc = posizinc1
         controlloinc = controlloinc1
         End If
         If posizinc2 <> -20 Then
         posizinc = posizinc2
         controlloinc = controlloinc2
         End If
         If posizinc3 <> -20 Then
         posizinc = posizinc3
         controlloinc = controlloinc3
         End If
         
        On Error Resume Next
         posizinc = InStr(1, text1, controlloinc) - 20
        text1 = Trim(Mid(text1, 1, posizinc))
        
        ' inizio ricerca dati
        
        
2       controllo1 = "in-match"
        ninc = (Len(text1) - Len(Replace(text1, controllo1, ""))) / Len(controllo1)
        
        If ninc = 0 Then GoTo 60
        ' inizio ricerca dati
        
5        Rows("1:" & ninc & "").Select
        Selection.Insert Shift:=xlDown
        posin = 1
        
        
        For T = 1 To ninc
        Application.StatusBar = "Cerco risultati HT per: " & naz & "  " & lega & " : " & T & " di " & ninc
        
        If Cells(1, 1) = "" Then
        X = 1
        GoTo 7
        End If
        If Cells(1, 1) <> "" And Cells(2, 1) = "" Then
        X = 2
        GoTo 7
        End If
        
        Range("A1").End(xlDown).Offset(1, 0).Select
       
        X = ActiveCell.Row
        ' ricerca ris HT
        
7        If son = "N" Then GoTo 20
        
        controllolink1 = "<tr><td class="
        lenlink1 = Len(controllolink1)
        controllolink2 = "class="
        posizlink1 = InStr(posin, text1, controllolink1) + lenlink1 + 20
        posizlink2 = InStr(posizlink1, text1, controllolink2)
        linkhh = Trim(Mid(text1, posizlink1, posizlink2 - posizlink1))
        
        url1 = "https://www.betexplorer.com" & linkhh
        
'Set http1 = CreateObject("MSXML2.XMLHTTP")
Set http1 = CreateObject("MSXML2.ServerXMLHTTP")
http1.Open "POST", url1, False
http1.send
Texthh = http1.responseText
Texthh = Replace(Texthh, Chr(34), "")
        
        con1 = "js-partial"
        lencon1 = Len(con1)
        con2 = ":"
        con3 = ","
        con4 = "</h2>"
        pos1 = InStr(1, Texthh, con1) + lencon1 + 2
        testaw = Trim(Mid(Texthh, pos1, 4))
        If testaw = "nbsp" Then
        posx = InStr(1, Texthh, "js-eventstage") + 14
        testaw = Trim(Mid(Texthh, posx, 7))
        GoTo 20
        End If
        pos2 = InStr(pos1, Texthh, con2)
        If pos2 - pos1 > 5 Then GoTo 20
        pos3 = InStr(pos2, Texthh, con3)
        pos4 = InStr(pos3, Texthh, con2)
        pos5 = InStr(pos4, Texthh, con4)
        rsqh1 = Trim(Mid(Texthh, pos1, pos2 - pos1))
        rsqa1 = Trim(Mid(Texthh, pos2 + 1, pos3 - pos2 - 1))
        rsqh2 = Trim(Mid(Texthh, pos3 + 1, pos4 - pos3 - 1))
        rsqa2 = Trim(Mid(Texthh, pos4 + 1, pos5 - pos4 - 2))
        
        
        
        
        
        'sq1
        
20      controllo1 = "in-match"
        len1 = Len(controllo1)
        controllo2 = "<span>"
        len2 = Len(controllo2)
        controllo3 = "</span>"
        
        posiz1 = InStr(posin, text1, controllo1) + len1
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz2, text1, controllo3)
        sq1 = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        teststrong = InStr(1, sq1, "<strong>")
        If teststrong = 1 Then
        sq1 = Replace(sq1, "<strong>", "")
        sq1 = Replace(sq1, "</strong>", "")
        End If
        'sq2
        
        posiz2 = InStr(posiz3, text1, controllo2) + len2
        posiz3 = InStr(posiz2, text1, controllo3)
        sq2 = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        teststrong = InStr(1, sq2, "<strong>")
        If teststrong = 1 Then
        sq2 = Replace(sq2, "<strong>", "")
        sq2 = Replace(sq2, "</strong>", "")
        End If
        
        
        
        
        'risultato
        
        controllo4 = "/soccer/"
        controllo5 = ">"
        controllo6 = ":"
        controllo7 = "<"
        
        posiz1 = InStr(posiz3, text1, controllo4)
        posiz2 = InStr(posiz1, text1, controllo5) + 1
        If Trim(Mid(text1, posiz2, 1)) = "<" Then
        posin = posiz1
        Rows(X).Select
        Selection.Delete Shift:=xlUp
        GoTo 50
        End If
        posiz3 = InStr(posiz2, text1, controllo6)
        
        gsq1 = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        
        posiz4 = InStr(posiz3, text1, controllo7)
        gsq2 = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        ' quote
        
        controllo8 = "data-odd="
        len8 = Len(controllo8)
        controllo9 = ">"
        posiz5 = InStr(posiz4, text1, controllo8) + len8
        posiztest = InStr(posiz4, text1, controllo1)
        
        If posiztest <> 0 And posiztest < posiz5 Or posiz5 = 9 Then
        posiz6 = posiz4
        GoTo 30
        End If
        posiz6 = InStr(posiz5, text1, controllo9)
        quota1 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
        posiz5 = InStr(posiz5, text1, controllo8) + len8
        posiz6 = InStr(posiz5, text1, controllo9)
        quotax = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
        posiz5 = InStr(posiz5, text1, controllo8) + len8
        posiz6 = InStr(posiz5, text1, controllo9)
        quota2 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
       
        ' scrivo dati
        
30       If testaw = "Awarded" Then
        rsqh1 = gsq1: rsqa1 = gsq2: rsqh2 = 0: rsqa2 = 0
        End If
          If testaw = "Abandon" Then
        rsqh1 = gsq1: rsqa1 = gsq2: rsqh2 = 0: rsqa2 = 0
        End If
        Cells(X, 1) = sq1
        Cells(X, 2) = sq2
        Cells(X, 3) = quota1
        Cells(X, 4) = quotax
        Cells(X, 5) = quota2
        Cells(X, 6) = gsq1
        Cells(X, 7) = gsq2
        Cells(X, 8) = rsqh1
        If Cells(X, 8) = "" Then Cells(X, 8) = gsq1
        Cells(X, 9) = rsqa1
        If Cells(X, 9) = "" Then Cells(X, 9) = gsq2
        Cells(X, 10) = rsqh2
        If Cells(X, 10) = "" Then Cells(X, 10) = 0
        Cells(X, 11) = rsqa2
        If Cells(X, 11) = "" Then Cells(X, 11) = 0
        
        
        rsqh1 = "": rsqa1 = "": rsqh2 = "": rsqa2 = ""
        quota1 = "": quotax = "": quota2 = ""
        
        posin = posiz6
        
        

50  Next T

60    Sheets("DATI").Select
Application.StatusBar = ""

End Sub
Sub palinsesto2()

Dim dataincontro As Date
Dim a
Sheets("DATI").Range("A7:ad1000").ClearContents
Sheets("Link").Range("C4:H1000").ClearContents
Sheets("Link").Range("J4:K1000").ClearContents


Sheets("DATI").Range("D1").ClearContents
TempoElaborazione = Time
Range("D1").Select
'Sheets("DATI").Select

'Call ErasePal
Application.ScreenUpdating = False
Sheets("CAMP").Select

For T = 2 To Cells(1, 2) + 1
Sheets("CAMP").Select

naz = Cells(T, 1)
lega = Cells(T, 2)

stato = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbUpperCase), " ", "")
If Len(stato) > 31 Then stato = Left(stato, 31)

Sheets("RIS").Select
Cells.Select
    Selection.ClearContents

Cells(1, 1) = naz
Cells(1, 2) = lega

Sheets("DATI").Select

giornatetest = Cells(2, 2)
iniziolega = Cells(1, 2) + 1

' carico pagina con risultati

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracsByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
'Set http1 = CreateObject("MSXML2.ServerXMLHTTP")
http1.Open "POST", url1, False
http1.send
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")

 controllomain = ">Main<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
 controllomain = ">Torneo"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
controllomain = "Play Off"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
 controllomain = ">Apertura<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 50
 
 ninc = (Len(text1) - Len(Replace(text1, "table-main__daysign", ""))) / Len("table-main__daysign")
 
 
 
 
       controllo1 = "table-main__daysign"
       len1 = Len(controllo1)
       controllotest = "table-main__result"
       posizx = 1
       
       For f = 1 To ninc Step 1
       
       posizx1 = InStr(posizx, text1, controllo1) + len1
       posizx2 = InStr(posizx1, text1, controllo1)
       If posizx2 = 0 Then
       contr = "</table>"
       posizx2 = InStr(posizx1, text1, contr)
       End If
       textinc = Trim(Mid(text1, posizx1, posizx2 - posizx1))

       posiztest = InStr(1, textinc, controllotest)
       If posiztest <> 0 Then
       posizx = posizx2
       GoTo 10
       End If
       
       posiztest = InStr(1, textinc, "data-live-cell=")
       If posiztest <> 0 Then
       posizx = posizx2
       GoTo 10
       End If
       
       ' cerco link per h/h
       controllolink1 = "<a href="
       lenlink1 = Len(controllolink1)
       controllolink2 = "class="
       posizl1 = InStr(1, textinc, controllolink1) + lenlink1
       posizl2 = InStr(posizl1, textinc, controllolink2)
       linkhh = Trim(Mid(textinc, posizl1, posizl2 - posizl1))
      
       controllo2 = "</td>"
       controllo3 = "<span>"
       len3 = Len(controllo3)
       controllo4 = "</span>"
       
       ' cerco sq1
       
       posiz3 = InStr(posizl2, textinc, controllo3) + len3
       posiz4 = InStr(posiz3, textinc, controllo4)
       sq1 = Trim(Mid(textinc, posiz3, posiz4 - posiz3))
       
       For X = 6 To Cells(1, 2)
       
      If Cells(X, 5) = sq1 And Cells(X, 169) = "" Or Cells(X, 6) = sq1 And Cells(X, 169) = "" Then
       posizx = posizx2
       GoTo 10
       End If
       Next X
     
       ' cerco sq2
       
       posiz3 = InStr(posiz4, textinc, controllo3) + len3
       posiz4 = InStr(posiz3, textinc, controllo4)
       sq2 = Trim(Mid(textinc, posiz3, posiz4 - posiz3))
       
       For X = 6 To Cells(1, 2)
       
       If Cells(X, 5) = sq2 And Cells(X, 169) = "" Or Cells(X, 6) = sq2 And Cells(X, 169) = "" Then
       posizx = posizx2
       GoTo 10
       End If
       Next X
        
       ' cerco quote
        Cells(4, 7) = Now
        controllo5 = "data-odd="
        len5 = Len(controllo5)
        controllo6 = "></a></td>"
        controllo7 = "colspan="
        len7 = Len(controllo7)
        controllo8 = "</td>"
        
        

        posiz5 = InStr(posiz4, textinc, controllo5) + len5
        If posiz5 = 9 Then
        posizx = posizx2
        GoTo 10
        End If
        posiz6 = InStr(posiz5, textinc, controllo6)
        quota1 = (Trim(Mid(textinc, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, textinc, controllo5) + len5
        posiz6 = InStr(posiz5, textinc, controllo6)
        quotax = (Trim(Mid(textinc, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, textinc, controllo5) + len5
        posiz6 = InStr(posiz5, textinc, controllo6)
        quota2 = (Trim(Mid(textinc, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
        
        
        
         'cerco data
        
        
        posiz1 = InStr(posiz6, textinc, controllo7) + len7 + 2
        posiz2 = InStr(posiz1, textinc, controllo2)
        datainc = Trim(Mid(textinc, posiz1, posiz2 - posiz1))
               
        '----------------- Elaborazione Data ------------------
        If Mid(datainc, 1, 8) = "Tomorrow" Then
           datainc = Replace(datainc, "Tomorrow", Date + 1)
        End If
        
        If Mid(datainc, 1, 5) = "Today" Then
           datainc = Replace(datainc, "Today", Date)
        End If
        
        If Mid(datainc, 1, 9) = "Yesterday" Then
           datainc = Replace(datainc, "Yesterday", Date - 1)
        End If
        
        If Len(datainc) <= 12 And Mid(datainc, 6, 1) = "." Then
           parziale = Mid(datainc, 1, 6)
           anno = Year(Date)
           datainc = Replace(datainc, ". ", "." & anno & " ")
        End If
        '----------------- Fine Elaborazione Data -------------
               
        orainc = Trim(Mid(datainc, 11, 6))
        gg = Mid(datainc, 1, 2)
        mm = Mid(datainc, 4, 2)
        hh = Mid(datainc, 7, 4)
        dataincontro = gg & "/" & mm & "/" & hh
       
    If dataincontro <= Date + Range("H2") Then
        
        RIG = Cells(1, 2) + 1
       
        Cells(RIG, 1) = dataincontro
        Cells(RIG, 2) = orainc
        Cells(RIG, 3) = naz
        Cells(RIG, 4) = lega
        Cells(RIG, 5) = sq1
        Cells(RIG, 6) = sq2
        Cells(RIG, 7) = quota1
        Cells(RIG, 8) = quotax
        Cells(RIG, 9) = quota2
        Sheets("Link").Cells(RIG - 3, 3) = sq1 & sq2
        Sheets("Link").Cells(RIG - 3, 4) = naz
        Sheets("Link").Cells(RIG - 3, 5) = lega
        Sheets("Link").Cells(RIG - 3, 6) = sq1
        Sheets("Link").Cells(RIG - 3, 7) = sq2
        Sheets("Link").Cells(RIG - 3, 8) = linkhh
        ''''''''''''''''''''''''''''''''''''''''''''''''''
'        Sheets("QT_OV_UN").Select '<<< Il foglio su cui si fara' l'importazione
'Sheets("QT_OV_UN").Range("A:G").ClearContents 'NB: Il fofglio SARA' AZZERATO senza preavviso
'Sheets("QT_OV_UN").Range("A:X").NumberFormat = "0.00" 'Colonne in formato Testo
Sheets("QT_OV_UN").Range("Z1").Value = "https://www.betexplorer.com" & linkhh & "#ou" ' "Chiama" la GetTabbbSub
'Call Call1
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
'        Sheets("Dati").Cells(RIG, 10) = Sheets("QT_OV_UN").Range("Q4").Value
'        Sheets("Dati").Cells(RIG, 19) = Sheets("QT_OV_UN").Range("S4").Value
        
    End If
       
            
10          posizx = posizx2
            Next f
        
20      importarisultati

        Sheets("DATI").Select

        For X = iniziolega To Cells(1, 2)

        duepi|fffd|h = 0: giornateh = 0: giornatea = 0
        
        sq = Sheets("DATI").Cells(X, 5)
        Sheets(stato).Select
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = 1 To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 1 Then GoTo 122
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) >= 2 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 12) = duepi|fffd|h
                Sheets("DATI").Cells(X, 12).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 2 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 12) = duepi|fffd|h
                Sheets("DATI").Cells(X, 12).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
122:
giornateh = 1
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 2 Then GoTo 123
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) >= 2 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 13) = duepi|fffd|h
                Sheets("DATI").Cells(X, 13).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 2 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 13) = duepi|fffd|h
                Sheets("DATI").Cells(X, 13).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            
123:
giornateh = 2
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 3 Then GoTo 124
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) >= 2 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 14) = duepi|fffd|h
                Sheets("DATI").Cells(X, 14).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 2 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 14) = duepi|fffd|h
                Sheets("DATI").Cells(X, 14).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            

124:
    Next X

    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    Sheets("DATI").Select

        For X = iniziolega To Cells(1, 2)

        duepi|fffd|h = 0: giornateh = 0: giornatea = 0
        
        sq = Sheets("DATI").Cells(X, 6)
        Sheets(stato).Select
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = 1 To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 1 Then GoTo 125
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) >= 2 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 15) = duepi|fffd|h
                Sheets("DATI").Cells(X, 15).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 2 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 15) = duepi|fffd|h
                Sheets("DATI").Cells(X, 15).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
125:
giornateh = 1
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 2 Then GoTo 126
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) >= 2 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 16) = duepi|fffd|h
                Sheets("DATI").Cells(X, 16).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 2 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 16) = duepi|fffd|h
                Sheets("DATI").Cells(X, 16).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            
126:
giornateh = 2
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 3 Then GoTo 127
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) >= 2 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 17) = duepi|fffd|h
                Sheets("DATI").Cells(X, 17).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 2 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 17) = duepi|fffd|h
                Sheets("DATI").Cells(X, 17).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
127:
    Next X
    
    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    
 Sheets("DATI").Select

        For X = iniziolega To Cells(1, 2)

        duepi|fffd|h = 0: giornateh = 0: giornatea = 0
        
        sq = Sheets("DATI").Cells(X, 5)
        Sheets(stato).Select
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = 1 To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 1 Then GoTo 128
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) > 3 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 21) = duepi|fffd|h
                Sheets("DATI").Cells(X, 21).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 4 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 21) = duepi|fffd|h
                Sheets("DATI").Cells(X, 21).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
128:
giornateh = 1
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 2 Then GoTo 129
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) > 3 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 22) = duepi|fffd|h
                Sheets("DATI").Cells(X, 22).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 4 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 22) = duepi|fffd|h
                Sheets("DATI").Cells(X, 22).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            
129:
giornateh = 2
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 3 Then GoTo 130
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) > 3 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 23) = duepi|fffd|h
                Sheets("DATI").Cells(X, 23).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 4 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 23) = duepi|fffd|h
                Sheets("DATI").Cells(X, 23).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            

130:
    Next X

    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    Sheets("DATI").Select

        For X = iniziolega To Cells(1, 2)

        duepi|fffd|h = 0: giornateh = 0: giornatea = 0
        
        sq = Sheets("DATI").Cells(X, 6)
        Sheets(stato).Select
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = 1 To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 1 Then GoTo 131
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) > 3 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 24) = duepi|fffd|h
                Sheets("DATI").Cells(X, 24).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 4 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 24) = duepi|fffd|h
                Sheets("DATI").Cells(X, 24).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
131:
giornateh = 1
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 2 Then GoTo 132
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) > 3 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 25) = duepi|fffd|h
                Sheets("DATI").Cells(X, 25).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 4 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 25) = duepi|fffd|h
                Sheets("DATI").Cells(X, 25).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            
132:
giornateh = 2
a = c
     '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
            For c = a To fin
            If Cells(c, 1) = sq Or Cells(c, 2) = sq Then

                giornateh = giornateh + 1
                 If giornateh > 3 Then GoTo 133
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) > 3 Then
                duepi|fffd|h = "O"
                Sheets("DATI").Cells(X, 26) = duepi|fffd|h
                Sheets("DATI").Cells(X, 26).Font.Color = RGB(0, 176, 80)
                Else
                If Sheets(stato).Cells(c, 6) + Sheets(stato).Cells(c, 7) < 4 Then
                duepi|fffd|h = "U"
                Sheets("DATI").Cells(X, 26) = duepi|fffd|h
                Sheets("DATI").Cells(X, 26).Font.ColorIndex = 3
            End If
            End If
            End If
            Next c
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
133:
    Next X
    
    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''
    
    
         For X = iniziolega To Sheets("DATI").Cells(1, 2)

        duepi|fffd|a = 0: giornateh = 0: giornatea = 0
        sq = Cells(X, 6)
        Sheets(stato).Select
            
            fin = Range("A" & Rows.Count).End(xlUp).Row
            
            For c = 1 To fin

            
            If Cells(c, 2) = sq Then
                giornatetot = giornatetot + 1
                giornatea = giornatea + 1

                If Cells(c, 6) >= 2 Or Cells(c, 7) >= 2 Then
                duepi|fffd|a = duepi|fffd|a + 1
                End If

            End If
            
            Next c
            giornateh = 0: giornatetot = 0

            Sheets("DATI").Select
            


            hw = 0: hd = 0: hl = 0
            aw = 0: ad = 0: al = 0
            

            
49     Next X

    
    
50    Next T
    Sheets("DATI").Activate

Call Ordinepal
Call PREP
Tempoimpiegato = Now() - TempoElaborazione
Sheets("DATI").[D1] = Tempoimpiegato


End Sub



Attribute VB_Name = "Modulo10"
'Sub Grab_UN_OV_Odds()
Sub Call1UN()
Application.ScreenUpdating = False

Sheets("QT_OV_UN").Activate '<<< Il foglio su cui si fara' l'importazione
Range("A:G").ClearContents 'NB: Il fofglio SARA' AZZERATO senza preavviso
Range("A:X").NumberFormat = "0.00" 'Colonne in formato Testo
Call Grab_UN_OV_Odds(Range("Z1").Value) ' "Chiama" la GetTabbbSub
End Sub
Sub Grab_UN_OV_Odds(ByVal myURL As String)
'dimension (set aside memory for) our variables
'Dim Object As InternetExplorer
Dim ele As Object
Dim y As Integer
Dim URL As Range
Debug.Print ">>>", myURL
'Range("a1").Value = myURL

'With IE
'    .navigate myURL
'    .Visible = False
''Stop                                  'Vedi TESTO
'End With
''Sheets("QT_OV_UN").Activate
''Range("A3:L1000").ClearContents
''For X = 4 To Sheets("Link").Range("D" & Rows.Count).End(xlUp).Row
''
''UR1 = Sheets("Link").Cells(X, 9)
'Sheets("QT_OV_UN").Cells(1, 1) = UR1
On Error Resume Next

If objIE Is Nothing Then Set objIE = CreateObject("InternetExplorer.application")
With objIE
.navigate myURL   'UR1  '"https://www.betexplorer.com/soccer/denmark/1st-division/hvidovre-fredericia/dxcJZQ1D/#ou"
.Visible = False
Do While .Busy: DoEvents: Loop 'Attesa not busy
Do While .readyState <> 4: DoEvents: Loop 'Attesa documento
End With
'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

On Error Resume Next

'we will output data to excel, starting on row 1
I = 4

'look at all the 'tr' elements in the 'table' with id 'myTable',
'and evaluate each, one at a time, using 'ele' variable
For Each ele In objIE.document.getElementById("odds-all"). _
getElementsByTagName("tr")
'show the text content of 'tr' element being looked at
Debug.Print ele.innerText
'each 'tr' (table row) element contains 5 children ('td') elements
'put text of 1st 'td' in col A
Sheets("QT_OV_UN").Range("A" & I).Value = ele.Children(0).innerText
Sheets("QT_OV_UN").Range("B" & I).Value = ele.Children(2).innerText
Sheets("QT_OV_UN").Range("C" & I).Value = ele.Children(3).innerText
Sheets("QT_OV_UN").Range("D" & I).Value = ele.Children(4).innerText
Sheets("QT_OV_UN").Range("E" & I).Value = ele.Children(5).innerText
Sheets("QT_OV_UN").Range("F" & I).Value = ele.Children(6).innerText

'increment row counter by 1
I = I + 1
'repeat until last ele has been evaluated

Next
'Next X
objIE.Quit
Set objIE = Nothing

Range("A:A").WrapText = False
For I = 1 To lr
lr = Range("A" & Rows.Count).End(xlUp).Row
With Range("A:L" & I)
.Value = WorksheetFunction.Trim(.Value)
.Value = WorksheetFunction.Clean(.Value)
End With
Next I



Range("A1").Select
End Sub

Attribute VB_Name = "Modulo2"
Sub Ordinepal()
Attribute Ordinepal.VB_Description = "Macro registrata il 23/08/2018 da Marco"
Attribute Ordinepal.VB_ProcData.VB_Invoke_Func = " \n14"

If Range("G1").Value = 0 Then
    Range("A7:AD1000").Select
    Selection.Sort Key1:=Range("A7"), Order1:=xlAscending, Key2:=Range("B7") _
        , Order2:=xlAscending, Key3:=Range("C7"), Order3:=xlDescending, Header:= _
        xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, _
        DataOption1:=xlSortNormal, DataOption2:=xlSortNormal, DataOption3:= _
        xlSortNormal
End If
If Range("G1").Value = 1 Then
    Range("A7:AD1000").Select
    Selection.Sort Key1:=Range("C7"), Order1:=xlAscending, Key2:=Range("D7") _
        , Order2:=xlAscending, Key3:=Range("A7"), Order3:=xlAscending, Header:= _
        xlGuess, OrderCustom:=1, MatchCase:=False, Orientation:=xlTopToBottom, _
        DataOption1:=xlSortNormal, DataOption2:=xlSortNormal, DataOption3:= _
        xlSortNormal
End If
    Range("A1").Select
End Sub
Sub ErasePal()
Sheets("DATI").Activate
    Sheets("DATI").Range("A7:ad1000").ClearContents
    
'    Columns("V:AO").EntireColumn.Hidden = False  'true nasconde le colonne
End Sub
Attribute VB_Name = "Modulo3"
Sub risultati()
Dim dataincontro As Date
Dim dataincontro2 As Date

For X = 7 To Cells(1, 2)


dataincontro2 = Cells(X, 1)
'If dataincontro2 > dataincontro Then GoTo 10
naz = Cells(X, 3)
lega = Cells(X, 4)
sq1 = Cells(X, 5)
sq2 = Cells(X, 6)
Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

If naz = naz1 And lega = lega1 Then GoTo 5
Application.StatusBar = "Cerco risultati per: " & naz & "  " & lega
naz1 = naz
lega1 = lega



'---Inizio elaborazione Gol Full Time--------------------------
' carico pagina web
'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/results/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
Set http1 = Nothing

' cerco incontro
  

5        controllo1 = "<span>" & sq1 & "</span> - <span>" & sq2 & "</span>"
         controlloinc1 = "<span>" & sq1 & "</span> - <span>" & sq2 & "</span>"
         controlloinc2 = "<span><strong>" & sq1 & "</strong></span> - <span>" & sq2 & "</span>"
         controlloinc3 = "<span>" & sq1 & "</span> - <span><strong>" & sq2 & "</strong></span>"
        
         posizinc1 = InStr(1, text1, controlloinc1) - 20
         posizinc2 = InStr(1, text1, controlloinc2) - 20
         posizinc3 = InStr(1, text1, controlloinc3) - 20
                        
         If posizinc1 = -20 Then posizinc1 = 1000000
         If posizinc2 = -20 Then posizinc2 = 1000000
         If posizinc3 = -20 Then posizinc3 = 1000000
         
         
         If posizinc1 > 0 And posizinc1 < posizinc2 And posizinc1 < posizinc3 Then
         posizinc2 = -20
         posizinc3 = -20
         End If
         If posizinc2 > 0 And posizinc2 < posizinc1 And posizinc2 < posizinc3 Then
         posizinc1 = -20
         posizinc3 = -20
         End If
         If posizinc3 > 0 And posizinc3 < posizinc2 And posizinc3 < posizinc1 Then
         posizinc2 = -20
         posizinc1 = -20
         End If
         
         
                        
         If posizinc1 <> -20 Then
         controllo1 = controlloinc1
         End If
         If posizinc2 <> -20 Then
         controllo1 = controlloinc2
         End If
         If posizinc3 <> -20 Then
         controllo1 = controlloinc3
         End If
         



       len1 = Len(controllo1)
        controllo2 = "/>"
        controllo3 = ":"
        controllo4 = "</a>"
        
        posiz1 = InStr(1, text1, controllo1)
        If posiz1 = 0 Then GoTo 10
        Application.StatusBar = "Cerco risultati per: " & naz & "  " & lega & "  " & sq1 & "-" & sq2
        posiz1 = InStr(1, text1, controllo1) + len1 + 11
        
        controllohh1 = "><a href="
        controllohh2 = ">"
        posizhh1 = InStr(posiz1 - 100, text1, controllohh1) + 9
        posizhh2 = InStr(posizhh1, text1, controllohh2)
        linkhh = Trim(Mid(text1, posizhh1, posizhh2 - posizhh1)) 'Estrae Link squadra di casa
        
        
        
        posiz1 = InStr(posiz1, text1, controllo4) - 10
        posiz1 = InStr(posiz1, text1, controllo2) + 2
        posiz2 = InStr(posiz1, text1, controllo3)
        
        golsq1 = Trim(Mid(text1, posiz1, posiz2 - posiz1)) 'Estrae gol squadra di casa
        
        posiz2 = posiz2 + 1
        posiz3 = InStr(posiz2, text1, controllo4)
        
        golsq2 = Trim(Mid(text1, posiz2, posiz3 - posiz2)) 'Estrae gol squadra ospite
        
        If Len(golsq1) > 2 Then golsq1 = ""
        If Len(golsq2) > 2 Or golsq1 = "" Then golsq2 = ""
        
        controllodata = "h-text-right h-text-no-wrap"
        controllodatabis = "</td></tr>"
        
        lendata = Len(controllodata) + 1
        posiz4 = InStr(posiz3, text1, controllodata) + lendata
        posizdatafin = InStr(posiz4, text1, controllodatabis)
        datainc = Trim(Mid(text1, posiz4, posizdatafin - posiz4)) 'Estrae la data dell'incontro su pagina risultati
           
        'gg = Mid(datainc, 1, 2)
        'mm = Mid(datainc, 4, 2)
        'hh = Mid(datainc, 7, 4)
        'dataincontro = gg & "/" & mm & "/" & hh 'Formatta la data incontro
        
        '----------------- Elaborazione Data ------------------
        If Mid(datainc, 1, 8) = "Tomorrow" Then
           datainc = Replace(datainc, "Tomorrow", Date + 1)
        End If
        
        If Mid(datainc, 1, 5) = "Today" Then
           datainc = Replace(datainc, "Today", Date)
        End If
        
        If Mid(datainc, 1, 9) = "Yesterday" Then
           datainc = Replace(datainc, "Yesterday", Date - 1)
        End If
        
        If Len(datainc) <= 12 And Mid(datainc, 6, 1) = "." Then
           parziale = Mid(datainc, 1, 6)
           anno = Year(Date)
           datainc = datainc & anno
        End If
        '----------------- Fine Elaborazione Data -------------
               
        orainc = Trim(Mid(datainc, 11, 6))
        gg = Mid(datainc, 1, 2)
        mm = Mid(datainc, 4, 2)
        hh = Mid(datainc, 7, 4)
        dataincontro = gg & "/" & mm & "/" & hh
        
        
        
      
  
        
        d = dataincontro2 - dataincontro 'Sottrae la data incontro prelevata da excel a quella prelevata sul web per confronto successivo
        
        If d > 0 Then GoTo 10
        
        Range("Ad" & X) = golsq1 & "-" & golsq2 'Scrive i gol su foglio excel
        'Range("R" & x) = golsq2 'Scrive i gol su foglio excel

        'If golsq1 > golsq2 Then Range("CO" & x) = "1": GoTo 77
        'If golsq1 = golsq2 Then Range("CO" & x) = "X": GoTo 77
        'If golsq1 < golsq2 Then Range("CO" & x) = "2"
77         'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"
        
'---Fine elaborazione Gol Full Time----------------------------------


'---Inizio elaborazione Gol Primo Tempo/Secondo Tempo---------------------
        
     url1 = "https://www.betexplorer.com" & linkhh

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
Texthh = http1.responseText
Texthh = Replace(Texthh, Chr(34), "")
Set http1 = Nothing
       

        contro1 = "js-partial"
        lencontro1 = Len(contro1)
        contro2 = ":"
        contro3 = ","
        contro4 = "</h2>"
        pos1 = InStr(1, Texthh, contro1) + lencontro1 + 2
        pos2 = InStr(pos1, Texthh, contro2)
        If pos2 - pos1 > 5 Then GoTo 10
        pos3 = InStr(pos2, Texthh, contro3)
        pos4 = InStr(pos3, Texthh, contro2)
        pos5 = InStr(pos4, Texthh, contro4)
        rsqh1 = Trim(Mid(Texthh, pos1, pos2 - pos1))
        rsqa1 = Trim(Mid(Texthh, pos2 + 1, pos3 - pos2 - 1))
        rsqh2 = Trim(Mid(Texthh, pos3 + 1, pos4 - pos3 - 1))
        rsqa2 = Trim(Mid(Texthh, pos4 + 1, pos5 - pos4 - 2))
        
        Cells(X, 28) = rsqh1 & "-" & rsqa1
        Cells(X, 29) = rsqh2 & "-" & rsqa2
        'Cells(x, 242) = rsqh2
        'Cells(x, 243) = rsqa2
        
        
10 Next X
Call PREP
Application.StatusBar = ""
End Sub

Attribute VB_Name = "Modulo4"
Sub cercaclassifiche()
Range("CV1").Select
Application.ScreenUpdating = False

Sheets("DATI").Select

For T = 7 To Cells(1, 2)
If Cells(T, 169) <> "" Then GoTo 10


naz = Cells(T, 3)
lega = Cells(T, 4)

stato = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(stato) > 31 Then stato = Left(stato, 31)

If naz = naz1 And lega = lega1 Then GoTo 20

naz1 = naz
lega1 = lega
 Application.StatusBar = "Ricerca classifiche per: " & naz & "  " & lega

iniziolega = T
finelega = T
For X = T To Cells(1, 2)
If Cells(X, 3) = naz And Cells(X, 4) = lega Then finelega = finelega + 1
Next X
finelega = finelega - 1


' carico pagina

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & ""

'Set http1 = CreateObject("MSXML2.XMLHTTP")
Set http1 = CreateObject("MSXML2.ServerXMLHTTP")
http1.Open "POST", url1, False
http1.send


text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")

' controllo campionato

controllomain = ">Main<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30
controllomain = ">Torneo"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30
controllomain = "Play Off"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30
controllomain = ">Apertura<"
posizmain = InStr(1, text1, controllomain)
If posizmain <> 0 Then GoTo 30

' ricerco link per tabelle
 
        controllo1 = "stats-menu-table li0 first"
        len1 = Len(controllo1)
        controllo2 = ">Standings<"
        posiz1 = InStr(1, text1, controllo1) + len1 + 15
        posiz2 = InStr(posiz1, text1, controllo2)
        linktot = Trim(Mid(text1, posiz1, posiz2 - posiz1))
        linktot1 = Mid(linktot, 1, (InStr(1, linktot, "sub=")) + 3)
        linktot2 = Mid(linktot, Len(linktot1) + 1, Len(linktot) - Len(linktot1))

' carico tabella tot

Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "https://www.betexplorer.com" & linktot1 & "overall" & linktot2 & ""
Range("CT1").Value = url1
'Set http1 = CreateObject("MSXML2.XMLHTTP")
Set http1 = CreateObject("MSXML2.ServerXMLHTTP")
http1.Open "POST", url1, False
http1.send
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")


 k = 1
        
        
        controllo1 = "rank col_rank no"
        len1 = Len(controllo1)
        controllo2 = "title="
        len2 = Len(controllo2)
        controllo3 = ">"
        len3 = Len(controllo3)
        controllo4 = ".</td>"
        controllo5 = ");"
        controllo6 = "</a>"
5        posiz1 = InStr(k, text1, controllo1)
        If posiz1 = 0 Then GoTo 10
        posiz2 = InStr(posiz1, text1, controllo2) + len2
        posiz3 = InStr(posiz2, text1, controllo3)
        
        mot = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        
        posiz4 = InStr(posiz3, text1, controllo4)
        
        class = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        posiz5 = InStr(posiz4, text1, controllo5) + 3
        posiz6 = InStr(posiz5, text1, controllo6)
       
        sq = Trim(Mid(text1, posiz5, posiz6 - posiz5))
       
        For q = iniziolega To finelega
        If Cells(q, 5) = sq Then
        Cells(q, 98) = class
        Cells(q, 99) = mot
        End If
        If Cells(q, 6) = sq Then
        Cells(q, 100) = class
        Cells(q, 101) = mot
        End If
        Next q
        
        k = posiz6
        
        nsq = (Len(text1) - Len(Replace(text1, controllo1, ""))) / Len(controllo1)
       
        For q = iniziolega To finelega
        Cells(q, 102) = nsq
        Next q
        
        GoTo 5


' carico tabella home

10 'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

'url1 = "https://www.betexplorer.com" & linktot1 & "home" & linktot2 & ""
'Set http1 = CreateObject("MSXML2.XMLHTTP")
'Set http1 = CreateObject("MSXML2.ServerXMLHTTP.6.0")
'http1.Open "POST", url1, False
'http1.send
'text1 = http1.responseText
'text1 = Replace(text1, Chr(34), "")


 'k = 1
        
        
        'controllo1 = "rank col_rank no"
        'len1 = Len(controllo1)
        'controllo2 = "title="
        'len2 = Len(controllo2)
        'controllo3 = ">"
        'len3 = Len(controllo3)
        'controllo4 = ".</td>"
        'controllo5 = ";"
        'controllo6 = "</a>"
'15        posiz1 = InStr(k, text1, controllo1)
        'If posiz1 = 0 Then GoTo 20
        'posiz2 = InStr(posiz1, text1, controllo2) + len2
        'posiz3 = InStr(posiz2, text1, controllo3)
        
        'mot = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        
        'posiz4 = InStr(posiz3, text1, controllo4)
        
        'class = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        'posiz5 = InStr(posiz4, text1, controllo5) + 2
        'posiz6 = InStr(posiz5, text1, controllo6)
       
        'sq = Trim(Mid(text1, posiz5, posiz6 - posiz5))
       
        'For q = iniziolega To finelega
        'If Cells(q, 5) = sq Then
        'Cells(q, 103) = class
        'Cells(q, 104) = mot
        'End If
        'If Cells(q, 6) = sq Then
        'Cells(q, 105) = class
        'Cells(q, 106) = mot
        'End If
        'Next q
        
        'k = posiz6
        
        'GoTo 15



20
' carico tabella tot

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

'url1 = "https://www.betexplorer.com" & linktot1 & "away" & linktot2 & ""

'Set http1 = CreateObject("MSXML2.XMLHTTP")
'Set http1 = CreateObject("MSXML2.ServerXMLHTTP.6.0")
'http1.Open "POST", url1, False
'http1.send
'text1 = http1.responseText
'text1 = Replace(text1, Chr(34), "")


 'k = 1
        
        
        'controllo1 = "rank col_rank no"
        'len1 = Len(controllo1)
        'controllo2 = "title="
        'len2 = Len(controllo2)
        'controllo3 = ">"
        'len3 = Len(controllo3)
        'controllo4 = ".</td>"
        'controllo5 = ";"
        'controllo6 = "</a>"
'25        posiz1 = InStr(k, text1, controllo1)
        'If posiz1 = 0 Then GoTo 30
        'posiz2 = InStr(posiz1, text1, controllo2) + len2
        'posiz3 = InStr(posiz2, text1, controllo3)
        
        'mot = Trim(Mid(text1, posiz2, posiz3 - posiz2))
        
        'posiz4 = InStr(posiz3, text1, controllo4)
        
        'class = Trim(Mid(text1, posiz3 + 1, posiz4 - posiz3 - 1))
        
        'posiz5 = InStr(posiz4, text1, controllo5) + 2
        'posiz6 = InStr(posiz5, text1, controllo6)
       
        'sq = Trim(Mid(text1, posiz5, posiz6 - posiz5))
       
        'For q = iniziolega To finelega
        'If Cells(q, 5) = sq Then
        'Cells(q, 107) = class
        'Cells(q, 108) = mot
        'End If
        'If Cells(q, 6) = sq Then
        'Cells(q, 109) = class
        'Cells(q, 110) = mot
        'End If
        'Next q
        
        'k = posiz6
        
        'GoTo 25
30    Next T
       




       


Application.StatusBar = ""


End Sub

Sub aggiornaquote()
Range("CY1").Select

Application.ScreenUpdating = False

Sheets("DATI").Select
Cells(4, 171) = Now()

For T = 7 To Cells(1, 2)

Inc = Sheets("DATI").[B1].Value


Application.StatusBar = "Aggiornamento Quote Incontro " & T - 7 & " di " & Inc - 7

If Cells(T, 169) <> "" Then GoTo 10

sq1 = Cells(T, 5)
sq2 = Cells(T, 6)
naz = Cells(T, 3)
lega = Cells(T, 4)
Shetname = Sheets("Data").Columns(2).Find(naz, LookAt:=xlWhole).Offset(, -1) & " " & _
    Replace(StrConv(Replace(lega, "-", " "), vbProperCase), " ", "")
If Len(Shetname) > 31 Then Shetname = Left(Shetname, 31)

If naz = naz1 And lega = lega1 Then GoTo 5

naz1 = naz
lega1 = lega

' carico pagina con fixtures

'Shell "RunDll32.exe Inetcpl.cpl, ClearMyTracksByProcess 8"

url1 = "https://www.betexplorer.com/soccer/" & naz & "/" & lega & "/fixtures/"

Set http1 = CreateObject("MSXML2.XMLHTTP")
http1.Open "POST", url1, False
http1.send
text1 = http1.responseText
text1 = Replace(text1, Chr(34), "")
Set http1 = Nothing

5 posiz6 = 1
 
 
        controllo1 = "<span>" & sq1 & "</span> - <span>" & sq2 & "</span>"
        posiz1 = InStr(posiz6, text1, controllo1)
        
        If posiz1 = 0 Then GoTo 10
        
        controllo5 = "data-odd="
        len5 = Len(controllo5)
        controllo6 = "></a></td>"
        
        posiz5 = InStr(posiz1, text1, controllo5) + len5
        If posiz5 = 9 Then End
        posiz6 = InStr(posiz5, text1, controllo6)
        quota1 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, text1, controllo5) + len5
        posiz6 = InStr(posiz5, text1, controllo6)
        quotax = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
       
        posiz5 = InStr(posiz6, text1, controllo5) + len5
        posiz6 = InStr(posiz5, text1, controllo6)
        quota2 = (Trim(Mid(text1, posiz5, posiz6 - posiz5)) + 1 - 1) / 100
        
       Cells(T, 103) = quota1
       Cells(T, 104) = quotax
       Cells(T, 105) = quota2

       
       
       
       
10 Next T

Application.StatusBar = ""



End Sub

Attribute VB_Name = "Modulo5"
Sub PREP()
Dim lastRow As Long
Application.ScreenUpdating = False
Sheets("DATI").Activate
    Range("K7:K1000").ClearContents
    Range("T7:T1000").ClearContents

   



With ActiveSheet
    lastRow = Range("A" & Rows.Count).End(xlUp).Row
    Range("K7:K" & lastRow).FormulaR1C1 = "=IFERROR(IF(COUNTIF(RC[1],""U"")+COUNTIF(RC[2],""U"")+COUNTIF(RC[3],""U"")>=3,"""",IF(COUNTIF(RC[4],""U"")+COUNTIF(RC[5],""U"")+COUNTIF(RC[6],""U"")>=3,"""",IF(OR(RC[1]=""U"",RC[4]=""U""),""Bet"",""""))),"""")"
    Range("T7:T" & lastRow).FormulaR1C1 = "=IFERROR(IF(COUNTIF(RC[1],""O"")+COUNTIF(RC[2],""O"")+COUNTIF(RC[3],""O"")>=3,"""",IF(COUNTIF(RC[4],""O"")+COUNTIF(RC[5],""O"")+COUNTIF(RC[6],""O"")>=3,"""",IF(OR(RC[1]=""O"",RC[4]=""O""),""Bet"",""""))),"""")"
    Range("R7:R" & lastRow).FormulaR1C1 = "=IFERROR(IF(IF(RC[12]="""","""",IF(AND(RC[-7]=""""),"""",MID(RC[12],1,FIND(""-"",RC[12])-1)*1))+(RIGHT(RC[12])*1)>=2,""Win"",""Lose""),"""")"
    Range("AA7:AA" & lastRow).FormulaR1C1 = "=IFERROR(IF(IF(RC[3]="""","""",IF(AND(RC[-7]=""""),"""",MID(RC[3],1,FIND(""-"",RC[3])-1)*1))+(RIGHT(RC[3])*1)<4,""Win"",""Lose""),"""")"


End With
With Range("K7:K" & lastRow)
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
       Application.CutCopyMode = False

End With
With Range("T7:T" & lastRow)
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
      Application.CutCopyMode = False

End With

With Range("R7:R" & lastRow)
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
        Application.CutCopyMode = False

End With
With Range("AC7:AC" & lastRow)
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
        Application.CutCopyMode = False

End With

Application.CutCopyMode = False
    Range("A1").Select
Application.ScreenUpdating = True
'MsgBox " COMPLETATO !!"
End Sub

Sub ResetFiltri()
If ActiveSheet.FilterMode = True Then ActiveSheet.ShowAllData
End Sub


Attribute VB_Name = "Modulo6"
Sub Archivia()
Sheets("DATI").Select
Application.ScreenUpdating = False
Range("A6:S1006").Select
Selection.AutoFilter
Sheets("DATI").Select
Selection.AutoFilter Field:=19, Criteria1:="<>"
urfrom = Range("A" & Rows.Count).End(xlUp).Row
urto = Sheets("Archivio").Range("A" & Rows.Count).End(xlUp).Row + 1
Range("A7:S" & urfrom).SpecialCells(xlCellTypeVisible).Copy _
Destination:=Sheets("Archivio").Range("A" & urto)
Sheets("DATI").Select
Range("A6:V1006").Select
Selection.AutoFilter Field:=19
MsgBox " OK!...Fatto "
Range("A1").Select
End Sub
Attribute VB_Name = "Modulo7"
Attribute VB_Name = "Modulo8"
Sub Call1()
Application.ScreenUpdating = False

Sheets("QT_OV_UN").Activate '<<< Il foglio su cui si fara' l'importazione
Range("A:G").ClearContents 'NB: Il fofglio SARA' AZZERATO senza preavviso
Range("A:X").NumberFormat = "0.00" 'Colonne in formato Testo
Call GetTabbbSubOptAll(Range("Z1").Value) ' "Chiama" la GetTabbbSub
End Sub
Sub GetTabbbSubOptAll(ByVal myURL As String)
'Va Chiamata passandogli l'URL da leggere
'Variante 2 per betexplorer.com
Dim IE As Object, I As Long
Set IE = CreateObject("InternetExplorer.Application")
'
Debug.Print ">>>", myURL
'Range("a1").Value = myURL

With IE
    .navigate myURL
    .Visible = False
'Stop                                  'Vedi TESTO
End With
Call IEReady(IE, 1)
'
'Cerca i Select 1|fffd| e 2|fffd| Class=wrap-header__list__item semilong:
Dim myItm As Object, myColl As Object, mmColl As Object, ccColl As Object
For I = 0 To 1
    On Error Resume Next
        Set myColl = IE.document.getElementsByClassName("wrap-header__list__item semilong")
        Set myItm = myColl(I)
        Set mmColl = myItm.getElementsByTagName("option")
        Set ccColl = myItm.getElementsByTagName("select")
    On Error GoTo 0
    If myColl.Length = 2 Then
        Debug.Print "A", mmColl.Length
        ccColl(0).selectedIndex = mmColl.Length - 1
        Debug.Print "B", ccColl(0).selectedIndex
        ccColl(0).FireEvent "onchange"
'        Call IEReady(IE, 3)
    End If
Next I
'Scrive le tabelle SUL FOGLIO ATTIVO
Set myColl = IE.document.getElementsByTagName("TABLE")

For Each myItm In myColl
''Se vuoi importare una sola tabella, allora nel codice della Sub GetTabbbSubOptAll sostituisci la riga For Each myItm In myColl con
'
'Codice: Seleziona tutto
'    Set myItm = myColl(0)         '0=tab #1; 1 = tab #2, etc
'Contemporaneamente elimina la riga Next myItm

'Set myItm = myColl(2)         '0=tab #1; 1 = tab #2, etc
    Cells(I + 1, 1) = "Table " & ti + 1
    ti = ti + 1: I = I + 1
    For Each trtr In myItm.Rows
        For Each tDtD In trtr.Cells

                Cells(I + 1, j + 1) = tDtD.innerText

                j = j + 1
                 If I > 145 Then GoTo 1000

        Next tDtD
        'Allinea al centro se e' una Intestazione:
        If trtr.className = "js-tournament" Then
            Cells(I + 1, 1).HorizontalAlignment = xlCenter
        End If
        I = I + 1: j = 0
DoEvents
    Next trtr
   
I = I + 1

Next myItm
Set myColl = IE.document.getElementsByTagName("TABLE")

'Chiusura IE

1000:
On Error Resume Next
    objIE.Quit
    Set objIE = Nothing
''

IE.Quit
Set IE = Nothing
'Application.Calculation = xlCalculationAutomatic

End Sub

Sub IEReady(ByRef myIE As Object, myStab As Single)
Dim myLStart As Single
With myIE
    Do While .Busy: DoEvents: Loop    'Attesa not busy
    Do While .readyState <> 4: DoEvents: Loop 'Attesa documento
End With
myLStart = Timer  'attesa addizionale
Do
    DoEvents
    If Timer > (myLStart + myStab) Or Timer < myLStart Then Exit Do
Loop
End Sub

Attribute VB_Name = "Modulo9"
Sub IMPORTAQUOTE()
Dim RIG, X
    Sheets("DATI").Range("J7:J1000").ClearContents
    Sheets("DATI").Range("S7:S1000").ClearContents
    
    Range("J7").Select

UR1 = Sheets("Link").Range("D" & Rows.Count).End(xlUp).Row

Application.ScreenUpdating = False
For X = 4 To Sheets("Link").Range("D" & Rows.Count).End(xlUp).Row

Application.StatusBar = "ELABORAZIONE " & X - 3 & "  " & "DI" & "  " & UR1 - 3 & "  " & "PARTITE"

Sheets("QT_OV_UN").Range("Z1").Value = Sheets("Link").Cells(X, 9)
'Call Call1
Call Call1UN
Sheets("Link").Cells(X, 10) = Sheets("QT_OV_UN").Range("Q4").Value
Sheets("Link").Cells(X, 11) = Sheets("QT_OV_UN").Range("S4").Value

Next X
Application.ScreenUpdating = False
Sheets("DATI").Activate
With ActiveSheet
    lastRow = Range("A" & Rows.Count).End(xlUp).Row
    Range("J7:J" & lastRow).FormulaR1C1 = "=IFERROR(IF(RC[-5]="""","""",VLOOKUP(RC[-5]&RC[-4],Link!R4C3:R500C11,8,FALSE)),"""")"
    Range("S7:S" & lastRow).FormulaR1C1 = "=IFERROR(IF(RC[-14]="""","""",VLOOKUP(RC[-14]&RC[-13],Link!R4C3:R500C11,9,FALSE)),"""")"
End With

With Range("J7:J" & lastRow)
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
        Application.CutCopyMode = False
End With

With Range("S7:S" & lastRow)
        .Cells.Copy
        .Cells.PasteSpecial xlPasteValues
        .Cells(1, 1).Select
        Application.CutCopyMode = False
End With

Application.CutCopyMode = False
Application.StatusBar = ""
Sheets("DATI").Activate
'Application.ScreenUpdating = True

End Sub
Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Attribute VB_Name = "sheet1"
Attribute VB_Base = "0{00020820-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True


INQUEST-PP=macro
