Attribute VB_Name = "AAdvoware"
Public global_bDoNotClose As Boolean
Sub main()
End Sub
 

Attribute VB_Name = "Advotime"
Option Explicit

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main()
Dim Application$

If WordBasic.CountWindows() Then
    If WordBasic.DocumentProtection() <> 0 Then
        WordBasic.ToolsUnprotectDocument
    End If

    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0"
    Load frmSchliessen
    If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0" Then
        frmSchliessen.Show
    Else
        Unload frmSchliessen
    End If
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
End If

If GetDatabase = "ADVOWARE" Then
    Application$ = "Advoware Zeithonorar  -"
Else
    Application$ = "Advoware Zeithonorar (" + GetDatabase + ")"
End If

If AnwendungErmitteln(Application$) Then
    AnwendungAktivieren (Application$)
Else
    If Shell(GetProgramdir$() + "\Advotime.exe", 1) = 0 Then
        WordBasic.MsgBox "Keine Verbindung zu Advotime!", GetApplicationName()
    End If
End If

End Sub

Attribute VB_Name = "Advoware"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private Declare Function GetWindowText Lib "User32" Alias "GetWindowTextA" (ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long) As Long
Private Declare Function GetDesktopWindow Lib "user32.dll" () As Long
Private Declare Function FindWindowEx Lib "User32" Alias "FindWindowExA" (ByVal hWnd1 As Long, _
ByVal hWnd2 As Long, ByVal lpsz1 As String, ByVal lpsz2 As String) As Long
Private Declare Function BringWindowToTop Lib "User32" (ByVal hWnd As Long) As Long

Public Sub DeleteAktuellesDocumentActiveDoc()
    Set AktuellesDocument.ActiveDoc = Nothing
End Sub

Sub main()
global_bDoNotClose = False

'Set AktuellesDocument.ActiveDoc = Nothing 'Damit ActiveDoc_Close nicht aufgerufen wird, wenn das Makro das Dokument schliesst

Advoware.main2

global_bDoNotClose = False

End Sub

Public Sub main2()
Dim nRet As Long
If WordBasic.CountWindows() Then
    Selection.Collapse ' Markierung aufheben
    If WordBasic.DocumentProtection() <> 0 Then
        WordBasic.ToolsUnprotectDocument
    End If

    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0"
    
    Load frmSchliessen
    
    If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0" Then
        If GetDocVar("history") = "nein" Or GetDocVar("muster") = "ja" Then
            global_bDoNotClose = True
            If Documents.count > 0 Then 'Sicherheitsma|fffd|nahme, falls Dokument schon aus Advoware geschlossen wurde
                If GetDocVar("muster") = "ja" Then
                    If ActiveDocument.Saved = False Then
                        nRet = MsgBox("M|fffd|chten Sie die |fffd|nderungen speichern?", vbExclamation + vbYesNoCancel)
                        If nRet = vbYes Then
                            ActiveDocument.Close True
            
                        ElseIf nRet = vbNo Then
                            ActiveDocument.Close False
                        ElseIf nRet = vbCancel Then
                            'Exit Sub
                        End If
                    Else
                        ActiveDocument.Close False
                    End If
                Else
                    On Error Resume Next
                    ActiveDocument.Close False
                    On Error GoTo 0
                End If
            End If
             
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
            Unload frmSchliessen
        Else
            frmSchliessen.Show
            Exit Sub
        End If
    Else
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
        Unload frmSchliessen
    End If
End If

GotoAdvoware
End Sub

Public Sub GotoAdvoware()

Dim Database$
Dim App$
Dim Appvoice$

SetDatabaseReg
Database$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "Database")

App$ = GetApplicationName()

If StrConv(Database$, vbUpperCase) = "ADVOWARE" Then
    App$ = App$ + "  -"
Else
    App$ = App$ + " (" & Database & ")"
End If

Appvoice$ = "Advovoice"

If AnwendungErmitteln(App$) Then
    AnwendungAktivieren (App$)
Else
    If AnwendungErmitteln(Appvoice$) Then
        AnwendungAktivieren (Appvoice$)
    Else
        If Shell(GetProgramdir$() + "\Advoware.exe", 1) = 0 Then
            WordBasic.MsgBox "Keine Verbindung zu " + GetApplicationName(), GetApplicationName()
        End If
    End If
End If

End Sub

Public Sub AkteWechseln()
    Dim nr$
    Dim ret$
    Dim Jahr$
    Dim Anr$
    Dim App$
    Dim X As Integer
    Dim a As CommandBarControl
    Dim aTemp As Template
    Dim xxxxx
    On Error GoTo Ende
    
    For Each a In CommandBars("Advo-ware").Controls
    
    If a.Caption = "Akte suchen" Then
        If a.text <> "" Then
            If InStr(1, a.text, "/") <> 0 Then
                nr$ = Left(a.text, InStr(1, a.text, "/") - 1)
                Jahr$ = Mid(a.text, InStr(1, a.text, "/") + 1)
                If CInt2(Jahr) < 50 Then
                    nr$ = CInt2(Jahr + 2000) * 1000000 + CLng(nr)
                Else
                    nr$ = CInt2(Jahr + 1900) * 1000000 + CLng(nr)
                End If
            Else
                Jahr$ = CStr(Year(Date))
                nr$ = CInt2(Jahr) * 1000000 + CLng(a.text)

            End If
             
            X = WordExecute("select nr from akten where nr = " & nr$ & " ")
            
            If X <> 0 Then
                MsgBox ("Wordexecute-Fehler" & CStr(X))
            Else
                ret$ = String(255, " ")
                ret$ = Left(WordRequest(ret$), laenge)
                WordExecute ("commit")

                If ret$ = nr$ Then
                    App$ = GetApplicationName()
                    
                    If AnwendungErmitteln(App$) Then
                        WordBasic.AppSendMessage App$, 16384 + 3, CLng(ret$), 101
                    End If
                    
                    SetAnr (nr$)
                    SymbolleisteAktualisieren.main
                Else
                    MsgBox ("Akte nicht vorhanden.")
                End If
            End If
        End If
    End If
    
    Next
Ende:
    WordExecute ("commit")
    If Err.Number <> 0 Then MsgBox "Akte nicht gefunden."
    
    For Each aTemp In Templates
        If LCase(aTemp.Name) = "advoware.dot" Or LCase(aTemp.Name) = "advoware.dotm" Then
            aTemp.Saved = True
        End If
    Next aTemp
    
End Sub
Public Function AnwendungAktivieren$(App$)
Dim hWnd As Long
Dim parent As Long
Dim sStr As String * 1024
parent = GetDesktopWindow()
'hwnd = FindWindow("Gupta:MDIFrame", vbNullString) 'PARENT WINDOW

hWnd = FindWindowEx(parent, hWnd, "Gupta:MDIFrame", vbNullString) 'PARENT WINDOW

While hWnd <> 0
    GetWindowText hWnd, sStr, 1023
    sStr = UCase(sStr)
    App$ = UCase(App$)
    If InStr(1, sStr, App$) > 0 Then
        BringWindowToTop (hWnd)
        AnwendungAktivieren$ = 1
        Exit Function
    ElseIf App$ = "Advovoice" Then
        If InStr(1, sStr, "Advoware") > 0 And InStr(1, sStr, "% -") > 0 Then
            BringWindowToTop (hWnd)
            AnwendungAktivieren$ = 1
            Exit Function
        End If
    End If
    
    hWnd = FindWindowEx(parent, hWnd, "Gupta:MDIFrame", vbNullString) 'PARENT WINDOW
Wend

AnwendungAktivieren$ = 0
End Function

Public Function AnwendungAktivierenFrame$(App$)
Dim hWnd As Long
Dim parent As Long
Dim sStr As String * 1024
parent = GetDesktopWindow()

hWnd = FindWindowEx(parent, hWnd, "Gupta:AccFrame", vbNullString) 'PARENT WINDOW

While hWnd <> 0
    GetWindowText hWnd, sStr, 1023
    sStr = UCase(sStr)
    App$ = UCase(App$)
    If InStr(1, sStr, App$) > 0 Then
        BringWindowToTop (hWnd)
        AnwendungAktivierenFrame$ = 1
        Exit Function
    End If
    
    hWnd = FindWindowEx(parent, hWnd, "Gupta:MDIFrame", vbNullString) 'PARENT WINDOW
Wend

AnwendungAktivierenFrame$ = 0
End Function


Public Function AnwendungErmitteln(App$) As Long

Dim hWnd As Long
Dim parent As Long
Dim sStr As String * 1024
parent = GetDesktopWindow()

hWnd = FindWindowEx(parent, hWnd, "Gupta:MDIFrame", vbNullString) 'PARENT WINDOW

While hWnd <> 0
    GetWindowText hWnd, sStr, 1023
    sStr = UCase(sStr)
    App$ = UCase(App$)
    If InStr(1, sStr, App$) > 0 Then
        AnwendungErmitteln = 1
        Exit Function
    ElseIf App$ = "Advovoice" Then
        If InStr(1, sStr, "ADVOWARE") > 0 And InStr(1, sStr, "% -") > 0 Then
            AnwendungErmitteln = 1
            Exit Function
        End If
    End If
    
    hWnd = FindWindowEx(parent, hWnd, "Gupta:MDIFrame", vbNullString) 'PARENT WINDOW
Wend

AnwendungErmitteln = 0
End Function

Sub SetActiveDoc()
    On Error GoTo Ende
    If Documents.count > 0 Then
        If ActiveDocument.Type = wdTypeDocument Then
            If GetDocVar("DATABASE") <> "" And GetDocVar("muster") <> "ja" Then
                Set AktuellesDocument.ActiveDoc = ActiveDocument
                StatusBar = "Nr: " & GetDocVar("nr") + " - Datenbank: " & GetDocVar("DATABASE")
            End If
        End If
    End If
Ende:
End Sub


Attribute VB_Name = "Aktenaufkleber"
Option Explicit

Public Sub main()

Dim ret$
Dim quelle$
Dim hauptdokument$
Dim sDokumentname$

ret$ = String(255, " ")
On Error GoTo -1: On Error GoTo Ende

quelle$ = GetProgramdir$() + "\Temp\Aktenaufkleber.doc"
hauptdokument$ = GetProgramdir$() + "\Dot\Aktenaufkleber.doc"

Documents.Open FileName:=hauptdokument$

If ActiveWindow.View.SplitSpecial = wdPaneNone Then
    ActiveWindow.ActivePane.View.Type = wdPrintView
Else
    ActiveWindow.View.Type = wdPrintView
End If
 
sDokumentname$ = ActiveDocument.Fullname
ActiveDocument.MailMerge.OpenDataSource Name:=quelle$
ActiveWindow.View.ShowFieldCodes = False
With ActiveDocument.MailMerge
.Destination = wdSendToNewDocument
.SuppressBlankLines = True
With .DataSource
    .FirstRecord = wdDefaultFirstRecord
    .LastRecord = wdDefaultLastRecord
End With

.Execute Pause:=False
End With

Documents(sDokumentname$).Close (False)

Ende:

If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Attribute VB_Name = "AktiveAnwendungen"
Option Explicit
Public Sub main()

Dim i
Dim zgr|fffd||fffd|e

zgr|fffd||fffd|e = WordBasic.AppCount() - 1
ReDim f__$(zgr|fffd||fffd|e)
WordBasic.AppGetNames f__$()
For i = 0 To zgr|fffd||fffd|e
    WordBasic.Insert f__$(i)

    If f__$(i) = "DDE Server Window" Or Left$(f__$(i), 12) = "OleRpcNotify" Or f__$(i) = "OleMainThreadWndName" Or f__$(i) = "Spooler Process" Or f__$(i) = "File Open Message Window" Then
        WordBasic.AppClose f__$(i)
    End If

    Selection.TypeParagraph
Next
End Sub
Attribute VB_Name = "AnsichtLayoutAdvoware"
Public Sub main()
Attribute main.VB_Description = "Ersetzen aller Platzhalter durch Daten aus der aktuellen Akte"
Attribute main.VB_ProcData.VB_Invoke_Func = "TemplateProject.Austauschen.MAIN"

    If WordBasic.CountWindows() Then
        If WordBasic.DocumentProtection() = 0 Then
            ActiveWindow.View.ShowFieldCodes = False
        End If
    
        Application.ScreenRefresh
        Application.ScreenUpdating = True
        Selection.HomeKey Unit:=wdStory
        Selection.EndKey Unit:=wdStory
    End If
Ende:

End Sub
Attribute VB_Name = "ApiAufrufen"

Sub mainSpeichern()
Dim Box As New clsDialogSpeichern
Dim Datei$
Dim Hilf$

On Error GoTo Ende

If Documents.count = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet"
Else
    Datei$ = Box.DialogDateinameDateil|fffd|ngeFestlegen
    
    If Datei <> "" Then
        Hilf$ = Dir(Datei)
        
        If Hilf <> "" And Hilf <> "." And Hilf <> ".." Then
            If MsgBox("Soll die vorhandene Datei |fffd|berschrieben werden ?", vbYesNo) = vbNo Then Exit Sub
        End If
        
        If InStr(Datei$, ".") = 0 Then Datei$ = Datei & ".dat"
        ActiveDocument.SaveAs Datei$
    End If
End If
Exit Sub

Ende:
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Attribute VB_Name = "Austauschen"

Option Explicit

Private Declare Function PostMessage Lib "User32" Alias "PostMessageA" _
  (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, _
   lParam As Any) As Long
Private Declare Function GetDesktopWindow Lib "User32" () As Long
Private Declare Function GetWindow Lib "User32" _
  (ByVal hWnd As Long, ByVal wCmd As Long) As Long
Private Declare Function GetWindowText Lib "User32" Alias "GetWindowTextA" _
  (ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long) As Long

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function WordRequestLongVarChar Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function WordRequestLongVarCharToFile Lib "Advolink.dll" (ByVal ret$) As Long
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

Private Const GW_CHILD = 5
Private Const GW_HWNDNEXT = 2
Dim GloabalFontSize

Sub main()
Dim oShape As Shape

mainMain (0)
If ActiveWindow.ActivePane.View.SeekView = wdSeekMainDocument Then
    For Each oShape In ActiveDocument.Shapes    ' In allen Textfeldern Platzhalter austauschen
        If Left(oShape.Name, 4) = "Text" Then
            oShape.Select
            ActiveDocument.Select
            Selection.MoveLeft Unit:=wdCharacter, count:=1
            mainMain (1)
      End If
    Next
End If
End Sub

Public Sub mainMain(p_nArt)
Dim ret$
Dim Anr$
Dim s1$, s2
Dim standort$
Dim Anschrift$
Dim Index$
Dim X
Dim Y
Dim Datei$
Dim Feld$, Name$, FeldZusatz
Dim kz$
Dim rang$
Dim bet$
Dim erg$
Dim Sb$
Dim Titel$
Dim pos
Dim count_
Dim lfd$
Dim abfrage$
Dim abfrageA$
Dim kuerzel$
Dim benutzername$
Dim konto$
Dim fkonto$
Dim Betart$
Dim abfr_bet$
Dim f As Field
Dim forderungskonto$, strim$
Dim Knr$, Frnr, Hnr, nKz, nMaster, Status
Dim pos1$
Dim pos2$
Dim pos3$
Dim pos4$
Dim pos5$
Dim pos6$
Dim Bez$
Dim barcode$
Dim poolkuerzel$
Dim aVar As Variable
Dim bm As Bookmark
Dim freiertext$
Dim Unterschriftendatei$
Dim betName(100) As String, n1 As Long, n2 As Long
Dim betKomm(100) As String
Dim textKomm(5) As String
Dim betANr(100) As Integer
Dim v1 As Variant
Dim k1 As Variant
Dim k2 As Variant
Dim betnr$
Dim Betrag As Double
Dim Betrag2 As Double
Dim sBarcodenr$
Dim nAuswahlNichtL|fffd|schen As Long
'On Error GoTo Ende

If WordBasic.CountWindows() = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!", vbExclamation, GetApplicationName()
Else
    SetDatabaseReg
    ret$ = String(255, " ")
    Application.ScreenUpdating = False
    If p_nArt = 0 Then
        WordBasic.EditBookmark Name:="temp", Add:=1
        Selection.HomeKey Unit:=wdStory
    End If
    Anr$ = GetAnr(1)
    If Anr$ = "" Then
        Anr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Anr")
    End If
    lfd$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd")
    betnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")
    fkonto$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Fkonto")
    standort$ = GetStandort()
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "AufrufMandant") = "0"
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "AufrufGegner") = "0"

    If WordBasic.CountWindows() Then
        If WordBasic.DocumentProtection() = 0 Then
            ActiveWindow.View.ShowFieldCodes = True
        End If
    End If
    
   While WordBasic.NextField()
        Index$ = ""
        nAuswahlNichtL|fffd|schen = 0 ' 29.11.2016 (mp):wg. Bug in MS Word. Manchmal wird der Text gel|fffd|scht, weil der Text scheinbar noch markiert ist.
        ret$ = String(255, " ")
        X = InStr(Selection.text, "|fffd|")
        GloabalFontSize = Selection.Font.Size
        If InStr(1, Selection.text, "GegnerRubrumVoll") Then
            Selection.text = "|fffd|gegnerundvertreter|fffd|"
        End If
        If InStr(1, Selection.text, "MandantRubrumVoll") Then
            Selection.text = "|fffd|mandantenundvertreter|fffd|"
        End If
        If X > 0 Then
            Y = InStr(X + 1, Selection.text, "|fffd|")
            Datei$ = Mid(Selection.text, X + 1, Y - X - 1)
            Datei$ = StrConv(Datei$, vbLowerCase)
            If fKeineforderungsaufstellung(Datei$) Then
                GoTo EndWhile
            End If
            X = Y
            Y = InStr(X + 1, Selection.text, "|fffd|")
            Feld$ = UCase(Mid(Selection.text, X + 1, Y - X - 1))
            FeldZusatz = Mid(Selection.text, X + 1, Y - X - 1)
            Bez$ = Left(Datei$, 4)
              
            If Bez$ <> "ref_" Then
                Select Case Datei$
                    Case "notariat", "notariatchk", "buchungen", "forderungen", "krsum", "faufstatus", "fauf", "sozialr", "akten", "arbrecht", "famrecht", "unfall", "system", "konten", "mitarbeiter", "mietrecht", "standorte", "pfade"
                        X = Y
                        Y = InStr(X + 1, Selection.text, "|fffd|")
                        Index$ = Mid(Selection.text, X + 1, Y - X - 1)
                    
                    Case "referate", "takt", "massnahmen", "var", "terminzettel", "barcode", "takt2", "takt3", "takt4", "fristenzettel"
                        'do nothing
                    Case "grundbuch", "urkunden"
                        X = Y
                        Y = InStr(X + 1, Selection.text, "|fffd|")
                        kz$ = Mid(Selection.text, X + 1, Y - X - 1)
                        X = Y
                        Y = InStr(X + 1, Selection.text, "|fffd|")
                        If Y > 0 Then
                            rang$ = Mid(Selection.text, X + 1, Y - X - 1)
                            X = Y
                            Y = InStr(X + 1, Selection.text, "|fffd|")
                            bet$ = Mid(Selection.text, X + 1, Y - X - 1)
                        End If
                    Case Else
                        X = Y
                        Y = InStr(X + 1, Selection.text, "|fffd|")
                        kz$ = Mid(Selection.text, X + 1, Y - X - 1)
                        X = Y
                        Y = InStr(X + 1, Selection.text, "|fffd|")
                        rang$ = Mid(Selection.text, X + 1, Y - X - 1)
                        
                        If rang$ = "" Or rang$ = "0" Then
                            rang$ = "1"
                        End If
                        X = Y
                        Y = InStr(X + 1, Selection.text, "|fffd|")
                        bet$ = Mid(Selection.text, X + 1, Y - X - 1)
                        X = Y
                        Y = InStr(X + 2, Selection.text, " ")
                        If X + 3 < Y - X - 3 Then
                            Name$ = Mid(Selection.text, X + 3, Y - X - 3)
                        End If
                        Y = InStr(X, Selection.text, FeldZusatz)
                        If Y > 0 Then
                            X = Y + Len(FeldZusatz)
                            Y = InStr(X, Selection.text, "|fffd|")
                            FeldZusatz = Mid(Selection.text, X, Y - X)
                        Else
                            FeldZusatz = ""
                        End If

                End Select
            Else
                X = Y
                Y = InStr(X + 1, Selection.text, "|fffd|")
                Index$ = Mid(Selection.text, X + 1, Y - X - 1)
                X = Y
                Y = InStr(X + 1, Selection.text, "|fffd|")
                bet$ = Mid(Selection.text, X + 1, Len(Selection.text) - X - 1)
            End If
            
            erg$ = ""
            
            If Bez$ = "ref_" Then
                abfrage = "select " & Feld$ & " from " & Datei$ & " where nr=" & Anr
                X = WordExecute(abfrage)
                erg$ = String(255, " ")
                erg$ = Left(WordRequest(erg$), laenge)
            Else
                If Datei$ = "barcode" Then
                        X = WordExecute("select text1 FROM system where art = 'barcode'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        barcode$ = Left$(WordRequest(ret$), laenge)
                        If Left(lfd$, 1) = "-" And Anr <> "" Then
                            X = WordExecute("select lfd from betakt where nr=" & Anr & " and -betnr=" & lfd$)
                            ret$ = String(254, " ")
                            ret$ = Left$(WordRequest(ret$), laenge)
                            If ret$ <> "" Then
                                lfd$ = ret$
                            End If
                        End If
                        If IstAlternative = 0 Then
                            Selection.Font.ColorIndex = wdAuto
                        End If
                        
                        Selection.Font.Name = barcode$
                        sBarcodenr$ = GetBarcodeNr
                        If sBarcodenr$ = "" Then
                            erg$ = "*" + Anr$ + lfd$ + "*"
                        Else
                            SetDocVar "barcodenr", sBarcodenr$
                            erg$ = "*" & Anr$ & lfd$ & "H" & sBarcodenr$ & "*"
                        End If
               
                ElseIf Datei$ = "akten" Then
                    If Feld$ = "SB1" Then
                        X = WordExecute("select sb FROM akten where nr = " + Anr$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        Sb$ = Left$(WordRequest(ret$), laenge)
            
                        X = WordExecute("select name FROM mitarbeiter where kuerzel = '" + Sb$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                    ElseIf Feld$ = "SBSIGNATUR1" Then
                        benutzername$ = "SELECT sb FROM akten a WHERE  a.nr =" + Anr$
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        Sb$ = Left$(WordRequest(ret$), laenge)
                        benutzername$ = "SELECT signatur1 FROM mitarbeiter WHERE kuerzel = '" + Sb$ + "'"
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        ret$ = String(255, " ")
                        erg$ = WordRequest(ret$)
                        ret$ = String(2001, " ")
                        erg$ = WordRequestLongVarChar(ret$)
                        pos1$ = InStr(erg$, Chr$(0))
                        If pos1$ < 1 Then pos1$ = 1
                        erg$ = Left(erg$, pos1$ - 1)
                    ElseIf Feld$ = "SBSIGNATUR2" Then
                        benutzername$ = "SELECT sb FROM akten a WHERE  a.nr =" + Anr$
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        Sb$ = Left$(WordRequest(ret$), laenge)
                        benutzername$ = "SELECT signatur2 FROM mitarbeiter WHERE kuerzel = '" + Sb$ + "'"
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        ret$ = String(255, " ")
                        erg$ = WordRequest(ret$)
                        ret$ = String(2001, " ")
                        erg$ = WordRequestLongVarChar(ret$)
                        pos1$ = InStr(erg$, Chr$(0))
                        If pos1$ < 1 Then pos1$ = 1
                        erg$ = Left(erg$, pos1$ - 1)
                    ElseIf Feld$ = "STANDORT" Then
                        abfrage$ = "SELECT @trim(s.anrede||' '||s.name)||@char(13)||@char(10)||s.strasse||@char(13)||@char(10)||@trim(s.plz||' '||s.ort) FROM akten a,standorte s WHERE s.kuerzel=a.standortkuerzel and nr = " + Anr$
                        X = WordExecute(abfrage$)
                        If X = 0 Then
                            erg$ = Left$(WordRequest(ret$), laenge)
                        End If
                    ElseIf Feld$ = "TITEL" Then
                        X = WordExecute("SELECT titel FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
        
                        If X = 0 Then
                            erg$ = Left$(WordRequest(ret$), laenge)
                        End If
        
                        If erg$ = "" Then
                            Titel$ = "Rechtsanwalt"
                        End If
                    ElseIf Feld$ = "VV" Then
                        X = WordExecute("SELECT count(nr) FROM  honorarvb WHERE anr = " + Anr$)
                        pos4$ = Left$(WordRequest(ret$), laenge)
                        If pos4$ > 0 Then
                            pos5$ = 0
                            X = WordExecute("SELECT @trim(rechtsform || ' ' ||vorname|| ' ' ||name) || ' - ' ||text FROM beteiligte b,honorarvb h WHERE h.betnr=b.betnr and anr = " + Anr$ + " order by h.nr ")
                            While pos5$ < pos4$
                                erg = erg + Left$(WordRequest(ret$), laenge) + Chr(13) + Chr(10)
                                pos5$ = pos5$ + 1
                            Wend
                        End If
        
                    ElseIf Feld$ = "KOMMUNIKATION" Or Feld$ = "KOMMUNIKATIONTEL" Then
                        textKomm(1) = "Telefon: "
                        textKomm(2) = "Fax: "
                        textKomm(3) = "E_Mail: "
                        textKomm(4) = "Internet: "
                        If Feld$ = "KOMMUNIKATIONTEL" Then
                            pos6$ = 1
                        Else
                            pos6$ = 4
                        End If
                        X = WordExecute("SELECT count(betnr) FROM betakt WHERE nr = " + Anr$)
                        pos4$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("SELECT ebene FROM betakt WHERE nr = " + Anr$ + " order by lfd ")
                        pos5$ = 0
                        While pos5$ < pos4$
                            pos3$ = Left$(WordRequest(ret$), laenge)
                            pos2$ = 1
                            While pos2$ < pos3$
                                betName(pos5$) = betName(pos5$) + "      "
                                pos2$ = pos2$ + 1
                            Wend
                            pos5$ = pos5$ + 1
                        Wend
                        X = WordExecute("SELECT betnr FROM betakt WHERE nr = " + Anr$ + " order by lfd ")
                        pos5$ = 0
                        While pos5$ < pos4$
                            betANr(pos5$) = Left$(WordRequest(ret$), laenge)
                            pos5$ = pos5$ + 1
                        Wend
                        X = WordExecute("SELECT art || ': ' ||rechtsform || ' ' || t.name FROM betakt t, beteiligte b WHERE b.betnr=t.betnr and nr = " + Anr$ + " order by lfd ")
                        pos5$ = 0
                        While pos5$ < pos4$
                            betName(pos5$) = betName(pos5$) + Left$(WordRequest(ret$), laenge)
                            pos5$ = pos5$ + 1
                        Wend
                        pos5$ = 0
                        While pos5$ < pos4$
                            pos1$ = 0
                            While pos1$ <= pos6$
                                X = WordExecute("SELECT count(betnr) FROM kommunikation WHERE betnr = " + Str(betANr(pos5$)) + " and komm_art = " + pos1$)
                                pos3$ = Left$(WordRequest(ret$), laenge)
                                If pos3$ > 0 Then
'                                    X = WordExecute("SELECT text || ' ' || tlf FROM kommunikation k, verbindungsart v WHERE k.betnr = " + Str(betANr(pos5$)) + " and k.komm_art = " + pos1$ + " and k.komm_kz=v.kz order by komm_kz ")
                                    X = WordExecute("SELECT tlf FROM kommunikation k WHERE k.betnr = " + Str(betANr(pos5$)) + " and k.komm_art = " + pos1$ + " order by komm_kz ")
                                    pos2$ = 0
                                    While pos2$ < pos3$
                                        betKomm(pos5$) = betKomm(pos5$) + Left$(WordRequest(ret$), laenge) + " "
                                        pos2$ = pos2$ + 1
                                    Wend
                                    betKomm(pos5$) = betKomm(pos5$) + ";"
                                End If
                                pos1$ = pos1$ + 1
                            Wend
                            pos5$ = pos5$ + 1
                        Wend
                        pos5$ = 0
                        While pos5$ < pos4$
                            erg$ = erg$ + betName(pos5$) + " - " + betKomm(pos5$) + Chr(13) + Chr(10)
                            pos5$ = pos5$ + 1
                        Wend
        
                    ElseIf Feld$ = "ANSPRUCH" Then
                    
                        forderungskonto$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "fkonto")
                    
                        If forderungskonto$ = "0" Or forderungskonto$ = "" Then
                            erg$ = GetDBField("titel", "akten", "nr = '" + Anr$ + "'")
                        Else
                            erg$ = GetDBField("titel", "fkonto", "nr = '" + Anr$ + "'" + " and fknr = '" + forderungskonto$ + "'")
                            
                            If erg$ = "" Then
                                erg$ = GetDBField("titel", "akten", "nr = '" + Anr$ + "'")
                            End If
                        End If

                    ElseIf Feld$ = "ANGELEGTVON" Then
                        X = WordExecute("select benutzer from akten,history where akten.nr = history.nr and hart = 'Anlage der Akte' and  akten.nr = '" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                    ElseIf Feld$ = "SVERGUETUNG" Then
                        X = WordExecute("select sum(honorar) from buchungen where skonto Is Null and honorar is not null and nr='" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                    ElseIf Feld$ = "SSOLLSTELLUNG" Then
                        X = WordExecute("select sum(honorar) from buchungen where nr='" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                    ElseIf Feld$ = "AKTENKONTO" Then
                        X = WordExecute("select sum(honorar) from buchungen where skonto Is not Null and  @find('R',skonto,0)>=0 and nr='" + Anr$ + "'")
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        pos = InStr(erg$, ".")
                        If pos > 0 Then
                            erg$ = Left(erg$, pos - 1) + "," + Right(erg$, Len(erg$) - pos)
                        End If
                        If erg$ <> "" Then
                            k1 = CDbl(erg$)
                        Else
                            k1 = 0
                        End If
                        X = WordExecute("select sum(honorar) from buchungen where skonto Is Null and honorar is not null and nr='" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        pos = InStr(erg$, ".")
                        If pos > 0 Then
                            erg$ = Left(erg$, pos - 1) + "," + Right(erg$, Len(erg$) - pos)
                        End If
                        If erg$ <> "" Then
                            k2 = CDbl(erg$)
                        Else
                            k2 = 0
                        End If
                        k1 = k1 + k2
                        erg$ = CStr(k1)
                    ElseIf Feld$ = "SDURCHPOSTEN" Then
                        X = WordExecute("select sum(auslagen) from buchungen where auslagen Is Not Null and nr='" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                    ElseIf Feld$ = "SMERKPOSTEN" Then
                        X = WordExecute("select sum( merk ) from buchungen where merk is not null and nr ='" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                     
                   
                     
                    ElseIf Feld$ = "FRISTENABGELEGTENAKTEN" Then
                        abfrage$ = "select count(frnr) from fristen where nr = " + Anr$ + " and ( erledigt is null or erledigt = '0' ) and datum is not null "
                        X = WordExecute(abfrage$)
                        pos4$ = Left$(WordRequest(ret$), laenge)
                        If pos4$ > 0 Then
                            pos5$ = 0
                            abfrage$ = "select @if( @length( @day( datum ) ) - 1,'' || @day( datum ), '0' || @day( datum ) ) || '.' ||" + _
                            " @if( @length( @month( datum ) ) - 1, '' || @month( datum ), '0' || @month( datum ) ) ||" + _
                            "'.' || @right( @yearno( datum ), 2) || ' ' || @if( @isna( kuerzel ), sb || ' - ' || @if( kz-1, art, 'Frist: ' || art ), sb ||" + _
                            "' - ' || @if( kz-1, art, 'Frist - ' || art ) || @choose( kz, '', '', '', ' - delegiert an ' || kuerzel, '' ) )" + _
                            "|| @if( @isna( text ), '', ' - ' || text )" + _
                            "from fristen where nr = " + Anr$ + " and ( erledigt is null or erledigt = '0' ) and datum is not null  order by 1 desc "
                            X = WordExecute(abfrage$)
                            While pos5$ < pos4$
                                erg = erg + Left$(WordRequest(ret$), laenge) + Chr(13) + Chr(10)
                                pos5$ = pos5$ + 1
                            Wend
                        End If
                        abfrage$ = "select count(frnr) from termine where nr = " + Anr$ + " and ( erledigt is null or erledigt = '0' ) and datum is not null "
                        X = WordExecute(abfrage$)
                        pos4$ = Left$(WordRequest(ret$), laenge)
                        If pos4$ > 0 Then
                            pos5$ = 0
                            abfrage$ = "select @datetochar( datum, 'dd.MM.yy' ) || '  ' || anwalt || ' - Termin - ' ||" + _
                            " @substring( @timevalue( datum ), 0, 2) || ':' || @substring( @timevalue( datum ), 3, 2 ) ||" + _
                            "@if( vortermin,' (' || @substring( @timevalue( datum-( @hour( erinnerungsdauer)/24+@minute( erinnerungsdauer)/24/60) ) , 0, 2) || ':'" + _
                            " || @substring( @timevalue( datum-( @hour( erinnerungsdauer)/24+@minute( erinnerungsdauer)/24/60) ), 3, 2 ) || ')', '')|| ' - ' || @left( text, 200 ) " + _
                            " from termine where nr = " + Anr$ + " and ( erledigt is null or erledigt = '0' ) and datum is not null  order by 1 desc "
                            X = WordExecute(abfrage$)
                            While pos5$ < pos4$
                                erg = erg + Left$(WordRequest(ret$), laenge) + Chr(13) + Chr(10)
                                pos5$ = pos5$ + 1
                            Wend
                        End If
        
                    ElseIf Feld$ = "SFREMDGELD" Then
                        X = WordExecute("select sum( fremdgeld) from buchungen where fremdgeld Is Not Null and nr='" + Anr$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                    ElseIf Feld$ = "VSTAB" Then
                        X = WordExecute("select vstab from akten where nr = '" + Anr$ + "'")
    
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                        If erg$ = "1" Then
                            erg$ = "vorsteuerabzugsberechtigt"
                        Else
                            erg$ = "nicht vorsteuerabzugsberechtigt"
                        End If
                        
                    ElseIf Feld$ = "URNR" Or Feld$ = "URNRDATUM" Then
                        X = WordExecute("select count(distinct aktnot.urnr) from aktnot,urolle where urolle.urnr=aktnot.urnr and aktnot.nr =" + Anr$)
    
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left(WordRequest(ret$), laenge)
                        count_ = CLng(erg$)
                        X = WordExecute("select distinct a.urnr||' '||@DATETOCHAR(angelegt,'dd.MM.yyyy') from aktnot a,urolle u " + _
                            "where angelegt is not null and u.urnr=a.urnr and u.notar=a.notar and a.nr = " + Anr$ + " order by a.urnr")
    
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                        If count_ > 1 Then
                            If IstAlternative = 0 Then
                                Selection.Font.ColorIndex = wdAuto
                            End If
    
                            While Len(erg$) > 0
                                
                                If Len(erg$) >= 8 Then
                                    If Feld$ = "URNRDATUM" Then
                                        erg$ = Right(erg$, 10) & "  " & CStr(CLng(Mid(erg$, 5, 4))) & "/" & Mid(erg$, 3, 2)
                                    Else
                                        erg$ = CStr(CLng(Mid(erg$, 5, 4))) & "/" & Mid(erg$, 3, 2)
                                    End If
                                End If
                                
                                Selection.TypeText erg$
                                erg$ = Left$(WordRequest(ret$), laenge)
                                
                                If Len(erg$) > 0 Then
                                    If Feld$ = "URNRDATUM" Then
                                        Selection.TypeParagraph
                                    Else
                                        Selection.TypeText ","
                                        Selection.TypeText " "
                                    End If
                                    If IstAlternative = 0 Then
                                        Selection.Font.ColorIndex = wdAuto
                                    End If
                                End If
                            Wend
                            
                            Selection.Font.ColorIndex = wdAuto
                            Selection.TypeText " "
                        
                        ElseIf count_ = 1 Then
                            If Len(erg$) >= 8 Then
                                If Feld$ = "URNRDATUM" Then
                                    erg$ = Right(erg$, 10) & "  " & CStr(CLng(Mid(erg$, 5, 4))) & "/" & Mid(erg$, 3, 2)
                                Else
                                    erg$ = CStr(CLng(Mid(erg$, 5, 4))) & "/" & Mid(erg$, 3, 2)
                                End If
                            End If
                        
                        Else
                            erg$ = ""
                        End If
                    Else
                        X = WordExecute("select " + Feld$ + " FROM akten where nr = '" + Anr$ + "'")
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    End If
        
                ElseIf Datei = "faufstatus" Then
                    erg$ = GetFaufstatus(Feld, Datei$, Anr$, fkonto$)
                
                ElseIf Datei = "fauf" Then 'Zin
                    'Wenn Zahlungen den Wert "insgesamt noch zu zahlen" verringern, muss der Betrag
                    'aus Tabelle FAUF ermittelt werden(Zinsen insgesamt). Sind keine Zahlungen vorhanden,
                    'kann der Wert aus Tabelle FAUFSTATUS ermittelt werden. Die Zeile "Zwischensumme" existiert dann nicht.
                    
                    X = WordExecute("select bez FROM " + Datei$ + " WHERE bez = 'Zwischensumme' and nr = " + Anr$)
                    erg$ = Left$(WordRequest(ret$), laenge)
                    
                    If erg$ = "Zwischensumme" Then
                        If Feld = "ZINSEN" Then
                            X = WordExecute("select zinsen + zinsenk  FROM " + Datei$ + " WHERE bez = 'Zwischensumme' and nr = " + Anr$)
                        ElseIf Feld = "ZINSENFORDERUNG" Then
                            X = WordExecute("select zinsen FROM " + Datei$ + " WHERE bez = 'Zwischensumme' and nr = " + Anr$)
                        ElseIf Feld = "ZINSENVK" Then
                            X = WordExecute("select zinsenk FROM " + Datei$ + " WHERE bez = 'Zwischensumme' and nr = " + Anr$)
                        End If
                    Else
                        If Feld = "ZINSEN" Then
                            X = WordExecute("select zinsen + zinsenk FROM FAUFSTATUS WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
                        ElseIf Feld = "ZINSENFORDERUNG" Then
                            X = WordExecute("select zinsen FROM FAUFSTATUS WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
                        ElseIf Feld = "ZINSENKOSTEN" Then
                            X = WordExecute("select zinsenk FROM FAUFSTATUS WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
                        ElseIf Feld = "ZINSENVK" Then
                            X = WordExecute("select zinsenk FROM FAUFSTATUS WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
                        End If
                    End If
                    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                    GoTo Ende
                    End If
                    
                    erg$ = Left$(WordRequest(ret$), laenge)
                    
                ElseIf Datei = "forderungen" Then
                     fSendMessageAdvoware 10, 0 ' FA aktualisieren
                    
                    If Feld = "FORDERUNG" Then
                        X = WordExecute("select summehf FROM faufstatus where nr = " + Anr$ + " and fkonto=0")
                    ElseIf Feld = "VK" Then
                        X = WordExecute("select summekv FROM faufstatus where nr = " + Anr$ + " and fkonto=0")
                    ElseIf Feld = "UK" Then
                        X = WordExecute("select summeku FROM faufstatus where nr = " + Anr$ + " and fkonto=0")
                    ElseIf Feld = "SUMME" Then
                        X = WordExecute("select summehf+summekv+summeku FROM faufstatus where nr = " + Anr$ + " and fkonto=0")
                    End If
                    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
        
                    erg$ = Left$(WordRequest(ret$), laenge)
                
                ElseIf Datei = "buchungen" Then
                    If Feld = "SUMME" Then
                        X = WordExecute("select sum(betrag) FROM " + Datei$ + " WHERE fknr is not null and nr = " + Anr$)
    
                    End If
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
        
                    erg$ = Left$(WordRequest(ret$), laenge)
               
               ElseIf Datei$ = "notariat" Or Datei$ = "sozialr" Or Datei = "arbrecht" Or Datei$ = "famrecht" Or Datei = "mietrecht" Then
                    erg$ = GetAbfrageErg(Feld$, Datei$, Anr$)
                
               ElseIf Datei$ = "unfall" Then
                    ret$ = String(255, " ")
                    If Feld = "ZEUGEN" Or Feld$ = "ZEUGENANSCHRIFT" Then
                         X = WordExecute("select bt.name||', '||strasse||', '||plz||' '||ort FROM betakt bt,beteiligte b,adresse a where b.betnr=bt.betnr and a.betnr=bt.betnr and art='Zeuge' and adnr=1 and nr = " + Anr$ + " order by lfd")
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        ret$ = Left$(WordRequest(ret$), laenge)
                        While Len(ret$) > 0
                            If Len(erg$) > 0 Then erg$ = erg$ & "; "
                            erg$ = erg$ & ret$
                            ret$ = String(255, " ")
                            ret$ = Left$(WordRequest(ret$), laenge)
                        Wend
                        
                    Else
                        X = WordExecute("select " + Feld$ + " FROM " + Datei$ + " WHERE nr = " + Anr$)
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                    End If
                
        
                ElseIf Datei$ = "system" Then
                    If Feld$ = "TEXT3A" Then
                        erg$ = standort$
                    
                    ElseIf Feld$ = "MWST" Then
                        X = WordExecute("select text1 FROM system where art = 'mwst'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        pos = InStr(erg$, " ")
                        erg$ = Right$(erg$, Len(erg$) - pos)
                        
                    ElseIf Feld$ = "USTNR" Then
                        X = WordExecute("select fa_steuernr from standorte where bezeichnung = '" + standort$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        
                        erg$ = Left$(WordRequest(ret$), laenge)
                            
                    ElseIf Feld$ = "UIDNR" Then
                        X = WordExecute("select UIDNR from standorte where bezeichnung = '" + standort$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        
                        erg$ = Left$(WordRequest(ret$), laenge)
                            
                    ElseIf Feld$ = "FINANZAMT" Then
                        X = WordExecute("select fa_name FROM standorte where bezeichnung = '" + standort$ + "'")
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        
                        erg$ = Left$(WordRequest(ret$), laenge)
                            
                   Else
                        If Feld$ = "TEXT1" Then
                            X = WordExecute("select name FROM standorte where bezeichnung = '" + standort$ + "'")
                        ElseIf Feld$ = "TEXT2" Then
                            X = WordExecute("select strasse FROM standorte where bezeichnung = '" + standort$ + "'")
                        ElseIf Feld$ = "TEXT3" Then
                            X = WordExecute("select plz || ' ' || ort FROM standorte where bezeichnung = '" + standort$ + "'")
                        ElseIf Feld$ = "TEXT4" Then
                            X = WordExecute("select telefon FROM standorte where bezeichnung = '" + standort$ + "'")
                        ElseIf Feld$ = "TEXT5" Then
                            X = WordExecute("select telefax FROM standorte where bezeichnung = '" + standort$ + "'")
                        ElseIf Feld$ = "TEXT6" Then
                            X = WordExecute("select anrede FROM standorte where bezeichnung = '" + standort$ + "'")
                        End If
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
    
                        erg$ = Left$(WordRequest(ret$), laenge)
                    End If
                ElseIf Datei$ = "betakt" Then
                    If Val(lfd$) > 0 And Feld$ <> "BETREFF" And Feld$ <> "BETREFF2" And Feld$ <> "BETREFF3" And Feld$ <> "GNR" Then
                        abfrage$ = "select " + Feld$ + " FROM betakt where lfd = " + lfd$ + " AND nr = " + Anr$
                    Else
                        If Feld = "BETREFF" Or Feld = "BETREFF2" Or Feld = "BETREFF3" Then
                            
                            If bet = "M" Then
                                abfrage$ = "select " + Feld$ + " FROM betakt where kz = 1" + _
                                             " AND nr = " + Anr$ + " AND bet=" + kz$ + " "
                            ElseIf bet = "G" Then
                                 abfrage$ = "select " + Feld$ + " FROM betakt where kz = 2" + _
                                           " AND nr = " + Anr$ + " AND bet=" + kz$ + ""
                                           
                            ' 11.09.2019 mp: Dann funktionieren manche Platzhalter nicht mehr
                            'z.B. BetreffGericht aus der Musterrechnung "Kostenfestsetzungsantrag (Gegner).rvg"
                          '  ElseIf FeldZusatz <> "" And kz$ <> "" Then
                             '   abfrage$ = "select " + Feld$ + " FROM betakt where (kz = " + kz$ + " or bet=" + kz$ + _
                                             ") AND nr = " + Anr$ + " and (art='" + FeldZusatz + "' or stellung='" + FeldZusatz + "')"
                            ElseIf kz$ <> "" Then
                                abfrage$ = "select " + Feld$ + " FROM betakt where kz = " + kz$ + _
                                           " AND nr = " + Anr$ + " AND rang = " + rang
                                
                                X = WordExecute(abfrage$)
                
                                If X <> 0 Then
                                    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                                    GoTo Ende
                                End If
                
                                erg$ = Left$(WordRequest(ret$), laenge)
                                
                                If erg$ = "" Then
                                    X = InStr(1, Selection.text, "Gegenanwalt")
                                    If X > 0 Then
                                        abfrage$ = "select " + Feld$ + " FROM betakt where bet = " + kz$ + _
                                           " AND nr = " + Anr$ + " AND rang = " + rang$ + " AND kz = 2"
                                    End If
                                End If
                            Else
                                If Anr$ = "" Or lfd$ = "" Then
                                    X = InStr(Selection.text, "BetreffGericht")
    
                                    If X > 0 Then 'Altlasten
                                        abfrage$ = "select betreff FROM betakt where kz = 8 and nr = " + Anr$
                                    Else
                                        abfrage$ = "select " + Feld$ + " FROM betakt where lfd = " + lfd$ + " AND nr = " + Anr$
                                    End If
                                End If

                            End If
                         
                        ElseIf bet$ = "" Or bet$ = "0" Then
                            abfrage$ = "select " + Feld$ + " FROM betakt where kz = " + kz$ + _
                            " AND nr = " + Anr$ + " AND bet is null AND rang = " + rang$
                        ElseIf bet$ = "M" Or bet$ = "G" Then
                            abfrage$ = ""
                        ElseIf kz$ <> "" Then
                            abfrage$ = "select " + Feld$ + " FROM betakt where bet is null and kz = " + kz$ + _
                            " AND nr = " + Anr$ + " AND bet = " & bet$ & " AND rang = " + rang$
                        Else
                            abfrage$ = "select " + Feld$ + " FROM betakt where lfd = " + lfd$ + _
                                " AND nr = " + Anr$
                        End If
                    End If
    
                    If RTrim$(abfrage$) <> "" Then
                        X = WordExecute(abfrage$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    End If
        
                ElseIf Datei$ = "mitarbeiter" Then
                    If Feld$ = "NAME" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT name FROM mitarbeiter WHERE kuerzel = '" + kuerzel$ + "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "SITZ" Then
                        benutzername$ = "SELECT SITZ FROM mitarbeiter m,akten a WHERE m.kuerzel = a.sb and a.nr =" + Anr$
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "LANDGERICHT" Then
                        benutzername$ = "SELECT LANDGERICHT FROM mitarbeiter m,akten a WHERE m.kuerzel = a.sb and a.nr =" + Anr$
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "BEZIRK" Then
                        benutzername$ = "SELECT bezirk FROM mitarbeiter m,akten a WHERE m.kuerzel = a.sb and a.nr =" + Anr$
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "VOLLERNAMENOTAR" Then
                        benutzername$ = "SELECT notbez FROM mitarbeiter m,akten a WHERE m.kuerzel = a.sb and a.nr =" + Anr$
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "NOTARTITEL" Then
                        benutzername$ = "SELECT weiblich FROM mitarbeiter m,akten a WHERE m.kuerzel = a.sb and a.nr =" + Anr$
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "0" Then
                            erg$ = "Notar"
                        ElseIf erg$ = "1" Then
                            erg$ = "Notarin"
                        ElseIf erg$ = "2" Then
                            erg$ = "Notariatsverwalter"
                        ElseIf erg$ = "3" Then
                            erg$ = "Notariatsverwalterin"
                        Else
                            erg$ = "Notar"
                        End If
                        
                    ElseIf Feld$ = "MITARBEITERTITEL" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT @trim(titel) FROM mitarbeiter WHERE kuerzel = '" + kuerzel$ + "'"
                        X = WordExecute(benutzername$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "TITELNAME" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT @trim(titel || ' ' || name) FROM mitarbeiter WHERE kuerzel = '" + kuerzel$ + "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "MITARBEITERSIGNATUR1" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT signatur1 FROM mitarbeiter WHERE kuerzel = '" + kuerzel$ + "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        ret$ = String(255, " ")
                        erg$ = WordRequest(ret$)
                        ret$ = String(2001, " ")
                        erg$ = WordRequestLongVarChar(ret$)
                        pos1$ = InStr(erg$, Chr$(0))
                        If pos1$ < 1 Then pos1$ = 1
                        erg$ = Left(erg$, pos1$ - 1)
                    ElseIf Feld$ = "MITARBEITERSIGNATUR2" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT signatur2 FROM mitarbeiter WHERE kuerzel = '" + kuerzel$ + "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        ret$ = String(255, " ")
                        erg$ = WordRequest(ret$)
                        ret$ = String(2001, " ")
                        erg$ = WordRequestLongVarChar(ret$)
                        pos1$ = InStr(erg$, Chr$(0))
                        If pos1$ < 1 Then pos1$ = 1
                        erg$ = Left(erg$, pos1$ - 1)
                        
                    ElseIf Feld$ = "ORTSSIGNATUR1" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT signatur1 from standorte where bezeichnung = '" & standort$ & "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        ret$ = String(255, " ")
                        erg$ = WordRequest(ret$)
                        ret$ = String(2001, " ")
                        erg$ = WordRequestLongVarChar(ret$)
                        pos1$ = InStr(erg$, Chr$(0))
                        If pos1$ < 1 Then pos1$ = 1
                        erg$ = Left(erg$, pos1$ - 1)
                    ElseIf Feld$ = "ORTSSIGNATUR2" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT signatur2 from standorte where bezeichnung = '" & standort$ & "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        ret$ = String(255, " ")
                        erg$ = WordRequest(ret$)
                        ret$ = String(2001, " ")
                        erg$ = WordRequestLongVarChar(ret$)
                        pos1$ = InStr(erg$, Chr$(0))
                        If pos1$ < 1 Then pos1$ = 1
                        erg$ = Left(erg$, pos1$ - 1)
                        
                    ElseIf Feld$ = "STANDORT" Then
                        benutzername$ = "SELECT m.standort FROM akten a, mitarbeiter m WHERE m.kuerzel=a.sb and a.nr = " + Anr$
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "EMAIL" Then
                        benutzername$ = "SELECT email from standorte where bezeichnung = '" & standort$ & "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                           
                    ElseIf Feld$ = "STANDORTUSER" Then
                        kuerzel$ = GetUser
                        benutzername$ = "SELECT @trim(s.anrede||' '||s.name)||@char(13)||@char(10)||@trim(s.strasse)||@char(13)||@char(10)||@trim(s.plz||' '||s.ort) FROM standorte s,mitarbeiter m WHERE s.bezeichnung=m.standort and m.kuerzel='" + kuerzel$ + "'"
                        X = WordExecute(benutzername$)
        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
        
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                    Else
                        abfrage$ = "select " + Feld$ + " from akten, mitarbeiter where  mitarbeiter.kuerzel=akten.sb and akten.nr=" & Anr$
                        X = WordExecute(abfrage$)
                        erg$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        
                    End If
                ElseIf Datei$ = "pfade" Then
                    UnterschriftEinf|fffd|gen Feld, Anr
                
                ElseIf Datei$ = "ini" Or Datei$ = "massnahmen" Or Datei$ = "var" Or Datei = "terminzettel" Then
                    'Do nothing
                ElseIf Datei$ = "fristenzettel" And System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Frnr") <> "" Then
                    erg$ = GetFristenzettel(Feld$)
                    
                    'Do nothing
        
                ElseIf Datei$ = "konten" Then
                    konto = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "kontoword")
                    If konto$ = "" Or konto$ = "0" Then
                        konto$ = "1"
                    End If
                        
                    'konto$ = "1"    'Der Index f|fffd|r die Bankverbindung wird ausschlie|fffd|lich bei der Auswahl des Kontos bei den |fffd|berweisungen gesetzt.
                                    'Die Platzhalter im |fffd|berweisungsformular sind andere und werden direkt aus Advoware gef|fffd|llt.
                                    '02.09.2014 MP.
                    
                    If Feld$ = "BANK" Then
                        konto$ = "SELECT bank||', BIC '||bic||', IBAN '||iban FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT bank||', BIC '||bic||', IBAN '||iban FROM konten WHERE standard = 1 "
                    ElseIf Feld$ = "BANKNAME" Then
                        konto$ = "SELECT bank FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT bank FROM konten WHERE standard = 1 "
                    ElseIf Feld$ = "BLZ" Then
                        konto$ = "SELECT BLZ  FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT BLZ FROM konten WHERE standard = 1 "
                    ElseIf Feld$ = "BIC" Then
                        konto$ = "SELECT BIC  FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT BIC FROM konten WHERE standard = 1 "
                    ElseIf Feld$ = "IBAN" Then
                        konto$ = "SELECT IBAN  FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT IBAN  FROM konten WHERE standard = 1 "
                    ElseIf Feld$ = "KTONR" Then
                        konto$ = "SELECT ktonr FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT ktonr FROM konten WHERE standard = 1 "
                    ElseIf Feld$ = "GLAEUBIGERID" Then
                        konto$ = "SELECT glaeubigerid FROM konten WHERE nr = " + konto$
                        s1$ = "SELECT glaeubigerid FROM konten WHERE standard = 1 "
                    End If
                                        
                    X = WordExecute(s1$)
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
                    erg$ = Left$(WordRequest(ret$), laenge)
                    If erg$ = "" Then
                        X = WordExecute(konto$)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        erg$ = Left$(WordRequest(ret$), laenge)
                    ElseIf Feld$ = "IBAN" Then
                        
                        If Len(erg$) = 22 Then
                            erg$ = Mid(erg, 1, 4) & " " & Mid(erg, 5, 4) & " " & Mid(erg, 9, 4) & " " & Mid(erg, 13, 4) & " " & Mid(erg, 17, 4) & " " & Mid(erg, 21, 2)
                        End If
                    End If
                                        
                ElseIf Datei$ = "beteiligte" Then
                    erg$ = GetBeteiligte(Feld$, Datei$, Anr, bet$, kz$, rang$, betnr$, Name$)
                ElseIf Datei$ = "takt" Then
                    abfrage = "select bez from takt where nr = " & Anr & " and znr = " & Feld$
                    X = WordExecute(abfrage)
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                
                ElseIf Datei$ = "takt2" Then
                    abfrage = "select bez from takt2 where nr = " & Anr & " and znr = " & Feld$
                    X = WordExecute(abfrage)
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                ElseIf Datei$ = "takt3" Then
                    abfrage = "select bez from takt3 where nr = " & Anr & " and znr = " & Feld$
                    X = WordExecute(abfrage)
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                ElseIf Datei$ = "takt4" Then
                    abfrage = "select bez from takt4 where nr = " & Anr & " and znr = " & Feld$
                    X = WordExecute(abfrage)
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                
                ElseIf Datei$ = "standorte" Then
                    abfrage = "select " & Feld & " from standorte where bezeichnung = '" & standort$ & "'"
                    X = WordExecute(abfrage)
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                
                ElseIf Datei$ = "faufstatus" Then
                    abfrage = "select bez from takt where nr = " & Anr & " and znr = " & Feld$
                    X = WordExecute(abfrage)
                    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
                    
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                    
                ElseIf Datei$ = "referate" Then
                    abfrage = "select referat from akten where nr = " & Anr
                    X = WordExecute(abfrage)
    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
                    
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                    
                    If Feld$ = "GANREDE" Then
                        abfrage = "select ganrede from referate where KUERZEL = '" & erg & "'"
                    ElseIf Feld$ = "REFERAT" Then
                        abfrage = "select referat from referate where KUERZEL = '" & erg & "'"
                    
                    End If
                    
                    X = WordExecute(abfrage)
                    erg$ = String(255, " ")
                    erg$ = Left(WordRequest(erg$), laenge)
                    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
                
                ElseIf Datei = "krsum" Then
                    ret$ = String(255, " ")
                    X = WordExecute("SELECT knr FROM krsum WHERE dr = 1 AND nr = " + Anr$)
                    Knr$ = Left$(WordRequest(ret$), laenge)
        
                    If Knr$ = "" Then
                        X = WordExecute("SELECT max(knr) FROM krsum WHERE nr = " + Anr$)
                        ret$ = String(255, " ")
                        Knr$ = Left$(WordRequest(ret$), laenge)
                    End If
    
                    If Feld = "DATUM" Or Feld = "NEXTSTEP" Or Feld = "FAELLIG" Then
                        X = WordExecute("SELECT " + Feld + " FROM krsum where knr=" + Knr$ + " and nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                    ElseIf Feld = "BETRAG" Then
                        X = WordExecute("SELECT betrag FROM krsum where  knr=" + Knr$ + " and nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
    
                    ElseIf Feld = "NETTO" Then
                        X = WordExecute("select @if( @isna( ust ), honorar, honorar - ust ) from krsum where knr = " + Knr$ + " and nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                    ElseIf Feld = "NETTOOHNEAUSLAGEN" Then
                        X = WordExecute("select sum(kr.betrag) from kr,auslagenarten where kr.text like auslagenarten.text||' vom %' and kz = 0 and knr=" + Knr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag = Val(erg)
                        X = WordExecute("SELECT sum(betrag) FROM kr where (vvnr>7009 or vvnr<7000 or vvnr is null) and text not like 'Aktenversendungspauschale%' and kz = 0 and knr=" + Knr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag2 = Val(erg)
                        erg$ = Betrag2 - Betrag
                    ElseIf Feld = "UST" Then
                        X = WordExecute("SELECT ust FROM krsum where  knr=" + Knr$ + " and nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
    
                    ElseIf Feld = "RNR" Then
                        X = WordExecute("SELECT betrag FROM krsum where  knr=" + Knr$ + " and nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                    ElseIf Feld = "LEISTUNGSZEITRAUM" Then
                        X = WordExecute("SELECT leistungszeitraum FROM krsum where  knr=" + Knr$ + " and nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                    ElseIf Feld = "AUSLAGEN" Then
                        X = WordExecute("SELECT sum(betrag) FROM kr where kz=2 and knr=" + Knr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                            
                    ElseIf Feld = "SUMMERECHNUNGENNETTO" Then
                        X = WordExecute("SELECT sum(betrag-@nullvalue(ust,0)) FROM krsum where nr=" + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag = Val(erg)

                    ElseIf Feld = "SUMMERECHNUNGENUST" Then
                        X = WordExecute("SELECT sum(ust) FROM krsum where nr=" + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag = Val(erg)
                            
                    ElseIf Feld = "SUMMERECHNUNGENBRUTTO" Then
                        X = WordExecute("SELECT sum(betrag) FROM krsum where nr=" + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag = Val(erg)
                            
                    ElseIf Feld = "STEUERPFLICHTIGEAUSLAGEN" Then
                        X = WordExecute("select sum(kr.betrag) from kr,auslagenarten where kr.text like auslagenarten.text||' vom %' and kz = 0 and knr=" + Knr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag = Val(erg)
    
    
                        X = WordExecute("SELECT sum(betrag) FROM kr where ((vvnr>7000 and vvnr<7010) or text like 'Aktenversendungspauschale%') and kz=0 and knr=" + Knr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        Betrag2 = Val(erg)
                        erg$ = Betrag2 + Betrag
                    End If
                
                ElseIf Datei = "notariatchk" Then
                    If Feld$ = "BEBAUT" Then
                        X = WordExecute("SELECT bebaut FROM notariat where  nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            X = WordExecute("SELECT wohngebaeude FROM notariat where nr = " + Anr$)
                            ret$ = String(255, " ")
                            erg$ = Left$(WordRequest(ret$), laenge)
                            If erg$ = "1" Then
                                erg$ = "Wohngeb|fffd|ude"
                            Else
                                erg$ = "andere Bebauung"
                            End If
                        Else
                            erg$ = "nicht bebaut"
                        End If
                    
                    ElseIf Feld$ = "LAND" Then
                        X = WordExecute("SELECT land FROM notariat where  nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            erg$ = "land- und forstwirtschaftlich genutzt"
                        Else
                            erg$ = "nicht land- und forstwirtschaftlich genutzt"
                        End If
                    
                    ElseIf Feld$ = "VERWANDT1" Then
                        X = WordExecute("SELECT verwandt1 FROM notariat where  nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            erg$ = "Verwandter (gerade Linie)"
                        ElseIf erg$ = "2" Then
                            erg$ = "Ehegatte"
                        ElseIf erg$ = "3" Then
                            X = WordExecute("SELECT bezverwandt1 FROM notariat where  nr = " + Anr$)
                            ret$ = String(255, " ")
                            erg$ = Left$(WordRequest(ret$), laenge)
                        End If
                    
                    ElseIf Feld$ = "VERWANDT2" Then
                        X = WordExecute("SELECT verwandt2 FROM notariat where  nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            erg$ = "Verwandter (gerade Linie)"
                        ElseIf erg$ = "2" Then
                            erg$ = "Ehegatte"
                        ElseIf erg$ = "3" Then
                            X = WordExecute("SELECT bezverwandt2 FROM notariat where  nr = " + Anr$)
                            ret$ = String(255, " ")
                            erg$ = Left$(WordRequest(ret$), laenge)
                        End If
                    
                    ElseIf Feld$ = "ART" Then
                        X = WordExecute("SELECT art FROM notariat where  nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            erg$ = "Kauf"
                        ElseIf erg$ = "2" Then
                            erg$ = "Tausch"
                        ElseIf erg$ = "3" Then
                            erg$ = "Abtretung"
                        ElseIf erg$ = "4" Then
                            erg$ = "Schenkung"
                        End If
                    
                    ElseIf Feld$ = "RECHTSWIRKSAMKEIT" Then
                        X = WordExecute("SELECT rechtswirksamkeit FROM notariat where  nr = " + Anr$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            erg$ = "Rechtswirksamkeit ist eingetreten"
                        Else
                            erg$ = "Rechtswirksamkeit ist nicht eingetreten"
                        End If
                    End If
                
                ElseIf Datei = "autotexte" Then
                    If IstAlternative = 0 Then
                        Selection.Font.ColorIndex = wdAuto
                    End If

                    Selection.TypeText Feld$
                    TBundAustauschen.AutotexteNeu
                    
                ElseIf Datei = "grundbuch" Then
                    erg$ = GetGrundbuch(Feld$, kz$, rang$, Anr$)
                ElseIf Datei = "urkunden" Then
                    erg$ = GetUrkunden(Feld$, kz$, Anr$)
                End If
            
            End If
            
            Index$ = LCase$(Index$)

            If Index$ = "d" And Len(erg$) = 10 Then
                If RTrim$(erg$) <> "" Then
                    erg$ = Right$(erg$, 2) + "." + Mid(erg$, 6, 2) + "." + Left$(erg$, 4)
                End If
            
            ElseIf Index$ = "z" Then
                erg$ = Left$(erg$, 2) + ":" + Mid$(erg$, 4, 2)
            
            ElseIf Index$ = "p" And erg$ <> "" Then
                Selection.InlineShapes.AddPicture FileName:=erg$, LinkToFile:= _
                False, SaveWithDocument:=True
                erg$ = ""
            
            ElseIf Index$ = "n" Then
                erg$ = bib.wformat(bib.dbzahl(erg$))
            
            ElseIf Feld$ = "VERTRETER" Or Feld$ = "VERTRETERNOTARIAT" Then
                If kz = 6 Or kz = 7 Then
                    If bet$ = "M" Then
                        abfrage = "select betnr from betakt where nr=" & Anr & " and kz=1 and rang=" & rang & "and bet=" & kz
                    ElseIf bet$ = "G" Then
                        abfrage = "select betnr from betakt where nr=" & Anr & " and kz=2 and rang=" & rang & "and bet=" & kz
                    End If
                Else
                    abfrage = "select betnr from betakt where nr=" & Anr & " and rang=" & rang & "and kz=" & kz
                End If
                X = WordExecute(abfrage)
                erg$ = String(255, " ")
                erg$ = Left(WordRequest(erg$), laenge)
                If erg$ <> "" Then
                    If Feld$ = "VERTRETER" Then
                        If kz$ = 6 Or kz = 7 Then
                            If bet$ = "G" Then
                                vertreter 2, erg$, 0, 1, rang
                            Else
                                vertreter 1, erg$, 0, 1, rang
                            End If
                        ElseIf bet$ = "0" Then
                            vertreter kz, erg$, 0, 1, rang
                        End If
                    Else
                        vertreter kz$, erg$, 0, 6, rang
                    End If
                    nAuswahlNichtL|fffd|schen = 1 ' 29.11.2016 (mp):wg. Bug in MS Word. Manchmal wird der Text gel|fffd|scht, weil der Text scheinbar noch markiert ist.
                End If
            End If
            
            If Feld$ = "ANSPRUCH" Or Feld$ = "DATUM" Or Feld$ = "UHRZEIT" Or Feld$ = "RAUM" Then
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
            
            ElseIf RTrim$(erg$) <> "" Then
                If IstAlternative = 0 Then
                    If Selection.Font.ColorIndex = wdPink Then
                        Selection.Font.ColorIndex = wdAuto
                    End If
                End If
            End If
            
            If Feld = "GEBDAT" Or Feld = "TODESDAT" Or Feld = "MANDATVOM" Then
                erg$ = bib.gdat(erg$)
            End If
            
            If erg$ <> "" Then
                If IstAlternative = 0 And Selection.Font.ColorIndex = wdPink Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                
                Selection.TypeText erg$
            
            ElseIf Datei$ = "var" Or Datei = "terminzettel" Then
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
            
            ElseIf Feld = "ZUSATZ" And Datei = "beteiligte" Then
                Selection.Delete
            
            ElseIf nAuswahlNichtL|fffd|schen = 0 And Feld <> "DATUM" And Feld <> "UHRZEIT" And Feld <> "RAUM" And Feld <> "UNTERSCHRIFTSDATEI" And Feld <> "UNTERSCHRIFTSDATEIHINTERDENTEXT" And Feld <> "UNTERSCHRIFTSDATEIBENUTZER" And Feld <> "UNTERSCHRIFTSDATEIBENUTZERHINTERDENTEXT" And Feld <> "URNR" Then
                Selection.Delete
            End If
            
        ElseIf InStr(Selection.text, "|fffd|") Then
            X = InStr(Selection.text, "|fffd|")
            Y = InStr(X + 1, Selection.text, "|fffd|")
            Betart$ = Mid(Selection.text, X + 1, Y - X - 1)
            If fKeineforderungsaufstellung(Betart$) Then
                GoTo EndWhile
            End If
            Select Case Betart$
               Case "tx"
                    rang$ = Mid(Selection.text, 34)
                    rang$ = Left(rang$, Len(rang$) - 8)
                    If rang$ = "" Or rang$ = "0" Then
                        rang$ = "1"
                    End If
                    tx rang$
               Case "txj"
                    txj
               Case "txt"
                    rang$ = Mid(Selection.text, 34)
                    rang$ = Left(rang$, Len(rang$) - 16)
                    If rang$ = "" Or rang$ = "0" Then
                        rang$ = "1"
                    End If
                    txt rang$
    
               Case "Mandant", "Mandant_"
                    rang$ = Mid(Selection.text, Len(Selection.text) - 4, 2)
                    
                    If rang$ = "" Or rang$ = "0" Then
                        rang$ = "1"
                    End If
                    
                    Select Case rang$
                        Case "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", _
                            "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"
                            
                            If Mid(Selection.text, Len(Selection.text) - 5, 1) = "L" Then
                                BeteiligtenEinfuegen "1", rang$, "1"
                            ElseIf Mid(Selection.text, Len(Selection.text) - 5, 1) = "P" Then
                                BeteiligtenEinfuegen "1", rang$, "2"
                            Else
                                BeteiligtenEinfuegen "1", rang$, ""
                            End If
                    
                        Case Else
                            rang$ = Mid(Selection.text, Len(Selection.text) - 3, 1)
                          
                            If Mid(Selection.text, Len(Selection.text) - 4, 1) = "L" Then
                                BeteiligtenEinfuegen "1", rang$, "1"
                            ElseIf Mid(Selection.text, Len(Selection.text) - 4, 1) = "P" Then
                                BeteiligtenEinfuegen "1", rang$, "2"
                            Else
                                BeteiligtenEinfuegen "1", rang$, ""
                            End If
                    
                    End Select
                        
                Case "Gegner"
                    rang$ = Mid(Selection.text, Len(Selection.text) - 4, 2)
                    
                    If rang$ = "" Or rang$ = "0" Then
                        rang$ = "1"
                    End If
                    
                    Select Case rang$
                        Case "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", _
                            "21", "22", "23", "24", "25", "26", "27", "28", "29", "30"
                            
                            If Mid(Selection.text, Len(Selection.text) - 5, 1) = "L" Then
                                BeteiligtenEinfuegen "2", rang$, "1"
                            ElseIf Mid(Selection.text, Len(Selection.text) - 5, 1) = "P" Then
                                BeteiligtenEinfuegen "2", rang$, "2"
                            Else
                                BeteiligtenEinfuegen "2", rang$, ""
                            End If
                        
                        Case Else
                            rang$ = Mid(Selection.text, Len(Selection.text) - 3, 1)
                          
                            If Mid(Selection.text, Len(Selection.text) - 4, 1) = "L" Then
                                BeteiligtenEinfuegen "2", rang$, "1"
                            ElseIf Mid(Selection.text, Len(Selection.text) - 4, 1) = "P" Then
                                BeteiligtenEinfuegen "2", rang$, "2"
                            Else
                                BeteiligtenEinfuegen "2", rang$, ""
                            End If
                    
                    End Select
                        
                Case "Beteiligter"
                    rang$ = Mid(Selection.text, Len(Selection.text) - 4, 2)
                    If rang$ = "50" Then rang$ = "*"
                    If rang$ = "" Or rang$ = "0" Then
                        rang$ = "1"
                    End If
                    
                    Select Case rang$
                        Case "10", "11", "12", "13", "14", "15", "16", "17", "18", "19", "20", _
                            "21", "22", "23", "24", "25", "26", "27", "28", "29", "30", _
                            "31", "32", "33", "34", "35", "36", "37", "38", "39", "40", _
                            "41", "42", "43", "44", "45", "46", "47", "48", "49", "50", _
                            "51", "52", "53", "54", "55", "56", "57", "58", "59", "60"
                            
                            If Mid(Selection.text, Len(Selection.text) - 5, 1) = "L" Then
                                BeteiligtenEinfuegen "999", rang$, "1"
                            ElseIf Mid(Selection.text, Len(Selection.text) - 5, 1) = "P" Then
                                BeteiligtenEinfuegen "999", rang$, "2"
                            Else
                                BeteiligtenEinfuegen "999", rang$, ""
                            End If
                        
                        Case Else
                            rang$ = Mid(Selection.text, Len(Selection.text) - 3, 1)
                            If Mid(Selection.text, Len(Selection.text) - 4, 2) = "50" Then
                                rang$ = "*"
                                BeteiligtenEinfuegen "999", rang$, "2"
                            Else
                                If Mid(Selection.text, Len(Selection.text) - 4, 1) = "L" Then
                                    BeteiligtenEinfuegen "999", rang$, "1"
                                ElseIf Mid(Selection.text, Len(Selection.text) - 4, 1) = "P" Then
                                    BeteiligtenEinfuegen "999", rang$, "2"
                                Else
                                    BeteiligtenEinfuegen "999", rang$, ""
                                End If
                            End If
                    End Select
                        
                Case "mandanten_"
                    Mandanten "1"
    
                Case "mandanten"
                    Beteiligte "1"
    
                Case "mandantenundvertreter"
                    Beteiligte "mv"
                    
                Case "vertretermandanten"
                    Beteiligte "vm"
                    
                Case "mandantenundvertreterkurz"
                    MV (2)
                            
                Case "mandantenundvertreterkurz1"
                    MV (5)
                            
                Case "AnschriftenMandanten"
                    AnschriftenMandanten
                    
                Case "BetreffMandanten"
                    BetreffMandanten
                    
                Case "BriefanredeMandanten"
                    BriefanredeMandanten
                    
                Case "gegner"
                    Beteiligte "2"
    
                Case "vertretergegner"
                    Beteiligte "vg"
                    
                Case "gegnerundvertreter"
                    Beteiligte "gv"
                    
                Case "gegnerundvertreterkurz"
                    GV (2)
                
                Case "gegnerundvertreterkurz1"
                    GV (5)
                    
                Case "kindermandant"
                    Beteiligte "km"
                    
                Case "eheleutemandant"
                    Beteiligte "mf"
                
                Case "eheleutegegner"
                    Beteiligte "gf"
                
                Case "kindgegner"
                    Beteiligte "gk"
    
                Case "mandantunduntergeordnete"
                    Beteiligte "mu"
    
                Case "mandantuntergeordnete"
                    Beteiligte "mu2"
    
                Case "gegnerunduntergeordnete"
                    Beteiligte "gu"
    
                Case "ganwalt"
                    Beteiligte "5"
    
                Case "kinder"
                    Beteiligte "14"
    
                Case "kindergegner"
                    Beteiligte "14a"
    
                Case "aktenbeteiligte"
                    Beteiligte "0"
                
                Case "benutzername"
                    erg$ = GetUser
    
                    If RTrim$(erg$) <> "" Then
                        If IstAlternative = 0 Then
                            If Selection.Font.ColorIndex = wdPink Then
                                Selection.Font.ColorIndex = wdAuto
                            End If
                        End If
                        
                        With Selection
                            .TypeText text:=erg$
                        End With
                    Else
                        Selection.TypeText " "
                    End If
    
                Case "benutzertelefon", "benutzeremail", "benutzeremail2", "benutzeremail3", "benutzerunterschrift", "benutzertelefax"
                    Sb$ = GetUser
                    If Betart$ = "benutzertelefon" Then
                        Feld$ = "durchwahl"
                    ElseIf Betart$ = "benutzeremail" Then
                        Feld$ = "email2"
                    ElseIf Betart$ = "benutzeremail2" Then
                        Feld$ = "email3"
                    ElseIf Betart$ = "benutzeremail3" Then
                        Feld$ = "email4"
                    ElseIf Betart$ = "benutzerunterschrift" Then
                        Feld$ = "unterschrift"
                    ElseIf Betart$ = "benutzertelefax" Then
                        Feld$ = "durchwahlfax"
                    End If
                    X = WordExecute("select " & Feld$ & " FROM mitarbeiter where kuerzel = '" + Sb$ + "'")
    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
    
                    erg$ = Left$(WordRequest(ret$), laenge)
    
                    If RTrim$(erg$) <> "" Then
                        If IstAlternative = 0 Then
                            If Selection.Font.ColorIndex = wdPink Then
                                Selection.Font.ColorIndex = wdAuto
                            End If
                        End If
                        With Selection
                            .TypeText text:=erg$
                        End With
                    End If
    
                Case "kanzlei"
                    abfr_bet$ = "SELECT anrede||' '||name FROM standorte WHERE bezeichnung = '" + standort$ + "'"
                    
                    X = WordExecute(abfr_bet$)
    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
         
                    erg$ = Left$(WordRequest(ret$), laenge)
                    
                    abfr_bet$ = "SELECT strasse||', '|| plz || ' ' || ort FROM standorte WHERE bezeichnung = '" + standort$ + "'"
                    X = WordExecute(abfr_bet$)
    
                    If X <> 0 Then
                        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                        GoTo Ende
                    End If
         
                    erg$ = erg$ + ", " + Left$(WordRequest(ret$), laenge)
                        
                    If RTrim$(erg$) <> "" Then
                        If IstAlternative = 0 Then
                            Selection.Font.ColorIndex = wdAuto
                        End If
                        With Selection
                            .TypeText text:=erg$
                        End With
                    Else
                        AnwendungAktivieren ("Microsoft Word")
                        MsgBox "advoware kann keine Kanzleidaten ermitteln!", vbExclamation, GetApplicationName()
                    End If
    
                Case "rechnen"
                    Application.Run (Betart$)
                
                Case "Schadensaufstellung"
                    Schadensaufstellung.TabelleErzeugen
                
                Case "Reparaturkosten"
                    Schadensaufstellung.Reparaturkosten
                
                Case "Wertminderung"
                    Schadensaufstellung.Wertminderung
                
                Case "Wiederbeschaffungswert"
                    Schadensaufstellung.Wiederbeschaffung
                
                Case "SummeReparaturkosten"
                    Schadensaufstellung.SummeReparaturkosten
                
                Case "SummeWiederbeschaffung"
                    Schadensaufstellung.SummeWiederbeschaffung
                
                Case "Restwert"
                    Schadensaufstellung.Restwert
                
                Case "Unfallhergang"
                    Schadensaufstellung.Unfallhergang
                
                Case "notizenrtf"
                    Austauschen.AkteNotizen
                
                Case "summekostenrechnungen"
                    Austauschen.SummeKostenrechnungen
                
                Case "GesamtsummeSchaden"
                    Schadensaufstellung.GesamtsummeSchaden
                
                Case "kr"
                    'Do nothing
                
                Case "krkanzleispzifisch"
                    KrKanzleispezifisch
                
                Case "vollstreckungsbescheid"
                    Vollstreckungsbescheid
                
                Case "rnr"
                    ret$ = String(255, " ")
                    X = WordExecute("SELECT knr FROM krsum WHERE dr = 1 AND nr = " + Anr$)
                    Knr$ = Left$(WordRequest(ret$), laenge)
        
                    If Knr$ = "" Then
                        X = WordExecute("SELECT max(knr) FROM krsum WHERE nr = " + Anr$)
                        ret$ = String(255, " ")
                        Knr$ = Left$(WordRequest(ret$), laenge)
                    End If
                    
                    If Val(Knr$) > 0 Then
                        X = WordExecute("select position1 FROM krlayout")
                        pos1$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("select position2 FROM krlayout")
                        pos2$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("select position3 FROM krlayout")
                        pos3$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("select position4 FROM krlayout")
                        pos4$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("select position5 FROM krlayout")
                        pos5$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("SELECT text1 FROM system WHERE art = 'datenpool'")
                        poolkuerzel$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("SELECT text6 FROM system WHERE art = 'rnr'")
                        freiertext$ = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("SELECT text5 FROM system WHERE art = 'rnr'")
                        strim$ = Left$(WordRequest(ret$), laenge)
                        If pos1$ = "Aktenzeichen" Or pos2$ = "Aktenzeichen" Or pos3$ = "Aktenzeichen" Or pos4$ = "Aktenzeichen" Or pos5$ = "Aktenzeichen" Then
                            X = WordExecute("select az FROM akten where nr = '" + Anr$ + "'")
                            If X <> 0 Then
                                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                                GoTo Ende
                            End If
                            Bez$ = Left$(WordRequest(ret$), laenge)
                        End If
                        
                        If pos1$ = "" And pos2$ = "" And pos3$ = "" And pos4$ = "" And pos5$ = "" Then
                            pos1$ = "laufende Nummer"
                        End If
                           
                        If Len(Knr$) > 6 Then
                            If pos1$ = "Jahr 4stellig" Then
                                pos1$ = Mid(Knr$, 1, 4)
                            ElseIf pos1$ = "Jahr 2stellig" Then
                                pos1$ = Mid(Knr$, 3, 2)
                            ElseIf pos1$ = "laufende Nummer" Then
                                pos1$ = Right(Knr$, Len(Knr$) - 4)
                                If strim$ = "1" Then
                                    pos1$ = Format(pos1$, "######")
                                End If
                            ElseIf pos1$ = "Datenpoolk|fffd|rzel" Then
                                pos1$ = poolkuerzel$
                            ElseIf pos1$ = "freier Text" Then
                                pos1$ = freiertext$
                            ElseIf pos1$ = "Aktenzeichen" Then
                                pos1$ = Bez$
                            End If
                            
                            If pos2$ = "Jahr 4stellig" Then
                                pos2$ = Mid(Knr$, 1, 4)
                            ElseIf pos2$ = "Jahr 2stellig" Then
                                pos2$ = Mid(Knr$, 3, 2)
                            ElseIf pos2$ = "laufende Nummer" Then
                                pos2$ = Right(Knr$, Len(Knr$) - 4)
                                If strim$ = "1" Then
                                    pos2$ = Format(pos2$, "######")
                                End If
                            ElseIf pos2$ = "Datenpoolk|fffd|rzel" Then
                                pos2$ = poolkuerzel$
                            ElseIf pos2$ = "freier Text" Then
                                pos2$ = freiertext$
                            ElseIf pos2$ = "Aktenzeichen" Then
                                pos2$ = Bez$
                            End If
                            
                            If pos3$ = "Jahr 4stellig" Then
                                pos3$ = Mid(Knr$, 1, 4)
                            ElseIf pos3$ = "Jahr 2stellig" Then
                                pos3$ = Mid(Knr$, 3, 2)
                            ElseIf pos3$ = "laufende Nummer" Then
                                pos3$ = Right(Knr$, Len(Knr$) - 4)
                                If strim$ = "1" Then
                                    pos3$ = Format(pos3$, "######")
                                End If
                            ElseIf pos3$ = "Datenpoolk|fffd|rzel" Then
                                pos3$ = poolkuerzel$
                            ElseIf pos3$ = "freier Text" Then
                                pos3$ = freiertext$
                            ElseIf pos3$ = "Aktenzeichen" Then
                                pos3$ = Bez$
                            End If
                            
                            If pos4$ = "Jahr 4stellig" Then
                                pos4$ = Mid(Knr$, 1, 4)
                            ElseIf pos4$ = "Jahr 2stellig" Then
                                pos4$ = Mid(Knr$, 3, 2)
                            ElseIf pos4$ = "laufende Nummer" Then
                                pos4$ = Right(Knr$, Len(Knr$) - 4)
                                If strim$ = "1" Then
                                    pos4$ = Format(pos4$, "######")
                                End If
                            ElseIf pos4$ = "Datenpoolk|fffd|rzel" Then
                                pos4$ = poolkuerzel$
                            ElseIf pos4$ = "freier Text" Then
                                pos4$ = freiertext$
                            ElseIf pos4$ = "Aktenzeichen" Then
                                pos4$ = Bez$
                            End If
                            
                            If pos5$ = "Jahr 4stellig" Then
                                pos5$ = Mid(Knr$, 1, 4)
                            ElseIf pos5$ = "Jahr 2stellig" Then
                                pos5$ = Mid(Knr$, 3, 2)
                            ElseIf pos5$ = "laufende Nummer" Then
                                pos5$ = Right(Knr$, Len(Knr$) - 4)
                                If strim$ = "1" Then
                                    pos5$ = Format(pos5$, "######")
                                End If
                            ElseIf pos5$ = "Datenpoolk|fffd|rzel" Then
                                pos5$ = poolkuerzel$
                            ElseIf pos5$ = "freier Text" Then
                                pos5$ = freiertext$
                            End If
                                    
                            erg$ = pos1$ + pos2$ + pos3$ + pos4$ + pos5$
                        Else
                            erg$ = Knr$
                        End If
                    Else
                        erg$ = " "
                    End If
                    
                    If IstAlternative = 0 Then
                        Selection.Font.ColorIndex = wdAuto
                    End If
                    
                    Selection.TypeText text:=erg$
               
                Case "zahlungshinweis"
                    ret$ = String(255, " ")
                    X = WordExecute("SELECT knr FROM kr WHERE dr = 1 AND nr = " + Anr$)
                    Knr$ = Left$(WordRequest(ret$), laenge)
        
                    If Knr$ = "" Then
                        X = WordExecute("SELECT max(knr) FROM krsum WHERE nr = " + Anr$)
                        ret$ = String(255, " ")
                        Knr$ = Left$(WordRequest(ret$), laenge)
                    End If
                    
                    If Val(Knr$) > 0 Then
                        X = WordExecute("SELECT betrag FROM kr WHERE text = 'insgesamt noch zu zahlen' and knr = " + Knr$)
                        erg$ = Left$(WordRequest(ret$), laenge)
                        erg$ = bib.wformat(bib.dbzahl(erg$))
                    Else
                        erg$ = " "
                    End If
                    
                    If IstAlternative = 0 Then
                        Selection.Font.ColorIndex = wdAuto
                    End If
                    Selection.TypeText text:=erg$
                
                Case "erschienene"
                    Beteiligte "erschienene"
                    
                Case "notarbez"
                    Call BezeichnungNotar
                    
                Case "AnlagenAuflistenKenntnisnahmezettel"
                    Call AnlagenAuflistenKenntnisnahmezettel
                
                Case "mbez", "MBEZ"
                    Selection.Delete
                    mbez.main GloabalFontSize
                
                Case "gbez", "GBEZ"
                    Selection.Delete
                    gbez.main GloabalFontSize
                Case "platzhalter.exe"
                    AustauschenEXE
                  Exit Sub 'dies muss hier stehen, damit diese Funktion nicht mehrfach aufgerufen wird.
                Case "leistungs|fffd|bersichtadvotime"
                    'do nothing
                Case "abgelegtvon"
                    AbgelegtVon
                Case "Basiszinssatz"
                    X = WordExecute("SELECT satz FROM basiszins order by datum desc ")
                    erg$ = Left$(WordRequest(ret$), laenge)
                    Selection.TypeText text:=bib.wformat$(Val2(erg$)) + "%"
                Case Else
                    WordBasic.EditClear
                    If Right(Betart$, 4) = ".exe" Then
                        Shell Betart$
                    Else
                        Application.Run (Betart$)
                    End If
            End Select
        End If
    
        If InStr(Selection.text, "|fffd|") > 1 Then
            X = InStr(Selection.text, "|fffd|")
            Y = InStr(X + 1, Selection.text, "|fffd|")
            Betart$ = Mid(Selection.text, X + 1, Y - X - 1)
            X = InStr(Selection.text, "KostenrechnungSmall")
             
            If Betart = "kr" Then
                Selection.Delete
                For Each bm In ActiveDocument.Bookmarks
                    If bm.Name = "kostenrechnung" Then
                        bm.Delete
                    End If
                Next
                
                Selection.Bookmarks.Add ("kostenrechnung")
                If X > 0 Then
                    Selection.Bookmarks.Add ("KostenrechnungSmall")
                Else
                    Selection.Bookmarks.Add ("kostenrechnung")
                End If
                Call Kr.main
            End If
        End If
EndWhile:
    Wend
    
    Selection.HomeKey Unit:=wdStory
    WordBasic.EditFind Find:="|fffd|AnredeGericht 1. Instanz|fffd|", Direction:=0, Wrap:=1
                        
    If WordBasic.EditFindFound() = -1 Then
        Selection.Extend
        Selection.Extend
        Selection.Extend
        Selection.Delete
    End If
    
    Selection.HomeKey Unit:=wdStory
    X = 1
    While X = 1
        X = 0   ' 06.04.2018 (os)
        WordBasic.EditFind Find:="|fffd|Briefanrede|fffd|", Direction:=0, Wrap:=1
        If WordBasic.EditFindFound() = -1 Then
            X = fBriefanrede
        End If
        WordBasic.EditFind Find:="|fffd|banrede|fffd|", Direction:=0, Wrap:=1
        If X = 0 And WordBasic.EditFindFound() = -1 Then
            X = fBriefanrede
        End If
        WordBasic.EditFind Find:="|fffd|Anschrift|fffd|", Direction:=0, Wrap:=1
        If X = 0 And WordBasic.EditFindFound() = -1 Then
            X = fAnschrift
        End If
        WordBasic.EditFind Find:="|fffd|Telefax|fffd|", Direction:=0, Wrap:=1
        If WordBasic.EditFindFound() = -1 Then
            fTelefax (0)
        End If
        WordBasic.EditFind Find:="|fffd|TelefaxPrivat|fffd|", Direction:=0, Wrap:=1
        If WordBasic.EditFindFound() = -1 Then
            fTelefax (1)
        End If
        WordBasic.EditFind Find:="|fffd|Telefon|fffd|", Direction:=0, Wrap:=1
        If WordBasic.EditFindFound() = -1 Then
            fTelefon (0)
        End If
        WordBasic.EditFind Find:="|fffd|TelefonPrivat|fffd|", Direction:=0, Wrap:=1
        If WordBasic.EditFindFound() = -1 Then
            fTelefon (1)
        End If
        WordBasic.EditFind Find:="|fffd|Betreff|fffd|", Direction:=0, Wrap:=1
        If X = 0 And WordBasic.EditFindFound() = -1 Then
            X = fBetreff
        End If
    Wend

    If WordBasic.ExistingBookmark("temp") Then
        WordBasic.EditBookmark Name:="temp", GoTo:=1
        WordBasic.EditBookmark Name:="temp", Delete:=1
    End If
    
    X = WordExecute("Commit")

    AnsichtLayoutAdvoware.main
End If

Advoware.SetActiveDoc

Ende:

X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungskonto") = ""

End Sub

Private Sub Beteiligte(kz$)
Dim Anr$
Dim count_
Dim ret$
Dim abfrage$
Dim X
Dim Anzahl$
ReDim erg__$(0)
ReDim betnr__$(0)
Dim i
Dim Schuldner$
Dim erg$
Dim Y
Dim l|fffd|nge As Integer
Dim forderungskonto$
ReDim bezeichnung$(100)
ReDim anrede$(100)
ReDim stellung$(100)
ReDim master$(100)
ReDim mitnr$(100)

ret$ = String(255, " ")
Anr$ = GetAnr(0)

If kz$ = "14" Or kz$ = "14a" Then
    If kz = "14" Then
        X = WordExecute("SELECT count(*) FROM betakt WHERE nr = " + Anr$ + " AND kz=1 and bet=14")
    Else
        X = WordExecute("SELECT count(*) FROM betakt WHERE nr = " + Anr$ + " AND kz=2 and bet=14")
    End If

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
    
        If kz$ = "14" Then
            abfrage$ = "select @trim(titel||' '||vorname||' '||b.name)||', geb. am '||@DATETOCHAR(gebdat, 'dd.mm.yyyy') FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND bet = 14 AND kz = 1 AND nr = " + Anr$ + " order by lfd"
        Else
            abfrage$ = "select @trim(titel||' '||vorname||' '||b.name)||', geb. am '||@DATETOCHAR(gebdat, 'dd.mm.yyyy') FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND bet = 14 AND kz = 2 AND nr = " + Anr$ + " order by lfd"
        End If
    
        X = WordExecute(abfrage$)

        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If

        For X = 0 To count_ - 1
            erg$ = Left$(WordRequest(ret$), laenge)
            erg$ = LTrim(erg$)
            
            If Left$(Right$(erg$, 3), 1) = "-" Then
                erg$ = Left$(erg$, Len(erg$) - 10) + Right$(erg$, 2) + "." + Left$(Right$(erg$, 5), 2) + "." + Left$(Right$(erg$, 10), 4)
            End If

            If IstAlternative = 0 Then
                Selection.Font.ColorIndex = wdAuto
            End If
            
            With Selection
                .TypeText text:=erg$
            End With

            If X < count_ - 1 Then
                With Selection
                    .TypeText text:=Chr(11)
                End With
            End If
        Next
    End If

ElseIf kz$ = "mv" Then
    MV (1)
ElseIf kz$ = "gv" Then
    GV (1)
ElseIf kz$ = "vm" Then
    MV (3)
ElseIf kz$ = "vg" Then
    GV (3)

ElseIf kz$ = "xx" Then ' ????
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If
    
    X = WordExecute("select count(*) FROM betakt WHERE kz = 1 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret$ = String(255, " ")
    count_ = Left(WordRequest(ret$), laenge)
    abfrage = "select ebene||@if(@isna(bt.stellung),bt.art,betakt.stellung)||': '||@trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||plz||' '||ort from betakt bt,beteiligte b,adresse a where a.betnr=bt.betnr and adnr=1 and bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz=1 order by lfd"
    
    X = WordExecute(abfrage)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    
    For i = 0 To count_ - 1
        Selection.TypeText Mid(ret$, 2)
        Selection.TypeParagraph
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
    Next

ElseIf kz$ = "mu2" Then
    ' NICHT L|fffd|SCHEN
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 1 and bet is not null and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret$ = String(255, " ")
    count_ = Left(WordRequest(ret$), laenge)
    abfrage = "select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||plz||' '||ort from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz=1 and bet is not null order by lfd"
    
    X = WordExecute(abfrage)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    
    For i = 0 To count_ - 1
        Selection.TypeText ret$
        Selection.TypeParagraph
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
    Next
ElseIf kz$ = "mu" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 1 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            mitnr(i) = Mid(ret$, 1, Y)
            master(i) = Mid(ret$, Y + 2, 8)
        End If
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
           Y = InStr(1, ret$, "#") - 1
           stellung(i) = Mid(ret$, 1, Y)
        End If
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If Len(ret$) > 1 Then
                Y = InStr(1, ret$, "#") - 1
                bezeichnung(i) = Mid(ret$, 1, Y)
            End If
        End If
    Next
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(bezeichnung(i)) > 1 Then
            Selection.TypeText bezeichnung(i) + Mid(ret$, 2)
        Else
            Selection.TypeText stellung(i) + Mid(ret$, 2)
        End If
        Selection.TypeParagraph
    Next
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
ElseIf kz$ = "gu" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 2 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            mitnr(i) = Mid(ret$, 1, Y)
            master(i) = Mid(ret$, Y + 2, 8)
        End If
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            stellung(i) = Mid(ret$, 1, Y)
        End If
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If Len(ret$) > 1 Then
                Y = InStr(1, ret$, "#") - 1
                bezeichnung(i) = Mid(ret$, 1, Y)
            End If
        End If
    Next
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(bezeichnung(i)) > 1 Then
            Selection.TypeText bezeichnung(i) + Mid(ret$, 2)
        Else
            Selection.TypeText stellung(i) + Mid(ret$, 2)
        End If
        Selection.TypeParagraph
    Next
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    

ElseIf kz$ = "mf" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 1 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            mitnr(i) = Mid(ret$, 1, Y)
            master(i) = Mid(ret$, Y + 2, 8)
        End If
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            stellung(i) = Mid(ret$, 1, Y)
        End If
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If Len(ret$) > 1 Then
                Y = InStr(1, ret$, "#") - 1
                bezeichnung(i) = Mid(ret$, 1, Y)
            End If
        End If
    Next
    
    For i = 0 To count_ - 1
        abfrage = "select anrede||'#' from beteiligte where betnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If Len(ret$) > 1 Then
                Y = InStr(1, ret$, "#") - 1
                anrede(i) = Mid(ret$, 1, Y)
            End If
        End If
    Next
    
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||' '||@if(@isna( gebdat ), '', '('||@datetochar ( gebdat, 'dd.mm.yyyy' )||')') from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        X = InStr(1, ret$, "Ehe")
        If (stellung(i) = "Mandant" And X > 0) Or bezeichnung(i) = "Ehemann" Or bezeichnung(i) = "Ehefrau" Then
            If Len(bezeichnung(i)) > 1 Then
                Selection.TypeText bezeichnung(i) + " " + Mid(ret$, 2)
            Else
                Selection.TypeText stellung(i) + " " + Mid(ret$, 2)
            End If
            Selection.TypeParagraph
        End If
    Next
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
ElseIf kz$ = "gf" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 2 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            mitnr(i) = Mid(ret$, 1, Y)
            master(i) = Mid(ret$, Y + 2, 8)
        End If
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If Len(ret$) > 1 Then
            Y = InStr(1, ret$, "#") - 1
            stellung(i) = Mid(ret$, 1, Y)
        End If
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If Len(ret$) > 1 Then
                Y = InStr(1, ret$, "#") - 1
                bezeichnung(i) = Mid(ret$, 1, Y)
            End If
        End If
    Next
    
    For i = 0 To count_ - 1
        abfrage = "select anrede||'#' from beteiligte where betnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If Len(ret$) > 1 Then
                Y = InStr(1, ret$, "#") - 1
                anrede(i) = Mid(ret$, 1, Y)
            End If
        End If
    Next
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||' '||@if(@isna( gebdat ), '', '('||@datetochar ( gebdat, 'dd.mm.yyyy' )||')') from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    Y = 1
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        X = InStr(1, ret$, "Ehe") + InStr(1, anrede(i), "Ehe")
        If (stellung(i) = "Gegner" And X > 0) Or bezeichnung(i) = "Ehemann" Or bezeichnung(i) = "Ehefrau" Then
            If Len(bezeichnung(i)) > 1 Then
                Selection.TypeText bezeichnung(i) + " " + Mid(ret$, 2)
            Else
                Selection.TypeText stellung(i) + " " + Mid(ret$, 2)
            End If
            Selection.TypeParagraph
            Y = 0
        End If
    Next
    If Y = 1 Then
            Selection.Delete
    End If
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
ElseIf kz$ = "gk" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 2 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        Y = InStr(1, ret$, "#") - 1
        mitnr(i) = Mid(ret$, 1, Y)
        master(i) = Mid(ret$, Y + 2, 8)
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        Y = InStr(1, ret$, "#") - 1
        stellung(i) = Mid(ret$, 1, Y)
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            Y = InStr(1, ret$, "#") - 1
            If Y > 0 Then bezeichnung(i) = Mid(ret$, 1, Y)
        End If
    Next
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||' '||@if(@isna( gebdat ), '', '('||@datetochar ( gebdat, 'dd.mm.yyyy' )||')') from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    Y = 1
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If InStr(1, bezeichnung(i), "Kind") > 0 Or InStr(1, stellung(i), "Kind") > 0 Then
            If Len(bezeichnung(i)) > 1 Then
                Selection.TypeText bezeichnung(i) + " " + Mid(ret$, 2)
            Else
                Selection.TypeText stellung(i) + " " + Mid(ret$, 2)
            End If
            Y = 0
            Selection.TypeParagraph
        End If
    Next
    If Y = 1 Then
            Selection.Delete
    End If
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
ElseIf kz$ = "km" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 1 and betakt.master is not null and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 1 and bt.master is not null order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        Y = InStr(1, ret$, "#") - 1
        mitnr(i) = Mid(ret$, 1, Y)
        master(i) = Mid(ret$, Y + 2, 8)
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        Y = InStr(1, ret$, "#") - 1
        stellung(i) = Mid(ret$, 1, Y)
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X <> 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            Y = InStr(1, ret$, "#") - 1
            If Y > 0 Then bezeichnung(i) = Mid(ret$, 1, Y)
        End If
    Next
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||' '||@if(@isna( gebdat ), '', '('||@datetochar ( gebdat, 'dd.mm.yyyy' )||')') from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 1 order by lfd"
    X = WordExecute(abfrage)
    Y = 1
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If InStr(1, bezeichnung(i), "Kind") > 0 Or InStr(1, stellung(i), "Kind") > 0 Then
            If Len(bezeichnung(i)) > 1 Then
                Selection.TypeText bezeichnung(i) + " " + Mid(ret$, 2)
            Else
                Selection.TypeText stellung(i) + " " + Mid(ret$, 2)
            End If
            Selection.TypeParagraph
            Y = 0
        End If
    Next
    If Y = 1 Then
        Selection.Delete
    End If
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
ElseIf kz$ = "gf" Then
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If

    X = WordExecute("select count(*) FROM betakt WHERE kz = 2 and nr = " + Anr$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    count_ = String(255, " ")
    count_ = Left(WordRequest(count_), laenge)
    
    abfrage = "select bt.betnr || '#' || master from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        Y = InStr(1, ret$, "#") - 1
        mitnr(i) = Mid(ret$, 1, Y)
        master(i) = Mid(ret$, Y + 2, 8)
    Next
    
    abfrage = "select @if(@isna(betakt.stellung),betakt.art,betakt.stellung)||'#' from betakt where nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        Y = InStr(1, ret$, "#") - 1
        stellung(i) = Mid(ret$, 1, Y)
    Next
        
    For i = 0 To count_ - 1
        abfrage = "select bezeichnung||'#' from f_mitarbeiter where betnr = " + master(i) + " and mitnr = " + mitnr(i)
        X = WordExecute(abfrage)
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            Y = InStr(1, ret$, "#") - 1
            bezeichnung(i) = Mid(ret$, 1, Y)
        End If
    Next
    
    abfrage = "select ebene||': '||titel||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||' '||@if(@isna( gebdat ), '', '('||@datetochar ( gebdat, 'dd.mm.yyyy' )||')') from betakt bt,beteiligte b,adresse a where bt.betnr=a.betnr and bt.betnr=b.betnr and adnr=1 and nr = " + Anr$ + " and kz = 2 order by lfd"
    X = WordExecute(abfrage)
    Y = 1
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        If stellung(i) = "Gegner" Or bezeichnung(i) = "Ehemann" Or bezeichnung(i) = "Ehefrau" Then
            If Len(bezeichnung(i)) > 1 Then
                Selection.TypeText bezeichnung(i) + " " + Mid(ret$, 2)
            Else
                Selection.TypeText stellung(i) + " " + Mid(ret$, 2)
            End If
            Selection.TypeParagraph
            Y = 0
        End If
    Next
    If Y = 1 Then
        Selection.Delete
    End If
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    

ElseIf kz$ = "0" Then
    Anzahl$ = "Select count(*) FROM betakt WHERE bet Is null And nr = " + Anr$
    X = WordExecute(Anzahl$)

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
        ReDim erg__$(count_)
        ReDim betnr__$(count_)

        X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||@if(@length(gebname), ' (geb. '||gebname||'), ', ', ')||strasse||', '||plz||' '||ort||', geb. am '||@datetochar (gebdat, 'dd.mm.yyyy')||' in '||geburtsort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr=bt.betnr AND b.betnr=bt.betnr and adnr=1 AND bet is null AND nr = " & Anr$ + " order by lfd")

        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If

        For i = 0 To count_ - 1
            ret$ = String(255, " ")
            erg__$(i) = Left$(WordRequest(ret$), laenge)
        Next i

        For i = 0 To count_ - 1
            If IstAlternative = 0 Then
                Selection.Font.ColorIndex = wdAuto
            End If
            With Selection
                .TypeText text:=erg__$(i)
            End With
            
            With Selection
                .TypeText text:=Chr(13)
            End With

            If X < count_ - 1 Then
                With Selection
                    .TypeText text:=Chr(13)
                End With
            End If
        Next i
        
    Else
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "advoware kann keinen Aktenbeteiligten ermitteln!", vbExclamation, GetApplicationName()
    End If

ElseIf kz$ = "erschienene" Then
    Anzahl$ = "Select count(*) FROM betakt bt, betins bs WHERE erschienene = '1' AND (bt.bet = bs.kz and ug='1' or bt.kz = bs.kz and (ug is null or ug='0')) AND nr = " + Anr$
    X = WordExecute(Anzahl$)

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
        ReDim erg__$(count_)
        ReDim betnr__$(count_)

        abfrage$ = "select @trim(anrede)||@if(@length(@trim(anrede)), ' ', '')||@trim(titel||' '||vorname||' '||b.name)||" + _
                    "@if(@length(gebname), ' (geb. '||gebname||')', '')||" + _
                    "@if(@isna(gebdat),'',', geb. am ')||@datetochar (gebdat, 'dd.mm.yyyy')||@if(@isna(geburtsort),'',' in '||geburtsort) ||" + _
                    "', '||strasse||', '||plz||' '||ort " + _
                "FROM beteiligte b, betakt bt, betins bs,adresse a " + _
                "WHERE  erschienene = '1' and a.betnr = bt.betnr and b.betnr = bt.betnr and adnr=1 AND " + _
                    "(bt.bet = bs.kz and ug='1' or bt.kz = bs.kz and (ug is null or ug='0')) AND nr = " & Anr$ + _
        " order by lfd"
        X = WordExecute(abfrage$)
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If

        For i = 0 To count_ - 1
            ret$ = String(255, " ")
            erg__$(i) = Left$(WordRequest(ret$), laenge)
        Next i

        For i = 0 To count_ - 1
            If IstAlternative = 0 Then
                Selection.Font.ColorIndex = wdAuto
            End If
            With Selection
                .TypeText text:=Trim$(Str$(i + 1)) + "." + Chr(13)
                If Left$(erg__$(i), 5) = "Herrn" Then
                    .TypeText text:="Herr" + Right(erg__$(i), Len(erg__$(i)) - 5)
                Else
                    .TypeText text:=erg__$(i)
                End If
                
            End With
            
            With Selection
                .TypeText text:=Chr(13)
            End With

            If X < count_ - 1 Then
                With Selection
                    .TypeText text:=Chr(13)
                End With
            End If
        Next i
        
    Else
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "advoware kann keinen Aktenbeteiligten ermitteln!", vbExclamation, GetApplicationName()
    End If

ElseIf kz$ = "5" Then   ' Gegenanwalt
    X = WordExecute("select @trim(titel||' '||bt.name)||', '||strasse||', '||plz||' '||ort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr=bt.betnr AND b.betnr=bt.betnr AND ((bet is null AND kz = " + kz$ + ") or (kz=2 and bet=" + kz$ + ")) and adnr=1 AND nr = " + Anr$ + " order by lfd")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    erg$ = Left$(WordRequest(ret$), laenge)
    erg$ = LTrim(erg$)
    
    If RTrim$(erg$) <> "" Then
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        Selection.TypeText text:=erg$
'        Selection.TypeParagraph
    Else
        Selection.Delete
    End If
Else
    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||plz||' '||ort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr=bt.betnr AND b.betnr=bt.betnr and adnr=1 AND bet is null AND kz = " + kz$ + " AND nr = " + Anr$ + " order by lfd")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    erg$ = Left$(WordRequest(ret$), laenge)
    erg$ = LTrim(erg$)
    
    If RTrim$(erg$) <> "" Then
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
    End If

    With Selection
        .TypeText text:=erg$
    End With
End If

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungskonto") = ""
End Sub


Private Sub vertreter(kz$, bet$, Dummy, nArt, nRang)
Dim Anr$
Dim abfrage$
Dim X
Dim countv
Dim ret$
ReDim betnrv__$(0)
ReDim vertreter___$(0)
Dim i
Dim stellung$
Dim countvv
Dim j
Dim sText$

ret$ = String(255, " ")
On Error GoTo Ende

Anr$ = GetAnr(1)
'If kZ$ = 6 Or kZ = 7 Then
'End If
abfrage$ = "SELECT count(*) FROM betakt WHERE nr = " + Anr$ + " AND bet = 3 AND ebene > 1 and kz = " + kz$ & " And master = " + bet$
If nArt = 4 Then
    abfrage$ = "select count(*) FROM f_mitarbeiter f, betakt t WHERE bet Is null And t.betnr = f.betnr And kz = 1 And nr = " + Anr$
End If
X = WordExecute(abfrage$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

countv = bib.Val2(Left$(WordRequest(ret$), laenge))

If countv Then
    ReDim betnrv__$(countv)
    ReDim vertreter___$(countv)
    If nArt = 4 Then
        abfrage$ = "select mitnr FROM f_mitarbeiter f, betakt t WHERE bet Is null And t.betnr = f.betnr And kz = 1 And nr = " + Anr$
    Else
        abfrage$ = "SELECT betnr FROM betakt WHERE nr = " + Anr$ + " AND bet = 3 and ebene >1 and kz = " + kz$ & " And master = " + bet$
    End If
    X = WordExecute(abfrage$)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    For i = 0 To countv - 1
        betnrv__$(i) = Left$(WordRequest(ret$), laenge)
    Next i

    For i = 0 To countv - 1
        If nArt = 1 Or nArt = 3 Or nArt = 5 Then
            X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name)||@if(@isna(strasse),'',', ')||strasse||@if(@isna(plz),'',', ')||plz||@if(@isna(ort),'',' ')||ort FROM beteiligte b,adresse a WHERE a.betnr=b.betnr and adnr=1 AND b.betnr = " + betnrv__$(i))
        ElseIf nArt = 2 Then
            X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name) FROM beteiligte WHERE betnr = " + betnrv__$(i))
        ElseIf nArt = 4 Then
            X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name)||' '||@if(@isna( gebdat ), '', '('||@datetochar ( gebdat, 'dd.mm.yyyy' )||')') FROM beteiligte WHERE betnr = " + betnrv__$(i))
        ElseIf nArt = 6 Then
            X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name)||@if(@isna( gebdat ), '', ' (*'||@datetochar ( gebdat, 'dd.mm.yyyy' )||')')||@if(@isna(strasse),'',', ')||strasse||@if(@isna(plz),'',', ')||plz||@if(@isna(ort),'',' ')||ort||@if(@isna( land ), '', ' ('||land||')') FROM beteiligte b,adresse a WHERE a.betnr=b.betnr and adnr=1 AND b.betnr = " + betnrv__$(i))
        End If
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If

        vertreter___$(i) = Left$(WordRequest(ret$), laenge)

        vertreter___$(i) = LTrim(vertreter___$(i))
        If nArt = 4 Then
            abfrage$ = "select bezeichnung FROM f_mitarbeiter WHERE mitnr = " + betnrv__$(i)
        Else
            abfrage$ = "SELECT stellung FROM betakt WHERE nr = " + Anr$ + " AND betnr = " + betnrv__$(i)
        End If
        X = WordExecute(abfrage$)

        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        stellung$ = Left$(WordRequest(ret$), laenge)
        If Not (nArt = 4 And Not (InStr(1, stellung$, "Ehemann") > 0 Or InStr(1, stellung$, "Ehefrau") > 0)) Then
            
        
        If Dummy = 1 Then
        
            
            If nArt <> 5 Then
                Selection.TypeParagraph
            End If
            
            If nArt = 1 Or nArt = 2 Then
                Selection.TypeText text:="   -  vertreten durch " + vertreter___$(i)
            ElseIf nArt = 3 Then
                sText$ = " - " & vertreter___$(i)
            ElseIf nArt = 4 Then
                Selection.TypeText text:="   -  " + vertreter___$(i)
            ElseIf nArt = 5 Then
                Selection.TypeText text:=", vertr. durch " + vertreter___$(i)
            End If
            
        Else
            If IstAlternative = 0 Then
                Selection.Font.ColorIndex = wdAuto
            End If
            If i > 0 Then
                Selection.TypeParagraph
            End If
            With Selection
                .TypeText text:=vertreter___$(i)
            End With
        End If

'    auf vielfachen Kundenwunsch auskommentiert:
'        If RTrim$(stellung$) <> "" Then
'            If nArt = 1 Or nArt = 2 Or nArt = 4 Then
'                Selection.TypeText text:=" (" + stellung$ + ")"
'            ElseIf nArt = 3 Then
'                Selection.TypeText stellung & " zu " & Str(nRang) & ".)"
'                Selection.TypeParagraph
'                Selection.TypeText sText$
'            End If
'        End If

        X = WordExecute("SELECT count(*) FROM betakt WHERE nr = " + Anr$ + " AND bet = 3 AND master = " + betnrv__$(i))

        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If

        countvv = bib.Val2(Left$(WordRequest(ret$), laenge))

        ReDim betnrvv__$(countvv)
        ReDim vertreterv__$(countvv)
        
        X = WordExecute("SELECT betnr FROM betakt WHERE nr = " + Anr$ + " AND bet = 3 AND master = " + betnrv__$(i))

        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If

        For j = 0 To countvv - 1
            betnrvv__$(j) = Left$(WordRequest(ret$), laenge)
        Next j
        For j = 0 To countvv - 1
            If nArt = 1 Or nArt = 3 Or nArt = 5 Then
                X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name)||@if(@isna(strasse),'',', ')||strasse||@if(@isna(plz),'',', ')||plz||@if(@isna(ort),'',' ')||ort FROM beteiligte b,adresse a WHERE a.betnr=b.betnr and adnr=1 AND b.betnr = " + betnrvv__$(j))
            ElseIf nArt = 2 Then
                X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name) FROM beteiligte WHERE betnr = " + betnrvv__$(j))
            ElseIf nArt = 6 Then
                X = WordExecute("SELECT anrede||@if(@isna(anrede),'',' ')||@trim(titel||' '||vorname||' '||name)||@if(@isna( gebdat ), '', ' (*'||@datetochar ( gebdat, 'dd.mm.yyyy' )||')')||@if(@isna(strasse),'',', ')||strasse||@if(@isna(plz),'',', ')||plz||@if(@isna(ort),'',' ')||ort||@if(@isna( land ), '', ' ('||land||')') FROM beteiligte b,adresse a WHERE a.betnr=b.betnr and adnr=1 AND b.betnr = " + betnrvv__$(j))

            End If

            vertreterv__$(j) = Left$(WordRequest(ret$), laenge)
            vertreterv__$(j) = LTrim(vertreterv__$(j))
            
            If Dummy = 1 Then
                If nArt <> 5 Then
                    Selection.TypeParagraph
                End If
                If nArt = 1 Or nArt = 2 Then
                    Selection.TypeText text:="   -  d. vertreten durch " + vertreterv__$(j)
                ElseIf nArt = 3 Then
                    sText$ = " - " & vertreterv__$(j)
                ElseIf nArt = 5 Then
                    Selection.TypeText text:=", d. vertr. durch " + vertreterv__$(j)
                End If
            Else
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                
                If nArt = 1 Or nArt = 2 Then
                    Selection.TypeText text:=", d. vertreten durch " + vertreterv__$(j)
                Else
                    sText$ = ", d. vertreten durch " + vertreterv__$(j)
                End If
            End If

            X = WordExecute("SELECT stellung FROM betakt WHERE nr = " + Anr$ + " AND betnr = " + betnrvv__$(j))

            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If

            stellung$ = Left$(WordRequest(ret$), laenge)

            If RTrim$(stellung$) <> "" Then
                If nArt = 1 Or nArt = 2 Then
                    Selection.TypeText text:=" (" + stellung$ + ")"
                ElseIf nArt = 3 Or nArt = 4 Then
                    Selection.TypeText stellung & " zu " & Str(nRang) & ".)"
                    Selection.TypeParagraph
                    Selection.TypeText sText$
                ElseIf nArt = 6 Then
                    Selection.TypeParagraph
                    Selection.TypeText sText$
                End If
           End If
        Next j
        End If
    Next i
    
End If

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
bet$ = ""

End Sub

Sub AkteNotizen()


Dim Annotationspath As String
Dim Akte As String
Dim X As Integer
Dim ret$
Dim fs As FileSearch
Dim l|fffd|nge As Long
Dim Temppath$
Dim erg$
Dim rt As TextBox
Dim i As Long
On Error GoTo Ende
Dim Bereich As Range

Akte$ = GetAnr(1)
ret$ = String(255, " ")
X = WordExecute("select datei from anmerkungen where kz=2 and nr=" & Akte)
Annotationspath = Left(WordRequest(ret$), laenge)
If Len(Annotationspath) > 1 Then
    Set fs = Application.FileSearch
    With fs
        .FileName = Annotationspath
        .Execute
        If .FoundFiles.count > 0 Then
            Selection.InsertFile FileName:=Annotationspath, Range:="", ConfirmConversions:= _
                    False, Link:=False, Attachment:=False
        Else
           Selection.Delete
        End If
    End With
Else

    If Len(erg$) = 0 Then
        i = 0
        Temppath$ = GetProgramdir & "\temp\$anmerkung" + Akte & "_" & i & ".tmp"
        ret$ = Dir(Temppath$)
        While ret$ <> ""
            i = i + 1
            Temppath$ = GetProgramdir & "\temp\$anmerkung" + Akte & "_" & i & ".tmp"
            ret = Dir(Temppath$)
        Wend
        
        
        X = WordExecute("select file FROM anmerkungen where kz=2 and nr=" & Akte)
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        ret$ = String(255, " ")
        erg$ = WordRequest(ret$)
        ret$ = String(2001, " ")
        WordRequestLongVarCharToFile (Temppath$)
        WordExecute ("commit")
       
        Set Bereich = Selection.Range
       
        Selection.InsertFile FileName:=Temppath$, Range:="", ConfirmConversions:= _
                False, Link:=False, Attachment:=False
        
        Bereich.SetRange Bereich.Start, Selection.Range.Start
        Bereich.Select
        Selection.style = ActiveDocument.Styles("Standard")
        Kill (Temppath$)
        
    Else
        Selection.Delete
    End If
End If

Ende:

WordExecute ("commit")
End Sub

Sub fDatum()

Dim Annotationspath As String
Dim Akte As String
Dim X As Integer
Dim fs As FileSearch

Annotationspath = GetProgramdir
If Left(Annotationspath, 1) <> "\" Then Annotationspath = Annotationspath + "\"
Annotationspath = Annotationspath + "Annotations"
Akte$ = GetAnr(1)

Set fs = Application.FileSearch
With fs
    .LookIn = Annotationspath
    .FileName = Akte & "*.rtf"
    If .Execute() > 0 Then
        Selection.InsertFile FileName:=Annotationspath & "\" & Akte & ".rtf", Range:="", ConfirmConversions:= _
                False, Link:=False, Attachment:=False
    Else
       Selection.Delete
    End If
End With

End Sub

Sub SummeKostenrechnungen()
Dim SummeKr As Currency
Dim aVar As Variable

For Each aVar In ActiveDocument.Variables
    If Left(aVar.Name, 5) = "Summe" Then
        SummeKr = SummeKr + aVar.Value
    End If
Next aVar

Selection.Font.ColorIndex = wdAuto

Selection.TypeText bib.wformat$(SummeKr)

End Sub

Sub KrKanzleispezifisch()

End Sub

Private Sub Vollstreckungsbescheid()
Dim X As Integer
Dim ret$
Dim Datum$
Dim Betrag$
Dim Anzahl As Integer
Dim i As Integer
Dim Anr$

Anr$ = GetAnr(1)

X = WordExecute("select count(*) from buchungen where betrag>0 and fknr is not null and nr= " & Anr$ & " order by datum")
If X <> 0 Then
    WordExecute ("commit")
    MsgBox ("Wordexecute-Fehler " & X)
    GoTo Ende
End If

ret$ = String(255, " ")

Anzahl = Val(Left(WordRequest(ret$), laenge))

X = WordExecute("select datum||'|fffd|'||betrag from buchungen where betrag>0 and fknr is not null and nr=" & Anr$ & " order by datum")
If X <> 0 Then
    WordExecute ("commit")
    MsgBox ("Wordexecute-Fehler " & X)
    GoTo Ende
End If

If IstAlternative = 0 Then
    Selection.Font.ColorIndex = wdAuto
End If

For i = 1 To Anzahl
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Datum$ = Left(ret$, InStr(1, ret$, "|fffd|") - 1)
    Betrag$ = Mid(ret$, InStr(1, ret$, "|fffd|") + 1)
    Datum$ = bib.gdat(Datum$)
    Betrag$ = bib.wformat(bib.dbzahl(Betrag$))
    Selection.TypeText (Datum & vbTab & Betrag & " |fffd|")
    Selection.TypeParagraph
    Selection.TypeText text:=vbTab
Next i

Ende:
WordExecute ("commit")
End Sub

Sub TabelleForderungen()
TabelleForderungenAlle 0
End Sub

Sub TabelleForderungenNurForderungen()
TabelleForderungenAlle 1
End Sub

Sub TabelleForderungenAlle(nArt As Long)
Dim Anr$
Dim abfrage$
Dim text$
Dim Forderungsdatum$
Dim Zinsbeginn$
Dim Zinssatz$
Dim Betrag$
Dim ret$
Dim X As Integer
Dim i As Integer
Dim Anzahl As Integer
Dim bBasiszins As Boolean

On Error GoTo Ende


Anr$ = GetAnr(1)

ActiveDocument.Tables.Add Range:=Selection.Range, NumRows:=1, NumColumns:=6

Selection.Tables(1).Columns(1).SetWidth ColumnWidth:=120, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(2).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(3).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(4).SetWidth ColumnWidth:=50, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(5).SetWidth ColumnWidth:=55, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(6).SetWidth ColumnWidth:=60, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Borders(wdBorderLeft).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderRight).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderTop).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderBottom).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderVertical).LineStyle = wdLineStyleNone

Selection.Font.Bold = 1

Selection.TypeText "Forderungstext"
Selection.MoveRight Unit:=wdCell
Selection.Font.Bold = 1
Selection.TypeText "Ford.-Datum"
Selection.MoveRight Unit:=wdCell
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Font.Bold = 1
Selection.TypeText "Zinsbeginn"
Selection.MoveRight Unit:=wdCell
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Font.Bold = 1
Selection.TypeText "Zinssatz"
Selection.MoveRight Unit:=wdCell
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Font.Bold = 1
Selection.TypeText "Basiszins"
Selection.MoveRight Unit:=wdCell
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Font.Bold = 1
Selection.TypeText "Betrag"

abfrage = "select count(*) from forderungen where nr=" & Anr
If nArt = 1 Then
    abfrage = abfrage & " and art='Forderung'"
End If
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)

abfrage = "select text||'|fffd|'||bdatum||'|fffd|'||zbeginn||'|fffd|'||zins*100||'|fffd|'||betrag from forderungen where nr=" & Anr

If nArt = 1 Then
    abfrage = abfrage & " and art='Forderung'"
End If

abfrage = abfrage & " order by art,bdatum,fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    bBasiszins = False
    Selection.MoveRight Unit:=wdCell
    Selection.Tables(1).Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Font.Bold = 0
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    text$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Forderungsdatum$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Zinsbeginn$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Zinssatz = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Betrag = ret$
    
    Selection.TypeText text$
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    
    If Forderungsdatum$ <> "" Then
        Selection.TypeText bib.gdat(Forderungsdatum$)
    End If
    
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    
    If Zinsbeginn$ <> "" Then
        Selection.TypeText bib.gdat(Zinsbeginn$)
    End If
    
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    
    If Zinssatz <> "" Then
        If Zinssatz < 0 Then
            bBasiszins = True
            Zinssatz = Zinssatz * -0.01     'Microsoft-VBA-Katastophe: Wenn ein Punkt als Dezimaltrennzeichen in einem
                                            'String vorkommt, wird der Punkt einfach ignoriert (7.50 * 1 = 750)
                                            'dehalb muss der Zinssatz mit dem Faktor 100 ausgelesen werden, damit kein
                                            'Dezimaltrennzeichen vorkommt
        Else
            Zinssatz = Zinssatz * 0.01
        End If
        Selection.TypeText bib.wformat(bib.dbzahl(Zinssatz$))
    End If
    
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    
    If Zinssatz <> "" Then
        If bBasiszins = True Then
            Selection.TypeText "ja"
        Else
            Selection.TypeText "nein"
        End If
    End If
    
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    
   
    Selection.TypeText bib.wformat(bib.dbzahl(Betrag$)) & " |fffd|"
Next

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub Forderungstexte()
Dim abfrage$
Dim ret$
Dim Anr$
Dim X, i, Anzahl As Integer
On Error GoTo Ende

Anr$ = GetAnr(1)

abfrage = "select count(*) from forderungen where nr=" & Anr & " and art='Forderung'"
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select text from forderungen where nr=" & Anr & " and art='Forderung' order by fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Selection.TypeText ret$ & "; "
Next
Selection.TypeBackspace
Selection.TypeBackspace
Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub Vertragsgegenstand()
Dim abfrage$
Dim ret$
Dim Anr$
Dim X, i, Anzahl As Integer
On Error GoTo Ende

Anr$ = GetAnr(1)

abfrage = "select count(distinct vertragsgegenstand) from forderungen where nr=" & Anr & " and vertragsgegenstand is not null"
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select distinct vertragsgegenstand from forderungen where nr=" & Anr & " and vertragsgegenstand is not null order by vertragsdatum,fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Selection.TypeText ret$ & "; "
Next
Selection.TypeBackspace
Selection.TypeBackspace
Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub Vertragsdatum()
Dim abfrage$
Dim ret$
Dim Anr$
Dim X, i, Anzahl As Integer
On Error GoTo Ende

Anr$ = GetAnr(1)

abfrage = "select count(distinct vertragsdatum) from forderungen where nr=" & Anr & " and vertragsgegenstand is not null"
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select distinct vertragsdatum from forderungen where nr=" & Anr & " and vertragsgegenstand is not null order by vertragsdatum,fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Selection.TypeText bib.gdat(ret$) & "; "
Next
Selection.TypeBackspace
Selection.TypeBackspace
Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub VertragsGegenstandVertragsdatum()
Dim abfrage$
Dim ret$
Dim Anr$
Dim X, i, Anzahl As Integer
On Error GoTo Ende

Anr$ = GetAnr(1)

abfrage = "select count(distinct vertragsdatum) from forderungen where nr=" & Anr & " and vertragsgegenstand is not null"
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select distinct vertragsgegenstand ||' vom ' || @DATETOCHAR(vertragsdatum,'dd.mm.yyyy') from forderungen where nr=" & Anr & " and vertragsgegenstand is not null order by vertragsdatum,fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Selection.TypeText ret$ & "; "
Next
Selection.TypeBackspace
Selection.TypeBackspace
Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub


Sub Forderungsdaten()
Dim abfrage$
Dim ret$
Dim Anr$
Dim X, i, Anzahl As Integer
On Error GoTo Ende

Anr$ = GetAnr(1)

'abfrage = "select count(*) from forderungen where nr=" & Anr & " and fknr=0 and art='Forderung' "
abfrage = "select count(*) from forderungen where nr=" & Anr & " and art='Forderung' " ' Forderungskonto darf nicht ber|fffd|cksichtigt werdeen (wie bei den Forderuingstexten) (mp)
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select bdatum  from forderungen where nr=" & Anr & " and art='Forderung' order by fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Selection.TypeText bib.gdat(ret$) & "; "
Next
Selection.TypeBackspace
Selection.TypeBackspace
Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub forderungsaufstellung()
Dim Datei$, Database$
Dim n As Long
Database$ = GetDatabase()
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungsaufstellungrtfpfad") = ""

System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Anr") = GetAnr(1)

fSendMessageAdvoware 13, 0
'DoEvents

Datei$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungsaufstellungrtfpfad")
While Datei = "" And n < 1000
    Datei$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungsaufstellungrtfpfad")
    n = n + 1
  
    Sleep (100)
Wend
If Datei <> "" Then
    Selection.InsertFile Datei$
    Kill Datei
End If


End Sub


Sub forderungsaufstellungverk|fffd|rzt()
Dim Datei$, Database$
Dim n As Long
Dim App$

Database$ = GetDatabase()
If fKeineforderungsaufstellung("faufstatus") = 0 Then
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungsaufstellungrtfpfad") = ""
    
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Anr") = GetAnr(1)
    
    App$ = GetApplicationName()
    
    'Darf nicht aufgerufen werden, weil dann die Ansicht in advoware aktualisiert wird 20.08.2019 mp:
    'WordBasic.AppSendMessage App$, 16384 + 3, CLng(System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Anr")), 101
    fSendMessageAdvoware 12, 0
    Datei$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungsaufstellungrtfpfad")
    While Datei = "" And n < 1000
        Datei$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungsaufstellungrtfpfad")
        n = n + 1
      
        Sleep (100)
    Wend
    If Datei <> "" Then
        Selection.InsertFile Datei$
        Kill Datei
    End If
End If

End Sub



Sub tx(tage$)
Dim t As Date
Dim neues_datum As String

t = Date + tage$
'neues_datum = Format(t, "dd.MM.yyyy")
'neues_datum = Format(t, "yyyy")
If IstAlternative = 0 Then
    Selection.Font.ColorIndex = wdAuto
End If
Selection.TypeText t
End Sub
Sub txt(tage$)
Dim t As Date
Dim neues_datum As String

t = Date + tage$
neues_datum = Format(t, "d. mmmm yyyy")
If IstAlternative = 0 Then
    Selection.Font.ColorIndex = wdAuto
End If
Selection.TypeText neues_datum
End Sub
Sub txj()
Dim t As Date
Dim neues_datum As String

t = Date
neues_datum = Format(t, "yyyy")
If IstAlternative = 0 Then
    Selection.Font.ColorIndex = wdAuto
End If
Selection.TypeText neues_datum
End Sub

Sub Zahlungsdaten()
Dim abfrage$
Dim ret$
Dim Anr$
Dim X, i, Anzahl As Integer
On Error GoTo Ende

Anr$ = GetAnr(1)

abfrage = "select count(*) from buchungen where nr=" & Anr & " and fknr is not null"
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select datum  from buchungen where nr=" & Anr & " and fknr is not null order by bnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    Selection.TypeText bib.gdat(ret$) & "; "
Next

Selection.TypeBackspace
Selection.TypeBackspace

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub BeteiligtenEinfuegen(kz$, rang$, art$)
'Parameter:
'   art$ = "" Kurzform
'   art$ = "1" Langform (Notariat)
'   art$ = "2" Postanschrift

Dim X
Dim count_
Dim Anr$
Dim ret$
Dim erg$, abfrage$, HLabfrage$, Landabfrage$, HLzusatz$, Landzusatz$
Dim land$
Dim i, j
On Error GoTo Ende

Anr$ = GetAnr(1)
ret$ = String(255, " ")

If rang$ = "" Or rang$ = "0" Then
    rang$ = "1"
End If

Landabfrage$ = "SELECT a.land from  beteiligte b, betakt t,adresse a WHERE a.betnr = t.betnr And adnr=1 and a.betnr = b.betnr and nr = " + Anr$
X = WordExecute("SELECT l.land from  beteiligte b, betakt t,adresse a, laenderkennzeichen l WHERE a.betnr = t.betnr And adnr=1 and b.betnr = t.betnr And (l.kuerzel= a.land or l.iso=a.land) and kz = " + kz$ & " and nr = " + Anr$ + " and rang =" + rang$)
ret$ = String(255, " ")
land$ = Left$(WordRequest(ret$), laenge)
If land$ = "" Then
    abfrage$ = "SELECT land from  beteiligte b, betakt t,adresse a WHERE a.betnr = t.betnr And adnr=1 and b.betnr = t.betnr and nr = " + Anr$ + " and rang =" + rang$
    If kz$ <> "999" Then
        abfrage$ = abfrage$ + " and kz = " + kz$
    End If
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    land$ = Left$(WordRequest(ret$), laenge)
    If land$ <> "" Then
       land$ = land$ + " - "
    End If
Else
    land$ = land$ + " "
End If
land$ = ""
If kz$ = "999" Then
    If rang$ = "*" Then
        X = WordExecute("SELECT count(*) from betakt WHERE nr = " + Anr$)
    Else
        X = WordExecute("SELECT count(*) from betakt WHERE nr = " + Anr$ + " and lfd = " + rang$)
    End If
Else
    If rang$ = "*" Then
        X = WordExecute("SELECT count(*) from betakt WHERE nr = " + Anr$ + " and bet is null and kz = " + kz$)
    Else
        X = WordExecute("SELECT count(*) from betakt WHERE nr = " + Anr$ + " and rang = " + rang$ + " and bet is null and kz = " + kz$)
    End If
End If

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

count_ = Val(Left$(WordRequest(ret$), laenge))
If count_ = 0 Then
    If kz$ = "1" Then
        MsgBox "advoware kann keinen " + rang$ + ". Mandanten ermitteln!", vbExclamation, GetApplicationName()
    ElseIf kz$ = "999" Then
        MsgBox "advoware kann keinen " + rang$ + ". Beteiligten ermitteln!", vbExclamation, GetApplicationName()
    Else
        MsgBox "advoware kann keinen " + rang$ + ". Gegner ermitteln!", vbExclamation, GetApplicationName()
    End If
Else
    
    abfrage$ = "select @if(@isna(titel),'',titel||' ')||@if(@isna(vorname),'',vorname||' ')||b.name||@if(@isna(gebname),',','')||" & _
                "@if(@isna(gebname),'',' (geb. '||gebname|| '),') ||" & _
                "@if(@isna(gebdat)+@isna(geburtsort)-2,' geb. ','')||" & _
                "@if(@isna(gebdat),'','am '||@datetochar (gebdat, 'dd.mm.yyyy')||@if(@isna(geburtsort),',',' '))||" & _
                "@if(@isna(geburtsort),'', 'in '||geburtsort||',')||'#'||" & _
                "@if(@isna(strasse)+@isna(plz)+@isna(ort)-3,' wohnhaft ','')||@if(@isna(strasse),'',strasse||', ')||''||plz||' '||ort " + _
                " FROM beteiligte b, betakt bt,adresse a " & _
                "WHERE a.betnr = bt.betnr and adnr=1 And b.betnr = bt.betnr And nr = " + Anr$
    Landabfrage$ = "SELECT a.land from  beteiligte b, betakt t,adresse a WHERE a.betnr = t.betnr And adnr=1 and a.betnr = b.betnr and nr = " + Anr$
    HLabfrage$ = "SELECT b.herkunftsland from  beteiligte b, betakt t WHERE b.betnr = t.betnr and nr = " + Anr$
    ReDim Laender(count_)
    ReDim HL(count_)
    If kz$ = "999" Then
        If rang$ = "*" Then
            If art$ = "1" Then
                GetLand count_, Landabfrage$, Laender
                GetLand count_, HLabfrage$, HL
                X = WordExecute(abfrage$)
            ElseIf art$ = "2" Then
                X = WordExecute("select anschrift FROM adresse, betakt WHERE adresse.betnr = betakt.betnr And adnr=1 and nr = " + Anr$ + " order by betakt.lfd")
            Else
                X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||'" + land$ + "'||plz||' '||ort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr = bt.betnr And adnr=1 and b.betnr = bt.betnr And nr = " + Anr$ + " order by bt.lfd")
            End If
        Else
            If art$ = "1" Then
                abfrage$ = abfrage$ + " and lfd = " + rang$
                Landabfrage$ = Landabfrage$ + " and lfd = " + rang$
                GetLand count_, Landabfrage$, Laender
                HLabfrage$ = HLabfrage$ + " and lfd = " + rang$
                GetLand count_, HLabfrage$, HL
                X = WordExecute(abfrage$)
            ElseIf art$ = "2" Then
                X = WordExecute("select anschrift FROM adresse, betakt WHERE adresse.betnr = betakt.betnr And adnr=1 and nr = " + Anr$ + " and lfd = " + rang$)
            Else
                Landabfrage$ = Landabfrage$ + " and lfd = " + rang$
                If kz$ <> "999" Then
                    Landabfrage$ = Landabfrage$ + " and kz = " + kz$
                End If
                GetLand count_, Landabfrage$, Laender
                erg$ = "select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||'" + land$ + "'||plz||' '||ort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr = bt.betnr And adnr=1 and b.betnr = bt.betnr And nr = " + Anr$ + " and lfd = " + rang$
                X = WordExecute(erg$)
            End If
        End If
    Else
        If rang$ = "*" Then
            If art$ = "1" Then
                abfrage$ = abfrage$ + " and bet is null and kz = " + kz$ + " order by lfd"
                Landabfrage$ = Landabfrage$ + " and bet is null and kz = " + kz$
                GetLand count_, Landabfrage$, Laender
                HLabfrage$ = HLabfrage$ + " and bet is null and kz = " + kz$
                GetLand count_, HLabfrage$, HL
                X = WordExecute(abfrage$)
            Else
                X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||'" + land$ + "'||plz||' '||ort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr = bt.betnr And b.betnr = bt.betnr and adnr=1 And nr = " + Anr$ + " and bet is null and kz = " + kz$ + " order by bt.lfd")
            End If
        Else
            If art$ = "1" Then
                abfrage$ = abfrage$ + " and rang = " + rang$ + " and bet is null and kz = " + kz$
                Landabfrage$ = Landabfrage$ + " and rang = " + rang$ + " and bet is null and kz = " + kz$
                GetLand count_, Landabfrage$, Laender
                HLabfrage$ = HLabfrage$ + " and rang = " + rang$ + " and bet is null and kz = " + kz$
                GetLand count_, HLabfrage$, HL
                X = WordExecute(abfrage$)
            ElseIf art$ = "2" Then
                X = WordExecute("select anschrift FROM adresse, betakt WHERE adresse.betnr = betakt.betnr And adnr=1 and nr = " + Anr$ + " and rang = " + rang$ + " and bet is null and kz = " + kz$)
            Else
                Landabfrage$ = Landabfrage$ + " and rang = " + rang$ + " and bet is null "
                If kz$ <> "999" Then
                    Landabfrage$ = Landabfrage$ + " and kz = " + kz$
                End If
                GetLand count_, Landabfrage$, Laender
                X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||'" + land$ + "'||plz||' '||ort FROM beteiligte b, betakt bt,adresse a WHERE a.betnr = bt.betnr And b.betnr = bt.betnr and adnr=1 And nr = " + Anr$ + " and rang = " + rang$ + " and bet is null and kz = " + kz$)
            End If
        End If
    End If
 
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        erg$ = Left$(WordRequest(ret$), laenge)
        If Laender(i) <> "" Then
            erg$ = erg$ + ", " + Laender(i)
        End If
        j = InStr(erg$, "#")
        If j = 0 Then
            If count_ > 0 Then
                erg$ = erg$ + Chr(13)
            End If
            Selection.TypeText erg$
        Else
            If HL(i) <> "" Then
                erg$ = Left$(erg$, j - 1) + " " + HL(i) + ", " + Right$(erg$, Len(erg$) - j - 1)
            Else
                erg$ = Left$(erg$, j - 1) + Right$(erg$, Len(erg$) - j)
            End If
            Selection.TypeText erg$
        
            If i < count_ - 1 Then
                With Selection
                    .TypeText text:=Chr(13)
                End With
            End If
        End If
    Next i

End If

Ende:
WordExecute ("commit")
End Sub
Private Sub GetLand(count_, Landabfrage$, Laender)
Dim X
Dim ret$, abfrage$
Dim erg$
Dim i
    X = WordExecute(Landabfrage$)
    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        Laender(i) = Left$(WordRequest(ret$), laenge)
    Next i
    For i = 0 To count_ - 1
        If Laender(i) <> "" Then
            abfrage$ = "select land from laenderkennzeichen where @UPPER('" + Laender(i) + "')=kuerzel or @UPPER('" + Laender(i) + "')=iso or @UPPER('" + Laender(i) + "')=iso3"
            X = WordExecute(abfrage$)
            ret$ = String(255, " ")
            ret$ = Left$(WordRequest(ret$), laenge)
            If ret$ <> "" Then
                Laender(i) = ret$
            End If
        End If
    Next i
Ende:
WordExecute ("commit")
End Sub
Sub Mandanten(kz$)
Dim X
Dim Anzahl$
Dim Anr$
Dim ret$
Dim erg$
Dim count_
Dim i

Anr$ = GetAnr(1)
ret$ = String(255, " ")

Anzahl$ = "Select count(*) FROM betakt WHERE kz = 1 AND bet is null and nr = " + Anr$
X = WordExecute(Anzahl$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

If count_ > 0 Then
    ReDim erg__$(count_)
    ReDim betnr__$(count_)

    X = WordExecute("select @trim(anrede)||@if(@length(@trim(anrede)), ' ', '')||@trim(titel||' '||vorname||' '||b.name)||@if(@length(gebname), ' (geb. '||gebname||'), ', ', ')||strasse||', '||plz||' '||ort||', geb. am '||@datetochar (gebdat, 'dd.mm.yyyy')||' in '||geburtsort FROM beteiligte b, betakt bt, betins,adresse a WHERE a.betnr = bt.betnr AND b.betnr = bt.betnr and adnr=1 AND bt.kz = betins.kz AND nr = " & Anr$ + " order by lfd")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    For i = 0 To count_ - 1
        ret$ = String(255, " ")
        erg__$(i) = Left$(WordRequest(ret$), laenge)
    Next i

    For i = 0 To count_ - 1
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        With Selection
            .TypeText text:=Trim$(Str$(i + 1)) + "." + Chr(13)
            If Left$(erg__$(i), 5) = "Herrn" Then
                .TypeText text:="Herr" + Right(erg__$(i), Len(erg__$(i)) - 5)
            Else
                .TypeText text:=erg__$(i)
            End If
            
        End With
        
        With Selection
            .TypeText text:=Chr(13)
        End With

        If X < count_ - 1 Then
            With Selection
                .TypeText text:=Chr(13)
            End With
        End If
    Next i
    
Else
    MsgBox "advoware kann keinen Mandanten ermitteln!", vbExclamation, GetApplicationName()
End If

Ende:

End Sub


Sub TabelleZahlungen() '  nArt=1: Zahlungen forderungskonto
    TabelleMBH 1
End Sub

Sub TabelleFremdgeldauszahlung()
    TabelleMBH 2

End Sub

Sub TabelleMBH(nArt) '  nArt=1: Zahlungen forderungskonto
                            ' nArt=2: Fremdgeldauszahlung
Dim Anr$
Dim abfrage$
Dim text$
Dim Forderungsdatum$
Dim Zinsbeginn$
Dim Zinssatz$
Dim Betrag$
Dim ret$
Dim X As Integer
Dim i As Integer
Dim Anzahl As Integer
On Error GoTo Ende


Anr$ = GetAnr(1)

ActiveDocument.Tables.Add Range:=Selection.Range, NumRows:=1, NumColumns:=3

Selection.Tables(1).Columns(1).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(2).SetWidth ColumnWidth:=150, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(3).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Borders(wdBorderLeft).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderRight).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderTop).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderBottom).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
Selection.Tables(1).Borders(wdBorderVertical).LineStyle = wdLineStyleNone

Selection.Font.Bold = 1

Selection.TypeText "Datum"
Selection.MoveRight Unit:=wdCell
Selection.Font.Bold = 1
If nArt = 1 Then
    Selection.TypeText "Zahlung"
ElseIf nArt = 2 Then
    Selection.TypeText "Auszahlung"
End If

Selection.MoveRight Unit:=wdCell
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Font.Bold = 1
Selection.TypeText "Betrag"

If nArt = 1 Then
    abfrage = "select count(*) from buchungen where nr=" & Anr & " and fknr is not null and betrag>0"
ElseIf nArt = 2 Then
    abfrage = "select count(*) from buchungen where nr=" & Anr & " and fremdgeld<0"
End If
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
If nArt = 1 Then
    abfrage = "select text||'|fffd|'||datum||'|fffd|'||betrag from buchungen where nr=" & Anr & " and fknr is not null and betrag>0 order by bnr"
ElseIf nArt = 2 Then
    abfrage = "select text||'|fffd|'||datum||'|fffd|'||(-fremdgeld) from buchungen where nr=" & Anr & " and fremdgeld<0 order by datum"
End If
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    Selection.MoveRight Unit:=wdCell
    Selection.Tables(1).Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Font.Bold = 0
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    text$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Forderungsdatum$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Betrag = ret$
    
    If Forderungsdatum$ <> "" Then
        Selection.TypeText bib.gdat(Forderungsdatum$)
    End If
    
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    Selection.TypeText text$
    
    Selection.MoveRight Unit:=wdCell
    Selection.Font.Bold = 0
    
    Selection.TypeText bib.wformat(bib.dbzahl(Betrag$)) & " |fffd|"
Next

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Public Function IstAlternative2() As Integer
Dim X
Dim r As Range
Set r = Selection.Range
 Selection.Find.ClearFormatting
 With Selection.Find
 '    .Text = ""
'     .Replacement.Text = "???"
     .Forward = True
     .Font.Name = "Wingdings"
     .Wrap = wdFindStop
     .Format = True
 End With
 If Selection.Find.Execute = True Then
    IstAlternative2 = 1
 Else
    IstAlternative2 = 0
 End If
 r.Select
End Function



Public Function IstAlternative() As Integer
Dim abbruch As Boolean
Dim meinBereich As Range
Dim ret As Integer
Dim PH As Range
Dim i As Integer
Dim j As Integer

i = 0
ret = False

Set PH = Selection.Range

abbruch = False
While Not abbruch

    If Selection.MoveRight(Unit:=wdCharacter, count:=1) = 0 Then
        abbruch = True
    Else
        If Selection.MoveRight(Unit:=wdCharacter, count:=1) = 0 Then
            abbruch = True
        Else
            If Selection.MoveLeft(Unit:=wdCharacter, count:=1, Extend:=wdExtend) = 0 Then
                abbruch = True
            End If
            i = i + 1
            If i >= 1000 Then
                abbruch = True
            Else
                If Selection.Font.ColorIndex <> wdPink Then
                    abbruch = True
                Else
                    If Right(Selection.text, 1) = Chr(40) Then
                        If Selection.Range.Font.Name = "Wingdings" Then
                            abbruch = True
                            ret = 1
                        End If
                    End If
                End If
            End If
        End If
    End If
Wend
PH.Select
i = 0
abbruch = False
While Not abbruch
    Selection.MoveLeft Unit:=wdCharacter, count:=1
    If Selection.MoveLeft(Unit:=wdCharacter, count:=1, Extend:=wdExtend) = 0 Then
        abbruch = True
    Else
        i = i + 1
        If i >= 1000 Then
            abbruch = True
        Else
            If Selection.Font.ColorIndex <> wdPink Then
                abbruch = True
            Else
                If Right(Selection.text, 1) = Chr(40) Then
                
                    If Selection.Range.Font.Name = "Wingdings" Then
                        abbruch = 1
                        ret = True
                    End If
                End If
            End If
        End If
    End If
Wend
PH.Select

IstAlternative = ret
End Function



Private Sub MV(nArt As Integer)
    Dim Anr$
    Dim Anzahl$
    Dim X, Y, i As Integer
    Dim ret$
    Dim count_ As Integer
    Dim abfrage$
    Dim erg$
    Dim Anschrift$
    Dim l|fffd|nge As Integer
     
    Anr = GetAnr(0)
   
    ret$ = String(255, " ")
    Anzahl$ = "Select count(*) FROM betakt WHERE bet Is null And kz = 1 And nr = " + Anr$
    
    X = WordExecute(Anzahl$)

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
        ReDim erg__$(count_)
        ReDim betnr__$(count_)
        
        abfrage$ = "select count(*) FROM beteiligte b, betakt bt WHERE bet Is null And bt.betnr = b.betnr And kz = 1 And nr = " + Anr$
        X = WordExecute(abfrage$)
        
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        
        Y = bib.Val2(Left$(WordRequest(ret$), laenge))
        
        If Y > 0 Then
            abfrage$ = "select @length(juranschr) FROM betakt bt, beteiligte b WHERE bet Is null And juranschr is not null And bt.betnr = b.betnr And kz = 1 And nr = " + Anr$ + " order by bt.lfd"
            X = WordExecute(abfrage)

            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
            
            ret$ = String(255, " ")
            erg$ = Left(WordRequest(ret$), laenge)
            
            If erg$ <> "0" And erg$ <> "" Then
                abfrage$ = "select juranschr FROM betakt bt, beteiligte b WHERE bet Is null And juranschr is not null And bt.betnr = b.betnr And kz = 1 And nr = " + Anr$ + " order by bt.lfd"
                X = WordExecute(abfrage)
                
                If X <> 0 Then
                    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                    GoTo Ende
                End If
                
                ret$ = String(255, " ")
                erg$ = WordRequest(ret$)
                ret$ = String(2001, " ")
                erg$ = WordRequestLongVarChar(ret$)
                l|fffd|nge = InStr(erg$, Chr$(0))
                If l|fffd|nge < 1 Then l|fffd|nge = 1
                erg$ = Left(erg$, l|fffd|nge - 1)
                
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
            Else
                erg$ = ""
            End If
            
            If erg <> "" Then
                Selection.TypeText (erg$)
            Else
                If nArt = 1 Or nArt = 3 Or nArt = 4 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort)||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt,adresse a WHERE a.betnr=bt.betnr AND b.betnr=bt.betnr AND bet is null AND kz = 1  AND adnr=1 AND nr = " + Anr$ + " order by lfd")
                ElseIf nArt = 2 Or nArt = 5 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND bet is null AND kz = 1 AND nr = " + Anr$ + " order by lfd")
                End If
                
                If X <> 0 Then
                    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                    GoTo Ende
                End If
        
                For i = 0 To count_ - 1
                    erg__$(i) = Left$(WordRequest(ret$), laenge)
                    erg__$(i) = LTrim(erg__$(i))
                    betnr__$(i) = Right$(erg__$(i), Len(erg__$(i)) - InStr(1, erg__$(i), "|fffd|"))
                    erg__$(i) = Left$(erg__$(i), InStr(1, erg__$(i), "|fffd|") - 1)
                Next i
        
                For i = 0 To count_ - 1
                    If IstAlternative = 0 Then
                        Selection.Font.ColorIndex = wdAuto
                    End If
                    If nArt = 1 Or nArt = 2 Or nArt = 4 Or nArt = 5 Then
                        If i >= 1 Then
                            Selection.TypeParagraph
                            Selection.TypeParagraph
                        End If
                        
                        Selection.TypeText text:=erg__$(i)
                        
                    End If
                    
                    If nArt = 5 Then
                        abfrage$ = "select @trim(', '||strasse||', '||plz||' '||ort) FROM adresse WHERE betnr = " + betnr__$(i)
                        X = WordExecute(abfrage$)
                
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        
                        ret$ = String(255, " ")
                        Anschrift$ = Left(WordRequest(ret$), laenge)
                    End If
                    
                    With Selection
                        .TypeText text:=Anschrift$
                    End With
                    
                    vertreter 1, betnr__$(i), 1, nArt, i + 1
                                        
                Next i
           End If
        End If
    Else
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "advoware kann keinen Mandanten ermitteln!", vbExclamation, GetApplicationName()
    End If

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Private Sub AnschriftenMandanten()
    Dim Anr$
    Dim Anzahl$
    Dim X, Y, i As Integer
    Dim ret$
    Dim count_ As Integer
    Dim abfrage$
    Dim erg$
    Dim l|fffd|nge As Integer
     
    Anr = GetAnr(1)
   
    ret$ = String(255, " ")
    Anzahl$ = "Select count(*) FROM betakt WHERE kz = 1 And nr = " + Anr$
    X = WordExecute(Anzahl$)

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
        ReDim erg__$(count_)
        ReDim betnr__$(count_)

        abfrage$ = "select count(*) FROM beteiligte b, betakt bt WHERE bt.betnr = b.betnr And kz = 1 And nr = " + Anr$
        X = WordExecute(abfrage$)
        
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        
        Y = bib.Val2(Left$(WordRequest(ret$), laenge))
        
        If Y > 0 Then
            X = WordExecute("select anschrift FROM adresse, betakt WHERE adresse.betnr=betakt.betnr and adnr=1 And kz = 1 AND nr = " + Anr$ + " order by lfd")
                
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
    
            For i = 0 To count_ - 1
                erg__$(i) = Left$(WordRequest(ret$), laenge)
                erg__$(i) = LTrim(erg__$(i))
            Next i
    
            For i = 0 To count_ - 1
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                With Selection
                    .TypeText text:=erg__$(i)
                    .TypeText text:=Chr(13)
                End With
                
                If X < count_ - 1 Then
                    With Selection
                        .TypeText text:=Chr(13)
                    End With
                End If
            Next i
        End If
    Else
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "advoware kann keinen Mandanten ermitteln!", vbExclamation, GetApplicationName()
    End If

Ende:

WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Private Sub BetreffMandanten()
    Dim Anr$
    Dim Anzahl$
    Dim X, Y, i As Integer
    Dim ret$
    Dim count_ As Integer
    Dim abfrage$
    Dim erg$
    Dim l|fffd|nge As Integer
    Dim Zeilenumbruch$
     
    Anr = GetAnr(1)

    If Left(Application.Version, 2) = "8." Then 'Microsoft hat nichts besseres zu tun, als Konstanten zu |fffd|ndern
        Zeilenumbruch$ = "^a"
    Else
        Zeilenumbruch$ = "^p"
    End If
   
    ret$ = String(255, " ")
    Anzahl$ = "Select count(*) FROM betakt WHERE kz = 1 And nr = " + Anr$
    X = WordExecute(Anzahl$)

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
        ReDim erg__$(count_)
        ReDim betnr__$(count_)

        abfrage$ = "select count(*) FROM beteiligte b, betakt bt WHERE bt.betnr = b.betnr And kz = 1 And nr = " + Anr$
        X = WordExecute(abfrage$)
        
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        
        Y = bib.Val2(Left$(WordRequest(ret$), laenge))
        
        If Y > 0 Then
            X = WordExecute("select @if( @isna( betreff2 ), betreff, 'Versicherungsnummer: ' || betreff ) || @if( @isna( betreff2 ), null, '" & Chr(13) + Chr(10) & "Schaden-Nr.: ' || betreff2 ) || @if( @isna( betreff3 ), null, '" & Chr(13) + Chr(10) & "' || betreff3 ) FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND kz = 1 AND nr = " + Anr$ + " order by lfd")
                
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
    
            For i = 0 To count_ - 1
                erg__$(i) = Left$(WordRequest(ret$), laenge)
            Next i
    
            For i = 0 To count_ - 1
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                With Selection
                    .TypeText text:=erg__$(i)
                    .TypeText text:=Chr(13)
                End With
                
                If X < count_ - 1 Then
                    With Selection
                        .TypeText text:=Chr(13)
                    End With
                End If
            Next i
        End If
    Else
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "advoware kann keinen Mandanten ermitteln!", vbExclamation, GetApplicationName()
    End If

Ende:

WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Private Function fBriefanrede()
    Dim ret$
    Dim erg$
    Dim X
    Dim Anr$
    Dim lfd$
    Dim l|fffd|nge As Integer
    Dim sBriefanrede$
    Anr$ = GetAnr(1)
    lfd$ = GetDocVar("Adressat")

    If Anr$ <> "" And lfd$ <> "" And lfd$ <> "0" Then
        sBriefanrede$ = GetDocVar("briefanrede")
        If sBriefanrede$ = "" Then
            X = WordExecute("select banrede FROM beteiligte b, betakt bt WHERE bt.betnr = b.betnr And lfd= " + lfd$ + " And nr = " + Anr$)
            
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
        
            ret$ = String(255, " ")
            sBriefanrede$ = Left$(WordRequest(ret$), laenge)
        End If
        
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        If sBriefanrede$ = "" Then ' Darf auf keinen Falss gel|fffd|scht werden! 24.09.2018 mp
            sBriefanrede$ = " "
        End If
        With Selection
            .TypeText text:=sBriefanrede$
        End With
        fBriefanrede = 1
    Else
        fBriefanrede = 0
    End If
Ende:

WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Function

Private Sub fTelefax(nArt As Integer)
    
    Dim sTelefax$, sTelefaxdb$, sLfd$, ret$
    Dim lfd
    Dim betnr
    Dim nr
    Dim X
    Dim telefaxtext$, abfrage$
    
    sTelefax$ = GetDocVar("telefax")
    telefaxtext$ = Men|fffd|funktionen.fTelefaxtext
    If sTelefax$ <> "" Then
        lfd = GetDocVar("adressat")
        nr = GetDocVar("nr")
        If lfd <> "" And lfd <> "0" And lfd > "0" And nr <> "" And nr <> "0" Then
            sTelefaxdb$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "fax")
            If sTelefaxdb$ = "" Then
                X = WordExecute("select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And komm_kz=2 And nr = " & nr)
                ret$ = String(255, " ")
                sTelefaxdb$ = Left$(WordRequest(ret$), laenge)
            End If
            If InStr(1, sTelefax$, sTelefaxdb$) = 0 Then
                sTelefax$ = telefaxtext$ & sTelefaxdb$
            End If
            
            If sTelefax$ = "" Then
                Selection.Delete
            Else
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                
                If InStr(1, sTelefax$, telefaxtext$) = 0 Then
                    sTelefax$ = telefaxtext$ & sTelefax$
                End If
                
                With Selection
                    .TypeText text:=sTelefax$
                End With
            End If
            SetDocVar "telefax", ""
        Else
            Selection.Delete
        End If
    Else
        betnr = GetDocVar("betnr")
        If betnr = "" Or betnr = "0" Then
            betnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")
        End If
        lfd = GetDocVar("adressat")
        nr = GetDocVar("nr")
        If betnr <> "" And betnr <> "0" And betnr > "0" Then
            If nArt = 1 Then
                abfrage$ = "select tlf from kommunikation where betnr = " & betnr & " And komm_art=2 and komm_kz=7 order by komm_lfd"
            Else
                abfrage$ = "select tlf from kommunikation where betnr = " & betnr & " And komm_art=2 and komm_kz=2 order by komm_lfd"
            End If
            X = WordExecute(abfrage$)
            ret$ = String(255, " ")
            sTelefax$ = sTelefax$ & Left$(WordRequest(ret$), laenge)
        ElseIf lfd <> "" And lfd <> "0" And lfd > "0" And nr <> "" And nr <> "0" Then
            If nArt = 1 Then
                abfrage$ = "select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And nr = " & nr & " And komm_art=2 and komm_kz=7 order by komm_lfd"
            Else
                abfrage$ = "select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And nr = " & nr & " And komm_art=2 and komm_kz=2 order by komm_lfd"
            End If
            X = WordExecute(abfrage$)
            ret$ = String(255, " ")
            sTelefax$ = sTelefax$ & Left$(WordRequest(ret$), laenge)
        End If
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        If sTelefax$ <> "" Then
            sTelefax$ = telefaxtext$ & sTelefax$
        Else
            Selection.Delete
        End If
        With Selection
            .TypeText text:=sTelefax$
        End With
    End If
End Sub
Private Sub fTelefon(nArt As Integer)
    
    Dim sTelefon$, sLfd$, ret$
    Dim lfd
    Dim betnr
    Dim nr
    Dim X
    Dim telefontext$, abfrage$
    
        betnr = GetDocVar("betnr")
        lfd = GetDocVar("adressat")
        nr = GetDocVar("nr")
        If betnr = "" Or betnr = "0" Then
            betnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")
        End If
        If betnr <> "" And betnr <> "0" And betnr > "0" Then
            If nArt = 1 Then
                abfrage$ = "select tlf from kommunikation where betnr = " & betnr & " And komm_art=1 and komm_kz=6 order by komm_lfd"
            Else
                abfrage$ = "select tlf from kommunikation where betnr = " & betnr & " And komm_art=1 and komm_kz=1 order by komm_lfd"
            End If
        ElseIf lfd <> "" And lfd <> "0" And lfd > "0" And nr <> "" And nr <> "0" Then
            If nArt = 1 Then
                abfrage$ = "select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And nr = " & nr & " And komm_art=1 and komm_kz=6 order by komm_lfd"
            Else
                abfrage$ = "select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And nr = " & nr & " And komm_art=1 and komm_kz=1 order by komm_lfd"
            End If
        End If
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        sTelefon$ = Left$(WordRequest(ret$), laenge)
        If sTelefon$ = "" Then
            If betnr <> "" And betnr <> "0" And betnr > "0" Then
                abfrage$ = "select k.tlf from kommunikation where betnr = " & betnr & " And komm_art=1 order by komm_kz"
            ElseIf lfd <> "" And lfd <> "0" And lfd > "0" And nr <> "" And nr <> "0" Then
                abfrage$ = "select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And nr = " & nr & " And komm_art=1 order by komm_lfd"
            End If
            ret$ = String(255, " ")
            sTelefon$ = Left$(WordRequest(ret$), laenge)
        End If
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        If sTelefon$ = "" Then
            Selection.Delete
        End If
        With Selection
            .TypeText text:=telefontext$ & sTelefon$
        End With
End Sub

Private Function fAnschrift()
    Dim ret$
    Dim erg$
    Dim X
    Dim Anr$, adnr$
    Dim lfd$
    Dim l|fffd|nge As Integer
    Dim sAnschrift$
    Anr$ = GetAnr(1)
    lfd$ = GetDocVar("Adressat")
    adnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "adnr")
    If adnr$ = "" Then
        adnr$ = 1
    End If
    If adnr$ < 0 Then
        adnr$ = -adnr$
    End If
    If adnr$ < 1 Then
        adnr$ = 1
    End If
    fAnschrift = 0
    If Anr$ <> "" And lfd$ <> "" And lfd$ <> "0" Then
        sAnschrift$ = GetDocVar("anschrift")
        If sAnschrift$ = "" Then
            X = WordExecute("select anschrift FROM adresse, betakt WHERE betakt.betnr = adresse.betnr And adnr=" + adnr$ + " and lfd= " + lfd$ + " And nr = " + Anr$)
            
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
        
            ret$ = String(255, " ")
            sAnschrift$ = Left$(WordRequest(ret$), laenge)
        End If
        
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        With Selection
            .TypeText text:=sAnschrift$
        End With
        fAnschrift = 1
    End If
Ende:

WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Function

Private Sub fBetreff2()
    'Exit Sub
    Dim sBetreff$
    sBetreff$ = GetDocVar("betreff")
    
    If sBetreff$ = "" Then
        Selection.Delete
    Else
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        With Selection
            .TypeText text:=sBetreff$
        End With
    End If
    
End Sub
Private Function fBetreff() As Long

    Dim sBetreff$, betnr, nr
    Dim X, ret$
    
    sBetreff$ = GetDocVar("betreff")
    ret$ = String(255, " ")
    If sBetreff$ = "" Then
        fBetreff = 0
        betnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")
        nr = GetDocVar("nr")
        If betnr <> "" And betnr <> "0" And betnr > "0" And nr <> "" And nr <> "0" And nr > "0" Then
            ret$ = "select betreff from betakt where nr = " + nr + " and betnr = " + betnr
            X = WordExecute(ret$)
            ret$ = String(255, " ")
            sBetreff$ = Left$(WordRequest(ret$), laenge)
        End If
    Else
        If IstAlternative = 0 Then
            Selection.Font.ColorIndex = wdAuto
        End If
        With Selection
            .TypeText text:=sBetreff$
        End With
        fBetreff = 1
    End If
    If sBetreff$ = "" Then
        Selection.Delete
    End If
End Function

Private Sub BriefanredeMandanten()
    Dim Anr$
    Dim Anzahl$
    Dim X, Y, i As Integer
    Dim ret$
    Dim count_ As Integer
    Dim abfrage$
    Dim erg$
    Dim l|fffd|nge As Integer
     
    Anr = GetAnr(1)
   
    ret$ = String(255, " ")
    Anzahl$ = "Select count(*) FROM betakt WHERE kz = 1 And nr = " + Anr$
    X = WordExecute(Anzahl$)

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    count_ = bib.Val2(Left$(WordRequest(ret$), laenge))

    If count_ > 0 Then
        ReDim erg__$(count_)
        ReDim betnr__$(count_)

        abfrage$ = "select count(*) FROM beteiligte b, betakt bt WHERE bt.betnr = b.betnr And kz = 1 And nr = " + Anr$
        X = WordExecute(abfrage$)
        
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        
        Y = bib.Val2(Left$(WordRequest(ret$), laenge))
        
        If Y > 0 Then
            X = WordExecute("select banrede FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND kz = 1 AND nr = " + Anr$ + " order by lfd")
                
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
    
            For i = 0 To count_ - 1
                erg__$(i) = Left$(WordRequest(ret$), laenge)
                erg__$(i) = LTrim(erg__$(i))
            Next i
    
            For i = 0 To count_ - 1
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                With Selection
                    .TypeText text:=erg__$(i)
                End With
                
                If X < count_ - 1 Then
                    With Selection
                        .TypeText text:=Chr(13)
                    End With
                End If
            Next i
        End If
    Else
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "advoware kann keinen Mandanten ermitteln!", vbExclamation, GetApplicationName()
    End If

Ende:

WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub


Private Sub GV(nArt As Integer)
    Dim Schuldner$
    Dim forderungskonto$
    Dim Anr$
    Anr$ = GetAnr(0)
    Dim abfrage$
    Dim X, i As Integer
    Dim ret$
    Dim erg$
    Dim l|fffd|nge As Integer
    ReDim betnr__$(0)
    Dim betnr$
    Dim Anzahl$
    Dim count_ As Integer
    
    ret$ = String(255, " ")
    Schuldner$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "schuldner")
    betnr$ = Schuldner$
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "schuldner") = ""
    forderungskonto$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "forderungskonto")
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Schuldner") = "0"

    If forderungskonto$ = "-1" Then
        forderungskonto$ = "0"
    End If
    
    abfrage$ = "select juranschr FROM betakt bt, beteiligte b WHERE bet Is null And juranschr is not null And bt.betnr = b.betnr And kz = 2 And nr = " + Anr$
    X = WordExecute(abfrage)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret$ = String(255, " ")
    erg$ = WordRequest(ret$)
    ret$ = String(2001, " ")
    erg$ = WordRequestLongVarChar(ret$)
    l|fffd|nge = InStr(erg$, Chr$(0))
    If l|fffd|nge < 1 Then l|fffd|nge = 1
    erg$ = Left(erg$, l|fffd|nge - 1)
    If IstAlternative = 0 Then
        Selection.Font.ColorIndex = wdAuto
    End If
    
    If erg$ <> "" Then
        Selection.TypeText erg$
    Else
        X = WordExecute("select betnr FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr and kz=2 and b.betnr = " + betnr$ + " AND nr = " + Anr$)
        Schuldner$ = Trim(Left$(WordRequest(ret$), laenge))
        
        If Schuldner$ <> "0" And Schuldner$ <> "" Then
       
            If forderungskonto$ = "0" Or forderungskonto$ = "" Then
                If nArt = 1 Or nArt = 3 Or nArt = 5 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name', '||strasse||', '||plz||' '||ort||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt,adresse a WHERE a.betnr=betakt.betnr AND b.betnr=bt.betnr and adnr=1 AND bet is null AND kz = 2 AND b.betnr = " + Schuldner$ + " AND nr = " + Anr$)
                ElseIf nArt = 2 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND bet is null AND kz = 2 AND b.betnr = " + Schuldner$ + " AND nr = " + Anr$)
                End If
            Else
                If nArt = 1 Then
                   X = WordExecute("select @trim(titel||' '||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt, fkschuldner f,adresse a WHERE bt.betnr = a.betnr and adnr=1 AND bt.betnr = f.betnr AND bet is null AND kz = 2 AND b.betnr = " + Schuldner$ + " AND bt.nr = " + Anr$ + " AND fknr = " + forderungskonto$)
                ElseIf nArt = 2 Then
                   X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt, fkschuldner f WHERE b.betnr=bt.betnr AND bt.betnr = f.betnr AND bet is null AND kz = 2 AND b.betnr = " + Schuldner$ + " AND bt.nr = " + Anr$ + " AND fknr = " + forderungskonto$)
                End If
            
            End If
            
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            Else
                If Schuldner$ = "-1" Then
                    WordExecute ("commit")
                    MsgBox "Es ist kein Schuldner vorhanden.", vbExclamation, GetApplicationName()
                Else
                    Schuldner$ = Left$(WordRequest(ret$), laenge)
                    Schuldner$ = LTrim(Schuldner$)
                    If Schuldner$ = "" Then
                        X = WordExecute("select @trim(titel||' '||vorname||' '||b.name||', '||strasse||', '||plz||' '||ort||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt,adresse a WHERE a.betnr=bt.betnr and b.betnr=bt.betnr and adnr=1 and b.betnr = " + betnr$ + " AND nr = " + Anr$)
                        Schuldner$ = Left$(WordRequest(ret$), laenge)
                        Schuldner$ = LTrim(Schuldner$)
                   End If
                    
                    If IstAlternative = 0 Then
                        Selection.Font.ColorIndex = wdAuto
                    End If
                    betnr__$(0) = Right(Schuldner, Len(Schuldner) - InStr(1, Schuldner, "|fffd|"))
                    Schuldner$ = Left(Schuldner, InStr(1, Schuldner, "|fffd|") - 1)
                    With Selection
                        .TypeText text:=Schuldner$
                    End With
                    vertreter 2, betnr__$(0), 1, nArt, 1
                End If
            End If
            
        Else
            If forderungskonto$ = "0" Or forderungskonto$ = "" Then
                Anzahl$ = "Select count(*) FROM betakt WHERE bet Is null And kz = 2 And nr = " + Anr$
            Else
                Anzahl$ = "Select count(*) FROM betakt, fkschuldner WHERE betakt.betnr = fkschuldner.betnr AND bet Is null And kz = 2 And betakt.nr = " + Anr$ + " AND fknr = " + forderungskonto$
            End If
            
            X = WordExecute(Anzahl$)
    
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
    
            count_ = bib.Val2(Left$(WordRequest(ret$), laenge))
    
            ReDim erg__$(count_)
            ReDim betnr__$(count_)
    
            If forderungskonto$ = "0" Or forderungskonto$ = "" Then
                If nArt = 1 Or nArt = 3 Or nArt = 5 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||plz||' '||ort||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt,adresse a WHERE a.betnr(+)=bt.betnr and (adnr=1 or a.betnr is null) AND b.betnr=bt.betnr AND bet is null AND kz = 2 AND nr = " + Anr$ + " order by lfd")
                ElseIf nArt = 2 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt WHERE b.betnr=bt.betnr AND bet is null AND kz = 2 AND nr = " + Anr$ + " order by lfd")
                End If
            Else
                If nArt = 1 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||', '||strasse||', '||plz||' '||ort||'|fffd|'||bt.betnr FROM beteiligte b, betakt bt, fkschuldner f,adresse a WHERE a.betnr(+)=bt.betnr and (adnr=1 or a.betnr is null) AND b.betnr=bt.betnr AND bt.betnr = f.betnr AND bet is null AND kz = 2 AND bt.nr = " + Anr$ + " AND fknr = " + forderungskonto$ + " order by lfd")
                ElseIf nArt = 2 Then
                    X = WordExecute("select @trim(titel||' '||vorname||' '||b.name)||bt.betnr FROM beteiligte b, betakt bt, fkschuldner f WHERE b.betnr=bt.betnr AND bt.betnr = f.betnr AND bet is null AND kz = 2 AND bt.nr = " + Anr$ + " AND fknr = " + forderungskonto$ + " order by lfd")
                End If
                
            End If
    
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
            
            For i = 0 To count_ - 1
                    erg__$(i) = Left$(WordRequest(ret$), laenge)
                    erg__$(i) = LTrim(erg__$(i))
                    betnr__$(i) = Right$(erg__$(i), Len(erg__$(i)) - InStr(1, erg__$(i), "|fffd|"))
                    erg__$(i) = Left$(erg__$(i), InStr(1, erg__$(i), "|fffd|") - 1)
            Next i
    
            For i = 0 To count_ - 1
                If IstAlternative = 0 Then
                    Selection.Font.ColorIndex = wdAuto
                End If
                If nArt = 1 Or nArt = 2 Or nArt = 5 Then
                If i >= 1 Then
                    Selection.TypeParagraph
                    Selection.TypeParagraph
                End If
                    Selection.TypeText text:=erg__$(i)
                End If
                
                vertreter 2, betnr__$(i), 1, nArt, i + 1
            Next i
                
        End If
    End If
Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub BezeichnungNotar()
Dim Anr$
Dim User$
Dim ret$
Dim s$
Dim X As Long

On Error GoTo Ende
Anr$ = GetAnr(1)
User$ = GetUser
ret$ = String(255, " ")
X = WordExecute("select weiblich from mitarbeiter where kuerzel = '" + User$ + "'")
ret$ = Left(WordRequest(ret$), laenge)
Selection.Delete
Selection.MoveLeft wdWord, 1, 1
s = Trim(Selection.text)

If ret$ = "1" Then
    
    If StrConv(s, vbLowerCase) = "der" Then
        s = Left$(s$, 1) + "ie Notarin"
    ElseIf StrConv(s, vbLowerCase) = "des" Then
        s = Left$(s$, 1) + "er Notarin"
    ElseIf StrConv(s, vbLowerCase) = "dem" Then
        s = Left$(s$, 1) + "er Notarin"
    ElseIf StrConv(s, vbLowerCase) = "den" Then
        s = Left$(s$, 1) + "ie Notarin"
    Else
        s = "Notarin"
    End If
Else
    If StrConv(s, vbLowerCase) = "der" Then
        s = Left$(s$, 1) + "er Notar"
    ElseIf StrConv(s, vbLowerCase) = "des" Then
        s = Left$(s$, 1) + "es Notars"
    ElseIf StrConv(s, vbLowerCase) = "dem" Then
        s = Left$(s$, 1) + "em Notar"
    ElseIf StrConv(s, vbLowerCase) = "den" Then
        s = Left$(s$, 1) + "en Notar"
    Else
        s = "Notar"
    End If
End If
Selection.TypeText s

Ende:
WordExecute ("commit")

End Sub

Function GetAbfrageErg(Feld$, Datei$, Anr$) As String
Dim ret$, erg$, abfrage$, count, ind, gemeinde, gbetnr(5), gbnr$, gbnrmin$, lfd$
Dim X As Long

    gbnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "GBNr")
    If Feld$ = "KKAUTIONSART" Then Feld$ = "KAUTIONSART"
    If Datei$ <> "notariat" Then
       If Datei = "mietrecht" And Feld$ = "BBKK" Then
            abfrage$ = "select 1 FROM syscolumns WHERE tbname='MIETRECHT' and name='IBAN'"
            X = WordExecute(abfrage$)
            erg$ = Left$(WordRequest(erg$), laenge)
            If erg$ = "1" Then
                    abfrage$ = "select bank||', IBAN '||iban||', BIC '||bic FROM mietrecht WHERE nr = " + Anr$
            Else
                    abfrage$ = "select bank||', BIC '||BIC ||', IBAN '||IBAN FROM mietrecht WHERE nr = " + Anr$
            End If
        Else
            abfrage$ = "select " + Feld$ + " FROM " + Datei$ + " WHERE nr = " + Anr$
        End If
        X = WordExecute(abfrage$)
        erg$ = String(255, " ")
        erg$ = Left$(WordRequest(erg$), laenge)
    Else
        lfd$ = "1"
        If InStr(1, Feld$, "2") > 0 And InStr(1, Feld$, "SONST") <= 0 Then
            lfd$ = "2"
            Feld$ = Left(Feld$, Len(Feld$) - 1)
        ElseIf InStr(1, Feld$, "1") > 0 Then
            Feld$ = Left(Feld$, Len(Feld$) - 1)
        End If
        
        abfrage$ = "select min(gbnr) from grundbuch where nr = " + Anr$
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        gbnrmin$ = Left$(WordRequest(ret$), laenge)
        abfrage$ = "select min(gbnr) from grundbuch where nr = " + Anr$ + " and gbnr > " + gbnrmin$
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        gbnr$ = Left$(WordRequest(ret$), laenge)
        If lfd$ = "1" Then
            gbnr$ = gbnrmin$
        End If
                
        Select Case Feld$
            Case "GRUNDBUCH"
                abfrage$ = "select grundbuchvon from grundbuch where gbnr = " + gbnr$ + " and nr = " + Anr$
                erg$ = "direkt"
            Case "BLATT"
                abfrage$ = "select  blatt from grundbuch where gbnr = " + gbnr$ + " and nr = " + Anr$
                erg$ = "direkt"
            Case "ANTEIL"
                lfd$ = GetLfd("grundbuch_abt1", lfd$, Anr$, gbnr$)
                abfrage$ = "select  anteil from grundbuch_abt1 where lfd = " + lfd$ + " and nr = " + Anr$ + " and gbnr = " + gbnr$
                erg$ = "direkt"
            Case "ANTEILERW"
                lfd$ = GetLfd("veraeusserung_erwerber", lfd$, Anr$, gbnr$)
                abfrage$ = "select  anteil from veraeusserung_erwerber where lfd = " + lfd$ + " and nr = " + Anr$ + " and gbnr = " + gbnr$
                erg$ = "direkt"
            Case "MITEIGENTUM", "SONDEREIGENTUM", "SONSTIGES", "GENEHMIGUNG", "UEBERGABETAG", "KAUFPREIS", "BELASTUNGEN", "INVENTAR", "SONSTIGE", "SONSTIGE2", "BEZSONSTIGE", "BEZSONSTIGE2"
                abfrage$ = "select " + Feld$ + " from veraeusserung_zusatz where nr = " + Anr$ + " and gbnr = " + gbnr$
                erg$ = "direkt"
            Case "AMTSGERICHT"
                abfrage$ = "SELECT name FROM betakt b, grundbuch g where  b.nr = " + Anr$ + " and b.nr = g.nr and b.betnr = g.betnr and gbnr = " + gbnr$
                erg$ = "direkt"
            Case "STRASSE"
                abfrage$ = "select count(*)  from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                count = Val(erg$)
                If count > 0 Then
                    abfrage$ = "select lage from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$ + " order by nr, gbnr, lfd "
                    ind = 0
                    erg = ""
                    X = WordExecute(abfrage)
                    While ind < count
                        ret$ = String(255, " ")
                        If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                        erg = erg + Left$(WordRequest(ret$), laenge)
                        ind = ind + 1
                    Wend
                End If
'                lfd$ = GetLfd("grundbuch_bestand", lfd$, Anr$, gbnr$)
            Case "GEMARKUNG", "FLUR", "GROESSE", "FLURSTUECK", "WIRTSCHAFTSART"
                abfrage$ = "select count(*)  from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                count = Val(erg$)
                If count > 0 Then
                    abfrage$ = "select " + Feld$ + " from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$ + " order by nr, gbnr, lfd "
                    ind = 0
                    erg = ""
                    X = WordExecute(abfrage)
                    While ind < count
                        ret$ = String(255, " ")
                        If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                        erg = erg + Left$(WordRequest(ret$), laenge)
                        ind = ind + 1
                    Wend
                End If
'                lfd$ = GetLfd("grundbuch_bestand", lfd$, Anr$, gbnr$)
'                abfrage$ = "select " + Feld$ + " from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$ + " and lfd = " + lfd$
'                erg$ = "direkt"
            Case "GEMEINDE"
                abfrage$ = "select count(*)  from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                count = Val(erg$)
                If count > 0 Then
                    abfrage$ = "select b.name from grundbuch_bestand g, beteiligte b where gbnr = " + gbnr$ + " and g.nr = " + Anr$ + " and g.gemeinde_betnr = b.betnr and g.gemeinde_betnr is not null and g.gemeinde_betnr > 0 order by nr, gbnr, lfd "
                    ind = 0
                    erg = ""
                    X = WordExecute(abfrage)
                    While ind < count
                        ret$ = String(255, " ")
                        If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                        erg = erg + Left$(WordRequest(ret$), laenge)
                        ind = ind + 1
                    Wend
                End If
'                lfd$ = GetLfd("grundbuch_bestand", lfd$, Anr$, gbnr$)
'                abfrage = "select count(nr) from grundbuch_bestand where gbnr = " + gbnr$ + " and  nr = " & Anr + " and lfd = 1"
'                X = WordExecute(abfrage)
'                ret$ = String(255, " ")
'                erg$ = Left$(WordRequest(ret$), laenge)
'                count = Val(erg$)
'                If count > 0 Then
'                    abfrage$ = "select gemeinde_betnr from grundbuch_bestand where gbnr = " + gbnr$ + " and nr = " + Anr$ + " and lfd = 1"
'                    X = WordExecute(abfrage$)
'                    ind = 0
'                    While ind < count
'                        ret$ = String(255, " ")
'                        erg = Left$(WordRequest(ret$), laenge)
'                        gbetnr(ind) = erg
'                        ind = ind + 1
'                    Wend
'                    ind = 0
'                    erg = ""
'                    While ind < count
'                        If gbetnr(ind) > 0 Then
'                            abfrage$ = "select name from betakt where betnr = " + gbetnr(ind) + " and nr = " + Anr$
'                            X = WordExecute(abfrage$)
'                            ret$ = String(255, " ")
'                            If ind > 0 Then erg = erg + Chr(13) + Chr(10)
'                            erg = erg + Left$(WordRequest(ret$), laenge)
'                        End If
'                        ind = ind + 1
'                    Wend
'               End If
            Case "VERWANDT"
                lfd$ = GetLfd("veraeusserung_erwerber", lfd$, Anr$, gbnr$)
                abfrage$ = "SELECT verwandt FROM veraeusserung_erwerber where  nr = " + Anr$ + " and gbnr = " + gbnr$ + " and lfd = " + lfd$
                X = WordExecute(abfrage$)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                If erg$ = "1" Then
                    erg$ = "Verwandter (gerade Linie)"
                ElseIf erg$ = "2" Then
                    erg$ = "Ehegatte"
                ElseIf erg$ = "3" Then
                    abfrage$ = "SELECT bezverwandt FROM veraeusserung_erwerber where  nr = " + Anr$ + " and gbnr = " + gbnr$ + " and lfd = " + lfd$
                    X = WordExecute(abfrage$)
                    ret$ = String(255, " ")
                    erg$ = Left$(WordRequest(ret$), laenge)
                ElseIf erg$ = "0" Then
                    erg$ = "keine"
                End If
                    
            Case "BEBAUT"
                abfrage$ = "SELECT bebaut FROM veraeusserung_zusatz where  nr = " + Anr$
                X = WordExecute(abfrage$)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                If erg$ = "1" Then
                    abfrage$ = "SELECT wohngebaeude FROM veraeusserung_zusatz where  nr = " + Anr$ + " and gbnr = " + gbnrmin$
                    X = WordExecute(abfrage$)
                    ret$ = String(255, " ")
                    erg$ = Left$(WordRequest(ret$), laenge)
                    If erg$ = "1" Then
                        erg$ = "Wohngeb|fffd|ude"
                    Else
                        erg$ = "andere Bebauung"
                    End If
                Else
                    erg$ = "nicht bebaut"
                End If
                    
            Case "LAND"
                abfrage$ = "SELECT land FROM veraeusserung_zusatz where  nr = " + Anr$ + " and gbnr = " + gbnrmin$
                X = WordExecute(abfrage$)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                If erg$ = "1" Then
                    erg$ = "land- und forstwirtschaftlich genutzt"
                Else
                    erg$ = "nicht land- und forstwirtschaftlich genutzt"
                End If
                    
            Case "ART"
                abfrage$ = "SELECT art FROM veraeusserung_zusatz where  nr = " + Anr$ + " and gbnr = " + gbnr$
                X = WordExecute(abfrage$)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                If erg$ = "1" Then
                    erg$ = "Kauf"
                ElseIf erg$ = "2" Then
                    erg$ = "Tausch"
                ElseIf erg$ = "3" Then
                    erg$ = "Abtretung"
                ElseIf erg$ = "4" Then
                    erg$ = "Schenkung"
                End If
                    
            Case "RECHTSWIRKSAMKEIT"
                abfrage$ = "SELECT rechtswirksamkeit FROM veraeusserung_zusatz where  nr = " + Anr$ + " and gbnr = " + gbnr$
                X = WordExecute(abfrage$)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                If erg$ = "1" Then
                    erg$ = "Rechtswirksamkeit ist eingetreten"
                Else
                    erg$ = "Rechtswirksamkeit ist nicht eingetreten"
                End If
            Case "ABTI"
                abfrage = "select count(*) from grundbuch_abt1 where nr = " & Anr
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                count = Val(erg$)
                abfrage$ = "SELECT lfdnr||'    '||zu||'    '||b.name||'    '||g.stellung||'    '||anteil FROM grundbuch_abt1 g, beteiligte b where  g.nr = " + Anr$ + "  and g.betnr = b.betnr order by gbnr, g.lfd"
                ind = 0
                X = WordExecute(abfrage)
                erg = ""
                While ind < count
                    ret$ = String(255, " ")
                    If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                    erg = erg + Left$(WordRequest(ret$), laenge)
                    ind = ind + 1
                Wend
            Case "ABTII"
                abfrage = "select count(*) from grundbuch_abt2 where nr = " & Anr
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                count = Val(erg$)
                abfrage$ = "SELECT lfdnr||'    '||zu||'    '||art||'    '||belastung FROM grundbuch_abt2 where nr = " + Anr$ + " order by gbnr,lfd"
                ind = 0
                X = WordExecute(abfrage)
                erg = ""
                While ind < count
                    ret$ = String(255, " ")
                    If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                    erg = erg + Left$(WordRequest(ret$), laenge)
                    ind = ind + 1
                Wend
            Case "ABTIII"
                abfrage = "select count(*) from grundbuch_abt3 where nr = " & Anr
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
                count = Val(erg$)
                abfrage$ = "SELECT lfdnr||'    '||zu||'   '||g.art||'     '||betrag||'  '||waehrung||' '||belastung||'   '||b.name||'    '||brief "
                abfrage$ = abfrage$ + "FROM grundbuch_abt3 g, beteiligte b where  g.nr = " + Anr$ + " and g.glaeubiger_betnr=b.betnr(+) order by g.lfd"
                ind = 0
                X = WordExecute(abfrage)
                erg = ""
                While ind < count
                    ret$ = String(255, " ")
                    If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                    erg = erg + Left$(WordRequest(ret$), laenge)
                    ind = ind + 1
                Wend
        End Select
 '       "GRUNDBUCH"  "BLATT"  "MITEIGENTUM"  "SONDEREIGENTUM"  "SONSTIGES" "ANTEIL"
 '        "ANTEILERW"  "GENEHMIGUNG" "UEBERGABETAG" "KAUFPREIS"  "BELASTUNGEN" "SONSTIGE" "BEZSONSTIGE" "INVENTAR" "AMTSGERICHT" "WIRTSCHAFTSART"
        If erg$ = "direkt" Then
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
        End If
    End If
    GetAbfrageErg = erg$
End Function
Function GetLfd(tabelle$, lfd$, Anr$, gbnr$) As String
Dim ret$, abfrage$, lfd1$
Dim X As Long
abfrage$ = "SELECT min( lfd ) FROM " + tabelle$ + " where  nr = " + Anr$ + " and gbnr = " + gbnr$
X = WordExecute(abfrage$)
ret$ = String(255, " ")
lfd1$ = Left$(WordRequest(ret$), laenge)
If lfd$ = "2" Then
    abfrage$ = "SELECT lfd FROM " + tabelle$ + " where  nr = " + Anr$ + " and gbnr = " + gbnr$ + " and lfd > " + lfd1$ + " order by lfd"
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    lfd1$ = Left$(WordRequest(ret$), laenge)
End If
GetLfd = lfd1$
End Function
Function GetAbfrage(Feld$, abfrage$, betnr$) As String
Select Case Feld$
    Case "ALTER"
        abfrage$ = "select  @datetochar( sysdate, 'yyyy') -  @datetochar( gebdat, 'yyyy') from beteiligte where betnr = " & betnr
    Case Else
          abfrage$ = "select beteiligte." & Feld & " from beteiligte where betnr = " & betnr
    End Select
    GetAbfrage = abfrage$
End Function
Function GetKind(Name$, rang$, kz$, Anr, abfrage) As String
Dim ret$, abfrage1$, lfd$, betnr$, i, X, bet
    If InStr(Name$, "Kind") > 0 Then
        bet = 14
    ElseIf InStr(Name$, "Ansprechpartner") > 0 Then
        bet = 11
    End If
    If bet > 0 Then
        abfrage1$ = "select count(betnr) from betakt where nr = " & Anr & " and kz = " & kz$ & " and bet = " & bet
        X = WordExecute(abfrage1$)
        ret$ = String(255, " ")
        lfd$ = Left$(WordRequest(ret$), laenge)
        If lfd < rang$ Then
            abfrage = ""
        Else
            abfrage1$ = "select betnr from betakt where nr = " & Anr & " and kz = " & kz$ & " and bet = " & bet & " order by lfd"
            X = WordExecute(abfrage1$)
            While i < rang$
                ret$ = String(255, " ")
                betnr$ = Left$(WordRequest(ret$), laenge)
                i = i + 1
            Wend
            abfrage = abfrage & " and betakt.betnr= " + betnr$
        End If
    End If
    GetKind = abfrage
End Function
Function GetTB(Feld$, abfrage$, betnr) As String
Dim abfrage1$
Dim erg2$
Dim erg3$
Dim X
Select Case Feld$
                        
    Case "POSTFACH", "PLZ", "ORT", "STRASSE", "ANSCHRIFT"
         abfrage = "select adresse." & Feld & " from adresse" & abfrage & _
                    " And adnr=1 and betakt.betnr = adresse.betnr "
    Case "LAND"
         abfrage = "select l.land from adresse, laenderkennzeichen l " & abfrage & _
                    " And betakt.betnr = adresse.betnr and adnr=1 and (@upper(adresse.land)=l.kuerzel or @upper(adresse.land)=l.iso or @upper(adresse.land)=l.iso3) "
   
    Case "TELEFON", "TELEFON2"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                    " And betakt.betnr = k.betnr And komm_kz=1 and komm_kz=v.kz"
    Case "TELEFAX", "TELEFAX2"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                    " And betakt.betnr = k.betnr And komm_kz=2 and komm_kz=v.kz"
    Case "RUFP", "RUFP2"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                    " And betakt.betnr = k.betnr And komm_kz=6 and komm_kz=v.kz"
    Case "FAXP", "FAXP2"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                    " And betakt.betnr = k.betnr And komm_kz=7 and komm_kz=v.kz"
    Case "MOBIL", "MOBIL2"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                    " And betakt.betnr = k.betnr And komm_kz=3 and komm_kz=v.kz"
    Case "EMAIL"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                     " And betakt.betnr = k.betnr and komm_kz=v.kz And (komm_kz=4 or komm_kz=8) order by komm_kz"
    Case "EMAIL2"
          abfrage1$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=4 order by komm_kz"
          X = WordExecute(abfrage1)
          erg2$ = String(255, " ")
          erg2$ = Left(WordRequest(erg2$), laenge)
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=4 And tlf !='" & erg2$ & "' order by komm_kz"
    Case "EMAIL3"
          abfrage1$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=4 order by id"
          X = WordExecute(abfrage1)
          erg2$ = String(255, " ")
          erg2$ = Left(WordRequest(erg2$), laenge)
          abfrage1$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=4 And tlf !='" & erg2$ & "' order by komm_kz"
          X = WordExecute(abfrage1)
          erg3$ = String(255, " ")
          erg3$ = Left(WordRequest(erg3$), laenge)
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=4 And tlf !='" & erg2$ & "' And tlf !='" & erg3$ & "' order by komm_kz"
    Case "EMAILPRIVAT"
          abfrage$ = "select k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                     " And betakt.betnr = k.betnr and komm_kz=v.kz And (komm_kz=8 ) order by komm_kz"
    Case "SONSTIGE"
          abfrage$ = "select text || ' ' || k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                     " And betakt.betnr = k.betnr and komm_kz=v.kz And (komm_kz=10 ) order by komm_kz"
    Case "AUTO"
          abfrage$ = "select text || ' ' || k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                     " And betakt.betnr = k.betnr and komm_kz=v.kz And (komm_kz=9 ) order by komm_kz"
    Case "WEB"
          abfrage$ = "select text || ' ' || k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                     " And betakt.betnr = k.betnr and komm_kz=v.kz And (komm_kz=5 ) order by komm_kz"
    Case "ADVONETEMAIL"
          abfrage$ = "select text || ' ' || k.tlf from kommunikation k, verbindungsart v" & abfrage$ & _
                     " And betakt.betnr = k.betnr and komm_kz=v.kz And (komm_kz=4  or komm_kz=8) and komm_oa = 1 order by komm_kz"
    Case "ALTER"
          abfrage$ = "select @year(sysdate) - @year(beteiligte.gebdat) from beteiligte" & abfrage$ & _
                     " And betakt.betnr = beteiligte.betnr "
          
    Case "BANK", "KTONR", "KONTOINHABER", "BLZ", "IBAN", "BIC", "SWIFT", "MANDATVOM", "MANDATSREFERENZ"
          abfrage$ = "select bankverbindung." & Feld & " from bankverbindung" & abfrage$ & _
                     " And betakt.betnr = bankverbindung.betnr and bankverbindung." & Feld & " is not null "
    Case "HRN"
          abfrage$ = "select @trim( beteiligte.registerart||' '||beteiligte.hrn ) from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    
    Case "STAMMKAPITAL"
          abfrage$ = "select @trim(@string(beteiligte.stammkapital,2)||' '||beteiligte.euro) from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    Case "LABRUF"
          abfrage$ = "select @trim(@datetochar(beteiligte.labruf,'dd.mm.yyyy')) from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    Case "@TRIM(TITEL||VORNAME||NAME)", "TITELVORNAMENAME"
          abfrage$ = "select @trim(beteiligte.titel||' '||beteiligte.vorname||' '||beteiligte.name) from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    Case "@TRIM(TITEL||NAME)", "TITELNAME"
          abfrage$ = "select @trim(beteiligte.titel||' '||beteiligte.name) from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    Case Else
          abfrage$ = "select beteiligte." & Feld & " from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    End Select
    GetTB = abfrage$
End Function

Function GetTBK(Feld$, abfrage$) As String
Dim ret$
Dim abfrage2$
Dim X

Select Case Feld$
    Case "POSTFACH", "PLZ", "ORT", "STRASSE", "ANSCHRIFT"
         abfrage = "select adresse." & Feld & " from adresse where adnr=1 and " & abfrage$
      
    Case "LAND"
         abfrage = "select l.land from adresse, laenderkennzeichen l where (@upper(adresse.land)=l.kuerzel or @upper(adresse.land)=l.iso or @upper(adresse.land)=l.iso3) and adnr=1 and " & abfrage$
    Case "TELEFON", "TELEFON2"
          abfrage$ = "select tlf from kommunikation where komm_kz=1 And " & abfrage$
    Case "TELEFAX", "TELEFAX2"
          abfrage$ = "select tlf from kommunikation where komm_kz=2 And " & abfrage$
    Case "RUFP", "RUFP2"
          abfrage$ = "select tlf from kommunikation where komm_kz=6 And " & abfrage$
    Case "FAXP", "FAXP2"
          abfrage$ = "select tlf from kommunikation where komm_kz=7 And " & abfrage$
    Case "MOBIL", "MOBIL2"
          abfrage$ = "select tlf from kommunikation where komm_kz=3 And " & abfrage$
    Case "EMAIL"
          abfrage2$ = "select tlf from kommunikation where komm_kz=4 And " & abfrage$
          X = WordExecute(abfrage2$)
          ret$ = String(255, " ")
          ret$ = Left$(WordRequest(ret$), laenge)

          If ret$ = "" Then
             abfrage$ = "select tlf from kommunikation where komm_kz=8 And " & abfrage$
          Else
             abfrage$ = abfrage2$
          End If

    Case "EMAILPRIVAT"
          abfrage$ = "select tlf from kommunikation where komm_kz=8 And " & abfrage$
    Case "SONSTIGE"
          abfrage$ = "select tlf from kommunikation where komm_kz=10 And " & abfrage$
    Case "AUTO"
          abfrage$ = "select tlf from kommunikation where komm_kz=9 And" & abfrage$
    Case "WEB"
          abfrage$ = "select tlf from kommunikation where komm_kz=5 And " & abfrage$
    Case "ADVONETEMAIL"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And ( komm_kz=4 or komm_kz=8 ) and komm_oa = 1"
    Case "BANK", "KTONR", "KONTOINHABER", "BLZ", "IBAN", "BIC", "SWIFT"
          abfrage$ = "select bankverbindung." & Feld & " from bankverbindung where " & abfrage$
          
    Case "@TRIM(TITEL||VORNAME||NAME)", "TITELVORNAMENAME"
          abfrage$ = "select @trim(beteiligte.titel||' '||beteiligte.vorname||' '||beteiligte.name) from beteiligte where " & abfrage$
    Case "@TRIM(TITEL||NAME)", "TITELNAME"
          abfrage$ = "select @trim(beteiligte.titel||' '||beteiligte.name) from beteiligte where " & abfrage$
    Case Else
         abfrage$ = "select beteiligte." & Feld & " from beteiligte where " & abfrage$
    End Select
    GetTBK = abfrage$
End Function


Sub GerichtlichesRubrum()
    Selection.TypeText "Gerichtsrubrum"
    GloabalFontSize = Selection.Font.Size
    Selection.Range.InsertAutoText
    Austauschen.main
End Sub

Sub GerichtlichesRubrumKurz()
    Selection.TypeText "GerichtsrubrumKurz"
    Selection.Range.InsertAutoText
    Austauschen.main
End Sub

Sub AustauschenEXE()
Dim Database$
Dim App$
Dim nWND As Long
Dim buffer$
Dim X As Long

Database = GetDatabase()

App$ = GetApplicationName()

If AnwendungErmitteln(App$) Then
    AnwendungAktivieren (App$)
    
    nWND = GetWindow(GetDesktopWindow(), GW_CHILD)
    buffer = String(255, 0)
    GetWindowText nWND, buffer, Len(buffer)
        
        Do While nWND <> 0
            buffer = String(255, 0)
            GetWindowText nWND, buffer, Len(buffer)
            buffer = UCase(buffer)
            App$ = UCase(App$)
            If InStr(1, buffer, App$) > 0 Then
                PostMessage nWND, 21386, 34, 0
                '  Exit Sub muss hier stehen bleiben, damit das Makro beendet wird,
                '  bevor die Platzhalter ausgetauscht wurden.
                Exit Sub
            End If
            
            nWND = GetWindow(nWND, GW_HWNDNEXT)
        Loop
End If

End Sub


Sub BeteiligteEinf|fffd|gen()
    ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|platzhalter.exe|fffd| |fffd|BeteiligteAlleDialog|fffd|", PreserveFormatting:=False
    AustauschenEXE
End Sub

Sub AbgelegtVon()
Dim Anr$
Dim User$
Dim ret$
Dim X As Long

On Error GoTo Ende
Anr$ = GetAnr(1)
ret$ = String(255, " ")
X = WordExecute("select benutzer from history,akten where akten.nr=history.nr and ablage=1 and hart='Ablage der Akte' and akten.nr=" & Anr$ & " order by hdat desc")
ret$ = Left(WordRequest(ret$), laenge)
Selection.Delete
Selection.TypeText ret$
Ende:
X = WordExecute("commit")
End Sub

Sub Tabelle2Forderungen()
Dim Anr$
Dim abfrage$
Dim text$
Dim Forderungsdatum$
Dim Zinsbeginn$
Dim Zinssatz$
Dim Betrag$
Dim ret$
Dim X As Integer
Dim i As Integer
Dim Anzahl As Integer
Dim bBasiszins As Boolean

On Error GoTo Ende

Anr$ = GetAnr(1)

abfrage = "select count(*) from forderungen where nr=" & Anr
ret$ = String(255, " ")
X = WordExecute(abfrage)
ret$ = Left(WordRequest(ret$), laenge)
Anzahl = Val(ret$)
abfrage = "select text||'|fffd|'||bdatum||'|fffd|'||zbeginn||'|fffd|'||zins*100||'|fffd|'||betrag from forderungen where nr=" & Anr & " order by art,bdatum,fnr"
X = WordExecute(abfrage)

For i = i To Anzahl - 1
    bBasiszins = False
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    text$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Forderungsdatum$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Zinsbeginn$ = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Zinssatz = Left(ret$, InStr(ret$, "|fffd|") - 1)
    ret$ = Mid(ret$, InStr(ret$, "|fffd|") + 1)
    Betrag = ret$
    Selection.TypeText text$ & " vom " & bib.gdat(Forderungsdatum$) & " |fffd|ber " & bib.wformat(bib.dbzahl(Betrag$)) & " |fffd|"
    Selection.TypeParagraph
Next

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub UnterschriftEinf|fffd|gen(Feld$, Anr$)
Dim Sb$, ret$, Unterschriftendatei$
Dim X As Integer
    
    If Feld = "UNTERSCHRIFTSDATEI" Or Feld = "UNTERSCHRIFTSDATEIHINTERDENTEXT" Or Feld = "UNTERSCHRIFTSDATEIBENUTZER" Or Feld = "UNTERSCHRIFTSDATEIBENUTZERHINTERDENTEXT" Then
        Selection.Find.ClearFormatting
        With Selection.Find
            .text = "|fffd|UnterschriftenDatei|fffd|"
        End With
        If Selection.Find.Execute Then
            Selection.TypeBackspace
        End If
        If Feld = "UNTERSCHRIFTSDATEI" Or Feld = "UNTERSCHRIFTSDATEIHINTERDENTEXT" Then
            Sb$ = GetDocVar("unterschrift_sb")
            DelDocVar ("unterschrift_sb")
            
            If Sb$ = "" Then
                X = WordExecute("select sb FROM akten where nr = " + Anr$)
                                         
                If X <> 0 Then
                    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                    GoTo Ende
                End If
                ret$ = String(255, " ")
                Sb$ = Left$(WordRequest(ret$), laenge)
            End If
            X = WordExecute("select unterschriftsdatei from pfade,mitarbeiter where pfade.mnr=mitarbeiter.nr and mitarbeiter.kuerzel='" & Sb$ & "'")
        Else
            Sb$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "User")
            X = WordExecute("select unterschriftsdatei from pfade,mitarbeiter where pfade.mnr=mitarbeiter.nr and mitarbeiter.name='" & Sb$ & "'")
        End If
        ret$ = String(255, " ")
        Unterschriftendatei$ = Left(WordRequest(ret$), laenge)
        If Unterschriftendatei$ <> "" And Dir(Unterschriftendatei$) <> "" Then
            Selection.Delete
            Dim oInlineShape As InlineShape
            Dim oShape As Shape
            Set oInlineShape = Selection.InlineShapes.AddPicture(Range:=Selection.Range, FileName:=Unterschriftendatei$, LinkToFile:=False, SaveWithDocument:=True)
            'hinter den Text
            If Feld = "UNTERSCHRIFTSDATEIHINTERDENTEXT" Or Feld = "UNTERSCHRIFTSDATEIBENUTZERHINTERDENTEXT" Then
                On Error Resume Next
                oInlineShape.Select
                On Error Resume Next
                Set oShape = oInlineShape.ConvertToShape
                If Err.Number <> 0 Then
                    Sleep (500)
                    Set oShape = oInlineShape.ConvertToShape
                End If
                oShape.WrapFormat.Type = wdWrapNone
                oShape.ZOrder msoSendBehindText
            End If
            'hinter den Text ENDE
        End If
    End If

Ende:
End Sub


Function GetBeteiligte(Feld$, Datei$, Anr, bet$, kz$, rang$, betnr$, Name$) As String
    Dim X As Long
    Dim aVar As Variable
    Dim ret$, pos1$, pos2$, pos3$, lfd$
    Dim erg$, abfrage$, Index$, abfrageA$
    Dim xy As Currency
    
                If Feld$ = "ADVONETUSER" Or Feld$ = "OAACTIVATIONCODE" Then
                        If Feld$ = "OAACTIVATIONCODE" Then Feld$ = "OAINVITATIONCODE"
                        If GetDocVar("adressat") = "" Then
                            abfrage$ = "select b." & Feld & " from  beteiligte b  where b.betnr=" & betnr
                        Else
                            abfrage$ = "select b." & Feld & " from betakt bt, akten a, beteiligte b  where b.betnr=bt.betnr and a.nr = bt.nr And a.nr = " & Anr & _
                                        " And lfd=" & GetDocVar("adressat")
                        End If
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                        erg$ = Left(WordRequest(erg$), laenge)
                ElseIf Feld$ <> "VERTRETER" Then
                    If bet$ = "" Or bet$ = "0" Then                         '(kz = 5 -> Gegenanwalt)
                        'Betnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "betnr_muster")
                        ' Das darf so nicht gemacht werden, weil sonst die Platzhalter "Beteiligte" nur funktionieren, wenn die beteiligtenart auch angeschrieben wird.
                        If 1 = 2 And betnr <> "" And betnr <> "0" Then
                            'Hier darf nicht reingesprungen werden (s.oben)
                            abfrage$ = ", betakt, akten where akten.nr = betakt.nr And bet Is Null And akten.nr = " & Anr & _
                                        " And kz = " & kz$ & " and betakt.betnr = " & betnr
                        ElseIf 1 = 2 And kz$ = "1" And betnr <> "" And betnr <> "0" Then
                             'Hier darf nicht reingesprungen werden, weil sonst die Daten von Untergeordneten gezogen werden.
                           'wegen den Fehler in betakt => bei Mandant soll bet=Null
                            abfrage$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                        " And kz = " & kz$ & " and betakt.betnr = " & betnr
                        ElseIf kz$ = "" And bet = "" And betnr <> "" And betnr <> "0" Then
                            abfrage$ = ", betakt where beteiligte.betnr = " & betnr
                        Else
                            abfrage$ = ", betakt, akten where akten.nr = betakt.nr And (bet Is Null or bet = " & kz$ & ") And akten.nr = " & Anr & _
                                        " And betakt.kz = " & kz$ & " And rang = " & rang$
                        End If
                        abfrage$ = GetTB(Feld, abfrage$, betnr)
                        If Feld = "ANZAHLKINDER" Then
                            abfrage$ = "select count(*) from betakt where art='Kind' and nr = " & Anr
                        ElseIf Feld = "POSITION" Then
                            abfrage$ = "select stellung from betakt where betnr = " & betnr & " and nr = " & Anr
                            X = WordExecute(abfrage)
                            erg$ = String(255, " ")
                            erg$ = Left(WordRequest(erg$), laenge)
                            If erg$ = "" Then
                                abfrage$ = "select art from betakt where betnr = " & betnr & " and nr = " & Anr
                            End If
                        ElseIf Feld = "ALTER" Or Feld = "EINKOMMEN" Or Feld = "SITZ" Then
                            abfrage$ = GetAbfrage(Feld$, abfrage$, betnr$)
                        End If
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                    
                        erg$ = Left(WordRequest(erg$), laenge)
                        If Feld = "SELBSTBETEILIGUNG" Then
                            Index$ = "n"
                        ElseIf Feld = "IBAN" Then   ' 07.11.2016(mp): IBAN leserlich machen
                            If Len(erg$) = 22 Then
                                erg$ = Mid(erg, 1, 4) & " " & Mid(erg, 5, 4) & " " & Mid(erg, 9, 4) & " " & Mid(erg, 13, 4) & " " & Mid(erg, 17, 4) & " " & Mid(erg, 21, 2)
                            End If
                        End If
                        If Feld = "ADVONETEMAIL" And erg$ = "" Then
                            abfrage$ = ", betakt, akten where akten.nr = betakt.nr And bet Is Null And akten.nr = " & Anr & _
                                        " And kz = " & kz$ & " And rang = " & rang$
                            abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                                        " And betakt.betnr = kommunikation.betnr And ( komm_kz=4 or komm_kz=8 )"
                            X = WordExecute(abfrage)
                            erg$ = String(255, " ")
                            erg$ = Left(WordRequest(erg$), laenge)
                        End If
                        If Feld = "WEITEREADRESSE" And erg$ = "" Then
                            abfrageA$ = ", betakt, akten where akten.nr = betakt.nr And bet Is Null And akten.nr = " & Anr & _
                                        " And kz = " & kz$ & " And rang = " & rang$ & "  And betakt.betnr = adresse.betnr "
                            abfrage$ = "select count(adnr) from adresse" & abfrageA$
                            X = WordExecute(abfrage)
                            erg$ = String(255, " ")
                            erg$ = Left(WordRequest(erg$), laenge)
                            pos1$ = erg$
                            pos2$ = ""
                            pos3$ = "1"
                            While pos3$ <= pos1
                                abfrage$ = "select strasse||@if(@isna(strasse),'', ', ')||plz||' '||ort||@if(@isna(ort),'', ', ')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ' (') || @DATETOCHAR(GUELTIG_VON,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ' - ')||@DATETOCHAR(GUELTIG_BIS,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ')')  from ADRESSE" & abfrageA$ & " and adnr=" & pos3$
                                X = WordExecute(abfrage)
                                erg$ = String(255, " ")
                                erg$ = Left(WordRequest(erg$), laenge)
                                pos2$ = pos2$ + Chr(13) + Chr(10) + erg$
                                pos3$ = pos3$ + 1
                            Wend
                            erg$ = pos2$
                        End If
                        If Feld = "EMAILGESCHAEFTLICHALLE" Then
                            X = WordExecute("select tlf from kommunikation, betakt, akten where akten.nr = betakt.nr And bet Is Null And akten.nr = " & Anr & _
                                        " And kz = " & kz$ & " And rang = " & rang$ & "  And betakt.betnr = kommunikation.betnr and komm_kz = 4")
                            ret$ = String(255, " ")
                            ret$ = Left(WordRequest(ret$), laenge)
                            While ret$ <> ""
                                If erg <> "" Then erg = erg & "; "
                                erg = erg & ret
                                ret$ = String(255, " ")
                                ret$ = Left(WordRequest(ret$), laenge)
                            Wend
                        End If
                    'bet$ = "" Or bet$ = "0"
                    ElseIf bet$ = "V" Then
                        abfrage$ = "select " & Feld & " from beteiligte where betnr = " & betnr$
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                        erg$ = Left(WordRequest(erg$), laenge)
                    ElseIf bet$ = "GV" Or bet$ = "UV" Then
                        X = 3
                        If bet$ = "GV" Then X = 2
                        abfrage$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                    " AND ebene = " & X
                        abfrage$ = GetTB(Feld, abfrage, betnr) & "  order by betakt.lfd "
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                        erg$ = Left(WordRequest(erg$), laenge)
                    ElseIf bet$ = "G" Then
'                        If betnr <> "" Then
'                            abfrage$ = ", betakt, akten where betakt.kz=2 and akten.nr = betakt.nr And akten.nr = " & Anr & _
'                                    " AND (betakt.master = " & betnr & " or betakt.betnr = " & betnr & ") "
'                        Else
                        abfrage$ = ", betakt, akten where betakt.kz=2 and akten.nr = betakt.nr And akten.nr = " & Anr & _
                                    " AND bet = " & kz$
                        If Name$ <> "" Then
                            abfrage$ = GetKind(Name$, rang$, 2, Anr, abfrage)
                        End If
                        abfrage$ = GetTB(Feld, abfrage, betnr)
                        
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                        erg$ = Left(WordRequest(erg$), laenge)
                        If Feld = "WEITEREADRESSE" And erg$ = "" Then
                             abfrageA$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                        " And bet = " & kz$ & " And kz=2 And betakt.betnr = adresse.betnr "
                             abfrage$ = "select count(adnr) from adresse" & abfrageA$
                             X = WordExecute(abfrage)
                             erg$ = String(255, " ")
                             erg$ = Left(WordRequest(erg$), laenge)
                             pos1$ = erg$
                             pos2$ = ""
                             pos3$ = "1"
                             While pos3$ <= pos1
                                  abfrage$ = "select plz||' '||ort||@if(@isna(strasse),'', ', ')||strasse||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ', (') || @DATETOCHAR(GUELTIG_VON,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ' - ')||@DATETOCHAR(GUELTIG_BIS,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ')')  from ADRESSE" & abfrageA$ & " and adnr=" & pos3$
                                  X = WordExecute(abfrage)
                                  erg$ = String(255, " ")
                                  erg$ = Left(WordRequest(erg$), laenge)
                                  pos2$ = pos2$ + Chr(13) + Chr(10) + erg$
                                  pos3$ = pos3$ + 1
                             Wend
                             erg$ = pos2$
                          End If
                    'bet$ = "G"
                    ElseIf bet$ = "M" Then
'                        If betnr <> "" Then
'                            abfrage$ = ", betakt, akten where betakt.kz=1 and akten.nr = betakt.nr And akten.nr = " & Anr & _
'                                    " AND (betakt.master = " & betnr & " or betakt.betnr = " & betnr & ") "
'                        Else
                        abfrage$ = ", betakt, akten where betakt.kz=1 and akten.nr = betakt.nr And akten.nr = " & Anr & _
                                    " AND bet = " & kz$
                        If Name$ <> "" Then
                            abfrage$ = GetKind(Name$, rang$, 1, Anr, abfrage)
                        End If
                        abfrage$ = GetTB(Feld, abfrage, betnr)
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                        erg$ = Left(WordRequest(erg$), laenge)
                        If Feld = "WEITEREADRESSE" And erg$ = "" Then
                             abfrageA$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                        " And bet = " & kz$ & " And kz=1 And betakt.betnr = adresse.betnr "
                             abfrage$ = "select count(adnr) from adresse" & abfrageA$
                             X = WordExecute(abfrage)
                             erg$ = String(255, " ")
                             erg$ = Left(WordRequest(erg$), laenge)
                             pos1$ = erg$
                             pos2$ = ""
                             pos3$ = "1"
                             While pos3$ <= pos1
                                  abfrage$ = "select plz||' '||ort||@if(@isna(strasse),'', ', ')||strasse||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ', (') || @DATETOCHAR(GUELTIG_VON,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ' - ')||@DATETOCHAR(GUELTIG_BIS,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ')')  from ADRESSE" & abfrageA$ & " and adnr=" & pos3$
                                  X = WordExecute(abfrage)
                                  erg$ = String(255, " ")
                                  erg$ = Left(WordRequest(erg$), laenge)
                                  pos2$ = pos2$ + Chr(13) + Chr(10) + erg$
                                  pos3$ = pos3$ + 1
                             Wend
                             erg$ = pos2$
                          End If
                    'bet$ = "M"
                    ElseIf bet$ = "GV" Or bet$ = "GV" Then
                        abfrage$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                    " AND betakt.ebene = 2" & kz$
                        abfrage$ = GetTB(Feld, abfrage, betnr)
                        X = WordExecute(abfrage)
                        erg$ = String(255, " ")
                        erg$ = Left(WordRequest(erg$), laenge)
                    ElseIf bet$ = "a" Then
                        erg$ = ""
                        If Feld = "TELEFAX" Then 'Altlasten, alter Platzhalter
                            erg$ = GetDocVar("telefax")
                        End If
                        If Feld = "LANDESKUERZEL" Then
                            abfrage$ = "select land from adresse where betnr = " & betnr & " and adnr=1 "
                            X = WordExecute(abfrage)
                            erg$ = String(255, " ")
                            erg$ = Left(WordRequest(erg$), laenge)
                            If erg$ = "" Then
                                erg$ = " "
                            End If
                        End If
                        If erg$ = "" Then
                            If lfd$ = "" Or lfd$ = "0" Then
                                For Each aVar In ActiveDocument.Variables
                                    If StrConv(Left(aVar.Name, 5), vbLowerCase) = "betnr" Then
                                         lfd = "-" & aVar.Value
                                    ElseIf StrConv(Left(aVar.Name, 8), vbLowerCase) = "adressat" Then
                                         lfd = "" & aVar.Value
                                    End If
                                Next aVar
                            End If
                            If lfd$ = "" And betnr <> "" Then
                                abfrage$ = " betnr = " & betnr
                                abfrage$ = GetTBK(Feld, abfrage)
                            ElseIf Left(lfd$, 1) = "-" Then
                                abfrage$ = " betnr = " & Mid(lfd$, 2)
                                abfrage$ = GetTBK(Feld, abfrage)
                            ElseIf lfd$ <> "" And lfd$ <> "0" Then
                                abfrage$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                            " And lfd = " & lfd$
                                abfrage$ = GetTB(Feld, abfrage, betnr)
                            End If
                            If abfrage$ <> "" Then
                                X = WordExecute(abfrage)
                                erg$ = String(255, " ")
                                erg$ = Left(WordRequest(erg$), laenge)
                            End If
                        End If
                    'bet$ = "a"
                    Else
                        If bet$ = "1" Then
                            abfrage$ = "select count(*) from beteiligte b, betakt bt, akten a where a.nr = bt.nr And bt.betnr = b.betnr And a.nr = " & Anr & " And bet = " & kz$ & " And bet > 0 order by rang"
                            X = WordExecute(abfrage)
                            erg$ = String(255, " ")
                            erg$ = Left(WordRequest(erg$), laenge)
                            abfrage$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                            " And bet = " & kz$
                            If erg$ = "0" And kz$ = 5 Then
                                abfrage$ = "select count(*) from beteiligte b, betakt bt, akten a where a.nr = bt.nr And bt.betnr = b.betnr And a.nr = " & Anr & " And kz = " & kz$ & " order by rang"
                                X = WordExecute(abfrage)
                                erg$ = String(255, " ")
                                erg$ = Left(WordRequest(erg$), laenge)
                                abfrage$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                            " And kz = " & kz$
                            End If
                            If erg$ < "1" Then
                                If erg$ = "0" Then
                                    erg$ = ""
                                Else
                                    MsgBox "Advoware kann f|fffd|r mindestens einen untergeordneten Beteiligten nicht alle Platzhalter ausf|fffd|llen. |fffd|berpr|fffd|fen Sie das Dokument.", vbExclamation, GetApplicationName()
                                    erg$ = "*"
                                End If
                            Else
                                abfrage$ = GetTB(Feld, abfrage, betnr)
                                abfrage$ = abfrage$ & " order by rang"
                                X = WordExecute(abfrage)
                                erg$ = String(255, " ")
                                erg$ = Left(WordRequest(erg$), laenge)
                                If Feld = "WEITEREADRESSE" And erg$ = "" Then
                                    abfrageA$ = ", betakt, akten where akten.nr = betakt.nr And akten.nr = " & Anr & _
                                        " And bet = " & kz$ & " And bet > 0 And betakt.betnr = adresse.betnr "
                                    abfrage$ = "select count(adnr) from adresse" & abfrageA$
                                    X = WordExecute(abfrage)
                                    erg$ = String(255, " ")
                                    erg$ = Left(WordRequest(erg$), laenge)
                                    pos1$ = erg$
                                    pos2$ = ""
                                    pos3$ = "1"
                                    While pos3$ <= pos1
                                        abfrage$ = "select plz||' '||ort||@if(@isna(strasse),'', ', ')||strasse||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ', (') || @DATETOCHAR(GUELTIG_VON,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ' - ')||@DATETOCHAR(GUELTIG_BIS,'dd.MM.yyyy')||@if(@isna(GUELTIG_VON)*@isna(GUELTIG_BIS ),'', ')')  from ADRESSE" & abfrageA$ & " and adnr=" & pos3$
                                        X = WordExecute(abfrage)
                                        erg$ = String(255, " ")
                                        erg$ = Left(WordRequest(erg$), laenge)
                                        pos2$ = pos2$ + Chr(13) + Chr(10) + erg$
                                        pos3$ = pos3$ + 1
                                    Wend
                                    erg$ = pos2$
                                End If
                            End If
                        Else
                            abfrage$ = ", betakt, akten where akten.nr = betakt.nrAnd akten.nr = " & Anr & _
                                        " And kz = " & kz$ & " And bet = " & bet$ & " And rang = " & rang$
                            abfrage$ = GetTB(Feld, abfrage, betnr)
                            X = WordExecute(abfrage)
                            erg$ = String(255, " ")
                            erg$ = Left(WordRequest(erg$), laenge)
                        End If
                    End If  'bet$ != "1"
                    If Feld = "SELBSTBETEILIGUNG" Or Feld = "EINKOMMEN" Then
'                        xy = erg$
'                        erg$ = Format(xy, "##,###.##")
'                        lfd$ = erg$
'                        erg$ = FormatNumber(erg$, -1)
'                        erg$ = lfd$
                        lfd$ = InStr(erg$, ".")
                        If lfd$ = "0" Then
                            erg$ = erg$ + ",00"
                        Else
                            erg$ = ReplaceX(erg$, ".", ",")
                            If Len(erg$) - lfd$ = 1 Then
                                erg$ = erg$ + "0"
                            End If
                        End If
                        erg$ = Format(erg$, "#,##0.00")
                    End If
                End If  'Feld$ <> "VERTRETER"
    GetBeteiligte = erg$
End Function

Function fKeineforderungsaufstellung(Datei$) As Long

If Datei = "faufstatus" Or Datei = "forderungsaufstellungverk|fffd|rzt" Then
    If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "keineforderungsaufstellung") = "1" Then
        fKeineforderungsaufstellung = 1
    Else
        fKeineforderungsaufstellung 0
    End If
Else
    fKeineforderungsaufstellung = 0
End If
End Function

Function GetFristenzettel(Feld$) As String
Dim X
Dim nKz, Frnr, nMaster, n1, n2, Hnr
Dim rang$, abfrage$, Sb, s1, s2
Dim bet$
Dim erg$, ret$, Status
Dim v1 As Variant, v2 As Variant
                    Frnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Frnr")
                    X = WordExecute("SELECT kz FROM fristen WHERE frnr = " & Frnr)
                    ret$ = String(255, " ")
                    nKz = Left$(WordRequest(ret$), laenge)
                    X = WordExecute("SELECT master FROM fristen WHERE frnr = " & Frnr)
                    ret$ = String(255, " ")
                    nMaster = Left$(WordRequest(ret$), laenge)
                    erg$ = String(255, " ")
                    If Feld$ = "FRISTDATUM" Then
                        abfrage$ = "SELECT count( 1 )  from fristenhistory WHERE frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        n1 = 0
                        ret$ = String(255, " ")
                        n1 = Left$(WordRequest(ret$), laenge)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        If nKz = 4 Then
                            abfrage$ = "SELECT datum from fristen WHERE frnr = " & nMaster
                        ElseIf nKz = 1 Then
                            abfrage$ = "SELECT datum from fristen WHERE frnr = " & Frnr
                        End If
                        X = WordExecute(abfrage$)
                        v1 = String(255, " ")
                        v1 = Left$(WordRequest(ret$), laenge)
                        v1 = Left(v1, 10)
                        erg$ = WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                        s2 = "  "
                        If n1 > 1 Then
                            X = WordExecute("SELECT max(datum) from fristenhistory WHERE frnr = " & Frnr)
                            v1 = String(255, " ")
                            v1 = Left$(WordRequest(ret$), laenge)
                            X = WordExecute("SELECT benutzer from fristenhistory WHERE datum = " & v1)
                            Sb = String(255, " ")
                            Sb = Left$(WordRequest(ret$), laenge)
                            If X <> 0 Then
                                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                                GoTo Ende
                            End If
                            v1 = Left(v1, 10)
                            s1 = Day(v1) & "." & Month(v1) & "." & Year(v1)
                            s1 = Chr(13) + Chr(10) + "                              (ge|fffd|ndert am " & s1 & " von " & Sb & " )"
                        End If
                        If nKz = 11 Then
                            X = WordExecute("SELECT count( 1 )  from fristen WHERE master = " & Frnr & " and kz=4 and ( erledigt = 0 or erledigt is null ) order by datum")
                            n1 = 0
                            n1 = Left$(WordRequest(ret$), laenge)
                            n2 = 0
                            s2 = ""
                            n1 = CInt2(String(n1, 0))
                            X = WordExecute("SELECT datum from fristen WHERE master = " & Frnr & " and kz=4 and ( erledigt = 0 or erledigt is null ) order by datum")
                            While n2 < n1
                                v1 = String(255, " ")
                                v1 = Left$(WordRequest(ret$), laenge)
                                v1 = Left(v1, 10)
                                s2 = s2 & " , " & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                                n2 = n2 + 1
                            Wend
                        End If
                        If nKz = 1 Then
                            erg$ = erg$ & s1
                        End If
                    ElseIf Feld$ = "FRISTVERLAUF" Then
                        abfrage$ = "SELECT count( * )  from fristenhistory WHERE  datumbeginn is not null and frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        n1 = 0
                        ret$ = String(255, " ")
                        n1 = Left$(WordRequest(ret$), laenge)
                        If n1 < 2 Then
                            erg$ = ""
                        Else
                            If X <> 0 Then
                                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                                GoTo Ende
                            End If
                            If nKz = 4 Then
                                abfrage$ = "SELECT datum from fristen WHERE frnr = " & nMaster
                            ElseIf nKz = 1 Then
                                abfrage$ = "SELECT datum from fristen WHERE frnr = " & Frnr
                            End If
                            X = WordExecute(abfrage$)
                            v1 = String(255, " ")
                            v1 = Left$(WordRequest(ret$), laenge)
                            v1 = Left(v1, 10)
                            erg$ = "                                             " & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                            s2 = "  "
                            s1 = "  "
                            abfrage$ = "SELECT datum from fristenhistory WHERE datumbeginn is not null and frnr = " & Frnr & " order by datum  "
                            X = WordExecute(abfrage$)
                            ret$ = String(255, " ")
                            ReDim vDatum$(n1)
                            For X = 1 To n1 - 1
                                vDatum$(X) = Left$(WordRequest(ret$), laenge)
                            Next
                            While n1 > 1
                                n1 = n1 - 1
                                v1 = vDatum$(n1)
                                abfrage$ = "SELECT benutzer || ' ( ' || status from fristenhistory WHERE datumbeginn is not null and frnr = " & Frnr & " and datum = " & v1
                                X = WordExecute(abfrage$)
                                Sb = String(255, " ")
                                Sb = Left$(WordRequest(ret$), laenge)
                                If X <> 0 Then
                                    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                                    GoTo Ende
                                End If
                                abfrage$ = "SELECT datum_frist from fristenhistory WHERE datumbeginn is not null and frnr = " & Frnr & " and datum = " & v1
                                X = WordExecute(abfrage$)
                                v2 = String(255, " ")
                                v2 = Left$(WordRequest(ret$), laenge)
                                s2 = Day(v2) & "." & Month(v2) & "." & Year(v2)
                                v2 = Left(v2, 10)
                                v1 = Left(v1, 10)
                                s1 = Day(v1) & "." & Month(v1) & "." & Year(v1)
                                '& Mid(v1.String, 11, 2)
                                s1 = Chr(13) + Chr(10) + "                                             " & s2 & " ge|fffd|ndert am " & s1 & " von " & Sb & " )"
                                erg$ = erg$ & s1
                            Wend
                            If nKz = 11 Then
                                X = WordExecute("SELECT count( 1 )  from fristen WHERE master = " & Frnr & " and kz=4 and ( erledigt = 0 or erledigt is null ) order by datum")
                                n1 = 0
                                n1 = Left$(WordRequest(ret$), laenge)
                                n2 = 0
                                s2 = ""
                                n1 = CInt2(String(n1, 0))
                                X = WordExecute("SELECT datum from fristen WHERE master = " & Frnr & " and kz=4 and ( erledigt = 0 or erledigt is null ) order by datum")
                                While n2 < n1
                                    v1 = String(255, " ")
                                    v1 = Left$(WordRequest(ret$), laenge)
                                    v1 = Left(v1, 10)
                                    s2 = s2 & " , " & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                                    n2 = n2 + 1
                                Wend
                            End If
                        End If
                    ElseIf Feld$ = "VORFRISTDATUM" Then
                        s2 = "  "
                        If nKz = 1 Then
                            X = WordExecute("SELECT count( 1 )  from fristen WHERE master = " & Frnr & " and kz=4 and ( erledigt = 0 or erledigt is null ) order by datum")
                            n1 = 0
                            n1 = Left$(WordRequest(ret$), laenge)
                            n2 = 0
                            n1 = CInt2(String(n1, 0))
                            X = WordExecute("SELECT datum from fristen WHERE master = " & Frnr & " and kz=4 and ( erledigt = 0 or erledigt is null ) order by datum")
                            While n2 < n1
                                v1 = String(255, " ")
                                v1 = Left$(WordRequest(ret$), laenge)
                                v1 = Left(v1, 10)
                                If n2 = 0 Then
                                    erg$ = WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                                Else
                                    erg$ = erg$ & Chr(13) + Chr(10) & "                                            " & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                                End If
                                n2 = n2 + 1
                            Wend
                        ElseIf nKz = 4 Then
                            abfrage$ = "SELECT datum from fristen WHERE frnr = " & Frnr
                            X = WordExecute(abfrage$)
                            v1 = String(255, " ")
                            v1 = Left$(WordRequest(ret$), laenge)
                            v1 = Left(v1, 10)
                            erg$ = WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                            abfrage$ = "SELECT datum from fristenhistory WHERE status <> " & "'Neueintrag'" & " and frnr = " & Frnr
                            X = WordExecute(abfrage$)
                            v1 = String(255, " ")
                            v1 = Left$(WordRequest(ret$), laenge)
                            v1 = Left(v1, 10)
                            If v1 <> "" Then
                                s2 = "                                             (ge|fffd|ndert am "
                                s2 = s2 & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                                abfrage$ = "SELECT benutzer from fristenhistory WHERE status <> " & "'Neueintrag'" & " and frnr = " & Frnr
                                X = WordExecute(abfrage$)
                                v1 = String(255, " ")
                                v1 = Left$(WordRequest(ret$), laenge)
                                erg$ = erg$ & Chr(13) + Chr(10) & s2 & " von " & v1 & ")"
                            End If
                        End If
                        
                    ElseIf Feld$ = "FRISTBEGINNDATUM" Then
                        If nKz = 1 Then
                            abfrage$ = "SELECT datumbeginn from fristen WHERE frnr = " & Frnr
                        ElseIf nKz = 4 Then
                            abfrage$ = "SELECT datumbeginn from fristen WHERE frnr = " & nMaster
                        End If
                        X = WordExecute(abfrage$)
                        v1 = String(255, " ")
                        v1 = Left$(WordRequest(ret$), laenge)
                        v1 = Left(v1, 10)
                        erg$ = WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                    ElseIf Feld$ = "DAUERFZ" Then
                        If nKz = 1 Then
                            X = WordExecute("SELECT datum-datumbeginn from fristen WHERE frnr = " & Frnr)
                            v1 = String(255, " ")
                            v1 = Left$(WordRequest(ret$), laenge)
                            n1 = v1 / 7
                            n2 = v1 - n1 * 7
                            If n1 > 0 Then erg$ = Str(n1) & " Wochen "
                            If n2 > 0 Then erg$ = erg$ & " und " & Str(n2) & " Tagen "
                            If v1 > "0" Then erg$ = erg$ & "(" & v1 & " Tagen)"
                        End If
                    ElseIf Feld$ = "FRISTSTATUS" Then
                        X = WordExecute("SELECT erledigt_datum from fristen WHERE frnr = " & Frnr)
                        v1 = String(255, " ")
                        v1 = Left$(WordRequest(ret$), laenge)
                        v1 = Left(v1, 10)
                        X = WordExecute("SELECT erledigt from fristen WHERE frnr = " & Frnr)
                        s1 = String(255, " ")
                        s1 = Left$(WordRequest(ret$), laenge)
                        X = WordExecute("SELECT status from fristen WHERE frnr = " & Frnr)
                        Status = String(255, " ")
                        Status = Left$(WordRequest(ret$), laenge)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                        If s1 = "1" Then Status = "erledigt"
                        If Status = "" Or Status = "offen" Then
                            erg$ = "offen"
                        ElseIf Status = "erledigt" Or s1 = "1" Then
                            erg$ = "erledigt am " & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                        ElseIf Status = "gel|fffd|scht" Or s1 = "2" Then
                            erg$ = "gel|fffd|scht am " & WeekdayName(Weekday(v1) - 1) & ", " & Day(v1) & ". " & MonthName(Month(v1)) & " " & Year(v1)
                        End If
                        
                    ElseIf Feld$ = "NOTFRIST" Then
                        abfrage$ = "SELECT notfrist FROM fristen WHERE frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        v1 = String(255, " ")
                        v1 = Left$(WordRequest(ret$), laenge)
                        erg$ = "Nein"
                        If v1 = "1" Then erg$ = "Ja"
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                    ElseIf Feld$ = "FRISTART" Then
                        abfrage$ = "SELECT art FROM fristen WHERE frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        erg$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                    ElseIf Feld$ = "BENUTZERNAME" Then
                        abfrage$ = "select max(datum) from fristenhistory WHERE frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        v1 = String(255, " ")
                        v1 = Left$(WordRequest(ret$), laenge)
                        If v1 <> "" Then
                            abfrage$ = "select m.name from mitarbeiter m, fristenhistory f WHERE f.benutzer = m.kuerzel and frnr = " & Frnr & " and f.datum = (select max(datum) from fristenhistory where frnr = " & Frnr & ")"
                        End If
                        X = WordExecute(abfrage$)
                        erg$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                    ElseIf Feld$ = "SB" Then
                        abfrage$ = "select m.name from mitarbeiter m, fristen f WHERE f.sb = m.kuerzel and frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        erg$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                    ElseIf Feld$ = "FRISTBEZEICHNUNG" Then
                        If Frnr = "" Then Frnr = "0"
                        abfrage$ = "SELECT text FROM fristen WHERE frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        erg$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                    ElseIf Feld$ = "FRISTNOTIZEN" Or Feld$ = "FRISTBEMERKUNG" Then
                        If Frnr = "" Then Frnr = "0"
                        abfrage$ = "SELECT notizen FROM fristen WHERE frnr = " & Frnr
                        X = WordExecute(abfrage$)
                        erg$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                    ElseIf Feld$ = "DATEIPFAD" Then
                        Hnr = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Hnr")
                        If Hnr = "" Then
                            erg$ = String(255, " ")
                        Else
                            abfrage$ = "SELECT datei FROM history WHERE hnr = " & Hnr
                            X = WordExecute(abfrage$)
                            erg$ = String(255, " ")
                            erg$ = Left$(WordRequest(ret$), laenge)
                        End If
                        If X <> 0 Then
                            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                            GoTo Ende
                        End If
                   End If
     GetFristenzettel = erg$
Ende:

X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Function
                        
Attribute VB_Name = "AutoExec"
Option Explicit
Public Sub main()
  
Call AutoExecAdvoware.main
Ende:
If Err.Number <> 0 Then MsgBox Err.Description
End Sub
Attribute VB_Name = "AutoExecAdvoware"
Option Explicit
Public AdvoApp As New clsApplication


Private Declare Function SetEnvironmentVariable _
  Lib "kernel32" Alias "SetEnvironmentVariableA" ( _
  ByVal EnvironmentVariableName As String, _
  ByVal EnvironmentVariableValue As String _
  ) As Long


Public Sub main()
Dim Programdir$
Dim s$
Dim aTemp As Template
Dim bKeineSymbolleiste As Boolean
Set AdvoApp.WordApp = Application
SetDatabaseReg
If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "advowaredotversion") <> "5.34" Then System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "advowaredotversion") = "5.34"

Programdir$ = GetProgramdir
SetEnvironmentVariable "path", Programdir$
    
bKeineSymbolleiste = False
For Each aTemp In Templates
    If LCase(aTemp.Name) = "advoware.dotm" Then
        bKeineSymbolleiste = True
    End If
Next aTemp

If bKeineSymbolleiste = True Then
    CommandBars("Advo-ware").Visible = False
Else
    If Windows.count = 0 Then
        Documents.Add
        CommandBars("Advo-ware").Visible = True

        ActiveDocument.Close
    Else
        CommandBars("Advo-ware").Visible = True
    End If
End If

SymbolleisteAktualisieren.DokumentordnerFestlegen (GetUser)
SymbolleisteAktualisieren.main

ActiviereRibbon '07.02.2019 mp: Bug in Word 2016: Wird Word |fffd|ber ActiveX gestartet, wird ide Ribbonbar nicht angezeigt
End Sub
 
Sub ActiviereRibbon()
 '07.02.2019 mp: Bug in Word 2016: Wird Word |fffd|ber ActiveX gestartet, wird ide Ribbonbar nicht angezeigt
' Kann ausgebaut werden, wenn Bug duch Microsift behoben
Dim eineVorlage As Template

Dim path$
For Each eineVorlage In Templates
    If LCase(eineVorlage.Name) = "aadvoware.dotm" Then
        path$ = eineVorlage.Fullname
    End If
Next eineVorlage
If path <> "" Then
    AddIns(path$).Installed = False
    AddIns(path$).Installed = True
End If


End Sub

Attribute VB_Name = "AutoExit"

Sub main()
'DisconnectHandles
'If AddIns.Count > 0 Then AddIns.Unload RemoveFromList:=False
End Sub
Attribute VB_Name = "AutotexteVorlage"
Option Explicit

Sub main()  ' |fffd|ndert die Formatvorlage f|fffd|r die Advoware-Autotexte(b*, b1..,g1,g2...,m*,m1),
            ' damit die Advoware-Autotexte   in einem eigenen Untermen|fffd| angezeigt werden.
Exit Sub
Dim ae As AutoTextEntry
Dim aTemp As Template
Dim aTempAT As Template
For Each aTemp In Templates
    If LCase(aTemp.Name) = "normal.dot" Then
        Exit For
    End If
Next aTemp
   
For Each aTempAT In Templates
    If LCase(aTempAT.Name) = "advoware.dot" Then
        Exit For
    End If
Next aTempAT

For Each ae In aTempAT.AutoTextEntries
    ae.Delete
Next
  
For Each ae In aTemp.AutoTextEntries
    ae.Insert where:=Selection.Range, RichText:=True
    Selection.HomeKey Unit:=wdLine, Extend:=wdExtend
    Selection.style = ActiveDocument.Styles("Advoware")
    aTempAT.AutoTextEntries.Add Name:=ae.Name, Range:=Selection.Range
Next
For Each ae In aTempAT.AutoTextEntries
    Application.OrganizerCopy Source:="D:\Advoweb\Advoware\Startup\AT.dot", _
        Destination:= _
        "D:\Advoweb\Advoware\Startup\Advoware.dot" _
        , Name:=ae.Name, Object:=wdOrganizerObjectAutoText
Next
End Sub


Attribute VB_Name = "DokumentZurAdressgruppe"


Sub main()

    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DokumentZurAdressgruppe") = ActiveDocument.Fullname
    Advoware.main
    'ActiveDocument.Close
    fSendMessageAdvoware 36, 0

End Sub
Attribute VB_Name = "DokumentvariablenAnzeigen"
Option Explicit

Sub main()
Dim v As Variable

For Each v In ActiveDocument.Variables
Selection.TypeText v.Name & ": " & v.Value
Selection.TypeParagraph
Next
End Sub

Attribute VB_Name = "DokumentvariablenL|fffd|schen"
Sub main()
Dim d As Variable
Dim Name As String


For Each d In ActiveDocument.Variables
    Name$ = d.Name
    If Left$(Name$, 7) <> "dgnword" And Left$(Name$, 8) <> "IPSpeech" _
    And Left$(Name$, 5) <> "VType" And Name$ <> "Dragon" And Name$ <> "Diktatnr" Then
        d.Delete
    End If
Next
End Sub



Attribute VB_Name = "EMail"
Option Explicit

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Sub main()
main2 "", ""
End Sub

Sub main2(sAdvonet$, sEmail$)
Dim ret$
Dim X As Integer
Dim Pfad$, Datei$
Dim Pfad2$, Datei2$
Dim Dummy As String
Dim Outlook As Object
Dim myOlApp As Object
Dim myAttachments As Object
Dim myNameSpace As Object
Dim myItem As Object
Dim Anr$
Dim nr$
Dim betnr$
Dim position(10) As String
Dim sEmailBetreff(10) As String
Dim sBetreff$
Dim sBanrede$
Dim sName$
Dim n1
Dim sBody
Dim sOutlookversion$
Dim sBemerkung$
Dim pdf$

On Error GoTo Ende
ret$ = String(255, " ")

If Documents.count = 0 Then
    MsgBox "Es ist kein Dokument zum Versenden ge|fffd|ffnet.", vbExclamation, GetApplicationName()
Else
    X = 0
    nr$ = GetDocVar("nr")
    
    If Val(nr$) = 0 Then
        nr$ = GetAnr(1)
    End If
    
    If nr$ = "" Then nr$ = "0"
    
    betnr$ = GetDocVar("betnr")
    If betnr$ = "" Then betnr$ = "0"

    If sAdvonet$ = "" Then
        If betnr$ <> "0" And nr$ <> "0" Then
            X = WordExecute("select position1 from email_betreff")
            position(1) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position2 from email_betreff")
            position(2) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position3 from email_betreff")
            position(3) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position4 from email_betreff")
            position(4) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position5 from email_betreff")
            position(5) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position6 from email_betreff")
            position(6) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position7 from email_betreff")
            position(7) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position8 from email_betreff")
            position(8) = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select position9 from email_betreff")
            position(9) = Left$(WordRequest(ret$), laenge)
        
            n1 = 1
            While n1 < 10
                If position(n1) = "Betreff" Then
                    sEmailBetreff(n1) = GetBetreff(betnr$, "", nr$)
                ElseIf position(n1) = "Rubrum" Then
                    X = WordExecute("select rubrum from akten where nr = " & nr$)
                    sEmailBetreff(n1) = Left$(WordRequest(ret$), laenge)
                ElseIf position(n1) = "Aktenzeichen" Then
                    X = WordExecute("select az from akten where nr = " & nr$)
                    sEmailBetreff(n1) = Left$(WordRequest(ret$), laenge)
                ElseIf position(n1) = "Leerzeichen" Then
                    sEmailBetreff(n1) = " "
                Else
                    sEmailBetreff(n1) = position(n1)
                End If
                n1 = n1 + 1
            Wend
        
            sBetreff$ = sEmailBetreff(1) & sEmailBetreff(2) & sEmailBetreff(3) & sEmailBetreff(4) & sEmailBetreff(5) & sEmailBetreff(6) & sEmailBetreff(7) & sEmailBetreff(8) & sEmailBetreff(9)
            If sEmail$ = "" And sAdvonet$ = "" Then
                X = WordExecute("select tlf from kommunikation where komm_kz=4 and betnr = " & betnr$)
                ret = WordRequest(ret$)
                sEmail$ = Left(ret, laenge)
            End If
            
            X = WordExecute("select banrede from beteiligte where betnr = " & betnr$)
            ret = WordRequest(ret$)
            sBanrede$ = Left(ret, laenge)
    
            X = WordExecute("select name from betakt where betnr = " & betnr$)
            ret = WordRequest(ret$)
            sName$ = Left(ret, laenge)
        End If
    Else
        X = WordExecute("select az from akten where nr = " & nr$)
        sBetreff = "Neuer Vorgang in Akte " & Left$(WordRequest(ret$), laenge)
    End If
    
    Datei$ = ActiveDocument.Name
    Pfad$ = ActiveDocument.path & "\" & Datei$
    
    If (InStr(1, Pfad$, ":\") > 0) Or (InStr(1, Pfad$, "\\") > 0) Then
        If ActiveDocument.Saved = False Then
            ActiveDocument.Save
        End If
        
        If sAdvonet$ = "" Then
            sBemerkung$ = GetDocVar("musterschriftsatz")
            
            If sBemerkung$ = "" Then
                sBemerkung$ = GetDocVar("history")
            End If
            
            If sEmail$ <> "" Then
                sBemerkung$ = "E-Mail an " & sEmail & ": " & sBemerkung$
            End If
            
            SetDocVar "musterschriftsatz", ""
            SetDocVar "history", sBemerkung
            SetDocVar "KeinPostausgang", "1"
            
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0"
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDF") = "0"
            
            Load frmSchliessen
            
            If GetDocVar("history") = "nein" Or GetDocVar("muster") = "ja" Then
                frmSchliessen.Show
            Else
                Unload frmSchliessen
            End If
            
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
            
            pdf$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDF")
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDF") = ""
            
            'If PDF$ = "1" Then
            If LCase$(Right$(Datei$, 4)) = "docx" Then
                Datei2$ = Left$(Datei$, Len(Datei$) - 5) + ".pdf"
                Pfad2$ = Left$(Pfad$, Len(Pfad$) - 5) + ".pdf"
            Else
                Datei2$ = Left$(Datei$, Len(Datei$) - 4) + ".pdf"
                Pfad2$ = Left$(Pfad$, Len(Pfad$) - 4) + ".pdf"
            End If
            If Dir(Pfad2$) <> "" Then
                Pfad$ = Pfad2$
                Datei$ = Datei2$
            End If
        End If
        
        Set myOlApp = CreateObject("Outlook.Application")
        On Error Resume Next
        sOutlookversion = myOlApp.Version
        On Error GoTo Ende

        Set myItem = myOlApp.CreateItem(0)
        
        myItem.To = sEmail$
        myItem.Subject = sBetreff$
        
        Set myAttachments = myItem.Attachments
        
        If sAdvonet = "" Then
            myAttachments.Add Pfad, 1, 1, Datei
        End If
        
        myItem.Display
        
        If sBanrede$ <> "" And sAdvonet = "" Then
            On Error Resume Next
            
            If sOutlookversion = "" Or Left(sOutlookversion, 2) = "97" Or Left(sOutlookversion, 1) = "8" Then
                myItem.body = sBanrede$ & Chr(13) & Chr(10) & myItem.body
                myItem.Save
            ElseIf myItem.BodyFormat = 2 Then
                
                sBody = myItem.HTMLBody
                myItem.HTMLBody = sBanrede$ & Chr(13) & Chr(10) & sBody
            Else
                myItem.body = sBanrede$ & Chr(13) & Chr(10) & myItem.body
                myItem.Save
           End If
        ElseIf sAdvonet = "1" Then
            myItem.Save
            myItem.Close 0
            'myItem.send
        End If
    Else
        MsgBox "Speichern Sie das Dokument vor dem Versenden.", vbExclamation, GetApplicationName()
    End If

End If

Ende:
X = WordExecute("commit")
If Err.Number <> 0 Then MsgBox Err.Description

End Sub

Attribute VB_Name = "Fax"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main()
    Dim StandardDrucker As String
    Dim FaxPrinter As String
    Dim Anr$
    Dim lfd$
    Dim faxnr$
    Dim DocVar As Variable
    Dim ret$
    Dim X As Integer
    Dim DruckerSteuerung As Object
    Set DruckerSteuerung = WordBasic.DialogRecord.FilePrintSetup(False)
    
    ret$ = String(255, " ")
    
    If Documents.count <> 0 Then
        WordBasic.CurValues.FilePrintSetup DruckerSteuerung
        StandardDrucker = DruckerSteuerung.Printer
       
        X = WordExecute("select printer FROM druckereinstellungen where objekt = 'Faxdrucker'")
        
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        Else
            FaxPrinter = Left$(WordRequest(ret$), laenge)
        
            If FaxPrinter <> "" Then
                Anr = GetAnr(1)
                lfd$ = GetDocVar("adressat")
                If lfd$ = "" Or lfd$ = "0" Then
                    lfd$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd")
                End If
                
                X = WordExecute("select tlf FROM kommunikation, betakt where betakt.betnr = kommunikation.betnr and komm_kz=2 and nr = " + Anr + " and lfd = " + lfd$)
                faxnr$ = Left$(WordRequest(ret$), laenge)
                 
                If faxnr$ = "" Then
                    X = WordExecute("select tlf FROM kommunikation, betakt where betakt.betnr = kommunikation.betnr and komm_kz=7 and nr = " + Anr + " and lfd = " + lfd$)
                    faxnr$ = Left$(WordRequest(ret$), laenge)
                End If

                System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Rufnummer") = faxnr$
                System.PrivateProfileString("", "HKEY_CURRENT_USER\Software\AVM\FRITZ! 2.0\FAX", "Rufnummer") = faxnr$
                Application.ActivePrinter = FaxPrinter
                Application.PrintOut
                Application.ActivePrinter = StandardDrucker
            
            Else
                MsgBox "Sie haben in den Grundeinstellungen keinen Faxdrucker eingegeben.", vbExclamation, GetApplicationName()
            End If
        
        End If
    End If

End Sub

Attribute VB_Name = "GlobalFunc"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private sDatabase$
Private sAnwendungsname$

Function InsertIntoPostausgang(sHnrNeu$, sPostausgang_Versendungsart$, sPostausgang_Status$, sSb$, sAnhang$) As Long
Dim X
Dim ret$
Dim kuerzel$
Dim sBarcodenr$
Dim nHnr

kuerzel$ = GetUser
sBarcodenr$ = GetDocVar("barcodenr")

If sBarcodenr$ = "" Then
    sBarcodenr$ = "0"
End If

If sSb$ = "" Then
    X = WordExecute("select sb from akten, history where akten.nr = history.nr and hnr = '" & sHnrNeu & "'")
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    sSb$ = ret$
End If

If sPostausgang_Versendungsart$ = "" Then
    X = WordExecute("select text2 from system where art = 'postausgang' and text2 <> '[keine]'")
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    sPostausgang_Versendungsart$ = ret$
End If

X = WordExecute("select 1 from postausgang where hnr = '" & sHnrNeu & "'")
ret$ = String(255, " ")
ret$ = Left(WordRequest(ret$), laenge)

If ret$ = "" Then
     X = WordExecute("insert into postausgang( HNR, VERSENDUNGSART, BARCODENR, STATUS, DATUM ) " + _
        " values( " & sHnrNeu$ & " ,'" & sPostausgang_Versendungsart$ & "','" & sBarcodenr$ & "','" & sPostausgang_Status$ & "', sysdatetime )")
End If

X = WordExecute("commit")

If sAnhang$ <> "" Then
    X = WordExecute("insert into epost_anhaenge( HNR, DATEI ) values( " & sHnrNeu$ & " ,'" & sAnhang$ + "')")
    X = WordExecute("commit")
End If

X = InsertIntoHistoryAusgang(sHnrNeu$, kuerzel$, sPostausgang_Versendungsart$, sSb$)
X = InsertIntoVorgelegt(sHnrNeu$, kuerzel$, 1, sSb$)

End Function

Function InsertIntoVorgelegt(sHnr$, sBenutzerkuerzel$, kz, sSbAkte$) As Long
Dim X
Dim ret$

X = WordExecute("insert into vorgelegt( hnr, von, an, kz, gelesen )  " + _
        " values('" + sHnr$ + "','" + sBenutzerkuerzel$ + "','" + sSbAkte$ + "', 2, 0 )")

X = WordExecute("commit")
End Function
Function InsertIntoHistoryAusgang(sHnr$, sBenutzerkuerzel$, sPostausgang_Versendungsart$, sSbAkte$) As Long
Dim X
Dim ret$
Dim Postausgang_Status$

X = WordExecute("select status from postausgang where hnr = '" & sHnr$ & "'")
ret$ = String(255, " ")
ret$ = Left(WordRequest(ret$), laenge)
Postausgang_Status$ = ret$

X = WordExecute("insert into history_ausgang( hnr, ha_von, ha_an, ha_status, ha_versendungsart, ha_datum, ha_vorgang ) " + _
" values( " & sHnr$ & " ,'" & sBenutzerkuerzel$ & "','" & sSbAkte$ & "','" & Postausgang_Status$ & "','" & sPostausgang_Versendungsart$ & "', sysdatetime, 'aus Winword' )")
X = WordExecute("commit")
End Function

Function InsertIntoHistoryAccess(sHnr$, sAdvonet$)
Dim i, j, X As Integer
Dim betnr__() As String
Dim email__() As String
Dim erg$
Dim ret$
Dim kuerzel$
Dim sNr$

sNr$ = GetAnr(1)

WordExecute ("delete from history_access where hnr = " + sHnr$)
WordExecute ("commit")

'Folgende Zeilen nicht l|fffd|schen. Notwendig f|fffd|r Sonderprogrammierung
X = WordExecute("update history set advonet=" & sAdvonet$ & " where hnr = " & sHnr$)
X = WordExecute("commit")

ReDim betnr__$(0)
i = 0
X = WordExecute("select distinct beteiligte.betnr from betakt, beteiligte  " + _
    "where nr = " + sNr$ + " and betakt.betnr = beteiligte.betnr  " + _
    "and ( advonetfreigabe = 'J' or ( advonetautofg = 'J' and betakt.kz = 1 ) )")

ret$ = String(255, " ")
erg$ = Left$(WordRequest(ret$), laenge)
betnr__$(0) = erg$

While Len(erg$) > 0
    erg$ = Left$(WordRequest(ret$), laenge)
    
    If Len(erg$) > 0 Then
        i = i + 1
        ReDim Preserve betnr__$(i)
        betnr__$(i) = erg$
    End If
Wend
 
ReDim email__$(0)

For j = 0 To i
    
    If sAdvonet$ = "2" Then
        X = WordExecute("select 1 from beteiligte where betnr = " + betnr__$(j) + " and advonetemail = 'J' ")
        ret$ = String(255, " ")
        erg$ = Left$(WordRequest(ret$), laenge)
        If erg$ = "" Then
            erg$ = "0"
        End If
        
        ReDim Preserve email__$(j)
        email__$(j) = erg$
    Else
        ReDim Preserve email__$(j)
        email__$(j) = "0"
    End If
Next

kuerzel$ = GetUser
For j = 0 To i
    X = WordExecute("insert into history_access(hnr,betnr,email,postausgang,benutzer) values (" + sHnr$ + "," + betnr__$(j) + "," + email__$(j) + ", 1, '" + kuerzel$ + "')")
    WordExecute ("commit")
Next

End Function

Sub VorlageNichtSpeichern()
Dim BVorlage As Template
On Error GoTo Ende

Set BVorlage = ActiveDocument.AttachedTemplate
BVorlage.Saved = True

Ende:

End Sub

Function GetAnr(bArt As Long) As String
'bArt: 0 - Registry wird nach Aktennummer durchsucht
'bArt: 1 - Dokument und Registry wird nach Aktennummer durchsucht
Dim Database$
Dim Anr$

If bArt = 1 Then
    Anr$ = GetDocVar("nr")
End If
If Anr$ = "" Then
    Database$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Database")
    Anr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & Database$, "anr")
    If Anr$ = "" Then
        Anr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "anr")
    End If
End If
GetAnr = Anr$

End Function

Function SetAnr(Anr$) As String
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "anr") = Anr$
End Function

Function GetStandort() As String
Dim Database$
Dim standort$
Dim ret$
Dim X As Integer
Dim nNr As Long
Dim sStandortNachAkte$

If sStandortNachAkte$ = "" Then
    X = WordExecute("select 1 from system where art='standortnachakte' and text1='1'")
    ret$ = String(255, " ")
    ret$ = Left$(WordRequest(ret$), laenge)
    If ret$ = "1" Then
        sStandortNachAkte$ = "1"
    Else
        sStandortNachAkte$ = "0"
    End If
End If

If sStandortNachAkte$ = "1" Then
    nNr = Val(GetAnr(1))
    If nNr > 1900000000 Then
        X = WordExecute("select bezeichnung from akten,standorte where akten.standortkuerzel=standorte.kuerzel and akten.nr=" & nNr)
        ret$ = String(255, " ")
        standort$ = Left$(WordRequest(ret$), laenge)
    End If
End If

If sStandortNachAkte$ = "0" Or (sStandortNachAkte$ = "1" And standort$ = "") Then
    Database$ = StrConv(System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Database"), vbUpperCase)
    standort$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & Database$, "Standort")
End If

GetStandort = standort$

End Function

Function GetDatabase() As String
Dim Database$

Database$ = GetDocVar("database")

If Database$ = "" Then
    Database$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "Database")
End If

GetDatabase = StrConv(Database$, vbUpperCase)

End Function

Function GetDocVar(Name$) As String
Dim DocVar As Variable
Dim VarValue$
On Error Resume Next
VarValue$ = ""

If Documents.count > 0 Then
    For Each DocVar In ActiveDocument.Variables
        If StrConv(DocVar.Name, vbLowerCase) = StrConv(Name$, vbLowerCase) Then
            VarValue$ = DocVar.Value
        End If
    Next
End If

GetDocVar = VarValue$
On Error GoTo 0
End Function
Sub test()
GetDocVar "nr"
End Sub
Sub SetDocVar(Name$, wert$)
Dim DocVar As Variable
Dim bExist As Boolean
bExist = False
For Each DocVar In ActiveDocument.Variables
    If StrConv(DocVar.Name, vbLowerCase) = StrConv(Name$, vbLowerCase) Then
        DocVar.Value = wert$
        bExist = True
    End If
Next

If bExist = False Then
    ActiveDocument.Variables.Add Name$, wert$
End If
End Sub

Sub DelDocVar(Name$)
Dim DocVar As Variable

For Each DocVar In ActiveDocument.Variables
    If StrConv(DocVar.Name, vbLowerCase) = StrConv(Name$, vbLowerCase) Then
        If Left$(StrConv(DocVar.Name, vbLowerCase), 3) <> "dgn" And Left$(StrConv(DocVar.Name, vbLowerCase), 8) <> "ipspeech" And Left$(StrConv(DocVar.Name, vbLowerCase), 5) <> "vtype" Then
            DocVar.Delete
        End If
    End If
Next

End Sub

Sub GotoBM(Name$)
Dim bm As Bookmark

For Each bm In ActiveDocument.Bookmarks
    If StrConv(bm.Name, vbLowerCase) = StrConv(Name$, vbLowerCase) Then
        bm.Select
    End If
Next

End Sub

Function GetBM(Name$) As Integer
Dim bm As Bookmark
Dim ret As Boolean
ret = False

For Each bm In ActiveDocument.Bookmarks
    If StrConv(bm.Name, vbLowerCase) = StrConv(Name$, vbLowerCase) Then
        ret = True
    End If
Next

GetBM = ret
End Function

Sub TextmarkeHinzuf|fffd|gen(Name$)
Dim bm As Bookmark
For Each bm In ActiveDocument.Bookmarks
    If bm.Name = Name$ Then
        bm.Delete
    End If
Next
Selection.Bookmarks.Add (Name$)
End Sub
Sub TextmarkeL|fffd|schen(Name$)
Dim bm As Bookmark
For Each bm In ActiveDocument.Bookmarks
    If bm.Name = Name$ Then
        bm.Delete
    End If
Next

End Sub

Function TextmarkeAusw|fffd|hlen(Name$) As Long

Dim bm As Bookmark
For Each bm In ActiveDocument.Bookmarks
    If bm.Name = Name$ Then
        bm.Select
        TextmarkeAusw|fffd|hlen = True
    End If
Next
End Function


Sub fAutoNew()
    DelDocVar ("nr")
    SetDocVar "nr", GetAnr(0)
    DelDocVar ("database")
    SetDocVar "database", GetDatabase()
    DelDocVar ("|fffd|Benutzer|fffd|")
    SetDocVar "|fffd|Benutzer|fffd|", GetUser
    WordBasic.EndOfDocument
End Sub


Function GetUser() As String
Dim User$
Dim ret$
Dim kuerzel$
Dim X As Integer

On Error GoTo Ende

User$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "user")
X = WordExecute("select kuerzel from mitarbeiter where name = '" + User$ + "'")
ret$ = String(255, " ")
kuerzel$ = Left$(WordRequest(ret$), laenge)

Ende:
WordExecute ("commit")
GetUser = kuerzel$
End Function

Sub SetDatabaseReg()
Dim DatabaseReg$
Dim DatabaseDoc$
DatabaseReg = GetDatabase()
Dim aVar As Variable
If Documents.count > 0 Then
    For Each aVar In ActiveDocument.Variables
        If StrConv(aVar.Name, vbLowerCase) = "database" Then
            DatabaseDoc$ = aVar.Value
            Exit For
        End If
    Next
    
    If DatabaseDoc$ <> "" And System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "Database") <> DatabaseDoc$ Then
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "Database") = DatabaseDoc$
    End If
End If
End Sub

Sub SetHeadingFormat()
    Selection.Rows.HeadingFormat = True
End Sub

Function GetApplicationName() As String

Dim ret$
Dim X As Integer
Dim sDatabaseAktuell$
sDatabaseAktuell = GetDatabase()
If sDatabase$ <> sDatabaseAktuell Or sAnwendungsname = "" Then
    X = WordExecute("select text1 from system where art='anwendungsname' ")
    ret$ = String(255, " ")
    ret$ = Left$(WordRequest(ret$), laenge)
    sAnwendungsname = ret$
    sDatabase$ = sDatabaseAktuell
    If ret$ = "" Then
        sAnwendungsname = "advoware"
    Else
        sAnwendungsname = ret$
    End If
End If

GetApplicationName = sAnwendungsname

End Function

Attribute VB_Name = "Grundeinstellungen"
Option Explicit
Public Declare Function ShellExecute Lib "Shell32.dll" Alias "ShellExecuteA" _
  (ByVal hWnd As Long, _
   ByVal lpOperation As String, _
   ByVal lpFile As String, _
   ByVal lpParameters As String, _
   ByVal lpDirectory As String, _
   ByVal nShowCmd As Long) As Long

Sub |fffd|ffneStartupordner()
    Dim sPath$
    sPath$ = GetProgramdir + "\startup"
    Shell "Explorer.exe /e, " + sPath, vbNormalFocus
    
    sPath$ = Options.DefaultFilePath(wdStartupPath)
    Shell "Explorer.exe /e, " + sPath, vbNormalFocus
End Sub


Sub DialogVorlagenUndAddInns()
    CommandBars.FindControl(ID:=751).Execute
End Sub
Attribute VB_Name = "Handakte"
Option Explicit
Private Declare Function GetDesktopWindow Lib "User32" () As Long
Private Declare Function GetWindow Lib "User32" _
  (ByVal hWnd As Long, ByVal wCmd As Long) As Long
Private Declare Function PostMessage Lib "User32" Alias "PostMessageA" _
  (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, _
   lParam As Any) As Long
Private Declare Function GetWindowText Lib "User32" Alias "GetWindowTextA" _
  (ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long) As Long

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Private Const GW_CHILD = 5
Private Const GW_HWNDNEXT = 2

Sub main() ' 12.12.2016(mp) Sollte nur noch aus Advoware aufgerufen werden.
Dim Database$
Dim App$
Dim nWND As Long
Dim buffer$
Dim X As Long

Database = GetDatabase()

App$ = GetApplicationName()


If AnwendungErmitteln(App$) Then
    AnwendungAktivieren (App$)

    nWND = GetWindow(GetDesktopWindow(), GW_CHILD)
    buffer = String(255, 0)
    GetWindowText nWND, buffer, Len(buffer)
        
        Do While nWND <> 0
            buffer = String(255, 0)
            GetWindowText nWND, buffer, Len(buffer)
            buffer = UCase(buffer)
            App$ = UCase(App$)
            If InStr(1, buffer, App$) > 0 Then
                 System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "handakte_nr") = GetAnr(1)
                PostMessage nWND, 21386, 41, 0
                
                    'rtaessageAdvoware 41, 0

                Exit Sub
                '  Exit Sub muss hier stehen bleiben, damit das Makro beendet wird,
                '  bevor die Platzhalter ausgetauscht wurden.
                Exit Sub
            End If
            
            nWND = GetWindow(nWND, GW_HWNDNEXT)
        Loop
End If

End Sub


Sub main2() ' 12.12.2016(mp) Sollte nur noch aus Advoware aufgerufen werden. Kann bei Gelegenheit gel|fffd|scht werden.
Dim Akte$
Dim erg$
Dim Anzahl$
Dim abfrage$
Dim anz As Integer
Dim anzminus As Integer 'Bei Daten|fffd|bernahmen manchmal BETNR in Tabele BETEILIGTE nicht vorhanden. Variable mindert Anzahl an Zeilen
Dim i, k, X, AnzahlSpalten, n1, n2 As Integer
On Error GoTo Ende

System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd") = ""
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr") = ""

Akte$ = GetAnr(0)

abfrage$ = "select angelegt from Akten where nr  =  " & Akte$
X = WordExecute(abfrage$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

erg$ = String(255, " ")
erg$ = Left(WordRequest(erg$), InStr(1, erg$, Chr(0)) - 1)
erg$ = Right(erg$, 2) & "." & Mid(erg$, 6, 2) & "." & Left(erg$, 4)
Selection.TypeText ("angelegt: " & Chr(9) & erg$ & Chr(13))

abfrage$ = "select abgelegt from Akten where nr = " & Akte$
X = WordExecute(abfrage$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

erg$ = String(255, " ")
erg$ = Left(WordRequest(erg$), InStr(1, erg$, Chr(0)) - 1)

If erg <> "" Then
    erg$ = Right(erg$, 2) & "." & Mid(erg$, 6, 2) & "." & Left(erg$, 4)
    Selection.TypeText ("abgelegt: " & Chr(9) & erg$ & Chr(13))
    abfrage$ = "select ablnr from Akten where nr = " & Akte$
    X = WordExecute(abfrage$)
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    erg$ = String(255, " ")
    erg$ = Left(WordRequest(erg$), InStr(1, erg$, Chr(0)) - 1)
    Selection.TypeText ("Ablagenummer: " & Chr(9) & erg$ & Chr(13))
End If

Selection.TypeParagraph
Selection.TypeParagraph

X = WordExecute("select count(*) from betakt where nr = " & Akte$)

If X <> 0 Then
    MsgBox "WordExecute-Fehler (" & X & ")", vbExclamation, GetApplicationName()
    GoTo Ende
End If

Anzahl = String(255, " ")
Anzahl$ = WordRequest(Anzahl$)
Anzahl$ = Left(Anzahl, laenge)
WordExecute ("commit")
anz = CInt2(Anzahl)
If anz = 0 Then anz = 1

abfrage$ = "select art||': ' from betakt " + _
            "where nr = " & Akte$ & " order by lfd"
X = WordExecute(abfrage$)
If X = 0 Then
    ActiveDocument.Tables.Add Range:=Selection.Range, NumRows:=anz * 2, _
                                                    NumColumns:=1
    For i = 0 To anz - 1
        Selection.Shading.Texture = wdTexture15Percent
        erg$ = String(255, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        Selection.Font.Bold = True
        Selection.TypeText (erg$)
        Selection.Font.Bold = True
        
    Selection.MoveRight Unit:=wdCell, count:=2

    Next
Else
    MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

ReDim betnr(100) As String
abfrage$ = "select betnr from betakt " + _
            "where nr = " & Akte$ & " order by lfd"
X = WordExecute(abfrage$)
If X <> 0 Then
     MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
     GoTo Ende
End If
    For i = 0 To anz - 1
        erg$ = String(1024, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        betnr(i) = Left(erg$, laenge)
    Next

Selection.MoveUp Unit:=wdLine, count:=1
Selection.MoveLeft Unit:=wdCell, count:=anz * 2 - 2

If X = 0 Then
    For i = 0 To anz - 1
        ''''''''''''Teil1 ''''
        ''''''''''''Abfragen nicht zusammenf|fffd|hren!!! Sonst
        ''''''''''''Datenbankfehler 2214(String too long) bei langen Betreffs m|fffd|glich
        abfrage$ = "select @if(@isna(betakt.stellung), '','Stellung: '||betakt.Stellung||@char(13)||@char(10))||titel||@if(@isna(titel), '', ' ')||betakt.name||', '||zusatz||" + _
                "@if(@isna(zusatz), '', ', ')||@if(@isna(strasse), @if(@FIND ('Postfach', postfach, 0), 'Postfach '||postfach, postfach), strasse)||', ' " + _
                " from betakt,beteiligte,adresse " + _
                "where betakt.betnr = beteiligte.betnr and betakt.betnr = adresse.betnr and betakt.nr = " & Akte$ _
                & " and lfd=" & CStr(i + 1) & " order by lfd"

        X = WordExecute(abfrage$)
        If X <> 0 Then
            MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        erg$ = String(1024, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        If erg$ = "" Then
            Selection.Rows.Delete
            Selection.MoveLeft Unit:=wdCell
            Selection.Rows.Delete
            Selection.MoveLeft Unit:=wdCell
            Selection.TypeText ("")

            anzminus = anzminus + 1
        Else
            Selection.TypeText (erg$)
        End If
        ''''''''''''Teil2
        abfrage$ = "select " + _
                "@if(@isna(strasse),pfplz||@if(@isna(pfplz), '', ' ')||ort,plz||@if(@isna(plz), '', ' ')||ort)||@if(@isna(betreff), '',@char(13)||@char(10)||'Betreff: '||betreff)" + _
                " from betakt,beteiligte,adresse " + _
                "where betakt.betnr = beteiligte.betnr and betakt.betnr = adresse.betnr and betakt.nr = " & Akte$ _
                & " and lfd=" & CStr(i + 1) & " order by lfd"

        X = WordExecute(abfrage$)
        If X <> 0 Then
            MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        erg$ = String(1024, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        Selection.TypeText (erg$)
          
        ''''''''''''Teil3
        abfrage$ = "select @if(@isna(betreff2), '',@char(13)||@char(10)||'Betreff2: '||betreff2)||@if(@isna(betreff3), '',@char(13)||@char(10)||'Betreff3: '||betreff3)||@char(13)||@char(10)" + _
                " from betakt,beteiligte " + _
                "where betakt.betnr = beteiligte.betnr and betakt.nr = " & Akte$ _
                & " and lfd=" & CStr(i + 1) & " order by lfd"

        X = WordExecute(abfrage$)
        If X <> 0 Then
            MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        erg$ = String(1024, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        If erg <> "" Then
            Selection.TypeText (erg$)
        End If
        
        If i < anz - 1 Then
            Selection.MoveRight Unit:=wdCell, count:=2
        End If
    Next
Else
    MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

ReDim Spalte(1) As String

X = WordExecute("select name||@if(@scan(name,'tlf'),'','*'||sonder) from handakte where anzeigen  =  1 and rang < 5 ")
If X <> 0 Then
    MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
Else
    i = 0
    erg$ = String(1024, " ")
    erg$ = WordRequest(erg$)
    erg$ = Left(erg$, laenge)
    
    While erg$ <> ""
        Spalte(i) = erg$
        erg$ = String(1024, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        i = i + 1
        ReDim Preserve Spalte(i)
    Wend
    AnzahlSpalten = i - 1
    ReDim Bezeichnungspalte(AnzahlSpalten) As String
End If

X = WordExecute("select bez from handakte where anzeigen  =  1")
If X <> 0 Then
    MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
Else
    For i = 0 To AnzahlSpalten
        erg$ = String(1024, " ")
        erg$ = WordRequest(erg$)
        erg$ = Left(erg$, laenge)
        Bezeichnungspalte(i) = erg$
     Next
End If

For i = 0 To AnzahlSpalten
    If anz > 1 Then
        Selection.MoveLeft Unit:=wdCell, count:=(anz - anzminus) * 2 - 2
        Selection.MoveRight count:=1
    End If
    
    If InStr(1, Spalte(i), "*") > 0 Then
            For k = 0 To anz - 1
                abfrage$ = "select count(*) from kommunikation where " & Right(Spalte(i), Len(Spalte(i)) - InStr(1, Spalte(i), "*")) _
                    & " And betnr = " & betnr(k)
                X = WordExecute(abfrage$)
                erg$ = String(1024, " ")
                erg$ = WordRequest(erg$)
                n1 = Left(erg$, laenge)
                If n1 > 0 Then
                    Selection.TypeText (Bezeichnungspalte(i) & ": ")
                    abfrage$ = "select tlf from kommunikation where " & Right(Spalte(i), Len(Spalte(i)) - InStr(1, Spalte(i), "*")) _
                    & " And betnr = " & betnr(k)
                    X = WordExecute(abfrage$)
                    For n2 = 0 To n1 - 1
                        erg$ = String(1024, " ")
                        erg$ = WordRequest(erg$)
                        erg$ = Left(erg$, laenge)
                        If n2 > 0 Then
                            Selection.TypeText (", ")
                        End If
                        Selection.TypeText (erg$)
                    Next
                    Selection.TypeText (" * ")
                End If
                If k < (anz - anzminus) - 1 Then
                    Selection.MoveRight Unit:=wdCell, count:=2
                    Selection.MoveRight count:=1
                End If
            Next
    Else
        abfrage$ = ",betakt where betakt.nr = " & Akte$
        abfrage$ = GetTB(Spalte(i), abfrage$) & " order by lfd"

        X = WordExecute(abfrage$)
    
        If X = 0 Then
            For k = 0 To anz - 1
                erg$ = String(1024, " ")
                erg$ = WordRequest(erg$)
                erg$ = Left(erg$, laenge)
                If erg$ <> "" Then
                    If Bezeichnungspalte(i) = "Geburtsdatum" Then
                        erg$ = gdat$(erg$)
                    End If
                    Selection.TypeText (Bezeichnungspalte(i) & ": " & erg$ & " * ")
                End If
                If k < (anz - anzminus) - 1 Then
                    Selection.MoveRight Unit:=wdCell, count:=2
                    Selection.MoveRight count:=1
                End If
            Next
        Else
            MsgBox "Wordexecute-Fehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
    End If

Next

Selection.MoveRight Unit:=wdCell, count:=1
Selection.Rows.Delete

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Function GetTB(Feld$, abfrage$) As String
Feld$ = UCase(Feld$)
Select Case Feld$
    Case "POSTFACH", "PLZ", "ORT", "STRASSE", "ANSCHRIFT", "GUELTIG_VON", "GUELTIG_BIS", "BEMERKUNG"
         abfrage = "select adresse." & Feld & " from adresse" & abfrage & _
                    " And betakt.betnr = adresse.betnr "
    Case "LAND"
         abfrage = "select l.land from adresse, laenderkennzeichen l " & abfrage & _
                    " And betakt.betnr = adresse.betnr and @upper(adresse.land)=l.kuerzel "
    Case "NAME", "VORNAME", "ANREDE", "BANREDE", "TITEL", "ZUSATZ", "GEBDAT", "GEBNAME", "GEBURTSORT", _
         "NOTIZ", "RECHTSFORM", "SELBSTBETEILIGUNG", "FAMSTAND", "HERKUNFTSLAND", "BERUF"
         abfrage$ = "select beteiligte." & Feld & " from beteiligte" & abfrage$ & _
                    " And betakt.betnr = beteiligte.betnr "
    Case "TELEFON"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                    " And betakt.betnr = kommunikation.betnr And komm_kz=1"
    Case "TELEFAX"
          abfrage$ = "select tlf from kom munikation" & abfrage$ & _
                    " And betakt.betnr = kommunikation.betnr And komm_kz=2"
    Case "RUFP"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                    " And betakt.betnr = kommunikation.betnr And komm_kz=6"
    Case "FAXP"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                    " And betakt.betnr = kommunikation.betnr And komm_kz=7"
    Case "MOBIL"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                    " And betakt.betnr = kommunikation.betnr" & _
                    " And ( komm_kz=3 or komm_kz=9)"
    Case "MAIL", "EMAIL"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=4"
    Case "EMAILPRIVAT"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=8"
    Case "SONSTIGE"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=10"
    Case "AUTO"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=9"
    Case "WEB"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And komm_kz=5"
    Case "ADVONETEMAIL"
          abfrage$ = "select tlf from kommunikation" & abfrage$ & _
                     " And betakt.betnr = kommunikation.betnr And ( komm_kz=4 or komm_kz=8 ) and komm_oa = 1"
    Case "BANK", "KTONR", "BLZ", "IBAN", "BIC", "KONTOINHABER"
          abfrage$ = "select bankverbindung." & Feld & " from bankverbindung" & abfrage$ & _
                     " And betakt.betnr = bankverbindung.betnr "
    Case Else
          abfrage$ = "select beteiligte." & Feld & " from beteiligte" & abfrage$ & _
                     " And betakt.betnr = beteiligte.betnr "
    End Select
    GetTB = abfrage$
End Function

Attribute VB_Name = "KopiereAutonew"
Option Explicit
Sub main()

Dim Dotpath$
Dim Bet1path$

Dotpath$ = GetDotpath

Bet1path$ = ActiveDocument.Fullname

If Right(Dotpath, 1) <> "\" Then Dotpath = Dotpath & "\"

Documents.Open FileName:=Dotpath & "leer.dot"

On Error Resume Next
Application.OrganizerCopy Source:=Dotpath$ & "leer.dot", _
    Destination:=Bet1path, Name:="AutoNew", Object:= _
    wdOrganizerObjectProjectItems
If Err.Number <> 0 Then
    MsgBox Err.Description
End If
On Error GoTo 0
Documents(Dotpath & "leer.dot").Close (False)

End Sub



Attribute VB_Name = "Kr"
Option Explicit
Private Declare Function GetWindow Lib "User32" _
  (ByVal hWnd As Long, ByVal wCmd As Long) As Long
Private Declare Function GetWindowText Lib "User32" Alias "GetWindowTextA" _
  (ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long) As Long
Private Declare Function GetDesktopWindow Lib "User32" () As Long
Private Declare Function PostMessage Lib "User32" Alias "PostMessageA" _
  (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, _
   lParam As Any) As Long
Private Const GW_CHILD = 5
Private Const GW_HWNDNEXT = 2

Public Sub main()
Dim Database$
Dim App$
Dim X
Dim nWND As Long, buffer As String

On Error GoTo Ende
Database = GetDatabase()

App$ = GetApplicationName()

SymbolleisteAktualisieren.main

If Documents.count > 0 Then
    If AnwendungErmitteln(App$) Then
        AnwendungAktivieren (App$)
        
        nWND = GetWindow(GetDesktopWindow(), GW_CHILD)
        X = Selection.Bookmarks.Exists("KostenrechnungSmall")
        Do While nWND <> 0
            buffer = String(255, 0)
            GetWindowText nWND, buffer, Len(buffer)
            App$ = UCase(App$)
            buffer = UCase(buffer)
           
            If InStr(1, buffer, App$) > 0 Then
                If X Then
                    PostMessage nWND, 21386, 4, 0
                Else
                    PostMessage nWND, 21386, 3, 0
                End If
                '  Exit Sub muss hier stehen bleiben, damit das Makro beendet wird,
                '  bevor die Kostenrechnung eingef|fffd|gt wird!
                Exit Sub
            End If
            
            nWND = GetWindow(nWND, GW_HWNDNEXT)
        Loop
    ElseIf AnwendungErmitteln("Advovoice") Then
        AnwendungAktivieren ("Advovoice")
        
        nWND = GetWindow(GetDesktopWindow(), GW_CHILD)
        
        Do While nWND <> 0
            buffer = String(255, 0)
            GetWindowText nWND, buffer, Len(buffer)
            
            If InStr(1, buffer, App$) > 0 Then
                PostMessage nWND, 21386, 3, 0
                '  Exit Sub muss hier stehen bleiben, damit das Makro beendet wird,
                '  bevor die Kostenrechnung eingef|fffd|gt wird!
                Exit Sub
            End If
            
            nWND = GetWindow(nWND, GW_HWNDNEXT)
        Loop
   Else
        If Shell(GetProgramdir$() + "\Advoware.exe", 1) = 0 Then
            WordBasic.MsgBox "Keine Verbindung zu " + GetApplicationName(), GetApplicationName()
        End If
    End If
End If

Ende:
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub RahmenEinfach()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Sub RahmenDoppelt()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderTop).LineStyle = wdLineStyleDouble
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Sub RahmenDoppeltUnten()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleDouble
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderTop).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Sub RahmenOhne()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Sub RahmenAlle()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderTop).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleSingle
End Sub

Sub RahmenDoppeltFett()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderTop).LineStyle = wdLineStyleTriple
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Sub RahmenOhneAlle()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderTop).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Sub RahmenDoppeltUntenEinfachOben()
    Selection.Borders(wdBorderBottom).LineStyle = wdLineStyleDouble
    Selection.Borders(wdBorderHorizontal).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderLeft).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderRight).LineStyle = wdLineStyleNone
    Selection.Borders(wdBorderTop).LineStyle = wdLineStyleSingle
    Selection.Borders(wdBorderVertical).LineStyle = wdLineStyleNone
End Sub

Attribute VB_Name = "LeereTabellenzeilenL|fffd|schen"

Sub procLeereTabZeilenLoeschen()
  Dim docTemp As Document, tblTemp As Table
  Dim rgAktZeile As Range, clAktZelle As Cell
  Dim blnZeileBenutzt As Boolean
  Dim i As Integer, j As Integer
  Dim intAnzZeilen As Integer, intAnzZellen As Integer

  Set docTemp = ActiveDocument
  If docTemp.Tables.count = 0 Then
'    keine Tabellen im aktuellen Dokument vorhanden
    Exit Sub
  End If

  Application.ScreenUpdating = False

  If Not Selection.Information(wdWithInTable) Then
'    Cursor nicht in Tabelle
     Exit Sub
  End If

  Set tblTemp = Selection.Tables(1)

  Set rgAktZeile = tblTemp.Rows(1).Range
  intAnzZeilen = tblTemp.Rows.count

  For i = 1 To intAnzZeilen
    DoEvents
    intAnzZellen = rgAktZeile.Rows(1).Cells.count
    blnZeileBenutzt = False
    For j = 1 To intAnzZellen
      DoEvents
      Set clAktZelle = rgAktZeile.Rows(1).Cells(j)
      If clAktZelle.Range.Characters.count > 1 Then
         blnZeileBenutzt = True
         Exit For
      End If
    Next j 'N|fffd|chste Zelle
    If Not blnZeileBenutzt Then
      rgAktZeile.Rows(1).Delete
    Else
      Set rgAktZeile = rgAktZeile.Next(wdRow)
    End If
  Next i 'N|fffd|chste Zeile

  Application.ScreenUpdating = True
  Application.ScreenRefresh
  DoEvents
End Sub


Attribute VB_Name = "LoadFrmDiktatstatus"
Option Explicit


Sub main(diktatnr$)

    frmDiktatstatus.SetStatus (diktatnr$)
    frmDiktatstatus.Show
    
    If global_bDoNotClose = False Then
        AktuellesDocument.DeleteAktuellesDocumentActiveDoc
        On Error Resume Next
        GotoAdvoware
        ActiveDocument.Close (False)
    End If
        
End Sub

Attribute VB_Name = "Men|fffd|funktionen"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Function GetBriefkopfpfad$(Anr$)
Dim ret$
Dim briefkopfpfad$

Dim X As Integer
Dim standort$

On Error GoTo Ende
ret$ = String(255, " ")

standort$ = GetStandort()
X = WordExecute("select briefkopfordner from mitarbeiter, pfade where mitarbeiter.nr = pfade.mnr and pfade.standort = '" & standort$ & "' and @trim(@lower(kuerzel)) = (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")

briefkopfpfad$ = Left$(WordRequest(ret$), laenge)
    
If briefkopfpfad$ = "" Then
    briefkopfpfad$ = GetDotpath()
End If
   
If (Right(briefkopfpfad$, 1) <> "\") Then
    briefkopfpfad$ = briefkopfpfad$ + "\"
End If
   
GetBriefkopfpfad$ = briefkopfpfad$

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then
    MsgBox Err.Description
End If
End Function
Public Function TextMenu_Paste()
    frmSchliessen.tbAnmerkungen.Paste
End Function

Public Function TextMenu_Copy()
    frmSchliessen.tbAnmerkungen.Copy
End Function

Public Function GetProgramdir$()
Dim Pfad$
Pfad$ = System.PrivateProfileString("", "HKEY_LOCAL_MACHINE\SOFTWARE\Advo-ware", "Programdir")
If Pfad$ = "" Then
    Pfad$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "Programdir")
    If Pfad$ = "" Then
        Pfad$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Programdir")
    End If
End If
If Right(Pfad$, 1) = "\" Then
    Pfad$ = Left(Pfad$, Len(Pfad) - 1)
End If

GetProgramdir$ = Pfad$
End Function
Public Function GetDotpath$()
GetDotpath$ = GetProgramdir$()

If Right(GetDotpath$, 1) <> "\" Then
    GetDotpath$ = GetDotpath$ & "\Dot\"
Else
    GetDotpath$ = GetDotpath$ & "Dot\"
End If


End Function

Public Function GetSchpath$()
Dim Schrpath$

Schrpath$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "schrpath")

If Schrpath$ = "" Then
    Schrpath = GetProgramdir
    If Right(Schrpath, 1) <> "\" Then
        Schrpath = Schrpath & "\"
    End If
    Schrpath = Schrpath & "schrifts|fffd|tze"
End If

If Right(Schrpath, 1) <> "\" Then
    Schrpath = Schrpath & "\"
End If

GetSchpath = Schrpath$
End Function

Public Function |fffd|ffneBriefkopf$()
Dim ret$
Dim Datei$
Dim Anr$
Dim briefkopfpfad$
Dim X As Integer
On Error GoTo Ende

ret$ = String(255, " ")
Anr$ = GetAnr(0)
X = WordExecute("SELECT standardbriefkopf FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
Datei$ = Left$(WordRequest(ret$), laenge)
ret$ = String(255, " ")

X = WordExecute("SELECT standardbriefkopf FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")

If (Datei = "1" Or Datei = "") Then
    X = WordExecute("SELECT BRIEFKOPF FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "2") Then
    X = WordExecute("SELECT BRIEFKOPF2 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "3") Then
    X = WordExecute("SELECT BRIEFKOPF3 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "4") Then
    X = WordExecute("SELECT BRIEFKOPF4 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "5") Then
    X = WordExecute("SELECT BRIEFKOPF5 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "6") Then
    X = WordExecute("SELECT BRIEFKOPF6 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "7") Then
    X = WordExecute("SELECT BRIEFKOPF7 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "8") Then
    X = WordExecute("SELECT BRIEFKOPF8 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "9") Then
    X = WordExecute("SELECT BRIEFKOPF9 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

ElseIf (Datei = "10") Then
    X = WordExecute("SELECT BRIEFKOPF10 FROM mitarbeiter WHERE @trim(@lower(kuerzel)) in (SELECT @trim(@lower(sb)) FROM akten WHERE nr = " + Anr$ + ")")
    Datei$ = Left$(WordRequest(ret$), laenge)

End If

If Datei = "" Then
    Datei = "bet1.dot"
End If

briefkopfpfad$ = GetBriefkopfpfad$(Anr$)

WordBasic.filefind SearchPath:=briefkopfpfad$, Name:=Datei$

If WordBasic.CountFoundFiles() = 0 Then

    If Right(StrConv(Datei$, vbLowerCase), 4) <> ".dot" Then
        Datei$ = Datei$ & ".dot"
    End If
    
    WordBasic.filefind SearchPath:=briefkopfpfad$, Name:=Datei$
    If WordBasic.CountFoundFiles() = 0 Then
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "Advoware kann keinen Briefkopf ermitteln!", vbExclamation, GetApplicationName()
    End If
End If
   
If Datei$ <> "" Then
    If Right(briefkopfpfad$, 1) <> "\" Then
        briefkopfpfad = briefkopfpfad + "\"
    End If
    Datei$ = briefkopfpfad$ + Datei$
    WordBasic.FileNew NewTemplate:=0, Template:=Datei$
    fAutoNew
End If

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Function

Public Sub Bet1()
Dim ret$
Dim Anr$
Dim erg$
Dim gericht$
Dim versicherung$
Dim X
Dim i
Dim benutzer$
Dim kz$
Dim kzmaster$
Dim Referat$
Dim ganrede$
Dim rang$
Dim Betreff$
Dim rand$
Dim bet$
Dim betreff2$
Dim betreff3$
Dim Anschrift$
Dim banrede$
Dim telefax$
Dim telefaxtext$
Dim telefaxprivat$
Dim tmp$
Dim tmp2$
Dim tmp3$
Dim master$
Dim lfd$
Dim betnr$
Dim DocVar As Variable
Dim DocVarExist As Boolean
Dim myRange
Dim Betart$, ArtBetakt$
Dim Zeilenumbruch$
On Error GoTo Ende

SetDatabaseReg

ret$ = String(255, " ")
Application.ScreenUpdating = False
Anr$ = GetAnr(1)
lfd$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd")
betnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")

DocVarExist = False

For Each DocVar In ActiveDocument.Variables
    If DocVar.Name = "adressat" Then DocVarExist = True
Next

If DocVarExist = False Then
    ActiveDocument.Variables.Add "adressat", lfd$
End If

Dim meinBereich
Set meinBereich = ActiveDocument.Content

benutzer$ = GetUser

If WordBasic.CountWindows() Then
   If WordBasic.DocumentProtection() = 0 Then
       ActiveWindow.View.ShowFieldCodes = True
   End If
End If

kz$ = GetDocVar("kz")
If kz$ = "" Then
    kz$ = SetDocvarKZ(Anr$, lfd$, "")
End If

If Val(kz$) > 0 Then
    X = WordExecute("SELECT gericht from betins where kz = " + kz$)
    ret$ = String(255, " ")
    gericht$ = Left$(WordRequest(ret$), laenge)
    
    X = WordExecute("SELECT versicherung from betins where kz = " + kz$)
    ret$ = String(255, " ")
    versicherung$ = Left$(WordRequest(ret$), laenge)
    
    X = WordExecute("SELECT text FROM betins WHERE kz = " + kz$)
    ret$ = String(255, " ")
    Betart$ = Left$(WordRequest(ret$), laenge)
    X = WordExecute("SELECT art FROM betakt WHERE nr = " + Anr$ + " and lfd = " + lfd$)
    ret$ = String(255, " ")
    ArtBetakt$ = Left$(WordRequest(ret$), laenge)
End If

telefaxtext = fTelefaxtext

X = WordExecute("select tlf from kommunikation k, betakt b where k.betnr = b.betnr and b.lfd = " & lfd & " And komm_kz=2 And nr = " & Anr$)
ret$ = String(255, " ")
telefax$ = Left$(WordRequest(ret$), laenge)
SetDocVar "telefax", telefaxtext$ & telefax$

If gericht$ = "1" Then
    X = WordExecute("SELECT rang FROM betakt WHERE lfd = " + lfd$ + " AND kz = " + kz$ + " AND nr = " + Anr$)
    rang$ = Left$(WordRequest(ret$), laenge)

    If rang$ = "" Or rang$ = "0" Then
        rang$ = "1"
    End If

    Selection.HomeKey Unit:=wdStory
    WordBasic.EditFind Find:="|fffd|Briefanrede|fffd|", Direction:=0, Wrap:=1

    If WordBasic.EditFindFound() = 0 Then
        Selection.EndKey Unit:=wdStory
        WordBasic.EditClear -1
        Selection.Font.Bold = 1
    End If

    X = WordExecute("SELECT referat from referate where kuerzel in (select referat FROM akten WHERE nr = " + Anr$ + ")")
    Referat$ = Left$(WordRequest(ret$), laenge)

    If WordBasic.ExistingBookmark("gericht") Then
        WordBasic.EditBookmark Name:="gericht", GoTo:=1
    End If
   
    X = WordExecute("select ganrede from referate where referat = '" + Referat$ + "'")
    ganrede$ = Left$(WordRequest(ret$), laenge)
    'If ganrede$ = "" Then  !!! 15.05.2018 mp: bei ganrede$ = "" darf auf keinen Fall ein Betreff generiert werden. Mit ganrede$ = ""
    '                       !!! wird das automatische Generieren des Betreffs unterbunden (einzige M|fffd|glichkeit). Die "Sache"=Referat ist
    '                        !!! nicht von der Beteiligtenart abh|fffd|ngig, sondern vom Referat.
    
    '    If Betart$ = "Vollstreckungsgericht" Then
     '       ganrede$ = "In der Vollstreckungssache"
     '   ElseIf Betart$ = "Mahngericht" Then
     '       ganrede$ = "In der Mahnsache"
     '   ElseIf Betart$ = "Beratungshilfegericht" Then
     '       ganrede$ = "In der Beratungshilfesache"
     '   ElseIf Betart$ = "Nachlassgericht" Then
     '       ganrede$ = "In der Nachlasssache"
     '   ElseIf Betart$ = "Grundbuchamt" Then
     '       ganrede$ = "In der Grundbuchsache"
     '   ElseIf Betart$ = "Registergericht" Then
     '       ganrede$ = "In der Registersache"
     '   End If
    'End If
    If ganrede$ = "" Then
       ' X = WordExecute("select banrede || ' ' || name from beteiligte where betnr = '" + Betnr$ + "'")
      '  ganrede$ = Left$(WordRequest(ret$), laenge)
    End If
    
    If ganrede$ > "" Then
        Selection.Font.Bold = 1
        
        With Selection
            .TypeText text:=ganrede$
        End With
        
        Selection.Font.Bold = 1
        Selection.TypeParagraph
        ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|grubrum|fffd||fffd| |fffd|Rubrum|fffd|", PreserveFormatting:=False
        Selection.EndKey Unit:=wdLine
        Selection.TypeParagraph
        Selection.Font.ColorIndex = 5
        
        If rang$ = "" Or rang$ = "0" Then
            rang$ = "1"
        End If
   
        Selection.Font.ColorIndex = wdAuto
        
        X = WordExecute("SELECT betreff from betakt where nr = " + Anr$ + " and lfd = " + lfd$)
        Betreff$ = Left$(WordRequest(ret$), laenge)
   
        If Betreff$ <> "" Then
            With Selection
                .TypeText text:=Betreff$
            End With
        End If
        Selection.Font.Bold = 0
        
        Selection.EndKey Unit:=wdLine
        Selection.TypeParagraph
    End If
    
    'Austauschen.main 28.08.2019 mp: Darf hier nicht aufgerufen werden, weil manche Platzhalter dann nicht bef|fffd|llt werden k|fffd|nnen z.B. <<Betreff>>
    Selection.EndKey Unit:=wdStory
    X = WordExecute("SELECT text1 from system where art = 'gericht'")
    rand$ = Left$(WordRequest(ret$), laenge) + " cm"
    WordBasic.FormatParagraph LeftIndent:=rand$
End If

If Left(lfd$, 1) <> "-" And lfd$ <> "" And lfd$ <> "0" Then
    X = WordExecute("SELECT master FROM betakt WHERE lfd = " + lfd$ + " And nr = " + Anr$)
    master$ = Left$(WordRequest(ret$), laenge)
    
    X = WordExecute("SELECT bet FROM betakt WHERE betnr = " + master$ + " And nr = " + Anr$)
    bet$ = Left$(WordRequest(ret$), laenge)
    
    If bet$ <> "" And bet$ <> "0" Then
        kz$ = bet$
    End If
    
    Betreff$ = GetBetreff("", lfd$, Anr$)
    X = WordExecute("SELECT betreff2 FROM betakt WHERE lfd = " + lfd$ + " And nr = " + Anr$)
    
    If X > 0 Then
        betreff2$ = ""
    Else
        betreff2$ = Left$(WordRequest(ret$), laenge)
    End If

    X = WordExecute("SELECT betreff3 FROM betakt WHERE lfd = " + lfd$ + " And nr = " + Anr$)
    If X > 0 Then
        betreff3$ = ""
    Else
        betreff3$ = Left$(WordRequest(ret$), laenge)
    End If
    
    Betreff$ = ReplaceX(Betreff$, Chr(13) + Chr(10), Chr(13))
    betreff2$ = ReplaceX(betreff2$, Chr(13) + Chr(10), Chr(13))
    betreff3$ = ReplaceX(betreff3$, Chr(13) + Chr(10), Chr(13))
    X = WordExecute("SELECT versicherung FROM betins WHERE kz = " + kz$)
    If X > 0 Then
        tmp$ = ""
    Else
        tmp$ = Left$(WordRequest(ret$), laenge)
    End If
    X = WordExecute("SELECT master FROM betakt WHERE nr=" + Anr$ + " And betnr = " + betnr$)
    If X > 0 Then
        tmp2$ = ""
        tmp3$ = ""
    Else
        tmp2$ = Left$(WordRequest(ret$), laenge)
        
        X = WordExecute("select versicherung from betakt, betins where betnr = " + tmp2$ + " and nr = " + Anr$ + " and betakt.art = betins.text")
        ret$ = String(255, " ")
        versicherung$ = Left$(WordRequest(ret$), laenge)
        
        tmp3$ = tmp2$
        X = WordExecute("SELECT i.versicherung FROM betins i, betakt a WHERE i.kz=a.bet And a.nr = " + Anr$ + " And betnr = " + tmp2$)
        If X > 0 Then
            tmp2$ = ""
        Else
                        
            tmp2$ = Left$(WordRequest(ret$), laenge)
            X = WordExecute("SELECT master FROM betakt WHERE nr=" + Anr$ + " And betnr = " + tmp3$)
            If X > 0 Then
                tmp3$ = ""
            Else
                tmp3$ = Left$(WordRequest(ret$), laenge)
                
                X = WordExecute("select versicherung from betakt, betins where betnr = " + tmp3$ + " and nr = " + Anr$ + " and betakt.art = betins.text")
                ret$ = String(255, " ")
                versicherung$ = Left$(WordRequest(ret$), laenge)
                
                X = WordExecute("SELECT i.versicherung FROM betins i, betakt a WHERE i.kz=a.bet And a.nr=" + Anr$ + " And betnr = " + tmp3$)
                If X > 0 Then
                    tmp3$ = ""
                Else
                    tmp3$ = Left$(WordRequest(ret$), laenge)
                End If
            End If
        End If
    End If
    
    If versicherung$ = "1" Or tmp$ = "1" Or tmp2$ = "1" Or tmp3$ = "1" Then
        X = WordExecute("SELECT @trim(text1) FROM system WHERE art = 'versbetreff'")
        tmp$ = Left$(WordRequest(ret$), laenge)
        
        If tmp$ > " " And Betreff <> "" Then
            Betreff$ = tmp$ + " " + Betreff$
        End If
        
        X = WordExecute("SELECT @trim(text2) FROM system WHERE art = 'versbetreff'")
        
        ret$ = String(255, " ")
        
        tmp$ = Left$(WordRequest(ret$), laenge)
        
        If tmp$ > " " And betreff2 <> " " Then
            betreff2$ = tmp$ + " " + betreff2$
        End If
    
    Else ' If kZ$ = "11" Then
        X = WordExecute("SELECT versicherung from betins where kz = " + bet$)
        ret$ = String(255, " ")
        versicherung$ = Left$(WordRequest(ret$), laenge)
        
        If versicherung$ = "1" Then
           X = WordExecute("SELECT text1 FROM system WHERE art = 'versbetreff'")
           tmp$ = Left$(WordRequest(ret$), laenge)
           
           If tmp$ > " " And Betreff <> "" Then
               Betreff$ = tmp$ + " " + Betreff$
           End If
           
           X = WordExecute("SELECT text2 FROM system WHERE art = 'versbetreff'")
           
           ret$ = String(255, " ")
           
           tmp$ = Left$(WordRequest(ret$), laenge)
           
           If tmp$ > " " And betreff2 <> "" Then
               betreff2$ = tmp$ + " " + betreff2$
           End If
       End If
    End If
    
    Anschrift = GetAnschrift("", lfd$, Anr$)
    If betnr$ = "" Then betnr$ = "0"
    If Val(betnr$) > 0 Then
        X = WordExecute("select banrede FROM beteiligte WHERE betnr = " + betnr$)
    Else
        X = WordExecute("select banrede FROM beteiligte, betakt WHERE beteiligte.betnr = betakt.betnr AND lfd = " + lfd$ + " And nr = " + Anr$)
    End If
    If X > 0 Then
        banrede$ = ""
    Else
        banrede$ = Left$(WordRequest(ret$), laenge)
    End If
    
    telefax$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "fax")
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "fax") = ""
    
    If telefax$ = "" Then
        X = WordExecute("select tlf FROM kommunikation, betakt WHERE kommunikation.betnr = betakt.betnr AND komm_kz = 2 and lfd = " + lfd$ + " And nr = " + Anr$)
        If X > 0 Then
            telefax$ = ""
        Else
            ret$ = String(255, " ")
            telefax$ = Left$(WordRequest(ret$), laenge)
        End If
    End If
    If telefax$ = "" Then
        If Betart$ = "Kontaktperson" Or ArtBetakt$ = "Kontaktperson" Or ArtBetakt$ = "Ansprechperson" Or ArtBetakt$ = "Ansprechpartner" Then
            X = WordExecute("select tlf FROM kommunikation, betakt WHERE kommunikation.betnr = betakt.master AND komm_kz = 2 and lfd = " + lfd$ + " And nr = " + Anr$)
            If X > 0 Then
                telefax$ = ""
            Else
                ret$ = String(255, " ")
                telefax$ = Left$(WordRequest(ret$), laenge)
            End If
        Else
            ret$ = String(255, " ")
            telefax$ = Left$(WordRequest(ret$), laenge)
        End If
    End If
     
    X = WordExecute("select tlf FROM kommunikation, betakt WHERE kommunikation.betnr = betakt.betnr AND lfd = " + lfd$ + " And komm_kz=7 and nr = " + Anr$)
    If X > 0 Then
        telefaxprivat$ = ""
    Else
       ret$ = String(255, " ")
       telefaxprivat$ = Left$(WordRequest(ret$), laenge)
    End If
    
    If telefax$ <> "" Then
       telefax$ = telefaxtext$ & telefax$
    End If
    If telefaxprivat <> "" Then
       telefaxprivat = telefaxtext$ & telefaxprivat$
    End If
    If telefax$ = "" Then
       telefax$ = telefaxprivat
    End If
    
    If WordBasic.ExistingBookmark("anschrift") Then
        WordBasic.EditBookmark Name:="anschrift", GoTo:=1
        With Selection
            .TypeText text:=Anschrift$
            TextmarkeL|fffd|schen ("anschrift")
        
        End With
    End If
    If Selection.Find.Execute(FindText:="|fffd|anschrift|fffd|", Forward:=True, Wrap:=wdFindContinue) Then
        Selection.TypeText Anschrift$
    End If
    
    If WordBasic.ExistingBookmark("banrede") And WordBasic.ExistingBookmark("Briefanrede") And kz = "8" Then
        WordBasic.EditBookmark Name:="banrede", GoTo:=1
        With Selection
            Selection.EndKey Unit:=wdStory
            Selection.Select
            .TypeText text:=banrede$
        End With
    Else
            Selection.Find.ClearFormatting
            With Selection.Find
            .text = "|fffd|Briefanrede|fffd|"
            .Replacement.text = ""
            .Forward = True
            .Wrap = wdFindContinue
            
        End With

        If Selection.Find.Execute() = True Then
            Selection.TypeText banrede$
        End If
            
    End If
ElseIf lfd = "-1" And Anr = "0" Then
    X = WordExecute("select banrede FROM beteiligte WHERE betnr= " + betnr$)
    If X > 0 Then
        banrede$ = ""
    Else
        banrede$ = Left$(WordRequest(ret$), laenge)
    End If
    Anschrift = GetAnschrift(betnr$, "", "")
    telefax$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "fax")
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "fax") = ""
    If WordBasic.ExistingBookmark("anschrift") Then
        WordBasic.EditBookmark Name:="anschrift", GoTo:=1
        With Selection
            .TypeText text:=Anschrift$
            TextmarkeL|fffd|schen ("anschrift")
        End With
    End If

    If WordBasic.ExistingBookmark("banrede") Then
        WordBasic.EditBookmark Name:="banrede", GoTo:=1
        With Selection
            .TypeText text:=banrede$
        End With
    End If
    Betreff$ = ""
Else
    bet$ = Mid(lfd$, 2)

    Anschrift = GetAnschrift(bet$, "", "")
    X = WordExecute("select banrede FROM beteiligte WHERE betnr= " + bet$)
    If X > 0 Then
        banrede$ = ""
    Else
        banrede$ = Left$(WordRequest(ret$), laenge)
    End If
        
    X = WordExecute("select tlf FROM kommunikation WHERE komm_kz=2 and betnr = " + bet$)
    If X > 0 Then
        telefax$ = ""
    Else
        telefax$ = Left$(WordRequest(ret$), laenge)
    End If

    X = WordExecute("select tlf FROM kommunikation WHERE komm_kz=7 and betnr = " + bet$)
    If X > 0 Then
        telefaxprivat$ = ""
    Else
        ret$ = String(255, " ")
        telefaxprivat$ = Left$(WordRequest(ret$), laenge)
    End If

    If telefax$ <> "" Then
       telefax$ = telefaxtext$ & telefax$
    End If
    If telefaxprivat <> "" Then
       telefaxprivat = telefaxtext$ & telefaxprivat$
    End If
    If telefax$ = "" Then
       telefax$ = telefaxprivat
    End If
    If telefaxprivat <> "" Then
       telefaxprivat = telefax$
    End If

    kz$ = SetDocvarKZ(Anr$, "", bet$)
    X = WordExecute("SELECT versicherung from betins where kz = " + kz$)
    ret$ = String(255, " ")
    versicherung$ = Left$(WordRequest(ret$), laenge)

    Betreff$ = GetBetreff(bet$, "", Anr$)
    X = WordExecute("SELECT betreff2 FROM betakt WHERE betnr = " + bet$ + " And nr = " + Anr$)
    If X > 0 Then
        betreff2$ = ""
    Else
        betreff2$ = Left$(WordRequest(ret$), laenge)
    End If

    X = WordExecute("SELECT betreff3 FROM betakt WHERE betnr = " + bet$ + " And nr = " + Anr$)
    If X > 0 Then
        betreff3$ = ""
    Else
        betreff3$ = Left$(WordRequest(ret$), laenge)
    End If
    Betreff$ = ReplaceX(Betreff$, Chr(13) + Chr(10), Chr(13))
    betreff2$ = ReplaceX(betreff2$, Chr(13) + Chr(10), Chr(13))
    betreff3$ = ReplaceX(betreff3$, Chr(13) + Chr(10), Chr(13))
    If versicherung$ = "1" Then
        X = WordExecute("SELECT text1 FROM system WHERE art = 'versbetreff'")
        tmp$ = Left$(WordRequest(ret$), laenge)
        
        If tmp$ > " " And Betreff <> "" Then
            Betreff$ = tmp$ + " " + Betreff$
        End If
        
        X = WordExecute("SELECT text2 FROM system WHERE art = 'versbetreff'")
        ret$ = String(255, " ")
        
        tmp$ = Left$(WordRequest(ret$), laenge)
        
        If tmp$ > " " And betreff2 <> "" Then
            betreff2$ = tmp$ + " " + betreff2$
        End If
    End If
    
    If WordBasic.ExistingBookmark("anschrift") Then
        WordBasic.EditBookmark Name:="anschrift", GoTo:=1
        With Selection
            .TypeText text:=Anschrift$
             TextmarkeL|fffd|schen ("anschrift")
       End With
    End If
  
    If WordBasic.ExistingBookmark("banrede") Then
        WordBasic.EditBookmark Name:="banrede", GoTo:=1
        With Selection
            .TypeText text:=banrede$
        End With
    End If

End If

If (telefax$ > "") And (telefax$ <> telefaxtext$) Then
    If InStr(1, telefax$, telefaxtext$) = 0 Then
        telefax$ = telefaxtext$ & telefax$
    End If
    Set myRange = ActiveDocument.Content
    Set meinBereich = ActiveDocument.Content
    
    If meinBereich.Find.Execute(FindText:="|fffd|Telefax|fffd|") = True Then
        meinBereich.Select
        'Selection.Font.ColorIndex = 5

        myRange.Find.Execute FindText:="|fffd|Telefax|fffd|", _
                ReplaceWith:=telefax$, Replace:=wdReplaceAll
        Selection.Font.ColorIndex = wdAuto
    End If
    SetDocVar "telefax", telefax$
    
Else
    meinBereich.Find.Execute FindText:="|fffd|Telefax|fffd|", ReplaceWith:=" ", Wrap:=1, Replace:=wdReplaceAll, Format:=1
End If

If telefaxprivat$ > "" Then
    Set myRange = ActiveDocument.Content
    Set meinBereich = ActiveDocument.Content
    
    If meinBereich.Find.Execute(FindText:="|fffd|TelefaxPrivat|fffd|") = True Then
        meinBereich.Select
        Selection.Font.ColorIndex = 0
        myRange.Find.Execute FindText:="|fffd|TelefaxPrivat|fffd|", _
                ReplaceWith:=telefaxprivat$, Replace:=wdReplaceAll
        Selection.Font.ColorIndex = wdAuto
    End If

Else
    meinBereich.Find.Execute FindText:="|fffd|TelefaxPrivat|fffd|", ReplaceWith:=" ", Wrap:=1, Replace:=wdReplaceAll
End If

If RTrim$(banrede$) > "" Then
    With Selection.Find
        .text = "|fffd|Briefanrede|fffd|"
        .Replacement.text = ""
        .Forward = True
        .Wrap = wdFindContinue
    End With

    If Selection.Find.Execute() = True Then
        Selection.TypeText banrede$
    End If
Else
    meinBereich.Find.Execute FindText:="|fffd|Briefanrede|fffd|", ReplaceWith:=" ", Wrap:=1, Replace:=wdReplaceAll
End If

If Left(Application.Version, 2) = "8." Then 'Microsoft hat nichts besseres zu tun, als Konstanten zu |fffd|ndern
    Zeilenumbruch$ = "^a"
Else
    Zeilenumbruch$ = "^p"
End If

If Betart$ = "Kontaktperson" And (Betreff <> "" Or betreff2 <> "") Then
    kz$ = SetChefKZ(Anr$, lfd$, "")
    
    X = WordExecute("SELECT versicherung from betins where kz = " + kz$)
    ret$ = String(255, " ")
    versicherung$ = Left$(WordRequest(ret$), laenge)

    If versicherung$ = "1" Then
        X = WordExecute("SELECT text1 FROM system WHERE art = 'versbetreff'")
        tmp$ = Left$(WordRequest(ret$), laenge)
        
        If tmp$ > " " And Betreff <> "" And InStr(1, Betreff, tmp$) = -1 Then
            Betreff$ = tmp$ + " " + Betreff$
        End If
        
        X = WordExecute("SELECT text2 FROM system WHERE art = 'versbetreff'")
        ret$ = String(255, " ")
        
        tmp$ = Left$(WordRequest(ret$), laenge)
        
        If tmp$ > " " And betreff2 <> "" And InStr(1, betreff2, tmp$) = -1 Then
            betreff2$ = tmp$ + " " + betreff2$
        End If
    End If
End If

If RTrim$(betreff3$) <> "" Then
   If RTrim$(betreff2$) = "" Then
       betreff2 = betreff3
   Else
       betreff2 = betreff2 & Zeilenumbruch$ & betreff3
   End If
End If
 
If RTrim$(Betreff$) <> "" And RTrim$(betreff2$) <> "" Then
    If Len(Betreff$ + Zeilenumbruch$ + betreff2$) > 254 Then
        betreff2$ = ReplaceX(betreff2$, "^p", Chr(13))
        betreff2$ = ReplaceX(betreff2$, "^a", Chr(13))
        Selection.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:="", Wrap:=1, Replace:=wdReplaceOne
        Selection.TypeText Betreff$
        Selection.TypeParagraph
        Selection.TypeText betreff2$
        SetDocVar "betreff", Betreff$ & Chr(13) + betreff2$
    Else
        Betreff$ = Betreff$ + Zeilenumbruch$ + betreff2$
        Betreff$ = ReplaceX(Betreff$, "^p", Chr(13))
        Betreff$ = ReplaceX(Betreff$, "^a", Chr(13))
        Selection.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=Betreff$, Wrap:=1, Replace:=wdReplaceAll
        SetDocVar "betreff", Betreff$
    End If
ElseIf RTrim$(Betreff$) <> "" Then
    If gericht$ = "1" Then
        If Trim(ganrede$) = "" Then
             With Selection.Find
                 .text = "|fffd|Betreff|fffd|"
                 .Replacement.text = Betreff$
                 .Wrap = 1
             End With
             SetDocVar "betreff", Betreff$
        Else
            meinBereich.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=" ", Wrap:=1, Replace:=wdReplaceAll
        End If
    ElseIf versicherung$ = "1" Then
        Betreff$ = ReplaceX(Betreff$, "^p", Chr(13))
        Betreff$ = ReplaceX(Betreff$, "^a", Chr(13))
        If Len(Betreff$) > 254 Then
            Selection.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=Betreff$, Wrap:=1, Replace:=wdReplaceAll

        Else
            meinBereich.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=Betreff$, Wrap:=1 _
            , Replace:=wdReplaceAll
        End If
        SetDocVar "betreff", Betreff$

    Else
        Selection.HomeKey Unit:=wdStory
        Selection.Find.ClearFormatting
        
        With Selection.Find
            .text = "|fffd|Betreff|fffd|"
            .Replacement.text = Betreff$
            .Forward = True
            .Wrap = wdFindContinue
        End With
        
        SetDocVar "betreff", Betreff$
    End If

ElseIf RTrim$(betreff2$) <> "" Then
        betreff2$ = ReplaceX(betreff2$, "^p", Chr(13))
        betreff2$ = ReplaceX(betreff2$, "^a", Chr(13))
        Selection.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=betreff2$, Wrap:=1, Replace:=wdReplaceAll
        SetDocVar "betreff", betreff2$

Else
    If RTrim$(Betreff) = "" Then
        meinBereich.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=" ", Wrap:=1, Replace:=wdReplaceAll
    Else
        betreff2$ = ReplaceX(betreff2$, "^p", Chr(13))
        betreff2$ = ReplaceX(betreff2$, "^a", Chr(13))
        Selection.Find.Execute FindText:="|fffd|Betreff|fffd|", ReplaceWith:=Betreff$, Wrap:=1, Replace:=wdReplaceAll
        SetDocVar "betreff", Betreff$
    End If
End If

meinBereich.Find.Execute FindText:="|fffd|Benutzer|fffd|", ReplaceWith:=benutzer$, Wrap:=1, Replace:=wdReplaceAll

Save.main
Austauschen.main

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
AnsichtLayoutAdvoware.main
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd") = ""
End Sub
Public Sub NeutralAufruf()
Neutral
End Sub

Private Sub Neutral()
Dim ret$
Dim X
Dim Sb$

ret$ = String(255, " ")

Call Men|fffd|funktionen.|fffd|ffneBriefkopf$
Austauschen.main
        
SetDocVar "history", "Schreiben an"
        
If WordBasic.ExistingBookmark("neutral") Then
    WordBasic.EditBookmark Name:="neutral", GoTo:=1
    If Len(Selection.text) <> 0 Then WordBasic.EditCut
End If
        
Selection.EndKey Unit:=wdStory
Save.main
X = WordExecute("Commit")
End Sub


Public Sub leer()
Dim briefkopfpfad$

briefkopfpfad$ = GetBriefkopfpfad$(GetAnr(0))
WordBasic.filefind SearchPath:=briefkopfpfad$, Name:="Leer.dot"

If WordBasic.CountFoundFiles() = 0 Then
    AnwendungAktivieren ("Microsoft Word")
    MsgBox "Datei nicht gefunden: " + briefkopfpfad$ + "Leer.dot", vbExclamation, GetApplicationName()
Else
    WordBasic.FileNew NewTemplate:=0, Template:=GetDotpath$() + "LEER.dot"
    fAutoNew
End If
    
SetDocVar "history", "Schreiben an"
Save.main

End Sub

Public Sub DateiEinf|fffd|gen(Pfad As String, Datei As String)

WordBasic.filefind SearchPath:=Pfad, Name:=Datei

If WordBasic.CountFoundFiles() = 0 Then
    AnwendungAktivieren ("Microsoft Word")
    MsgBox "Datei nicht gefunden: " + Pfad + "\" + Datei, vbExclamation, GetApplicationName()
Else
    If Right(Pfad, 1) <> "\" Then
        Pfad = Pfad & "\"
    End If
    Selection.InsertFile (Pfad & Datei)
End If

End Sub

Public Sub urkunde()
Dim urkunde_$
urkunde_$ = Notarschablone

If RTrim$(urkunde_$) <> "" Then
    WordBasic.FileNew NewTemplate:=0, Template:=GetDotpath$() + "URKUNDE.dot"
    fAutoNew
    
    DateiEinf|fffd|gen GetDotpath, urkunde_$
    Selection.Font.Bold = 0
    WordBasic.EditSelectAll
    WordBasic.UpdateFields
    Selection.HomeKey Unit:=wdStory
    SetDocVar "history", "Urkunde"
    Save.main
    Austauschen.main
End If

End Sub

Function Notarschablone$()

Dim Temp$
Dim i
ReDim notare__$(0)
Dim erg$
Dim laenge
Dim n
Dim dlg As Object
Dim X

Temp$ = WordBasic.[Files$](GetDotpath$() + "*.urk")

i = -1

While Temp$ <> ""
    i = i + 1
    Temp$ = WordBasic.[Files$]()
Wend

If i > -1 Then
    ReDim notare__$(i)
    erg$ = GetDotpath$()
    laenge = Len(erg$)
    erg$ = WordBasic.[Files$](erg$ + "*.urk")
    notare__$(0) = Right$(erg$, Len(erg$) - laenge)
    
    For n = 1 To i
        erg$ = WordBasic.[Files$]()
        notare__$(n) = Right$(erg$, Len(erg$) - laenge)
    Next n

    If i > 0 Then
        WordBasic.BeginDialog 376, 214, "Advoware - Urkunden"
            WordBasic.ListBox 55, 52, 264, 84, notare__$(), "notar"
            WordBasic.text 54, 28, 209, 13, "W|fffd|hlen Sie den Notar:", "Text1"
            WordBasic.OKButton 54, 164, 110, 21
            WordBasic.CancelButton 219, 164, 100, 21
        WordBasic.EndDialog

        Set dlg = WordBasic.CurValues.UserDialog

        X = WordBasic.Dialog.UserDialog(dlg)
        
        If X <> 0 Then Notarschablone$ = (notare__$(dlg.notar))
    Else
        Notarschablone$ = (notare__$(0))
    End If

Else
    MsgBox "Sie haben noch keine Notarschablonen angelegt!", vbExclamation, GetApplicationName()
End If

End Function

Sub SchriftfarbeAuto()
    Selection.Font.ColorIndex = wdAuto
End Sub
Sub ErzeugeSpalten()
     With Selection.PageSetup.TextColumns
       .SetCount NumColumns:=2
        .EvenlySpaced = True
        .LineBetween = True
        .Width = CentimetersToPoints(7.38)
        .Spacing = CentimetersToPoints(1.25)
    End With

End Sub

Function GetAnschrift(betnr$, lfd$, Anr$) As String
Dim abfrage$, abfrage2$, Abfrage3$, ret$, t1$, t2$, t3$, t4$, t5$, kp$, adnr$, an_betnr$, x1
Dim X As Long
Dim strasse, ug
On Error GoTo Ende

adnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "adnr")
If adnr$ = "" Or adnr$ = "0" Then
    adnr$ = "1"
End If
If adnr$ <= -100 Then
    adnr$ = 100 + adnr$
    GetAnschrift = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "LongAdr")
    GoTo Ende
End If
 
If Anr$ = "" Or Anr$ = "0" Then
    Anr$ = GetAnr(1)
End If

If lfd$ <= "" Then
    If betnr$ = "" Or betnr$ = "0" Then
        betnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")
    End If
    
    abfrage$ = "select lfd from betakt where betnr=" & betnr & " and nr=" & Anr & " order by ebene"
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    lfd$ = Left(WordRequest(ret$), laenge)
Else
    abfrage$ = "select betnr from betakt where lfd=" & lfd & " and nr=" & Anr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    betnr = Left(WordRequest(ret$), laenge)
End If

If adnr$ = 1 Then
    abfrage$ = "select min(adnr) from adresse where betnr=" & betnr & " and (gueltig_von is null or gueltig_von <= sysdate ) and (gueltig_bis is null or gueltig_bis >= sysdate ) "
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    adnr$ = Left(WordRequest(ret$), laenge)
    If adnr$ < "1" Then
        adnr$ = 1
    End If
End If

abfrage$ = "select art from betakt where lfd=" & lfd & " and nr=" & Anr
X = WordExecute(abfrage$)
ret$ = String(255, " ")
t3 = Left(WordRequest(ret$), laenge)

If betnr$ = "" Or betnr$ = "0" Then
    abfrage$ = "select betnr from betakt where lfd=" & lfd & " and nr=" & Anr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    betnr = Left(WordRequest(ret$), laenge)
End If

abfrage$ = "select strasse || plz || ort from adresse where betnr=" & betnr & " and adnr=1"
X = WordExecute(abfrage$)
ret$ = String(255, " ")
strasse = Left(WordRequest(ret$), laenge)
If strasse = "" Or adnr > 0 Then
    abfrage$ = "select versicherung from betins, betakt where bet=betins.kz and betnr=" & betnr & " and lfd = " & lfd & " and nr = " & Anr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    x1 = Left(WordRequest(ret$), laenge)
    
    abfrage$ = "select ug from betins, betakt where bet=betins.kz and betnr=" & betnr & " and lfd = " & lfd & " and nr = " & Anr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    ug = Left(WordRequest(ret$), laenge)
    If x1 = "1" Or ug = "1" Then
        abfrage$ = "select anschrift from adresse where betnr=" & betnr & " and adnr=" & adnr
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        t4 = Left(WordRequest(ret$), laenge)
    End If
End If

abfrage$ = "select count( 1 ) from f_mitarbeiter m, betakt t where m.betnr = t.master and m.mitnr = t.betnr and lfd = " & lfd & " and nr = " & Anr
X = WordExecute(abfrage$)
ret$ = String(255, " ")
kp$ = Left(WordRequest(ret$), laenge)

If strasse = "" Or kp = "1" Then
    abfrage$ = "select master from betakt where lfd=" & lfd & " and nr=" & Anr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    an_betnr = Left(WordRequest(ret$), laenge)
Else
    an_betnr = betnr
End If
If adnr$ > 0 Then
    abfrage$ = "select @left(anschrift,126) from adresse where betnr=" & an_betnr & " and adnr=" & adnr
    abfrage2$ = "select @mid(anschrift,126,126) from adresse where betnr=" & an_betnr & " and adnr=" & adnr
Else
    adnr$ = 0 - adnr$
    If strasse <> "" Then
        t3 = ""
        abfrage$ = "select @left(anschrift,126) from adresse where betnr=" & betnr & " and adnr=" & adnr
        abfrage2$ = "select @mid(anschrift,126,126) from adresse where betnr=" & betnr & " and adnr=" & adnr
        an_betnr = betnr
    Else
        abfrage$ = "select @left(anschrift,126) from adresse where betnr=" & an_betnr & " and adnr=" & adnr
        abfrage2$ = "select @mid(anschrift,126,126) from adresse where betnr=" & an_betnr & " and adnr=" & adnr
    End If
End If
 
X = WordExecute(abfrage$)
ret$ = String(255, " ")
t1 = Left(WordRequest(ret$), laenge)
X = WordExecute(abfrage2$)
ret$ = String(255, " ")
t2 = Left(WordRequest(ret$), laenge)

If (t3 = "Kontaktperson" Or t3 = "gesetzlicher Vertreter" Or t3 = "gesetzl. Vertreter" Or t3 = "Ehemann" Or t3 = "Ehefrau") And ug = "1" And (kp = "1" Or t4 = "") Or strasse = "" Then
    abfrage$ = "select @if(@isna(f.abteilung),'', f.abteilung||@char(13)||@char(10))||@trim(anrede||' '||titel||' '||vorname||' '||b.name)||@char(13)||@char(10) from beteiligte b,adresse a,betakt t,f_mitarbeiter f where b.betnr=t.betnr and a.betnr=t.master and f.betnr=t.master and f.mitnr=t.betnr and lfd=" & lfd & " and nr=" & Anr & " And adnr = " & adnr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    t3 = Left(WordRequest(ret$), laenge)
    If t3 = "" Then
        abfrage$ = "select @trim(anrede||' '||titel||' '||vorname||' '||b.name)||@char(13)||@char(10) from beteiligte b where b.betnr=" & betnr
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        t3 = Left(WordRequest(ret$), laenge)
    End If
    If adnr > 0 Then
        abfrage$ = "select strasse from adresse where betnr=" & an_betnr & " and adnr=" & adnr
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        t4 = Left(WordRequest(ret$), laenge)
        
        X = InStr(1, t1, t4) - 1
        If X <= 0 Then
            If t4 = "" Then
                abfrage$ = "select name from beteiligte where betnr=" & an_betnr
            Else
                abfrage$ = "select name from beteiligte where betnr=" & betnr
            End If
            X = WordExecute(abfrage$)
            ret$ = String(255, " ")
            t5 = Left(WordRequest(ret$), laenge)
            X = InStr(1, t1, t5) - 1
            If X < 0 Then
                GetAnschrift = t3 + t1 + t2
            Else
                GetAnschrift = Left(t1, Len(t5) + X) & (Chr(13) + Chr(10)) & t3 & Right(t1, Len(t1) - Len(t5) - X - 1) & t2
            End If
        Else
            GetAnschrift = Left(t1, X - 1) & t3 & Right(t1, Len(t1) - X)
        End If
        X = InStr(1, GetAnschrift, (Chr(10) & Chr(13) & Chr(10)))
        If X > 0 Then
            GetAnschrift = Left(GetAnschrift, X - 1) & Right(GetAnschrift, Len(GetAnschrift) - X - 1)
        End If
        
        abfrage$ = "select @trim(text1) from system where art='din5008' "
        x1 = WordExecute(abfrage$)
        ret$ = String(255, " ")
        t2 = Left(WordRequest(ret$), laenge)
        If t2 <> "1" Then
            x1 = 0
            X = InStr(1, GetAnschrift, t4)
            X = InStr(X, GetAnschrift, (Chr(13) & Chr(10)))
            GetAnschrift = Left(GetAnschrift, X - 1) & Chr(10) & Chr(13) & Right(GetAnschrift, Len(GetAnschrift) - X - 1)
        End If
        GoTo Ende
    End If
    
    If t4 = "" And t3 = "" Then
        abfrage$ = "select @trim(anrede||' '||titel||' '||vorname||' '||b.name)||@char(13)||@char(10) from beteiligte b,betakt t where b.betnr=t.betnr and lfd=" & lfd & " and nr=" & Anr
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        t3 = Left(WordRequest(ret$), laenge)
    End If
    If t4 = "" Then
        abfrage$ = "select name from beteiligte where betnr=" & betnr
    Else
        abfrage$ = "select name from beteiligte where betnr=" & an_betnr
    End If
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    t5 = Left(WordRequest(ret$), laenge)
    If t4 <> "" Then
        abfrage$ = "select strasse from adresse where betnr=" & betnr & " and adnr=1"
    Else
        abfrage$ = "select strasse from adresse where betnr=" & an_betnr & " and adnr=" & adnr
    End If
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    t4 = Left(WordRequest(ret$), laenge)
    If t4 = "" Then
        abfrage$ = "select name from beteiligte where betnr=" & an_betnr
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        t4 = Left(WordRequest(ret$), laenge)
        X = InStr(1, t1, t4) - 1
        If X <= 0 Then
            GetAnschrift = t3 + t1 + t2
        Else
            X = InStr(X, t1, Chr(13) + Chr(10)) + 1
            If X <= 0 Then
                GetAnschrift = t1 + t2 + t3
             Else
                 GetAnschrift = Left(t1, X - 1) & t3 & Right(t1, Len(t1) - X) & t2
             End If
        End If
    Else
        X = InStr(1, t1, t5)
        If X > 0 Then
            X = InStr(1, t1, t4) - 1
            If X <= 0 Then
                GetAnschrift = t3 + t1 + t2
            Else
                x1 = InStr(1, Right(t1, Len(t1) - X - 1), t4) - 1
                If x1 > 1 Then
                    X = x1 + X + 1
                End If
                GetAnschrift = Left(t1, X - 1) & t3 & Right(t1, Len(t1) - X) & t2
            End If
        Else
            If InStr(1, t1, "Eheleute") <= 1 Then
                GetAnschrift = Left(t1, X + Len(t5) + 1) & t3 & Right(t1, Len(t1) - X - Len(t5) - 1) & t2
            Else
                GetAnschrift = t3 & Right(t1, Len(t1) - X - Len(t5) - 1) & t2
            End If
        End If
        
    End If
Else
    GetAnschrift = t1 & t2
'    abfrage$ = "select @trim(text1) from system where art='din5008' "
'    x1 = WordExecute(abfrage$)
'    ret$ = String(255, " ")
'    t2 = Left(WordRequest(ret$), laenge)
'    x1 = WordExecute(strasse)
'    ret$ = String(255, " ")
'    strasse = Left(WordRequest(ret$), laenge)
'    X = InStr(1, GetAnschrift, strasse)
'    x1 = InStr(X, GetAnschrift, (Chr(13) & Chr(10) & Chr(13) & Chr(10)))
'    If t2 = "1" Then
'        If x1 > 0 And X <> x1 Then
'            GetAnschrift = Left(GetAnschrift, X - 1) & Right(GetAnschrift, Len(GetAnschrift) - X - 1)
''            GetAnschrift = Left(GetAnschrift, X - 1) & Chr(10) & Chr(13) & Right(GetAnschrift, Len(GetAnschrift) - X - 1)
'        End If
'    End If
End If

If GetAnschrift = "" Then
    abfrage$ = "select anrede||@char(13)||@char(10)||@trim(titel||' '||vorname||' '||name) from beteiligte where betnr=" & betnr
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    GetAnschrift = Left(WordRequest(ret$), laenge)
End If
Ende:
WordExecute ("commit")
End Function

Function GetBetreff(betnr$, lfd$, Anr$) As String
Dim abfrage$, abfrage2$, Abfrage3$, ret$, t1$, t2$, t3$
Dim X As Long
On Error GoTo Ende

If betnr$ <> "" And betnr$ <> "0" Then
    abfrage$ = "select @left(betreff,126) from betakt where betnr=" & betnr$ & " and nr=" & Anr
    abfrage2$ = "select @mid(betreff,126,126) from betakt where betnr=" & betnr$ & " and nr=" & Anr
    Abfrage3$ = "select @mid(betreff,252,3) from betakt where betnr=" & betnr$ & " and nr=" & Anr
Else
    abfrage$ = "select @left(betreff,126) from betakt where lfd=" & lfd & " and nr=" & Anr
    abfrage2$ = "select @mid(betreff,126,126) from betakt where lfd=" & lfd & " and nr=" & Anr
    Abfrage3$ = "select @mid(betreff,252,3) from betakt where lfd=" & lfd & " and nr=" & Anr
End If
X = WordExecute(abfrage$)
ret$ = String(255, " ")
t1 = Left(WordRequest(ret$), laenge)
X = WordExecute(abfrage2$)
ret$ = String(255, " ")
t2 = Left(WordRequest(ret$), laenge)

X = WordExecute(Abfrage3$)
ret$ = String(255, " ")
t3 = Left(WordRequest(ret$), laenge)

GetBetreff = t1 & t2 & t3
Ende:
WordExecute ("commit")
End Function

Function GetDBField(Feld$, tabelle$, where$)
Dim abfrage$, abfrage2$, Abfrage3$, ret$, t1$, t2$, t3$
Dim X As Long
On Error GoTo Ende
abfrage$ = "select @left(" & Feld$ & ",126) from " & tabelle$ & " where " & where$
abfrage2$ = "select @mid(" & Feld$ & ",126,126) from " & tabelle$ & " where " & where$
Abfrage3$ = "select @mid(" & Feld$ & ",252,3) from " & tabelle$ & " where " & where$
X = WordExecute(abfrage$)
ret$ = String(255, " ")
t1 = Left(WordRequest(ret$), laenge)
X = WordExecute(abfrage2$)
ret$ = String(255, " ")
t2 = Left(WordRequest(ret$), laenge)

X = WordExecute(Abfrage3$)
ret$ = String(255, " ")
t3 = Left(WordRequest(ret$), laenge)

GetDBField = t1 & t2 & t3
Ende:
WordExecute ("commit")

End Function

Function ReplaceX(sSuchstring, sSuche$, sErsetze$) As String
Dim X As Long
If sSuche$ = sErsetze$ Then
    ReplaceX = ReplaceX
Else
    X = InStr(1, sSuchstring, sSuche)
    While X > 0
        sSuchstring = Left(sSuchstring, X - 1) & sErsetze & _
        Right(sSuchstring, Len(sSuchstring) - X - Len(sSuche) + 1)
        X = InStr(1, sSuchstring, sSuche)
    Wend
    X = Len(sSuche)
    ReplaceX = sSuchstring
End If
End Function

Function fTelefaxtext() As String
Dim X As Long
Dim ret$
Dim telefaxtext$
X = WordExecute("SELECT text1 FROM system WHERE art = 'telefax'")
ret$ = String(255, " ")
telefaxtext$ = Left$(WordRequest(ret$), laenge)

If telefaxtext$ <> "" Then
   If Right$(telefaxtext$, 1) <> " " Then
       telefaxtext$ = telefaxtext$ & " "
   End If
End If

fTelefaxtext = telefaxtext$
End Function

Sub fStarteWordShellexecute()
Dim ret$
Dim sEinschalten$

    ret$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "startewordshellexecute")
    If ret$ = "1" Then
        If MsgBox("Startart ""Shellexecute"" von Microsoft Word ausschalten?", vbYesNo) = vbYes Then
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "startewordshellexecute") = "0"
        End If
    Else
        If MsgBox("Startart ""Shellexecute"" von Microsoft Word einschalten?", vbYesNo) = vbYes Then
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "startewordshellexecute") = "1"
        End If
    End If

End Sub
Attribute VB_Name = "MustertextBearbeiten"
Option Explicit

Public Sub main()
Dim cl As New clsAuswahlSchriftsatz
Dim Datei$

cl.DialogDateinameDateil|fffd|ngeFestlegen "", "", ""
Datei$ = cl.DateinameAbfragen

If Datei$ <> "" Then
    Documents.Open (Datei$)
    SetDocVar "muster", "ja"
End If
End Sub


Attribute VB_Name = "PFDDrucker"
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

Sub PrintMain()
Dim i As Long
With Dialogs(wdDialogFilePrintSetup)
    .Printer = "Advoware PDF-Drucker"
    .DoNotSetAsSysDefault = True
    .Execute
End With

Application.PrintOut

While i < 10
    DoEvents
    Sleep (100)
    i = i + 1
Wend

End Sub
Attribute VB_Name = "Para"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Sub main()
Dim abfrage$
Dim maxnr As Integer
Dim ret$
Dim text$
Dim Name$
Dim X As Integer
Dim docnr$
Dim mnr$

docnr$ = ActiveDocument.Name
abfrage$ = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
X = WordExecute(abfrage$)
ret$ = String(255, " ")
mnr$ = (Left(WordRequest(ret$), laenge))
text$ = Selection.text

If ret$ = "" Then
    MsgBox "Die Datei ist keiner Ma|fffd|nahme zugeordnet.", vbExclamation, GetApplicationName()
Else
    text$ = EntferneLeerzeichen(text$)
    Name$ = InputBox("Geben Sie einen Namen ein:", GetApplicationName(), Left(text$, 20))
    While (Pr|fffd|feNameTextmarke(Name$) = False)
        Name$ = InputBox("Geben Sie einen Namen ein:", GetApplicationName(), Left(Name$, 20))
    Wend
    
    If Name$ <> "" Then
        abfrage$ = "select count(*) from paramass where mnr = " & mnr$ & " and bez = '" & Name$ & "'"
        X = WordExecute(abfrage$)
        ret$ = String(255, " ")
        ret$ = Left(WordRequest(ret$), laenge)
        
        If ret$ > "0" Then
            MsgBox "Diese Ma|fffd|nahme enth|fffd|lt bereits einen Parameter mit diesem Namen.", vbExclamation, GetApplicationName()
        Else
            abfrage$ = "insert into paramass(mnr, bez) values(" & mnr$ & " ,'" & Name$ & "')"
            X = WordExecute(abfrage$)
            WordExecute ("commit")

            Selection.Font.ColorIndex = wdGreen
            
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, _
                text:="|fffd|var|fffd|" & ret$ & "|fffd| |fffd|" & Name$ & "|fffd|", PreserveFormatting:=False
            
            Selection.MoveLeft Unit:=wdCharacter, count:=1, Extend:=wdExtend
            Selection.Bookmarks.Add Name$
            Selection.MoveRight Unit:=wdCharacter, count:=1
            Selection.Font.ColorIndex = wdAuto
        End If
    End If
End If

WordExecute ("commit")

End Sub

Sub Aufrufen()
Dim abfrage$
Dim ret$
Dim X
Dim docnr$
Dim mnr$

docnr$ = ActiveDocument.Name
abfrage$ = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
X = WordExecute(abfrage$)
ret$ = String(255, " ")
mnr$ = (Left(WordRequest(ret$), laenge))

If mnr$ <> "" Then
    abfrage$ = "select count(*) from paramass where mnr = " & mnr$
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    
    If ret$ > "0" Then
        Load frmPara
        frmPara.Show
    Else
        MsgBox "In der Ma|fffd|nahme ist keine Variable enthalten.", vbExclamation, GetApplicationName()
    End If
Else
    MsgBox "Der Dateiname ist ung|fffd|ltig.", vbExclamation, GetApplicationName()
End If

End Sub

Function EntferneLeerzeichen(s$) As String
Dim i As Long
Dim CR$


i = InStr(1, s$, " ")
While i > 0
    s$ = Left(s$, i - 1) + Right(s$, Len(s) - Len(Left(s$, i)))
    i = InStr(1, s$, " ")
Wend

CR$ = Chr(13)
i = InStr(1, s$, CR$)
While i > 0 And Len(s$) > 0
    s$ = Left(s$, i - 1) + Right(s$, Len(s) - Len(Left(s$, i)))
    i = InStr(1, s$, CR$)
Wend

CR$ = Chr(10)
i = InStr(1, s$, CR$)
While i > 0
    s$ = Left(s$, i - 1) + Right(s$, Len(s) - Len(Left(s$, i)))
    i = InStr(1, s$, CR$)
Wend


EntferneLeerzeichen = s$
End Function

Function Pr|fffd|feNameTextmarke(Name$) As Long
    Dim lRet, i, lAsc As Long
    
    lRet = 1
    If InStr(1, Name$, " ") > 0 Then
        MsgBox "Der Name darf kein Leerzeichen enthalten.", vbExclamation, GetApplicationName()
        lRet = 0
    Else
                
        For i = 1 To Len(Name)
            lAsc = Asc(Mid(Name, i, 1))
            If (lAsc >= 48 And lAsc <= 57) Or _
                (lAsc >= 65 And lAsc <= 90) Or _
                (lAsc >= 97 And lAsc <= 122) Then
            Else
                MsgBox "Ung|fffd|ltiger Textmarkenname.", vbExclamation, GetApplicationName()
               lRet = 0
            End If
            
        Next
        Select Case Left(Name$, 1)
            Case "1", "2", "3", "4", "5", "6", "7", "8", "9", "0"
                    MsgBox "Das erste Zeichen darf keine Ziffer sein.", vbExclamation, GetApplicationName()
            lRet = 0
        End Select
    End If
    Pr|fffd|feNameTextmarke = lRet
End Function
Attribute VB_Name = "Platzhalter"
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Public nFormnumber As Long

Public Sub main()

If WordBasic.CountWindows() = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!", vbExclamation, GetApplicationName()
Else
    Load frmPlatzhalter
    frmPlatzhalter.Show
End If

End Sub
Public Sub MDTBez()
    Selection.Font.ColorIndex = wdPink
    ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mbez|fffd| |fffd|MDTBez|fffd|", PreserveFormatting:=True
    Selection.Font.ColorIndex = wdAuto
End Sub

Public Sub GEGBez()
    Selection.Font.ColorIndex = wdPink
    ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gbez|fffd| |fffd|GEGBez|fffd|", PreserveFormatting:=True
    Selection.Font.ColorIndex = wdAuto
End Sub


Attribute VB_Name = "ReplaceField"
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main()
Attribute main.VB_Description = "Ersetzen aller Platzhalter durch Daten aus der aktuellen Akte"
Attribute main.VB_ProcData.VB_Invoke_Func = "TemplateProject.Austauschen.MAIN"
Dim ret$
Dim abfrage$

ret$ = String(255, " ")
Application.ScreenUpdating = False
Selection.HomeKey Unit:=wdStory
Anr$ = GetAnr(1)

If WordBasic.CountWindows() Then
    If WordBasic.DocumentProtection() = 0 Then
        ActiveWindow.View.ShowFieldCodes = True
    End If
End If
 
While WordBasic.NextField()
    Index$ = ""
    X = InStr(Selection.text, "|fffd|")
    
    If X > 0 Then
        Y = Len(Selection.text)
        Feld$ = UCase(Mid(Selection.text, 24, Y - 26))
        
        erg$ = ""
        abfrage$ = "select " + Feld$ + " from akten, mitarbeiter where mitarbeiter.kuerzel = akten.sb and nr = " & Anr$
        X = WordExecute(abfrage$)
        erg$ = String(255, " ")
        erg$ = Left$(WordRequest(ret$), laenge)
        
        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        
        If RTrim$(erg$) <> "" Then
            Selection.Font.ColorIndex = wdAuto
            With Selection
                .TypeText text:=erg$
            End With
        Else
            AnwendungAktivieren ("Microsoft Word")
            MsgBox "Advoware kann keine Kanzleidaten ermitteln!", vbExclamation, GetApplicationName()
        End If
    End If
Wend
 
Selection.HomeKey Unit:=wdStory
WordBasic.EditFind Find:="|fffd|AnredeGericht 1. Instanz|fffd|", Direction:=0, Wrap:=1
                     
If WordBasic.EditFindFound() = -1 Then
    Selection.Extend
    Selection.Extend
    Selection.Extend
    Selection.Delete
End If

 
AnsichtLayoutAdvoware.main

Ende:
X = WordExecute("Commit")

End Sub
Attribute VB_Name = "Save"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer


Public Sub main()
Dim ret$
Dim Anr$
Dim muster$
Dim altpfad$
Dim Pfad$
Dim Benutzer_$
Dim s1$
Dim sDokumentname$
Dim speichern$
Dim nr$
Dim lfd$
Dim var As Variable
Dim kz$
Dim bet$
Dim X
Dim dateinr$
Dim dlg As Dialog
Dim erg
Dim vbnr
Dim Anschreiben$
Dim Ordner$
SetDatabaseReg
Ordner$ = SymbolleisteAktualisieren.DokumentordnerFestlegen(GetUser)
ret$ = String(255, " ")
nr$ = GetAnr(1)
lfd$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd")

speichern$ = GetDocVar("speichern")

If speichern$ <> "nein" Then
    muster$ = GetDocVar("muster")
    If muster$ = "ja" Then
        altpfad$ = WordBasic.[DefaultDir$](14)
        Pfad$ = GetDotpath$()
        Pfad$ = Left$(Pfad$, Len(Pfad$) - 4) + "Eigene"
    Else
        Pfad$ = WordBasic.[DefaultDir$](0)
    End If
    Benutzer_$ = GetDocVar("|fffd|Benutzer|fffd|")
    
    If Benutzer_$ = "" Then
        SetDocVar "|fffd|Benutzer|fffd|", GetUser
        Benutzer_$ = GetDocVar("|fffd|Benutzer|fffd|")
    End If
        
    SetDocvarKZ nr$, lfd$, ""
    
    Anschreiben$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "ANSCHREIBEN")
    sDokumentname$ = GetDateiname(Benutzer_$, lfd$, dateinr$)
    X = 0
    s1 = ""
    While Dir(Pfad$ & "\" & sDokumentname$ & ".*") > "" And X < 10000 And s1$ <> sDokumentname$
        s1$ = sDokumentname$
        Dokumentnummererh|fffd|hen Benutzer_$, dateinr$
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "ANSCHREIBEN") = Anschreiben$
        sDokumentname$ = GetDateiname(Benutzer_$, lfd$, dateinr$)
        X = X + 1
    Wend
    
    If muster$ = "ja" Then
        WordBasic.ChDefaultDir Pfad$, 0
    End If
    
    If Ordner$ = "" Then
        sDokumentname$ = sDokumentname$
    Else
        sDokumentname$ = Ordner$ & "\" & sDokumentname$
    End If
    
    If GetDocVar("AutomatischSpeichern") = "1" Then
        ActiveDocument.SaveAs (sDokumentname$)
        Dokumentnummererh|fffd|hen Benutzer_$, dateinr$
    Else
        Set dlg = Dialogs(wdDialogFileSaveAs)
        dlg.Name = sDokumentname$
        erg = dlg.Show
    End If
        
    If Documents.count > 0 Then
        If ActiveDocument.Type = wdTypeDocument Then
            Set AktuellesDocument.ActiveDoc = ActiveDocument
        End If
    End If
    
    VorlageNichtSpeichern
    
    If erg = -1 Then
        If InStr(dlg.Name, dateinr$) Then
            Dokumentnummererh|fffd|hen Benutzer_$, dateinr$
        End If
    
        WordBasic.FileSummaryInfo Keywords:=GetDocVar("Nr")
        SetDocVar "speichern", "ja"
        ActiveDocument.BuiltInDocumentProperties(1) = ActiveDocument.Name
        
        For Each var In ActiveDocument.Variables
            If var.Name = "VB" Then
                sDokumentname$ = ActiveDocument.Fullname
                X = WordExecute("update honorarvb set text = '" + sDokumentname$ + "' where nr = " + var.Value)
                X = WordExecute("commit")
            End If
        Next

     Else
'        SetDocVar "speichern", "nein" ' 09.07.2018 mp: Damit das Dokument nicht verloren geht, wenn man auf "Speichern nein" geht.
    End If

End If

Ende:
X = WordExecute("Commit")
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "anschreiben") = ""
End Sub

Private Function EntferneZeichen(ByVal s1$, ByVal s2$) As String
    Dim i As Integer
    i = InStr(1, s1$, s2$)
    While i > 0
        s1$ = Left(s1$, i - 1) & Mid(s1$, i + 1)
        i = InStr(1, s1$, s2$)
    Wend
    EntferneZeichen = s1$
End Function

Sub ErneutSpeichern()
If Documents.count = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!", vbExclamation
Else
    DokumentvariablenL|fffd|schen.main
    Save.main
    SetDocVar "nr", GetAnr(0)
End If
End Sub

Function GetDateiname(Benutzer_$, lfd$, dateinr$) As String
Dim i, X As Long
Dim sDokumentname$
Dim s1$
Dim sPosition$
Dim ret$
Dim Anschreiben$
Dim abfrage$
Dim nr$
Dim betnr$

nr$ = GetAnr(1)
dateinr$ = ""

X = WordExecute("select snr from mitarbeiter where kuerzel = '" + Benutzer_$ + "'")
ret$ = String(255, " ")
If X <> 0 Then
    MsgBox "WordExecute - Fehler " + Str(X) + " im Makro save, Variable dateinr$!", vbExclamation, GetApplicationName()
    GoTo Ende
End If

dateinr$ = Left$(WordRequest(ret$), laenge)
If dateinr$ = "" Then
    dateinr$ = "1"
    X = WordExecute("update mitarbeiter set snr = 1 where kuerzel = 'xyz'")
    X = WordExecute("commit")
End If

i = 1

X = WordExecute("select count(*) from systables where name = 'DOKUMENTMANAGEMENT'")
s1$ = Left$(WordRequest(ret$), laenge)

If s1$ = "1" Then
    Anschreiben$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "ANSCHREIBEN")
        
    While i < 9
        s1$ = Trim$("position" + Trim(Str(i)))
        abfrage$ = "select " + s1$ + " from dokumentmanagement"
        
        X = WordExecute(abfrage$)
        sPosition$ = Left$(WordRequest(ret$), laenge)
       
        If sPosition$ = "Mitarbeiterk|fffd|rzel" Then
            s1$ = Trim$(Benutzer_$)
        
        ElseIf sPosition$ = "Mitarbeitername" Then
            X = WordExecute("select name from mitarbeiter where kuerzel = '" + Benutzer_$ + "'")
            s1$ = Trim$(Left$(WordRequest(ret$), laenge))
        
        ElseIf sPosition = "aktuelles Datum" Or sPosition = "aktuelles Datum (Format TTMMJJJJ)" Then
            s1$ = Date
            s1$ = EntferneZeichen(s1, ".")
        
        ElseIf sPosition = "aktuelles Datum (Format JJJJMMTT)" Then
            s1$ = Date
            s1$ = EntferneZeichen(s1, ".")
            s1$ = Mid(s1, 5, 4) & Mid(s1, 3, 2) & Left(s1, 2)
        
        ElseIf sPosition = "aktuelles Datum (Format JJMMTT)" Then
            s1$ = Date
            s1$ = EntferneZeichen(s1, ".")
            s1$ = Mid(s1, 7, 2) & Mid(s1, 3, 2) & Left(s1, 2)
        
        ElseIf sPosition = "Sachbearbeiterk|fffd|rzel" Then
            X = WordExecute("select sb from akten where nr = " + nr$)
            s1$ = Trim$(Left$(WordRequest(ret$), laenge))
        
        ElseIf sPosition = "Referatsk|fffd|rzel" Then
            X = WordExecute("select referat from akten where nr = " + nr$)
            s1$ = Trim$(Left$(WordRequest(ret$), laenge))
        
        ElseIf sPosition = "Sachbearbeitername" Then
            X = WordExecute("select sb from akten where nr = " + nr$)
            s1$ = Left$(WordRequest(ret$), laenge)
            X = WordExecute("select name from mitarbeiter where kuerzel = '" + s1$ + "'")
            s1$ = Trim$(Left$(WordRequest(ret$), laenge))
        
        ElseIf sPosition = "Aktennummer" Then
            s1$ = Trim$(nr$)
        
        ElseIf sPosition = "Adressat" Or sPosition = "Adressat (gek|fffd|rzt auf 8 Zeichen)" Then
            If Val(lfd$) < 0 Then   'Schreiben aus Modul Adresse bearbeiten
                betnr$ = Str(Val(lfd$) * -1)
                If nr = 0 Then
                    betnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Betnr")
                End If
                X = WordExecute("select name from beteiligte where betnr = " + betnr$)
            Else
                X = WordExecute("select beteiligte.name from beteiligte, betakt where betakt.betnr = beteiligte.betnr and nr = " + nr$ + " and lfd = " + lfd$)
            End If
            
            s1$ = Trim$(Left$(WordRequest(ret$), laenge))
            s1$ = EntferneZeichen(s1, "\")
            s1$ = EntferneZeichen(s1, "/")
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "ANSCHREIBEN") = "0"
        
            If sPosition = "Adressat (gek|fffd|rzt auf 8 Zeichen)" Then
                If Len(s1$) > 8 Then
                   s1$ = Left(s1$, 6) + "~" + Right(s1$, 1)
                End If
            End If
            
            
        ElseIf sPosition = "laufende Nummer des Mitarbeiters" Then
            s1$ = Trim$(dateinr$)
        
        Else
            s1$ = Trim$(sPosition$)
        End If
        
        If Right$(sDokumentname$, 1) = "-" Then
            If s1$ <> "-" Then
                sDokumentname$ = sDokumentname$ + s1$
            End If
        Else
            sDokumentname$ = sDokumentname$ + s1$
        End If
        
        i = i + 1
    Wend
Else
    sDokumentname$ = Benutzer_$ + dateinr$
End If
GetDateiname = sDokumentname$
Ende:
X = WordExecute("Commit")
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "anschreiben") = ""
End Function

Sub Dokumentnummererh|fffd|hen(Benutzer_$, dateinr$)
Dim X As Long
    On Error GoTo Ende
    dateinr$ = Str(Val(dateinr$) + 1)
    X = WordExecute("update mitarbeiter set snr = " + dateinr$ + " " + Chr(9) + Chr(9) + "where kuerzel = '" + Benutzer_$ + "'")
Ende:
    X = WordExecute("commit")

End Sub

Function SetDocvarKZ(nr$, lfd$, betnr$) As String
Dim X As Long
Dim bet$, ret$, kz$

ret$ = String(255, " ")

If lfd$ <> "" And lfd$ <> "0" Then
    X = WordExecute("SELECT bet FROM betakt WHERE lfd = " + lfd$ + " And nr = " + nr$)
Else
    X = WordExecute("SELECT bet FROM betakt WHERE betnr = " + betnr$ + " And nr = " + nr$)
End If

bet$ = Left$(WordRequest(ret$), laenge)

If bet$ > "" Then
    kz$ = bet$
Else
    If lfd$ <> "" And lfd$ <> "0" Then
        X = WordExecute("SELECT kz FROM betakt where lfd = " + lfd$ + " And nr = " + nr$)
    Else
        X = WordExecute("SELECT kz FROM betakt where betnr = " + betnr$ + " And nr = " + nr$)
    End If
        
    kz$ = Left$(WordRequest(ret$), laenge)
End If
If kz$ > "" Then
    DelDocVar ("kz")
    SetDocVar "kz", kz$
End If

SetDocvarKZ = kz$
End Function

Function SetChefKZ(nr$, lfd$, betnr$) As String
Dim X As Long
Dim master$, ret$, kz$

ret$ = String(255, " ")

If lfd$ <> "" And lfd$ <> "0" Then
    X = WordExecute("SELECT master FROM betakt WHERE lfd = " + lfd$ + " And nr = " + nr$)
Else
    X = WordExecute("SELECT master FROM betakt WHERE betnr = " + betnr$ + " And nr = " + nr$)
End If

master$ = Left$(WordRequest(ret$), laenge)

If master$ > "" Then
    X = WordExecute("SELECT bet FROM betakt WHERE betnr = " + master$ + " And nr = " + nr$)
    kz$ = Left$(WordRequest(ret$), laenge)
Else
    kz$ = ""
End If

SetChefKZ = kz$
End Function

Attribute VB_Name = "Schadensaufstellung"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function WordRequestLongVarChar Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Sub main()
Dim X As Integer
Dim Anr$
Dim Anzahl As String
Dim i As Integer
Dim Rest, Rep, wert, Wieder, schaden As Double
Dim ret$
Dim myRange
Dim Hergang$
Dim AbfrageText As New clsSchaden
Dim AbfrageForderu As New clsSchaden
Dim AbfrageZahlu As New clsSchaden
Dim path$

On Error GoTo Ende

path = Men|fffd|funktionen.GetSchpath

If Right(path, 1) <> "\" Then
    path = path + "\"
End If

Selection.InsertFile (path & "Verkehrsunfallsachen\Schadensaufstellung.dat")

Anr$ = GetAnr(1)

ret$ = String(255, " ")

X = WordExecute("select notizen FROM unfall WHERE nr=" & Anr$)
Hergang = WordRequest(ret$)
Hergang = Left(Hergang, laenge)

Set myRange = ActiveDocument.Content
myRange.Find.Execute FindText:="|fffd|Unfallhergang|fffd|", _
ReplaceWith:=Hergang$, Replace:=wdReplaceAll

Austauschen.main

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Sub TabelleErzeugen()
Dim Anzahl, i, X As Integer
Dim Hergang$, Anr$, ret$
Dim AbfrageText As New clsSchaden
Dim AbfrageForderu As New clsSchaden
Dim AbfrageZahlu As New clsSchaden
Dim myRange
On Error GoTo Ende

ActiveDocument.Tables.Add Range:=Selection.Range, NumRows:=1, NumColumns:=4

Selection.Tables(1).Columns(1).SetWidth ColumnWidth:=223.5, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(2).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(3).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone
Selection.Tables(1).Columns(4).SetWidth ColumnWidth:=70, RulerStyle:= _
    wdAdjustNone

Anr$ = GetAnr(1)
Selection.Font.Bold = True

Selection.TypeText ("Summe:")
ret$ = String(255, " ")

X = WordExecute("select sum(forde) FROM schaden WHERE index>2 and nr=" & Anr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
Else
    Selection.MoveRight Unit:=wdCharacter, count:=1
    Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
    Hergang = WordRequest(ret$)
    Hergang = Left(Hergang, laenge)
    'Hergang = KommaHinzuf|fffd|gen(Hergang)
    Hergang = bib.wformat(bib.dbzahl(Hergang))
    Selection.TypeText (Hergang$ & " |fffd|")
End If

X = WordExecute("select sum(zahlu) FROM schaden WHERE index>2 and nr=" & Anr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
Else
    Selection.MoveRight Unit:=wdCharacter, count:=1
    Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
    Hergang = WordRequest(ret$)
    Hergang = Left(Hergang, laenge)
    Hergang = bib.wformat(bib.dbzahl(Hergang))
    Selection.TypeText (Hergang$ & " |fffd|")
End If

X = WordExecute("select sum(forde) - sum(zahlu) FROM schaden WHERE index>2 and nr=" & Anr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
Else
    Selection.MoveRight Unit:=wdCharacter, count:=1
    Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
    Hergang = WordRequest(ret$)
    Hergang = Left(Hergang, laenge)
    Hergang = bib.wformat(bib.dbzahl(Hergang))
    Selection.TypeText (Hergang$ & " |fffd|")
End If

X = WordExecute("select count(*) FROM schaden WHERE index>2 and (forde<>0 or zahlu<>0) and nr=" & Anr$)
Anzahl = bib.Val2(WordRequest(ret$))
Selection.InsertRows 1

For i = 1 To Anzahl
    Selection.InsertRows 1
    Selection.Font.Bold = False
    Selection.TypeText text:="|fffd|Text|fffd|"
    Selection.MoveRight Unit:=wdCharacter, count:=1
    Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
    Selection.TypeText text:="|fffd|Forderung|fffd|"
    Selection.MoveRight Unit:=wdCharacter, count:=1
    Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
    Selection.TypeText text:="|fffd|Zahlung|fffd|"
    Selection.MoveRight Unit:=wdCharacter, count:=1
    Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
    Selection.TypeText text:="|fffd|Rest|fffd|"
    Selection.MoveLeft Unit:=wdCharacter, count:=2
Next

AbfrageText.Execute ("select text FROM SCHADEN WHERE index>2 and nr=" & Anr$ & " and (forde<>0 or zahlu<>0) order by index")
'''''''
For i = 1 To Anzahl + 1
    Hergang$ = AbfrageForderu.Request
    Set myRange = ActiveDocument.Content
    myRange.Find.Execute FindText:="|fffd|Text|fffd|", _
        ReplaceWith:=Hergang$, Replace:=1
Next

AbfrageForderu.Execute ("select forde FROM SCHADEN WHERE index>2 and nr=" & Anr$ & " and (forde<>0 or zahlu<>0) order by index")
For i = 1 To Anzahl + 1
    Hergang$ = AbfrageForderu.Request
   Hergang = bib.wformat(bib.dbzahl(Hergang))
    Set myRange = ActiveDocument.Content
    myRange.Find.Execute FindText:="|fffd|Forderung|fffd|", _
        ReplaceWith:=Hergang$ & " |fffd|", Replace:=1
Next

AbfrageZahlu.Execute ("select zahlu FROM SCHADEN WHERE index>2 and nr=" & Anr$ & " and (forde<>0 or zahlu<>0) order by index")
For i = 1 To Anzahl + 1
    Hergang$ = AbfrageForderu.Request
    Hergang = bib.wformat(bib.dbzahl(Hergang))

    Set myRange = ActiveDocument.Content
    myRange.Find.Execute FindText:="|fffd|Zahlung|fffd|", _
        ReplaceWith:=Hergang$ & " |fffd|", Replace:=1
Next

AbfrageZahlu.Execute ("select forde-zahlu FROM SCHADEN WHERE index>2 and nr=" & Anr$ & "  and (forde<>0 or zahlu<>0) order by index")
For i = 1 To Anzahl + 1
    Hergang$ = AbfrageForderu.Request
    Hergang = bib.wformat(bib.dbzahl(Hergang))

    Set myRange = ActiveDocument.Content
    myRange.Find.Execute FindText:="|fffd|Rest|fffd|", _
        ReplaceWith:=Hergang$ & " |fffd|", Replace:=1
Next




Selection.InsertRows 1

Selection.Font.Bold = True
Selection.TypeText text:="Schadensart"
Selection.MoveRight Unit:=wdCharacter, count:=1
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Cells.VerticalAlignment = wdCellAlignVerticalCenter
Selection.Font.Bold = True
Selection.TypeText text:="Forderung"
Selection.MoveRight Unit:=wdCharacter, count:=1
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Cells.VerticalAlignment = wdCellAlignVerticalCenter
Selection.Font.Bold = True
Selection.TypeText text:="Zahlung"
Selection.Font.Bold = True
Selection.MoveRight Unit:=wdCharacter, count:=1
Selection.ParagraphFormat.Alignment = wdAlignParagraphRight
Selection.Cells.VerticalAlignment = wdCellAlignVerticalCenter
Selection.Font.Bold = True
Selection.TypeText text:="Rest"

Ende:
WordExecute ("commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub


Sub Reparaturkosten()
Dim Hergang$, Anr$, ret$
Dim AbfrageText As New clsSchaden

ret$ = String(255, " ")
Anr$ = GetAnr(1)
AbfrageText.Execute ("select zahlu FROM SCHADEN WHERE index=1 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Hergang = bib.wformat(bib.dbzahl(Hergang))

Selection.Font.ColorIndex = wdAuto
Selection.TypeText (Hergang)
WordExecute ("commit")
End Sub

Sub Wertminderung()
Dim Hergang$, Anr$, ret$
Dim AbfrageText As New clsSchaden
Selection.Font.ColorIndex = wdAuto

ret$ = String(255, " ")
Anr$ = GetAnr(1)
AbfrageText.Execute ("select forde FROM SCHADEN WHERE index=1 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Hergang = bib.wformat(bib.dbzahl(Hergang))
Selection.Font.ColorIndex = wdAuto
Selection.TypeText (Hergang)
WordExecute ("commit")
End Sub
Sub Wiederbeschaffung()
Dim Hergang$, Anr$, ret$
Dim X As Integer

Selection.Font.ColorIndex = wdAuto
ret$ = String(255, " ")
Anr$ = GetAnr(1)
WordExecute ("select zahlu FROM SCHADEN WHERE index=2 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Hergang = bib.wformat(bib.dbzahl(Hergang))

Selection.Font.ColorIndex = wdAuto
Selection.TypeText (Hergang)
WordExecute ("commit")
End Sub

Sub SummeWiederbeschaffung()
Dim Hergang$, Anr$, ret$
Dim X As Integer

Selection.Font.ColorIndex = wdAuto
ret$ = String(255, " ")
Anr$ = GetAnr(1)
WordExecute ("select zahlu-forde FROM SCHADEN WHERE index=2 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Hergang = bib.wformat(bib.dbzahl(Hergang))
Selection.Font.ColorIndex = wdAuto
Selection.TypeText (Hergang)
WordExecute ("commit")

End Sub

Sub SummeReparaturkosten()
Dim Hergang$, Anr$, ret$
Dim X As Integer

Selection.Font.ColorIndex = wdAuto
ret$ = String(255, " ")
Anr$ = GetAnr(1)
WordExecute ("select zahlu+forde FROM SCHADEN WHERE index=1 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Hergang = bib.wformat(bib.dbzahl(Hergang))
Selection.Font.ColorIndex = wdAuto
Selection.TypeText (Hergang)
WordExecute ("commit")

End Sub
Sub Restwert()
Dim Hergang$, Anr$, ret$
Dim X As Integer

ret$ = String(255, " ")
Anr$ = GetAnr(1)
X = WordExecute("select forde FROM SCHADEN WHERE index=2 and nr=" & Anr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
Else
    Hergang = Left(WordRequest(ret$), laenge)
    Hergang = bib.wformat(bib.dbzahl(Hergang))
    Selection.Font.ColorIndex = wdAuto
    Selection.TypeText (Hergang)
End If

WordExecute ("commit")
End Sub

Sub Unfallhergang()
Dim Hergang$, Anr$, ret$
Dim AbfrageText As New clsSchaden
Dim X As Integer
Dim l|fffd|nge As Integer

Anr$ = GetAnr(1)
X = WordExecute("select notizen FROM unfall where nr=" & Anr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
Else
    ret$ = String(255, " ")
    
    Hergang = WordRequest(ret$)
    ret$ = String(10001, " ")
    Hergang = WordRequestLongVarChar(ret$)
    
    l|fffd|nge = InStr(Hergang, Chr$(0))
    If l|fffd|nge < 1 Then l|fffd|nge = 1
    Hergang = Left(Hergang, l|fffd|nge - 1)
    Selection.Font.ColorIndex = wdAuto
    Selection.TypeText (Hergang)
End If

WordExecute ("commit")
End Sub

Sub EntferneKosten()
Dim Anr$, ret$, Hergang$
Dim Rep, wert, Wieder, Rest, schaden As Double

ret$ = String(255, " ")
Anr$ = GetAnr(1)

WordExecute ("select zahlu FROM SCHADEN WHERE index=1 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Rep = bib.Val2(Hergang)

WordExecute ("select forde FROM SCHADEN WHERE index=1 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
wert = bib.Val2(Hergang)

WordExecute ("select zahlu FROM SCHADEN WHERE index=2 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Wieder = bib.Val2(Hergang)

WordExecute ("select forde FROM SCHADEN WHERE index=2 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
Rest = bib.Val2(Hergang)

WordExecute ("select forde FROM SCHADEN WHERE index=3 and nr=" & Anr$)
Hergang = Left(WordRequest(ret$), laenge)
schaden = bib.Val2(Hergang)

If (schaden = Rep + wert) Then
    If ActiveDocument.Bookmarks.Exists("Wiederbeschaffung") = True Then
        ActiveDocument.Bookmarks("Wiederbeschaffung").Select
        ActiveDocument.Bookmarks("Wiederbeschaffung").Delete
        Selection.Delete
    End If
Else
    If ActiveDocument.Bookmarks.Exists("Reparaturkosten") = True Then
        ActiveDocument.Bookmarks("Reparaturkosten").Select
        ActiveDocument.Bookmarks("Reparaturkosten").Delete
        Selection.Delete
    End If
End If

Selection.StartOf wdRow
WordExecute ("commit")
End Sub
Sub GesamtsummeSchaden()
Dim Anr$
Dim ret$
Dim X As Integer

Anr$ = GetAnr(1)
ret$ = String(255, " ")
X = WordExecute("select sum(forde)-sum(zahlu) FROM schaden WHERE index>2 and nr=" & Anr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
Else
    ret$ = Left(WordRequest(ret$), laenge)
    ret$ = bib.wformat(bib.dbzahl(ret$))
End If
Selection.Font.ColorIndex = wdAuto
Selection.TypeText (ret$)
WordExecute ("commit")

End Sub

Sub SummeZahlungen()

End Sub
Private Function KommaHinzuf|fffd|gen(wert$)
Dim pos, l|fffd|nge As Integer
Dim Dummy&
Dim X$

l|fffd|nge = Len(wert)
    
pos = l|fffd|nge - InStr(wert, ".")
If l|fffd|nge = 0 Then
    wert = "0.00"
ElseIf (l|fffd|nge = pos) Then
    wert = wert + ".00"
ElseIf (pos = 1) Then
    wert = wert + "0"
    
End If
KommaHinzuf|fffd|gen = wert
End Function
Attribute VB_Name = "Schliessen"
Option Explicit
Public AktuellesDocument As New clsActiveDocument
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Declare Function PostMessage Lib "User32" Alias _
    "PostMessageA" (ByVal hWnd As Long, ByVal wMsg As _
    Long, ByVal wParam As Long, lParam As Any) As Long
Declare Function SendMessage Lib "User32" Alias _
    "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As _
    Long, ByVal wParam As Long, lParam As Long) As Long
Private Declare Function FindWindow Lib "User32" Alias "FindWindowA" (ByVal lpClassName As String, ByVal lpWindowName As String) As Long
Private Declare Function GetDesktopWindow Lib "User32" () As Long
Private Declare Function GetWindow Lib "User32" _
  (ByVal hWnd As Long, ByVal wCmd As Long) As Long
Private Declare Function GetWindowText Lib "User32" Alias "GetWindowTextA" _
  (ByVal hWnd As Long, ByVal lpString As String, ByVal cch As Long) As Long

Private Const GW_CHILD = 5
Private Const GW_HWNDNEXT = 2

Private Function pr|fffd|f(element$, Aktion, lParam)

If Aktion = 2 Then
    If element$ = "OK" Then
        If Len(WordBasic.[DlgText$]("hart")) > 100 Then
            MsgBox "In diesem Feld d|fffd|rfen maximal 100 Zeichen eingegeben werden!", vbExclamation, GetApplicationName()
            WordBasic.DlgFocus "hart"
            pr|fffd|f = 1
        End If
    End If
End If

End Function

Function GetHnr() As String
Dim abfrage As String
Dim X As Integer
Dim ret$
Dim sHnr$
On Error GoTo Ende

WordExecute ("UPDATE NEXTNUMBER SET WERT=WERT+1 WHERE TBNAME = 'HISTORY'")
WordExecute ("commit")
abfrage = "select wert from nextnumber where tbname = 'HISTORY'"
X = WordExecute(abfrage)
ret$ = String(255, " ")
sHnr$ = Left(WordRequest(ret$), laenge)
WordExecute ("commit")

If sHnr$ <> "" Then
    abfrage = "select hnr from history where hnr = " & sHnr$
    X = WordExecute(abfrage)
    ret = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    If ret$ = "" Then
        GetHnr = sHnr$
        Exit Function
    End If
End If
abfrage = "select @nullvalue( max( hnr ) + 1, 1 )from history"
ret = String(255, " ")
X = WordExecute(abfrage)
sHnr$ = Left(WordRequest(ret$), laenge)
WordExecute ("UPDATE NEXTNUMBER SET WERT=" & sHnr$ & " WHERE TBNAME = 'HISTORY'")
WordExecute ("commit")

GetHnr = sHnr$

Ende:
WordExecute ("commit")
If X <> 0 Then MsgBox "Wordexecute-Fehler " & Str(X)
End Function

Function GetBarcodeNr() As String
Dim abfrage As String
Dim X As Integer
Dim ret$
Dim sBarcodenr$
On Error GoTo Ende

WordExecute ("commit")
abfrage = "select 1 from syscolumns where tbname='POSTAUSGANG' and name = 'BARCODENR'"
X = WordExecute(abfrage)
ret$ = String(255, " ")
ret$ = Left(WordRequest(ret$), laenge)
If ret$ = "" Then Exit Function

WordExecute ("UPDATE NEXTNUMBER SET WERT=WERT+1 WHERE TBNAME = 'HISTORYBARCODENR'")
WordExecute ("commit")
abfrage = "select wert from nextnumber where tbname = 'HISTORYBARCODENR'"
X = WordExecute(abfrage)
ret$ = String(255, " ")
sBarcodenr$ = Left(WordRequest(ret$), laenge)
WordExecute ("commit")

If sBarcodenr$ <> "" Then
    abfrage = "select 1 from postausgang where barcodenr = " & sBarcodenr$
    X = WordExecute(abfrage)
    ret = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    If ret$ = "" Then
        GetBarcodeNr = sBarcodenr$
        Exit Function
    End If
Else
    WordExecute ("insert into NEXTNUMBER(tbname,wert) values('HISTORYBARCODENR',1)")
    WordExecute ("commit")
End If
abfrage = "select @nullvalue( max( barcodenr ) + 1, 1 )from postausgang"
ret = String(255, " ")
X = WordExecute(abfrage)
sBarcodenr$ = Left(WordRequest(ret$), laenge)
WordExecute ("UPDATE NEXTNUMBER SET WERT=" & sBarcodenr$ & " WHERE TBNAME = 'HISTORY'")
WordExecute ("commit")

GetBarcodeNr = sBarcodenr$

Ende:
WordExecute ("commit")
If X <> 0 Then MsgBox "Wordexecute-Fehler " & Str(X)
End Function

Public Sub ErzeugeImpDatei()

Dim DocVar As Variable
Dim MaxGr|fffd|sse As Integer
Dim nr$
Dim Datei$
Dim Name$
Dim benutzer$
Dim Datum$
Dim Betreff$
Dim lfd$
Dim Dummy$
Dim ret$
Dim X As Integer
Dim Ausgabedatei$
Dim Datenbank$
Dim neu As Integer
On Error GoTo Ende
neu = 0

Ausgabedatei = GetProgramdir
Datenbank$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DATABASE")

If Right(Ausgabedatei, 1) <> "\" Then Ausgabedatei = Ausgabedatei + "\"

If Dir(Ausgabedatei + "Import\*.*", vbDirectory) = "" Then
    MkDir Ausgabedatei + "Import"
End If

Ausgabedatei = Ausgabedatei + "Import\" + Datenbank$ + ".imp"

nr$ = GetDocVar("nr")
benutzer$ = GetDocVar("|fffd|Benutzer|fffd|")
lfd$ = GetDocVar("adressat")

Dummy$ = "@CHARSET,ANSI" + Chr(13) + Chr(10) + "@FOLDER,FT:^Microsoft Word - Dokument1^,FI:1005,FI:1004,FI:1001,FI:1002,FI:1003,BI:2001"
Open Ausgabedatei For Binary Access Write As #1 Len = Len(Dummy$) + 2
    MaxGr|fffd|sse = LOF(1)
    If MaxGr|fffd|sse = 0 Then
        Dummy = Dummy
        Put #1, MaxGr|fffd|sse + 1, Dummy
    End If
Close #1

If lfd <> "" Then
    If Left(lfd, 1) <> "-" Then
        Betreff$ = GetBetreff(lfd$, "", nr$)
        X = WordExecute("select name from betakt where lfd=" + lfd + " and nr=" + nr)
        ret$ = String(255, " ")
        Name$ = Left(WordRequest(ret$), laenge)
    Else
        lfd = Right(lfd, Len(lfd) - 1)
        Betreff$ = GetBetreff(lfd$, "", nr$)
        
        X = WordExecute("select name from betakt where betnr=" + lfd + " and nr=" + nr)
        ret$ = String(255, " ")
        Name$ = Left(WordRequest(ret$), laenge)
    End If
End If

Datum$ = CStr(Date)
X = WordExecute("select name from mitarbeiter where kuerzel='" + benutzer + "'")
ret$ = String(255, " ")
benutzer = Left(WordRequest(ret$), laenge)

Dummy = Chr(13) + Chr(10) + "^" + Name + "^,^" + Datum$ + "^,^" + nr$ + "^,^" + benutzer$ + "^,^" + Betreff$
Open Ausgabedatei For Binary Access Write As #1 Len = Len(Dummy)
    MaxGr|fffd|sse = LOF(1)
    Seek #1, MaxGr|fffd|sse
    Put #1, MaxGr|fffd|sse + 1, Dummy$
Close #1
Datei = ActiveDocument.Fullname
Dummy = "^,^" + Datei$ + "^" + Chr(13) + Chr(10)
Open Ausgabedatei For Binary Access Write As #1 Len = Len(Dummy)
    MaxGr|fffd|sse = LOF(1)
    Seek #1, MaxGr|fffd|sse
    Put #1, MaxGr|fffd|sse + 1, Dummy$
Close #1
Ende:

End Sub

Public Function InsertIntoHistory(sNr$, sHart As String, sBenutzerkuerzel$, sdatei$, sHtext$, sMnr$, sAdvonet$, sHnr$, sBetnr$, sKnr$, Ordnernr) As Integer
Dim X As Integer
Dim i, j As Integer
Dim abbruch As Boolean
Dim ret$
Dim erg$
Dim kz$
Dim Ordnername$
Dim Olfd$
Dim Oebene$
Dim kategorie$
Dim katnr$
Dim DatabaseDoc$
Dim DatabaseReg$
Dim DocVar As Variable
Dim betnr__() As String
Dim email__() As String
Dim kuerzel$
Dim sBarcodenr$
Dim s1$
abbruch = False
i = 0

For Each DocVar In ActiveDocument.Variables
    If StrConv(DocVar.Name, vbLowerCase) = "database" Then
        DatabaseDoc$ = DocVar.Value
    End If
Next

DatabaseReg = GetDatabase()
If DatabaseDoc$ <> "" And System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "Database") <> DatabaseDoc$ Then
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "Database") = DatabaseDoc$
    SymbolleisteAktualisieren.main
End If

sHtext$ = EntferneApostroph(sHtext)
sHart = EntferneApostroph(sHart)
sdatei$ = EntferneApostroph(sdatei$)
i = 0
X = -1

While X <> 0 And i < 50 And abbruch = False
    sHnr$ = GetHnr
    If sHnr = "" Then
        MsgBox ("Fehler beim Speichern in die Aktengeschichte (hnr="""")")
        abbruch = True
    Else
        If sBetnr$ = "" Then
            sBetnr$ = "null"
        End If
        sKnr = Val(sKnr)
        If sKnr = "null" Then
            sKnr = "0"
        End If
        s1$ = "insert into history(nr,modified,hart,benutzer,datei,htext,hnr,mnr,betnr,knr)  " + _
        "values('" + sNr$ + "',sysdatetime,'" + sHart$ + "','" + sBenutzerkuerzel$ + "','" + sdatei$ + "','" + sHtext$ + "'," + sHnr$ + "," + sMnr$ + "," + sBetnr$ + ",'" + sKnr$ + "')"
        X = WordExecute(s1$)
        WordExecute ("commit")
        
        X = WordExecute("update history set hdat = sysdate + systime, erstellungsdatum = sysdate + systime where hnr = " + sHnr$)
        WordExecute ("commit")
        If Ordnernr <> "" And Ordnernr <> 0 Then
            s1$ = "select ordnername from history_tree where hnr=0 and ordnernr = '" + Ordnernr + "' and nr=" + sNr$
            X = WordExecute(s1$)
            ret = String(255, " ")
            Ordnername = Left$(WordRequest(ret$), laenge)
            s1$ = "select lfd from history_tree where hnr= 0 and ordnernr = " + Ordnernr + " and ordnername = '" + Ordnername$ + "' and nr=" + sNr$
            X = WordExecute(s1$)
            ret = String(255, " ")
            Olfd$ = Left$(WordRequest(ret$), laenge)
            If Olfd$ <> "" Then
                s1$ = "select ebene from history_tree where lfd= " + Olfd$ + " and nr=" + sNr$
                X = WordExecute(s1$)
                ret = String(255, " ")
                Oebene$ = Left$(WordRequest(ret$), laenge)
                s1$ = "update history_tree set lfd = lfd + 1 where lfd > " + Olfd$ + " and nr = " + sNr$
                X = WordExecute(s1$)
                WordExecute ("commit")
                Oebene$ = Oebene$ + 1
                Olfd$ = Olfd$ + 1
                s1$ = "insert into history_tree (lfd, nr, hnr, ebene, ordnernr, ordnername ) values( " + Olfd$ + ", '" + sNr$ + "', " + sHnr$ + ", " + Oebene$ + ", " + Ordnernr + ", '" + Ordnername$ + "')"
                X = WordExecute(s1$)
                WordExecute ("commit")
            End If
        End If
    
        If sAdvonet$ = "1" Or sAdvonet$ = "2" Then
            WordExecute ("delete from history_access where hnr = " + sHnr$)
            WordExecute ("commit")
            'Folgende Zeilen nicht l|fffd|schen. Notwendig f|fffd|r Sonderprogrammierung
            X = WordExecute("update history set advonet=" & sAdvonet$ & " where hnr = " & sHnr$)
            X = WordExecute("commit")
            ReDim betnr__$(0)
            i = 0
            X = WordExecute("select distinct beteiligte.betnr from betakt, beteiligte  " + _
                "where nr = " + sNr$ + " and betakt.betnr = beteiligte.betnr  " + _
                "and ( advonetfreigabe = 'J' or ( advonetautofg = 'J' and betakt.kz = 1 ) )")
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            betnr__$(0) = erg$
            While Len(erg$) > 0
                erg$ = Left$(WordRequest(ret$), laenge)
                
                If Len(erg$) > 0 Then
                    i = i + 1
                    ReDim Preserve betnr__$(i)
                    betnr__$(i) = erg$
                End If
            Wend
            ReDim email__$(0)
            For j = 0 To i
                If sAdvonet$ = "2" Then
                    X = WordExecute("select 1 from beteiligte where betnr = " + betnr__$(j) + " and advonetemail = 'J' ")
                    ret$ = String(255, " ")
                    erg$ = Left$(WordRequest(ret$), laenge)
                    If erg$ = "" Then
                        erg$ = "0"
                    End If
                    ReDim Preserve email__$(j)
                    email__$(j) = erg$
                Else
                    ReDim Preserve email__$(j)
                    email__$(j) = "0"
                End If
            Next
            kuerzel$ = GetUser
            For j = 0 To i
                X = WordExecute("insert into history_access(hnr,betnr,email,postausgang,benutzer) values (" + sHnr$ + "," + betnr__$(j) + "," + email__$(j) + ", 1, '" + kuerzel$ + "')")
                WordExecute ("commit")
            Next
        End If
        If X <> 0 And X <> 805 Then
            abbruch = True
        End If
        i = i + 1
    End If
Wend
InsertIntoHistory = X

End Function


Function EntferneApostroph(text$)
Dim i As Integer

i = InStr(1, text$, "'")
While (i <> 0) And i < 260
    text$ = Left(text$, i) & "'" & Mid$(text$, i + 1)
    i = InStr(i + 2, text$, "'")
Wend

EntferneApostroph = text$
End Function

Function GetEmailFromKz(Anr$, sKz$)
Dim X As Long
Dim ret$
Dim s$
s = String(255, " ")
X = WordExecute("select tlf from betakt,kommunikation where komm_kz=4 and betakt.betnr=kommunikation.betnr and kz=" & sKz & " and bet is null and nr=" & Anr$)
s = Left(WordRequest(s), laenge)

While s <> ""
    If ret$ <> "" Then
        s = ";" & s
    End If
    ret = ret$ & s
    s = Left(WordRequest(s), laenge)
Wend

GetEmailFromKz = ret$
End Function

Sub fErzeugePDF(sHnr$)
Dim Database$
Dim abfrage$
Dim ret$
Dim App$
Dim nWND As Long
Dim buffer$
Dim X As Long

Database$ = GetDatabase()

App$ = GetApplicationName()

If AnwendungErmitteln(App$) Then
    AnwendungAktivieren (App$)
        
    abfrage$ = "select 1 from history where hnr=" & sHnr$ & " and @upper( @right (originaldatei, 3) ) = 'WAV'"
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    ret$ = Left$(WordRequest(ret$), laenge)

    If ret$ <> "1" Then
         X = WordExecute("update history set datei=originaldatei where hnr=" & sHnr$ & " and originaldatei is not null ")
         X = WordExecute("update history set originaldatei=null where hnr=" & sHnr$ & " and originaldatei is not null")
         X = WordExecute("commit")
     Else
         X = WordExecute("update history set originaldatei=null where hnr=" & sHnr$)
         X = WordExecute("commit")
    End If
    Database = GetDatabase
    nWND = GetWindow(GetDesktopWindow(), GW_CHILD)
    Do While nWND <> 0
        buffer = String(255, 0)
        GetWindowText nWND, buffer, Len(buffer)
        buffer = UCase(buffer)
        App$ = UCase(App$)
        If (InStr(1, buffer, App$) > 0 And InStr(1, buffer, "(" + Database$ + ")") > 0) _
        Or (Database$ = "ADVOWARE" And InStr(1, buffer, App$ + "  -") > 0) _
        Then
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "advowarepdfdrucker_hnr") = sHnr$
            If sHnr$ <> "" Then
                PostMessage nWND, 21386, 11, CLng(sHnr$)
            End If
            '  Exit Sub muss hier stehen bleiben, damit das Makro beendet wird!
            Exit Sub
        End If
        
        nWND = GetWindow(nWND, GW_HWNDNEXT)
    Loop
End If
End Sub


Function fSendMessageAdvoware(wParam As Long, lParam As Long) As Long
Dim Database$
Dim App$
Dim nWND As Long
Dim buffer$
Dim X As Long
Database = GetDatabase()

App$ = GetApplicationName()

If AnwendungErmitteln(App$) Then
    AnwendungAktivieren (App$)
    nWND = GetWindow(GetDesktopWindow(), GW_CHILD)
    
    Do While nWND <> 0
        buffer = String(255, 0)
        GetWindowText nWND, buffer, Len(buffer)
        buffer = UCase(buffer)
        App$ = UCase(App$)
        If InStr(1, buffer, App$) > 0 Then
            SendMessage nWND, 21386, wParam, lParam
            Exit Function
        
        End If
        
        nWND = GetWindow(nWND, GW_HWNDNEXT)
    Loop
End If
End Function

Function fDocToPdf(Anr$, nDocumentIsSaved) As Long
Dim X As Long
Dim ret$
Dim PDFUmwandeln$
Dim PDFOnline$
Dim Fullname$
Dim SchonVorhanden$, Datei$, Originaldatei$
Dim PDFNichterneuern

Fullname$ = ActiveDocument.Fullname

X = WordExecute("select datei from history where nr = " & Anr$ & " and (@upper(originaldatei)=@upper('" & Fullname$ & "') or @upper(datei)=@upper('" & Fullname$ & "'))")
ret$ = String(255, " ")
Datei$ = Left$(WordRequest(ret$), laenge)
   
X = WordExecute("select originaldatei from history where nr = " & Anr$ & " and (@upper(originaldatei)=@upper('" & Fullname$ & "') or @upper(datei)=@upper('" & Fullname$ & "'))")
ret$ = String(255, " ")
Originaldatei$ = Left$(WordRequest(ret$), laenge)

If Len(Datei$) > 0 And Len(Originaldatei$) > 0 Then ' Datei soll nur umgewandelt werden, wenn PDF-Datei |fffd|lter ist als Worddokument
    If FileDateTime(Originaldatei$) < FileDateTime(Datei$) Then
        PDFNichterneuern = True
   End If
End If
   
If PDFNichterneuern = True Then
    fDocToPdf = False
Else
    ret$ = String(255, " ")
    X = WordExecute("select hnr from history where nr = " & Anr$ & " and (@upper(originaldatei)=@upper('" & Fullname$ & "') or @upper(datei)=@upper('" & Fullname$ & "'))")
    SchonVorhanden$ = Left$(WordRequest(ret$), laenge)
    
    If SchonVorhanden$ <> "" Then
        
        X = WordExecute("select 1 from history where originaldatei is null and hnr = " & SchonVorhanden$)
        SchonVorhanden$ = "  "
        SchonVorhanden$ = Left$(WordRequest(ret$), laenge)
        If SchonVorhanden$ = "1" Then
            fDocToPdf = False 'Es gibt kein PDF: Beim |fffd|ndern nicht erneut fragen,
        Else
            X = WordExecute("select text2 from system where art = 'pdfdrucker'")
            ret$ = String(255, " ")
            PDFUmwandeln$ = "   "
            PDFUmwandeln$ = Left$(WordRequest(ret$), laenge)
            'If nDocumentIsSaved = True Then
                'SetDocVar "NoPDF", "ja"
                'fDocToPdf = False
             '   global_bDoNotClose = False
            If PDFUmwandeln$ = "0" Then
                
                If MsgBox("Soll das vorhandene PDF-Dokument neu erstellt werden? Wenn Sie auf ""Ja"" klicken wird das aktuelle Dokument jetzt gespeichert.", vbYesNo) = vbYes Then
                    ActiveDocument.Save
                    fDocToPdf = True
                    SetDocVar "NoPDF", "nein"
                Else
                    SetDocVar "NoPDF", "ja"
                    fDocToPdf = False
                    global_bDoNotClose = False
                End If
            
            ElseIf PDFUmwandeln$ = "1" Then
                fDocToPdf = True
            End If
        End If
    Else
    
    X = WordExecute("select text1 from system where art = 'pdfdrucker'") '   Winwordvoreinstellung "In PDF umwandeln"
        ret$ = String(255, " ")
        PDFUmwandeln$ = Left$(WordRequest(ret$), laenge)
        If PDFUmwandeln$ = "1" Then
            fDocToPdf = True
        Else
            fDocToPdf = False
        End If
    End If
    
    If fDocToPdf = False Then
        If GetDocVar("NoPDF") <> "ja" Then
        
            X = WordExecute("select text5 from system where art = 'onlineakte'")
            ret$ = String(255, " ")
            PDFOnline$ = Left$(WordRequest(ret$), laenge)
            
            If PDFOnline$ = "1" Then
                PDFOnline$ = ""
                
                X = WordExecute("select 1 from betakt, beteiligte  " + _
                        "where nr = " + Anr$ + " and betakt.betnr = beteiligte.betnr  " + _
                        "and ( advonetfreigabe = 'J' or ( advonetautofg = 'J' and betakt.kz = 1 ) )")
        
                ret$ = String(255, " ")
                PDFOnline$ = Left$(WordRequest(ret$), laenge)
                
                If PDFOnline$ = "1" Then
                    fDocToPdf = True
                End If
            Else
                fDocToPdf = False
            End If
        End If
    End If
    
    ActiveDocument.Saved = nDocumentIsSaved
End If
End Function

Function fGetArtHart() As String
Dim ret$
Dim X
On Error GoTo Ende
X = WordExecute("select text8 from system where art = 'history'")
ret$ = String(255, " ")
ret$ = Left(WordRequest(ret$), laenge)

If ret$ = "1" Then
    fGetArtHart = 1
Else
    fGetArtHart = 0
End If
Ende:
X = WordExecute("commit")

End Function
Attribute VB_Name = "SchriftsatzAnGericht"
Option Explicit

Sub main()
Dim File$
File$ = GetProgramdir & "\Druckerauswahl.exe"
If Dir(File$) = "" Then
    MsgBox "Die Datei ""Druckerauswahl.exe"" wurde nicht gefunden.", vbExclamation, GetApplicationName()
Else
    Shell File$, vbNormalFocus
End If
End Sub
Attribute VB_Name = "Serienbrief"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer


Public Sub main()
Attribute main.VB_Description = "Einstellen des Benutzerk|fffd|rzels"
Attribute main.VB_ProcData.VB_Invoke_Func = "TemplateProject.Benutzer.MAIN"

Dim ret$
Dim abbruch$
Dim X
Dim count_
Dim art$
Dim abfrage$
Dim serie$
Dim i
Dim quelle$
Dim Datei$
Dim Anr$
Dim Sb$
Dim Briefkopf$
Dim briefkopfpfad$

SetDatabaseReg
ret$ = String(255, " ")
On Error GoTo -1: On Error GoTo Ende

quelle$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Quelle")
Datei$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "serienbriefbriefkopf")
  
If quelle$ <> "" Then
    Anr$ = GetAnr(0)
    
    briefkopfpfad = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "serienbriefbriefkopfpfad")
    
    If briefkopfpfad = "" Then
        briefkopfpfad$ = GetBriefkopfpfad$(Anr$)
    End If
    
    WordBasic.filefind SearchPath:=briefkopfpfad$, Name:=Datei$

    If WordBasic.CountFoundFiles() = 0 Then
        AnwendungAktivieren ("Microsoft Word")
        Men|fffd|funktionen.|fffd|ffneBriefkopf
        Datei = ""
    End If
   
    If Datei$ <> "" Then
        If Right(briefkopfpfad$, 1) <> "\" Then
            briefkopfpfad = briefkopfpfad + "\"
        End If
        
        Datei$ = briefkopfpfad$ + Datei$
        WordBasic.FileNew NewTemplate:=0, Template:=Datei$
        fAutoNew

    End If
    
    If GetBM("neutral") Then
        WordBasic.ViewPage
        WordBasic.WW7_EditGoTo Destination:="neutral"
        WordBasic.EditClear
        WordBasic.MailMergeMainDocumentType 0
        WordBasic.MailMergeOpenDataSource Name:=quelle$
        WordBasic.MailMergeEditMainDocument
        WordBasic.InsertMergeField MergeField:="Anrede", WordField:=-1
        Selection.TypeParagraph
        WordBasic.InsertMergeField MergeField:="Name", WordField:=-1
        Selection.TypeParagraph
        WordBasic.InsertMergeField MergeField:="Zusatz", WordField:=-1
        Selection.TypeParagraph
        WordBasic.InsertMergeField MergeField:="Strasse", WordField:=-1
        Selection.TypeParagraph
        Selection.TypeParagraph
        WordBasic.InsertMergeField MergeField:="Ort", WordField:=-1
        Selection.TypeParagraph
        Selection.TypeParagraph
        Selection.TypeParagraph
        Selection.TypeParagraph
        Selection.TypeParagraph
        WordBasic.InsertMergeField MergeField:="Briefanrede", WordField:=-1
        Selection.TypeParagraph
        Selection.TypeParagraph
        ActiveWindow.View.ShowFieldCodes = False
    End If
End If

System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "serienbriefbriefkopf") = ""
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Quelle") = ""
Ende:

If Err.Number <> 0 Then MsgBox Err.Description
End Sub

Attribute VB_Name = "Springen"
Option Explicit
Public Sub main()
Attribute main.VB_Description = "Springen zum n|fffd|chsten Stopcode"
Attribute main.VB_ProcData.VB_Invoke_Func = "TemplateProject.Springen.MAIN"

Dim s As Range
If WordBasic.DocumentProtection() = 0 Then
    If GetDocVar("Springen") = "" Then
        Selection.HomeKey Unit:=wdStory
    End If
    If SucheFormat(0) = True Then
        Set s = Selection.Range
        If SucheFormat(1) = True Then
            s.Select
            Alternative
            If SucheFormat(2) Then
            End If
        Else
            Selection.Font.ColorIndex = wdAuto
        End If
    Else
        SetDocVar "Springen", ""
    End If
    Selection.Find.ClearFormatting
    Selection.Find.Replacement.ClearFormatting
Else
    MsgBox "Um in ein anderes Feld zu gelangen, benutzen Sie die Tabulatortaste oder die Maus.", vbExclamation, GetApplicationName()
End If


End Sub
Function SucheFormat(p_nArt As Long)
    Dim nRet As Long
    
    Selection.Find.ClearFormatting
    With Selection.Find
        .Replacement.text = "???"
        .MatchCase = False
        .MatchWholeWord = False
        .MatchAllWordForms = False
        .MatchWildcards = False
        .Forward = True
        If p_nArt = 0 Or p_nArt = 1 Then
            .text = ""
            .Font.ColorIndex = 5
        End If
        If p_nArt = 1 Or p_nArt = 2 Then
            .Wrap = wdFindStop
            .Format = False
        End If
        If p_nArt = 0 Then
            .Wrap = wdFindContinue
            .Format = True
        ElseIf p_nArt = 1 Then
            .Font.Name = "WingDings"
        ElseIf p_nArt = 2 Then
            .text = "???"
        End If
    End With
    nRet = Selection.Find.Execute
    If p_nArt = 1 And nRet = 0 Then
        If InStr(Selection.text, Chr(40)) > 0 Then
            Selection.Find.ClearFormatting
            Selection.Find.text = ChrW(61557)
            nRet = Selection.Find.Execute
            If nRet = True Then
                Selection.Font.Name = "Wingdings"
            End If
        End If
    End If
    SucheFormat = nRet
End Function

Sub Alternative()
Dim alt
Dim Y$
Dim Beschreibung$
Dim WordVersion$
Y$ = Space(255)
Dim i

Selection.Find.ClearFormatting

alt = 2
WordBasic.EditBookmark Name:="temp", Add:=1
WordBasic.CharLeft 1, 0
WordBasic.SelectCurFont

Selection.Font.ColorIndex = 2 '     (wdBlue = 2)

FindWingdings 1


Selection.Font.ColorIndex = wdAuto
WordBasic.CharRight 1
WordBasic.SelectCurColor

Selection.Font.ColorIndex = 6

If FindWingdings(0) = True Then
    alt = 3
    Selection.Font.ColorIndex = wdAuto
    WordBasic.CharRight 1
    WordBasic.SelectCurColor
    Selection.Font.ColorIndex = 11
Else
    GoTo last
End If

If FindWingdings(0) = True Then
    alt = 4
    Selection.Font.ColorIndex = wdAuto
    WordBasic.CharRight 1
    WordBasic.SelectCurColor
    Selection.Font.ColorIndex = 5
Else
    GoTo last
End If

last:
WordBasic.CharLeft 1, 0

frage:
If Application.Version = "12.0" Or Application.Version = "13.0" Or Application.Version = "14.0" Or Application.Version = "15.0" Or Application.Version = "16.0" Then
    If alt = 2 Then
        StatusBar = "Alternativen:  1  (blau)  2  (rot)  "
        Y$ = InputBox("Alternativen:  1  (blau)  2  (rot)  ")
    ElseIf alt = 3 Then
        StatusBar = "Alternativen:  1  (blau)  2  (rot)  "
         Y$ = InputBox("Alternativen:  1  (blau)  2  (rot)  3  (gr|fffd|n)  ")
    ElseIf alt = 4 Then
         Y$ = InputBox("Alternativen:  1  (blau)  2  (rot)  3  (gr|fffd|n)  4  (rosa)  ")
    End If
Else
    If alt = 2 Then
        WordBasic.Input "Alternativen:  1  (blau)  2  (rot)  ", Y$
    ElseIf alt = 3 Then
        WordBasic.Input "Alternativen:  1  (blau)  2  (rot)  3  (gr|fffd|n)  ", Y$
    ElseIf alt = 4 Then
        WordBasic.Input "Alternativen:  1  (blau)  2  (rot)  3  (gr|fffd|n)  4  (rosa)  ", Y$
    End If
End If
If Y$ = "" Or Y$ = "<-1>" Then GoTo Ende
If (bib.Val2(Y$) < 1 Or bib.Val2(Y$) > alt) Then GoTo frage

For i = 1 To alt - 1
    If WordBasic.ExistingBookmark("temp") Then
        WordBasic.EditBookmark Name:="temp", GoTo:=1
    End If

    FindWingdings (0)
    WordBasic.EditClear
Next i
If WordBasic.ExistingBookmark("temp") Then
    WordBasic.EditBookmark Name:="temp", GoTo:=1
End If

WordBasic.CharLeft 1, 0

For i = 1 To alt
    WordBasic.SelectCurColor

    If bib.Val2(Y$) <> i Then
        If Len(Selection.text) <> 0 Then WordBasic.EditCut

        If i = bib.Val2(Y$) - 1 Then
            WordBasic.CharRight 1, 1
            If Asc(Selection.text) = 11 Then
                If Len(Selection.text) <> 0 Then WordBasic.EditCut
            End If
        End If
    Else
        Selection.Font.ColorIndex = wdAuto
        WordBasic.CharRight 1, 0
    End If
Next

If WordBasic.ExistingBookmark("temp") Then
    WordBasic.EditBookmark Name:="temp", GoTo:=1
    WordBasic.EditBookmark Name:="temp", Delete:=1
End If


Ende:


End Sub

Function FindWingdings(lWrap As Long) As Long

    Dim ret As Long
    Selection.Find.ClearFormatting
    With Selection.Find
        .Font.Name = "Wingdings"
            .text = ""
            .Forward = True
            .Wrap = lWrap
            .Format = True
    End With
    If Selection.Find.Execute = 0 Then
        FindWingdings = False
    Else
        FindWingdings = True
    End If
End Function
Attribute VB_Name = "Stopcode"

Public Sub main()
Attribute main.VB_Description = "Einf|fffd|gen eines Stopcodes"
Attribute main.VB_ProcData.VB_Invoke_Func = "TemplateProject.Stopcode.MAIN"

If WordBasic.CountWindows() = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!"
Else
    If Len(Selection.text) > 1 And Selection.text <> Chr(10) & Chr(7) Then 'Chr(7): Falls der Cursor in einer Tabelle steht
        Selection.Font.ColorIndex = 5
    Else
        If WordBasic.CharColor() = 5 Then
            WordBasic.InsertSymbol Font:="Wingdings", CharNum:="117"
            WordBasic.CharLeft 1, 1
            WordBasic.Font "Wingdings"
        Else
            Selection.Font.ColorIndex = 5
            With Selection
                .TypeText text:="???"
            End With
            
            Selection.Font.ColorIndex = wdAuto
        End If
    End If
End If

End Sub

Attribute VB_Name = "SymbolleisteAktualisieren"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main()

Dim symbol$
Dim kuerzel$
Dim sAnr$
Dim ret$
Dim X As Integer
Dim gefundenFlag As Boolean
Dim Steuerelement As CommandBarControl
Dim eineVorlage As Template

SetDatabaseReg
ret$ = String(255, " ")

kuerzel$ = GetUser

gefundenFlag = False

While gefundenFlag = False
    For Each Steuerelement In CommandBars("Advo-ware").Controls
        symbol$ = Steuerelement.Caption
        
        If symbol$ = "Benutzer" Then
            Steuerelement.text = kuerzel$
            Exit For
         End If
    Next Steuerelement
    
    gefundenFlag = True
Wend

sAnr$ = GetAnr(0)

'X  = WordExecute("select az FROM akten WHERE nr = " + sanr$ + " ")
'sanr$ = Left$(WordRequest(ret$), laenge)

sAnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "az")

If sAnr$ = "" Then  '31.10.2019 mp: Zur Sicherheit, f|fffd|r eine |fffd|ltere advoware.exe. Kann ab 01.01.2020 gel|fffd|scht werden.
    sAnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nr")
End If
gefundenFlag = False

While gefundenFlag = False
    For Each Steuerelement In CommandBars("Advo-ware").Controls
        symbol$ = Steuerelement.Caption
        
        If symbol$ = "Akte suchen" Then
            Steuerelement.text = sAnr$
            Exit For
        End If
    Next Steuerelement
    
    gefundenFlag = True
Wend

For Each eineVorlage In Templates
    If LCase(eineVorlage.Name) = "advoware.dot" Or LCase(eineVorlage.Name) = "aadvoware.dotm" Or LCase(eineVorlage.Name) = "tk.dot" Or LCase(eineVorlage.Name) = "autotext.dot" Then
        If LCase(eineVorlage.Name) = "aadvoware.dotm" Then
            On Error Resume Next
            Application.Run "akteanzeigendotm", sAnr$
            If Err.Number <> 0 Then Err.Clear
        End If
        
        eineVorlage.Saved = True
        
    End If
Next eineVorlage

WordExecute ("commit")


End Sub

Public Function DokumentordnerFestlegen(K|fffd|rzel$) As String
Dim X As Integer
Dim ret$
Dim l As Integer
Dim standort$
Dim Ordner$, s1$
Dim Anr$, n1
On Error GoTo Ende

ret$ = String(255, " ")
Anr$ = GetDocVar("nr")
standort$ = GetStandort()
If Anr$ <> "0" Then
    X = WordExecute("select speicherort from referate r, akten a where r.kuerzel =a.referat and a.nr = " & Anr$)
    Ordner$ = Left$(WordRequest(ret$), laenge)
    If Len(Ordner$) = 0 Then
        X = WordExecute("select akte from standorte where bezeichnung = '" & standort$ & "'")
        ret$ = Left(WordRequest(ret$), laenge)
        
        If ret$ = "1" Then
            X = WordExecute("select aktenordner from standorte where bezeichnung = '" & standort$ & "'")
            ret$ = String(255, " ")
            Ordner$ = Left(WordRequest(ret$), laenge)
            
            If Right$(Ordner$, 1) <> "\" Then
                Ordner$ = Ordner$ & "\"
            End If
            Ordner$ = Ordner$ & CStr(GetAnr(1))
        Else
            X = WordExecute("select standardordner from mitarbeiter, pfade where mitarbeiter.nr = pfade.mnr and pfade.standort = '" & standort$ & "' and kuerzel = '" & K|fffd|rzel$ & "'")
            ret$ = String(255, " ")
            Ordner$ = Left(WordRequest(ret$), laenge)
        End If
    End If
Else
    X = WordExecute("select standardordner from mitarbeiter, pfade where mitarbeiter.nr = pfade.mnr and pfade.standort = '" & standort$ & "' and kuerzel = '" & K|fffd|rzel$ & "'")
    ret$ = String(255, " ")
    Ordner$ = Left(WordRequest(ret$), laenge)
End If

If Ordner$ <> "" Then
    
    If Len(Ordner) > 2 And Left(Ordner$, 2) <> "\\" And Mid(Ordner$, 2, 1) = ":" And Mid(Ordner$, 3, 1) <> "\" Then
        Ordner$ = Left(Ordner$, 2) & "\" & Right(Ordner$, Len(Ordner$) - 2)
    End If
    
    If Right$(Ordner$, 1) = "\" Then
       Ordner$ = Left(Ordner$, Len(Ordner$) - 1)
    End If
   
    If Dir(Ordner$ + "\*.*", vbDirectory) = "" Then
        MkDir Ordner$
'        If Dir(Ordner$ + "\*.*", vbDirectory) = "" Then
'            MsgBox "Der Ordner " & Ordner$ & " konnte nicht angelegt werden."
'       End If
    End If
    
    On Error Resume Next 'VBA-Bug: Dir(ret$) liefert eine Fehlermeldung, falls es sich bei ret$ um einen Wechseldatentr|fffd|ger handelt
    l = Len(Dir(Ordner$, vbDirectory))
    
    If l > 0 Then
        If StrConv(Options.DefaultFilePath(path:=wdDocumentsPath), vbLowerCase) <> StrConv(Ordner$, vbLowerCase) Then
            ChangeFileOpenDirectory Ordner$
            If Err.Number = 4172 Then
                MsgBox Err.Description & "(4172). |fffd|berpr|fffd|fen Sie, ob unter 'Grundeinstellungen -> Kanzleiorganisation -> Mitarbeiter' der Pfad f|fffd|r 'Standardordner' des aktuellen Sachbearbeiters korrekt eingestellt ist.", vbExclamation
            ElseIf Err.Number <> 0 Then
                MsgBox "Fehler. " & Err.Description & "(" & Str(Err.Number) & ")"
            End If
        End If
    End If
    On Error GoTo 0
End If
Ende:
If Right(Ordner, 1) = "\" Then
    Ordner$ = Left(Ordner$, Len(Ordner$) - 1)
End If

WordExecute ("commit")
DokumentordnerFestlegen = Ordner$
End Function
Attribute VB_Name = "TBundAustauschen"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Private Declare Function WordExecuteTexte Lib "LoadUnload.dll" Alias "WordExecute" (ByVal abfrage$) As Integer
Private Declare Function WordRequestTexte Lib "LoadUnload.dll" Alias "WordRequest" (ByVal ret$) As String
Private Declare Function laengeTexte Lib "LoadUnload.dll" Alias "laenge" () As Integer
Private Declare Function fGetFileDtD Lib "LoadUnload.dll" (ByVal sDatabase$, ByVal nKz As Long, ByVal nLfd As Long, ByVal sPfad$) As Integer
Private Declare Function WordRequestLongVarChar Lib "Advolink.dll" (ByVal ret$) As String

Sub AutotexteNormal() ' Bisherige Autotextfunktion
Attribute AutotexteNormal.VB_Description = "Makro erstellt am 01.03.2004 von Uwe van der Horst"
Attribute AutotexteNormal.VB_ProcData.VB_Invoke_Func = "Normal.AAdvoware.main"
    Dim at As AutoTextEntry
    On Error GoTo Ende
    
    Selection.Range.InsertAutoText
    Selection.TypeText " "
    Selection.Bookmarks.Add ("tempat")
    Austauschen.main
    ActiveDocument.Bookmarks("tempat").Select
    ActiveDocument.Bookmarks("tempat").Delete
Ende:
End Sub

Sub main()
    Dim X As Long
    Dim ret$
    Dim erg$
    Dim s
    s = Trim(Selection.text)
    If (Right(s, 1) = "/" Or Right(s, 2) = "/" + vbCr) And Len(s) > 3 Then
        AnlageEinf|fffd|gen
    Else
        X = WordExecute("select text1 from system where art='autotextef3'")
        ret$ = String(255, " ")
        erg$ = Left(WordRequest(ret$), laenge)
        If erg$ = "1" Then
            AutotexteNeu
        Else
            AutotexteNormal
        End If
    End If
End Sub

Sub AutotexteNeu()
Dim ret$
Dim erg$
Dim betnr$
Dim l|fffd|nge As Long
Dim Autotext$
Dim Pfad$
Dim X
Dim s$, s2$, t$, sTemppath$, sProgramdir$
Dim abfrage$
Dim sFile$
Dim Beschreibung$
On Error GoTo Ende
TextmarkeHinzuf|fffd|gen ("autotexttmp")
Selection.MoveLeft 2, 1, 1
s$ = Trim(Selection.text)

Selection.MoveLeft 2, 1, 1
' wenn ganz am Anfang der Datei, ist s = s2
s2$ = Trim(Selection.text)
If s$ <> s2$ Then
    t = Trim(Selection.text)
    X = Left(t, 1)
    Selection.MoveRight 2, 1, 1
End If

If X = "*" Then
    abfrage$ = "select originaldatei from history where ( @lower( originaldatei ) like @lower( '%" & s$ & "%' ) ) and ( @upper(@right (originaldatei, 3) ) = 'DOC' Or @upper(@right (originaldatei, 4)) = 'DOCX' Or @upper(@right (originaldatei, 3)) = 'ODT' ) "
    X = WordExecute(abfrage)
    
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    Else
        ret$ = String(255, " ")
        erg$ = Left(WordRequest(ret$), laenge)
        If erg$ <> "" Then
            Documents.Open FileName:=erg
        Else
            abfrage$ = "select datei from history where ( @lower( datei ) like @lower( '%" & s$ & "%'  ) ) and ( @upper(@right (datei, 3) ) = 'DOC' Or @upper(@right (datei, 4)) = 'DOCX' Or @upper(@right (datei, 3)) = 'ODT' ) "
            X = WordExecute(abfrage)
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            Else
                ret$ = String(255, " ")
                erg$ = Left(WordRequest(ret$), laenge)
                If erg$ <> "" Then
                    Documents.Open FileName:=erg
                Else
                     MsgBox "Die Datei wurde nicht gefunden.", vbExclamation, GetApplicationName()
                End If
            End If
        End If
    End If
End If


If Mid(t, 1, 2) = "#a" Then
    betnr = Right(Selection.text, Len(t) - 2)
    abfrage$ = "select @trim(anrede||' '||titel||' '||vorname||' '||b.name)||', '||strasse||', '||plz||' '||ort from beteiligte b,adresse a where b.betnr=a.betnr and adnr=1 and a.betnr=" & betnr
    X = WordExecute(abfrage)
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    Else
        ret$ = String(255, " ")
        erg$ = Left(WordRequest(ret$), laenge)
        Selection.MoveLeft 2, 1, 1
        Selection.TypeText erg$
    End If
End If
X = Asc(Right(s, 1))
If Asc(Right(s, 1)) = 13 Then
    s = Left(s, Len(s) - 1)
End If
If Len(s) < 254 Then
    'abfrage$ = "select lfd from autotexte where @upper(kuerzel)=@upper('" & s$ & "')"
    abfrage$ = "select lfd from autotexte where @upper(kuerzel)=@upper('" & UCase$(s$) & "') or  @lower(kuerzel)=@lower('" & LCase$(s$) & "')"
    
    X = WordExecuteTexte(abfrage)
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    Else
        ret$ = String(255, " ")
        sFile = GetTempDir
        Autotext$ = Left(WordRequestTexte(ret$), laengeTexte)
        If Autotext <> "" Then
            fGetFileDtD "TEXTE", 5, Val(Autotext), sFile
            Selection.InsertFile sFile, , , False
            Selection.TypeBackspace
            Kill sFile
            TextmarkeHinzuf|fffd|gen ("autotextgoto")
            Austauschen.main

       Else
            TextmarkeAusw|fffd|hlen ("autotexttmp")
            AutotexteNormal
        End If
    End If
    WordExecuteTexte ("commit")

Else
    TextmarkeAusw|fffd|hlen ("autotexttmp")
    AutotexteNormal
End If
TextmarkeL|fffd|schen ("autotexttmp")
    
TextmarkeAusw|fffd|hlen ("autotextgoto")
TextmarkeL|fffd|schen ("autotextgoto")

Ende:
WordExecuteTexte ("commit")
If Err.Number <> 0 Then MsgBox Err.Description

End Sub


Function GetTempDir()
Dim sProgramdir$
Dim Temppath$
Dim ret$
Dim i As Long
i = 0
sProgramdir$ = GetProgramdir


Temppath$ = sProgramdir$ & "\temp\$autotext" & "_" & i & ".rtf"
ret$ = Dir(Temppath$)
While ret$ <> ""
    i = i + 1
Temppath$ = sProgramdir$ & "\temp\$autotext" & "_" & i & ".rtf"
    ret = Dir(Temppath$)
Wend
GetTempDir = Temppath$
End Function

Sub AnlageEinf|fffd|gen()
    Dim sText$
    Dim sTextVar$
    Dim sVar$
    Dim oRange As Range, oRange2 As Range
    Dim n As Long
    
    sText$ = Trim(Selection.text)
    
    If Right(sText$, 1) = vbCr Then
        sText$ = Left(sText$, Len(sText$) - 1)
    End If
    
    If Right(sText$, 1) = "/" Then
        sText$ = Left(sText$, Len(sText$) - 1)
    End If
    
    sTextVar$ = InputBox("Geben Sie den Text f|fffd|r die Anlage ein", "", sText$)
    
    If sTextVar$ <> "" Then
        Set oRange = Selection.Range
        Selection.TypeText sText$
        TextmarkeHinzuf|fffd|gen ("temp2")
        oRange.Select
        TextmarkeHinzuf|fffd|gen ("temp1")
        n = 1
        sVar = "Anlage000" & Trim(Str(n))
        While GetDocVar(sVar$) <> ""
            n = n + 1
            If n < 10 Then
                sVar = "Anlage000" & Trim(Str(n))
            ElseIf n >= 10 And n < 100 Then
                sVar = "Anlage00" & Trim(Str(n))
            ElseIf n >= 100 And n < 1000 Then
                sVar = "Anlage0" & Trim(Str(n))
            Else
                sVar = "Anlage" & Trim(Str(n))
            End If
        Wend
        SetDocVar sVar$, sTextVar
        AnlagenstrichEinf|fffd|gen
        TextmarkeAusw|fffd|hlen ("temp1")
        oRange = Selection.Range
        TextmarkeAusw|fffd|hlen ("temp2")
        Set oRange2 = Selection.Range
        Selection.Start = oRange.Start
        Selection.End = oRange2.Start
        TextmarkeHinzuf|fffd|gen (sVar)
        TextmarkeL|fffd|schen ("temp1")
        TextmarkeL|fffd|schen ("temp2")
        Selection.MoveRight Unit:=wdCharacter, count:=1
    End If
End Sub

Sub AnlagenstrichEinf|fffd|gen()

    Dim eineVorlage As Template
    Dim oFrame As Frame
    Dim oFrame2 As Frame
    Dim nPositionAnlagenstrich
    Dim nPositionCursor
    Dim oRang As Range
    Dim oShape As Shape
    Dim oShape2 As Shape
    
    nPositionCursor = Selection.Information(wdVerticalPositionRelativeToPage)
    Set oRang = Selection.Range
    For Each eineVorlage In Templates
        If LCase(eineVorlage.Name) = "advoware.dot" Then
            Exit For
        End If
    Next eineVorlage
    Selection.MoveRight Unit:=wdCharacter, count:=1
    If fArtAnlage = 1 Then
        eineVorlage.AutoTextEntries("anlagenstrich").Insert where:=Selection.Range, RichText:=True
        For Each oFrame In ActiveDocument.Frames
            If oFrame.Range.text = "|" Then
                Set oFrame2 = oFrame
            End If
        Next
        oFrame2.Select
        oFrame2.Range.text = "/"
        nPositionAnlagenstrich = Selection.Information(wdVerticalPositionRelativeToPage)
        If (nPositionCursor - nPositionAnlagenstrich) > 0 Then
           oFrame2.VerticalPosition = nPositionCursor - nPositionAnlagenstrich
        End If
    Else
        eineVorlage.AutoTextEntries("anlagenstrich2").Insert where:=Selection.Range, RichText:=True
        For Each oShape In ActiveDocument.Shapes
            If oShape.TextEffect.text = "|" Then
                Set oShape2 = oShape
            End If
        Next
        oShape2.TextEffect.text = "/"
        oShape2.Select
        Selection.EndKey Unit:=wdLine
        Selection.GoTo What:=wdGoToBookmark, Name:="\para"
        Selection.HomeKey Unit:=wdLine
        nPositionAnlagenstrich = Selection.Information(wdVerticalPositionRelativeToPage)
        If (nPositionCursor - nPositionAnlagenstrich - 4) > 0 Then
            oShape2.IncrementTop (nPositionCursor - nPositionAnlagenstrich - 4)
        End If
    End If
    oRang.Select
End Sub

Sub AnlagenAuflisten()  ' der Name darf nicht ge|fffd|ndert werden, da |fffd|ber einen Autotexteintrag diese Funktion aufgerufewn wird
   Dim oVar As Variable
   
    AnlageKopf
    
    For Each oVar In ActiveDocument.Variables
         If Left(oVar.Name, 6) = "Anlage" Then
             Selection.TypeText oVar.Value
             Selection.TypeParagraph
         End If
     Next
     
     If MsgBox("Anlagenstriche ausblenden?", vbYesNo) = vbYes Then
         AnlagenstricheL|fffd|schenX (7)
     End If
End Sub

Sub AnlageKopf()
    Dim oVar As Variable
    Dim nCount As Long
    
    For Each oVar In ActiveDocument.Variables
         If Left(oVar.Name, 6) = "Anlage" Then
             nCount = nCount + 1
         End If
    Next
     
    Selection.Font.ColorIndex = wdAuto
    
    If nCount = 0 Then
         Selection.TypeParagraph
    Else
         Selection.Font.Bold = True
         If nCount = 1 Then
             Selection.TypeText "Anlage"
         Else
             Selection.TypeText "Anlagen"
         End If
         Selection.Font.Bold = False
         Selection.TypeParagraph
    End If

End Sub

Sub AnlagenAuflistenKenntnisnahmezettel()  ' Kenntnisnahmezettel
    Dim oVar As Variable
    Dim bFound As Boolean

    ' AnlageKopf
    Selection.Font.ColorIndex = wdAuto
    For Each oVar In ActiveDocument.Variables
        If Left(oVar.Name, 6) = "Anlage" Then
            Selection.TypeText " - " + oVar.Value
            Selection.TypeParagraph
            bFound = True
        End If
    Next
    If bFound = False Then
        Selection.TypeText " "
    End If
End Sub


Sub AnlagenstricheL|fffd|schenX(lArt As Long)
    Dim oFrame As Frame
    Dim oVar As Variable
    Dim oTexmarke As Bookmark
    Dim lRet As Long
    Dim lZ|fffd|hler As Long
    Dim bFound As Boolean
    Dim oShape As Shape
    
    If lArt = 0 Then
        lRet = MsgBox("Sollen auch die Inhalte, die f|fffd|r die Anlagenstriche hinterlegt sind, gel|fffd|scht werden?", vbYesNoCancel)
    Else
        lRet = lArt
    End If
    If lRet = 6 Or lRet = 7 Then
        bFound = True
        lZ|fffd|hler = 0
        While bFound = True And lZ|fffd|hler < 10    'dies ist notwendig weil oft beim ersten Schleifendurchlauf nicht
                                                'alle Positionsrahmen gefunden werden. Scheinbar ein Bug in MS Word
            bFound = False
            If fArtAnlage = 1 Then
                For Each oFrame In ActiveDocument.Frames
                    If oFrame.Range.text = "/" Then
                        oFrame.Select
                        Selection.Delete Unit:=wdCharacter, count:=1
                        bFound = True
                    End If
                Next
            Else
                For Each oShape In ActiveDocument.Shapes
                    If oShape.TextEffect.text = "/" Then
                        oShape.Delete
                        bFound = True
                    End If
                Next
            End If
            lZ|fffd|hler = lZ|fffd|hler + 1
        Wend
    End If
    If lRet = 6 Then
        For Each oVar In ActiveDocument.Variables
            If Left(oVar.Name, 6) = "Anlage" Then
                oVar.Delete
            End If
        Next
        For Each oTexmarke In ActiveDocument.Bookmarks
            If Left(oTexmarke.Name, 6) = "Anlage" Then
                oTexmarke.Delete
                
            End If
        Next
    End If
End Sub
Sub AnlagenstricheL|fffd|schen()
    AnlagenstricheL|fffd|schenX (0)
End Sub

Sub AnlagenstricheEinblenden()
AnlagenstricheL|fffd|schenX (7)
Dim oTexmarke As Bookmark
For Each oTexmarke In ActiveDocument.Bookmarks
    If Left(oTexmarke.Name, 6) = "Anlage" Then
        oTexmarke.Select
        AnlagenstrichEinf|fffd|gen
    End If
Next
End Sub

Sub AnlagenstricheAusblenden()
    AnlagenstricheL|fffd|schenX (7)
End Sub

Function fArtAnlage() As Long
    Dim X As Long
    Dim ret$, erg$
    Dim nArtAnlagenstrich
    If nArtAnlagenstrich < 1 Then
        X = WordExecute("select 1 from system where art='anlagenstrich' and text1='1'")
        ret$ = String(255, " ")
        erg$ = Left(WordRequest(ret$), laenge)
        If erg$ = "1" Then
            nArtAnlagenstrich = 2
    
        
        Else
            nArtAnlagenstrich = 1
        End If
    End If
    fArtAnlage = nArtAnlagenstrich
End Function

Function GetFaufstatus(Feld, Datei$, Anr$, fkonto$)
    Dim X As Long
    Dim ret$
    Dim erg$
                    fSendMessageAdvoware 10, 0 'FA aktualisieren
    
    If Feld = "SUMME" Then
        X = WordExecute("select kv + ku + hf + ZINSEN  + zinsenk FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "SUMMETZ" Then
        X = WordExecute("select KVTZ + HFTZ FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "ZINSEN" Then 'Nicht |fffd|ndern, damit alte Platzhalter nich ung|fffd|ltig werden!
        X = WordExecute("select zinsen + zinsenk FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "ZINSENFORDERUNG" Then
        X = WordExecute("select zinsen FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "ZINSENKOSTEN" Then
        X = WordExecute("select zinsenk FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "FORDERUNGZINSENFORDERUNG" Then
        X = WordExecute("select hf+zinsen FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "KOSTENZINSENKOSTEN" Then
        X = WordExecute("select kv+zinsenk FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    ElseIf Feld = "MAHNDATUM" Then
        X = WordExecute("select min(bdatum) from forderungen WHERE nr = " + Anr$ + " and text like 'Mahn%'")
    ElseIf Feld = "ZINSBEGINN" Then
        X = WordExecute("select min(zbeginn) from forderungen WHERE nr = " + Anr$ + " and art='Forderung'")
    Else
        X = WordExecute("select " + Feld + " FROM " + Datei$ + " WHERE fkonto = " + fkonto$ + " and nr = " + Anr$)
    End If
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        erg$ = "Fehler"
    Else
        ret$ = String(255, " ")

        erg$ = Left$(WordRequest(ret$), laenge)
    End If
    GetFaufstatus = erg$
                    
End Function

Function GetCount(tabelle, gbnr$, lfd$, Anr$)
    Dim X As Long
    Dim ret$, erg$, abfrage, pos1, pos, num$
    If tabelle = "grundbuch" Then
        abfrage = "select count(*) from " + tabelle + " where nr=" & Anr$
        num$ = gbnr$
'    ElseIf tabelle = "Urkunden" Then
'        tabelle = "aktnot"
'        abfrage = "select count(*) from aktnot where nr=" & Anr$
'        num$ = gbnr$
    Else
'        tabelle = "urolle"
        abfrage = "select count(*) from " + tabelle + " where nr=" & Anr$
        num$ = lfd$
    End If
    If num$ = "" Then
        num$ = 0
    Else
        num$ = CInt(num$)
    End If
    X = WordExecute(abfrage)
    ret$ = String(255, " ")
    pos = CInt(Left$(WordRequest(ret$), laenge))
    If pos < CInt(num$) Then
        num$ = "0"
        GoTo Ende:
    Else
        pos = num$
    End If
    If pos > 0 Then
        pos1 = 0
        If tabelle = "grundbuch" Then
            abfrage = "select gbnr from grundbuch where nr=" + Anr$ & " order by gbnr"
        Else
            abfrage = "select lfd from " & tabelle & " where nr=" + Anr$ & " and gbnr = " & gbnr$ & " order by gbnr, lfd"
        End If
        X = WordExecute(abfrage)
        pos = CInt(pos)
        While pos1 < pos
            ret$ = String(255, " ")
            num$ = Left$(WordRequest(ret$), laenge)
            pos1 = pos1 + 1
        Wend
    End If
Ende:
    GetCount = num$
End Function
Function GetGrundbuch(Feld$, kz$, rang$, Anr$)
    Dim X As Long
    Dim ret$, erg$, abfrage, i, pos, tabelle, count, ind
    kz$ = GetCount("grundbuch", kz$, 0, Anr$)
    i = InStr(Feld$, "#")
    If i > 0 Then
        pos = Right(Feld$, 1)
        Feld$ = Left(Feld$, i - 1)
        Select Case pos
            Case "0"
                tabelle = "grundbuch_bestand"
            Case "1"
                tabelle = "grundbuch_abt1"
            Case "2"
                tabelle = "grundbuch_abt2"
            Case "3"
                tabelle = "grundbuch_abt3"
            Case "5"
                tabelle = "veraeusserung_erwerber"
            Case "4"
                tabelle = "grundbuch_erbbaueigentuemer"
        End Select
        rang$ = GetCount(tabelle, kz$, rang$, Anr$)
    End If
    Select Case Feld$
        Case "GRUNDBUCHVON", "BLATT"
            abfrage = "select " & Feld$ & " from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "AMTSGERICHT"
            abfrage = "select b.name from grundbuch g, beteiligte b where g.betnr = b.betnr and g.nr=" & Anr$ & " and gbnr=" & kz$
        Case "AUFSCHRIFT"
            abfrage = "select besonderheit from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "GRUNDBUCHNAME"
            abfrage = "select Bezeichnung from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "GRUNDBUCHART"
            abfrage = "select art from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "GRUNDBUCHEINSICHT"
            abfrage = "select @DATETOCHAR(datumgbe,'dd.mm.yyyy') from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "LETZTEAENDERUNG"
            abfrage = "select @DATETOCHAR(datumgblaend,'dd.mm.yyyy') from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "LFDNRBV"
            abfrage = "select lfdnr from grundbuch_bestand where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "GEMARKUNG", "LAGE", "WIRTSCHAFTSART", "FLUR", "FLURSTUECK", "GROESSE"
            abfrage = "select " & Feld$ & " from grundbuch_bestand where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "GEMEINDE"
            abfrage = "select b.name from grundbuch_bestand g, beteiligte b where g.gemeinde_betnr = b.betnr and g.nr=" & Anr$ & " and g.gbnr=" & kz$ & " and g.lfd=" & rang$
        Case "LFDNRA1"
            abfrage = "select lfdnr from grundbuch_abt1 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ZUBVA1"
            abfrage = "select zu from grundbuch_abt1 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "EIGENTUEMER"
            abfrage = "select @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name from grundbuch_abt1 g, beteiligte b where g.betnr = b.betnr and g.nr=" & Anr$ & " and g.gbnr=" & kz$ & " and g.lfd=" & rang$
       
        Case "STELLUNG", "ANTEIL"
            abfrage = "select " & Feld$ & " from grundbuch_abt1 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
            
        Case "LFDNRA2"
            abfrage = "select lfdnr from grundbuch_abt2 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ZUBVA2"
            abfrage = "select zu from grundbuch_abt2 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ARTA2"
            abfrage = "select art from grundbuch_abt2 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "BELASTUNGA2"
            abfrage = "select belastung from grundbuch_abt2 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "LFDNRA3"
            abfrage = "select lfdnr from grundbuch_abt3 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ZUBVA3"
            abfrage = "select zu from grundbuch_abt3 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ARTA3"
            abfrage = "select art from grundbuch_abt3 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "BETRAG", "WAEHRUNG"
            abfrage = "select  " & Feld$ & "  from grundbuch_abt3 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "BELASTUNGA3"
            abfrage = "select belastung from grundbuch_abt3 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "BRIEF"
            abfrage = "select @decode( brief,0, 'Brief nicht vorhanden',1, 'Brief vorhanden' )  from grundbuch_abt3 where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "GLAEUBIGER"
            abfrage = "select @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name from grundbuch_abt3 g, beteiligte b where g.glaeubiger_betnr = b.betnr and g.nr=" & Anr$ & " and g.gbnr=" & kz$ & " and g.lfd=" & rang$
       
        Case "WEITEREEINTRAGUNG"
            abfrage = "select weitere_wgb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "BEZUGNAHMEWGB"
            abfrage = "select bezugnahme_wgb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "VERWALTERWGB"
            abfrage = "select @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name from grundbuch g, beteiligte b where g.betnr_verwalter = b.betnr and g.nr=" & Anr$ & " and g.gbnr=" & kz$
        Case "MEA", "SEAN", "BESCHRAENKUNG", "SONDERNUTZUNGSRECHTE"
            abfrage = "select " & Feld$ & " from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "GRUNDBUCHER"
            abfrage = "select grundbuchvon_erb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "BLATTER"
            abfrage = "select blatt_erb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "BVLFDNR"
            abfrage = "select bv_erb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "ABT2LFDNR"
            abfrage = "select abt2 from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "DAUER"
            abfrage = "select dauer from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "BEZUGNAHMEER"
            abfrage = "select bezugnahme_erb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "EIGENTUEMERZUSTIMMUNG"
            abfrage = "select zustimmung_text from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "WEITEREEINTRAGUNGER"
            abfrage = "select weitere_erb from grundbuch where nr=" & Anr$ & " and gbnr=" & kz$
        Case "BEBAUT"
                        X = WordExecute("SELECT bebaut FROM veraeusserung_zusatz where  nr = " & Anr$ & " and gbnr=" & kz$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            X = WordExecute("SELECT wohngebaeude FROM veraeusserung_zusatz where nr = " & Anr$ & " and gbnr=" & kz$)
                            ret$ = String(255, " ")
                            erg$ = Left$(WordRequest(ret$), laenge)
                            If erg$ = "1" Then
                                erg$ = "Wohngeb|fffd|ude"
                            Else
                                erg$ = "andere Bebauung"
                            End If
                        Else
                            erg$ = "nicht bebaut"
                        End If
                        GoTo Ende:
        Case "LANDFORTSW"
            abfrage = "select @decode( land,0, 'nicht land- und forstwirtschaftlich genutzt',1, 'land- und forstwirtschaftlich genutzt' ) from veraeusserung_zusatz where nr=" & Anr$ & " and gbnr=" & kz$
        Case "SONSTIGES"
            abfrage = "select " & Feld$ & " from veraeusserung_zusatz where nr=" & Anr$ & " and gbnr=" & kz$
        Case "RECHTSVORGANG"
                        X = WordExecute("SELECT art FROM veraeusserung_zusatz where  nr = " & Anr$ & " and gbnr=" & kz$)
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                        If erg$ = "1" Then
                            erg$ = "Kauf"
                        ElseIf erg$ = "2" Then
                            erg$ = "Tausch"
                        ElseIf erg$ = "3" Then
                            erg$ = "Abtretung"
                        ElseIf erg$ = "4" Then
                            erg$ = "Schenkung"
                        End If
                        GoTo Ende:
        Case "RECHTSWIRKSAMKEIT"
            abfrage = "select @decode( rechtswirksamkeit,0, 'Rechtswirksamkeit ist nicht eingetreten',1, 'Rechtswirksamkeit ist eingetreten' ) from veraeusserung_zusatz where nr=" & Anr$ & " and gbnr=" & kz$
        Case "UEBERGABETAG"
            abfrage = "select @DATETOCHAR(uebergabetag,'dd.mm.yyyy') from veraeusserung_zusatz where nr=" & Anr$ & " and gbnr=" & kz$
       Case "GENEHMIGUNG"
            abfrage = "select " & Feld$ & " from veraeusserung_zusatz where nr=" & Anr$ & " and gbnr=" & kz$
        Case "KAUFPREIS", "BELASTUNGEN", "SONSTIGE", "INVENTAR"
            abfrage = "select " & Feld$ & " from veraeusserung_zusatz where nr=" & Anr$ & " and gbnr=" & kz$
        Case "EIGENTUEMERNAME"
            abfrage = "select @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name from grundbuch_erbbaueigentuemer g, beteiligte b where g.betnr_eigentuemer = b.betnr and g.nr=" & Anr$ & " and g.gbnr=" & kz$ & " and g.lfd=" & rang$
        Case "EIGENTUEMERSTELLUNG"
            abfrage = "select stellung from grundbuch_erbbaueigentuemer where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "EIGENTUEMERANTEIL"
            abfrage = "select anteil from grundbuch_erbbaueigentuemer where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ALLEEIGENTUEMER"
            abfrage = "select count(*) from grundbuch_erbbaueigentuemer where gbnr = " + kz$ + " and  nr = " & Anr
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            count = Val(erg$)
            abfrage = "SELECT @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name||'    '||g.stellung||'    '||anteil FROM grundbuch_erbbaueigentuemer g, beteiligte b where  g.nr = " + Anr$ + " and g.betnr_eigentuemer = b.betnr and gbnr = " + kz$ + " order by g.lfd"
            ind = 0
            X = WordExecute(abfrage)
            erg = ""
            While ind < count
                ret$ = String(255, " ")
                If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                erg = erg + Left$(WordRequest(ret$), laenge)
                ind = ind + 1
            Wend
            GoTo Ende
        Case "ERWERBERV"
            abfrage = "select verwandt from veraeusserung_erwerber where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            If erg$ = "0" Then
                erg$ = "kein"
            ElseIf erg$ = "1" Then
                erg$ = "Verwandter ( gerade Linie )"
            ElseIf erg$ = "3" Then
                abfrage = "select bezverwandt from veraeusserung_erwerber where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
                X = WordExecute(abfrage)
                ret$ = String(255, " ")
                erg$ = Left$(WordRequest(ret$), laenge)
            End If
            GoTo Ende:
        Case "ERWERBERA"
            abfrage = "select anteil from veraeusserung_erwerber where nr=" & Anr$ & " and gbnr=" & kz$ & " and lfd=" & rang$
        Case "ERWERBERNAME"
            abfrage = "select @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name from veraeusserung_erwerber g, beteiligte b where g.betnr = b.betnr and g.nr=" & Anr$ & " and g.gbnr=" & kz$ & " and g.lfd=" & rang$
        Case "ALLEERWERBER"
            abfrage = "select count(*) from veraeusserung_erwerber where gbnr = " + kz$ + " and  nr = " & Anr
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            count = Val(erg$)
            abfrage = "SELECT @if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name ||'    '||bezverwandt||'    '||anteil FROM veraeusserung_erwerber g, beteiligte b where g.nr = " + Anr$ + " and g.betnr = b.betnr and gbnr = " + kz$ + " order by g.lfd"
            ind = 0
            X = WordExecute(abfrage)
            erg = ""
            While ind < count
                ret$ = String(255, " ")
                If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                erg = erg + Left$(WordRequest(ret$), laenge)
                ind = ind + 1
            Wend
            GoTo Ende
        Case "ALLEBV"
            abfrage = "select count(*) from grundbuch_bestand where gbnr = " + kz$ + " and  nr = " & Anr
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            count = Val(erg$)
            abfrage = "SELECT lfdnr||'    '||gemarkung||'    '||flur||'    '||flurstueck||'    '||Wirtschaftsart||'    '||@if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name ||'    '||lage||'    '||groesse FROM grundbuch_bestand g, beteiligte b where g.nr = " + Anr$ + " and g.gemeinde_betnr = b.betnr and gbnr = " + kz$ + " order by g.lfd"
            ind = 0
            X = WordExecute(abfrage)
            erg = ""
            While ind < count
                ret$ = String(255, " ")
                If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                erg = erg + Left$(WordRequest(ret$), laenge)
                ind = ind + 1
            Wend
            GoTo Ende
        Case "ALLEA1"
            abfrage = "select count(*) from grundbuch_abt1 where gbnr = " + kz$ + " and  nr = " & Anr$
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            count = Val(erg$)
            abfrage = "SELECT lfdnr||'    '||zu||'    '||@if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name||'    '||g.stellung||'    '||anteil FROM grundbuch_abt1 g, beteiligte b where g.nr = " + Anr$ + " and g.betnr = b.betnr and gbnr = " + kz$ + " order by g.lfd"
            ind = 0
            X = WordExecute(abfrage)
            erg = ""
            While ind < count
                ret$ = String(255, " ")
                If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                erg = erg + Left$(WordRequest(ret$), laenge)
                ind = ind + 1
            Wend
            GoTo Ende
        Case "ALLEA2"
            abfrage = "select count(*) from grundbuch_abt2 where gbnr = " + kz$ + " and  nr = " & Anr$
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            count = Val(erg$)
            abfrage = "SELECT lfdnr||'    '||zu||'    '||art||'    '||belastung FROM grundbuch_abt2 where nr = " + Anr$ + " and gbnr = " + kz$ + " order by lfd"
            ind = 0
            X = WordExecute(abfrage)
            erg = ""
            While ind < count
                ret$ = String(255, " ")
                If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                erg = erg + Left$(WordRequest(ret$), laenge)
                ind = ind + 1
            Wend
            GoTo Ende
        Case "ALLEA3"
            abfrage = "select count(*) from grundbuch_abt3 where gbnr = " + kz$ + " and  nr = " & Anr$
            X = WordExecute(abfrage)
            ret$ = String(255, " ")
            erg$ = Left$(WordRequest(ret$), laenge)
            count = Val(erg$)
            abfrage = "SELECT lfdnr||'    '||zu||'   '||g.art||'     '||betrag||'  '||waehrung||' '||belastung||'   '||@if(@isna(titel), '', titel||' ')||@if(@isna(vorname), '', vorname||' ')||b.name||'    '||brief "
            abfrage = abfrage + "FROM grundbuch_abt3 g, beteiligte b where g.nr = " + Anr$ + " and gbnr = " + kz$ + " and g.glaeubiger_betnr=b.betnr(+) order by g.lfd"
            ind = 0
            X = WordExecute(abfrage)
            erg = ""
            While ind < count
                ret$ = String(255, " ")
                If ind > 0 Then erg = erg + Chr(13) + Chr(10)
                erg = erg + Left$(WordRequest(ret$), laenge)
                ind = ind + 1
            Wend
            GoTo Ende
    End Select
    
    X = WordExecute(abfrage)
    ret$ = String(255, " ")
    erg$ = Left(WordRequest(ret$), laenge)
Ende:
GetGrundbuch = erg$
End Function
Function GetUrkunden(Feld$, kz$, Anr$)
    Dim X As Long
    Dim ret$, erg$, abfrage, i, pos, tabelle, count, ind, rang$, urnr
    Dim l|fffd|nge As Integer
    abfrage = "select count(distinct aktnot.urnr) from aktnot where aktnot.nr = " + Anr$
    X = WordExecute(abfrage)
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
    End If
    ret$ = String(255, " ")
    count = CInt(Left$(WordRequest(ret$), laenge))
    abfrage = "select urnr||notar from aktnot where nr = " + Anr$ + " order by urnr "
    X = WordExecute(abfrage)
    ind = 0
    pos = CInt(kz$)
    While ind < pos
            ret$ = String(255, " ")
            urnr = Left$(WordRequest(ret$), laenge)
            ind = ind + 1
    Wend
    
    Select Case Feld$
        Case "URKUNDENNUMMER"
            abfrage = "select @value(@trim(@substring(urnr,5,4)))||'/'||@substring(urnr,2,2) from urolle where angelegt is not null and urnr||notar='" + urnr + "'"
        Case "URKUNDENDATUM"
            abfrage = "select @DATETOCHAR(angelegt,'dd.MM.yyyy') from urolle where urnr||notar='" + urnr + "'"
        Case "URKUNDENORT"
            abfrage = "select geschaeftsort from urolle where urnr||notar='" + urnr + "'"
        Case "GEGENSTAND"
            abfrage = "select ggstand from urolle where urnr||notar='" + urnr + "'"
        Case "KATEGORIE"
            abfrage = "select kategorie from urolle where urnr||notar='" + urnr + "'"
        Case "BEMERKUNG"
            abfrage = "select bemerkung from urolle where urnr||notar='" + urnr + "'"
        Case "AKTENURKUNDE"
            abfrage = "select @value(@trim(@substring(urnr,5,4)))||'/'||@substring(urnr,2,2) from aktnot where nr = " + Anr$
        Case "AKTENURKUNDEDATUM"
            abfrage = "select @DATETOCHAR(angelegt,'dd.MM.yyyy')||' '||@value(@trim(@substring(u.urnr,5,4)))||'/'||@substring(u.urnr,2,2) " + _
            "from urolle u, aktnot a where angelegt is not null and a.urnr=u.urnr and a.notar=u.notar and a.nr=" + Anr$
        End Select
    
                
    ret$ = String(255, " ")
    X = WordExecute(abfrage)
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    If Feld$ = "GEGENSTAND" Or Feld$ = "BEMERKUNG" Then
        erg$ = WordRequest(ret$)
        ret$ = String(10001, " ")
        erg$ = WordRequestLongVarChar(ret$)
        l|fffd|nge = InStr(erg$, Chr$(0))
        If l|fffd|nge < 1 Then l|fffd|nge = 1
        erg$ = Left(erg$, l|fffd|nge - 1)
    ElseIf Feld$ = "AKTENURKUNDE" Or Feld$ = "AKTENURKUNDEDATUM" Then
        ind = 0
        While ind < count
            ret$ = String(255, " ")
            erg$ = erg$ & Left$(WordRequest(ret$), laenge) & ", "
            ind = ind + 1
        Wend
        erg$ = Left$(erg$, Len(erg$) - 2)
    Else
        erg$ = Left$(WordRequest(ret$), laenge)
    End If
Ende:
GetUrkunden = erg$
End Function
Attribute VB_Name = "TK"
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Sub main()
Dim abfrage$
Dim maxnr As Integer
Dim X As Integer
Dim ret$
Dim text$
Dim Name$
Dim docnr$
Dim sDatabase$
Dim mnr$
Dim ProgDir$
On Error GoTo Ende
docnr$ = ActiveDocument.Name

abfrage$ = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
X = WordExecute(abfrage$)
ret$ = String(255, " ")
mnr$ = (Left(WordRequest(ret$), laenge))

If mnr$ = "" Then
    MsgBox "Die Datei ist keiner Ma|fffd|nahme zugeordnet.", vbExclamation, GetApplicationName()
Else
    text$ = Trim(Left(Selection.text, Len(Selection.text)))
    
    If text$ > "" Then
        ProgDir = GetProgramdir
        Name$ = InputBox("Geben Sie einen Namen ein:", GetApplicationName(), Left(text$, 50))
        
        If Name$ <> "" Then
            abfrage$ = "select max(tnr) from textkoerper"
            X = WordExecute(abfrage$)
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            
            If ret$ = "" Then
                maxnr = 1
            Else
                maxnr = CInt2(ret$) + 1
            End If
            
            abfrage$ = "select count(*) from masstext, textkoerper where masstext.tnr= textkoerper.tnr and mnr = " & mnr$ & " and text = '" & Name$ & "'"
            X = WordExecute(abfrage$)
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            
            If ret$ > "0" Then
                MsgBox "Diese Ma|fffd|nahme enth|fffd|lt bereits einen Textk|fffd|rper mit diesem Namen.", vbExclamation, GetApplicationName()
            Else
                abfrage$ = "insert into textkoerper (tnr, text) values(" & maxnr & ",'" & Name$ & "')"
                X = WordExecute(abfrage$)
                
                abfrage$ = "insert into masstext (tnr, mnr, standard) values(" & maxnr & "," & mnr$ & ",'nein')"
                X = WordExecute(abfrage$)
            End If
            
            Selection.Font.ColorIndex = wdBlue
            Documents.Add
            Selection.TypeText text$
            sDatabase$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "database")
            Dim s
            s = Dir(ProgDir & "\tk\", vbDirectory)
            If Dir(ProgDir & "\tk\", vbDirectory) = "" Then
                MkDir (ProgDir & "\tk\")
            End If
            If Dir(ProgDir & "\tk\" & sDatabase$, vbDirectory) = "" Then
                MkDir (ProgDir & "\tk\" & sDatabase$)
            End If
            ActiveDocument.SaveAs ProgDir & "\tk\" & sDatabase$ & "\tk" & maxnr & ".dat", wdFormatRTF
            
            ActiveDocument.Close
            Selection.Bookmarks.Add "TK" & maxnr
        End If
    Else
        MsgBox "Es ist kein Text markiert.", vbExclamation, GetApplicationName()
    End If
End If
Ende:
If Err.Number <> 0 Then MsgBox "Fehler: " & Err.Description
WordExecute "commit"

End Sub
Sub Aufrufen()
Dim abfrage$
Dim ret$
Dim X
Dim docnr$

ret$ = String(255, " ")
docnr$ = ActiveDocument.Name

If docnr$ <> "" Then
    abfrage$ = "select count(*) from masstext,massnahmen where masstext.mnr=massnahmen.nr and( dateirvg='" & docnr$ & "' or datei='" & docnr$ & "')"
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    
    If ret$ > "0" Then
        Load frmTk
        frmTk.Show
    Else
        MsgBox "In der Ma|fffd|nahme ist kein Textk|fffd|rper enthalten.", vbExclamation, GetApplicationName()
    End If
Else
    MsgBox "Der Dateiname ist ung|fffd|ltig.", vbExclamation, GetApplicationName()
End If

End Sub
Attribute VB_Name = "TextAufrufen"
Option Explicit
Public Declare Function ShellExecute Lib "Shell32.dll" Alias "ShellExecuteA" _
  (ByVal hWnd As Long, _
   ByVal lpOperation As String, _
   ByVal lpFile As String, _
   ByVal lpParameters As String, _
   ByVal lpDirectory As String, _
   ByVal nShowCmd As Long) As Long


Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer


Sub DialogAufrufenAusAkte()
Dim a As New clsAuswahlSchriftsatz
Dim Datei As String
Dim lfd$
Dim sBriefkopf$
Dim sIstStandardpfad$
lfd$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd")
Datei = a.DialogDateinameDateil|fffd|ngeFestlegen(lfd$, sBriefkopf$, sIstStandardpfad$)

If a.DateinameAbfragen <> "" Then
    If StrConv(Right(Datei, 4), vbLowerCase) = ".pdf" Then
        ShellExecute 0, "open", Datei, "", "", 1
    Else
        AuswahlNeu Datei, lfd$, sBriefkopf$, sIstStandardpfad$
    End If
End If

End Sub

Sub DialogAufrufen()
Dim a As New clsAuswahlSchriftsatz
Dim Datei As String
Dim lfd$
Dim sBriefkopf$
Dim sIstStandardpfad$
Dim v As Variable
Datei = a.DialogDateinameDateil|fffd|ngeFestlegen(lfd$, sBriefkopf$, sIstStandardpfad$)
If a.DateinameAbfragen <> "" Then
    If StrConv(Right(Datei, 4), vbLowerCase) = ".pdf" Then
        ShellExecute 0, "open", Datei, "", "", 1
    Else
        AuswahlNeu Datei, lfd$, sBriefkopf$, sIstStandardpfad$
    End If

End If

End Sub

Sub AuswahlNeu(Datei$, lfd$, Briefkopf$, sIstStandardpfad$)


Dim briefkopfpfad$
Dim ret$
Dim Adressat$
Dim Anr$
Dim X As Integer
Dim Anschrift$
Dim lCountAutotextealternative As Long
On Error GoTo Ende

Application.ScreenUpdating = False

ret$ = String(255, " ")

Anr$ = GetAnr(0)
 
If lfd$ = "-1" Then
    Selection.InsertFile (Datei$)
ElseIf lfd$ = "0" Or lfd$ = "" Then
    Documents.Add (GetDotpath() + "LEER.dot")
    DokumentvariablenL|fffd|schen.main
    fAutoNew
    Selection.InsertFile (Datei)
    Save.main
    
    SetDocVar "musterschriftsatz", System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Musterschriftsatz")

Else
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "lfd") = lfd$
    
    If Briefkopf$ = "" Then
        Briefkopf$ = "bet1.dot"
    End If
    
    If Briefkopf$ = "Standardbriefkopf" Then
        |fffd|ffneBriefkopf
        DokumentvariablenL|fffd|schen.main
        fAutoNew
    Else

        briefkopfpfad$ = GetBriefkopfpfad$(Anr$)
        WordBasic.filefind SearchPath:=briefkopfpfad$, Name:=Briefkopf$
        
        If WordBasic.CountFoundFiles() = 0 Then
            AnwendungAktivieren ("Microsoft Word")
            MsgBox "Advoware kann keinen Briefkopf ermitteln: " + briefkopfpfad$ + "\" + Briefkopf, vbExclamation, GetApplicationName()
        End If
        
        If Briefkopf$ <> "" Then
            If Right(briefkopfpfad$, 1) <> "\" Then
                briefkopfpfad = briefkopfpfad + "\"
            End If
    
            WordBasic.FileNew NewTemplate:=0, Template:=briefkopfpfad$ + Briefkopf$
            DokumentvariablenL|fffd|schen.main
            fAutoNew
        End If
    End If
    Men|fffd|funktionen.Bet1
    lfd = GetDocVar("adressat")
    
    X = WordExecute("select art||' ('||name||')' from betakt where nr=" & Anr$ & " and lfd=" & lfd$)
    ret$ = String(255, " ")
    Adressat$ = Left(WordRequest(ret$), laenge)
    
    SetDocVar "Musterschriftsatz", Left("Schreiben an " + Adressat$ + " (" + System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Musterschriftsatz") + ")", 100)
    GotoBM ("anfang")
    Selection.InsertFile (Datei)
    Austauschen.main ' Muss hier stehen. Sp|fffd|ter wird <<Betreff>> nicht ersetzt
    'Alternativen merken, um nach Makro Austauschen die Farbe auf zur|fffd|ckzustellen, damit F11 noch funktioniert
    Selection.HomeKey (wdStory)
    Dim bAbbruch As Long
    bAbbruch = False
    Dim l1 As Long, l2 As Long
    While bAbbruch = False And True
        l1 = Selection.Start
        SucheFormat (0)
        l2 = Selection.Start
        If l2 <= l1 Then
            bAbbruch = True
        End If
        If IstAlternative2 = 1 And bAbbruch = 0 Then
            TextmarkeHinzuf|fffd|gen ("autotextealternative" & X)
            Selection.Font.ColorIndex = 3 'Andere Farbe einstellen, damit SucheFormat(0) nicht in einer Endlosschleife h|fffd|ngen bleibt.
        End If
        X = X + 1
    Wend
    lCountAutotextealternative = X
End If
    'ENDE (Alternativen merken, um nach Makro Austauschen die Farbe auf zur|fffd|ckzustellen, damit F11 noch funktioniert)

Austauschen.main

'Alternativen merken, um nach Makro Austauschen die Farbe auf zur|fffd|ckzustellen, damit F11 noch funktioniert
X = 0
While X <= lCountAutotextealternative
    If TextmarkeAusw|fffd|hlen("autotextealternative" & X) = True Then
        Selection.Font.ColorIndex = 5
        TextmarkeL|fffd|schen ("autotextealternative" & X)
    End If
    X = X + 1
Wend
'ENDE (Alternativen merken, um nach Makro Austauschen die Farbe auf zur|fffd|ckzustellen, damit F11 noch funktioniert)

Selection.HomeKey Unit:=wdStory
WordBasic.EditFind Find:="|fffd|Anschrift|fffd|", Direction:=0, Wrap:=1
                    
If WordBasic.EditFindFound() = -1 Then
    If lfd = "0" Or lfd = "" Then
        lfd = GetDocVar("betnr")
        Anschrift$ = GetAnschrift(lfd, "", Anr$)
        lfd = GetDocVar("betnr")
    Else
        Anschrift$ = GetAnschrift("", lfd, Anr$)
    End If
    If Anschrift <> "" Then
       Selection.TypeText Anschrift$
    End If
End If
    

If WordBasic.CountWindows() Then
    If WordBasic.DocumentProtection() = 0 Then
        ActiveWindow.View.ShowFieldCodes = False
    End If
End If

Ende:

If GetBM("documentprotection") Then
    ActiveDocument.Protect Password:="", NoReset:=False, Type:=wdAllowOnlyFormFields
End If

X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub


Attribute VB_Name = "Textbausteine"
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)
Sub main()
Dim Database$
Dim nZaehler As Long
Dim b As Long
If Dir(GetProgramdir & "\" & "autotexte.exe") = "" Then
    main2
Else
    If AnwendungAktivierenFrame$("Autotexte") = 0 Then
        Database$ = GetDatabase
        X = Shell(GetProgramdir & "\" & "autotexte.exe " & Database$, vbNormalFocus)
        AnwendungAktivierenFrame$ ("Autotexte")
    End If
End If
End Sub

Sub main2()
If WordBasic.CountWindows() = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!", vbExclamation, GetApplicationName()
Else
    Load frmTextbausteine
    frmTextbausteine.Show
End If
End Sub
Attribute VB_Name = "TextmarkenSetzen"
Option Explicit

Sub main()
Dim bm As Bookmark
Dim sBM(6)
Dim bGefunden As Boolean
Dim r1 As Range
Dim r2 As Range
Dim i As Integer

For Each bm In ActiveDocument.Bookmarks
    bm.Select
    If MsgBox("Textmarke " & bm.Name & " l|fffd|schen und neu eintragen?", vbYesNo) = vbYes Then
        bm.Delete
    End If
Next
sBM(0) = "anschrift"
sBM(1) = "neutral"
sBM(2) = "banrede"
sBM(3) = "zv"
sBM(4) = "ema"
sBM(5) = "gericht"
sBM(6) = "anfang"

For i = 0 To 6
    bGefunden = False
    For Each bm In ActiveDocument.Bookmarks
        If bm.Name = sBM(i) Then bGefunden = True
    Next
    If bGefunden = False Then
        If i = 0 Then
            Selection.Find.text = "|fffd|Anschrift|fffd|"
            Selection.Find.Wrap = wdFindContinue
            If Not Selection.Find.Execute Then

                bGefunden = True
                Selection.Find.text = "|fffd|Anrede|fffd|"
                Selection.Find.Wrap = wdFindContinue
                If Not Selection.Find.Execute Then
                    bGefunden = False
                End If
                If bGefunden = True Then
                   ' Selection.MoveDown Unit:=wdLine, count:=1
                    Set r1 = Selection.Range
                    Selection.Find.text = "|fffd|Ort|fffd|"
                    Selection.Find.Wrap = wdFindContinue
                    If Selection.Find.Execute Then
                        Set r2 = Selection.Range
                        r1.Select
                        Selection.EndOf Unit:=wdParagraph, Extend:=wdExtend
                        While InStr(1, Selection.text, "|fffd|Ort|fffd|") = 0
                            Selection.MoveDown Unit:=wdParagraph, count:=1, Extend:=wdExtend
                        Wend
                        Selection.MoveLeft Unit:=wdWord, count:=1, Extend:=wdExtend
                        Selection.Find.text = Selection.text
                    End If
                End If
                
            End If

        
        ElseIf i = 1 Then
            bGefunden = True
            Selection.Find.text = "|fffd|Anschrift|fffd|"
            Selection.Find.Wrap = wdFindContinue
            If Not Selection.Find.Execute Then
                bGefunden = False
            End If
            If bGefunden = True Then
                Set r1 = Selection.Range
                Selection.Find.text = "|fffd|Briefanrede|fffd|"
                Selection.Find.Wrap = wdFindContinue
                If Selection.Find.Execute Then
                    Set r2 = Selection.Range
                    r1.Select
                    Selection.EndOf Unit:=wdParagraph, Extend:=wdExtend
                    While InStr(1, Selection.text, "|fffd|Briefanrede|fffd|") = 0
                        Selection.MoveDown Unit:=wdParagraph, count:=1, Extend:=wdExtend
                    Wend
                    Selection.Find.text = Selection.text
                End If
            End If
        ElseIf i = 2 Then
            Selection.Find.text = "|fffd|Briefanrede|fffd|"
        ElseIf i = 3 Then
            bGefunden = True
            Selection.Find.text = "|fffd|betreff|fffd|"
            Selection.Find.Wrap = wdFindContinue
            If Not Selection.Find.Execute Then
                bGefunden = False
            End If
            If bGefunden = True Then
                Selection.MoveDown Unit:=wdLine, count:=1
                Set r1 = Selection.Range
                Selection.Find.text = "|fffd|Briefanrede|fffd|"
                Selection.Find.Wrap = wdFindContinue
                If Selection.Find.Execute Then
                    Set r2 = Selection.Range
                    r1.Select
                    Selection.EndOf Unit:=wdParagraph, Extend:=wdExtend
                    While InStr(1, Selection.text, "|fffd|Briefanrede|fffd|") = 0
                        Selection.MoveDown Unit:=wdParagraph, count:=1, Extend:=wdExtend
                    Wend
                    Selection.MoveLeft Unit:=wdWord, count:=1, Extend:=wdExtend
                    Selection.Find.text = Selection.text
                End If
            End If
        ElseIf i = 4 Then
            Selection.Find.text = "|fffd|Telefax|fffd|"
            Selection.Find.Wrap = wdFindContinue
            bGefunden = True
            If Not Selection.Find.Execute Then
                Selection.Find.text = "|fffd|betreff|fffd|"
                Selection.Find.Wrap = wdFindContinue
                If Not Selection.Find.Execute Then
                    bGefunden = False
                End If
            End If
            If bGefunden = True Then
                Set r1 = Selection.Range
                Selection.Find.text = "|fffd|Briefanrede|fffd|"
                Selection.Find.Wrap = wdFindContinue
                If Selection.Find.Execute Then
                    Set r2 = Selection.Range
                    r1.Select
                    Selection.EndOf Unit:=wdParagraph, Extend:=wdExtend
                    While InStr(1, Selection.text, "|fffd|Briefanrede|fffd|") = 0
                        Selection.MoveDown Unit:=wdParagraph, count:=1, Extend:=wdExtend
                    Wend
                    Selection.MoveLeft Unit:=wdWord, count:=1, Extend:=wdExtend
                    Selection.Find.text = Selection.text
                End If
            End If
                
        ElseIf i = 5 Then
            bGefunden = True
            Selection.Find.text = "|fffd|betreff|fffd|"
            Selection.Find.Wrap = wdFindContinue
            If Not Selection.Find.Execute Then
                bGefunden = False
            End If
            If bGefunden = True Then
                Selection.MoveDown Unit:=wdLine, count:=1
                Set r1 = Selection.Range
                Selection.Find.text = "|fffd|Briefanrede|fffd|"
                Selection.Find.Wrap = wdFindContinue
                If Selection.Find.Execute Then
                    Set r2 = Selection.Range
                    r1.Select
                    Selection.EndOf Unit:=wdParagraph, Extend:=wdExtend
                    While InStr(1, Selection.text, "|fffd|Briefanrede|fffd|") = 0
                        Selection.MoveDown Unit:=wdParagraph, count:=1, Extend:=wdExtend
                    Wend
                    Selection.MoveLeft Unit:=wdWord, count:=1, Extend:=wdExtend
                    Selection.Find.text = Selection.text
                End If
            End If
        ElseIf i = 6 Then
            Selection.EndKey Unit:=wdStory
            Selection.Select
            Selection.Find.text = ""
        End If
        Selection.Find.Wrap = wdFindContinue
        If Selection.Find.Execute Then
            If MsgBox("Textmarke " & sBM(i) & " an der markierten Stelle eintragen?", vbYesNo) Then
                Selection.Bookmarks.Add (sBM(i))
            End If
        End If
    End If
Next

End Sub

Attribute VB_Name = "ThisDocument"
Attribute VB_Base = "0{00020906-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True
Option Explicit

Private Sub Document_Close()
Dim aTemp As Template
    For Each aTemp In Templates
        If LCase(aTemp.Name) = "advoware.dot" Then
            aTemp.Saved = True
        End If
    Next aTemp

End Sub

Attribute VB_Name = "Unterschrift"
Option Explicit
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

Private Declare Function GetOpenFileName Lib "comdlg32.dll" Alias _
  "GetOpenFileNameA" (pOpenfilename As OPENFILENAME) As Long

Private Type OPENFILENAME
  lStructSize As Long
  hwndOwner As Long
  hInstance As Long
  lpstrFilter As String
  lpstrCustomFilter As String
  nMaxCustFilter As Long
  nFilterIndex As Long
  lpstrFile As String
  nMaxFile As Long
  lpstrFileTitle As String
  nMaxFileTitle As Long
  lpstrInitialDir As String
  lpstrTitle As String
  flags As Long
  nFileOffset As Integer
  nFileExtension As Integer
  lpstrDefExt As String
  lCustData As Long
  lpfnHook As Long
  lpTemplateName As String
End Type

Private Function fOpenFile(p_sDir$) As String
    Dim OpenFile As OPENFILENAME
    Dim lReturn As Long
    Dim sFilter As String
    OpenFile.lStructSize = Len(OpenFile)
    
    sFilter = "Alle Dateien (*.*)" & Chr(0) & "*.*" & Chr(0)
    OpenFile.lpstrFilter = sFilter
    OpenFile.nFilterIndex = 2
    OpenFile.lpstrFile = String(256, 0)
    OpenFile.nMaxFile = Len(OpenFile.lpstrFile) - 1
    OpenFile.lpstrFileTitle = OpenFile.lpstrFile
    OpenFile.nMaxFileTitle = OpenFile.nMaxFile
    OpenFile.lpstrInitialDir = p_sDir
    OpenFile.lpstrTitle = "W|fffd|hlen Sie eine Unterschriftsdatei aus"
    OpenFile.flags = 0

    lReturn = GetOpenFileName(OpenFile)
    If lReturn = 0 Then
        fOpenFile = ""
    Else
    'Trim Funtioniert nicht immer, da der Pfad als Unicode zur|fffd|ckgegeben wird.
    While Right(OpenFile.lpstrFile, 1) = " " Or (Asc(Right(OpenFile.lpstrFile, 1)) = 0 And Len(Right(OpenFile.lpstrFile, 1)) = 1)
        OpenFile.lpstrFile = Left(OpenFile.lpstrFile, Len(OpenFile.lpstrFile) - 1)
    Wend
    
    fOpenFile = Trim(OpenFile.lpstrFile)
    End If
End Function

Public Sub main()
Dim us__() As String
Dim Y$
Dim i
Dim Programdir$
Dim faxpath$
Dim Datei$
Dim Pfad$
Dim sCb1 As String
Dim oShape As Shape
Dim oInlineShape As InlineShape
Dim X As Long
If WordBasic.CountWindows() = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!", vbExclamation, GetApplicationName()
Else
    Programdir$ = GetProgramdir$()
    
    If (Right(Programdir$, 1) = "\") Then
        faxpath$ = Programdir$ + "unterschriften\*.*"
    Else
        faxpath$ = Programdir$ + "\unterschriften\*.*"
    End If
    
    ReDim Preserve us__$(0)
    us__$(0) = Dir(faxpath$)          ' Ersten Eintrag abrufen.
    i = 0
    
    Do While us__$(i) <> ""    ' Schleife beginnen.
        Datei$ = Dir     ' N|fffd|chsten Eintrag abrufen.
        i = i + 1
        
        If Datei$ <> "" Then
            ReDim Preserve us__$(i)
            us__$(i) = Datei$
        Else
            Exit Do
        End If
    Loop
    
    ReDim Preserve us__$(i)

    us__$(i) = "<Datei ausw|fffd|hlen>"

    If i = 0 Then
        MsgBox "Sie haben noch keine Unterschriftsdateien angelegt!", vbExclamation, GetApplicationName()
        GoTo Ende
    
    ElseIf i = 0 Then
        Y$ = Left$(faxpath$, Len(faxpath$) - 3) + us__$(0)
    
    Else
        WordBasic.BeginDialog 376, 214, GetApplicationName()
            WordBasic.ListBox 55, 52, 264, 84, us__$(), "unterschrift"
            WordBasic.text 54, 28, 300, 13, "W|fffd|hlen Sie den Unterzeichner:", "Text1"
            WordBasic.CheckBox 54, 150, 300, 13, "Hinter den Text", "cb1"
            WordBasic.OKButton 54, 175, 110, 21
            WordBasic.CancelButton 219, 175, 100, 21
        WordBasic.EndDialog
        Dim dlg As Object: Set dlg = WordBasic.CurValues.UserDialog
        sCb1 = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "unterschrifthinterdentext")
        If sCb1 = "1" Then
            dlg.cb1 = 1
        End If
        X = WordBasic.Dialog.UserDialog(dlg)
        If X <> -1 Then GoTo Ende
        
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "unterschrifthinterdentext") = dlg.cb1
        If us__$(dlg.Unterschrift) = "<Datei ausw|fffd|hlen>" Then
            Pfad$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "unterschriftletzterpfad")
            Y$ = fOpenFile(Pfad$)
            If Y$ = "" Then
                Exit Sub
            End If
            Pfad$ = Left(Y$, InStrRev(Y$, "\"))
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\", "unterschriftletzterpfad") = Pfad$

        Else
            Y$ = Left$(faxpath$, Len(faxpath$) - 3) + us__$(dlg.Unterschrift)
        
        End If
    End If
    
    Set oInlineShape = Selection.InlineShapes.AddPicture(Range:=Selection.Range, FileName:=Y$, LinkToFile:=False, SaveWithDocument:=True)
    If dlg.cb1 = "1" Then
        On Error Resume Next
        oInlineShape.Select
        Set oShape = oInlineShape.ConvertToShape
        If Err.Number <> 0 Then
            Sleep (500)
            Set oShape = oInlineShape.ConvertToShape
        End If
        oShape.WrapFormat.Type = wdWrapNone
        oShape.ZOrder msoSendBehindText
    End If
End If

Ende:

End Sub
Attribute VB_Name = "WordNotify"
Public Sub main()
fSendMessageAdvoware 1, 1
End Sub

Attribute VB_Name = "Zv"
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main()
Attribute main.VB_Description = "Einf|fffd|gen einer Kostenrechnung"
Attribute main.VB_ProcData.VB_Invoke_Func = "TemplateProject.Kr.MAIN"

Dim ret$
Dim erg$
Dim X, anz_spalten
Dim pos
Dim AltPos
Dim Betrag
Dim text_$
Dim wert
Dim kr_spaltenbreite$
Dim left_indent
Dim Knr$
Dim Anr$
Dim pos1$
Dim pos2$
Dim pos3$
Dim pos4$
Dim pos5$
Dim poolkuerzel$
Dim steuernr$
Dim standort$

Anr$ = GetAnr(1)
ret$ = String(255, " ")

Absatz = Selection.ParagraphFormat.LineSpacingRule
Selection.ParagraphFormat.LineSpacingRule = wdLineSpaceSingle
WordBasic.Call "SymbolleisteAktualisieren"

X = WordExecute("SELECT knr FROM krsum where dr = 1 AND nr = " + Anr$)
Knr$ = Left$(WordRequest(ret$), laenge)

X = WordExecute("select text1 from system where art = 'rnr'")
rnr$ = Left$(WordRequest(ret$), laenge)

If rnr$ = "1" Then
    X = WordExecute("select position1 FROM krlayout")
    pos1$ = Left$(WordRequest(ret$), laenge)
    X = WordExecute("select position2 FROM krlayout")
    pos2$ = Left$(WordRequest(ret$), laenge)
    X = WordExecute("select position3 FROM krlayout")
    pos3$ = Left$(WordRequest(ret$), laenge)
    X = WordExecute("select position4 FROM krlayout")
    pos4$ = Left$(WordRequest(ret$), laenge)
    X = WordExecute("select position5 FROM krlayout")
    pos5$ = Left$(WordRequest(ret$), laenge)
    X = WordExecute("SELECT text1 FROM system WHERE art = 'datenpool'")
    poolkuerzel$ = Left$(WordRequest(ret$), laenge)
    
    If pos1$ = "" And pos2$ = "" And pos3$ = "" And pos4$ = "" And pos5$ = "" Then
        pos1$ = "laufende Nummer"
    End If
End If

X = WordExecute("SELECT text2 FROM system WHERE art = 'kr'")
kr_spaltenbreite$ = Left$(WordRequest(ret$), laenge)

X = WordExecute("SELECT count(*) from kr where knr = " + Knr$ + " and (text is null or (text <> 'einfach' and text <> 'doppelt'))")
anz_spalten = Left$(WordRequest(ret$), laenge)

X = WordExecute("SELECT text||'|fffd|'||betrag from kr where knr = " + Knr$ + " order by pnr")
erg$ = Left$(WordRequest(ret$), laenge)

If rnr$ = "1" And Val(Knr$) > 0 Then
    If Len(Knr$) > 6 Then
        If pos1$ = "Jahr 4stellig" Then
            pos1$ = Mid(Knr$, 1, 4)
        ElseIf pos1$ = "Jahr 2stellig" Then
            pos1$ = Mid(Knr$, 3, 2)
        ElseIf pos1$ = "laufende Nummer" Then
            pos1$ = Right(Knr$, Len(Knr$) - 4)
        ElseIf pos1$ = "Datenpoolk|fffd|rzel" Then
            pos1$ = poolkuerzel$
        End If
        
        If pos2$ = "Jahr 4stellig" Then
            pos2$ = Mid(Knr$, 1, 4)
        ElseIf pos2$ = "Jahr 2stellig" Then
            pos2$ = Mid(Knr$, 3, 2)
        ElseIf pos2$ = "laufende Nummer" Then
            pos2$ = Right(Knr$, Len(Knr$) - 4)
        ElseIf pos2$ = "Datenpoolk|fffd|rzel" Then
            pos2$ = poolkuerzel$
        End If
        
        If pos3$ = "Jahr 4stellig" Then
            pos3$ = Mid(Knr$, 1, 4)
        ElseIf pos3$ = "Jahr 2stellig" Then
            pos3$ = Mid(Knr$, 3, 2)
        ElseIf pos3$ = "laufende Nummer" Then
            pos3$ = Right(Knr$, Len(Knr$) - 4)
        ElseIf pos3$ = "Datenpoolk|fffd|rzel" Then
            pos3$ = poolkuerzel$
        End If
        
        If pos4$ = "Jahr 4stellig" Then
            pos4$ = Mid(Knr$, 1, 4)
        ElseIf pos4$ = "Jahr 2stellig" Then
            pos4$ = Mid(Knr$, 3, 2)
        ElseIf pos4$ = "laufende Nummer" Then
            pos4$ = Right(Knr$, Len(Knr$) - 4)
        ElseIf pos4$ = "Datenpoolk|fffd|rzel" Then
            pos4$ = poolkuerzel$
        End If
        
        If pos5$ = "Jahr 4stellig" Then
            pos5$ = Mid(Knr$, 1, 4)
        ElseIf pos5$ = "Jahr 2stellig" Then
            pos5$ = Mid(Knr$, 3, 2)
        ElseIf pos5$ = "laufende Nummer" Then
            pos5$ = Right(Knr$, Len(Knr$) - 4)
        ElseIf pos5$ = "Datenpoolk|fffd|rzel" Then
            pos5$ = poolkuerzel$
        End If
        
        Knr$ = pos1$ + pos2$ + pos3$ + pos4$ + pos5$
    End If
    
    Selection.TypeText "Rechnungsnummer: " + Knr$
    Selection.TypeParagraph
    Selection.TypeParagraph
End If

left_indent = ActiveDocument.Paragraphs(1).LeftIndent
WordBasic.TableInsertTable NumColumns:="2", NumRows:=anz_spalten
Selection.Tables(1).Rows.SetLeftIndent LeftIndent:=left_indent, RulerStyle:= _
wdAdjustNone
WordBasic.TableColumnWidth ColumnWidth:=kr_spaltenbreite$ + " cm", SpaceBetweenCols:="0,15 cm"
Selection.MoveRight Unit:=wdCell
WordBasic.TableColumnWidth ColumnWidth:="2,5 cm", SpaceBetweenCols:="0,15 cm"
Selection.MoveRight Unit:=wdCell

Selection.Tables(1).Select
Selection.MoveLeft Unit:=wdCharacter, count:=1

While RTrim$(erg$) <> ""
    pos = 1
    text_$ = ""
    Betrag = 0
    pos = InStr(1, erg$, "|fffd|")

    If pos > 0 Then
        text_$ = Mid(erg$, 1, pos - 1)
        Betrag = WordBasic.Call("bib.dbzahl", Right$(erg$, Len(erg$) - pos))
    End If

    If text_$ = "" Then
        Selection.MoveDown Unit:=wdLine, count:=1
    
    ElseIf text_$ = "einfach" Then
        WordBasic.TableSelectRow
        WordBasic.FormatBordersAndShading ApplyTo:=0, TopBorder:=1, BottomBorder:=0
    
    ElseIf text_$ = "doppelt" Then
        Selection.MoveUp Unit:=wdLine, count:=1
        WordBasic.TableSelectRow
        WordBasic.FormatBordersAndShading ApplyTo:=2, TopBorder:=1, BottomBorder:=7
        With Selection.Cells
            With .Shading
                .Texture = wdTextureNone
                .ForegroundPatternColorIndex = wdAuto
                .BackgroundPatternColorIndex = wdGray25
            End With
        End With
        
        Selection.MoveDown Unit:=wdLine, count:=1
    
    Else
        If (Betrag <> 0) Then
            If Left$(text_$, 16) = "Gegenstandswert:" Then
                WordBasic.TableInsertRow NumRows:=""
                WordBasic.CharRight 1
                pos = InStr(18, text_$, " ")
                betrag_$ = WordBasic.Call("bib.wformat$", Betrag)

                With Selection
                    .TypeText text:="Gegenstandswert: " + WordBasic.Call("bib.wformat$", WordBasic.Val(betrag_$)) + " |fffd|"
                End With
                Selection.SelectRow
                
                With Selection.Cells
                    With .Borders(wdBorderBottom)
                        .LineStyle = wdLineStyleSingle
                    End With
                End With
                
                Selection.MoveDown Unit:=wdLine, count:=1
            Else
                Selection.TypeText (text_$)
                Selection.MoveRight Unit:=wdCell
                WordBasic.FormatParagraph Alignment:=2
                Selection.TypeText (WordBasic.Call("bib.wformat$", Betrag) + " |fffd|")
                Selection.MoveRight Unit:=wdCell
            End If
        Else
            Selection.TypeText (text_$)
            Selection.HomeKey Unit:=wdLine
            Selection.EndKey Unit:=wdLine, Extend:=wdExtend
            Selection.MoveRight Unit:=wdCharacter, count:=1, Extend:=wdExtend

            With Selection.Cells
                With .Shading
                    .Texture = wdTextureNone
                    .ForegroundPatternColorIndex = wdAuto
                    .BackgroundPatternColorIndex = wdGray25
                End With
            End With
            
            Selection.MoveDown Unit:=wdLine, count:=1
        End If
    End If

    erg$ = Left$(WordRequest(ret$), laenge)
Wend

X = WordExecute("select text3 from system where art = 'kr'")
steuernr$ = Left$(WordRequest(ret$), laenge)
standort$ = GetStandort()

If steuernr$ = "1" Then
    Selection.MoveDown Unit:=wdLine, count:=1
    Selection.TypeParagraph
    WordExecute ("select fa_name from standorte where bezeichnung = '" + standort$ + "'")
    Finanzamt$ = Left$(WordRequest(ret$), laenge)
    WordExecute ("select fa_steuernr from standorte where bezeichnung = '" + standort$ + "'")
    steuernr$ = Left$(WordRequest(ret$), laenge)
    Selection.TypeText Finanzamt$ + "  -  " + "Steuernummer: " + steuernr$
End If

Selection.TypeParagraph
SetDocVar "history", "Kostenrechnung"
Austauschen.main

Ende:

X = WordExecute("Commit")

End Sub

Attribute VB_Name = "bib"
Option Explicit

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer


Public Function gdat$(Datum$)
If Datum$ <> "" Then
    gdat$ = Mid(Datum$, 9, 2) + "." + Mid(Datum$, 6, 2) + "." + Mid(Datum$, 1, 4)
Else
    gdat$ = ""
End If
End Function

Public Function zehntel(wert, bruch)
Dim X
Dim Y

X = wert * bruch / 10
Y = X * 10 Mod 1

If Y > 0 Then
    zehntel = bib.Val2(Left$(Str(X), InStr(Str(X), ",") + 1)) + 0.1
Else
    zehntel = X
End If

End Function


Public Function repl$(erg$, X, Y, y_$)
repl$ = Left$(erg$, X - 1) + y_$ + Right$(erg$, Len(erg$) - X - Y + 1)
End Function


Public Function dbzahl(erg$)
Dim X

X = InStr(erg$, ".")

If X > 0 Then
    erg$ = repl$(erg$, X, 1, ",")

End If

dbzahl = bib.Val2(erg$)
End Function


Public Function dbzahlback$(erg$)
Dim X

X = InStr(erg$, ",")

If X > 0 Then
    erg$ = repl$(erg$, X, 1, ".")
End If

dbzahlback$ = erg$
End Function


Public Function wformat$(X)
Dim erg$
Dim Version$
Dim Y$
Dim y_
Dim z$
Dim i
Dim wf$

erg$ = Str(X)
Version$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "wordversion")

If InStr(erg$, ".") > 0 Then
    Y$ = Left$(erg$, InStr(erg$, ".") - 1)
Else
    Y$ = erg$
End If

y_ = Len(Y$)
z$ = ""

For i = 0 To y_ - 2
    z$ = Mid(Y$, y_ - i, 1) + z$
    
    If ((i + 1) Mod 3 = 0) And i + 2 <> y_ Then
        z$ = "." + z$
    End If
Next

If z$ = "" Then z$ = "0"

If InStr(erg$, ".") = 0 Then
    wf$ = z$ + ",00"
ElseIf InStr(erg$, ".") = Len(erg$) - 1 Then
    wf$ = z$ + "," + Mid(erg$, InStr(erg$, ".") + 1, 1) + "0"
Else
    wf$ = z$ + "," + Mid(erg$, InStr(erg$, ".") + 1, 2)
End If

If X < 0 Then
    wf$ = "- " + wf$
End If

wformat$ = wf$
End Function
Public Function geb|fffd|hr(X)
Dim ret$
Dim nI
Dim nWert
Dim erg
Dim satz

ret$ = String(255, " ")

If X <= 3000 Then
    nI = X Mod 600
    If nI = 0 Then
        nWert = X
    Else
        nWert = ((WordBasic.Int(X / 600)) + 1) * 600
    End If
    erg = (nWert / 15 + 10)

ElseIf X <= 10000 Then
    nI = X Mod 1000
    If nI = 0 Then
        nWert = X
    Else
        nWert = ((WordBasic.Int(X / 1000)) + 1) * 1000
    End If
    erg = (nWert * 0.055 + 45)

ElseIf X <= 20000 Then
    nI = X Mod 2000
    If nI = 0 Then
        nWert = X
    Else
        nWert = ((WordBasic.Int(X / 2000)) + 1) * 2000
    End If
    erg = (nWert * 0.035 + 245)

ElseIf X <= 50000 Then
    nI = X Mod 5000
    If nI = 0 Then
        nWert = X
    Else
        nWert = ((WordBasic.Int(X / 5000)) + 1) * 5000
    End If
    erg = (nWert * 0.016 + 625)

ElseIf X <= 100000 Then
    nI = X Mod 10000

    If nI = 0 Then
        nWert = X
    Else
        nWert = ((WordBasic.Int(X / 10000)) + 1) * 10000
    End If

    erg = (nWert * 0.014 + 725)

ElseIf X <= 400000 Then
    nI = (X - 100000) Mod 30000

    If nI = 0 Then
        nWert = X + 100000
    Else
        nWert = (((WordBasic.Int((X - 100000) / 30000)) + 1) * 30000) + 100000
    End If

    erg = (nWert * 2 / 375 + 1591.666)

ElseIf X <= 1000000 Then
    nI = (X - 400000) Mod 60000

    If nI = 0 Then
        nWert = X + 400000
    Else
        nWert = (((WordBasic.Int((X - 400000) / 60000)) + 1) * 60000) + 400000
    End If

    erg = (nWert / 240 + 2058.333)

ElseIf X > 1000000 Then
    nI = X Mod 100000

    If nI = 0 Then
        nWert = X
    Else
        nWert = ((WordBasic.Int(X / 100000)) + 1) * 100000
    End If

    erg = (nWert * 0.003 + 3225)
End If

If (X = WordExecute("select text1 from system where art = 'geb|fffd|hr'")) = 0 Then
    satz = bib.Val2(Left$(WordRequest(ret$), laenge))
Else
    satz = 100
End If

geb|fffd|hr = erg * satz / 100
X = WordExecute("Commit")
End Function


' Anstelle von WordBasic.Val (Funktioniert unter manchen Wordversionen nicht)
Public Function Val2(s$) As Double
Dim X As Integer
If Left(s$, 1) = "," Then
    s$ = "0" & s$
End If
X = InStr(s$, ",")
If X > 0 Then
    s$ = repl$(s$, X, 1, ".")
End If

If Val(s$) <> 0 Then
    If Len(s$) > 0 Then
        Val2 = Val(s$)
    Else
        Val2 = 0
    End If
Else
    Val2 = 0
End If
End Function


' Anstelle von CInt
Public Function CInt2(s$) As Long
    If s$ = "" Then
        CInt2 = 0
    Else
        CInt2 = CLng(s$)
    
    End If
End Function


Attribute VB_Name = "clsActiveDocument"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Public WithEvents ActiveDoc As Document
Attribute ActiveDoc.VB_VarHelpID = -1

Private Sub ActiveDoc_Close()
'Siehe Bemerkung unter "clsApplication.WordApp_DocumentBeforeClose"
    
    Dim nRet As Long
    Dim sSchliessenOhneSpeichern$
    Dim sDiktatNr$
    If GetDocVar("pdfkonvertieren") = "ja" Then
        Exit Sub
    End If
    
    sSchliessenOhneSpeichern$ = System.PrivateProfileString _
    ("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "schliessenohnespeichen") 'Notwendig bei gesplitteten Kostenrechnungen
    'MsgBox GetDocVar("muster")
    If GetDocVar("verf|fffd|gung") <> "1" And sSchliessenOhneSpeichern$ <> "1" And GetDocVar("muster") <> "ja" Then
       If Documents.count() > 0 Then
            ActiveDocument.AttachedTemplate.Saved = True
        End If

        If ActiveDoc.Saved = False Then
            nRet = MsgBox("M|fffd|chten Sie die |fffd|nderungen in " & ActiveDoc.Name & " speichern", vbExclamation + vbYesNoCancel)
            If nRet = vbYes Then
                global_bDoNotClose = True
                Advoware.main
                global_bDoNotClose = False
                ActiveDocument.Saved = True ' Das Speichern  wird in  Advoware.main vorgenommen. H|fffd|ufig kommt aber nach Verlassen dieser Sub die Meldung "|fffd|nderung speichern"
            ElseIf nRet = vbNo Then
                ActiveDocument.Saved = True 'Nicht speichern. |fffd|nderungen gehen verloren
                sDiktatNr$ = GetDocVar("diktatnr")
                If sDiktatNr$ <> "" And GetDocVar("status") = "ja" Then
                    LoadFrmDiktatstatus.main sDiktatNr$
                End If
            ElseIf nRet = vbCancel Then
                SendKeys "{ESC}", 0 ' damit die Frage "|fffd|nderung speichern" nicht noch mal kommt und das Dokument ge|fffd|ffnet bleibt
                Exit Sub
            End If
        Else
            global_bDoNotClose = True
            Advoware.main
            global_bDoNotClose = False
        End If
    End If
Ende:
If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "schliessenohnespeichen") = "1" Then
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "schliessenohnespeichen") = ""
End If
ActiveDocument.Saved = True

End Sub


Public Sub DeleteAktuellesDocumentActiveDoc()
    Set AktuellesDocument.ActiveDoc = Nothing
End Sub

Attribute VB_Name = "clsApplication"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit

Public WithEvents WordApp As Word.Application
Attribute WordApp.VB_VarHelpID = -1

Private Sub WordApp_DocumentBeforeCloseDeaktiviert(ByVal Doc As Document, Cancel As Boolean)
'Der selben Code  wird in ActiveDoc_Close aufgerufen. Hier sollte das "Abbrechen"-Ereignis behandelt werden. Das ist in ActiveDoc_Close schwierig.
'in ActiveDoc_Close dasf der Code nicht gel|fffd|scht werden, weil in manchen
    Dim nRet As Long
    'MsgBox "Fehler1563"
    If GetDocVar("verf|fffd|gung") <> "1" Then
        If Documents.count() > 0 Then
            ActiveDocument.AttachedTemplate.Saved = True
        End If

        If Doc.Saved = False Then
            nRet = MsgBox("M|fffd|chten Sie die |fffd|nderungen in " & Doc.Name & " speichern", vbInformation + vbYesNoCancel)
            If nRet = vbYes Then
                Advoware.main
            ElseIf nRet = vbNo Then
                ActiveDocument.Saved = True
            ElseIf nRet = vbCancel Then
                  Cancel = True
            End If
        End If
    End If
End Sub

Private Sub WordApp_DocumentOpen(ByVal Doc As Document)
    If Documents.count > 0 Then
        Advoware.SetActiveDoc
    Else
        AktuellesDocument.DeleteAktuellesDocumentActiveDoc
    End If

End Sub

Private Sub WordApp_WindowActivate(ByVal Doc As Document, ByVal Wn As Window)
    On Error GoTo Ende
    If Documents.count > 0 Then
        If ActiveDocument.Type = wdTypeDocument Then
            If GetDocVar("DATABASE") <> "" And GetDocVar("muster") <> "ja" Then
                Set AktuellesDocument.ActiveDoc = ActiveDocument
                StatusBar = "Nr: " & GetDocVar("nr") + " - Datenbank: " & GetDocVar("DATABASE")
            End If
        End If
    Else
        AktuellesDocument.DeleteAktuellesDocumentActiveDoc
    End If
Ende:
End Sub


Attribute VB_Name = "clsAuswahlSchriftsatz"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Option Explicit
Private Dateiname As String
Private Dateil|fffd|nge As Integer
Private RegPfad As String
Private Briefkopf$
Private IstStandardpfad$
Private Declare Function Musterauswahl Lib "Advolink.dll" (ByVal Dateiname As String, ByVal RegPfad As String, ByRef lfd$, ByRef Briefkopf$, ByRef IstStandardpfad$) As String
Private Declare Function DialogSpeichern Lib "Advolink.dll" (ByVal Dateiname As String, ByVal RegPfad As String) As String

Private Sub Class_Initialize()
  '  Dateiname = String(255, " ")
  '  Dateil|fffd|nge = 0
  '  RegPfad = Men|fffd|funktionen.GetSchpath
End Sub

Private Sub Dateil|fffd|ngeFestlegen()
    Dateil|fffd|nge = InStr(1, Dateiname, Chr(0)) - 1
End Sub
 
Public Function DialogDateinameDateil|fffd|ngeFestlegen(ByRef lfd$, ByRef Briefkopf$, ByRef sIstStandardpfad$) As String
    If lfd = "" Then
        lfd$ = String(255, " ")
    Else
        lfd$ = lfd + String(255, " ")
    End If
    
    IstStandardpfad$ = String(255, " ")
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "betnr") = ""
    Briefkopf$ = String(255, " ")
    
    '18.06.2019 mp
    Dateiname = String(255, " ")
    Dateil|fffd|nge = 0
    RegPfad = Men|fffd|funktionen.GetSchpath
    
    Dateiname = Musterauswahl(Dateiname, RegPfad, lfd$, Briefkopf$, IstStandardpfad$)
    If IstStandardpfad$ <> "" And InStr(1, IstStandardpfad$, Chr(0)) Then
        IstStandardpfad$ = Left(IstStandardpfad$, InStr(1, IstStandardpfad$, Chr(0)) - 1)
    End If
    sIstStandardpfad$ = IstStandardpfad$
    If lfd <> "" And InStr(1, lfd$, Chr(0)) Then
        lfd = Left(lfd, InStr(1, lfd$, Chr(0)) - 1)
    End If
    If Briefkopf$ <> "" And InStr(1, Briefkopf$, Chr(0)) Then
        Briefkopf$ = Left(Briefkopf$, InStr(1, Briefkopf$, Chr(0)) - 1)
    End If
    Dateil|fffd|ngeFestlegen
    Dateiname = Left(Dateiname, Dateil|fffd|ngeAbfragen)
    If Dateiname <> "" And (InStr(1, Dateiname, Chr(0)) > 0) Then
        Dateiname = Left(Dateiname, InStr(1, Dateiname, Chr(0)) - 1)
    End If

    DialogDateinameDateil|fffd|ngeFestlegen = Dateiname
End Function

Public Function DateinameAbfragen() As String
    DateinameAbfragen = Dateiname
End Function

Public Function Dateil|fffd|ngeAbfragen() As Integer
Dateil|fffd|ngeAbfragen = Dateil|fffd|nge
End Function

Attribute VB_Name = "clsDialogSpeichern"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Option Explicit
Private Dateiname As String
Private Dateil|fffd|nge As Integer
Private RegPfad As String
Private Declare Function DialogSpeichern Lib "Advolink.dll" (ByVal Dateiname As String, ByVal RegPfad As String) As String

Private Sub Class_Initialize()
    Dateiname = String(255, " ")
    Dateil|fffd|nge = 0
    RegPfad = Men|fffd|funktionen.GetSchpath
End Sub


Private Sub Dateil|fffd|ngeFestlegen()
    Dateil|fffd|nge = InStr(1, Dateiname, Chr(0)) - 1
End Sub

Public Function DialogDateinameDateil|fffd|ngeFestlegen() As String
    Dateiname = DialogSpeichern(Dateiname, RegPfad)
    Dateil|fffd|ngeFestlegen
    Dateiname = Left(Dateiname, Dateil|fffd|ngeAbfragen)
    DialogDateinameDateil|fffd|ngeFestlegen = Dateiname
End Function

Public Function DateinameAbfragen() As String
    DateinameAbfragen = Dateiname
End Function

Public Function Dateil|fffd|ngeAbfragen() As Integer
Dateil|fffd|ngeAbfragen = Dateil|fffd|nge
End Function


Attribute VB_Name = "clsPlatzhalter"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Public WithEvents Optionsfeld As OptionButton
Attribute Optionsfeld.VB_VarHelpID = -1

Private Sub Optionsfeld_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    If nFormnumber = 2 Then
        frmPlatzhalter2.Auswahl
        If frmPlatzhalter2.CheckBoxEnde.Value = True Then
            Unload frmPlatzhalter2
            Unload frmPlatzhalter
        End If
    Else
        frmPlatzhalter.Auswahl
        If frmPlatzhalter.CheckBoxEnde.Value = True Then
            Unload frmPlatzhalter
        End If
    
    End If
End Sub

Private Sub Optionsfeld_KeyUp(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
    If KeyCode = 27 Then
        If nFormnumber = 2 Then
            Unload frmPlatzhalter2
        Else
            Unload frmPlatzhalter
        End If
    End If
End Sub

Attribute VB_Name = "clsSchaden"
Attribute VB_Base = "0{FCFB3D2A-A0FA-1068-A738-08002B3371B5}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False



Option Explicit

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer



Sub Execute(inAbfrage$)
Dim X As Integer
X = WordExecute(inAbfrage)
End Sub

Function Request()
Dim ret$
Dim X As Integer

ret$ = String(255, " ")

Request = Left(WordRequest(ret$), laenge)

End Function
Attribute VB_Name = "eigene"
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub eigene()
Dim ret$
Dim erg$
Dim Temp$
Dim i
ReDim vorlagen__$(0)
Dim Os$
Dim Y
Dim n
Dim dlg As Object
Dim X
Dim Vorlage$
Dim Schrifts|fffd|tze$
Dim DocVar$
Dim var As Variable

Schrifts|fffd|tze$ = Men|fffd|funktionen.GetSchpath

If Right(Schrifts|fffd|tze$, 1) <> "\" Then
    Schrifts|fffd|tze = Schrifts|fffd|tze + "\"
End If

ret$ = String(255, " ")

pfad_eigene$ = Schrifts|fffd|tze$ & "Favoriten"
Temp$ = WordBasic.[Files$](pfad_eigene$ + "\*.dat")
i = -1

While Temp$ <> ""
    i = i + 1
    Temp$ = WordBasic.[Files$]()
Wend

If i > -1 Then
    ReDim vorlagen__$(i)

    erg$ = Schrifts|fffd|tze + "Favoriten"
    Length = Len(erg$)
    Os$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "OS")
    laenge_eigene_pfad = Len(erg$)
    
    erg$ = WordBasic.[Files$](erg$ + "\*.dat")
    
    Rem Der folgende Schwachsinn ist notwendig, da Winword um Dateinamen, die
    Rem Leerzeichen enthalten, doppelte Anf|fffd|hrungszeichen setzt:
        
    If Right$(erg$, 1) = Chr(34) Then
        erg$ = Left$(erg$, Len(erg$) - 1)
        erg$ = Right$(erg$, Len(erg$) - 1)
    End If
    
    vorlagen__$(0) = Right$(erg$, Len(erg$) - laenge_eigene_pfad - 1)
        
    For n = 1 To i
        erg$ = WordBasic.[Files$]()
            
        Rem Der folgende Schwachsinn ist notwendig, da Winword um Dateinamen, die
        Rem Leerzeichen enthalten, doppelte Anf|fffd|hrungszeichen setzt:
        
        If Right$(erg$, 1) = Chr(34) Then
            erg$ = Left$(erg$, Len(erg$) - 1)
            erg$ = Right$(erg$, Len(erg$) - 1)
        End If
    
        vorlagen__$(n) = Right$(erg$, Len(erg$) - laenge_eigene_pfad - 1)
    Next n

    WordBasic.SortArray vorlagen__$()

    WordBasic.BeginDialog 590, 450, "Auswahl eigener Vorlagen"
        WordBasic.text 30, 20, 220, 13, "Bitte w|fffd|hlen Sie die Vorlage:", "Text1"
        WordBasic.ListBox 30, 40, 530, 300, vorlagen__$(), "eigene"
        WordBasic.OKButton 30, 400, 110, 21
        WordBasic.PushButton 150, 400, 110, 21, "Zur|fffd|ck"
        WordBasic.CheckBox 30, 360, 150, 21, "Urkunden anzeigen", "urkanz"
    WordBasic.EndDialog

    Set dlg = WordBasic.CurValues.UserDialog

    X = WordBasic.Dialog.UserDialog(dlg)

    If X = -1 Then
        eigene_vorlage$ = pfad_eigene$ + "\" + vorlagen__$(dlg.eigene)
        
        DocVar = vorlagen__$(dlg.eigene)
        
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0"
        Load frmSchliessen
        If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "0" Then
            frmSchliessen.Show
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
        Else
        
            System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
            Unload frmSchliessen
        End If
        If WordBasic.[Files$](eigene_vorlage$) = "" Then
            MsgBox "Musterschriftsatz nicht vorhanden.", vbExclamation, GetApplicationName()
            WordBasic.DocClose (2)
            GoTo EndeEigene
        End If
        
        Men|fffd|funktionen.|fffd|ffneBriefkopf
        
        If ActiveDocument.Bookmarks.Exists("neutral") = True Then
            ActiveDocument.Bookmarks("neutral").Select
            ActiveDocument.Bookmarks("neutral").Delete
            Selection.Delete
        End If
        
        WordBasic.InsertFile Name:=eigene_vorlage$
        WordBasic.EditClear 2
        WordBasic.Call "Men|fffd|funktionen.Bet1"
        
        If WordBasic.CountWindows() Then
            If WordBasic.DocumentProtection() = 0 Then
                ActiveWindow.View.ShowFieldCodes = False
            End If
        End If
        
        Austauschen.main
        WordBasic.UpdateFields
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "datei") = eigene_vorlage$
        Application.ScreenRefresh
        Application.ScreenUpdating = True
        
        For Each var In ActiveDocument.Variables
            If var.Name = "history" Then
                 var.Delete
            End If
        Next
        
        ActiveDocument.Variables.Add "history", DocVar
    
    End If

Else
    MsgBox "Sie haben noch keine eigenen Vorlagen erstellt!", vbExclamation, GetApplicationName()
End If

EndeEigene:
X = WordExecute("Commit")
End Sub
Attribute VB_Name = "frmAnhang"
Attribute VB_Base = "0{B1F8DC4E-2C69-4395-8306-46C81CEE0444}{D07D1DE3-F8E0-451B-9FB8-029725CAF78E}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Dim uIDs As New Collection
Dim Pfade As New Collection
Private Sub UserForm_Initialize()
Anr$ = GetAnr(1)
X = WordExecute("select hart from history where datei is not null and nr = " & Anr$ & " order by hdat desc,hnr desc")
ret$ = String(255, " ")
erg$ = Left(WordRequest(ret$), laenge)
While erg$ <> ""
    lbAnhang.AddItem (erg$)
    erg$ = Left(WordRequest(ret$), laenge)
Wend

X = WordExecute("select datei from history where datei is not null and  nr = " & Anr$ & " order by hdat desc,hnr desc")
ret$ = String(255, " ")
erg$ = Left(WordRequest(ret$), laenge)
While erg$ <> ""
    Pfade.Add (erg$)
    erg$ = Left(WordRequest(ret$), laenge)
Wend
End Sub

Private Sub cmdDurchsuchen_Click()
   Dim lngCount As Long
 
    ' Open the file dialog
    With Application.FileDialog(msoFileDialogOpen)
        .AllowMultiSelect = False
              .Filters.Clear
      .Filters.Add "Alle Dateien", "*.*"
      .Filters.Add "PDF - Portable Document Format", "*.pdf"
      .InitialFileName = Environ("USERPROFILE") & "\"
      .Show

        ' Display paths of each file selected
        For lngCount = 1 To .SelectedItems.count
            CheckOut (.SelectedItems(lngCount))
        Next lngCount
 
    End With
End Sub

Private Sub cmdOk_Click()
If lbAnhang.Listindex > -1 Then
    CheckOut (Pfade(lbAnhang.Listindex + 1))
Else
    Dim msg As String
    Dim title As String
    Dim style As VbMsgBoxStyle
    Dim response As VbMsgBoxResult
    msg = "W|fffd|hlen Sie einen Anhang aus oder klicken Sie auf Schlie|fffd|en."   ' Define message.
    style = vbOKOnly + vbInformation
    title = "Kein Anhang ausgew|fffd|hlt"   ' Define title.
    ' Display message.
    response = MsgBox(msg, style, title)
End If
End Sub
Private Sub CheckOut(path As String)
Dim StrName As String
Dim StrPath As String
Dim pathNew As String
Dim d As Document

If InStr(path, ".DOCX") Or InStr(path, ".DOC") Or InStr(path, ".PDF") Or InStr(path, ".pdf") Or InStr(path, ".docx") Or InStr(path, ".docm") Or InStr(path, ".dotx") Or InStr(path, ".dotm") Or InStr(path, ".doc") Or InStr(path, ".dot") Or InStr(path, ".htm") Or InStr(path, ".html") Or InStr(path, ".rtf") Or InStr(path, ".xml") Or InStr(path, ".odt") Then 'Check if this is a special file
    If InStr(path, ".PDF") = 0 And InStr(path, ".pdf") = 0 Then
        StrPath = Left(path, InStrRev(path, "\"))
        StrName = Right(path, Len(path) - Len(StrPath))
        If InStr(StrName, ".") Then
            StrName = Left(StrName, (InStr(StrName, ".") - 1))
        Else
            StrName = StrFile
        End If
        'StrPath = Environ("temp") & "\"
        pathNew = StrPath + StrName + "(Anhang)" + ".pdf"
            'umwandeln anfang
            Set d = Documents.Open(FileName:=path)
            d.SaveAs2 pathNew, 17
            d.Variables.Add "pdfkonvertieren", "ja"
            
            d.Close SaveChanges:=wdDoNotSaveChanges
            ActiveDocument.Save
            'umwandeln ende
    Else
        pathNew = path
    End If
    If (pathNew > "") Then
        frmSchliessen.SetAnhang (pathNew)
        Unload Me
    End If
Else
    Dim msg As String
    Dim title As String
    Dim style As VbMsgBoxStyle
    Dim response As VbMsgBoxResult
    msg = "Nur Word kompatible Dateitypen sind als Anhang erlaubt (.pdf/.doc/.docx)."   ' Define message.
    style = vbOKOnly + vbInformation
    title = "Unzul|fffd|ssiger Dateityp"   ' Define title.
    ' Display message.
    response = MsgBox(msg, style, title)
End If
End Sub

Private Sub cmdSchlie|fffd|en_Click()
Unload Me
End Sub
Attribute VB_Name = "frmDiktatstatus"
Attribute VB_Base = "0{551BC762-F16F-4AE0-B333-512B5E124B7A}{E716F826-5ACC-4D75-85EE-D95CBC99A667}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private sDiktatNr$

Private Sub Form_QueryUnload(Cancel As Integer, UnloadMode As Integer)
Dim X
Dim diktatnr$

diktatnr$ = GetDocVar("Diktatnr")
X = StatusChanged(diktatnr$, cmbStatus)
End Sub

Private Sub cmbStatus_Change()
Dim X
Dim diktatnr$

diktatnr$ = GetDocVar("Diktatnr")
X = StatusChanged(diktatnr$, cmbStatus)
End Sub
Private Sub cmbVersendungsart_Change()

'cbPDF.Value = 1

End Sub


Private Sub UserForm_Initialize()

With frmDiktatstatus
    .Top = Application.Top + (Application.Height - .Height) / 2
    .Left = Application.Left + (Application.Width - .Width) / 2
End With

End Sub

Private Function StatusChanged(p_Diktatnr, p_Status)
Dim statuspostausgang_diktate$
Dim ret$
Dim barcode$
Dim kuerzel$
Dim sDokumentname$
Dim Hnr$
Dim postausgang$
Dim postausgang_bereits_vorhanden$
Dim pdf$
Dim advonet_erlaubt$
Dim advonet_bereits_vorhanden$
Dim X
Dim Postausgang_Status$
Dim postausgang_versendungsart$
Dim Anr$, betnr$
                                 
If p_Diktatnr <> "" And p_Diktatnr <> "0" Then
    ' Gruneinstellung Advovoice - Status f|fffd|r |fffd|bernahme in den Postausgang -
    X = WordExecute("select text6 FROM system where art = 'postausgang'")
    ret$ = String(255, " ")
    statuspostausgang_diktate$ = Left$(WordRequest(ret$), laenge)
    
    ' Pr|fffd|fung, ob in der Aktengeschichte bereits ein PDF um aktuellen Dokument existiert
    sDokumentname$ = ActiveDocument.Fullname
    X = WordExecute("select 1 from history where originaldatei = '" & sDokumentname$ & "'")
    ret$ = String(255, " ")
    pdf$ = Left$(WordRequest(ret$), laenge)
        
    ' Pr|fffd|fung, ob die aktuelle Akte f|fffd|r die Onlineakte freigeschaltet ist
    ' falls nein: Optionsfelder verstecken
    Anr$ = GetAnr(1)
    betnr$ = GetDocVar("Betnr")
    '   " and betakt.betnr = " + Betnr$ +
    X = WordExecute("select 1 from betakt, beteiligte  " + _
        "where nr = " + Anr$ + " and betakt.betnr = beteiligte.betnr  " + _
        "and ( advonetfreigabe = 'J' or ( advonetautofg = 'J' and betakt.kz = 1 ) )")
    
    advonet_erlaubt$ = Left(WordRequest(ret$), laenge)
    
    If advonet_erlaubt$ = "1" Then
        cbAdvonet.Visible = True
        cbEmail.Visible = True
    Else
        cbAdvonet.Visible = False
        cbEmail.Visible = False
    End If
    
    ' Pr|fffd|fung, ob aktuelles Dokument bereits in der Aktengeschichte ist und HNR ermitteln
    ' 16.11.2016 (mp): Keinen join benutzen! Dauert zu lange
    X = WordExecute("select 1 from diktate where docfile = '" & sDokumentname$ & "'")
    ret$ = String(255, " ")
    Hnr$ = Left$(WordRequest(ret$), laenge)
    If Hnr$ = "1" Then
        Hnr$ = ""
        X = WordExecute("select hnr from history where datei = '" & sDokumentname$ & "'")
        ret$ = String(255, " ")
        Hnr$ = Left$(WordRequest(ret$), laenge)
        If Hnr$ = "" Then
            X = WordExecute("select hnr from history where originaldatei = '" & sDokumentname$ & "'")
            ret$ = String(255, " ")
            Hnr$ = Left$(WordRequest(ret$), laenge)
        End If
    End If
    
    If Hnr$ <> "" And Hnr$ <> "0" Then
        ' Pr|fffd|fung, ob aktuelles Dokument bereits im Postausgang ist
        ' falls ja: H|fffd|kchen setzen und Optionsfeld deaktivieren (Herausnehmen hier nicht erlaubt, zu komplex)
        
        X = WordExecute("select 1 from postausgang where hnr = " + Hnr$)
        ret$ = String(255, " ")
        postausgang_bereits_vorhanden$ = Left$(WordRequest(ret$), laenge)
        
        If postausgang_bereits_vorhanden$ = "1" Then
            cbPostausgang.Enabled = False
            cbPostausgang.Value = 1
        End If
        
        ' Pr|fffd|fung, ob aktuelles Dokument bereits in der OA ist
        ' falls ja: H|fffd|kchen setzen und Optionsfeld deaktivieren (Herausnehmen hier nicht erlaubt, zu komplex)
        If advonet_erlaubt$ = "1" Then
            X = WordExecute("select 1 from history_access where hnr = " + Hnr$)
            ret$ = String(255, " ")
            advonet_bereits_vorhanden$ = Left$(WordRequest(ret$), laenge)
            
            If advonet_bereits_vorhanden$ = "1" Then
                cbAdvonet.Enabled = False
                cbAdvonet.Value = 1
                cbEmail.Enabled = False
            End If
        End If
        
    End If
    
    ' falls Status Grundeinstellung Advovoice -> Postausgang aktiviert ist: Pr|fffd|fung, ob dieser Status |fffd|bergeben wurde
    ' falls ja: Postausgang, OA aktivieren, sonst deaktivieren
    If statuspostausgang_diktate$ <> "" And statuspostausgang_diktate$ <> "0" Then
        If statuspostausgang_diktate$ = p_Status Then
            If pdf$ <> "1" Then
                X = WordExecute("select text1 from system where art = 'pdfdrucker'")
                ret$ = String(255, " ")
                pdf$ = Left$(WordRequest(ret$), laenge)
            End If

            If advonet_bereits_vorhanden$ <> "1" Then
                cbAdvonet.Enabled = True
                cbEmail.Enabled = True
                'cbAdvonet.Value = 1 NIEMALS !!!!
            End If
            
            If postausgang_bereits_vorhanden$ <> "1" Then
                cbPostausgang.Enabled = True
                cbPostausgang.Value = 1
            End If
            
            ' Pr|fffd|fung: voreingestellte Versendungsart und Status f|fffd|r den Postausgang
            If Postausgang_Status$ = "" Then
                X = WordExecute("select text5 from system where art = 'postausgang' and text5 <> '[keine]'")
                ret = String(255, " ")
                Postausgang_Status$ = Left$(WordRequest(ret$), laenge)
            End If
            
            postausgang_versendungsart$ = GetDocVar("postausgang_versendungsart")
            If postausgang_versendungsart$ = "" Then
                If Val(betnr$) > 0 Then
                    X = WordExecute("select versendungsart from beteiligte where betnr =  " + betnr$)
                    ret = String(255, " ")
                    postausgang_versendungsart$ = Left$(WordRequest(ret$), laenge)
                End If
                
                If postausgang_versendungsart$ = "" Then
                    X = WordExecute("select text2 from system where art = 'postausgang' and text2 <> '[keine]'")
                    ret = String(255, " ")
                    postausgang_versendungsart$ = Left$(WordRequest(ret$), laenge)
                End If
            End If
                
        Else
            cbPostausgang.Enabled = False
            
            If postausgang_bereits_vorhanden$ <> "1" Then
                cbPostausgang.Value = 0
            End If
        
            If advonet_bereits_vorhanden$ <> "1" Then
                cbAdvonet.Value = 0
                cbEmail.Value = 0
            End If
        End If
    Else
        If pdf$ <> "1" Then
            X = WordExecute("select text1 from system where art = 'pdfdrucker'")
            ret$ = String(255, " ")
            pdf$ = Left$(WordRequest(ret$), laenge)
        End If
    End If
End If

If pdf$ = "1" Then
    cbPDF.Value = 1
End If

End Function
Private Sub cmbStatus_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
If KeyAscii = 27 Then
    WordExecute ("update diktate set geoeffnet_durch = null where nr = " & sDiktatNr$)
    WordExecute ("commit")
    Unload frmDiktatstatus
End If
End Sub

Private Sub pbAbbrechen_Click()
WordExecute ("update diktate set geoeffnet_durch = null where nr = " & sDiktatNr$)
WordExecute ("commit")
Unload frmDiktatstatus
End Sub

Private Sub pbAbbrechen_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
If KeyAscii = 27 Then
    WordExecute ("update diktate set geoeffnet_durch = null where nr = " & sDiktatNr$)
    WordExecute ("commit")
    Unload frmDiktatstatus
End If

End Sub

Private Sub pbOk_Click()
Dim X As Integer
Dim benutzer$
Dim ret$
Dim kuerzel$
Dim Hnr$
Dim sDokumentname$
Dim sStatus$
Dim diktant$
Dim hadvonet$
Dim postausgang_versendungsart$, s1$
Dim sNr$

sNr = GetAnr(1)
benutzer$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "user")
X = WordExecute("select kuerzel from mitarbeiter where name = '" + benutzer$ + "'")
ret$ = String(255, " ")
kuerzel$ = Left$(WordRequest(ret$), laenge)

If cmbStatus = "erledigt" Then
    X = WordExecute("update diktate set status = '" & cmbStatus & "', geoeffnet_durch = null, gesperrt_durch = null, anz_bearbeitungen = anz_bearbeitungen + 1, erledigt_datum = sysdate where nr = " & sDiktatNr$)
ElseIf cmbStatus = "gesperrt" Then
    X = WordExecute("update diktate set status = '" & cmbStatus & "', geoeffnet_durch = null, gesperrt_durch = '" & kuerzel$ & "' where nr = " & sDiktatNr$)
Else
    X = WordExecute("update diktate set status = '" & cmbStatus & "', geoeffnet_durch = null, gesperrt_durch = null, anz_bearbeitungen = anz_bearbeitungen + 1 where nr = " & sDiktatNr$)
End If

WordExecute ("commit")
If X <> 0 Then MsgBox ("WordExecutefehler " & X)

X = WordExecute("select diktant from diktate where nr = '" + sDiktatNr$ + "'")
ret$ = String(255, " ")
diktant$ = Left$(WordRequest(ret$), laenge)

sDokumentname$ = ActiveDocument.Fullname

If sNr <> "" Then
    X = WordExecute("select hnr from history where nr = " & sNr & " and ( datei = '" & sDokumentname$ & "' or originaldatei = '" & sDokumentname$ & "' )")
    Hnr$ = Left(WordRequest(ret$), laenge)
End If

If Hnr$ <> "" Then
    If cmbStatus = "erledigt" Then
        sStatus$ = "erledigt"
    Else
        sStatus$ = "freigegeben"
    End If
    
    If cbPDF.Value = True Then
        SetDocVar "NoPDF", "ja"
        fErzeugePDF (Hnr$)
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDF") = "1"
    End If

    If cbAdvonet.Value = True And cbAdvonet.Enabled = True Then
        If cbEmail.Value Then
            hadvonet$ = "2"
        Else
            hadvonet$ = "1"
        End If
        X = InsertIntoHistoryAccess(Hnr$, hadvonet$)
    End If

    If cbPostausgang.Value = True And cbPostausgang.Enabled = True Then
        X = WordExecute("select versendungsart from postausgang where hnr = " + Hnr$)
        postausgang_versendungsart$ = Left$(WordRequest(ret$), laenge)
               
        X = InsertIntoPostausgang(Hnr$, postausgang_versendungsart$, sStatus$, diktant$, "")
                System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Hnr") = Hnr$
        fSendMessageAdvoware 39, 0
    End If
End If

X = WordExecute("insert into diktat_history ( benutzer, datum, nr, status, vorgang ) values " + _
"('" + kuerzel$ + "',sysdate,'" + sDiktatNr$ + "','" + cmbStatus + "','aus Winword')")
WordExecute ("commit")

If X <> 0 Then MsgBox ("WordExecutefehler " & X)

System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Diktatstatus") = cmbStatus
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Diktatnummer") = sDiktatNr

fSendMessageAdvoware 33, 0

Unload frmDiktatstatus

End Sub

Private Sub pbOk_KeyPress(ByVal KeyAscii As MSForms.ReturnInteger)
If KeyAscii = 27 Then
    Unload frmDiktatstatus
End If

End Sub

Public Function SetStatus(s)
Dim X As Integer
Dim i As Integer
Dim sAuto$
Dim ret$
Dim Status$
Dim stufe$
Dim ind

sDiktatNr$ = s
ret$ = String(255, " ")
X = WordExecute("select status from diktate where nr = " & sDiktatNr$)
Status$ = Left(WordRequest(ret$), laenge)


For i = 1 To 5
    X = WordExecute("select stufe" & i & " from workflow")
    stufe$ = Left(WordRequest(ret$), laenge)
    
    If Len(stufe$) > 0 Then
        cmbStatus.AddItem (stufe$)
        If stufe$ = Status$ Then
            ind = i
        End If
    End If
Next

cmbStatus.AddItem ("gesperrt")

X = WordExecute("select auto from workflow")
sAuto$ = Left(WordRequest(ret$), laenge)

If sAuto$ = "1" Then 'Automatik aus
    cmbStatus = Status$
Else
    'cmbStatus = status$
    cmbStatus.Listindex = ind
End If

WordExecute ("commit")
End Function

Private Sub UserForm_QueryClose(Cancel As Integer, CloseMode As Integer)
    WordExecute ("update diktate set geoeffnet_durch = null where nr = " & sDiktatNr$)
    WordExecute ("commit")
End Sub
Attribute VB_Name = "frmPara"
Attribute VB_Base = "0{5488B575-4CA0-4AC6-A336-49D64F946619}{F0D5FA36-9CDE-4599-82BC-EE73077F3AB2}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False




Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Private Sub CommandButton2_Click()
Unload frmPara
End Sub

Private Sub CommandButtonL|fffd|schen_Click()
Dim i As Integer
Dim Pfad$
Dim TK$
Dim Zeile$
Dim abfrage$
Dim docnr$
Dim X
Dim ret$
Dim mnr$
 
On Error Resume Next
Zeile$ = ListBox1.text

If Zeile$ > "" Then
    TK = Zeile
    docnr$ = ActiveDocument.Name
    abfrage = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    mnr$ = (Left(WordRequest(ret$), laenge))

    If mnr$ <> "" Then
        abfrage$ = "delete from paramass where mnr = " & mnr$ & " and bez = '" & TK & "'"
        X = WordExecute(abfrage$)
        Selection.GoTo What:=wdGoToBookmark, Name:=Zeile$
        ActiveDocument.Bookmarks(Zeile$).Delete
        Selection.Delete
        
        On Error GoTo 0
        ListBox1.Clear
        UserForm_Initialize
    Else
        MsgBox "Das Dokument ist keiner Ma|fffd|nahme zugeordnet.", vbExclamation, GetApplicationName()
    End If
End If

WordExecute ("commit")

End Sub

Private Sub ListBox1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
GeheZu
End Sub

Private Sub UserForm_Initialize()
Dim abfrage$
Dim Anzahl As Integer
Dim ret$
Dim i As Integer
Dim k$
Dim docnr$
Dim X
Dim mnr$

With frmPara
    .Top = Application.Top + (Application.Height - .Height) / 2
    .Left = Application.Left + (Application.Width - .Width) / 2
End With

docnr$ = ActiveDocument.Name
abfrage$ = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
X = WordExecute(abfrage$)
ret$ = String(255, " ")
mnr$ = (Left(WordRequest(ret$), laenge))

If mnr$ <> "" Then
    abfrage$ = "select count(*) from paramass where mnr = " & mnr$
    
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    k$ = Left(WordRequest(ret$), laenge)
    
    If k$ <> "" Then
        Anzahl = CInt2(k$)
        abfrage$ = "select bez from paramass where mnr=" & mnr$
        X = WordExecute(abfrage$)
        
        For i = 1 To Anzahl
        ret$ = String(255, " ")
        ret$ = (Left(WordRequest(ret$), laenge))
        ListBox1.AddItem ret$
        Next
    End If
Else
    MsgBox "Der Dateiname ist ung|fffd|ltig.", vbExclamation, GetApplicationName()
End If

WordExecute ("commit")
End Sub

Private Sub GeheZu()

If ListBox1.text <> "" Then
    Selection.GoTo What:=wdGoToBookmark, Name:=ListBox1.text
End If

End Sub

Attribute VB_Name = "frmPlatzhalter"
Attribute VB_Base = "0{E73329CD-40BB-44EB-8AB6-AB68A690D2CE}{AC9101F1-508F-46F8-B2D2-1EEAC2326AC4}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private Beteiligter As String
Private Datenfeld As String
Private name_macrobutton As String
Private rang As String
Private kz$
Private bet As String
Private anzahl_betins
Private Index
Dim tabName(100) As String
Dim refName(100) As String
Dim refTyp(100) As Integer
Dim Optionsfelder(545) As New clsPlatzhalter

Private Sub ComboBoxRechnung_Change()
OptionButton221.Value = True
End Sub
Private Sub CommandButton1_Click()
Auswahl
If CheckBoxEnde.Value = True Then
    Unload frmPlatzhalter
End If
End Sub

Private Sub CommandButton2_Click()
Unload frmPlatzhalter
End Sub


Private Sub CommandButton3_Click()
    nFormnumber = 2
    Load frmPlatzhalter2
    frmPlatzhalter2.Show
    nFormnumber = 1

End Sub



Private Sub ListBox1_KeyUp(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If KeyCode = 27 Then
    Unload frmPlatzhalter
End If
End Sub



Private Sub UserForm_Initialize()
Dim ret$
Dim ref_$
Dim X
Dim wahl$
Dim Temp$
Dim i
Dim anzahl_ref
nFormnumber = 1

With frmPlatzhalter
    .Top = Application.Top + (Application.Height - .Height) / 2
    .Left = Application.Left + (Application.Width - .Width) / 2
End With

|fffd|ndereBeschriftungKanzleispezifischePlatzhhalter
i = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "platzhalterv")
If i > 11 Then i = 0
If i <> "" Then
    MultiPage1.Value = CInt(i)
Else
    MultiPage1.Value = 1
End If

Dim Opbt As Control
Dim Pages As Object

i = 0
 
For Each Pages In MultiPage1.Pages
    For Each Opbt In Pages.Controls
        If (Left(Opbt.Name, 5) = "Optio") Then
            Set Optionsfelder(i).Optionsfeld = Opbt
            i = i + 1
        End If
    Next
Next

TextBoxRang = "1"

If Documents.count = 0 Then
    MsgBox "Es ist kein g|fffd|ltiges Dokument ge|fffd|ffnet!", vbExclamation, GetApplicationName()
    Exit Sub
End If

ret$ = String(255, " ")
X = WordExecute("SELECT count(*) FROM  betins WHERE text <> 'gesetzlicher Vertreter' AND text <> 'Rechtschutzversicherung' AND text <> 'Rechtsschutzversicherung' AND text <> 'Haftpflichtversicherung' and text<>'Ansprechpartner' and text<>'Kind'")

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

anzahl_betins = bib.Val2(Left$(WordRequest(ret$), laenge))

If anzahl_betins = -1 Then
    MsgBox "In den Grundeinstellungen wurden noch keine Beteiligte eingegeben!", vbExclamation, GetApplicationName()

Else
    ReDim bet__$(anzahl_betins + 9)
    bet__$(0) = "Mandant"
    bet__$(1) = "Gegner"
    X = WordExecute("SELECT text FROM betins WHERE text <> 'Mandant' AND text <> 'Gegner' AND text <> 'gesetzlicher Vertreter' AND text <> 'Rechtschutzversicherung' AND text <> 'Rechtsschutzversicherung' AND text <> 'Haftpflichtversicherung' and text<>'Ansprechpartner' and text<>'Kind' order by text")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret = String(255, " ")
    
    For X = 2 To anzahl_betins - 1
        bet__$(X) = Left$(WordRequest(ret$), laenge)
    Next
        
    bet__$(anzahl_betins) = "Haftpflicht Mandant"
    bet__$(anzahl_betins + 1) = "Haftpflicht Gegner"
    bet__$(anzahl_betins + 2) = "Rechtschutz Mandant"
    bet__$(anzahl_betins + 3) = "Rechtschutz Gegner"
    bet__$(anzahl_betins + 4) = "Ansprechpartner Mandant"
    bet__$(anzahl_betins + 5) = "Ansprechpartner Gegner"
    bet__$(anzahl_betins + 6) = "Kind Mandant"
    bet__$(anzahl_betins + 7) = "Kind Gegner"
    bet__$(anzahl_betins + 8) = "gesetzlicher Vertreter"
    bet__$(anzahl_betins + 9) = "untergeordneter ges. Vertreter"
    
    For X = 0 To anzahl_betins + 9
        ListBox1.AddItem bet__$(X)
    Next

End If

If ListBox1.ListCount <> 0 Then
    ListBox1.Selected(0) = True
End If

F|fffd|lleComboboxRechnungen

ret$ = String(255, " ")
X = WordExecute("select count(*) from systables where Name like 'REF\_%'")

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

anzahl_ref = bib.Val2(Left$(WordRequest(ret$), laenge))

If anzahl_ref = -1 Then
    MsgBox "In den Grundeinstellungen wurden noch keine kanzleispez. Daten 2 eingegeben!", vbExclamation, GetApplicationName()

Else
End If

Ende:
X = WordExecute("Commit")

End Sub


Public Sub Auswahl()
    Dim Obn As Object
    Dim Datei As String
    Dim i, X As Integer
    Dim AuswahlOptionbutton As Integer
    Dim ret As String
    Dim abfrage$
    Dim erg$
    Dim Datei2$
    Dim Beschriftung$
    Dim Textmarke As Bookmark
    Dim r As Range
    Dim versicherung$
    
    Selection.Font.ColorIndex = 5

    ret = String(255, " ")
    
    If (MultiPage1.SelectedItem.Caption = "Beteiligte") Then
        For Each Obn In FrameBeteiligte.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            Datenfeld$ = "Name"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 1 Then
            Datenfeld$ = "Vorname"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 2 Then
            Datenfeld$ = "Strasse"
            name_macrobutton$ = Datenfeld$
        
        ElseIf AuswahlOptionbutton = 3 Then
            Datenfeld$ = "Land"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 4 Then
            Datenfeld$ = "PLZ"
            name_macrobutton$ = Datenfeld$
        
        ElseIf AuswahlOptionbutton = 5 Then
            Datenfeld$ = "Ort"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 6 Then
            Datenfeld$ = "Anrede"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 7 Then
            Datenfeld$ = "Banrede"
            name_macrobutton$ = "Briefanrede"
    
        ElseIf AuswahlOptionbutton = 8 Then
            Datenfeld$ = "Telefon"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 9 Then
            Datenfeld$ = "Mobil"
            name_macrobutton$ = "Mobil"
'            name_macrobutton$ = "Mobiltelefon"
    
        ElseIf AuswahlOptionbutton = 10 Then
            Datenfeld$ = "Telefax"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 11 Then
            Datenfeld$ = "Bank"
            name_macrobutton$ = "Bank" 'Datenfeld$
    
        ElseIf AuswahlOptionbutton = 12 Then
        
            X = WordExecute("SELECT versicherung from betins where text = '" + ListBox1 + "'")
            ret$ = String(255, " ")
            versicherung$ = Left$(WordRequest(ret$), laenge)
        
            If versicherung$ = "1" Or Left(ListBox1, 11) = "Rechtschutz" Or Left(ListBox1, 11) = "Haftpflicht" Then
                Datenfeld$ = "Betreff3"
            Else
                Datenfeld$ = "Betreff"
            End If
            
            name_macrobutton$ = Datenfeld$
            Datei$ = "betakt"
   
        ElseIf AuswahlOptionbutton = 13 Then
            Datenfeld$ = "Betreff"
            name_macrobutton$ = "Versicherungsnummer"
            Datei$ = "betakt"
    
        ElseIf AuswahlOptionbutton = 14 Then
            Datenfeld$ = "Betreff2"
            name_macrobutton$ = "Schadennummer"
            Datei$ = "betakt"
    
        ElseIf AuswahlOptionbutton = 15 Then
            Datenfeld$ = "Gebdat"
            name_macrobutton$ = "Geburtsdatum"
    
        ElseIf AuswahlOptionbutton = 16 Then
            Datenfeld$ = "Gebname"
            name_macrobutton$ = "Geburtsname"
    
        ElseIf AuswahlOptionbutton = 17 Then
            Datenfeld$ = "Vertreter"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 18 Then
            Datenfeld$ = "Anschrift"
            name_macrobutton$ = Datenfeld$
    
'        ElseIf AuswahlOptionbutton = 19 Then
'            Datenfeld$ = "postfach"
'            name_macrobutton$ = "Postfach"
    
        ElseIf AuswahlOptionbutton = 19 Then
            Datenfeld$ = "Rechtsform"
            name_macrobutton$ = Datenfeld$
    
        ElseIf AuswahlOptionbutton = 20 Then
            Datenfeld$ = "afrei1"
            name_macrobutton$ = "Frei1"
    
        ElseIf AuswahlOptionbutton = 21 Then
            Datenfeld$ = "AFREI2"
            name_macrobutton$ = "Frei2"
        
        ElseIf AuswahlOptionbutton = 22 Then
            Datenfeld$ = "AFREI3"
            name_macrobutton$ = "Frei3"
        
        ElseIf AuswahlOptionbutton = 23 Then
            Datenfeld$ = "AFREI4"
            name_macrobutton$ = "Frei4"
        
        ElseIf AuswahlOptionbutton = 24 Then
            Datenfeld$ = "zusatz"
            name_macrobutton$ = "Zusatz"
        
        ElseIf AuswahlOptionbutton = 25 Then
            Datenfeld$ = "labruf"
            name_macrobutton$ = "letzterAbruf"
        
        ElseIf AuswahlOptionbutton = 26 Then
            Datenfeld$ = "Stammkapital"
            name_macrobutton$ = "Stammkapital"
       
        ElseIf AuswahlOptionbutton = 27 Then
            Datenfeld$ = "notizen"
            name_macrobutton$ = "Notizen"
       
        ElseIf AuswahlOptionbutton = 28 Then
            Datenfeld$ = "selbstbeteiligung"
            name_macrobutton$ = "Selbstbeteiligung"
       
        ElseIf AuswahlOptionbutton = 29 Then
            Datenfeld$ = "titel"
            name_macrobutton$ = "Titel"
       
        ElseIf AuswahlOptionbutton = 30 Then
            Datenfeld$ = "famstand"
            name_macrobutton$ = "Familienstand"
       
        ElseIf AuswahlOptionbutton = 31 Then
            Datenfeld$ = "geburtsort"
            name_macrobutton$ = "Geburtsort"
       
        ElseIf AuswahlOptionbutton = 32 Then
            Datenfeld$ = "anzahlkinder"
            name_macrobutton$ = "AnzahlKinder"
       
        ElseIf AuswahlOptionbutton = 33 Then 'neu
            Datenfeld$ = "Email3"
            name_macrobutton$ = "Email3adresse"
       
        ElseIf AuswahlOptionbutton = 34 Then 'neu
            Datenfeld$ = "rufp"
            name_macrobutton$ = "TelefonPrivat"
       
        ElseIf AuswahlOptionbutton = 35 Then 'neu
            Datenfeld$ = "faxp"
            name_macrobutton$ = "FaxPrivat"
       
        ElseIf AuswahlOptionbutton = 36 Then 'False
            Datenfeld$ = "BIC"
            name_macrobutton$ = "BIC"
       
        ElseIf AuswahlOptionbutton = 37 Then 'False
            Datenfeld$ = "Gegenstand"
            name_macrobutton$ = "Gegenstand"
    
        ElseIf AuswahlOptionbutton = 38 Then 'neu
            Datenfeld$ = "EmailPrivat"
            name_macrobutton$ = "EmailPrivat"
       
        ElseIf AuswahlOptionbutton = 68 Then 'False
            Datenfeld$ = "Vertretungsregelung"
            name_macrobutton$ = "Vertretungsregelung"
       
        ElseIf AuswahlOptionbutton = 39 Then 'False
            Datenfeld$ = "weitereAdresse"
            name_macrobutton$ = "weitereAdresse"
       
        ElseIf AuswahlOptionbutton = 40 Then 'neu
            Datenfeld$ = "auto"
            name_macrobutton$ = "Autotelefon"
       
        ElseIf AuswahlOptionbutton = 41 Then 'neu
            Datenfeld$ = "web"
            name_macrobutton$ = "Webseite"
       
        ElseIf AuswahlOptionbutton = 42 Then 'neu
            Datenfeld$ = "sonstige"
            name_macrobutton$ = "SonstigeNummer"
       
        ElseIf AuswahlOptionbutton = 43 Then 'neu
            Datenfeld$ = "gnr"
            name_macrobutton$ = "Gerichtnummer(DTA)"
            Datei$ = "betakt"
        
        ElseIf AuswahlOptionbutton = 44 Then 'neu
            Datenfeld$ = "herkunftsland"
            name_macrobutton$ = "Herkunftsland"
    
        ElseIf AuswahlOptionbutton = 45 Then 'neu
            Datenfeld$ = "beruf"
            name_macrobutton$ = "Beruf"
       
        ElseIf AuswahlOptionbutton = 46 Then 'neu
            Datenfeld$ = "hrn"
            name_macrobutton$ = "Handelsregister"
       
        ElseIf AuswahlOptionbutton = 47 Then 'neu
            Datenfeld$ = "Registerart"
            name_macrobutton$ = "Registerart"
       
        ElseIf AuswahlOptionbutton = 48 Then 'neu
            Datenfeld$ = "Position"
            name_macrobutton$ = "Position"
                
        ElseIf AuswahlOptionbutton = 49 Then 'neu
            Datenfeld$ = "bank"
            name_macrobutton$ = "Kreditinstitut"
           
        ElseIf AuswahlOptionbutton = 50 Then 'neu
            Datenfeld$ = "ustid"
            name_macrobutton$ = "USt.-Idnr. Mandant"
       
        ElseIf AuswahlOptionbutton = 51 Then 'neu
            Datenfeld$ = "betnr"
            name_macrobutton$ = "Betnr"
'            name_macrobutton$ = "Adressnummer"
            
        ElseIf AuswahlOptionbutton = 52 Then 'neu
            Datenfeld$ = "stid"
            name_macrobutton$ = "IdNr."
            
        ElseIf AuswahlOptionbutton = 53 Then 'neu
            Datenfeld$ = "wid"
            name_macrobutton$ = "W.-IdNr."
                 
        ElseIf AuswahlOptionbutton = 54 Then 'neu
            Datenfeld$ = "dta"
            name_macrobutton$ = "DTA-Einreicher-Kz."
       
        ElseIf AuswahlOptionbutton = 55 Then 'neu
            Datenfeld$ = "anwvs_typ"
            name_macrobutton$ = "Typ AnwVS"
       
        ElseIf AuswahlOptionbutton = 56 Then 'neu
            Datenfeld$ = "todesdat"
            name_macrobutton$ = "verstorben am"
            
        ElseIf AuswahlOptionbutton = 57 Then 'neu
            Datenfeld$ = "standesamt"
            name_macrobutton$ = "Standesamt"
       
            
        ElseIf AuswahlOptionbutton = 58 Then 'neu
            Datenfeld$ = "staatsangehoerigkeit"
            name_macrobutton$ = "Staatsangeh|fffd|rigkeit"
       
            
        ElseIf AuswahlOptionbutton = 59 Then 'neu
            Datenfeld$ = "sterbeort"
            name_macrobutton$ = "Sterbeort"
       
            
        ElseIf AuswahlOptionbutton = 60 Then 'neu
            Datenfeld$ = "registernummer"
            name_macrobutton$ = "Register-Nr."
       
            
        ElseIf AuswahlOptionbutton = 61 Then 'neu
            Datenfeld$ = "religion"
            name_macrobutton$ = "Konfession"
            
        ElseIf AuswahlOptionbutton = 62 Then 'neu
            Datenfeld$ = "Email"
            name_macrobutton$ = "Emailadresse"
            
        ElseIf AuswahlOptionbutton = 63 Then 'neu
            Datenfeld$ = "Email2"
            name_macrobutton$ = "Email2adresse"
            
        ElseIf AuswahlOptionbutton = 64 Then 'neu
            Datenfeld$ = "gebrn"
            name_macrobutton$ = "Geb.-Registernr."
       
        ElseIf AuswahlOptionbutton = 65 Then 'False
            Datenfeld$ = "IBAN"
            name_macrobutton$ = "IBAN"
    
        ElseIf AuswahlOptionbutton = 66 Then 'False
            Datenfeld$ = "BIC"
            name_macrobutton$ = "BIC"
    
        ElseIf AuswahlOptionbutton = 67 Then 'False
            Datenfeld$ = "EMAILGESCHAEFTLICHALLE"
            name_macrobutton$ = "Email gesch|fffd|flich alle"
    
        ElseIf AuswahlOptionbutton = 69 Then 'False
            Datenfeld$ = "VertreterNotariat"
            name_macrobutton$ = Datenfeld$
            
        ElseIf AuswahlOptionbutton = 70 Then
            Datenfeld$ = "TitelVornameName"
            name_macrobutton$ = "TitelVornameName"
            
        ElseIf AuswahlOptionbutton = 71 Then
            Datenfeld$ = "TitelName"
            name_macrobutton$ = "TitelName"
                  
        ElseIf AuswahlOptionbutton = 72 Then
            Datenfeld$ = "SITZ"
            name_macrobutton$ = "Sitz"
             
        ElseIf AuswahlOptionbutton = 73 Then
            Datenfeld$ = "ALTER"
            name_macrobutton$ = "Alter"
             
        ElseIf AuswahlOptionbutton = 74 Then
            Datenfeld$ = "EINKOMMEN"
            name_macrobutton$ = "Einkommen"
            
        ElseIf AuswahlOptionbutton = 75 Then
            Datenfeld$ = "Kontoinhaber"
            name_macrobutton$ = "Kontoinhaber"
             
        ElseIf AuswahlOptionbutton = 76 Then
            Datenfeld$ = "blz"
            name_macrobutton$ = "BLZ"
             
        ElseIf AuswahlOptionbutton = 77 Then
            Datenfeld$ = "ktonr"
            name_macrobutton$ = "Konto-Nr."
             
        End If
        
        Beteiligter$ = ListBox1.text
        rang = TextBoxRang

        ReDim kz__$(anzahl_betins + 10)
        ReDim bet__$(anzahl_betins + 9)

        Index = ListBox1.Listindex
        If Index < 0 Then Index = 0
        
        Beteiligter$ = bet__$(Index)

        X = WordExecute("SELECT kz from betins WHERE text <> 'Mandant' AND text <> 'Gegner' AND text <> 'gesetzlicher Vertreter' AND text <> 'Rechtschutzversicherung' AND text <> 'Rechtsschutzversicherung' AND text <> 'Haftpflichtversicherung' and text<>'Ansprechpartner' and text<>'Kind' and text<>'untergeordnete Vertreter' order by text")

        If X <> 0 Then
            MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
            GoTo Ende
        End If
        kz__$(0) = "1"
        kz__$(1) = "2"
        For i = 2 To Index + 1
            kz__$(i) = Left$(WordRequest(ret$), laenge)
        Next i

        kz__$(anzahl_betins) = "7"
        kz__$(anzahl_betins + 1) = "7"
        kz__$(anzahl_betins + 2) = "6"
        kz__$(anzahl_betins + 3) = "6"
        kz__$(anzahl_betins + 4) = "11"
        kz__$(anzahl_betins + 5) = "11"
        kz__$(anzahl_betins + 6) = "14"
        kz__$(anzahl_betins + 7) = "14"
        kz__$(anzahl_betins + 8) = "0"
        kz__$(anzahl_betins + 9) = "0"

        kz$ = kz__$(Index)

        If bet$ <> "d" Then
            ReDim bet__$(anzahl_betins + 9)
            
            X = WordExecute("SELECT ug from betins WHERE text <> 'Mandant' AND text <> 'Gegner' AND text <> 'gesetzlicher Vertreter' AND text <> 'Rechtschutzversicherung' AND text <> 'Rechtsschutzversicherung' AND text <> 'Haftpflichtversicherung'  and text<>'Ansprechpartner' and text<>'Kind' order by text")
            
            If X <> 0 Then
                MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
                GoTo Ende
            End If
            bet__$(0) = "0"
            bet__$(1) = "0"
            For i = 2 To Index
                bet__$(i) = Left$(WordRequest(ret$), laenge)
            Next i
            
            bet__$(anzahl_betins) = "M"
            bet__$(anzahl_betins + 1) = "G"
            bet__$(anzahl_betins + 2) = "M"
            bet__$(anzahl_betins + 3) = "G"
            bet__$(anzahl_betins + 4) = "M"
            bet__$(anzahl_betins + 5) = "G"
            bet__$(anzahl_betins + 6) = "M"
            bet__$(anzahl_betins + 7) = "G"
            bet__$(anzahl_betins + 8) = "GV"
            bet__$(anzahl_betins + 9) = "UV"
    
            bet$ = bet__$(Index)
        End If
            
        If Datei = "" Then
            Datei$ = "beteiligte"
        End If
    
        Beteiligter$ = ListBox1.text
        If name_macrobutton$ = "USt.-Idnr. Mandant" Then
            Beteiligter$ = ""
        End If
        ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|" + Datei$ + "|fffd|" + Datenfeld$ + "|fffd|" + kz$ + "|fffd|" + rang$ + "|fffd|" + bet$ + "|fffd|" + " |fffd|" + name_macrobutton$ + Beteiligter$ + "|fffd|", PreserveFormatting:=False
    
    ElseIf (MultiPage1.SelectedItem.Caption = "Akte allgemein") Then 'Akte allgemein
        
        For Each Obn In FrameAkteAllgemein.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next

        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|az|fffd||fffd| |fffd|Az|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|rubrum|fffd||fffd| |fffd|Rubrum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sb1|fffd||fffd| |fffd|Sachbearbeiter|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sb|fffd||fffd| |fffd|Sachbearbeiterk|fffd|rzel|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|titel|fffd||fffd| |fffd|Sachbearbeitertitel|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mbez|fffd| |fffd|MDTBez|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gbez|fffd| |fffd|GEGBez|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|grubrum|fffd||fffd| |fffd|Ger_Rubrum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|ablort|fffd||fffd| |fffd|Ablageort|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|anspruch|fffd||fffd| |fffd|Anspruch/Titel|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|afrei1|fffd||fffd| |fffd|Frei1|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|afrei2|fffd||fffd| |fffd|Frei2|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|afrei3|fffd||fffd| |fffd|Frei3|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|afrei4|fffd||fffd| |fffd|Frei4|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|wegen|fffd||fffd| |fffd|wegen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|referat|fffd||fffd| |fffd|Referat|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notizenrtf|fffd| |fffd|Notizen (Datei)|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|notizen|fffd||fffd| |fffd|Notizen(Feld)|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|urnr|fffd||fffd| |fffd|UrkundenInDieserAkte|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|wert|fffd|n|fffd| |fffd|Gegenstandswert|fffd|", PreserveFormatting:=False
             
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|durchwahl|fffd||fffd| |fffd|DurchwahlSB|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|sekretariat|fffd||fffd| |fffd|Sekretariat|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|angelegtvon|fffd||fffd| |fffd|AngelegtVon|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|vstab|fffd||fffd||fffd|a|fffd| |fffd|Vorsteuerabzug|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|email2|fffd||fffd| |fffd|EmailSB|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|angelegt|fffd|d|fffd| |fffd|AngelegtAm|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|referate|fffd|ganrede|fffd||fffd| |fffd|BriefanredeGericht|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|ablgrund|fffd||fffd| |fffd|Ablagegrund|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|abgelegt|fffd|d|fffd| |fffd|AbgelegtAm|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|ablnr|fffd||fffd| |fffd|Ablagenummer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|barcode|fffd||fffd||fffd| |fffd|Barcode|fffd|", PreserveFormatting:=False
                    
        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|unterschrift|fffd||fffd| |fffd|UnterschriftSB|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|rate|fffd|n|fffd| |fffd|H|fffd|heRate|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|ratendatum|fffd|d|fffd| |fffd|RateF|fffd|lligAm|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|referate|fffd|referat|fffd||fffd| |fffd|ReferatLangform|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 35 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|pfade|fffd|unterschriftsdatei|fffd||fffd| |fffd|UnterschriftenDateiTextInZeile|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 36 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|durchwahlfax|fffd||fffd| |fffd|DurchwahlFaxSB|fffd|", PreserveFormatting:=False
               
        ElseIf AuswahlOptionbutton = 37 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gerichtlichesrubrum|fffd| |fffd|GerichtlRubrum|fffd|", PreserveFormatting:=True
        
        ElseIf AuswahlOptionbutton = 38 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gerichtlichesrubrumkurz|fffd| |fffd|GerichtlRubrumOhneAnschrift|fffd|", PreserveFormatting:=False
               
        ElseIf AuswahlOptionbutton = 39 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|email3|fffd||fffd| |fffd|Email2SB|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 40 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|email4|fffd||fffd| |fffd|Email3SB|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 41 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|Kommunikation|fffd|d|fffd| |fffd|Kommunikation|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 42 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|VV|fffd|d|fffd| |fffd|Verg|fffd|tungsvereinbarung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 43 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|KommunikationTel|fffd|d|fffd| |fffd|KommunikationTel|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 44 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|abgelegtvon|fffd| |fffd|AbgelegtVon|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 45 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|titelname|fffd||fffd| |fffd|Mitarbeiter|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 46 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|standort|fffd||fffd| |fffd|StandortAkte|fffd|", PreserveFormatting:=False
          
        ElseIf AuswahlOptionbutton = 47 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|standort|fffd||fffd| |fffd|StandortSb|fffd|", PreserveFormatting:=False
           
        ElseIf AuswahlOptionbutton = 48 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|standortuser|fffd||fffd| |fffd|StandortMitarbeiter|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 49 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|stundensatz|fffd||fffd| |fffd|Stundensatz|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 50 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|pfade|fffd|unterschriftsdateihinterdentext|fffd||fffd| |fffd|UnterschriftenDateiHinterText|fffd|", PreserveFormatting:=False
          
        ElseIf AuswahlOptionbutton = 52 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sverguetung|fffd|n|fffd| |fffd|Saldo Verg|fffd|tung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 53 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|ssollstellung|fffd|n|fffd| |fffd|Saldo Sollstellung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 51 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sdurchposten|fffd|n|fffd| |fffd|Saldo durchlaufende Posten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 54 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|smerkposten|fffd|n|fffd| |fffd|Saldo Merkposten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 55 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sfremdgeld|fffd|n|fffd| |fffd|Saldo Fremdgeld|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 56 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|FRISTENABGELEGTENAKTEN|fffd||fffd| |fffd|nicht erledigte Aktionen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 57 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|mitarbeitersignatur1|fffd||fffd| |fffd|Mitarbeiter Signatur1|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 58 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|mitarbeitersignatur2|fffd||fffd| |fffd|Mitarbeiter Signatur2|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 59 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|pfade|fffd|unterschriftsdateibenutzer|fffd||fffd| |fffd|UnterschriftenDateiBenutzerTextInZeile|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 60 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|pfade|fffd|unterschriftsdateibenutzerhinterdentext|fffd||fffd| |fffd|UnterschriftenDateiBenutzerHinterText|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 61 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|aktenkonto|fffd||fffd| |fffd|Saldo Aktenkonto|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 62 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sbsignatur1|fffd||fffd| |fffd|SB Signatur1|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 63 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|sbsignatur2|fffd||fffd| |fffd|SB Signatur2|fffd|", PreserveFormatting:=False
          
        ElseIf AuswahlOptionbutton = 64 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|vollerNameNotar|fffd||fffd| |fffd|voller Name Notar|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 65 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|bezirk|fffd||fffd| |fffd|Amtsgerichtsbezirk|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 66 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|sitz|fffd||fffd| |fffd|Amtssitz|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 67 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|landgericht|fffd||fffd| |fffd|zust|fffd|nd. Landgericht|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 68 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|NotarTitel|fffd||fffd| |fffd|Notar Titel|fffd|", PreserveFormatting:=False
           
        ElseIf AuswahlOptionbutton = 69 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|Mitarbeitertitel|fffd||fffd| |fffd|Mitarbeiter Titel|fffd|", PreserveFormatting:=False
      
        End If
     
    ElseIf (MultiPage1.SelectedItem.Caption = "Anschreiben") Then 'Akte allgemein
        
        For Each Obn In FrameAnschreiben.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        If AuswahlOptionbutton = 12 Then
            Selection.Font.ColorIndex = wdAuto
            TextmarkeL|fffd|schen ("anschrift")
            Set r = Selection.Range
            r.text = "|fffd|Anschrift|fffd|"
            r.Bookmarks.Add ("anschrift")
            
        ElseIf AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|email|fffd||fffd||fffd|a|fffd| |fffd|Email|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|anrede|fffd||fffd||fffd|a|fffd| |fffd|Anrede|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|titel|fffd||fffd||fffd|a|fffd| |fffd|Titel|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then 'Platzhalter allgemein
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|Zusatz|fffd||fffd||fffd|a|fffd| |fffd|Zusatz|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|vorname|fffd||fffd||fffd|a|fffd| |fffd|Vorname|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|name|fffd||fffd||fffd|a|fffd| |fffd|Name|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|strasse|fffd||fffd||fffd|a|fffd| |fffd|Strasse|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|plz|fffd||fffd||fffd|a|fffd| |fffd|PLZ|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|ort|fffd||fffd||fffd|a|fffd| |fffd|Ort|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            Selection.Font.ColorIndex = wdAuto
            Selection.TypeText "|fffd|Telefax|fffd|"
        ElseIf AuswahlOptionbutton = 34 Then
            Selection.Font.ColorIndex = wdAuto
            Selection.TypeText "|fffd|Telefon|fffd|"
        ElseIf AuswahlOptionbutton = 35 Then
            Selection.Font.ColorIndex = wdAuto
            Selection.TypeText "|fffd|TelefonPrivat|fffd|"
        ElseIf AuswahlOptionbutton = 10 Then
            Selection.Font.ColorIndex = wdAuto
            TextmarkeL|fffd|schen ("banrede")
            Set r = Selection.Range
            r.text = "|fffd|Briefanrede|fffd|"
            r.Bookmarks.Add ("banrede")
       
        ElseIf AuswahlOptionbutton = 11 Then
            Selection.Font.ColorIndex = wdAuto
            Selection.TypeText ("|fffd|TelefaxPrivat|fffd|")
    
        ElseIf AuswahlOptionbutton = 13 Then
            Selection.Font.ColorIndex = wdAuto
            Selection.TypeText ("|fffd|Betreff|fffd|")
               
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|name|fffd||fffd| |fffd|Benutzername|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzeremail|fffd| |fffd|EmailBenutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzeremail2|fffd| |fffd|Email2Benutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzeremail3|fffd| |fffd|Email3Benutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzername|fffd| |fffd|Benutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzertelefon|fffd| |fffd|DurchwahlBenutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzerunterschrift|fffd| |fffd|UnterschriftBenutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|benutzertelefax|fffd| |fffd|DurchwahlFaxBenutzer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|system|fffd|mwst|fffd||fffd| |fffd|MwSt|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd||fffd| |fffd|Gericht|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notarbez|fffd| |fffd|BezeichnungNotarIn|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|AnlagenAuflistenKenntnisnahmezettel|fffd| |fffd|AnlagenAuflistenKenntnisnahmezettel|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|advonetuser|fffd|1|fffd|1|fffd|V|fffd| |fffd|onlineAkteBenutzername|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|OAACTIVATIONCODE|fffd|1|fffd|1|fffd|V|fffd| |fffd|onlineAkteAktivierungscode|fffd|", PreserveFormatting:=False
         
         ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|emailprivat|fffd||fffd||fffd|a|fffd| |fffd|EMAILPRIVAT|fffd|", PreserveFormatting:=False
        
         ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|landeskuerzel|fffd||fffd||fffd|a|fffd| |fffd|Landeskuerzel|fffd|", PreserveFormatting:=False
       
         ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|titelvornamename|fffd||fffd||fffd|a|fffd| |fffd|TitelVornameName|fffd|", PreserveFormatting:=False
       
         ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|titelname|fffd||fffd||fffd|a|fffd| |fffd|TitelName|fffd|", PreserveFormatting:=False
         
         ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|gebdat|fffd||fffd||fffd|a|fffd| |fffd|Geburtsdatum|fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|txj|fffd| |fffd|aktuelles Jahr|fffd|", PreserveFormatting:=False
       
        End If
    ElseIf (MultiPage1.SelectedItem.Caption = "Kanzleidaten") Then
        For Each Obn In FrameKanzleidaten.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next

        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|name|fffd||fffd| |fffd|NameKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|strasse|fffd||fffd| |fffd|Stra|fffd|eKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|plz|fffd||fffd| |fffd|PLZKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|ort|fffd||fffd| |fffd|OrtKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|telefon|fffd||fffd| |fffd|TelefonKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|telefax|fffd||fffd| |fffd|TelefaxKanzlei|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|Bank|fffd||fffd| |fffd|Bankverbindung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|standorte|fffd|anrede|fffd||fffd| |fffd|AnredeKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|system|fffd|USTNR|fffd||fffd| |fffd|Umsatzsteuernr|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|system|fffd|FINANZAMT|fffd||fffd| |fffd|Finanzamt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
         
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|Bankname|fffd||fffd| |fffd|Bank|fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 11 Then
        
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|blz|fffd||fffd| |fffd|BLZ|fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 12 Then
        
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|ktonr|fffd||fffd| |fffd|KontoNr|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kanzlei|fffd| |fffd|AnschriftKanzlei|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|system|fffd|UIDNR|fffd||fffd| |fffd|UStIDNr|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|bic|fffd||fffd| |fffd|BIC|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|iban|fffd||fffd| |fffd|IBAN|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|konten|fffd|glaeubigerid|fffd||fffd| |fffd|Gl|fffd|ubiger-ID|fffd|", PreserveFormatting:=False
        
         ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|ortssignatur1|fffd||fffd| |fffd|Ortssignatur1|fffd|", PreserveFormatting:=False
       
         ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|ortssignatur2|fffd||fffd| |fffd|Ortssignatur2|fffd|", PreserveFormatting:=False
        
         ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mitarbeiter|fffd|email|fffd||fffd| |fffd|EMail|fffd|", PreserveFormatting:=False
       
       End If

    ElseIf (MultiPage1.SelectedItem.Caption = "Arbeitsrecht") Then
        For Each Obn In FrameArbeitsrecht.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next

        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|beruf|fffd||fffd| |fffd|T|fffd|tigkeitsbez.|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|berufab|fffd|d|fffd| |fffd|besch|fffd|ftigt_seit|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|kinder|fffd||fffd| |fffd|AnzahlKinder|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|altervon|fffd||fffd| |fffd|ImAlterVon|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|alterbis|fffd||fffd| |fffd|ImAlterBis|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|gehalt|fffd|n|fffd| |fffd|Gehalt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|kvom|fffd|d|fffd| |fffd|DatumK|fffd|ndigung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|kbis|fffd|d|fffd| |fffd|FristK|fffd|ndigung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|kzug|fffd|d|fffd| |fffd|DatumZustellung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|arbeitgeber|fffd||fffd| |fffd|Arbeitgeber|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|agplz|fffd||fffd| |fffd|PLZArbeitgeber|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|agort|fffd||fffd| |fffd|OrtArbeitgeber|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|arbrecht|fffd|anzahlan|fffd||fffd| |fffd|AnzahlArbeitnehmer|fffd|", PreserveFormatting:=False
        
        End If

    ElseIf (MultiPage1.SelectedItem.Caption = "Familienrecht") Then
        For Each Obn In FrameFamilienrecht.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|edat|fffd|d|fffd| |fffd|EheDatum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|eort|fffd||fffd| |fffd|EheOrt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|enr|fffd||fffd| |fffd|HeiratRegNr|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|schger|fffd||fffd| |fffd|Scheidungsgericht|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|schaz|fffd||fffd| |fffd|AzScheidungsurteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|urtdat|fffd|d|fffd| |fffd|Urteilsdatum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|schdat|fffd|d|fffd| |fffd|Scheidungsdatum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|anschrift|fffd||fffd| |fffd|AnschriftEhewohnung", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|mietdat|fffd|d|fffd| |fffd|DatumMietvertrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|miete|fffd|n|fffd| |fffd|Mietbetrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|untger|fffd||fffd| |fffd|Unterhaltsgericht|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|untaz|fffd||fffd| |fffd|AzUnterhaltsurteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|urtdat2|fffd|d|fffd| |fffd|DatumUnterhaltsurteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|unterhalt|fffd|n|fffd| |fffd|Unterhaltsbetrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|unterhalt2|fffd|n|fffd| |fffd|r|fffd|ckst_Unterhalt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|untdat2|fffd|d|fffd| |fffd|f|fffd|llig_ab|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|untdat3|fffd|d|fffd| |fffd|f|fffd|llig_bis|fffd|", PreserveFormatting:=False
           
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|gehalt|fffd|n|fffd| |fffd|EinkommenGegner|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|untdat|fffd|d|fffd| |fffd|GezahltSeit|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|stivers|fffd|d|fffd| |fffd|StichtagVersorgungsausgleich|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|anzahl|fffd||fffd| |fffd|Anzahl|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|trdat|fffd|d|fffd| |fffd|Trennungsdatum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|gehaltmandant|fffd|n|fffd| |fffd|EinkommenMandant|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|famrecht|fffd|zusdat|fffd|d|fffd| |fffd|ZustelldatumScheidungsantrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kinder|fffd| |fffd|KinderMandant|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kindergegner|fffd| |fffd|KinderGegner|fffd|", PreserveFormatting:=False
        
        End If

    ElseIf (MultiPage1.SelectedItem.Caption = "Verkehrsunfallrecht") Then
        For Each Obn In FrameVerkehrsunfallrecht.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next

        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|akzmdt|fffd||fffd| |fffd|Amtl_Kz_MDT|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|typmdt|fffd||fffd| |fffd|Typ_MDT|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|akzgeg|fffd||fffd| |fffd|Amtl_Kz_GEG|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|typgeg|fffd||fffd| |fffd|Typ_GEG|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|udat|fffd|d|fffd| |fffd|Unfall_Datum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|uzeit|fffd|z|fffd| |fffd|Unfall_Zeit|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|uort|fffd||fffd| |fffd|Unfall_Ort|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|tksb|fffd|n|fffd| |fffd|Teilkasko_SB|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|vksb|fffd|n|fffd| |fffd|Vollkasko_SB|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Schadensaufstellung|fffd| |fffd|Schadensaufstellung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Reparaturkosten|fffd| |fffd|Reparaturkosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Wertminderung|fffd| |fffd|Wertminderung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Wiederbeschaffungswert|fffd| |fffd|wiederbeschaffungswert|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Restwert|fffd| |fffd|Restwert|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Unfallhergang|fffd| |fffd|Unfallhergang|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|haltermdt|fffd||fffd| |fffd|FahrzeughalterMandant|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|haltergeg|fffd||fffd| |fffd|FahrzeughalterGegner|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|fahrermdt|fffd||fffd| |fffd|FahrerMandant|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|fahrergeg|fffd||fffd| |fffd|FahrerGegner|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|zulassungmdt|fffd||fffd| |fffd|ZulassungDesPKWMandant|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|zulassunggeg|fffd||fffd| |fffd|ZulassungDesPKWGegner|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|versicherungmdt|fffd||fffd| |fffd|HaftpflichtversicherungMandant|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|versicherunggeg|fffd||fffd| |fffd|HaftpflichtversicherungGegner|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|erstzulassungmdt|fffd|d|fffd| |fffd|Erstzulassung|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|kmstandmdt|fffd||fffd| |fffd|KM-Stand|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|gestellnrmdt|fffd|d|fffd| |fffd|Fahrgestellnummer|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|ustrasse|fffd||fffd| |fffd|Unfallstra|fffd|e|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|werkstattmdt|fffd||fffd| |fffd|WerkstattMandant|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|werkstattgeg|fffd||fffd| |fffd|WerkstattGegner|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|zeugen|fffd||fffd| |fffd|Zeugen|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|sachverstaendigen|fffd||fffd| |fffd|Sachverst|fffd|ndigenb|fffd|ro|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|polizei|fffd||fffd| |fffd|Polizeiaufnahme|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|fartmdt|fffd||fffd| |fffd|FahzeugartMandant|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|fartgeg|fffd||fffd| |fffd|FahzeugartGegner|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|unfall|fffd|anzvorbesitzer|fffd||fffd| |fffd|AnzahlVorbesitzer|fffd|", PreserveFormatting:=False
        
        Else
            MsgBox "Halt"
        End If
        
    ElseIf (MultiPage1.SelectedItem.Caption = "Verw.- und Sozialrecht") Then
        For Each Obn In FrameVerwaltungSozial.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|datumab|fffd|d|fffd| |fffd|DatumAusgangsbesch|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|azab|fffd||fffd| |fffd|AzAugansbesch|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|datumwiderspruch|fffd|d|fffd| |fffd|DatumWiderspruch|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|azwiderspruch|fffd||fffd| |fffd|AzWiderspruch|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|widerspruchb|fffd||fffd| |fffd|Widerspruchbeh|fffd|rde|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|azbehoerde|fffd||fffd| |fffd|AzWiderspruchbeh|fffd|rde|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|sozialr|fffd|datumbescheid|fffd|d|fffd| |fffd|DatumWiderspuchbescheid|fffd|", PreserveFormatting:=False
        End If

    ElseIf (MultiPage1.SelectedItem.Caption = "kanzleispezif. Daten") Then
        For Each Obn In Kanzleidaten.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        i = AuswahlOptionbutton + 1
        If i <= 20 Then
            abfrage = "select z" & CStr(i) & " from taktbez"
        ElseIf i > 20 And i <= 40 Then
            abfrage = "select z" & CStr(i - 20) & " from takt2bez"
        ElseIf i > 40 And i <= 60 Then
            abfrage = "select z" & CStr(i - 40) & " from takt3bez"
        ElseIf i > 60 And i <= 80 Then
            abfrage = "select z" & CStr(i - 60) & " from takt4bez"
        End If
        X = WordExecute(abfrage)
        ret$ = ""
        If X = 0 Then
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
        End If
        If ret$ <> "" Then
            Beschriftung$ = "|fffd|" & ret$ & "|fffd|"
        Else
            Beschriftung$ = "|fffd|" & "Zeile" & i & "|fffd|"
        End If
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|1|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|2|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|3|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|4|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|5|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|6|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|7|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|8|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|9|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|10|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|11|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|12|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|13|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|14|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|15|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|16|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|17|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|18|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|19|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt|fffd|20|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|1|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|2|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|3|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|4|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|5|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|6|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|7|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|8|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|9|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|10|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|11|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|12|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|13|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|14|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|15|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 35 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|16|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 36 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|17|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 37 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|18|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 38 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|19|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 39 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt2|fffd|20|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 40 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|1|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 41 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|2|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 42 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|3|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 43 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|4|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 44 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|5|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 45 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|6|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 46 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|7|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 47 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|8|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 48 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|9|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 49 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|10|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 50 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|11|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 51 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|12|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 52 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|13|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 53 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|14|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 54 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|15|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 55 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|16|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 56 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|17|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 57 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|18|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 58 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|19|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 59 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt3|fffd|20|fffd|" & Beschriftung$, PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 60 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|1|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 61 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|2|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 62 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|3|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 63 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|4|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 64 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|5|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 65 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|6|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 66 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|7|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 67 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|8|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 68 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|9|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 69 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|10|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 70 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|11|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 71 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|12|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 72 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|13|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 73 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|14|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 74 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|15|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 75 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|16|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 76 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|17|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 77 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|18|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 78 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|19|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 79 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|takt4|fffd|20|fffd|" & Beschriftung$, PreserveFormatting:=False
        
        End If
    
    ElseIf (MultiPage1.SelectedItem.Caption = "Rechnungen") Then  'Kostenrechnungen
        For Each Obn In FrameRechnungen.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kr|fffd| |fffd|Kostenrechnung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|summekostenrechnungen|fffd| |fffd|SummeKostenrechnungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ret = ComboBoxRechnung.text
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krkanzleispezifisch|fffd| |fffd|Kostenrechnung " + ret + "|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|rnr|fffd| |fffd|Rechnungsnummer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|datum|fffd|d|fffd|  |fffd|Rechnungsdatum|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|betrag|fffd|n|fffd|  |fffd|Rechnungsbetrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|netto|fffd|n|fffd|  |fffd|RechnungsbetragNetto|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|ust|fffd|n|fffd|  |fffd|RechnungsbetragUmsatzsteuer|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|nextstep|fffd|d|fffd|  |fffd|RechnungZahlungsfrist|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|faellig|fffd|d|fffd|  |fffd|RechnungF|fffd|lligAm|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|zahlungshinweis|fffd| |fffd|insgesamt noch zu zahlen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|leistungs|fffd|bersichtadvotime|fffd| |fffd|Leistungs|fffd|bersichtAdvotime|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|rnr|fffd|n|fffd| |fffd|SummeStundenAbgerechnet|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|zeithon|fffd|abrechnen|fffd|n|fffd| |fffd|SummeStundenNieAbrechnen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|zeithon|fffd|summe|fffd|n|fffd| |fffd|SummeStundenAbgerechnetNieAbrechnen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|leistungszeitraum|fffd||fffd| |fffd|Leistungszeitraum|fffd|", PreserveFormatting:=False
          
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|auslagen|fffd|n|fffd| |fffd|SteuerfreieAuslagen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|steuerpflichtigeauslagen|fffd|n|fffd| |fffd|SteuerpflichtigeAuslagenNetto|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|nettoohneauslagen|fffd|n|fffd| |fffd|Geb|fffd|hrenOhneSteuerpflAuslagenNetto|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kr|fffd| |fffd|KostenrechnungSmall|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|summerechnungennetto|fffd|n|fffd| |fffd|SummeRechnungenNetto|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|summerechnungenust|fffd|n|fffd| |fffd|SummeRechnungenUst", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|krsum|fffd|summerechnungenbrutto|fffd|n|fffd| |fffd|SummeRechnungenBrutto|fffd|", PreserveFormatting:=False
        
        End If
        
    ElseIf (MultiPage1.SelectedItem.Caption = "Mietrecht") Then 'Mietrecht
        For Each Obn In FrameMietrecht.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|anschrift|fffd||fffd| |fffd|AnschriftDerWohnung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|mietdat|fffd|d|fffd| |fffd|DatumMietvertrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|miete|fffd|n|fffd| |fffd|monatlicheMiete|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|jahresmiete|fffd|n|fffd| |fffd|Jahresmiete|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|nettomiete|fffd|n|fffd| |fffd|Nettomiete|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|nebenkosten|fffd|n|fffd| |fffd|Nebenkosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|kuendigung|fffd|d|fffd| |fffd|K|fffd|ndigngVom|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|kuendigungsfrist|fffd||fffd| |fffd|FristK|fffd|ndigung|fffd|", PreserveFormatting:=False
                
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|stockwerk|fffd||fffd| |fffd|Stockwerk|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|lage|fffd||fffd| |fffd|Lage|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|groesse|fffd|n|fffd| |fffd|Gr|fffd||fffd|e|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|Zimmer|fffd||fffd| |fffd|AnzahlZimmer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|kuendigungsgrund|fffd||fffd| |fffd|K|fffd|ndigungsgrund|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|vermieter|fffd||fffd| |fffd|Vermieter|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|EndeMietverhaeltnis|fffd|d|fffd| |fffd|EndeMietverhaeltnis|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|RechtsgrundlageKaution|fffd||fffd| |fffd|RechtsgrundlageKaution|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|BetragKaution|fffd|n|fffd| |fffd|BetragKaution|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|BBKK|fffd||fffd| |fffd|BBKK|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mietrecht|fffd|Kautionsart|fffd||fffd| |fffd|Kautionsart|fffd|", PreserveFormatting:=False
 
        End If
        
    ElseIf (MultiPage1.SelectedItem.Caption = "Beteiligte 2") Then 'Beteiligte 2
        
        For Each Obn In FrameBeteiligte2.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next

        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|eheleutegegner|fffd| |fffd|EheleuteGegner|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|eheleutemandant|fffd| |fffd|EheleuteMandant|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|ganwalt|fffd| |fffd|Gegenanwalt|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|platzhalter.exe|fffd| |fffd|BeteiligteAlleDialog|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|platzhalter.exe|fffd| |fffd|GegnerUndUntergeordneteDialog|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|platzhalter.exe|fffd| |fffd|MandantenUndUntergeordneteDialog|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mandantenundvertreterkurz|fffd| |fffd|Mandanten und Vertreter(Namen/Bezeichnung)|fffd|", PreserveFormatting:=False
    
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gegnerundvertreterkurz|fffd| |fffd|Gegner und Vertreter(Namen/Bezeichnung)|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gegnerunduntergeordnete|fffd| |fffd|Gegner und Untergeordnete|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mandantunduntergeordnete|fffd| |fffd|Mandant und Untergeordnete|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gegnerundvertreter|fffd| |fffd|Gegner und Vertreter|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mandantenundvertreter|fffd| |fffd|Mandanten und Vertreter|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kindermandant|fffd| |fffd|Kinder Mandant|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|kindgegner|fffd| |fffd|Kinder Gegner|fffd|", PreserveFormatting:=False
 
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|advonetuser|fffd|1|fffd|1|fffd||fffd| |fffd|onlineAkteBenutzername|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|OAACTIVATIONCODE|fffd|1|fffd|1|fffd||fffd| |fffd|onlineAkteAktivierungscode|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|beteiligte|fffd|advonetemail|fffd|1|fffd|1|fffd||fffd| |fffd|onlineAkteE-Mail-Adresse|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|mandantenundvertreterkurz1|fffd| |fffd|Mandanten und Vertreter(kurz)|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|gegnerundvertreterkurz1|fffd| |fffd|Gegner und Vertreter(kurz)|fffd|", PreserveFormatting:=False
        
        End If
    End If
    
    Selection.Font.ColorIndex = wdAuto
  '  Unload frmPlatzhalter
Ende:

End Sub


Private Sub UserForm_Terminate()
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "platzhalterv") = _
MultiPage1.Value
End Sub

Private Sub F|fffd|lleComboboxRechnungen()
Dim X, i As Integer
Dim Anzahl As Integer
Dim ret$

ComboBoxRechnung.Clear
X = WordExecute("select  count(distinct BEZEICHNUNG) from kostenrechnungen")
If X <> 0 Then
    MsgBox "Wordexecue-Fehler " & X
    GoTo Ende
End If
ret$ = String(255, " ")
 ret$ = Left(WordRequest(ret$), laenge)
 If ret = "" Then ret = "0"
Anzahl = CInt2(ret$)

X = WordExecute("select distinct BEZEICHNUNG from kostenrechnungen")
If X <> 0 Then
    MsgBox "Wordexecue-Fehler " & X
    GoTo Ende
End If

For i = 1 To Anzahl
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
    ComboBoxRechnung.AddItem ret
Next
Ende:

WordExecute ("commit")

End Sub

Private Sub |fffd|ndereBeschriftungKanzleispezifischePlatzhhalter()
Dim Page8
Dim Opbt
Dim sI As Integer
'On Error GoTo Ende
Dim abfrage$
Dim ret$
Dim X As Integer
Dim Z|fffd|hler As Long

For Each Page8 In MultiPage1.Pages
    If Page8.Name = "Page8" Then
    For Each Opbt In Page8.Controls
        If (Left(Opbt.Name, 5) = "Optio") Then
            sI = CInt2(Mid(Opbt.Caption, 6))
            If Z|fffd|hler < 20 Then
                abfrage = "select z" & sI & " from taktbez"
            ElseIf Z|fffd|hler >= 20 And Z|fffd|hler < 40 Then
                abfrage = "select z" & sI & " from takt2bez"
            ElseIf Z|fffd|hler >= 40 And Z|fffd|hler < 60 Then
                abfrage = "select z" & sI & " from takt3bez"
            ElseIf Z|fffd|hler >= 60 And Z|fffd|hler < 80 Then
                abfrage = "select z" & sI & " from takt4bez"
            End If
            X = WordExecute(abfrage)
            If X <> 0 Then GoTo Ende
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If ret$ <> "" Then
                Opbt.Caption = ret$
            End If
            
        Z|fffd|hler = Z|fffd|hler + 1
        End If
    Next
    End If

Next

Ende:
WordExecute ("commit")
End Sub

Attribute VB_Name = "frmPlatzhalter2"
Attribute VB_Base = "0{6520CEC6-9420-42B9-A7F3-A62881C5F6BD}{1C29E7AB-AFD0-4798-94BE-ADB40152B86C}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private Beteiligter As String
Private Datenfeld As String
Private name_macrobutton As String
Private rang As String
Private kz$
Private bet As String
Private anzahl_betins
Private Index
Dim tabName(101) As String
Dim refName(101) As String
Dim refTyp(101) As Integer
Dim Optionsfelder(664) As New clsPlatzhalter


Private Sub CommandButton1_Click()
Auswahl
If CheckBoxEnde.Value = True Then
    Unload frmPlatzhalter2
End If
End Sub

Private Sub CommandButton2_Click()
Unload frmPlatzhalter2
End Sub


Private Sub ListBox1_KeyUp(ByVal KeyCode As MSForms.ReturnInteger, ByVal Shift As Integer)
If KeyCode = 27 Then
    Unload frmPlatzhalter2
End If
End Sub

Private Sub abc_Change()
Dim X, ret$, Listindex
Dim bLoop As Boolean
Dim s1, s2, lName As String
Dim i, anzbet, anzfeld, i1, i2, n1, typ As Integer
Dim Opbt(101) As OptionButton
Dim help As OptionButton

anzbet = 0

For Each help In FrameABC.Controls
    Set Opbt(anzbet) = help
    anzbet = anzbet + 1
Next

anzbet = anzbet - 1
s2 = "REF_" + abc.Value
lName = "select name from syscolumns where tbname = '" + s2 + "' and name != 'NR'"

X = WordExecute(lName)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, abc.Value
    GoTo Ende
End If

ret$ = String(255, " ")
X = WordExecute("select count(*) from referate2 where referat = '" + abc.Value + "'")
If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If
anzfeld = bib.Val2(Left$(WordRequest(ret$), laenge))

lName = "select feld ||'#'||@string(pos,0)||'|fffd|'||@string(typ,0) from referate2 where referat = '" + abc.Value + "' order by pos"
    X = WordExecute(lName)
    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    ret = String(255, " ")
    
    For X = 0 To anzfeld - 1
        s2 = Left$(WordRequest(ret$), laenge)
        i1 = InStr(s2, "#")
        s1 = Left(s2, i1 - 1)
        i2 = InStr(s2, "|fffd|")
        i = Mid(s2, i1 + 1, i2 - i1 - 1) - 1
        refName(i) = s1
        s1 = Right(s2, Len(s2) - i2)
        If s1 = "1" Then
            tabName(i) = "T" + Trim$(Str$(i + 1))
        ElseIf s1 = "2" Then
            tabName(i) = "I" + Trim$(Str$(i + 1))
        ElseIf s1 = "3" Then
            tabName(i) = "B" + Trim$(Str$(i + 1))
        ElseIf s1 = "4" Then
            tabName(i) = "D" + Trim$(Str$(i + 1))
        ElseIf s1 = "5" Then
            tabName(i) = "C" + Trim$(Str$(i + 1))
        End If
    Next
    
    i = 0

    Do While i < 100
        Opbt(i).Caption = refName(i)
        If refName(i) = "" Then
            Opbt(i).Enabled = False
            refName(i) = Trim$(Str$(i + 1))
        Else
            Opbt(i).Enabled = True
        End If
    
        i = i + 1
    Loop
        
Select Case Listindex
    
End Select
    

Ende:
X = WordExecute("Commit")
End Sub



Private Sub UserForm_Initialize()
Dim ret$
Dim ref_$
Dim X
Dim wahl$
Dim Temp$
Dim i
Dim anzahl_ref

With frmPlatzhalter2
    .Top = Application.Top + (Application.Height - .Height) / 2
    .Left = Application.Left + (Application.Width - .Width) / 2
End With

|fffd|ndereBeschriftungKanzleispezifischePlatzhhalter
i = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "platzhalterv")
If i > 3 Then i = 0

If i <> "" Then
    MultiPage1.Value = CInt(i)
Else
    MultiPage1.Value = 1
End If

Dim Opbt As Control
Dim Pages As Object

i = 0
 
For Each Pages In MultiPage1.Pages
    For Each Opbt In Pages.Controls
        If (Left(Opbt.Name, 5) = "Optio") Then
            Set Optionsfelder(i).Optionsfeld = Opbt
            i = i + 1
        End If
    Next
Next





ret$ = String(255, " ")
X = WordExecute("select count(*) from systables where Name like 'REF\_%'")

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

anzahl_ref = bib.Val2(Left$(WordRequest(ret$), laenge))

If anzahl_ref = -1 Then
    MsgBox "In den Grundeinstellungen wurden noch keine kanzleispez. Daten 2 eingegeben!", vbExclamation, GetApplicationName()

Else
    ReDim ref__$(anzahl_ref)
    X = WordExecute("select name from systables where Name like 'REF\_%'")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If
    
    ret = String(255, " ")
    
    For X = 0 To anzahl_ref - 1
        ref__$(X) = Left$(WordRequest(ret$), laenge)
        abc.AddItem Right(ref__$(X), Len(ref__$(X)) - 4)
    Next
End If

Ende:
X = WordExecute("Commit")

End Sub


Public Sub Auswahl()
    Dim Obn As Object
    Dim Datei As String
    Dim i, X As Integer
    Dim AuswahlOptionbutton As Integer
    Dim ret As String
    Dim abfrage$
    Dim erg$, GBNum(10)
    Dim Datei2$
    Dim Beschriftung$
    Dim Textmarke As Bookmark
    Dim r As Range
    
    Selection.Font.ColorIndex = 5
    ret = String(255, " ")
    
    If (MultiPage1.SelectedItem.Caption = "Inkasso") Then 'inkasso
        AuswahlOptionbutton = -1
        For Each Obn In FrameInkasso.Controls
            
            If Obn = "Tage" Or Obn = "Tage (Monat)" Then
            ElseIf Obn.Value = True Then
                    AuswahlOptionbutton = i
            End If
            If AuswahlOptionbutton > -1 Then Exit For
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|hf|fffd|n|fffd| |fffd|OffeneSummeForderungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|zinsen|fffd|n|fffd| |fffd|OffeneSummeZinsen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|kv|fffd|n|fffd| |fffd|OffeneSummeVerzinslicheKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|kvtz|fffd|n|fffd| |fffd|TageszinsVerzinslicherKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|hftz|fffd|n|fffd| |fffd|TageszinsHauptforderung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|summe|fffd|n|fffd| |fffd|OffenerGesamtbetrag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            Selection.Font.ColorIndex = wdAuto
            
            Selection.TypeText "|fffd|"
            Selection.Font.ColorIndex = 5
            Selection.TypeText "Frist"
            Selection.Font.ColorIndex = wdAuto
            Selection.TypeText "|fffd|"
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|ku|fffd|n|fffd| |fffd|OffeneSummeUnverzinslicheKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|summetz|fffd|n|fffd| |fffd|SummeTageszins|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|stand|fffd|d|fffd| |fffd|Stichtag|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|zinsenkosten|fffd|n|fffd| |fffd|OffeneSummeZinsenVerzKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|zinsenforderung|fffd|n|fffd| |fffd|OffeneSummeZinsenForderung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|tabelleforderungen|fffd| |fffd|TabelleForderungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungsdaten|fffd| |fffd|Forderungsdaten(Datum)|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungstexte|fffd| |fffd|Forderungstexte|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|tabellezahlungen|fffd| |fffd|TabelleZahlungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungen|fffd|forderung|fffd|n|fffd|  |fffd|SummeForderungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|buchungen|fffd|summe|fffd|n|fffd|  |fffd|SummeZahlungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungen|fffd|vk|fffd|n|fffd|  |fffd|SummeVerzinslKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungen|fffd|uk|fffd|n|fffd|  |fffd|SummeUnverzinlKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungen|fffd|summe|fffd|n|fffd|  |fffd|SummeForderungenVerzinslUnverzinslKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fauf|fffd|zinsen|fffd|n|fffd|  |fffd|SummeZinsen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fauf|fffd|zinsenforderung|fffd|n|fffd|   |fffd|SummeZinsenForderung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fauf|fffd|zinsenvk|fffd|n|fffd|   |fffd|SummeZinsenVerzinslKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|forderungzinsenforderung|fffd|n|fffd|   |fffd|SummeForderung+SummeZinsenForderung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|kostenzinsenkosten|fffd|n|fffd|   |fffd|SummeKosten+SummeZinsenKosten|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|zahlungsdaten|fffd| |fffd|Zahlungsdaten(Datum)|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 27 Or AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|tx|fffd| |fffd|Tagesdatum + " + TextBoxTage + " Tage|fffd|", PreserveFormatting:=False
        
         ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|zinsbeginn|fffd|d|fffd|   |fffd|ZinsbeginnForderung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|faufstatus|fffd|mahndatum|fffd|d|fffd|   |fffd|Mahndatum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|tabellefremdgeldauszahlung|fffd| |fffd|Fremdgeldauszahlungsliste|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|vertragsgegenstand|fffd| |fffd|Vertragsgegenstand|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|vertragsdatum|fffd| |fffd|Vertragsdatum|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 35 Then
           ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|vertragsgegenstandvertragsdatum|fffd| |fffd|VertragsgegenstandVertragsdatum|fffd|", PreserveFormatting:=False
           
        ElseIf AuswahlOptionbutton = 36 Then
           ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|forderungsaufstellungverk|fffd|rzt|fffd| |fffd|ForderungsaufstellungVerk|fffd|rzt|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 37 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|tabelle2forderungen|fffd| |fffd|Tabelle2Forderungen|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 38 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|txt|fffd| |fffd|Tagesdatum + " + TextBoxTageT + " Tage (Monat)|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 41 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|tabelleforderungenNurForderungen|fffd| |fffd|TabelleForderungenNurForderungen|fffd|", PreserveFormatting:=False
         
        ElseIf AuswahlOptionbutton = 42 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|Basiszinssatz|fffd| |fffd|akteueller Basiszinssatz|fffd|", PreserveFormatting:=False
        
        
      End If
    
    ElseIf (MultiPage1.SelectedItem.Caption = "Notariat") Then 'Notariat
        For Each Obn In FrameNotariat.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|erschienene|fffd| |fffd|Erschienene|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 1 Then
                   ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|urnr|fffd||fffd| |fffd|UrkundenInDieserAkte|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|grundbuch1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Grundbuch|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|gemarkung1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Gemarkung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|flurstueck1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Flurst|fffd|ck/Parzelle|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|gemeinde1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Gemeinde|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|strasse1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Stra|fffd|e|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|blatt1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Blatt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|grundbuch2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Grundbuch|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|gemarkung2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Gemarkung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|flurstueck2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Flurst|fffd|ck/Parzelle|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|gemeinde2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Gemeinde|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|strasse2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Stra|fffd|e|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|flur1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Flur|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|groesse1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz1Gr|fffd||fffd|e|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|blatt2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Blatt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|flur2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Flur|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|groesse2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erterGrundbesitz2Gr|fffd||fffd|e|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|miteigentum|fffd||fffd| |fffd|Grundst|fffd|cksartMiteigentumsanteilVon|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|sondereigentum|fffd||fffd| |fffd|Grundst|fffd|cksartSondereigentumAn|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|sonstiges|fffd||fffd| |fffd|Grundst|fffd|cksartSonstiges|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|anteil1|fffd||fffd| |fffd|Ver|fffd|u|fffd|erer1Anteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|anteil2|fffd||fffd| |fffd|Ver|fffd|u|fffd|erer2Anteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|anteilerw1|fffd||fffd| |fffd|Erwerber1Anteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|zustellbezirk1|fffd||fffd| |fffd|Erwerber1Zustellbezirk|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|verwandt1|fffd||fffd| |fffd|Erwerber1Verh|fffd|ltnissZumVer|fffd|u|fffd|ererBezeichnung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|anteilerw2|fffd||fffd| |fffd|Erwerber2Anteil|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|zustellbezirk2|fffd||fffd| |fffd|Erwerber2Zustellbezirk|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|verwandt2|fffd||fffd| |fffd|Erwerber2Verh|fffd|ltnissZumVer|fffd|u|fffd|erer|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|art|fffd||fffd| |fffd|RechtsvorgangArt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|rechtswirksamkeit|fffd||fffd| |fffd|RechtsvorgangRechtswirksamkeit|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|genehmigung|fffd||fffd| |fffd|RechtsvorgangZuGenehmigenVon|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|uebergabetag|fffd|d|fffd| |fffd|RechtsvorgangTagDer|fffd|bergabe|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|kaufpreis|fffd|n|fffd| |fffd|GegenleistungKaufpreis|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|belastungen|fffd|n|fffd| |fffd|Gegenleistung|fffd|bernommeneBelastung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 35 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|sonstige|fffd|n|fffd| |fffd|GegenleistungSonstigeLeistung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 36 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|sonstige2|fffd|n|fffd| |fffd|GegenleistungSonstigeLeistung2|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 37 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|bezsonstige2|fffd||fffd| |fffd|GegenleistungSonstigeLeistung2Bezeichnung|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 38 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|inventar|fffd|n|fffd| |fffd|GegenleistungAnteilInventar|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 39 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|bebaut|fffd||fffd| |fffd|Grundst|fffd|cksartBebaut|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 40 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|land|fffd||fffd| |fffd|Grundst|fffd|cksartLandForstwirschGenutzt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 41 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|akten|fffd|urnrdatum|fffd||fffd| |fffd|UrkundenInDieserAkteMitDatum|fffd|", PreserveFormatting:=False
          
        ElseIf AuswahlOptionbutton = 42 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|amtsgericht1|fffd||fffd| |fffd|Amtsgericht|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 43 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|wirtschaftsart1|fffd||fffd| |fffd|Wirtschaftsart|fffd|", PreserveFormatting:=False
           
        ElseIf AuswahlOptionbutton = 44 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|amtsgericht2|fffd||fffd| |fffd|Amtsgericht2|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 45 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|wirtschaftsart2|fffd||fffd| |fffd|Wirtschaftsart2|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 46 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|abtI|fffd||fffd| |fffd|Abt. 1|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 47 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|abtII|fffd||fffd| |fffd|Abt. 2|fffd|", PreserveFormatting:=False
            
        ElseIf AuswahlOptionbutton = 48 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|notariat|fffd|abtIII|fffd||fffd| |fffd|Abt. 3|fffd|", PreserveFormatting:=False
        
       End If
    
    ElseIf (MultiPage1.SelectedItem.Caption = "referatspezif. Daten 2") Then 'referatspezif. Daten
        For Each Obn In FrameABC.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
                Exit For
            End If
            i = i + 1
        Next
        
        i = AuswahlOptionbutton

        Datei2$ = "REF_" + abc.Value
        abfrage$ = "select COLTYPE FROM SYSCOLUMNS WHERE TBNAME = '" & Datei2$ & "' AND name = '" & tabName(i) & "'"
        X = WordExecute(abfrage$)
        erg$ = String(255, " ")
        erg$ = Left(WordRequest(erg$), laenge)
        
        If erg$ = "DECIMAL" Then
            erg$ = "n"
        ElseIf erg$ = "DATE" Then
            erg$ = "d"
        Else
            erg$ = ""
        End If
        
        ret = "|fffd|REF_" + abc.Value + "|fffd|" + tabName(i) + "|fffd|" + erg$ + "|fffd| |fffd|" + refName(i) + "|fffd|"
        ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:=ret, PreserveFormatting:=False
    
    ElseIf (MultiPage1.SelectedItem.Caption = "nur f|fffd|r Termin- und Fristenzettel") Then 'Akte allgemein
        For Each Obn In FrameTerminzettel.Controls
            If Obn.Value = True Then
                AuswahlOptionbutton = i
                Exit For
            End If
            i = i + 1
        Next
        
        If AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|datumvon|fffd| |fffd|DatumVonTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|datumbis|fffd| |fffd|UhrzeitVonTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|uhrzeitbis|fffd| |fffd|UhrzeitBisTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|datumbis|fffd| |fffd|DatumBisTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|text|fffd| |fffd|TextTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|notiz|fffd| |fffd|NotizTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|az|fffd| |fffd|AktenzeichenTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|gericht|fffd| |fffd|GerichtTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|ziel|fffd| |fffd|ZielTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|raum|fffd| |fffd|RaumTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|betreffgericht|fffd| |fffd|BetreffGerichtTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|anschriftgericht|fffd| |fffd|AnschriftGerichtTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|telefongericht|fffd| |fffd|TelefonGerichtTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 13 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|rubrum|fffd| |fffd|RubrumTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|sb|fffd| |fffd|SachbearbeiterTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|fahrzeit|fffd| |fffd|FahrzeitTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|plz|fffd| |fffd|PlzTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|ort|fffd| |fffd|OrtTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|strasse|fffd| |fffd|StrasseTermin|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|terminzettel|fffd|entfernung|fffd| |fffd|EntfernungTermin|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristDatum|fffd| |fffd|Frist Datum|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristStatus|fffd| |fffd|Frist Status|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|VorfristDatum|fffd| |fffd|Vorfrist Datum|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|VorfristDatum2|fffd| |fffd|Vorfrist Datum2|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristbeginnDatum|fffd| |fffd|Fristbeginn Datum|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|DauerFZ|fffd| |fffd|Dauer|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristBezeichnung|fffd| |fffd|FristBezeichnung|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|Notfrist|fffd| |fffd|Notfrist|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FRISTBEMERKUNG|fffd| |fffd|FristBemerkung|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|Dateipfad|fffd| |fffd|Dateipfad|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristArt|fffd| |fffd|FristArt|fffd|", PreserveFormatting:=False
        
        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|Benutzername|fffd| |fffd|Benutzername|fffd|", PreserveFormatting:=False

        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristSB|fffd| |fffd|FristSB|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|FristVerlauf|fffd| |fffd|FristVerlauf|fffd|", PreserveFormatting:=False
       
        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|fristenzettel|fffd|VorfristristVerlauf|fffd| |fffd|VorfristVerlauf|fffd|", PreserveFormatting:=False
    
    End If
    ElseIf (MultiPage1.SelectedItem.Caption = "Grundbuch") Then 'Grundbuch
        For Each Obn In FrameGrundbuch.Controls
            If Obn = "GB aus Akte" Or Obn = "BV" Or Obn = "Abt. I" Or Obn = "Abt. II" Or Obn = "Abt. III" Or Obn = "WEG" Or Obn = "Erbbaurecht" Or Obn = "Erwerber" Or Left(Obn.Name, 2) = "tb" Then
            ElseIf Obn.Value = True Then
                    AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        i = 0
        For Each Obn In FrameGrundbuch.Controls
            If Left(Obn.Name, 2) = "tb" Then
                GBNum(i) = Obn.Value
                i = i + 1
            End If
        Next
        If AuswahlOptionbutton = 20 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Blatt|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Blatt|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 19 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Aufschrift|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Aufschrift|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 85 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Amtsgericht|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Amtsgericht|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 34 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Grundbuchname|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Grundbuchname|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 84 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Grundbuchart|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Grundbuchart|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Grundbuchvon|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Grundbuch von|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 2 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Grundbucheinsicht|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Grundbucheinsicht|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 21 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|LetzteAenderung|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Letzte |fffd|nderung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|lfdnrbv#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Lfd Nr.(BV)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 22 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|gemarkung#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Gemarkung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 35 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|lage#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Lage (Stra|fffd|e)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 44 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Wirtschaftsart#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Wirtschaftsart|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|flur#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Flur|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 23 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Flurstueck#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Flurst|fffd|ck|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 36 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Gemeinde#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Gemeinde|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 45 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|groesse#0|fffd|" + GBNum(6) + "|fffd|" + GBNum(0) + "|fffd||fffd|Gr|fffd||fffd|e in qm|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|lfdnra1#1|fffd|" + GBNum(6) + "|fffd|" + GBNum(1) + "|fffd||fffd|lfd Nr.(Abt.I)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 24 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|zubva1#1|fffd|" + GBNum(6) + "|fffd|" + GBNum(1) + "|fffd||fffd|zu BV(Abt.I)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Eigentuemer#1|fffd|" + GBNum(6) + "|fffd|" + GBNum(1) + "|fffd||fffd|Eigent|fffd|mer|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 51 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Stellung#1|fffd|" + GBNum(6) + "|fffd|" + GBNum(1) + "|fffd||fffd|Stellung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 37 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Anteil#1|fffd|" + GBNum(6) + "|fffd|" + GBNum(1) + "|fffd||fffd|Anteil|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 55 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|lfdnra2#2|fffd|" + GBNum(6) + "|fffd|" + GBNum(2) + "|fffd||fffd|lfd Nr.(Abt.II)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 54 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|zubva2#2|fffd|" + GBNum(6) + "|fffd|" + GBNum(2) + "|fffd||fffd|zu BV(Abt.II)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 53 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Arta2#2|fffd|" + GBNum(6) + "|fffd|" + GBNum(2) + "|fffd||fffd|Art(Abt.II)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 52 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Belastunga2#2|fffd|" + GBNum(6) + "|fffd|" + GBNum(2) + "|fffd||fffd|Belastung(Abt.II)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 59 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|zubva3#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|zu BV(Abt.III)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 60 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|lfdnra3#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|lfd Nr.(Abt.III)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 61 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|arta3#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|Art(Abt.III)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 62 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Betrag#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|Betrag|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 58 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Waehrung#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|W|fffd|hrung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 57 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Belastunga3#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|Belastung(Abt.III)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 63 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Glaeubiger#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|Gl|fffd|ubiger|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 64 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Brief#3|fffd|" + GBNum(6) + "|fffd|" + GBNum(3) + "|fffd||fffd|Brief|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 15 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|EigentuemerName#4|fffd|" + GBNum(6) + "|fffd|" + GBNum(4) + "|fffd||fffd|Eigent|fffd|mer(Name)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 30 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|EigentuemerStellung#4|fffd|" + GBNum(6) + "|fffd|" + GBNum(4) + "|fffd||fffd|Eigent|fffd|mer(Stellung)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 40 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|EigentuemerAnteil#4|fffd|" + GBNum(6) + "|fffd|" + GBNum(4) + "|fffd||fffd|Eigent|fffd|mer(Anteil)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 82 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|AlleEigentuemer#4|fffd|" + GBNum(6) + "|fffd|" + GBNum(4) + "|fffd||fffd|Alle Eigent|fffd|mer|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 78 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|ErwerberName#5|fffd|" + GBNum(6) + "|fffd|" + GBNum(5) + "|fffd||fffd|Erwerber (Name)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 79 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|ErwerberV#5|fffd|" + GBNum(6) + "|fffd|" + GBNum(5) + "|fffd||fffd|Erwerber (Verh|fffd|ltnis)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 77 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|ErwerberA#5|fffd|" + GBNum(6) + "|fffd|" + GBNum(5) + "|fffd||fffd|Erwerber (Anteil)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 83 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|AlleErwerber#5|fffd|" + GBNum(6) + "|fffd|" + GBNum(5) + "|fffd||fffd|Alle Erwerber|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 12 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|WeitereEintragung|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Weitere Eintragung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 27 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Bezugnahmewgb|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Bezugnahme|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 70 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Verwalterwgb|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Verwalter|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 75 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|GrundbuchER|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Grundbuch(ER) von|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 28 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|BlattER|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Blatt(ER)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 38 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|BVlfdNr|fffd|" + GBNum(6) + "|fffd||fffd||fffd|BV (lfd Nr.)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 46 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Abt2lfdNr|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Abt.II (lfd Nr.)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 14 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Dauer|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Dauer|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 29 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|BezugnahmeER|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Bezugnahme(ER)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 39 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Eigentuemerzustimmung|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Eigent|fffd|merzustimmung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 47 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|WeitereEintragunger|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Weitere Eintragung(ER)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 16 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|bebaut|fffd|" + GBNum(6) + "|fffd||fffd||fffd|bebaut|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 31 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|landfortsw|fffd|" + GBNum(6) + "|fffd||fffd||fffd|land-&fortsw.|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 41 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|sonstiges|fffd|" + GBNum(6) + "|fffd||fffd||fffd|sonstiges|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 17 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Rechtsvorgang|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Rechtsvorgang|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 86 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Rechtswirksamkeit|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Rechtswirksamkeit|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 32 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|uebergabetag|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Tag der |fffd|berg.|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 42 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|genehmigung|fffd|" + GBNum(6) + "|fffd||fffd||fffd|zu genehmigen von|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 18 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Kaufpreis|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Gegenleistung (KP)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 33 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|belastungen|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Gegenl. |fffd|ber Be|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 43 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|sonstige|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Gegenleistung (sons )|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 48 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|inventar|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Gegenleistung (IV)|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 3 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|AlleBV|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Alle Eintr|fffd|ge BV (Bestandsverzeichnis) als Tabelle|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|allea1|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Alle Eintr|fffd|ge Abteilung I als Tabelle|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|allea2|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Alle Eintr|fffd|ge Abteilung II als Tabelle|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 56 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|allea3|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Alle Eintr|fffd|ge Abteilung III als Tabelle|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 10 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|MEA|fffd|" + GBNum(6) + "|fffd||fffd||fffd|MEA von|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 25 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|SEAN|fffd|" + GBNum(6) + "|fffd||fffd||fffd|SEA an|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 11 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|Beschraenkung|fffd|" + GBNum(6) + "|fffd||fffd||fffd|Beschr|fffd|nkung|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 26 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|grundbuch|fffd|SondernutzungsRechte|fffd|" + GBNum(6) + "|fffd||fffd||fffd|SN-Rechte|fffd||fffd|", PreserveFormatting:=False
        End If
        
    ElseIf (MultiPage1.SelectedItem.Caption = "Urkundenrolle") Then 'Urkunden
        For Each Obn In FrameUrkunden.Controls
            If Left(Obn.Name, 2) = "tb" Then
            ElseIf Obn.Value = True Then
                    AuswahlOptionbutton = i
            End If
            i = i + 1
        Next
        i = 0
        For Each Obn In FrameUrkunden.Controls
            If Left(Obn.Name, 2) = "tb" And GBNum(0) = 0 Then
                GBNum(0) = Obn.Value
            End If
            i = i + 1
        Next
        If AuswahlOptionbutton = 4 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|Urkundennummer|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Urkundennummer|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 5 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|Urkundendatum|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Datum der Urkunde|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 6 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|Urkundenort|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Ort des Amtsgeschj|fffd|fts|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 7 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|gegenstand|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Gegenstand des Gesch|fffd|fts|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 8 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|kategorie|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Kategorie|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 9 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|bemerkung|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Bemerkungen|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 1 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|AktenUrkunde|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Urkunden in dieser Akte|fffd||fffd|", PreserveFormatting:=False
        ElseIf AuswahlOptionbutton = 0 Then
            ActiveDocument.Fields.Add Range:=Selection.Range, Type:=wdFieldMacroButton, text:="|fffd|urkunden|fffd|AktenUrkundeDatum|fffd|" + GBNum(0) + "|fffd||fffd||fffd|Urkunden in dieser Akte mit Datum|fffd||fffd|", PreserveFormatting:=False
        End If
        
    End If
        
    Selection.Font.ColorIndex = wdAuto
  '  Unload frmPlatzhalter2
Ende:

End Sub


Private Sub UserForm_Terminate()
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "platzhalterv") = _
MultiPage1.Value
End Sub


Private Sub |fffd|ndereBeschriftungKanzleispezifischePlatzhhalter()
Dim Page8
Dim Opbt
Dim sI As Integer
'On Error GoTo Ende
Dim abfrage$
Dim ret$
Dim X As Integer
Dim Z|fffd|hler As Long

For Each Page8 In MultiPage1.Pages
    If Page8.Name = "Page8" Then
    For Each Opbt In Page8.Controls
        If (Left(Opbt.Name, 5) = "Optio") Then
            sI = CInt2(Mid(Opbt.Caption, 6))
            If Z|fffd|hler < 20 Then
                abfrage = "select z" & sI & " from taktbez"
            ElseIf Z|fffd|hler >= 20 And Z|fffd|hler < 40 Then
                abfrage = "select z" & sI & " from takt2bez"
            ElseIf Z|fffd|hler >= 40 And Z|fffd|hler < 60 Then
                abfrage = "select z" & sI & " from takt3bez"
            ElseIf Z|fffd|hler >= 60 And Z|fffd|hler < 80 Then
                abfrage = "select z" & sI & " from takt4bez"
            End If
            X = WordExecute(abfrage)
            If X <> 0 Then GoTo Ende
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If ret$ <> "" Then
                Opbt.Caption = ret$
            End If
            
        Z|fffd|hler = Z|fffd|hler + 1
        End If
    Next
    End If

Next

Ende:
WordExecute ("commit")
End Sub

Attribute VB_Name = "frmSchliessen"
Attribute VB_Base = "0{F1900634-506B-47A2-AF24-6C8CAE2E7FB5}{FB07ADF2-096F-4A7B-9809-6E51442595F1}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False
Option Explicit
Public AktuellesDocument As New clsActiveDocument
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer
Private Declare Sub Sleep Lib "kernel32" (ByVal dwMilliseconds As Long)

Private Const GW_CHILD = 5
Private Const GW_HWNDNEXT = 2
Dim sHnrNeu$, Ordnername, Ordnernr
Dim Anr$
Dim ordnernrht(1000) As Variant
Dim speichern$
Dim sAnhang$
Dim bAnhang As Boolean
Private Sub Abbrechen_Click()
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
    Unload frmSchliessen
End Sub

Private Sub cbAdvonet_Click()
Dim ret$
Dim Postausgang_Status$
Dim postausgang_versendungsart$
Dim Advonetmail$
Dim X
Dim betnr$
          
If cbAdvonet.Value = True Then
    ' cmbStatus.text = "versendet" das gab Proteste der Kunden
    cbEmail.Enabled = True
    betnr$ = GetDocVar("Betnr")
    X = WordExecute("select advonetemail from beteiligte where betnr = " & betnr$)
    ret = String(255, " ")
    Advonetmail$ = Left$(WordRequest(ret$), laenge)
    If Advonetmail$ = "J" Then
        cbEmail.Value = True
    End If
    
    X = WordExecute("select text5 from system where art = 'onlineakte'")
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
        
    If ret$ = "1" Then
        cbPDF.Value = True
    End If
    
Else
    cbEmail.Value = False
    cbEmail.Enabled = False
    Postausgang_Status$ = GetDocVar("postausgang_status")
    
    If Postausgang_Status$ > "" Then
        X = WordExecute("select text5 from system where art = 'postausgang' and text5 <> '[keine]'")
        ret = String(255, " ")
        ret = Left$(WordRequest(ret$), laenge)
        cmbStatus.SelText = ret$
    Else
        cmbStatus.SelText = Postausgang_Status$
    End If
End If

End Sub

Private Sub cbPDF_Click()
If cmbVersendungsart.Value = "E-Post" Or cmbVersendungsart.Value = "E-POST" Then
    cbPDF.Value = 1
    cmdAnhang.Visible = True
End If
End Sub

Private Sub cbPostausgang_Click()
If cbPostausgang.Value = 0 Then
   cmbVersendungsart.Value = GetDocVar("versendungsart")
   cmbSb.Value = ""
End If
End Sub

Private Sub cmbSb_Change()
If cmbSb.Value = "" Then
    cmbStatus.Value = ""
End If
End Sub

Private Sub cmbStatus_Change()
If cmbStatus.Value = "" Then
    cmbSb.Value = ""
End If
End Sub

Private Sub cmbVersendungsart_Change()
If cmbVersendungsart.Value = "E-Post" Or cmbVersendungsart.Value = "E-POST" Then
    cbPDF.Value = 1
    cmdAnhang.Visible = True
Else
    cmdAnhang.Visible = False
End If
End Sub

Private Sub CommandButton1_Click()

Dim dlg3 As Object
Dim hart$
Dim htext$
Dim name_$
Dim Fullname
Dim pdf$
Dim lfd$
Dim hadvonet$, history$
Dim mnr$, X, MnrValue$, ret$, User$, betnr$, sKnr$, WV$, neu$, diktatnr$, letztediktatnr$, Status$, nArt, speichern$, sPostausgang_Versendungsart$, sPostausgang_Status$, sSb$

speichern$ = GetDocVar("speichern")
nArt = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt")
Set dlg3 = WordBasic.DialogRecord.FileSummaryInfo(False)
WordBasic.CurValues.FileSummaryInfo dlg3

name_$ = ActiveDocument.Fullname
Fullname = ActiveDocument.Fullname

If (Left(Fullname, 8) = "Dokument" Or Left(Fullname, 8) = "Document") And speichern$ <> "nein" Then
    On Error Resume Next
    Save.main
    name_$ = ActiveDocument.Fullname
    Fullname = ActiveDocument.Fullname
End If


If InStr(name_$, ".") = 0 Then
   name_$ = name_$ + ".doc"
End If

hart$ = cmbArt.text 'sArt.text

If hart$ = "" Then
    MsgBox "W|fffd|hlen Sie die Art des Vorgangs aus!", vbExclamation, GetApplicationName()
Else
    htext$ = tbAnmerkungen.Value
        
    If cbAdvonet.Value Then
        If cbEmail.Value Then
            hadvonet$ = "2"
        Else
            hadvonet$ = "1"
        End If
    End If
        
    mnr$ = GetDocVar("mnr")
    If mnr$ <> "" Then
        If Len(mnr$) = 1 Then
            mnr$ = "000" + mnr$
        ElseIf Len(mnr$) = 2 Then
            mnr$ = "00" + mnr$
        ElseIf Len(mnr$) = 3 Then
            mnr$ = "0" + mnr$
        End If
            
        hart$ = mnr$ & "   " & hart$
    Else
        X = Len(hart)
        If X > 4 Then X = 4
            
        MnrValue$ = Left(hart$, X)
        mnr$ = CStr(Val(MnrValue))
            
        If mnr$ = "0" Or mnr$ = "" Then
            mnr$ = "null"
        Else
            X = WordExecute("select name from massnahmen where nr = '" + mnr$ + "'")
            ret$ = String(255, " ")
            ret$ = Left(WordRequest(ret$), laenge)
            If ret$ = "" Then
                mnr$ = "null"
            End If
            
        End If
    End If
        
    User$ = GetDocVar("|fffd|Benutzer|fffd|")
    X = 0
        
    betnr$ = GetDocVar("Betnr")
    sKnr$ = GetDocVar("knr")
        
    htext$ = Left(htext$, 254)
    If speichern$ = "nein" And Left$(ActiveDocument.Name, 8) = "Dokument" Then
        name_$ = ""
    End If
    
    Ordnername = CmbKategorie.Value
    lfd = CmbKategorie.Listindex
    If lfd > 0 Then
        Ordnernr = ordnernrht(lfd)
    Else
        Ordnernr = ""
    End If
    
    X = InsertIntoHistory(Anr$, hart$, User$, name_$, htext$, mnr$, hadvonet$, sHnrNeu$, betnr$, sKnr$, Ordnernr)
    
    sPostausgang_Versendungsart$ = cmbVersendungsart.Value
    sPostausgang_Status$ = cmbStatus.Value
    sSb$ = cmbSb.Value
    
    If cbPostausgang.Value = True Then
        X = InsertIntoPostausgang(sHnrNeu$, sPostausgang_Versendungsart$, sPostausgang_Status$, sSb$, sAnhang$)
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Hnr") = sHnrNeu$
        fSendMessageAdvoware 39, 0
    End If
    
    X = WordExecute("select text1 from system where art = 'erzeugeimpdatei'")
    If X <> 0 Then
        MsgBox "Wordexecute-Fehler " & X
    End If
        
    ret$ = String(255, " ")
    ret$ = Left(WordRequest(ret$), laenge)
        
    If ret$ = "1" Then
        ErzeugeImpDatei
    End If
                    
    If Left$(ActiveDocument.Fullname, 8) <> "Dokument" Then
        sKnr$ = GetDocVar("knr")
        
        If (sKnr$ > "") Then
            name_$ = ActiveDocument.Fullname
            X = WordExecute("update krsum set datei = '" + name_$ + "' where knr = '" + sKnr$ + "'")
            X = WordExecute("commit")
        End If
    End If
    
    If nArt <> "1" Then
        If GetDocVar("DNSControl") = "1" Then
            If Len(Dir(GetProgramdir$() + "\DNSControl.exe")) > 0 Then
                Shell (GetProgramdir$() + "\DNSControl.exe /kill")
            End If
        End If
    End If
    
    If cbWV.Value Then
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Wiedervorlage_Word") = GetAnr(1) ' 27.10.2016 (mp) Mit SendMessage kann in Lparam keine 32Bit |fffd|bergeben werden, obwohl LONG
        fSendMessageAdvoware 35, GetAnr(1)
    End If
    
    If cbAufgabe.Value Then
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Aufgabe_Word") = sHnrNeu$
        fSendMessageAdvoware 37, 0
    End If
      
    If cbWichtig.Value Then
        X = WordExecute("update history set wichtig = 1 where hnr = " + sHnrNeu$)
        X = WordExecute("commit")
    End If
    
    neu$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "neu")
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "1"
    
    If speichern$ = "nein" Then
        ActiveDocument.Saved = True
    End If
    
    If cbPDF.Value = True Then
        SetDocVar "NoPDF", "ja"
        fErzeugePDF (sHnrNeu$)
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDF") = "1"
    End If
     
    If sPostausgang_Versendungsart$ = "E-Mail" And cmbStatus.Value = "freigegeben" Then
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Hnr") = sHnrNeu$
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "EMailAkte_Word") = GetAnr(1)
        fSendMessageAdvoware 18, 0
    End If
    
    history$ = GetDocVar("history")
    If InStr(1, history$, "Gesellschafterliste") = 1 Then
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "Hnr") = sHnrNeu$
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "GSListe") = history$
        fSendMessageAdvoware 42, 0
    End If
     
    If neu$ <> "ja" Then
        diktatnr$ = GetDocVar("Diktatnr")
        
        If diktatnr$ <> "" And diktatnr$ <> "0" And diktatnr$ <> "-1" Then
            Status$ = GetDocVar("status")
            
            If Status$ <> "nein" Then  'sonst Aufruf aus Aktengeschichte
                LoadFrmDiktatstatus.main diktatnr$
            Else
                SetDocVar "status", ""
                WordBasic.FileSave
                
                If global_bDoNotClose = False Then
                    AktuellesDocument.DeleteAktuellesDocumentActiveDoc
                    On Error Resume Next
                    ActiveDocument.Close (False)
                    GotoAdvoware '24.10.2016 (mp): Damit Advoware in den Vordergrund kommt, wenn beim Schlie|fffd|en eine Meldung aufpoppt
                End If
            End If
        Else
            If global_bDoNotClose = False Then
                AktuellesDocument.DeleteAktuellesDocumentActiveDoc
                On Error Resume Next
                ActiveDocument.Close (False)
                GotoAdvoware '24.10.2016 (mp): Damit Advoware in den Vordergrund kommt, wenn beim Schlie|fffd|en eine Meldung aufpoppt
           End If
        End If
    Else
        If global_bDoNotClose = False Then
            AktuellesDocument.DeleteAktuellesDocumentActiveDoc
            On Error Resume Next
            ActiveDocument.Close (False)
            GotoAdvoware '24.10.2016 (mp): Damit Advoware in den Vordergrund kommt, wenn beim Schlie|fffd|en eine Meldung aufpoppt
        End If
    End If
    
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = ""
    Unload frmSchliessen
End If
End Sub

Private Sub cmdAnhang_Click()
If bAnhang Then
    tbAnhang = ""
    sAnhang$ = ""
Else
    Load frmAnhang
    frmAnhang.Show
End If
End Sub


Private Sub tbAnhang_Change()
If tbAnhang.text = "" Then
    L_Anhang.Visible = False
    tbAnhang.Visible = False
    bAnhang = False
    cmdAnhang.Caption = "Anhang hinzuf|fffd|gen"
    L_Bemerkung.Top = L_Bemerkung.Top - 25
    tbAnmerkungen.Top = tbAnmerkungen.Top - 25
    cbPDF.Top = cbPDF.Top - 25
    cbWV.Top = cbWV.Top - 25
    cbAufgabe.Top = cbAufgabe.Top - 25
    cbPostausgang.Top = cbPostausgang.Top - 25
    cbAdvonet.Top = cbAdvonet.Top - 25
    cbEmail.Top = cbEmail.Top - 25
    cbWichtig.Top = cbWichtig.Top - 25
    CommandButton1.Top = CommandButton1.Top - 25
    Abbrechen.Top = Abbrechen.Top - 25
    cmdAnhang.Top = cmdAnhang.Top - 25
    frmSchliessen.Height = frmSchliessen.Height - 25
Else
    L_Anhang.Visible = True
    tbAnhang.Visible = True
    bAnhang = True
    cmdAnhang.Caption = "Anhang entfernen"
    L_Bemerkung.Top = L_Bemerkung.Top + 25
    tbAnmerkungen.Top = tbAnmerkungen.Top + 25
    cbPDF.Top = cbPDF.Top + 25
    cbWV.Top = cbWV.Top + 25
    cbAufgabe.Top = cbAufgabe.Top + 25
    cbPostausgang.Top = cbPostausgang.Top + 25
    cbAdvonet.Top = cbAdvonet.Top + 25
    cbEmail.Top = cbEmail.Top + 25
    cbWichtig.Top = cbWichtig.Top + 25
    CommandButton1.Top = CommandButton1.Top + 25
    Abbrechen.Top = Abbrechen.Top + 25
    cmdAnhang.Top = cmdAnhang.Top + 25
    frmSchliessen.Height = frmSchliessen.Height + 25
End If
End Sub


Private Sub tbAnmerkungen_MouseUp(ByVal Button As Integer, ByVal Shift As Integer, ByVal X As Single, ByVal Y As Single)

    If Button = vbKeyRButton Then
    
    Call ShowTextMenu

    End If

End Sub

Sub ShowTextMenu()
    Call MakeMenu
    Application.CommandBars("TextBox Bar").ShowPopup
End Sub

Sub MakeMenu()

    Dim b As Integer

    On Error Resume Next
    CommandBars("TextBox Bar").Delete
    On Error GoTo 0

    Dim cbTextBox As CommandBar
    Dim cmdTest As CommandBarButton

    Set cbTextBox = Application.CommandBars.Add(Name:="TextBox Bar", position:=msoBarPopup, Temporary:=True)

    With cbTextBox
        For b = 1 To 2
            Set cmdTest = .Controls.Add(Type:=msoControlButton, Temporary:=True)
            With cmdTest
                .style = msoButtonIconAndCaption
                .Parameter = b
                Select Case b
                    Case 1
                        .FaceId = 19
                        .Caption = "Kopieren"
                        .OnAction = "Men|fffd|funktionen.TextMenu_Copy"
                    Case 2
                        .FaceId = 22
                        .Caption = "Einf|fffd|gen"
                        .OnAction = "Men|fffd|funktionen.TextMenu_Paste"
                End Select
                End With
        Next b
    End With

End Sub

Private Sub UserForm_Initialize()
Dim Rubrum$
Dim erg$
Dim Database$
Dim dateinr$
Dim ret$
Dim sKnr$
Dim muster$
Dim dlg As Object
Dim X
Dim name_$
Dim hart$
Dim htext$
Dim Os$
Dim modified$
Dim User$
Dim abfrage$
Dim Vorlage$
Dim Pfad$
Dim Kr$
Dim betnr$, master, BetnrLoc
Dim Urk$
Dim bOk
Dim Datei$
Dim altpfad$
Dim Hnr$
Dim dirty
Dim Datum$
Dim history$
Dim DocVarcmbhart As Variable
Dim mnr$
Dim MnrValue$
Dim diktatnr$
Dim Status$
Dim kuerzel$
Dim neu$
Dim advonet$
Dim EmailBenachrichtigung$
Dim Fullname$
Dim SchonVorhanden$
Dim sEmail$
Dim hadvonet$
Dim pdf$
Dim PDFAlle
Dim WV$
Dim App$
Dim i, nArt, kz$
Dim j, j1, s1, lfd, ebene(1000)
Dim art__() As String
Dim nWND As Long
Dim KeinPostausgang$
Dim sArtHart$, sReferat
Dim dlg3 As Object
Dim nActiveDocumentSaved As Long
Dim Postausgang_Status$
Dim postausgang_versendungsart$
Dim statuspostausgang_diktate$

SetDatabaseReg
nActiveDocumentSaved = ActiveDocument.Saved
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "DlgIsOpen") = "1"

With frmSchliessen
    .Top = Application.Top + (Application.Height - .Height) / 2
    .Left = Application.Left + (Application.Width - .Width) / 2
End With

nArt = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt")
If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDFDrucker") = "1" Then
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "PDFDrucker") = "0"
    AktuellesDocument.DeleteAktuellesDocumentActiveDoc
    ActiveDocument.Close (True)
End If

'Drucken aus Aktengeschichte
If System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "NurDrucken") = "1" Then
    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "NurDrucken") = "0"
    AktuellesDocument.DeleteAktuellesDocumentActiveDoc
    ActiveDocument.Close (True)
End If


If WordBasic.CountWindows() Then

    dirty = WordBasic.IsDocumentDirty()
    If UCase(Right$(ActiveDocument.Name, 3)) = "DOC" Or UCase(Right$(ActiveDocument.Name, 3)) = "RTF" _
        Or UCase(Right$(ActiveDocument.Name, 4)) = "DOCX" Or UCase(Right$(ActiveDocument.Name, 3)) = "ODT" Or UCase(Right$(ActiveDocument.Name, 3)) = "RVG" _
        Or UCase(Right$(ActiveDocument.Name, 3)) = "DAT" Or UCase(Left$(ActiveDocument.Name, 8)) = "DOKUMENT" Then
        AktuellesDocument.DeleteAktuellesDocumentActiveDoc
        
        speichern$ = GetDocVar("speichern")
        muster$ = GetDocVar("muster")
        betnr$ = GetDocVar("Betnr")
        If betnr$ = "" Then betnr$ = "0"
        
        sKnr$ = GetDocVar("knr")
        
        If muster$ <> "ja" Then
            If speichern$ = "nein" Then ActiveDocument.Saved = True
                modified$ = GetDocVar("modified")
        
                Anr$ = GetAnr(1)
                Fullname = ActiveDocument.Fullname
                ret$ = String(255, " ")
                X = WordExecute("select hnr from history where nr=" & Anr$ & " and (@upper(datei)=@upper('" & Fullname & "') or @upper(originaldatei)=@upper('" & Fullname & "'))")
                SchonVorhanden$ = Left$(WordRequest(ret$), laenge)
                
                If SchonVorhanden$ <> "" Then
                    modified$ = "1"
                End If
                
                If modified$ = "1" Then         'aufgerufen aus Aktengeschichte oder Advovoice
                    Datum = ActiveDocument.BuiltInDocumentProperties(12)
                   ' 21.10.2016 (mp) If (dirty <> 0) Or Datum <> "" Then ' 02.07.2016 (mp): es soll auch MODIFIED soll auch aktualisiert werden, wenn das Dokument manuell gespeichert wurde und unmittelbar danach aus das Advoware-Symbol geklickt wurd
                    'If (dirty <> 0) Then ' 02.07.2016 (mp): es soll auch MODIFIED soll auch aktualisiert werden, wenn das Dokument manuell gespeichert wurde und unmittelbar danach aus das Advoware-Symbol geklickt wurd
                    If SchonVorhanden$ <> "" Then
                        X = WordExecute("select @datetochar(@nullvalue(modified,hdat),'dd.mm.yyyy hh:mi:00') from history where hnr=" & SchonVorhanden$)
                        ret$ = String(255, " ")
                        modified$ = Left$(WordRequest(ret$), laenge)
                     'MsgBox Left(modified, 16)
                        If Left(modified, 16) <> Left(Datum, 16) Then ' Sekunden m|fffd|ssen ignoriert werden, weil  BuiltInDocumentProperties keine Sekunden ausgibt.
                            dirty = 1
                        End If
                    End If
                    
                    If (dirty <> 0) Then ' 20.07.2018 (mp): es soll auch MODIFIED soll auch aktualisiert werden, wenn das Dokument manuell gespeichert wurde und unmittelbar danach aus das Advoware-Symbol geklickt wurd
                        VorlageNichtSpeichern '11.07.2016 (mp)
                        
                        If nArt < "1" And dirty <> 0 Then
                            If ActiveDocument.Saved = False Then
                                WordBasic.FileSave
                                Datum = ActiveDocument.BuiltInDocumentProperties(12) 'keine Sekunden, nach dem Update nochmal ansehen
                          End If
                            If Datum = "" Then
                                Datum = ActiveDocument.BuiltInDocumentProperties(12) 'keine Sekunden, nach dem Update nochmal ansehen
                            End If
                        End If
                        name_$ = ActiveDocument.Fullname
                        User$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "User")
                        
                        X = WordExecute("select kuerzel from mitarbeiter where name = '" + User$ + "'")
                        ret$ = String(255, " ")
                        kuerzel$ = Left$(WordRequest(ret$), laenge)
                        
                    
                        abfrage$ = "select hnr from history where nr = " & Anr$ & " and (@lower(datei) = @lower('" + name_$ + "') or @lower(originaldatei) = @lower('" + name_$ + "')) order by hnr"
                        X = WordExecute(abfrage$)
                        ret$ = String(255, " ")
                        ret$ = Left$(WordRequest(ret$), laenge)
                        If ret$ <> "" Then ' 05.10.2018 mp: Es darf nurt in der aktuellen Akte gesucht werden, sonst gibt es Performance-Probleme
                            If Datum <> "" Then
                                X = WordExecute("update history set modified = " & Datum & ", benutzer = '" + kuerzel$ + "' where hnr = " + ret$)
                            Else
                                X = WordExecute("update history set modified = sysdatetime, benutzer = '" + kuerzel$ + "' where hnr = " + ret$)
                            End If
                            X = WordExecute("commit")
                        Else
                            ret$ = 0
                            abfrage$ = "select hnr from history where hnr> " & ret$ & " and (@lower(datei) = @lower('" + name_$ + "') or @lower(originaldatei) = @lower('" + name_$ + "')) order by hnr"
                            X = WordExecute(abfrage$)
                            ret$ = String(255, " ")
                            ret$ = Left$(WordRequest(ret$), laenge)
                            
                            While ret$ <> ""
                                If Datum <> "" Then
                                    X = WordExecute("update history set modified = " & Datum & ", benutzer = '" + kuerzel$ + "' where hnr = " + ret$)
                                Else
                                    X = WordExecute("update history set modified = sysdatetime, benutzer = '" + kuerzel$ + "' where hnr = " + ret$)
                                End If
                                
                                X = WordExecute("commit")
                                abfrage$ = "select hnr from history where hnr> " & ret$ & " and (@lower(datei) = @lower('" + name_$ + "') or @lower(originaldatei) = @lower('" + name_$ + "')) order by hnr"
                                X = WordExecute(abfrage$)
                                ret$ = String(255, " ")
                                ret$ = Left$(WordRequest(ret$), laenge)
                            Wend
                        End If
                            
                    End If
                    
                    Anr$ = GetAnr(1)
                    
                    diktatnr$ = GetDocVar("Diktatnr")
                    
                    System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "nArt") = "2"
                    
                    If GetDocVar("DNSControl") = "1" Then
                        If Len(Dir(GetProgramdir$() + "\DNSControl.exe")) > 0 Then
                            Shell (GetProgramdir$() + "\DNSControl.exe /kill")
                        End If
                    End If
                      
                    neu$ = GetDocVar("neu")
                    If neu$ <> "ja" Then
                        If diktatnr$ <> "-1" And diktatnr$ <> "" And diktatnr$ <> "0" Then
                            Status$ = GetDocVar("status")
                            If Status$ = "" Then
                                X = WordExecute("select status from diktate where nr = " + diktatnr$)
                                ret$ = String(255, " ")
                                Status$ = Left(WordRequest(ret$), laenge)
                            End If
                            
                            If Status$ <> "" And Status$ <> "nein" Then  'Nein = Aufruf aus Aktengeschichte
                                Application.Activate
                                Load frmDiktatstatus
                                frmDiktatstatus.SetStatus (diktatnr$)
                                frmDiktatstatus.Show
                                
                                If global_bDoNotClose = False Then
                                    AktuellesDocument.DeleteAktuellesDocumentActiveDoc
                                    On Error Resume Next
                                    ActiveDocument.Close (wdDoNotSaveChanges)
                                End If
                                
                            Else
                                SetDocVar "status", ""
                                If ActiveDocument.Saved = False Then
                                    WordBasic.FileSave
                                End If
                                If global_bDoNotClose = False Then
                                    AktuellesDocument.DeleteAktuellesDocumentActiveDoc
                                    On Error Resume Next
                                    ActiveDocument.Close (False)
                                End If
                            End If
                        Else
                            
                            If fDocToPdf(Anr$, nActiveDocumentSaved) = True Then
                                Fullname = ActiveDocument.Fullname
                                ret$ = String(255, " ")
                                sHnrNeu$ = "     "
                                X = WordExecute("select hnr from history where nr=" & Anr$ & " and (@upper(datei)=@upper('" & Fullname & "') or @upper(originaldatei)=@upper('" & Fullname & "'))")
                                sHnrNeu$ = Left$(WordRequest(ret$), laenge)
                                pdf$ = "1"
                                fErzeugePDF (sHnrNeu$)
                            End If
                            
                            If global_bDoNotClose = False Then
                                AktuellesDocument.DeleteAktuellesDocumentActiveDoc
                                On Error Resume Next
                                ActiveDocument.Close (False)
                            End If

                        End If
                    Else
                        If global_bDoNotClose = False Then
                            AktuellesDocument.DeleteAktuellesDocumentActiveDoc
                            On Error Resume Next
                            ActiveDocument.Close (False)
                        End If
                        
                        If fDocToPdf(Anr$, nActiveDocumentSaved) = True Then
                            Fullname = ActiveDocument.Fullname
                            ret$ = String(255, " ")
                            sHnrNeu$ = "     "
                            X = WordExecute("select hnr from history where nr=" & Anr$ & " and (@upper(datei)=@upper('" & Fullname & "') or @upper(originaldatei)=@upper('" & Fullname & "'))")
                            sHnrNeu$ = Left$(WordRequest(ret$), laenge)
                            pdf$ = "1"
                            fErzeugePDF (sHnrNeu$)
                        End If
                    End If

                ElseIf UCase(Right$(ActiveDocument.Name, 3)) <> "DOC" And UCase(Right$(ActiveDocument.Name, 3)) <> "ODT" And UCase(Right$(ActiveDocument.Name, 4)) <> "DOCX" And UCase(Right$(ActiveDocument.Name, 3)) <> "RTF" And Left$(ActiveDocument.Name, 8) <> "Dokument" Then
                'z.B. bei |fffd|nderung einer Vorlage aus den Grundeinstellungen oder nicht gespeicherten Anschreiben
                    
                    If ActiveDocument.Saved = False Then
                        WordBasic.FileSave
                    End If
                    
                Else
                    SetDocVar "|fffd|Benutzer|fffd|", GetUser
                    If GetDocVar("Nr") = "" Then
                        SetDocVar "Nr", GetAnr(0)
                    End If
        
                    If dirty <> 0 Then
                        If (speichern$ <> "nein" And speichern$ <> "") Or Trim(GetDocVar("history")) = "Handaktenbogen" Then
                            ActiveDocument.Save
                        End If
                    End If
                                        
                    
                    history$ = GetDocVar("history")
                
                    Database$ = GetDatabase
                
                    If history$ <> "nein" And SchonVorhanden$ = "" Then
                        X = WordExecute("select rubrum from akten where nr = " + Anr$)
                        ret$ = String(255, " ")
                        Rubrum$ = Left(WordRequest(ret$), laenge)

                        ReDim art__$(0)
                        i = 0
                        j = 0
                        
                        X = WordExecute("select count(*) from vorgaenge")
                        ret$ = String(255, " ")
                        erg$ = Left$(WordRequest(ret$), laenge)
                    
                        If erg$ <> "0" Then
                            j = CInt2(erg$)
                            X = WordExecute("select text,@upper(text) from vorgaenge order by 1")
                            ret$ = String(255, " ")
                            erg$ = Left$(WordRequest(ret$), laenge)
                            art__$(0) = erg$
                        
                            While i < j
                                erg$ = Left$(WordRequest(ret$), laenge)
                                i = i + 1
                                ReDim Preserve art__$(i)
                                art__$(i) = erg$
                             Wend
                        End If
                    
                        sArtHart$ = fGetArtHart()
                        If sArtHart$ <> "1" Then
                            Dim sInput As String
                            
                            sInput = GetDocVar("Musterschriftsatz")
                            
                            If sInput <> "" Then
                                cmbArt.text = sInput
                                cmbArt.AddItem (sInput)
                            Else
                                sInput = GetDocVar("history")
                                If sInput <> "" Then
                                    cmbArt.text = sInput
                                    cmbArt.AddItem (sInput)
                                End If
                            End If
                        
                            If Len(cmbArt.text) > 100 Then
                                cmbArt.text = Left(cmbArt.text, 100)
                            ElseIf Len(cmbArt.text) = 0 Then
                                cmbArt.text = ActiveDocument.Name
                            End If
                        End If
                        
                        If Anr$ <> "" Then
                            sAkte = CStr(CLng(Right(Anr$, 6))) & "/" & Left(Anr$, 4) & " - " & Rubrum
                        End If
                        
                        If i > 0 Then
                            i = 0
                            
                            While i < j
                               cmbArt.AddItem (art__$(i))
                               i = i + 1
                            Wend
                        End If
                        
                        If sArtHart$ = "1" Then
                            cmbArt.style = fmStyleDropDownList
                        End If

                        diktatnr$ = GetDocVar("Diktatnr") ' -1 = neues Diktat
                        
                        If diktatnr$ <> "" And diktatnr$ <> "0" Then
                            Status$ = GetDocVar("status")
                            If Status$ = "" Then
                                X = WordExecute("select status from diktate where nr = " + diktatnr$)
                                ret$ = String(255, " ")
                                Status$ = Left(WordRequest(ret$), laenge)
                            End If
                            
                            X = WordExecute("select text6 FROM system where art = 'postausgang'")
                            ret$ = String(255, " ")
                            statuspostausgang_diktate$ = Left$(WordRequest(ret$), laenge)
                        
                            If Status$ <> statuspostausgang_diktate$ And statuspostausgang_diktate$ <> "" Then
                                KeinPostausgang$ = "1"
                                cbPostausgang.Enabled = False
                                cbPostausgang.Value = 0
                                cbPDF.Value = 0
                                cmbVersendungsart.Enabled = False
                                cmbSb.Enabled = False
                                cmbStatus.Enabled = False
                            End If
                        End If
                        
                        If diktatnr$ = "" Or diktatnr$ = "0" Or diktatnr$ = "-1" Then

                            User$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "User")
                            
                            If User$ <> "Administrator" Then
                                X = WordExecute("select 1 from rechteverwaltung, mitarbeitergruppen where recht = 'Onlineakte_i' and mitarbeitergruppen.gruppenname = rechteverwaltung.gruppe and mitarbeitername ='" & User$ + "'")
                                ret$ = String(255, " ")
                                ret$ = Left(WordRequest(ret$), laenge)
                                
                                If ret$ = "" Then
                                    X = WordExecute("select 1 from mitarbeitergruppen where gruppenname = 'Administratoren' and mitarbeitername ='" & User$ & "'")
                                    ret$ = String(255, " ")
                                    ret$ = Left(WordRequest(ret$), laenge)
                                End If
                                
                                If ret$ <> "" Then
                                    bOk = True
                                End If
                            Else
                                bOk = True
                            End If
        
                            If bOk = True Then
                                X = WordExecute("select 1 from betakt, beteiligte  " + _
                                      "where nr = " + Anr$ + " and betakt.betnr = beteiligte.betnr  " + _
                                       "and ( advonetfreigabe = 'J' or ( advonetautofg = 'J' and betakt.kz = 1 ) )")
                                ret$ = Left(WordRequest(ret$), laenge)
                                    
                                If ret$ <> "" Then
                                    advonet$ = "1"
                                End If
                                
                                If advonet$ = "1" Then
                                    X = WordExecute("select 1 from beteiligte, betakt where beteiligte.advonetemail = 'J' and beteiligte.betnr = betakt.betnr and betakt.nr=" & Anr$)
                                    ret$ = Left(WordRequest(ret$), laenge)
                                    If ret$ <> "" Then
                                        EmailBenachrichtigung$ = 1
                                    End If
                                End If
                            End If
                            If KeinPostausgang$ <> "1" Then
                                ReDim art__$(0)
                                i = 0
                                j = 0
                                X = WordExecute("select count(*) from postausgang_versendungsarten where art <> '[keine]'")
                                ret$ = String(255, " ")
                                erg$ = Left$(WordRequest(ret$), laenge)
                            
                                If erg$ <> "0" Then
                                    j = CInt2(erg$)
                                    X = WordExecute("select art from postausgang_versendungsarten where art <> '[keine]'order by 1")
                                    ret$ = String(255, " ")
                                    erg$ = Left$(WordRequest(ret$), laenge)
                                    art__$(0) = erg$
                                
                                    While i <= j
                                        erg$ = Left$(WordRequest(ret$), laenge)
                                    
                                        i = i + 1
                                        ReDim Preserve art__$(i)
                                        art__$(i) = erg$
                                     Wend
                                End If
                                
                                If i > 0 Then
                                    j = 0
                                    While art__$(j) > ""
                                       cmbVersendungsart.AddItem (art__$(j))
                                       j = j + 1
                                    Wend
                                    cmbVersendungsart.AddItem (art__$(j))
                                End If
                                
                                ReDim art__$(0)
                                i = 0
                                j = 0
                                X = WordExecute("select count(*) from postausgang_status where status <> '[keine]'")
                                ret$ = String(255, " ")
                                erg$ = Left$(WordRequest(ret$), laenge)
                            
                                If erg$ <> "0" Then
                                    j = CInt2(erg$)
                                    X = WordExecute("select status from postausgang_status where status <> '[keine]'")
                                    ret$ = String(255, " ")
                                    erg$ = Left$(WordRequest(ret$), laenge)
                                    art__$(0) = erg$
                                    While i <= j
                                        erg$ = Left$(WordRequest(ret$), laenge)
                                    
                                        i = i + 1
                                        ReDim Preserve art__$(i)
                                        art__$(i) = erg$
                                     Wend
                                End If
                                If i > 0 Then
                                    j = 0
                                    While art__$(j) > ""
                                       cmbStatus.AddItem (art__$(j))
                                       j = j + 1
                                    Wend
                                    cmbStatus.AddItem (art__$(j))
                                End If
                                 
                                postausgang_versendungsart$ = GetDocVar("postausgang_versendungsart")
                                If postausgang_versendungsart$ = "" Then
                                    postausgang_versendungsart$ = GetDocVar("versendungsart")
                                End If
                            
                                If postausgang_versendungsart$ = "" Then

                                    If betnr$ <> "0" Then
                                        X = WordExecute("select versendungsart from beteiligte where betnr =  " + betnr$)
                                        ret = String(255, " ")
                                        postausgang_versendungsart$ = Left$(WordRequest(ret$), laenge)
                                        cmbVersendungsart = postausgang_versendungsart$
                                    End If
                                    
                                    If postausgang_versendungsart$ = "" Then
                                        i = InStr(1, cmbArt.text, " (")
                                        If i > 0 Then
                                            s1 = Mid(cmbArt.text, 1, i - 1)
                                        Else
                                            s1 = ""
                                        End If
                                        erg$ = "select versendungsart from anschreiben where name = '" & s1 & "'"
                                        X = WordExecute(erg$)
                                        ret = String(255, " ")
                                        postausgang_versendungsart$ = Left$(WordRequest(ret$), laenge)
                                        cmbVersendungsart = postausgang_versendungsart$
                                    End If
                                                                       
                                    If postausgang_versendungsart$ = "" Then
                                        erg$ = "select text2 from system where art = 'postausgang' and text2 <> '[keine]'"
                                        X = WordExecute(erg$)
                                        ret = String(255, " ")
                                        postausgang_versendungsart$ = Left$(WordRequest(ret$), laenge)
                                        cmbVersendungsart = postausgang_versendungsart$
                                    End If
                                    
                                Else
                                    cmbVersendungsart = postausgang_versendungsart$
                                End If
                                i = InStr(1, cmbArt.text, " (")
                                If i > 0 Then
                                    j = InStr(1, cmbArt.text, ")")
                                    If j > i + 2 Then
                                        s1 = Mid(cmbArt.text, i + 2, j - i - 2)
                                    Else
                                        s1 = cmbArt.text
                                    End If
                                    erg$ = "select 1 from anschreiben where  name = '" & s1 & "'"
                                Else
                                    erg$ = "select 1 from anschreiben where  @find(name,'" & cmbArt & "',0)>=0"
                                End If
                                X = WordExecute(erg$)
                                ret$ = String(255, " ")
                                ret$ = Left$(WordRequest(ret$), laenge)
                                
                                If ret$ = "1" Then
                                    If i > 0 Then
                                        erg$ = "select Versendungsart from anschreiben where  name = '" & s1 & "'"
                                    Else
                                        erg$ = "select Versendungsart from anschreiben where  @find(name,'" & cmbArt & "',0)>=0"
                                    End If
                                    X = WordExecute(erg$)
                                    ret$ = String(255, " ")
                                    ret$ = Left$(WordRequest(ret$), laenge)
                                    If ret$ <> "" Then
                                        cmbVersendungsart.text = ret$
                                    End If
                                End If
                            
                                ReDim art__$(0)
                                i = 0
                                j = 0
                                X = WordExecute("select count(*) from mitarbeiter where (passiv = 0 or passiv is null) ")
                                ret$ = String(255, " ")
                                erg$ = Left$(WordRequest(ret$), laenge)
                            
                                If erg$ <> "0" Then
                                    j = CInt2(erg$)
                                    X = WordExecute("select kuerzel, @proper( kuerzel ) from mitarbeiter where (passiv = 0 or passiv is null) order by 2")
                                    ret$ = String(255, " ")
                                    erg$ = Left$(WordRequest(ret$), laenge)
                                    art__$(0) = erg$
                                
                                    While i <= j
                                        erg$ = Left$(WordRequest(ret$), laenge)
                                        i = i + 1
                                        ReDim Preserve art__$(i)
                                        art__$(i) = erg$
                                     Wend
                                End If
                                If i > 0 Then
                                    j = 0
                                    While art__$(j) > ""
                                       cmbSb.AddItem (art__$(j))
                                       j = j + 1
                                    Wend
                                    cmbSb.AddItem (art__$(j))
                                End If
                                
                                X = WordExecute("select sb from akten where nr = '" & Anr$ & "'")
                                ret$ = String(255, " ")
                                ret$ = Left(WordRequest(ret$), laenge)
                                i = 0
                                While art__$(i) <> ret$ And i < j
                                    i = i + 1
                                Wend
                                cmbSb.Listindex = i
                            End If
                            
                            If KeinPostausgang$ <> "1" Then
                                KeinPostausgang$ = GetDocVar("KeinPostausgang") ' E-Mail wurde angeklickt
                            End If
    
                            If KeinPostausgang$ = "1" Then
                                cbPostausgang.Enabled = False
                                cbPostausgang.Value = 0
                                SetDocVar "KeinPostausgang", "0" 'vorsorglich, muss noch untersucht werden
                            Else
                            
                                X = WordExecute("select text4 from system where art = 'postausgang'")
                                ret = String(255, " ")
                                If Left$(WordRequest(ret$), laenge) = "1" Then
                                    cbPostausgang.Value = 1
                                End If
                              
                                Postausgang_Status$ = GetDocVar("postausgang_status")
                                If Postausgang_Status$ = "" Then
                                    X = WordExecute("select text5 from system where art = 'postausgang' and text5 <> '[keine]'")
                                    ret = String(255, " ")
                                    ret$ = Left$(WordRequest(ret$), laenge)
                                    
                                    If ret$ <> "" Then
                                        cmbStatus.text = ret$
                                    End If
                                Else
                                    If Postausgang_Status$ <> "" Then
                                        cmbStatus.text = Postausgang_Status$
                                    End If
                                End If
                            End If
                        
                          
                            If cbPDF.Enabled Then ' nicht enabled f|fffd|r Diktate mit Statuspr|fffd|fung f|fffd|r Postausgang
                                X = WordExecute("select text1 from system where art = 'pdfdrucker'")
                                ret = String(255, " ")
                                PDFAlle = Left$(WordRequest(ret$), laenge)
                                
                                If PDFAlle = "1" And cbPostausgang.Enabled = True Then
                                    cbPDF.Value = 1
                                Else
                                    cbPDF.Value = 0
                                End If
                            End If
                        End If
                            
                        X = WordExecute("select text1 from system where art = 'winwordschnittstelle'")
                        ret = String(255, " ")
                        
                        If Left$(WordRequest(ret$), laenge) = "1" Then
                            cbWichtig.Visible = True
                        Else
                            cbWichtig.Visible = False
                        End If
                        
                    End If
                    
                    If advonet$ = "1" Then
                        'cbAdvonet.Value = 1 AUF GAR KEINEN FALL!!!
                    
                        If EmailBenachrichtigung$ = "1" Then
                           ' cbEmail.Value = 1
                        End If
                    Else
                        cbAdvonet.Visible = False
                        cbEmail.Visible = False
                    End If
                End If
        End If
    End If
End If

If speichern$ = "nein" And Left$(ActiveDocument.Name, 8) = "Dokument" Then
    cbEmail = False
    cbPDF.Value = False
    cbWichtig = False
    cbEmail.Enabled = False
    cbPDF.Enabled = False
    cmdAnhang.Visible = False
    cbWichtig.Enabled = False
End If

L_Anhang.Visible = False
tbAnhang.Visible = False
bAnhang = False
cmdAnhang.Caption = "Anhang hinzuf|fffd|gen"
L_Bemerkung.Top = tbAnmerkungen.Top - 25
tbAnmerkungen.Top = tbAnmerkungen.Top - 25
cbPDF.Top = cbPDF.Top - 25
cbWV.Top = cbWV.Top - 25
cbAufgabe.Top = cbAufgabe.Top - 25
cbPostausgang.Top = cbPostausgang.Top - 25
cbAdvonet.Top = cbAdvonet.Top - 25
cbEmail.Top = cbEmail.Top - 25
cbWichtig.Top = cbWichtig.Top - 25
CommandButton1.Top = CommandButton1.Top - 25
Abbrechen.Top = Abbrechen.Top - 25
cmdAnhang.Top = cmdAnhang.Top - 25
frmSchliessen.Height = frmSchliessen.Height - 25
cmbArt.SelStart = 0
cmbArt.SelLength = Len(cmbArt)
j = 0
CmbKategorie.AddItem ("")
X = WordExecute("select count(*) from history_tree where hnr=0 and nr=" + Anr$)
ret$ = String(255, " ")
erg$ = Left$(WordRequest(ret$), laenge)

If erg$ = "0" Then
    X = WordExecute("select referat2 from akten a,referate r where nr=" + Anr$ + " and r.kuerzel=a.referat")
    ret$ = String(255, " ")
    sReferat = Left$(WordRequest(ret$), laenge)
    If InStr(1, "Notariat", sReferat) > 0 Then
        sReferat = "N"
    Else
        X = WordExecute("select referat from akten  where nr=" + Anr$)
        ret$ = String(255, " ")
        sReferat = Left$(WordRequest(ret$), laenge)
    End If

    s1 = "insert into history_tree ( lfd, ebene, ordnernr, ordnername, hnr, nr ) select lfd, ebene, ordnernr, ordnername, 0, " + Anr$ + " from ordner where entfernt <> 1   and referat is null "
    If sReferat <> "" Then
        s1 = s1 + " and ordnernr not in (select ordnernr from ordner where entfernt = 1 and referat='" + sReferat + "')"
    End If
    X = WordExecute(s1)
    X = WordExecute("commit")
    If sReferat <> "" Then
        s1 = "select max( lfd ) from history_tree where  nr=" + Anr$
        X = WordExecute(s1)
        ret$ = String(255, " ")
        lfd = Left$(WordRequest(ret$), laenge)
        s1 = "insert into history_tree ( lfd, ebene, ordnernr, ordnername, hnr, nr ) select lfd + " + lfd + ", ebene, ordnernr, ordnername, 0, " + Anr$ + " from ordner where entfernt <> 1  and referat='" + sReferat + "'"
        X = WordExecute(s1)
        X = WordExecute("commit")
    End If
End If

X = WordExecute("select count(*) from history_tree where hnr=0 and nr=" + Anr$)
ret$ = String(255, " ")
erg$ = Left$(WordRequest(ret$), laenge)
j = CInt2(erg$)
X = WordExecute("select ebene from history_tree where hnr=0 and nr=" + Anr$ + " order by lfd")
ret$ = String(255, " ")
i = 0

While i < j
    erg$ = Left$(WordRequest(ret$), laenge)
    i = i + 1
    If erg$ <> "" Then
        ebene(i) = erg$
    End If
Wend

s1 = "select ordnername from history_tree where hnr=0 and nr=" + Anr$ + " order by lfd"
X = WordExecute(s1)
ret$ = String(255, " ")
i = 0

While i < j
    erg$ = Left$(WordRequest(ret$), laenge)
    i = i + 1
    
    If erg$ <> "" Then
        CmbKategorie.AddItem (erg$)
    End If
Wend
X = WordExecute("select ordnernr from history_tree where hnr=0 and nr=" + Anr$ + " order by lfd")
ret$ = String(255, " ")
i = 0

While i < j
    erg$ = Left$(WordRequest(ret$), laenge)
    i = i + 1
    If erg$ <> "" Then
        ordnernrht(i) = erg$
    End If
Wend

If Val(betnr$) > 0 Then
    Ordnername = ""
    s1 = "select ordnernr from betins i, betakt a where a.nr =" & Anr$ & " and a.betnr =" & betnr$ & " and a.art = i.text "
    X = WordExecute(s1)
    If X = "0" Then
        ret$ = String(255, " ")
        Ordnernr = Left$(WordRequest(ret$), laenge)
        s1 = "select ordnername from history_tree where hnr=0 and nr=" + Anr$ + " and ordnernr = " + Ordnernr + " order by lfd"
        X = WordExecute(s1)
        If X = "0" Then
            ret$ = String(255, " ")
            Ordnername = Left$(WordRequest(ret$), laenge)
        End If
        BetnrLoc = betnr$
        While Ordnername = "" And BetnrLoc <> ""
            s1 = "select master from betakt a where nr =" & Anr$ & " and betnr =" & BetnrLoc
            X = WordExecute(s1)
            If X = "0" Then
                ret$ = String(255, " ")
                master = Left$(WordRequest(ret$), laenge)
                s1 = "select ordnernr from betins i, betakt a where a.nr =" & Anr$ & " and a.betnr =" & master & " and a.art = i.text "
                X = WordExecute(s1)
                If X = "0" Then
                    ret$ = String(255, " ")
                    Ordnernr = Left$(WordRequest(ret$), laenge)
                    s1 = "select ordnername from history_tree where hnr=0 and nr=" + Anr$ + " and ordnernr = " + Ordnernr + " order by lfd"
                    X = WordExecute(s1)
                    If X = "0" Then
                        ret$ = String(255, " ")
                        Ordnername = Left$(WordRequest(ret$), laenge)
                    Else
                        master = ""
                    End If
                Else
                    master = ""
                End If
            End If
            BetnrLoc = master
        Wend
    End If
End If

If Ordnernr = "" Then
    Ordnernr = GetDocVar("|fffd|ordnernr|fffd|")
    s1 = "select ordnername from history_tree where hnr=0 and nr=" + Anr$ + " and ordnernr = " + Ordnernr + " order by lfd"
    X = WordExecute(s1)
    If X = "0" Then
        ret$ = String(255, " ")
        Ordnername = Left$(WordRequest(ret$), laenge)
    End If
End If

i = 0
While i <= j And ordnernrht(i) <> Ordnernr
    i = i + 1
Wend
If i > j Then i = 0
CmbKategorie.Listindex = i

Hnr$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "HnrNeu")
If Hnr$ = "" Then Hnr$ = "0"
System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "HnrNeu") = 0

If CInt2(Hnr$) > 0 Then
    s1 = "select ordnername from history_tree where hnr=" + Hnr$ + " and nr=" + Anr$ + " order by lfd"
    X = WordExecute(s1)
    If X = "0" Then
        ret$ = String(255, " ")
        Ordnername = Left$(WordRequest(ret$), laenge)
        CmbKategorie.Value = Ordnername
    End If
End If

End Sub

Public Sub SetAnhang(Pfad As String)
sAnhang$ = Pfad
tbAnhang = Right(Pfad, InStr(1, StrReverse(Pfad), "\") - 1)
End Sub
Attribute VB_Name = "frmTextbausteine"
Attribute VB_Base = "0{E85AC9EC-CDDE-408A-938A-1DCECA0085CC}{DF215673-3D22-4B96-AD14-45ED99C86A8A}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False

Option Explicit
Private thisTemplate As Template

Private Sub CommandButton1_Click()
Suchen
End Sub

Private Sub CommandButton2_Click()
Einf|fffd|gen
Unload frmTextbausteine

End Sub

Private Sub CommandButton3_Click()
Unload frmTextbausteine
End Sub

Private Sub CommandButton6_Click()
thisTemplate.AutoTextEntries(ListBox1.text).Delete
UserForm_Initialize
End Sub

Private Sub ListBox1_Change()
    TextBox1.text = Left$(WordBasic.[GetAutoText$](ListBox1.text), 255)
End Sub

Private Sub ListBox1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
    Einf|fffd|gen
    Unload frmTextbausteine
End Sub

Private Sub UserForm_Initialize()
    Dim i As Integer
    Dim myTemplates As Templates
    Dim myTemplate As Template
    
    With frmTextbausteine
        .Top = Application.Top + (Application.Height - .Height) / 2
        .Left = Application.Left + (Application.Width - .Width) / 2
    End With
    
    ListBox1.Clear
    
    For Each myTemplate In Templates
        If InStr(1, myTemplate.Name, "autotext.dot", 1) = 1 Then
            Set thisTemplate = myTemplate
        End If
    Next
          
    For i = 0 To thisTemplate.AutoTextEntries.count - 1
        ListBox1.AddItem thisTemplate.AutoTextEntries(i + 1).Name
    Next
    
End Sub

Private Sub Einf|fffd|gen()
Dim erg As String
Dim meineVorlage
Dim myTemplates As Templates
Dim myTemplate As Template

Application.DisplayAutoCompleteTips = True
thisTemplate.AutoTextEntries(ListBox1.text).Insert where:=Selection.Range

End Sub

Private Sub Suchen()

    Dim i, n As Integer
    Dim erg As String

    ReDim bst__$(thisTemplate.AutoTextEntries.count - 1)
    n = -1

    For i = 1 To thisTemplate.AutoTextEntries.count
        erg$ = thisTemplate.AutoTextEntries(i).Value
        If InStr(StrConv(erg$, 1), StrConv(TextBox2.text, 1)) Then
            n = n + 1
            bst__$(n) = thisTemplate.AutoTextEntries(i).Name
        End If
    Next

    If n > -1 Then
        ReDim neubst__$(n)
        ListBox1.Clear
        For i = 0 To n
            neubst__$(i) = bst__$(i)
            ListBox1.AddItem neubst__(i)
        Next

    Else
        MsgBox "Kein Eintrag gefunden", vbExclamation, GetApplicationName()
    End If

End Sub

Private Sub CommandButton5_Click()
Dim Startuppath$

MsgBox "Mit dieser Funktion haben Sie die M|fffd|glichkeit, Ihre eigenen Textbausteine allen Benutzern im Netzwerk zu Verf|fffd|gung zu stellen. Sollten Sie Textbausteine aus ""Normal.dot"" nach ""Autotext.dot"" kopieren, darf an keinem weiteren Computer Microsoft Word ge|fffd|ffnet sein."
Startuppath = Options.DefaultFilePath(path:=wdStartupPath)
Documents.Open Startuppath & "\Autotext.dot"
Dialogs(wdDialogOrganizer).DefaultTab = wdDialogOrganizerTabAutoText
Dialogs(wdDialogOrganizer).Show
Documents(Startuppath & "\Autotext.dot").Close
UserForm_Initialize

End Sub

Attribute VB_Name = "frmTk"
Attribute VB_Base = "0{83E0F4BF-205D-47F3-8F84-3D557742F135}{DB382FDE-8722-4318-9C9A-59136D30D9A6}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = False




Option Explicit
Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Private Sub CommandButton2_Click()
Unload frmTk
End Sub

Private Sub CommandButtonL|fffd|schen_Click()
Dim i As Integer
Dim Pfad$
Dim TK$
Dim Zeile$
Dim abfrage$
Dim docnr$
Dim X
Dim sDatabase As String
Dim mnr$
Dim ret$
On Error Resume Next

Zeile$ = ListBox1.text

If Zeile$ > "" Then
    TK = Left(Zeile, 4)
    i = TK
    docnr$ = ActiveDocument.Name
    abfrage$ = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
    X = WordExecute(abfrage)
    ret$ = String(255, " ")
    mnr$ = Left(WordRequest(ret$), laenge)
    
    If mnr$ <> "" Then
        ActiveDocument.Bookmarks("tk" & i).Select
        Selection.Font.ColorIndex = wdAuto
        ActiveDocument.Bookmarks("tk" & i).Delete
        abfrage$ = "delete from masstext where mnr=" & mnr$ & " and tnr = " & TK
        X = WordExecute(abfrage$)
        sDatabase$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware", "database")
        Pfad = GetProgramdir & "\tk\" & sDatabase & "\tk" & Val(TK) & ".dat"
        Kill (Pfad)
    Else
        MsgBox "Datei ist keiner Ma|fffd|nahme zugeordnet.", vbExclamation, GetApplicationName()
    End If
    
    ListBox1.Clear
    UserForm_Initialize
End If

WordExecute ("commit")
End Sub

Private Sub CommandButtonOk_Click()
Einf|fffd|gen
End Sub


Private Sub ListBox1_DblClick(ByVal Cancel As MSForms.ReturnBoolean)
Einf|fffd|gen
End Sub

Private Sub UserForm_Initialize()
Dim abfrage$
Dim Anzahl As Integer
Dim ret$
Dim i As Integer
Dim k$
Dim docnr$
Dim X
Dim mnr$

With frmTk
    .Top = Application.Top + (Application.Height - .Height) / 2
    .Left = Application.Left + (Application.Width - .Width) / 2
End With

docnr$ = ActiveDocument.Name
abfrage$ = "select nr from massnahmen where datei = '" & docnr$ & "'" & " Or dateirvg = '" & docnr$ & "'"
X = WordExecute(abfrage$)
ret$ = String(255, " ")
mnr$ = Left(WordRequest(ret$), laenge)

If mnr$ <> "" Then
    abfrage$ = "select count(*) from masstext where mnr = " & mnr$
    X = WordExecute(abfrage$)
    ret$ = String(255, " ")
    k$ = Left(WordRequest(ret$), laenge)
    
    If k$ <> "" Then
        Anzahl = CInt2(k$)
        abfrage$ = "select textkoerper.tnr||'     '||text from textkoerper,masstext where textkoerper.tnr=masstext.tnr and mnr=" & mnr$ & "  order by masstext.tnr"
        X = WordExecute(abfrage$)
       
        For i = 1 To Anzahl
            ret$ = String(255, " ")
            ret$ = (Left(WordRequest(ret$), laenge))
            ret$ = String(5 - (InStr(ret$, " ")), "0") & ret$
            ListBox1.AddItem ret$
        Next
    End If
Else
    MsgBox "Datei ist keiner Ma|fffd|nahme zugeordnet.", vbExclamation, GetApplicationName()
End If

WordExecute ("commit")
End Sub

Private Sub Einf|fffd|gen()
Dim i As Integer
Dim Pfad$
Dim TK$
Dim Zeile$
Dim docnr$
Dim abfrage$

Zeile$ = ListBox1.text
TK = Left(Zeile, 4)

If TK <> "" Then
    i = TK
    Selection.GoTo What:=wdGoToBookmark, Name:="tk" & i
End If
        
End Sub
Attribute VB_Name = "gbez"

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main(GloabalFontSize)
Dim ret$
Dim schrift$
Dim nr$
Dim X
Dim erg$
Dim Y$
Dim aufruf$
Dim fall$
Dim gross
Dim z$
Dim punkt As Integer

On Error GoTo Ende

punkt = 0

ret$ = String(255, " ")
schrift$ = WordBasic.[Font$]()
nr$ = GetAnr(1)

X = WordExecute("select gbez from akten where nr = " + nr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

erg$ = Left$(WordRequest(ret$), laenge)

WordBasic.CharLeft 4, 1
Y$ = RTrim$(Selection.text)
If Left(Y$, 1) = " " Then punkt = 1

If erg$ = "" Then
    aufruf$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "AufrufGegner")
    If aufruf$ = "0" Then
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "Es wurde keine Bezeichnung f|fffd|r den Gegner eingegeben!", vbExclamation, GetApplicationName()
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "AufrufGegner") = "1"
    End If
Else
    
    Y$ = LTrim(Y$)
    
    If LCase(Y$) = "der" Then
        fall$ = "nominativ"
        WordBasic.DeleteWord
    ElseIf LCase(Y$) = "des" Then
        fall$ = "genitiv"
        WordBasic.DeleteWord
    ElseIf LCase(Y$) = "dem" Then
        fall$ = "dativ"
        WordBasic.DeleteWord
    ElseIf LCase(Y$) = "den" Then
        fall$ = "akkusativ"
        WordBasic.DeleteWord
    Else
        fall$ = "bez"
        WordBasic.CharRight 1, 0
        Y$ = RTrim$(Selection.text)
    
' nach R|fffd|cksprache mit Marc folgende Zeile ge|fffd|ndert (2019-08-21)
' If Y$ <> " " Then f|fffd|hrte zu zus|fffd|tzlichem Leerzeichen

        If Y$ <> "|13|" Then
            WordBasic.EditClear
        End If
    
    End If

    If UCase(Left$(Y$, 1)) = Left$(Y$, 1) And fall$ <> "bez" Then
        gross = 1
    Else
        gross = 0
    End If

    X = WordExecute("select " + fall$ + " from faelle where bez = '" + erg$ + "'")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    z$ = Left$(WordRequest(ret$), laenge)

    If gross Then
        If (Len(z$) > 1) Then
            erg$ = UCase(Left$(z$, 1))
            z$ = erg$ + Right$(z$, Len(z$) - 1)
        End If
    End If

    WordBasic.Font schrift$
    
    If punkt = 0 Then
       WordBasic.CharRight 1, 1
       Y$ = RTrim$(Selection.text)
       Selection.MoveLeft 1
       
       If (Right(Y$, 1) = ";" Or Right(Y$, 1) = "." Or Right(Y$, 1) = ",") Then
            With Selection
                .Font.Size = GloabalFontSize
                .TypeText text:=z$
            End With
        
        ElseIf IstAlternative = 0 Then
            With Selection
                WordBasic.Font schrift$
                .Font.Size = GloabalFontSize
                .TypeText text:=z$ + " "
            End With

        Else
            With Selection
                .Font.Size = GloabalFontSize
                .TypeText text:=z$ + " "
            End With
        End If
        
    Else
        With Selection
            .Font.Size = GloabalFontSize
            .TypeText text:=" " + z$
        End With
    End If
       
End If

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub
Attribute VB_Name = "mbez"

Private Declare Function WordExecute Lib "Advolink.dll" (ByVal abfrage$) As Integer
Private Declare Function WordRequest Lib "Advolink.dll" (ByVal ret$) As String
Private Declare Function laenge Lib "Advolink.dll" () As Integer

Public Sub main(GloabalFontSize)
Dim ret$
Dim schrift$
Dim nr$
Dim X
Dim erg$
Dim Y$
Dim aufruf$
Dim fall$
Dim gross
Dim z$
Dim punkt As Integer

On Error GoTo Ende

punkt = 0

ret$ = String(255, " ")
schrift$ = WordBasic.[Font$]()
nr$ = GetAnr(1)

X = WordExecute("select mbez from akten where nr = " + nr$)

If X <> 0 Then
    MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
    GoTo Ende
End If

erg$ = Left$(WordRequest(ret$), laenge)

WordBasic.CharLeft 4, 1
Y$ = RTrim$(Selection.text)
If Left(Y$, 1) = " " Then punkt = 1

If erg$ = "" Then
    aufruf$ = System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "AufrufMandant")
    If aufruf$ = "0" Then
        AnwendungAktivieren ("Microsoft Word")
        MsgBox "Es wurde keine Bezeichnung f|fffd|r den Mandanten eingegeben!", vbExclamation, GetApplicationName()
        System.PrivateProfileString("", "HKEY_CURRENT_USER\SOFTWARE\Advo-ware\" & GetDatabase(), "AufrufMandant") = "1"
    End If
Else

    Y$ = LTrim(Y$)
    
    If LCase(Y$) = "der" Then
        fall$ = "nominativ"
        WordBasic.DeleteWord
    ElseIf LCase(Y$) = "des" Then
        fall$ = "genitiv"
        WordBasic.DeleteWord
    ElseIf LCase(Y$) = "dem" Then
        fall$ = "dativ"
        WordBasic.DeleteWord
    ElseIf LCase(Y$) = "den" Then
        fall$ = "akkusativ"
        WordBasic.DeleteWord
    Else
        fall$ = "bez"
        WordBasic.CharRight 1, 0
        Y$ = RTrim$(Selection.text)
        
        If Y$ <> "|13|" Then
            WordBasic.EditClear
        End If
        
    End If

    If UCase(Left$(Y$, 1)) = Left$(Y$, 1) And fall$ <> "bez" Then
        gross = 1
    Else
        gross = 0
    End If

    X = WordExecute("select " + fall$ + " from faelle where bez = '" + erg$ + "'")

    If X <> 0 Then
        MsgBox "Wordexecutefehler: " & X, vbExclamation, GetApplicationName()
        GoTo Ende
    End If

    z$ = Left$(WordRequest(ret$), laenge)

    If gross Then
        If (Len(z$) > 1) Then
            erg$ = UCase(Left$(z$, 1))
            z$ = erg$ + Right$(z$, Len(z$) - 1)
        End If
    End If

    WordBasic.Font schrift$
    
    If punkt = 0 Then
       WordBasic.CharRight 1, 1
       Y$ = RTrim$(Selection.text)
       Selection.MoveLeft 1
       
       If (Right(Y$, 1) = ";" Or Right(Y$, 1) = "." Or Right(Y$, 1) = ",") Then
            With Selection
                .Font.Size = GloabalFontSize
                .TypeText text:=z$
            End With
        
        ElseIf IstAlternative = 0 Then
            With Selection
                WordBasic.Font schrift$
                .Font.Size = GloabalFontSize
                .TypeText text:=z$ + " "
            End With

        Else
            With Selection
                .Font.Size = GloabalFontSize
                .TypeText text:=z$ + " "
            End With
        End If
        
    Else
        With Selection
            .Font.Size = GloabalFontSize
            .TypeText text:=" " + z$
        End With
    End If

End If

Ende:
X = WordExecute("Commit")
If Err.Number <> 0 Then MsgBox Err.Description
End Sub
Attribute VB_Name = "rechnen"

Private Function pr|fffd|f(element$, Aktion, lParam)

If Aktion = 2 And element$ = "OK" Then
    If WordBasic.DlgValue("K1") > 0 And bib.Val2(WordBasic.[DlgText$]("T1")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T1"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K2") > 0 And bib.Val2(WordBasic.[DlgText$]("T2")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T2"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K3") > 0 And bib.Val2(WordBasic.[DlgText$]("T3")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T3"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K4") > 0 And bib.Val2(WordBasic.[DlgText$]("T4")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T4"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K5") > 0 And bib.Val2(WordBasic.[DlgText$]("T5")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T5"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K6") > 0 And bib.Val2(WordBasic.[DlgText$]("T6")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T6"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K7") > 0 And bib.Val2(WordBasic.[DlgText$]("T7")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T7"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K8") > 0 And bib.Val2(WordBasic.[DlgText$]("T8")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T8"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K9") > 0 And bib.Val2(WordBasic.[DlgText$]("T9")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T9"
        pr|fffd|f = 1
    ElseIf WordBasic.DlgValue("K10") > 0 And bib.Val2(WordBasic.[DlgText$]("T10")) <= 0 Then
        MsgBox "Ung|fffd|ltiger Wert", vbExclamation, GetApplicationName()
        WordBasic.DlgFocus "T10"
        pr|fffd|f = 1
    End If
End If
End Function


Public Sub main()
Dim X
Dim s

WordBasic.BeginDialog 600, 280, "Berechnung Unfallsache", "rechnen.pr|fffd|f"
    WordBasic.CheckBox 30, 15, 20, 16, "", "K1"
    WordBasic.TextBox 55, 15, 345, 18, "N1"
    WordBasic.TextBox 430, 15, 110, 18, "T1"
    WordBasic.CheckBox 30, 35, 20, 16, "", "K2"
    WordBasic.TextBox 55, 35, 345, 18, "N2"
    WordBasic.TextBox 430, 35, 110, 18, "T2"
    WordBasic.CheckBox 30, 55, 20, 16, "", "K3"
    WordBasic.TextBox 55, 55, 345, 18, "N3"
    WordBasic.TextBox 430, 55, 110, 18, "T3"
    WordBasic.CheckBox 30, 75, 20, 16, "", "K4"
    WordBasic.TextBox 55, 75, 345, 18, "N4"
    WordBasic.TextBox 430, 75, 110, 18, "T4"
    WordBasic.CheckBox 30, 95, 20, 16, "", "K5"
    WordBasic.TextBox 55, 95, 345, 18, "N5"
    WordBasic.TextBox 430, 95, 110, 18, "T5"
    WordBasic.CheckBox 30, 115, 20, 16, "", "K6"
    WordBasic.TextBox 55, 115, 345, 18, "N6"
    WordBasic.TextBox 430, 115, 110, 18, "T6"
    WordBasic.CheckBox 30, 135, 20, 16, "", "K7"
    WordBasic.TextBox 55, 135, 345, 18, "N7"
    WordBasic.TextBox 430, 135, 110, 18, "T7"
    WordBasic.CheckBox 30, 155, 20, 16, "", "K8"
    WordBasic.TextBox 55, 155, 345, 18, "N8"
    WordBasic.TextBox 430, 155, 110, 18, "T8"
    WordBasic.CheckBox 30, 175, 20, 16, "", "K9"
    WordBasic.TextBox 55, 175, 345, 18, "N9"
    WordBasic.TextBox 430, 175, 110, 18, "T9"
    WordBasic.CheckBox 30, 195, 20, 16, "", "K10"
    WordBasic.TextBox 55, 195, 345, 18, "N10"
    WordBasic.TextBox 430, 195, 110, 18, "T10"
    WordBasic.OKButton 30, 235, 110, 21
    WordBasic.CancelButton 430, 235, 110, 21
WordBasic.EndDialog

Dim dlg As Object: Set dlg = WordBasic.CurValues.UserDialog
dlg.n1 = "Reparaturkosten"
dlg.n2 = "Differenz Wiederbeschaffungswert/Restwert"
dlg.n3 = "Gutachterkosten"
dlg.n4 = "Wertminderung"
dlg.n5 = "Mietwagenkosten"
dlg.n6 = "Nutzungsausfallentsch|fffd|digung"
dlg.n7 = "Abschleppkosten"
dlg.n8 = "Schmerzensgeld"
dlg.n9 = "Sonstige Kosten"
dlg.n10 = "Kostenpauschale"
dlg.t10 = "40,00"
dlg.k10 = 1
X = WordBasic.Dialog.UserDialog(dlg)

If X = -1 Then
    s = 0
    If dlg.k1 Then s = s + bib.Val2(dlg.t1)
    If dlg.k2 Then s = s + bib.Val2(dlg.t2)
    If dlg.k3 Then s = s + bib.Val2(dlg.t3)
    If dlg.k4 Then s = s + bib.Val2(dlg.t4)
    If dlg.k5 Then s = s + bib.Val2(dlg.t5)
    If dlg.k6 Then s = s + bib.Val2(dlg.t6)
    If dlg.k7 Then s = s + bib.Val2(dlg.t7)
    If dlg.k8 Then s = s + bib.Val2(dlg.t8)
    If dlg.k9 Then s = s + bib.Val2(dlg.t9)
    If dlg.k10 Then s = s + bib.Val2(dlg.t10)
End If

If s > 0 Then
    WordBasic.TableInsertTable ConvertFrom:="", NumColumns:="4", NumRows:="1", InitialColWidth:= _
"Auto"
    WordBasic.TableColumnWidth ColumnWidth:="2 cm", SpaceBetweenCols:="0,25 " + _
"cm", RulerStyle:=0
    WordBasic.NextCell
    WordBasic.TableColumnWidth ColumnWidth:="9 cm", SpaceBetweenCols:="0,25 " + _
"cm", RulerStyle:=0
    WordBasic.NextCell
    WordBasic.TableColumnWidth ColumnWidth:="3 cm", SpaceBetweenCols:="0,25 c" + _
"m", RulerStyle:=0
    WordBasic.FormatTabs position:="2,2 cm", DefTabs:="1,25 cm", Align:=3, _
Leader:=0, ClearAll:=1
    WordBasic.FormatTabs position:="2,2 cm", DefTabs:="1,25 cm", Align:=3, _
Leader:=0, set:=1
    WordBasic.NextCell
    WordBasic.TableColumnWidth ColumnWidth:="1 cm", SpaceBetweenCols:="0,25 c" + _
"m", RulerStyle:=0
    WordBasic.PrevCell
    WordBasic.PrevCell

    If dlg.k1 Then
        WordBasic.Insert dlg.n1
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t1))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If

    If dlg.k2 Then
        WordBasic.Insert dlg.n2
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t2))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If

    If dlg.k3 Then
        WordBasic.Insert dlg.n3
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t3))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If

    If dlg.k4 Then
        WordBasic.Insert dlg.n4
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t4))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If

    If dlg.k5 Then
        WordBasic.Insert dlg.n5
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t5))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If

    If dlg.k6 Then
        WordBasic.Insert dlg.n6
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t6))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If

    If dlg.k7 Then
        WordBasic.Insert dlg.n7
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t7))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If
    
    If dlg.k8 Then
        WordBasic.Insert dlg.n8
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t8))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If
    
    If dlg.k9 Then
        WordBasic.Insert dlg.n9
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t9))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If
    
    If dlg.k10 Then
        WordBasic.Insert dlg.n10
        WordBasic.NextCell
        WordBasic.Insert WordBasic.Call("bib.wformat$", bib.Val2(dlg.t10))
        WordBasic.NextCell
        WordBasic.Insert "|fffd|"
        WordBasic.NextCell
        WordBasic.NextCell
    End If
    
    WordBasic.Insert "Gesamtbetrag"
    WordBasic.FormatBordersAndShading ApplyTo:=2, TopBorder:=1, BottomBorder:=7
    WordBasic.NextCell
    WordBasic.Insert WordBasic.Call("bib.wformat$", s)
    WordBasic.FormatBordersAndShading ApplyTo:=2, TopBorder:=1, BottomBorder:=7
    WordBasic.NextCell
    WordBasic.Insert "|fffd|"
    WordBasic.FormatBordersAndShading ApplyTo:=2, TopBorder:=1, BottomBorder:=7
End If

End Sub


' InQuest injected base64 decoded content
' z{@r
' -zYn
' z{Uj
' z{Uj
' zu't
' !zY^
' HCE9
' ,zz!
' )z'!z
' %z'!
' -zY]j
' jYky
' xZ+u
' {%R{
' xZ+u
' K^2+Cj
' jZ :

INQUEST-PP=macro
